# 完整迁移方案（`public/css` → Vue 组件 + `src/styles/global.css`，最终删除旧 CSS）

你现在的项目属于“**已迁移大半，但还没收口**”的状态：很多组件已经有 `<style scoped>`，但 `index.html` 仍在全局 `<link>` 旧 CSS，导致你无法安全删除 `public/css/`。下面这份方案按**可执行阶段**组织，保证你每一步都能验证、可回滚，最终做到：

- 只保留 `src/styles/global.css` 作为唯一全局样式入口（在 `main.ts` import）
- 其余样式全部归入对应 `.vue` 的 `<style scoped>`
- 删除 `vue-frontend/public/css/` 下所有旧文件
- UI 与 Flask 原版一致，且支持亮/暗主题

---

## 0. 目标形态与迁移原则（先统一“什么应该放哪”）

- **[全局只放什么]**（进 `src/styles/global.css`）
  - **CSS Variables / 主题变量**（含暗色模式覆盖）
  - **reset / 基础排版**（`box-sizing`、`body` 字体、默认滚动条策略等）
  - **少量"通用原子类"**（例如 `.btn`、`.btn-primary`、`.card`、`.modal-*` 这类跨页面复用的结构类）
  - **全局动画 keyframes**（如果多处用）
- **[组件里放什么]**（进各组件 `<style scoped>`）
  - 页面布局（容器、栅格、间距）
  - 组件内部结构/交互样式（hover/active/selected）
  - 只在一个页面出现的样式（例如书架页的卡片布局、编辑模式布局）
- **[必须处理的特殊点]**
  - `:deep()`：父组件要"穿透"改子组件内部样式时用（例如书架页定制 `AppHeader`）
  - `:global()`：需要影响 `html/body/[data-theme]` 这类"组件 DOM 之外的节点"时用（建议集中写在 `global.css`）
  - **ID 选择器迁移**：布局容器类 ID（如 `#image-display-area`）建议最终变 class；功能性 ID（如 `label for`、JS 定位）可保留

---

## 1. 执行前准备（必做，保证可回滚/可验收）

- **[建分支]**：`git checkout -b refactor/css-migration`
- **[基线截图]**：至少 4 组（亮/暗各一套更好）
  - 书架页（`BookshelfView`）
  - 翻译页（`TranslateView`：上传区 + 结果区）
  - 打开设置弹窗（`SettingsModal`）
  - 进入编辑模式（`EditWorkspace` 全屏）
- **[验收标准]**：迁移后
  - Network **不再请求** `/css/*.css`
  - UI 与基线一致（允许像素级微差，但布局/颜色/hover/禁用态需一致）
  - 暗色模式切换正常

---

## 2. 资产盘点与映射（12 个 CSS 文件逐一归属）

下面是**最终归属**（你很多已完成，但要按此"收口"）：

### 2.1 `variables.css` → `src/styles/global.css`
- **[迁移内容]**：全部变量（亮/暗模式）
- **[关键动作]**：补齐"变量别名"，避免组件里 `var(--primary-color)` 这类找不到
  - 你项目里同时出现 `--color-primary` 与 `--primary-color` 两套命名，必须统一或做 alias

### 2.2 `base.css` → `global.css`（全局） + 少量页面 scoped
- **[global.css]**：reset、body、通用排版、全局 keyframes
- **[页面 scoped]**：`.container`、页面布局类（目前 `TranslateView.vue` 已有自己的 `.container`）

### 2.3 `components.css` → `global.css`（通用类） + 各组件 scoped
- **[global.css 必留]**：`.btn` / `.btn-primary` / `.btn-danger` / `.btn-sm` 等（跨全站大量使用）
- **[组件 scoped]**：进度条、toast、侧边栏控制、图片控制区等（你已基本迁入对应组件）

### 2.4 `header-footer.css` → `AppHeader.vue` + 页面级少量定制
- **[默认头部样式]**：`AppHeader.vue` scoped
- **[页面定制]**：书架页通过 `:deep(.app-header)` 做 gradient/sticky（你已在 `BookshelfView.vue` 做了）

### 2.5 `sidebar.css` → `SettingsSidebar.vue`
- **[状态]**：已基本完成
- **[收口建议]**：逐步从 `#settings-sidebar` 选择器迁移到 `.settings-sidebar`

### 2.6 `thumbnail.css` → `ThumbnailSidebar.vue`
- **[状态]**：已基本完成
- **[收口建议]**：同上（`#thumbnail-sidebar` → `.thumbnail-sidebar`）

### 2.7 `image-display.css` → `TranslateView.vue` + `ImageUpload.vue` + `ImageResultDisplay.vue`
- **[TranslateView]**：布局容器（`#image-display-area`、上传卡片容器）
- **[ImageUpload]**：拖拽区/上传区细节
- **[ImageResultDisplay]**：结果图片区、控制按钮、下载区、文本信息区

### 2.8 `modals.css` → `global.css`（通用 modal 结构）+ 各 modal scoped
- **[建议]**：把 `.modal-overlay/.modal-content/.modal-header/...` 这种"结构类"放 `global.css`，减少每个 modal 重复写一遍
- **[各 modal]**：`BaseModal.vue/ConfirmModal.vue/SponsorModal.vue/BookDetailModal.vue/PluginManager.vue` 只写差异部分

### 2.9 `settings-modal.css` → `SettingsModal.vue`（+ 子组件）
- **[状态]**：已基本完成
- **[风险点]**：如果按钮类仍依赖旧 CSS，要确保 `.btn` 体系已进 `global.css`

### 2.10 `bookshelf.css` → `BookshelfView.vue` + `BookSearch.vue` + `BookCard.vue` + `BookDetailModal.vue`
- **[状态]**：你已经迁了非常多
- **[最大风险]**：书架页用到的 `--card-bg/--input-bg/--hover-bg/...` 等变量必须在 `global.css` 有定义（否则删 `bookshelf.css` 直接变样）

### 2.11 `edit-mode.css` → 编辑相关组件（重点、最后攻克）
- **[目标]**：最终删除 `public/css/edit-mode.css`
- **[建议拆分归属]**
  - `EditWorkspace.vue`：全屏容器、主布局、双图对比布局、面板区域布局、横/竖布局切换样式（例如你文件里 `.edit-workspace`、`.edit-main-layout`、`.image-comparison-container`、`.edit-panel-container`、`.layout-vertical ...` 等）
  - `EditToolbar.vue`：顶部工具栏、导航按钮、操作按钮、缩略图条（例如 `.edit-toolbar-wrapper/.image-navigator/.annotation-tools/.edit-thumbnails-panel/...`）
  - `BubbleOverlay.vue`：气泡框、resize/rotate 手柄、选中/多选高亮（例如 `.bubble-highlight-box/.resize-handle/.rotate-line/...`）
  - **全局行为（不要留在 CSS 里）**：`body` 禁止滚动建议用 JS 控制（见第 4 阶段）

### 2.12 `style.css`（旧汇总入口）→ 删除
- **[说明]**：它只是 `@import` 汇总，等 `index.html` 不再 link 它即可删除

---

## 3. 分阶段可执行迁移步骤（按这个做，最稳）

### 阶段 A：先把 `global.css` 补齐到"能独立跑"
目标：即使你暂时不动组件 CSS，**把 `index.html` 的 link 删掉也不会按钮/变量全崩**。

- **[动作 A1]**：在 `src/styles/global.css` 增加"变量别名层"
  - **必须保证**：项目里出现过的这些变量名都有值
    - `--primary-color`
    - `--error-color` / `--success-color` / `--warning-color`
    - `--card-bg` / `--hover-bg` / `--input-bg`
    - `--border-color`
    - `--text-primary` / `--text-secondary` / `--text-muted`
  - **暗色模式**：在 `[data-theme="dark"]` 下给出对应值

- **[动作 A2]**：把 `.btn` 体系迁入 `global.css`
  - `.btn`（基础）
  - `.btn-primary/.btn-secondary/.btn-danger`
  - `.btn-sm`（如果有）
  - 迁完后重点看：
    - `BookshelfView` 的批量操作按钮
    - `ConfirmModal` 的确认/取消
    - `SettingsModal` 的底部按钮

- **[动作 A3]**：把 modal 的通用结构类迁入 `global.css`（可选但强烈推荐）
  - `.modal-overlay/.modal-content/.modal-header/.modal-body/.modal-footer`
  - 迁完后看：`ConfirmModal/BookDetailModal/PluginManager` 是否还依赖旧 `modals.css`

- **[阶段验收]**
  - **临时**把 `index.html` 里 `components.css/bookshelf.css/settings-modal.css/modals.css` 这些 `<link>` 注释掉（不删文件）
  - 页面还能用（允许细节不完美，但不应出现"按钮变浏览器默认样式/主题变量全失效"）

---

### 阶段 B：清理"重复/死 CSS"（减少迁移后维护成本）
- **[动作 B1]**：删除组件内"跨组件根节点的 scoped 选择器"
  - 典型坑：在子组件 scoped 里写父容器 ID（例如 `#image-display-area`），大概率匹配不到或变成维护负担
- **[动作 B2]**：统一 ID → class（仅限布局类）
  - 把 `#image-display-area/#upload-section/...` 这类逐步改为 `.image-display-area/.upload-section`（如果你愿意更彻底）
  - 功能性 ID（JS 定位、`for` 关联）保留

- **[阶段验收]**
  - 功能不变
  - 样式不漂移（对比基线截图）

---

### 阶段 C：攻克 `edit-mode.css`（最重要、最后删全局 link 的阻塞点）
你当前打开的 `edit-mode.css` 能看出几个明显模块（我按你文件里的实际内容拆）：

- **[模块 C1：全局隐藏规则]**
  - 例如：`.edit-mode-active .app-header ... { display:none }`
  - **迁移目标**：迁入 `TranslateView.vue` 的 scoped（你已经有类似规则：`.translate-page.edit-mode-active .app-header,.container {display:none}`）
  - **建议改造**：只隐藏 Vue 实际存在的节点（你现在已经做得更合理）

- **[模块 C2：禁止滚动]**
  - 旧 CSS：`body.edit-mode-active { overflow:hidden }`
  - **迁移目标**：用 JS 控制（推荐）
    - 在 `TranslateView.vue` 或 `EditWorkspace.vue` 里 watch `isEditMode`：
      - 进入编辑：`document.body.style.overflow = 'hidden'`
      - 退出编辑：恢复为空
  - **原因**：避免再依赖"往 body 加 class"的全局手段

- **[模块 C3：编辑工作区容器/主布局]**
  - 例如：`.edit-workspace`、`.edit-main-layout`、`.image-comparison-container`、`.edit-panel-container`、`.layout-vertical ...`
  - **迁移目标**：`EditWorkspace.vue` scoped
  - **关键要求**：把所有过于通用的类（如 `.content-container/.image-container`）至少**加前缀**：
    - `.edit-workspace .content-container`
    - `.edit-workspace .image-container`
  - **原因**：这些类名太通用，留全局会污染翻译页的其它区域

- **[模块 C4：工具栏/缩略图条/按钮组/进度条]**
  - 例如：`.edit-toolbar-wrapper/.edit-toolbar/.image-navigator/.annotation-tools/.edit-progress-*`、`.edit-thumbnails-panel/...`
  - **迁移目标**：`EditToolbar.vue` scoped（或拆成新子组件，但你不想加文件的话就放 toolbar）

- **[模块 C5：气泡高亮/手柄/旋转/多选]**
  - 例如：`.highlight-bubble/.bubble-highlight-box/.resize-handle/.rotate-line/...`
  - **迁移目标**：`BubbleOverlay.vue` scoped

- **[模块 C6：主题暗色覆盖]**
  - 例如：`[data-theme="dark"] .toolbar-btn ...`
  - **迁移目标**：保持在对应组件 scoped 内即可（scoped 下仍能生效，因为元素本身带 scope attribute）

- **[阶段验收]**
  - 进入编辑模式后：
    - 全屏覆盖正常
    - 不能滚动背景
    - 双图对照、拖拽/缩放、气泡选择/多选/旋转手柄正常
    - 顶部工具栏按钮 hover/active/disabled 状态一致

---

### 阶段 D：移除 `index.html` 所有旧 CSS `<link>`
- **[动作 D1]**：删掉 `index.html` 中所有 `public/css/*.css` 的 `<link>`
- **[动作 D2]**：确认 `src/main.ts` 仍 `import './styles/global.css'`
- **[阶段验收]**
  - Network 无 `/css/*.css`
  - 页面不 404 不闪烁
  - 主题切换正常

---

### 阶段 E：删除 `public/css/` 目录
- **[动作 E1]**：删除 `vue-frontend/public/css/` 全部旧文件
- **[最终验收]**
  - 基线截图对比通过
  - DevTools Coverage 无大量"无意义的残留 CSS"
  - 全局搜索 `css/style.css` / `public/css/` 引用为 0

---

## 4. 关键坑位与处理建议（能省很多时间）

- **[Teleport + scoped]**：Teleport 出去的节点仍带 scope attribute，**组件 scoped 仍能作用**；但"依赖祖先选择器"的规则（例如 `.bookshelf-page .modal ...`）可能失效，需要改成在 modal 根节点加 class 或用 `:deep()`。
- **[避免全局 `!important`]**：迁移时先照搬没问题，但收口阶段尽量降低 `!important`，否则将来组件互相覆盖很难维护。
- **[编辑模式类名污染]**：`edit-mode.css` 里像 `.content-container/.image-container` 这种必须前缀化或局部化，否则删除旧 CSS 后你会遇到"某页面样式莫名被编辑模式影响"的隐患。
- **[变量统一]**：删除旧 CSS 后最常见的坏掉原因不是布局，而是 `var(--xxx)` 变空。优先补 alias。
