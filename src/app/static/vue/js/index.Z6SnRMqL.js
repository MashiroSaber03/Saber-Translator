const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/config.CwRcCkM9.js","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js","js/BookshelfView.CBSMxH0K.js","js/bookshelfStore.CObbn-zo.js","js/vue-vendor.DDJbHApa.js","js/bookshelf.Do7F4bT8.js","js/system.CmjDD-4C.js","js/BaseModal.DmHszQB6.js","assets/BaseModal.BdiCeA_N.css","assets/BookshelfView.oD0hVIU6.css","js/TranslateView.qDsgRVVY.js","js/CustomSelect.vue_vue_type_style_index_0_lang.3BEAab7t.js","assets/CustomSelect.CoWnC2Ju.css","assets/TranslateView.DW2Wqzz-.css","js/ReaderView.Binp9gq3.js","assets/ReaderView.Bs8EuB5_.css","js/InsightView.D7YccWYu.js","assets/InsightView.C9ShnisB.css"])))=>i.map(i=>d[i]);
import{d as no,r as y,c as _,a as ne,o as lo,b as uo,e as te,f as Y,T as co,w as mo,g as po,h as q,i as N,F as le,j as fo,u as ue,n as vo,t as ho,k as go,l as To,R as Oo,m as xo,p as Ro,q as _o,s as yo}from"./vue-vendor.DDJbHApa.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const p of m.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&l(p)}).observe(document,{childList:!0,subtree:!0});function i(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(u){if(u.ep)return;u.ep=!0;const m=i(u);fetch(u.href,m)}})();const qo="modulepreload",Eo=function(o){return"/static/vue/"+o},ae={},E=function(s,i,l){let u=Promise.resolve();if(i&&i.length>0){let P=function(h){return Promise.all(h.map(O=>Promise.resolve(O).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),d=p?.nonce||p?.getAttribute("nonce");u=P(i.map(h=>{if(h=Eo(h),h in ae)return;ae[h]=!0;const O=h.endsWith(".css"),x=O?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${x}`))return;const g=document.createElement("link");if(g.rel=O?"stylesheet":qo,O||(g.as="script"),g.crossOrigin="",g.href=h,d&&g.setAttribute("nonce",d),document.head.appendChild(g),O)return new Promise((C,J)=>{g.addEventListener("load",C),g.addEventListener("error",()=>J(new Error(`Unable to preload CSS for ${h}`)))})}))}function m(p){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=p,window.dispatchEvent(d),!d.defaultPrevented)throw p}return u.then(p=>{for(const d of p||[])d.status==="rejected"&&m(d.reason);return s().catch(m)})},So="#FFFFFF",ce=`你是一个ocr助手，你需要将我发送给你的图片中的文字提取出来并返回给我，要求：
1、完整识别：我发送给你的图片中的文字都是需要识别的内容
2、非贪婪输出：不要返回任何其他解释和说明。`,Po=`你是一个专业的翻译引擎。请将用户提供的文本翻译成简体中文。
要求：
1. 保留原文的表达意图和情感
2. 使用地道、流畅的表达方式
3. 不要添加任何额外的解释或对话
4. 直接返回翻译结果`,No=`你是一个专业的翻译引擎。请将用户提供的文本翻译成简体中文。
当文本中包含特殊字符（如大括号{}、引号""、反斜杠\\等）时，请在输出中保留它们但不要将它们视为JSON语法的一部分。
请严格按照以下 JSON 格式返回结果，不要添加任何额外的解释或对话:
{
  "translated_text": "[翻译后的文本放在这里]"
}`,Mo=`你是一个OCR助手。请将我发送给你的图片中的所有文字提取出来。
当文本中包含特殊字符（如大括号{}、引号""、反斜杠\\等）时，请在输出中保留它们但不要将它们视为JSON语法的一部分。如果需要，你可以使用转义字符\\来表示这些特殊字符。
请严格按照以下 JSON 格式返回结果，不要添加任何额外的解释或对话:
{
  "extracted_text": "[这里放入所有识别到的文字，可以包含换行符以大致保留原始分段，但不要包含任何其他非文本内容]"
}`,Lo=`你是一个漫画翻译助手，我会提供原始漫画图片和导出的只含原文不含译文JSON翻译文件，帮我将原文翻译成中文
翻译要求：
1.仅修改JSON中的"translated"译文，保持其他所有结构和字段不变。
2.json中的"imagelndex"序号是每张图片的页码，在翻译前先根据json文件中每页图片的原文内容和所有漫画图片对我给你的所有图片进行排序，在进行上下文对比时要严格按照"imagelndex"序号进行对比，你在翻译时要按照"imagelndex"的顺序进行顺序翻译，从而使得每句翻译足够连贯，上下文不会突兀
3.通过json中每页图片的"original"原文内容和所有的漫画图片明确每句话在那页图的哪个位置，并结合漫画图像和上下文语境，让翻译更加连贯自然，符合角色语气和场景
4.json中的"bubblelndex"标号可能不正确，你需要根据图片自行判断每句话的正确顺序，从而输出符合上下文连贯的翻译，但在输出翻译时不要修改原本的"bubblelndex"标号
5.保留原文的表达意图和情感，但使用更地道、流畅的表达方式
6.注意专有名词和术语的一致性翻译
7.如遇幽默、双关语或文化特定内容，请尽量找到目标语言中恰当的表达
8.不要添加原文中不存在的信息或解释
9.保持简洁明了，符合气泡空间限制
10.译文字数尽量不要超过原文
11.你需要直接返回修改后的完整JSON文件，无需解释每处修改原因。`,nt=`你是一个专业的漫画校对助手，请帮我校对漫画翻译结果。我会给你漫画未经翻译的原图、由漫画原文和已有的翻译文本组成的JSON文件，请根据图片内容和上下文关系，检查并改进翻译质量。
校对要点：
1. json中的"imagelndex"序号是每张图片的页码，在翻译前先根据json文件中每页图片的原文内容和所有漫画图片对我给你的所有图片进行排序，在进行上下文对比时要严格按照"imagelndex"序号进行对比，你在翻译时要按照"imagelndex"的顺序进行顺序翻译，从而使得每句翻译足够连贯，上下文不会突兀
2. 通过json中每页图片的"original"原文内容和所有的漫画图片明确每句话在那页图的哪个位置，并结合漫画图像和上下文语境，让翻译更加连贯自然，符合角色语气和场景
3. json中的"bubblelndex"标号可能不正确，你需要根据图片自行判断每句话的正确顺序，从而输出符合上下文连贯的翻译，但在输出翻译时不要修改原本的"bubblelndex"标号
4. 针对特殊术语或专有名词的翻译进行统一
5. 重点关注易错点的人称和语气词
6. 修正任何语法或表达错误
请直接返回修改后的JSON数据，保持原有格式，只需更新"translated"字段的内容。`,B=0,I=0,Ao=!0,bo="#FFFFFF",Vo=3,lt=[16,20,24,28,32,36,40,48,56,64],ut=2,ct=10,mt=100,D=3,K=2,M=2,pt=5,dt=200,ft=30,vt="edit_mode_layout",H="translationSettings",ie="theme",re="providerConfigs",se="modelHistory",Uo={fontSize:25,autoFontSize:!0,fontFamily:"fonts/STSONG.TTF",layoutDirection:"auto",textColor:"#000000",fillColor:So,strokeEnabled:Ao,strokeColor:bo,strokeWidth:Vo,inpaintMethod:"solid"},Bo={apiKey:"",secretKey:"",version:"standard",sourceLanguage:"JAP"},Io={provider:"gemini",apiKey:"",modelName:"",prompt:ce,rpmLimit:I,customBaseUrl:"",isJsonMode:!1},Do={provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",rpmLimit:B,maxRetries:D,isJsonMode:!1},Ko={provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",batchSize:3,sessionReset:20,rpmLimit:7,maxRetries:K,lowReasoning:!1,noThinkingMethod:"gemini",forceJsonOutput:!0,useStream:!1,prompt:Lo},Fo={enabled:!1,rounds:[],maxRetries:M},wo={ratio:0,top:0,bottom:0,left:0,right:0},Co={enabled:!0,dilateSize:10,boxExpandRatio:20};function G(){return{textStyle:{...Uo},ocrEngine:"manga_ocr",sourceLanguage:"japanese",textDetector:"default",baiduOcr:{...Bo},aiVisionOcr:{...Io},translation:{...Do},targetLanguage:"zh",translatePrompt:"",useTextboxPrompt:!1,textboxPrompt:"",hqTranslation:{...Ko},proofreading:{...Fo},boxExpand:{...wo},preciseMask:{...Co},pdfProcessingMethod:"backend",showDetectionDebug:!1}}const me=no("settings",()=>{const o=y(G()),s=y("light"),i=y({translation:{},hqTranslation:{},aiVisionOcr:{}}),l=y({}),u=y([]),m=_(()=>o.value.textStyle),p=_(()=>o.value.ocrEngine),d=_(()=>o.value.sourceLanguage),P=_(()=>o.value.translation.provider),h=_(()=>o.value.hqTranslation.provider),O=_(()=>o.value.proofreading.enabled),x=_(()=>s.value==="dark");function g(e){Object.assign(o.value,e),c()}function C(e){Object.assign(o.value.textStyle,e),c()}function J(e){o.value.ocrEngine=e,c(),console.log(`OCR引擎已设置为: ${e}`)}function fe(e){o.value.textDetector=e,c(),console.log(`文本检测器已设置为: ${e}`)}function ve(e){o.value.sourceLanguage=e,c(),console.log(`源语言已设置为: ${e}`)}function he(e){Object.assign(o.value.baiduOcr,e),c()}function ge(e){Object.assign(o.value.aiVisionOcr,e),c()}function Te(e){const t=o.value.aiVisionOcr.provider;t!==e&&(V(t),o.value.aiVisionOcr.provider=e,z(e),c(),console.log(`AI视觉OCR服务商已切换为: ${e}`))}function Oe(e){const t=o.value.translation.provider;t!==e&&(A(t),o.value.translation.provider=e,j(e),c())}function xe(e){Object.assign(o.value.translation,e),c()}function Re(e){o.value.translatePrompt=e,c()}function _e(e){o.value.textboxPrompt=e,c()}function ye(e){o.value.useTextboxPrompt=e,c()}function qe(e){o.value.translation.isJsonMode=e;const t=e?No:Po;o.value.translatePrompt=t,c(),console.log(`翻译提示词模式已切换为: ${e?"JSON格式":"普通模式"}`)}function Ee(e){o.value.aiVisionOcr.isJsonMode=e;const t=e?Mo:ce;o.value.aiVisionOcr.prompt=t,c(),console.log(`AI视觉OCR提示词模式已切换为: ${e?"JSON格式":"普通模式"}`)}function Se(e){const t=o.value.hqTranslation.provider;t!==e&&(b(t),o.value.hqTranslation.provider=e,$(e),c(),console.log(`高质量翻译服务商已切换为: ${e}`))}function Pe(e){Object.assign(o.value.hqTranslation,e),c()}function Ne(e){o.value.hqTranslation.useStream=e,c()}function Me(e){o.value.hqTranslation.noThinkingMethod=e,c()}function Le(e){o.value.hqTranslation.forceJsonOutput=e,c()}function Ae(e){o.value.proofreading.enabled=e,c(),console.log(`AI校对已${e?"启用":"禁用"}`)}function be(e){o.value.proofreading.rounds.push(e),c(),console.log(`已添加校对轮次: ${e.name}`)}function Ve(e,t){if(e>=0&&e<o.value.proofreading.rounds.length){const n=o.value.proofreading.rounds[e];n&&(Object.assign(n,t),c())}}function Ue(e){if(e>=0&&e<o.value.proofreading.rounds.length){const t=o.value.proofreading.rounds.splice(e,1);c(),console.log(`已删除校对轮次: ${t[0]?.name}`)}}function Be(e){o.value.proofreading.maxRetries=e,c()}function Ie(e){Object.assign(o.value.boxExpand,e),c()}function De(e){Object.assign(o.value.preciseMask,e),c()}function Ke(e){o.value.pdfProcessingMethod=e,c(),console.log(`PDF处理方式已设置为: ${e}`)}function Fe(e){o.value.showDetectionDebug=e,c()}function we(){s.value=s.value==="light"?"dark":"light",L(),Q(),console.log(`主题已切换为: ${s.value}`)}function Ce(e){s.value=e,L(),Q()}function L(){typeof document<"u"&&(document.documentElement.setAttribute("data-theme",s.value),document.body.setAttribute("data-theme",s.value))}function A(e){if(!e)return;const t={apiKey:o.value.translation.apiKey,modelName:o.value.translation.modelName,customBaseUrl:o.value.translation.customBaseUrl,rpmLimit:o.value.translation.rpmLimit,maxRetries:o.value.translation.maxRetries,isJsonMode:o.value.translation.isJsonMode};i.value.translation[e]=t,U(),console.log(`[Settings] 保存翻译服务商配置: ${e}`,t)}function j(e){if(!e)return;const t=i.value.translation[e];t?(t.apiKey!==void 0&&(o.value.translation.apiKey=t.apiKey),t.modelName!==void 0&&(o.value.translation.modelName=t.modelName),t.customBaseUrl!==void 0&&(o.value.translation.customBaseUrl=t.customBaseUrl),t.rpmLimit!==void 0&&(o.value.translation.rpmLimit=t.rpmLimit),t.maxRetries!==void 0&&(o.value.translation.maxRetries=t.maxRetries),t.isJsonMode!==void 0&&(o.value.translation.isJsonMode=t.isJsonMode),console.log(`[Settings] 恢复翻译服务商配置: ${e}`,t)):(o.value.translation.apiKey="",o.value.translation.modelName="",o.value.translation.customBaseUrl="",console.log(`[Settings] ${e} 无缓存配置，使用默认值`))}function b(e){if(!e)return;const t={apiKey:o.value.hqTranslation.apiKey,modelName:o.value.hqTranslation.modelName,customBaseUrl:o.value.hqTranslation.customBaseUrl,batchSize:o.value.hqTranslation.batchSize,sessionReset:o.value.hqTranslation.sessionReset,rpmLimit:o.value.hqTranslation.rpmLimit,maxRetries:o.value.hqTranslation.maxRetries,lowReasoning:o.value.hqTranslation.lowReasoning,noThinkingMethod:o.value.hqTranslation.noThinkingMethod,forceJsonOutput:o.value.hqTranslation.forceJsonOutput,useStream:o.value.hqTranslation.useStream,prompt:o.value.hqTranslation.prompt};i.value.hqTranslation[e]=t,U(),console.log(`[Settings] 保存高质量翻译服务商配置: ${e}`,t)}function $(e){if(!e)return;const t=i.value.hqTranslation[e];t?(t.apiKey!==void 0&&(o.value.hqTranslation.apiKey=t.apiKey),t.modelName!==void 0&&(o.value.hqTranslation.modelName=t.modelName),t.customBaseUrl!==void 0&&(o.value.hqTranslation.customBaseUrl=t.customBaseUrl),t.batchSize!==void 0&&(o.value.hqTranslation.batchSize=t.batchSize),t.sessionReset!==void 0&&(o.value.hqTranslation.sessionReset=t.sessionReset),t.rpmLimit!==void 0&&(o.value.hqTranslation.rpmLimit=t.rpmLimit),t.maxRetries!==void 0&&(o.value.hqTranslation.maxRetries=t.maxRetries),t.lowReasoning!==void 0&&(o.value.hqTranslation.lowReasoning=t.lowReasoning),t.noThinkingMethod!==void 0&&(o.value.hqTranslation.noThinkingMethod=t.noThinkingMethod),t.forceJsonOutput!==void 0&&(o.value.hqTranslation.forceJsonOutput=t.forceJsonOutput),t.useStream!==void 0&&(o.value.hqTranslation.useStream=t.useStream),t.prompt!==void 0&&(o.value.hqTranslation.prompt=t.prompt),console.log(`[Settings] 恢复高质量翻译服务商配置: ${e}`,t)):(o.value.hqTranslation.apiKey="",o.value.hqTranslation.modelName="",o.value.hqTranslation.customBaseUrl="",console.log(`[Settings] ${e} 无缓存配置，使用默认值`))}function V(e){if(!e)return;const t={apiKey:o.value.aiVisionOcr.apiKey,modelName:o.value.aiVisionOcr.modelName,customBaseUrl:o.value.aiVisionOcr.customBaseUrl,prompt:o.value.aiVisionOcr.prompt,rpmLimit:o.value.aiVisionOcr.rpmLimit,isJsonMode:o.value.aiVisionOcr.isJsonMode};i.value.aiVisionOcr[e]=t,U(),console.log(`[Settings] 保存AI视觉OCR服务商配置: ${e}`,t)}function z(e){if(!e)return;const t=i.value.aiVisionOcr[e];t?(t.apiKey!==void 0&&(o.value.aiVisionOcr.apiKey=t.apiKey),t.modelName!==void 0&&(o.value.aiVisionOcr.modelName=t.modelName),t.customBaseUrl!==void 0&&(o.value.aiVisionOcr.customBaseUrl=t.customBaseUrl),t.prompt!==void 0&&(o.value.aiVisionOcr.prompt=t.prompt),t.rpmLimit!==void 0&&(o.value.aiVisionOcr.rpmLimit=t.rpmLimit),t.isJsonMode!==void 0&&(o.value.aiVisionOcr.isJsonMode=t.isJsonMode),console.log(`[Settings] 恢复AI视觉OCR服务商配置: ${e}`,t)):(o.value.aiVisionOcr.apiKey="",o.value.aiVisionOcr.modelName="",o.value.aiVisionOcr.customBaseUrl="",console.log(`[Settings] ${e} 无缓存配置，使用默认值`))}function Je(e,t){e==="translation"?A(t):e==="hqTranslation"?b(t):e==="aiVisionOcr"&&V(t)}function je(e,t){e==="translation"?j(t):e==="hqTranslation"?$(t):e==="aiVisionOcr"&&z(t)}function $e(e,t){if(!e||!t)return;l.value[e]||(l.value[e]=[]);const n=l.value[e].indexOf(t);n!==-1&&l.value[e].splice(n,1),l.value[e].unshift(t),l.value[e].length>20&&(l.value[e]=l.value[e].slice(0,20)),oe(),console.log(`[Settings] 添加模型到历史: ${e} -> ${t}`)}function ze(e){return l.value[e]||[]}function He(e){l.value[e]&&(delete l.value[e],oe(),console.log(`[Settings] 清除模型历史: ${e}`))}function Ge(e){u.value.includes(e)||(u.value.push(e),u.value.sort((t,n)=>t-n),ee(),console.log(`已添加自定义字号预设: ${e}`))}function Ye(e){const t=u.value.indexOf(e);t!==-1&&(u.value.splice(t,1),ee(),console.log(`已删除自定义字号预设: ${e}`))}function c(){try{const e=JSON.stringify(o.value);localStorage.setItem(H,e)}catch(e){console.error("保存设置到 localStorage 失败:",e)}}const Xe="saber_translator_settings";function W(){try{let e=localStorage.getItem(H);if(!e){const t=localStorage.getItem(Xe);t&&(console.log("[Settings] 检测到原版设置，正在迁移..."),e=t,localStorage.setItem(H,t),console.log("[Settings] 原版设置已迁移到新存储键"))}if(e){const t=JSON.parse(e);o.value=so(G(),t),Ze(),console.log("已从 localStorage 加载设置")}}catch(e){console.error("从 localStorage 加载设置失败:",e)}}function Ze(){const e=o.value.textStyle;e.fontSize=Number(e.fontSize)||25,e.strokeWidth=Number(e.strokeWidth)||3;const t=o.value.boxExpand;t.ratio=Number(t.ratio)||1,t.top=Number(t.top)||0,t.bottom=Number(t.bottom)||0,t.left=Number(t.left)||0,t.right=Number(t.right)||0;const n=o.value.preciseMask;n.dilateSize=Number(n.dilateSize)||5,n.boxExpandRatio=Number(n.boxExpandRatio)||1;const r=o.value.translation;r.rpmLimit=Number(r.rpmLimit)||B,r.maxRetries=Number(r.maxRetries)||D;const a=o.value.hqTranslation;a.batchSize=Number(a.batchSize)||10,a.sessionReset=Number(a.sessionReset)||50,a.rpmLimit=Number(a.rpmLimit)||60,a.maxRetries=Number(a.maxRetries)||K;const T=o.value.aiVisionOcr;T.rpmLimit=Number(T.rpmLimit)||I;const R=o.value.proofreading;R.maxRetries=Number(R.maxRetries)||M,r.provider==="baidu"&&(r.provider="baidu_translate"),r.provider==="youdao"&&(r.provider="youdao_translate"),i.value.translation.baidu&&(i.value.translation.baidu_translate={...i.value.translation.baidu},delete i.value.translation.baidu),i.value.translation.youdao&&(i.value.translation.youdao_translate={...i.value.translation.youdao},delete i.value.translation.youdao)}function Q(){try{localStorage.setItem(ie,s.value)}catch(e){console.error("保存主题到 localStorage 失败:",e)}}function k(){try{const e=localStorage.getItem(ie);(e==="light"||e==="dark")&&(s.value=e,L(),console.log(`已从 localStorage 加载主题: ${s.value}`))}catch(e){console.error("从 localStorage 加载主题失败:",e)}}function ee(){try{const e=JSON.stringify(u.value);localStorage.setItem("customFontSizePresets",e)}catch(e){console.error("保存自定义字号预设失败:",e)}}function U(){try{const e=JSON.stringify(i.value);localStorage.setItem(re,e)}catch(e){console.error("保存服务商配置缓存失败:",e)}}function We(){try{const e=localStorage.getItem(re);if(e){const t=JSON.parse(e);i.value={translation:t.translation||{},hqTranslation:t.hqTranslation||{},aiVisionOcr:t.aiVisionOcr||{}},console.log("已从 localStorage 加载服务商配置缓存")}}catch(e){console.error("加载服务商配置缓存失败:",e)}}function oe(){try{const e=JSON.stringify(l.value);localStorage.setItem(se,e)}catch(e){console.error("保存模型历史记录失败:",e)}}function Qe(){try{const e=localStorage.getItem(se);e&&(l.value=JSON.parse(e),console.log("已从 localStorage 加载模型历史记录"))}catch(e){console.error("加载模型历史记录失败:",e)}}function ke(){try{const e=localStorage.getItem("customFontSizePresets");e&&(u.value=JSON.parse(e))}catch(e){console.error("加载自定义字号预设失败:",e)}}function eo(){W(),k(),ke(),We(),Qe()}async function oo(){try{console.log("[Settings] 开始从后端加载设置...");const{getUserSettings:e}=await E(async()=>{const{getUserSettings:n}=await import("./config.CwRcCkM9.js");return{getUserSettings:n}},__vite__mapDeps([0,1,2])),t=await e();if(console.log("[Settings] API 响应:",t),t.success&&t.settings){const n=t.settings;return console.log("[Settings] 从后端加载设置:",n),console.log("[Settings] 设置字段数量:",Object.keys(n).length),to(n),c(),U(),console.log("[Settings] 后端设置已应用，当前翻译服务商:",o.value.translation.provider),console.log("[Settings] 当前翻译 API Key:",o.value.translation.apiKey?"已设置":"未设置"),!0}else return console.warn("[Settings] 后端无设置数据，使用 localStorage 或默认值",t),!1}catch(e){return console.error("[Settings] 从后端加载设置失败:",e),!1}}function to(e){const t=(n,r)=>{if(n==null||n==="")return r;const a=typeof n=="string"?parseFloat(n):Number(n);return isNaN(a)?r:a};if(e.ocrEngine&&(o.value.ocrEngine=e.ocrEngine),e.sourceLanguage&&(o.value.sourceLanguage=e.sourceLanguage),e.textDetector&&(o.value.textDetector=e.textDetector),e.baiduApiKey&&(o.value.baiduOcr.apiKey=e.baiduApiKey),e.baiduSecretKey&&(o.value.baiduOcr.secretKey=e.baiduSecretKey),e.baiduVersion&&(o.value.baiduOcr.version=e.baiduVersion),e.baiduSourceLanguage&&(o.value.baiduOcr.sourceLanguage=e.baiduSourceLanguage),e.aiVisionProvider&&(o.value.aiVisionOcr.provider=e.aiVisionProvider),e.aiVisionApiKey&&(o.value.aiVisionOcr.apiKey=e.aiVisionApiKey),e.aiVisionModelName&&(o.value.aiVisionOcr.modelName=e.aiVisionModelName),e.aiVisionOcrPrompt&&(o.value.aiVisionOcr.prompt=e.aiVisionOcrPrompt),e.customAiVisionBaseUrl&&(o.value.aiVisionOcr.customBaseUrl=e.customAiVisionBaseUrl),e.rpmAiVisionOcr!==void 0&&(o.value.aiVisionOcr.rpmLimit=t(e.rpmAiVisionOcr,I)),e.aiVisionPromptModeSelect==="json"&&(o.value.aiVisionOcr.isJsonMode=!0),e.modelProvider&&(o.value.translation.provider=e.modelProvider),e.apiKey&&(o.value.translation.apiKey=e.apiKey),e.modelName&&(o.value.translation.modelName=e.modelName),e.customBaseUrl&&(o.value.translation.customBaseUrl=e.customBaseUrl),e.rpmTranslation!==void 0&&(o.value.translation.rpmLimit=t(e.rpmTranslation,B)),e.translationMaxRetries!==void 0&&(o.value.translation.maxRetries=t(e.translationMaxRetries,D)),e.translatePromptModeSelect==="json"&&(o.value.translation.isJsonMode=!0),e.promptContent&&(o.value.translatePrompt=e.promptContent),e.enableTextboxPrompt!==void 0&&(o.value.useTextboxPrompt=e.enableTextboxPrompt),e.textboxPromptContent&&(o.value.textboxPrompt=e.textboxPromptContent),e.hqTranslateProvider&&(o.value.hqTranslation.provider=e.hqTranslateProvider),e.hqApiKey&&(o.value.hqTranslation.apiKey=e.hqApiKey),e.hqModelName&&(o.value.hqTranslation.modelName=e.hqModelName),e.hqCustomBaseUrl&&(o.value.hqTranslation.customBaseUrl=e.hqCustomBaseUrl),e.hqBatchSize!==void 0&&(o.value.hqTranslation.batchSize=t(e.hqBatchSize,3)),e.hqSessionReset!==void 0&&(o.value.hqTranslation.sessionReset=t(e.hqSessionReset,20)),e.hqRpmLimit!==void 0&&(o.value.hqTranslation.rpmLimit=t(e.hqRpmLimit,7)),e.hqMaxRetries!==void 0&&(o.value.hqTranslation.maxRetries=t(e.hqMaxRetries,K)),e.hqPrompt&&(o.value.hqTranslation.prompt=e.hqPrompt),e.hqLowReasoning!==void 0&&(o.value.hqTranslation.lowReasoning=e.hqLowReasoning),e.hqNoThinkingMethod&&(o.value.hqTranslation.noThinkingMethod=e.hqNoThinkingMethod),e.hqForceJsonOutput!==void 0&&(o.value.hqTranslation.forceJsonOutput=e.hqForceJsonOutput),e.hqUseStream!==void 0&&(o.value.hqTranslation.useStream=e.hqUseStream),e.proofreadingEnabled!==void 0&&(o.value.proofreading.enabled=e.proofreadingEnabled),e.proofreadingMaxRetries!==void 0&&(o.value.proofreading.maxRetries=t(e.proofreadingMaxRetries,M)),e.proofreading&&typeof e.proofreading=="object"){const n=e.proofreading;n.enabled!==void 0&&(o.value.proofreading.enabled=n.enabled),n.maxRetries!==void 0&&(o.value.proofreading.maxRetries=t(n.maxRetries,M)),Array.isArray(n.rounds)&&(o.value.proofreading.rounds=n.rounds.map(r=>({name:r.name||"轮次",provider:r.provider||"siliconflow",apiKey:r.apiKey||"",modelName:r.modelName||"",customBaseUrl:r.customBaseUrl||"",prompt:r.prompt||"",batchSize:t(r.batchSize,3),sessionReset:t(r.sessionReset,20),rpmLimit:t(r.rpmLimit,7),maxRetries:t(r.maxRetries,M),lowReasoning:r.lowReasoning||!1,noThinkingMethod:r.noThinkingMethod||"gemini",forceJsonOutput:r.forceJsonOutput||!1})))}if(e.boxExpandRatio!==void 0&&(o.value.boxExpand.ratio=t(e.boxExpandRatio,0)),e.boxExpandTop!==void 0&&(o.value.boxExpand.top=t(e.boxExpandTop,0)),e.boxExpandBottom!==void 0&&(o.value.boxExpand.bottom=t(e.boxExpandBottom,0)),e.boxExpandLeft!==void 0&&(o.value.boxExpand.left=t(e.boxExpandLeft,0)),e.boxExpandRight!==void 0&&(o.value.boxExpand.right=t(e.boxExpandRight,0)),e.usePreciseMask!==void 0&&(o.value.preciseMask.enabled=e.usePreciseMask),e.maskDilateSize!==void 0&&(o.value.preciseMask.dilateSize=t(e.maskDilateSize,5)),e.maskBoxExpandRatio!==void 0&&(o.value.preciseMask.boxExpandRatio=t(e.maskBoxExpandRatio,0)),e.pdfProcessingMethod&&(o.value.pdfProcessingMethod=e.pdfProcessingMethod),e.showDetectionDebug!==void 0&&(o.value.showDetectionDebug=e.showDetectionDebug),e.providerSettings&&typeof e.providerSettings=="object"){const n=e.providerSettings;if(n.modelProvider)for(const[r,a]of Object.entries(n.modelProvider))i.value.translation[r]={apiKey:a.apiKey,modelName:a.modelName,customBaseUrl:a.customBaseUrl,rpmLimit:t(a.rpmTranslation,B),maxRetries:t(a.translationMaxRetries,D)};if(n.hqTranslateProvider)for(const[r,a]of Object.entries(n.hqTranslateProvider))i.value.hqTranslation[r]={apiKey:a.hqApiKey,modelName:a.hqModelName,customBaseUrl:a.hqCustomBaseUrl,batchSize:t(a.hqBatchSize,3),sessionReset:t(a.hqSessionReset,20),rpmLimit:t(a.hqRpmLimit,7),maxRetries:t(a.hqMaxRetries,K),lowReasoning:a.hqLowReasoning,noThinkingMethod:a.hqNoThinkingMethod||"gemini",forceJsonOutput:a.hqForceJsonOutput,useStream:a.hqUseStream,prompt:a.hqPrompt};if(n.aiVisionProvider)for(const[r,a]of Object.entries(n.aiVisionProvider))i.value.aiVisionOcr[r]={apiKey:a.aiVisionApiKey,modelName:a.aiVisionModelName,customBaseUrl:a.customAiVisionBaseUrl,prompt:a.aiVisionOcrPrompt,rpmLimit:t(a.rpmAiVisionOcr,I),isJsonMode:a.aiVisionPromptModeSelect==="json"}}console.log("[Settings] 后端设置映射完成")}function ao(){const e={},t={},n={};for(const[r,a]of Object.entries(i.value.translation))e[r]={apiKey:a.apiKey||"",modelName:a.modelName||"",customBaseUrl:a.customBaseUrl||"",rpmTranslation:String(a.rpmLimit||0),translationMaxRetries:String(a.maxRetries||3)};for(const[r,a]of Object.entries(i.value.hqTranslation))t[r]={hqApiKey:a.apiKey||"",hqModelName:a.modelName||"",hqCustomBaseUrl:a.customBaseUrl||"",hqBatchSize:String(a.batchSize||3),hqSessionReset:String(a.sessionReset||20),hqRpmLimit:String(a.rpmLimit||7),hqMaxRetries:String(a.maxRetries||2),hqLowReasoning:a.lowReasoning||!1,hqNoThinkingMethod:a.noThinkingMethod||"gemini",hqForceJsonOutput:a.forceJsonOutput??!0,hqUseStream:a.useStream||!1,hqPrompt:a.prompt||""};for(const[r,a]of Object.entries(i.value.aiVisionOcr))n[r]={aiVisionApiKey:a.apiKey||"",aiVisionModelName:a.modelName||"",customAiVisionBaseUrl:a.customBaseUrl||"",aiVisionOcrPrompt:a.prompt||"",rpmAiVisionOcr:String(a.rpmLimit||0),aiVisionPromptModeSelect:a.isJsonMode?"json":"normal"};return{ocrEngine:{},aiVisionProvider:n,modelProvider:e,hqTranslateProvider:t}}async function io(){try{const{saveUserSettings:e}=await E(async()=>{const{saveUserSettings:r}=await import("./config.CwRcCkM9.js");return{saveUserSettings:r}},__vite__mapDeps([0,1,2]));A(o.value.translation.provider),b(o.value.hqTranslation.provider),V(o.value.aiVisionOcr.provider);const t={ocrEngine:o.value.ocrEngine,sourceLanguage:o.value.sourceLanguage,textDetector:o.value.textDetector,baiduApiKey:o.value.baiduOcr.apiKey,baiduSecretKey:o.value.baiduOcr.secretKey,baiduVersion:o.value.baiduOcr.version,baiduSourceLanguage:o.value.baiduOcr.sourceLanguage,aiVisionProvider:o.value.aiVisionOcr.provider,aiVisionApiKey:o.value.aiVisionOcr.apiKey,aiVisionModelName:o.value.aiVisionOcr.modelName,aiVisionOcrPrompt:o.value.aiVisionOcr.prompt,customAiVisionBaseUrl:o.value.aiVisionOcr.customBaseUrl,rpmAiVisionOcr:String(o.value.aiVisionOcr.rpmLimit),aiVisionPromptModeSelect:o.value.aiVisionOcr.isJsonMode?"json":"normal",modelProvider:o.value.translation.provider,apiKey:o.value.translation.apiKey,modelName:o.value.translation.modelName,customBaseUrl:o.value.translation.customBaseUrl,rpmTranslation:String(o.value.translation.rpmLimit),translationMaxRetries:String(o.value.translation.maxRetries),translatePromptModeSelect:o.value.translation.isJsonMode?"json":"normal",promptContent:o.value.translatePrompt,enableTextboxPrompt:o.value.useTextboxPrompt,textboxPromptContent:o.value.textboxPrompt,hqTranslateProvider:o.value.hqTranslation.provider,hqApiKey:o.value.hqTranslation.apiKey,hqModelName:o.value.hqTranslation.modelName,hqCustomBaseUrl:o.value.hqTranslation.customBaseUrl,hqBatchSize:String(o.value.hqTranslation.batchSize),hqSessionReset:String(o.value.hqTranslation.sessionReset),hqRpmLimit:String(o.value.hqTranslation.rpmLimit),hqMaxRetries:String(o.value.hqTranslation.maxRetries),hqPrompt:o.value.hqTranslation.prompt,hqLowReasoning:o.value.hqTranslation.lowReasoning,hqNoThinkingMethod:o.value.hqTranslation.noThinkingMethod,hqForceJsonOutput:o.value.hqTranslation.forceJsonOutput,hqUseStream:o.value.hqTranslation.useStream,proofreadingEnabled:o.value.proofreading.enabled,proofreadingMaxRetries:String(o.value.proofreading.maxRetries),proofreading:{enabled:o.value.proofreading.enabled,maxRetries:String(o.value.proofreading.maxRetries),rounds:o.value.proofreading.rounds.map(r=>({name:r.name,provider:r.provider,apiKey:r.apiKey,modelName:r.modelName,customBaseUrl:r.customBaseUrl,prompt:r.prompt,batchSize:r.batchSize,sessionReset:r.sessionReset,rpmLimit:r.rpmLimit,lowReasoning:r.lowReasoning,forceJsonOutput:r.forceJsonOutput}))},boxExpandRatio:String(o.value.boxExpand.ratio),boxExpandTop:String(o.value.boxExpand.top),boxExpandBottom:String(o.value.boxExpand.bottom),boxExpandLeft:String(o.value.boxExpand.left),boxExpandRight:String(o.value.boxExpand.right),usePreciseMask:o.value.preciseMask.enabled,maskDilateSize:String(o.value.preciseMask.dilateSize),maskBoxExpandRatio:String(o.value.preciseMask.boxExpandRatio||0),pdfProcessingMethod:o.value.pdfProcessingMethod,showDetectionDebug:o.value.showDetectionDebug,providerSettings:ao()},n=await e(t);return n.success?(console.log("[Settings] 设置已保存到后端"),!0):(console.error("[Settings] 保存设置到后端失败:",n),!1)}catch(e){return console.error("[Settings] 保存设置到后端出错:",e),!1}}function ro(){o.value=G(),c(),console.log("设置已重置为默认值")}function so(e,t){const n={...e};for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const a=r,T=t[a],R=n[a];T!=null&&typeof T=="object"&&!Array.isArray(T)&&R!==null&&typeof R=="object"&&!Array.isArray(R)?n[a]={...R,...T}:T!==void 0&&(n[a]=T)}return n}return{settings:o,theme:s,providerConfigs:i,customFontPresets:u,textStyle:m,ocrEngine:p,sourceLanguage:d,translationProvider:P,hqProvider:h,isProofreadingEnabled:O,isDarkTheme:x,updateSettings:g,updateTextStyle:C,setOcrEngine:J,setTextDetector:fe,setSourceLanguage:ve,updateBaiduOcr:he,updateAiVisionOcr:ge,setTranslationProvider:Oe,updateTranslationService:xe,setTranslatePrompt:Re,setTextboxPrompt:_e,setUseTextboxPrompt:ye,setTranslatePromptMode:qe,setAiVisionOcrPromptMode:Ee,setHqProvider:Se,updateHqTranslation:Pe,setHqUseStream:Ne,setHqNoThinkingMethod:Me,setHqForceJsonOutput:Le,setProofreadingEnabled:Ae,addProofreadingRound:be,updateProofreadingRound:Ve,removeProofreadingRound:Ue,setProofreadingMaxRetries:Be,updateBoxExpand:Ie,updatePreciseMask:De,setPdfProcessingMethod:Ke,setShowDetectionDebug:Fe,toggleTheme:we,setTheme:Ce,applyTheme:L,saveProviderConfig:Je,restoreProviderConfig:je,saveTranslationProviderConfig:A,restoreTranslationProviderConfig:j,saveHqProviderConfig:b,restoreHqProviderConfig:$,saveAiVisionOcrProviderConfig:V,restoreAiVisionOcrProviderConfig:z,setAiVisionOcrProvider:Te,modelHistory:l,addModelToHistory:$e,getModelHistory:ze,clearModelHistory:He,addCustomFontPreset:Ge,removeCustomFontPreset:Ye,saveToStorage:c,loadFromStorage:W,loadThemeFromStorage:k,initSettings:eo,resetToDefaults:ro,loadFromBackend:oo,saveToBackend:io}}),ht=Object.freeze(Object.defineProperty({__proto__:null,useSettingsStore:me},Symbol.toStringTag,{value:"Module"})),v=y([]);let pe=0;const Jo=3e4,F=o=>{o.timer&&(clearTimeout(o.timer),o.timer=void 0)},S=(o,s="info",i=3e3)=>{const l=++pe,u=`msg_${Date.now()}_${Math.floor(Math.random()*1e3)}`,m={id:l,messageId:u,message:o,type:s,isHTML:!1};return i>0&&(m.timer=setTimeout(()=>{X(l)},i)),v.value.push(m),l},X=o=>{const s=v.value.findIndex(i=>i.id===o);if(s!==-1){const i=v.value[s];i&&F(i),v.value.splice(s,1)}},Z=()=>{v.value.forEach(o=>{F(o)}),v.value=[]},jo=(o,s)=>S(o,"success",s),$o=(o,s)=>S(o,"error",s),zo=(o,s)=>S(o,"info",s),Ho=(o,s)=>S(o,"warning",s),Go=(o,s="info",i=!1,l=5e3,u="")=>{const m=u||`msg_${Date.now()}_${Math.floor(Math.random()*1e3)}`;Z();const p=++pe,d={id:p,messageId:m,message:o,type:s,isHTML:i},P=Math.max(l,Jo);return d.timer=setTimeout(()=>{X(p)},l>0?l:P),v.value.push(d),m},Yo=o=>{if(!o)return;const s=v.value.findIndex(i=>i.messageId===o);if(s!==-1){const i=v.value[s];i&&F(i),v.value.splice(s,1)}},Xo=(o="")=>{if(o==="")Z();else{const s=[];v.value.forEach((i,l)=>{i.type===o&&(F(i),s.push(l))});for(let i=s.length-1;i>=0;i--){const l=s[i];l!==void 0&&v.value.splice(l,1)}}},f={toasts:v,addToast:S,removeToast:X,clearAll:Z,success:jo,error:$o,info:zo,warning:Ho,showGeneralMessage:Go,clearGeneralMessageById:Yo,clearAllGeneralMessages:Xo};function gt(){return f}function Tt(o,s="info",i=3e3){return S(o,s,i)}const Zo={class:"vue-toast-container"},Wo=["innerHTML"],Qo={key:1},ko=["onClick"],et=ne({__name:"ToastNotification",setup(o,{expose:s}){const i=f.toasts,l=u=>{f.removeToast(u)};return lo(()=>{f.clearAll()}),s({toasts:i,addToast:f.addToast,removeToast:f.removeToast,clearAll:f.clearAll,success:f.success,error:f.error,info:f.info,warning:f.warning,showGeneralMessage:f.showGeneralMessage,clearGeneralMessageById:f.clearGeneralMessageById,clearAllGeneralMessages:f.clearAllGeneralMessages}),(u,m)=>(q(),uo(po,{to:"body"},[te("div",Zo,[Y(co,{name:"toast-slide"},{default:mo(()=>[(q(!0),N(le,null,fo(ue(i),p=>(q(),N("div",{key:p.id,class:vo(["vue-toast-message","vue-toast-"+p.type])},[p.isHTML?(q(),N("span",{key:0,innerHTML:p.message},null,8,Wo)):(q(),N("span",Qo,ho(p.message),1)),te("button",{class:"vue-toast-close",onClick:go(d=>l(p.id),["stop"])},"×",8,ko)],2))),128))]),_:1})])]))}}),ot=(o,s)=>{const i=o.__vccOpts||o;for(const[l,u]of s)i[l]=u;return i},tt=ot(et,[["__scopeId","data-v-97906015"]]),at=ne({__name:"App",setup(o){const s=me();return To(()=>{s.initSettings()}),(i,l)=>(q(),N(le,null,[Y(ue(Oo)),Y(tt)],64))}}),it=[{path:"/",name:"bookshelf",component:()=>E(()=>import("./BookshelfView.CBSMxH0K.js"),__vite__mapDeps([3,4,5,6,1,2,7,8,9,10])),meta:{title:"书架"}},{path:"/translate",name:"translate",component:()=>E(()=>import("./TranslateView.qDsgRVVY.js"),__vite__mapDeps([11,5,7,1,2,0,12,13,8,9,6,14])),meta:{title:"翻译"},props:o=>({bookId:o.query.book,chapterId:o.query.chapter})},{path:"/reader",name:"reader",component:()=>E(()=>import("./ReaderView.Binp9gq3.js"),__vite__mapDeps([15,5,6,1,2,16])),meta:{title:"阅读器"},props:o=>({bookId:o.query.book,chapterId:o.query.chapter}),beforeEnter:(o,s,i)=>{!o.query.book||!o.query.chapter?i({name:"bookshelf"}):i()}},{path:"/insight",name:"insight",component:()=>E(()=>import("./InsightView.D7YccWYu.js"),__vite__mapDeps([17,5,4,6,1,2,12,13,8,9,0,18])),meta:{title:"漫画分析"},props:o=>({bookId:o.query.book})},{path:"/:pathMatch(.*)*",redirect:{name:"bookshelf"}}],de=xo({history:Ro("/static/vue/"),routes:it});de.beforeEach((o,s,i)=>{const l=o.meta.title;document.title=l?`${l} - Saber Translator`:"Saber Translator",i()});const w=_o(at),rt=yo();w.use(rt);w.use(de);w.config.errorHandler=(o,s,i)=>{console.error("Vue 错误:",o,i)};w.mount("#app");export{dt as B,Vo as D,ut as F,vt as L,ot as _,E as a,bo as b,Ao as c,So as d,gt as e,Mo as f,ce as g,No as h,Po as i,Lo as j,nt as k,pt as l,ft as m,mt as n,ct as o,lt as p,ht as q,Tt as s,me as u};
