import{d as xs,r as w,c as L,a as ye,i as d,f as ne,h as c,I as Ke,e,v as I,b as De,n as F,t as x,x as $s,u as pe,y as D,z as H,l as ze,B as Y,F as X,j as se,k as ue,H as Te,J as qt,w as Ge,K as Cs,o as Ss,D as Ps,E as yt,C as As}from"./vue-vendor.BToK7iAN.js";import{u as Ft,_ as Ts}from"./bookshelfStore.DRMKtdSW.js";import{_ as ve}from"./CustomSelect.vue_vue_type_style_index_0_lang.CWP4Q_ni.js";import{_ as xe}from"./index.D0MSxQDE.js";import{apiClient as ee}from"./client.Bht704G-.js";import{B as Is}from"./BaseModal.Chcbe_b7.js";import"./bookshelf.C_zUWUVG.js";import"./utils-vendor.B9ygI19o.js";async function Bs(a,t){return ee.post(`/api/manga-insight/${a}/analyze/start`,t)}async function Rs(a){return ee.post(`/api/manga-insight/${a}/analyze/pause`)}async function zs(a){return ee.post(`/api/manga-insight/${a}/analyze/resume`)}async function Ls(a){return ee.post(`/api/manga-insight/${a}/analyze/cancel`)}async function Us(a){return ee.get(`/api/manga-insight/${a}/analyze/status`)}async function Qt(a,t){return ee.post(`/api/manga-insight/${a}/reanalyze/page/${t}`)}async function Ms(a,t){return ee.get(`/api/manga-insight/${a}/pages/${t}`)}function qs(a,t){return`/api/manga-insight/${a}/page-image/${t}`}function Ht(a,t){return`/api/manga-insight/${a}/thumbnail/${t}`}async function Vs(a){return ee.get(`/api/manga-insight/${a}/chapters`)}async function Zt(a,t){return t?ee.get(`/api/manga-insight/${a}/overview/${t}`):ee.get(`/api/manga-insight/${a}/overview`)}async function Es(a,t,l=!1){return ee.post(`/api/manga-insight/${a}/overview/generate`,{template:t,force:l})}async function Gt(a){return ee.get(`/api/manga-insight/${a}/overview/templates`)}async function Jt(a){return ee.get(`/api/manga-insight/${a}/timeline`)}async function Os(a){return ee.post(`/api/manga-insight/${a}/regenerate/timeline`,{})}async function Ds(){return ee.get("/api/manga-insight/config")}async function Ns(a){return ee.post("/api/manga-insight/config",a)}async function Ks(a){return ee.post("/api/manga-insight/config/test/vlm",a)}async function js(a){return ee.post("/api/manga-insight/config/test/embedding",a)}async function Fs(a){return ee.post("/api/manga-insight/config/test/reranker",a)}const Vt={batch_analysis:{label:"ğŸ“„ æ‰¹é‡åˆ†ææç¤ºè¯",hint:"ç”¨äºæ‰¹é‡åˆ†æå¤šä¸ªé¡µé¢ã€‚æ”¯æŒå˜é‡ï¼š{page_count}, {start_page}, {end_page}"},segment_summary:{label:"ğŸ“‘ æ®µè½æ€»ç»“æç¤ºè¯",hint:"ç”¨äºæ±‡æ€»å¤šä¸ªæ‰¹æ¬¡çš„åˆ†æç»“æœç”Ÿæˆæ®µè½æ€»ç»“ã€‚"},chapter_summary:{label:"ğŸ“– ç« èŠ‚æ€»ç»“æç¤ºè¯",hint:"ç”¨äºç”Ÿæˆç« èŠ‚çº§åˆ«çš„å®Œæ•´æ€»ç»“ã€‚"},qa_response:{label:"ğŸ’¬ é—®ç­”å“åº”æç¤ºè¯",hint:"ç”¨äºå›ç­”ç”¨æˆ·å…³äºæ¼«ç”»å†…å®¹çš„é—®é¢˜ã€‚"}},_t={batch_analysis:`ã€è¾“å‡ºä¸­æ–‡ã€‘åˆ†æä»¥ä¸‹ {page_count} é¡µæ¼«ç”»å†…å®¹ï¼ˆç¬¬ {start_page} é¡µåˆ°ç¬¬ {end_page} é¡µï¼‰ã€‚

è¯·æå–ä»¥ä¸‹ä¿¡æ¯ï¼Œä»¥ JSON æ ¼å¼è¾“å‡ºï¼š
{
    "pages": [
        {
            "page_num": <é¡µç >,
            "summary": "<è¯¥é¡µå†…å®¹æ¦‚è¿°ï¼Œ2-3å¥è¯>",
            "dialogues": [
                {"character": "<è§’è‰²åæˆ–'æ—ç™½'>", "text": "<å¯¹è¯å†…å®¹>"}
            ],
            "scene": "<åœºæ™¯æè¿°>",
            "mood": "<æ°›å›´/æƒ…ç»ª>"
        }
    ],
    "batch_summary": "<è¿™å‡ é¡µçš„æ•´ä½“æ¦‚è¿°ï¼Œ3-5å¥è¯>",
    "key_events": ["<å…³é”®äº‹ä»¶1>", "<å…³é”®äº‹ä»¶2>"]
}

è¦æ±‚ï¼š
1. å‡†ç¡®è¯†åˆ«å¯¹è¯å†…å®¹å’Œè¯´è¯è€…
2. æ³¨æ„ç”»é¢ä¸­çš„æ–‡å­—ã€éŸ³æ•ˆ
3. æè¿°é‡è¦çš„è§†è§‰å…ƒç´ å’Œè¡¨æƒ…`,segment_summary:`ã€è¾“å‡ºä¸­æ–‡ã€‘åŸºäºä»¥ä¸‹æ‰¹æ¬¡åˆ†æç»“æœï¼Œç”Ÿæˆæ®µè½æ€»ç»“ã€‚

è¯·ç”Ÿæˆæ®µè½æ€»ç»“ï¼ŒJSON æ ¼å¼ï¼š
{
    "summary": "<æ®µè½æ•´ä½“æ¦‚è¿°ï¼Œ3-5å¥è¯>",
    "plot_points": ["<å‰§æƒ…è¦ç‚¹1>", "<å‰§æƒ…è¦ç‚¹2>"],
    "character_developments": ["<è§’è‰²å‘å±•1>"],
    "themes": ["<ä¸»é¢˜1>"]
}

è¦æ±‚ï¼š
1. ç»¼åˆå¤šä¸ªæ‰¹æ¬¡çš„ä¿¡æ¯
2. çªå‡ºé‡è¦è§’è‰²å’Œå…³é”®äº‹ä»¶
3. æ³¨æ„å‰§æƒ…çš„å› æœå…³ç³»`,chapter_summary:`ã€è¾“å‡ºä¸­æ–‡ã€‘åŸºäºä»¥ä¸‹å†…å®¹ï¼Œç”Ÿæˆå®Œæ•´çš„ç« èŠ‚æ€»ç»“ã€‚

è¯·ç”Ÿæˆç« èŠ‚æ€»ç»“ï¼ŒJSON æ ¼å¼ï¼š
{
    "summary": "<ç« èŠ‚æ•´ä½“æ¦‚è¿°ï¼Œ5-8å¥è¯>",
    "main_plot": "<ä¸»è¦å‰§æƒ…çº¿æè¿°>",
    "key_events": ["<ç« èŠ‚å…³é”®äº‹ä»¶ï¼ŒæŒ‰é¡ºåº>"],
    "themes": ["<æœ¬ç« ä¸»é¢˜>"],
    "atmosphere": "<æ•´ä½“æ°›å›´>"
}

è¦æ±‚ï¼š
1. ç»¼åˆæ‰€æœ‰å†…å®¹ï¼Œå½¢æˆå®Œæ•´çš„ç« èŠ‚å™è¿°
2. ç†æ¸…äººç‰©å…³ç³»å’Œå‰§æƒ…è„‰ç»œ
3. æç‚¼ç« èŠ‚ä¸»é¢˜å’Œæ ¸å¿ƒå†²çª`,qa_response:`ã€è¾“å‡ºä¸­æ–‡ã€‘æ ¹æ®åˆ†æç»“æœå›ç­”ç”¨æˆ·é—®é¢˜ï¼Œå¼•ç”¨ç›¸å…³é¡µé¢ã€‚
å›ç­”æ—¶è¯·ï¼š
1. åŸºäºæä¾›çš„æ¼«ç”»å†…å®¹å›ç­”
2. å¼•ç”¨å…·ä½“é¡µç ä½œä¸ºä¾æ®
3. å¦‚æœé—®é¢˜è¶…å‡ºå·²åˆ†æå†…å®¹ï¼Œè¯·è¯šå®è¯´æ˜`};async function Qs(){return ee.get("/api/manga-insight/prompts/library")}async function Hs(a){return ee.post("/api/manga-insight/prompts/library",a)}async function Zs(a){return ee.delete(`/api/manga-insight/prompts/library/${a}`)}async function Gs(a){return ee.post("/api/manga-insight/prompts/library/import",{library:a})}async function Wt(a){return ee.get(`/api/manga-insight/${a}/export`)}const $e=xs("insight",()=>{const a=w(null),t=w("idle"),l=w({current:0,total:0,status:"idle"}),n=w(0),s=w(0),o=w("full"),i=w(!0),v=w([]),u=w(new Map),k=w(null),f=w([]),R=w([]),T=w([]),z=w([]),U=w(null),V=w("all"),N=w(!1),j=w(!1),K=w(null),h=w({vlm:{provider:"gemini",apiKey:"",model:"gemini-2.0-flash",baseUrl:"",rpmLimit:10,temperature:.3,forceJson:!1,useStream:!0,imageMaxSize:0},llm:{useSameAsVlm:!0,provider:"gemini",apiKey:"",model:"gemini-2.0-flash",baseUrl:"",useStream:!0},embedding:{provider:"openai",apiKey:"",model:"text-embedding-3-small",baseUrl:"",rpmLimit:0},reranker:{provider:"jina",apiKey:"",model:"jina-reranker-v2-base-multilingual",baseUrl:"",topK:5},batch:{pagesPerBatch:5,contextBatchCount:1,architecturePreset:"standard",customLayers:[]}}),C=L(()=>l.value.total===0?0:Math.round(l.value.current/l.value.total*100)),b=L(()=>t.value==="running"),p=L(()=>t.value==="completed"),g=L(()=>{if(s.value>0)return s.value;let y=0;return u.value.forEach(O=>{O.analyzed&&y++}),y}),m=L(()=>n.value||u.value.size),E=L(()=>V.value==="all"?z.value:z.value.filter(y=>y.type===V.value)),M=L(()=>U.value===null?null:u.value.get(U.value)||null);function A(y){a.value=y,y?(console.log(`å½“å‰åˆ†æä¹¦ç±: ${y}`),console.log("å‡†å¤‡åŠ è½½ç¬”è®°..."),Qe()):z.value=[]}function $(y){t.value=y,l.value.status=y,console.log(`åˆ†æçŠ¶æ€: ${y}`)}function P(y,O,Z){l.value={current:y,total:O,status:t.value,message:Z}}function B(y){o.value=y}function q(y){i.value=y}function te(y){n.value=y,console.log(`ä¹¦ç±æ€»é¡µæ•°: ${y}`)}function le(y){s.value=y,console.log(`å·²åˆ†æé¡µæ•°: ${y}`)}function ce(y){v.value=y,console.log(`ç« èŠ‚åˆ—è¡¨å·²è®¾ç½®ï¼Œå…± ${y.length} ç« `)}function _e(y,O){u.value.set(y,O)}function ge(y){u.value.clear();for(const O of y)u.value.set(O.pageNum,O);console.log(`é¡µé¢æ•°æ®å·²è®¾ç½®ï¼Œå…± ${y.length} é¡µ`)}function Pe(y){U.value=y}function Re(y){k.value=y,y&&!f.value.includes(y.type)&&f.value.push(y.type)}function ie(y){f.value=y}function oe(y){R.value=y,console.log(`æ—¶é—´çº¿å·²è®¾ç½®ï¼Œå…± ${y.length} ä¸ªäº‹ä»¶`)}function me(y){T.value.push(y)}function re(y){const O=T.value[T.value.length-1];O&&O.role==="assistant"&&(O.content=y)}function Le(){T.value=[]}function Fe(){T.value=T.value.filter(y=>!y.isLoading)}function tt(y){j.value=y}function st(y){U.value=y}async function nt(y){if(await it(y))z.value.unshift(y),console.log(`å·²æ·»åŠ ç¬”è®°: ${y.id}`);else throw new Error("ä¿å­˜ç¬”è®°åˆ°åç«¯å¤±è´¥")}async function lt(y,O){const Z=z.value.find(he=>he.id===y);Z&&(Object.assign(Z,O,{updatedAt:new Date().toISOString()}),await rt(y,O),console.log(`å·²æ›´æ–°ç¬”è®°: ${y}`))}async function at(y){const O=z.value.findIndex(Z=>Z.id===y);O>=0&&(await ut(y)?(z.value.splice(O,1),console.log(`å·²åˆ é™¤ç¬”è®°: ${y}`)):console.error(`åˆ é™¤ç¬”è®°å¤±è´¥: ${y}`))}function ot(y){V.value=y}async function Qe(){if(console.log("loadNotesFromAPI è¢«è°ƒç”¨, bookId:",a.value),!!a.value)try{const O=await(await fetch(`/api/manga-insight/${a.value}/notes`)).json();console.log("ç¬”è®°APIå“åº”:",O),O.success&&O.notes?(z.value=O.notes,console.log(`å·²ä»APIåŠ è½½ ${z.value.length} æ¡ç¬”è®°`)):(console.log("APIè¿”å›æ— ç¬”è®°æ•°æ®"),z.value=[])}catch(y){console.error("ä»APIåŠ è½½ç¬”è®°å¤±è´¥:",y),z.value=[]}}async function it(y){if(!a.value)return!1;try{return(await(await fetch(`/api/manga-insight/${a.value}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})).json()).success}catch(O){return console.error("ä¿å­˜ç¬”è®°åˆ°APIå¤±è´¥:",O),!1}}async function rt(y,O){if(!a.value)return!1;try{return(await(await fetch(`/api/manga-insight/${a.value}/notes/${y}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)})).json()).success}catch(Z){return console.error("æ›´æ–°ç¬”è®°åˆ°APIå¤±è´¥:",Z),!1}}async function ut(y){if(!a.value)return!1;try{return(await(await fetch(`/api/manga-insight/${a.value}/notes/${y}`,{method:"DELETE"})).json()).success}catch(O){return console.error("ä»APIåˆ é™¤ç¬”è®°å¤±è´¥:",O),!1}}function ct(y){N.value=y}function dt(y){K.value=y}function pt(y){h.value.vlm={...h.value.vlm,...y},ke()}function vt(y){h.value.llm={...h.value.llm,...y},ke()}function gt(y){h.value.embedding={...h.value.embedding,...y},ke()}function mt(y){h.value.reranker={...h.value.reranker,...y},ke()}function Ce(y){h.value.batch={...h.value.batch,...y},ke()}function Ue(y){h.value=y,ke()}function ke(){localStorage.setItem("manga_insight_config",JSON.stringify(h.value))}function ht(){const O=localStorage.getItem("manga_insight_config");if(O)try{const Z=JSON.parse(O);h.value={vlm:{...h.value.vlm,...Z.vlm},llm:{...h.value.llm,...Z.llm},embedding:{...h.value.embedding,...Z.embedding},reranker:{...h.value.reranker,...Z.reranker},batch:{...h.value.batch,...Z.batch}},console.log("å·²åŠ è½½æ¼«ç”»åˆ†æé…ç½®")}catch(Z){console.error("åŠ è½½æ¼«ç”»åˆ†æé…ç½®å¤±è´¥:",Z)}}function Me(){return{vlm:{provider:h.value.vlm.provider,api_key:h.value.vlm.apiKey,model:h.value.vlm.model,base_url:h.value.vlm.baseUrl||null,rpm_limit:h.value.vlm.rpmLimit,temperature:h.value.vlm.temperature,force_json:h.value.vlm.forceJson,use_stream:h.value.vlm.useStream,image_max_size:h.value.vlm.imageMaxSize},chat_llm:{use_same_as_vlm:h.value.llm.useSameAsVlm,provider:h.value.llm.provider,api_key:h.value.llm.apiKey,model:h.value.llm.model,base_url:h.value.llm.baseUrl||null,use_stream:h.value.llm.useStream},embedding:{provider:h.value.embedding.provider,api_key:h.value.embedding.apiKey,model:h.value.embedding.model,base_url:h.value.embedding.baseUrl||null,rpm_limit:h.value.embedding.rpmLimit},reranker:{provider:h.value.reranker.provider,api_key:h.value.reranker.apiKey,model:h.value.reranker.model,base_url:h.value.reranker.baseUrl||null,top_k:h.value.reranker.topK},analysis:{batch:{pages_per_batch:h.value.batch.pagesPerBatch,context_batch_count:h.value.batch.contextBatchCount,architecture_preset:h.value.batch.architecturePreset,custom_layers:h.value.batch.customLayers.map(y=>({name:y.name,units_per_group:y.units,align_to_chapter:y.align}))}}}}function ft(y){const O=y.vlm,Z=y.chat_llm,he=y.embedding,Se=y.reranker,Ae=y.analysis?.batch;if(O&&(h.value.vlm={provider:O.provider||"gemini",apiKey:O.api_key||"",model:O.model||"",baseUrl:O.base_url||"",rpmLimit:O.rpm_limit||10,temperature:O.temperature||.3,forceJson:O.force_json||!1,useStream:O.use_stream!==!1,imageMaxSize:O.image_max_size||0}),Z&&(h.value.llm={useSameAsVlm:Z.use_same_as_vlm!==!1,provider:Z.provider||h.value.vlm.provider,apiKey:Z.api_key||h.value.vlm.apiKey,model:Z.model||h.value.vlm.model,baseUrl:Z.base_url||h.value.vlm.baseUrl,useStream:Z.use_stream!==!1}),he&&(h.value.embedding={provider:he.provider||"openai",apiKey:he.api_key||"",model:he.model||"",baseUrl:he.base_url||"",rpmLimit:he.rpm_limit??0}),Se&&(h.value.reranker={provider:Se.provider||"jina",apiKey:Se.api_key||"",model:Se.model||"",baseUrl:Se.base_url||"",topK:Se.top_k||5}),Ae){const J=Ae.custom_layers;h.value.batch={pagesPerBatch:Ae.pages_per_batch||5,contextBatchCount:Ae.context_batch_count??1,architecturePreset:Ae.architecture_preset||"standard",customLayers:J?.map(qe=>({name:qe.name||"",units:qe.units_per_group||1,align:qe.align_to_chapter||!1}))||[]}}ke(),console.log("å·²ä» API åŠ è½½é…ç½®")}function bt(){t.value="idle",l.value={current:0,total:0,status:"idle"},u.value.clear(),k.value=null,R.value=[],console.log("åˆ†æçŠ¶æ€å·²é‡ç½®")}function kt(){a.value=null,t.value="idle",l.value={current:0,total:0,status:"idle"},o.value="full",i.value=!0,v.value=[],u.value.clear(),k.value=null,f.value=[],R.value=[],T.value=[],z.value=[],U.value=null,V.value="all",N.value=!1,j.value=!1,K.value=null,console.log("æ¼«ç”»åˆ†æçŠ¶æ€å·²é‡ç½®")}return{currentBookId:a,analysisStatus:t,progress:l,analysisMode:o,incrementalAnalysis:i,chapters:v,pages:u,overview:k,generatedTemplates:f,timeline:R,qaHistory:T,notes:z,selectedPageNum:U,noteTypeFilter:V,isLoading:N,isStreaming:j,error:K,config:h,progressPercent:C,isAnalyzing:b,isAnalysisCompleted:p,analyzedPageCount:g,totalPageCount:m,filteredNotes:E,selectedPage:M,setCurrentBook:A,setAnalysisStatus:$,updateProgress:P,setAnalysisMode:B,setIncrementalAnalysis:q,setBookTotalPages:te,setAnalyzedPagesCount:le,setChapters:ce,setPageData:_e,setPages:ge,selectPage:Pe,setOverview:Re,setGeneratedTemplates:ie,setTimeline:oe,addQAMessage:me,updateLastAssistantMessage:re,clearQAHistory:Le,removeLoadingMessages:Fe,setStreaming:tt,setCurrentPage:st,addNote:nt,updateNote:lt,deleteNote:at,setNoteTypeFilter:ot,loadNotesFromAPI:Qe,setLoading:ct,setError:dt,updateVlmConfig:pt,updateLlmConfig:vt,updateEmbeddingConfig:gt,updateRerankerConfig:mt,updateBatchConfig:Ce,setConfig:Ue,saveConfigToStorage:ke,loadConfigFromStorage:ht,getConfigForApi:Me,setConfigFromApi:ft,resetAnalysis:bt,reset:kt}}),Js={class:"book-selector"},Ws=ye({__name:"BookSelector",emits:["select"],setup(a,{emit:t}){const l=t,n=Ft(),s=L(()=>n.books),o=L(()=>{const u=[{label:"-- é€‰æ‹©ä¹¦ç± --",value:""}];return s.value.forEach(k=>{u.push({label:k.title||k.id,value:k.id})}),u}),i=w("");function v(u){i.value=u,u&&l("select",u)}return(u,k)=>(c(),d("div",Js,[ne(ve,{modelValue:i.value,"onUpdate:modelValue":k[0]||(k[0]=f=>i.value=f),options:o.value,onChange:v},null,8,["modelValue","options"])]))}}),Xs=xe(Ws,[["__scopeId","data-v-004fb258"]]),Ys={class:"sidebar-section analysis-control-compact"},en={class:"analysis-status-bar"},tn={class:"status-left"},sn={class:"status-label"},nn={class:"status-right"},ln={class:"status-progress"},an={key:1,class:"progress-message"},on={class:"analysis-btn-group"},rn={key:0,class:"btn-group-idle"},un=["disabled"],cn={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},dn={key:1,class:"loading-spinner"},pn={key:1,class:"btn-group-running"},vn={key:2,class:"btn-group-paused"},gn={key:4,class:"page-input-wrapper"},mn=["max"],hn={class:"page-hint"},fn={key:5,class:"mode-description"},bn={key:6,class:"estimated-time"},kn={class:"analysis-options-row"},yn={class:"checkbox-compact",title:"ä»…åˆ†ææœªåˆ†æçš„é¡µé¢ï¼Œè·³è¿‡å·²åˆ†æçš„é¡µé¢"},_n=["checked"],wn=["disabled"],xn=ye({__name:"AnalysisProgress",emits:["start-polling","stop-polling"],setup(a,{emit:t}){const l=[{label:"å…¨ä¹¦",value:"full"},{label:"ç« èŠ‚",value:"chapter"},{label:"å•é¡µ",value:"page"}],n=L(()=>{const B=[{label:"é€‰æ‹©ç« èŠ‚...",value:""}];return o.chapters.forEach(q=>{B.push({label:`${q.title} (${q.startPage}-${q.endPage}é¡µ)`,value:q.id})}),B}),s=t,o=$e(),i=w("full"),v=w(""),u=w(null),k=w(!1),f=w(""),R=L(()=>{const B=o.analysisStatus;return{"status-dot":!0,running:B==="running",paused:B==="paused",completed:B==="completed",failed:B==="failed"}}),T=L(()=>{switch(o.analysisStatus){case"running":return"åˆ†æä¸­";case"paused":return"å·²æš‚åœ";case"completed":return"å·²å®Œæˆ";case"failed":return"åˆ†æå¤±è´¥";default:return"æœªåˆ†æ"}}),z=L(()=>{const{current:B,total:q}=o.progress;return q===0?"":`${B}/${q}`}),U=L(()=>o.analysisStatus==="idle"||o.analysisStatus==="completed"),V=L(()=>o.analysisStatus==="running"),N=L(()=>o.analysisStatus==="paused"),j=L(()=>o.analysisStatus==="completed"?"é‡æ–°åˆ†æ":"å¼€å§‹åˆ†æ"),K=L(()=>i.value==="chapter"),h=L(()=>i.value==="page"),C=L(()=>!(k.value||o.isAnalyzing||i.value==="chapter"&&!v.value||i.value==="page"&&!u.value)),b=L(()=>{switch(i.value){case"full":return"åˆ†ææ•´æœ¬ä¹¦çš„æ‰€æœ‰é¡µé¢";case"chapter":return"ä»…åˆ†æé€‰ä¸­ç« èŠ‚çš„é¡µé¢";case"page":return"ä»…åˆ†ææŒ‡å®šçš„å•ä¸ªé¡µé¢";default:return""}}),p=L(()=>{const B=o.totalPageCount;if(B===0)return"";const q=o.config.batch.pagesPerBatch||5,le=Math.ceil(B/q)*10;return le<60?`çº¦ ${le} ç§’`:`çº¦ ${Math.ceil(le/60)} åˆ†é’Ÿ`});function g(){o.setAnalysisMode(i.value)}async function m(){if(o.currentBookId){if(o.isAnalyzing||k.value){console.warn("åˆ†ææ­£åœ¨è¿›è¡Œä¸­æˆ–æ­£åœ¨å¯åŠ¨");return}if(i.value==="chapter"&&!v.value){f.value="è¯·é€‰æ‹©è¦åˆ†æçš„ç« èŠ‚";return}if(i.value==="page"&&!u.value){f.value="è¯·è¾“å…¥è¦åˆ†æçš„é¡µç ";return}k.value=!0,f.value="";try{const B={incremental:o.incrementalAnalysis};i.value==="chapter"&&v.value?(B.mode="chapter",B.chapter_id=v.value):i.value==="page"&&u.value?(B.mode="page",B.page_num=u.value):B.mode="full";const q=await Bs(o.currentBookId,B);q.success?(o.setAnalysisStatus("running"),s("start-polling")):(f.value=q.error||"å¯åŠ¨åˆ†æå¤±è´¥",console.error("å¯åŠ¨åˆ†æå¤±è´¥:",q.error))}catch(B){f.value=B instanceof Error?B.message:"å¯åŠ¨åˆ†æå¤±è´¥",console.error("å¯åŠ¨åˆ†æå¤±è´¥:",B)}finally{k.value=!1}}}async function E(){if(o.currentBookId)try{(await Rs(o.currentBookId)).success&&o.setAnalysisStatus("paused")}catch(B){console.error("æš‚åœåˆ†æå¤±è´¥:",B)}}async function M(){if(o.currentBookId)try{(await zs(o.currentBookId)).success&&(o.setAnalysisStatus("running"),s("start-polling"))}catch(B){console.error("ç»§ç»­åˆ†æå¤±è´¥:",B)}}async function A(){if(o.currentBookId&&confirm("ç¡®å®šè¦å–æ¶ˆåˆ†æå—ï¼Ÿ"))try{(await Ls(o.currentBookId)).success&&(o.setAnalysisStatus("idle"),s("stop-polling"))}catch(B){console.error("å–æ¶ˆåˆ†æå¤±è´¥:",B)}}async function $(){if(!o.currentBookId){f.value="è¯·å…ˆé€‰æ‹©ä¹¦ç±";return}try{const B=await Wt(o.currentBookId);if(B.success&&B.markdown){const q=new Blob([B.markdown],{type:"text/markdown"}),te=URL.createObjectURL(q),le=document.createElement("a");le.href=te,le.download=`${o.currentBookId}_analysis.md`,le.click(),URL.revokeObjectURL(te)}else f.value=B.error||"å¯¼å‡ºå¤±è´¥"}catch(B){f.value=B instanceof Error?B.message:"å¯¼å‡ºå¤±è´¥",console.error("å¯¼å‡ºå¤±è´¥:",B)}}function P(){f.value=""}return Ke(i,()=>{P()}),(B,q)=>(c(),d("div",Ys,[e("div",en,[e("div",tn,[e("span",{class:F(R.value)},null,2),e("span",sn,x(T.value),1)]),e("div",nn,[e("span",ln,x(z.value),1)])]),V.value||N.value?(c(),d("div",{key:0,class:F(["progress-bar-slim",{paused:N.value}])},[e("div",{class:"progress-fill-slim",style:$s({width:pe(o).progressPercent+"%"})},null,4)],2)):I("",!0),pe(o).progress.message&&(V.value||N.value)?(c(),d("div",an,x(pe(o).progress.message),1)):I("",!0),f.value?(c(),d("div",{key:2,class:"error-message",onClick:P}," âš ï¸ "+x(f.value),1)):I("",!0),e("div",on,[U.value?(c(),d("div",rn,[ne(ve,{modelValue:i.value,"onUpdate:modelValue":q[0]||(q[0]=te=>i.value=te),options:l,onChange:g},null,8,["modelValue"]),e("button",{class:F(["btn-analysis-start",{loading:k.value}]),disabled:!C.value,onClick:m},[k.value?I("",!0):(c(),d("svg",cn,[...q[4]||(q[4]=[e("path",{d:"M8 5v14l11-7z"},null,-1)])])),k.value?(c(),d("span",dn)):I("",!0),e("span",null,x(k.value?"å¯åŠ¨ä¸­...":j.value),1)],10,un)])):I("",!0),V.value?(c(),d("div",pn,[e("button",{class:"btn-control btn-pause",title:"æš‚åœåˆ†æ",onClick:E},[...q[5]||(q[5]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})],-1),e("span",{class:"btn-label"},"æš‚åœ",-1)])]),e("button",{class:"btn-control btn-cancel",title:"å–æ¶ˆåˆ†æ",onClick:A},[...q[6]||(q[6]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 6h12v12H6z"})],-1),e("span",{class:"btn-label"},"å–æ¶ˆ",-1)])])])):I("",!0),N.value?(c(),d("div",vn,[e("button",{class:"btn-control btn-resume",title:"ç»§ç»­åˆ†æ",onClick:M},[...q[7]||(q[7]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8 5v14l11-7z"})],-1),e("span",{class:"btn-label"},"ç»§ç»­",-1)])]),e("button",{class:"btn-control btn-cancel",title:"å–æ¶ˆåˆ†æ",onClick:A},[...q[8]||(q[8]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 6h12v12H6z"})],-1),e("span",{class:"btn-label"},"å–æ¶ˆ",-1)])])])):I("",!0)]),K.value?(c(),De(ve,{key:3,modelValue:v.value,"onUpdate:modelValue":q[1]||(q[1]=te=>v.value=te),options:n.value},null,8,["modelValue","options"])):I("",!0),h.value?(c(),d("div",gn,[D(e("input",{"onUpdate:modelValue":q[2]||(q[2]=te=>u.value=te),type:"number",class:"form-input-compact",placeholder:"è¾“å…¥é¡µç ",min:"1",max:pe(o).totalPageCount||void 0},null,8,mn),[[H,u.value,void 0,{number:!0}]]),e("span",hn,"/ "+x(pe(o).totalPageCount||"?"),1)])):I("",!0),U.value&&b.value?(c(),d("div",fn,x(b.value),1)):I("",!0),U.value&&i.value==="full"&&p.value?(c(),d("div",bn," â±ï¸ "+x(p.value),1)):I("",!0),e("div",kn,[e("label",yn,[e("input",{type:"checkbox",checked:pe(o).incrementalAnalysis,onChange:q[3]||(q[3]=te=>pe(o).setIncrementalAnalysis(te.target.checked))},null,40,_n),q[9]||(q[9]=e("span",null,"å¢é‡æ¨¡å¼",-1))]),e("button",{class:"btn-icon-sm",title:"å¯¼å‡ºåˆ†ææŠ¥å‘Š",disabled:pe(o).analyzedPageCount===0,onClick:$},[...q[10]||(q[10]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,wn)])]))}}),$n=xe(xn,[["__scopeId","data-v-d09eb7b3"]]);function Ct(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Be=Ct();function Xt(a){Be=a}var Ne={exec:()=>null};function Q(a,t=""){let l=typeof a=="string"?a:a.source,n={replace:(s,o)=>{let i=typeof o=="string"?o:o.source;return i=i.replace(ae.caret,"$1"),l=l.replace(s,i),n},getRegex:()=>new RegExp(l,t)};return n}var Cn=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),ae={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:a=>new RegExp(`^( {0,3}${a})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:a=>new RegExp(`^ {0,${Math.min(3,a-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:a=>new RegExp(`^ {0,${Math.min(3,a-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:a=>new RegExp(`^ {0,${Math.min(3,a-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:a=>new RegExp(`^ {0,${Math.min(3,a-1)}}#`),htmlBeginRegex:a=>new RegExp(`^ {0,${Math.min(3,a-1)}}<(?:[a-z].*>|!--)`,"i")},Sn=/^(?:[ \t]*(?:\n|$))+/,Pn=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,An=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,je=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Tn=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,St=/(?:[*+-]|\d{1,9}[.)])/,Yt=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,es=Q(Yt).replace(/bull/g,St).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),In=Q(Yt).replace(/bull/g,St).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Pt=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Bn=/^[^\n]+/,At=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Rn=Q(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",At).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),zn=Q(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,St).getRegex(),Ye="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Tt=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Ln=Q("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Tt).replace("tag",Ye).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),ts=Q(Pt).replace("hr",je).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ye).getRegex(),Un=Q(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",ts).getRegex(),It={blockquote:Un,code:Pn,def:Rn,fences:An,heading:Tn,hr:je,html:Ln,lheading:es,list:zn,newline:Sn,paragraph:ts,table:Ne,text:Bn},Et=Q("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",je).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ye).getRegex(),Mn={...It,lheading:In,table:Et,paragraph:Q(Pt).replace("hr",je).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Et).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ye).getRegex()},qn={...It,html:Q(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Tt).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Ne,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Q(Pt).replace("hr",je).replace("heading",` *#{1,6} *[^
]`).replace("lheading",es).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Vn=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,En=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,ss=/^( {2,}|\\)\n(?!\s*$)/,On=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,et=/[\p{P}\p{S}]/u,Bt=/[\s\p{P}\p{S}]/u,ns=/[^\s\p{P}\p{S}]/u,Dn=Q(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Bt).getRegex(),ls=/(?!~)[\p{P}\p{S}]/u,Nn=/(?!~)[\s\p{P}\p{S}]/u,Kn=/(?:[^\s\p{P}\p{S}]|~)/u,jn=Q(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",Cn?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),as=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Fn=Q(as,"u").replace(/punct/g,et).getRegex(),Qn=Q(as,"u").replace(/punct/g,ls).getRegex(),os="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Hn=Q(os,"gu").replace(/notPunctSpace/g,ns).replace(/punctSpace/g,Bt).replace(/punct/g,et).getRegex(),Zn=Q(os,"gu").replace(/notPunctSpace/g,Kn).replace(/punctSpace/g,Nn).replace(/punct/g,ls).getRegex(),Gn=Q("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ns).replace(/punctSpace/g,Bt).replace(/punct/g,et).getRegex(),Jn=Q(/\\(punct)/,"gu").replace(/punct/g,et).getRegex(),Wn=Q(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Xn=Q(Tt).replace("(?:-->|$)","-->").getRegex(),Yn=Q("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Xn).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Je=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,el=Q(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Je).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),is=Q(/^!?\[(label)\]\[(ref)\]/).replace("label",Je).replace("ref",At).getRegex(),rs=Q(/^!?\[(ref)\](?:\[\])?/).replace("ref",At).getRegex(),tl=Q("reflink|nolink(?!\\()","g").replace("reflink",is).replace("nolink",rs).getRegex(),Ot=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Rt={_backpedal:Ne,anyPunctuation:Jn,autolink:Wn,blockSkip:jn,br:ss,code:En,del:Ne,emStrongLDelim:Fn,emStrongRDelimAst:Hn,emStrongRDelimUnd:Gn,escape:Vn,link:el,nolink:rs,punctuation:Dn,reflink:is,reflinkSearch:tl,tag:Yn,text:On,url:Ne},sl={...Rt,link:Q(/^!?\[(label)\]\((.*?)\)/).replace("label",Je).getRegex(),reflink:Q(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Je).getRegex()},wt={...Rt,emStrongRDelimAst:Zn,emStrongLDelim:Qn,url:Q(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Ot).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Q(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Ot).getRegex()},nl={...wt,br:Q(ss).replace("{2,}","*").getRegex(),text:Q(wt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ze={normal:It,gfm:Mn,pedantic:qn},Ve={normal:Rt,gfm:wt,breaks:nl,pedantic:sl},ll={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Dt=a=>ll[a];function we(a,t){if(t){if(ae.escapeTest.test(a))return a.replace(ae.escapeReplace,Dt)}else if(ae.escapeTestNoEncode.test(a))return a.replace(ae.escapeReplaceNoEncode,Dt);return a}function Nt(a){try{a=encodeURI(a).replace(ae.percentDecode,"%")}catch{return null}return a}function Kt(a,t){let l=a.replace(ae.findPipe,(o,i,v)=>{let u=!1,k=i;for(;--k>=0&&v[k]==="\\";)u=!u;return u?"|":" |"}),n=l.split(ae.splitPipe),s=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(ae.slashPipe,"|");return n}function Ee(a,t,l){let n=a.length;if(n===0)return"";let s=0;for(;s<n&&a.charAt(n-s-1)===t;)s++;return a.slice(0,n-s)}function al(a,t){if(a.indexOf(t[1])===-1)return-1;let l=0;for(let n=0;n<a.length;n++)if(a[n]==="\\")n++;else if(a[n]===t[0])l++;else if(a[n]===t[1]&&(l--,l<0))return n;return l>0?-2:-1}function jt(a,t,l,n,s){let o=t.href,i=t.title||null,v=a[1].replace(s.other.outputLinkReplace,"$1");n.state.inLink=!0;let u={type:a[0].charAt(0)==="!"?"image":"link",raw:l,href:o,title:i,text:v,tokens:n.inlineTokens(v)};return n.state.inLink=!1,u}function ol(a,t,l){let n=a.match(l.other.indentCodeCompensation);if(n===null)return t;let s=n[1];return t.split(`
`).map(o=>{let i=o.match(l.other.beginningSpace);if(i===null)return o;let[v]=i;return v.length>=s.length?o.slice(s.length):o}).join(`
`)}var We=class{options;rules;lexer;constructor(a){this.options=a||Be}space(a){let t=this.rules.block.newline.exec(a);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(a){let t=this.rules.block.code.exec(a);if(t){let l=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?l:Ee(l,`
`)}}}fences(a){let t=this.rules.block.fences.exec(a);if(t){let l=t[0],n=ol(l,t[3]||"",this.rules);return{type:"code",raw:l,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(a){let t=this.rules.block.heading.exec(a);if(t){let l=t[2].trim();if(this.rules.other.endingHash.test(l)){let n=Ee(l,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(l=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:l,tokens:this.lexer.inline(l)}}}hr(a){let t=this.rules.block.hr.exec(a);if(t)return{type:"hr",raw:Ee(t[0],`
`)}}blockquote(a){let t=this.rules.block.blockquote.exec(a);if(t){let l=Ee(t[0],`
`).split(`
`),n="",s="",o=[];for(;l.length>0;){let i=!1,v=[],u;for(u=0;u<l.length;u++)if(this.rules.other.blockquoteStart.test(l[u]))v.push(l[u]),i=!0;else if(!i)v.push(l[u]);else break;l=l.slice(u);let k=v.join(`
`),f=k.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${k}`:k,s=s?`${s}
${f}`:f;let R=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(f,o,!0),this.lexer.state.top=R,l.length===0)break;let T=o.at(-1);if(T?.type==="code")break;if(T?.type==="blockquote"){let z=T,U=z.raw+`
`+l.join(`
`),V=this.blockquote(U);o[o.length-1]=V,n=n.substring(0,n.length-z.raw.length)+V.raw,s=s.substring(0,s.length-z.text.length)+V.text;break}else if(T?.type==="list"){let z=T,U=z.raw+`
`+l.join(`
`),V=this.list(U);o[o.length-1]=V,n=n.substring(0,n.length-T.raw.length)+V.raw,s=s.substring(0,s.length-z.raw.length)+V.raw,l=U.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:o,text:s}}}list(a){let t=this.rules.block.list.exec(a);if(t){let l=t[1].trim(),n=l.length>1,s={type:"list",raw:"",ordered:n,start:n?+l.slice(0,-1):"",loose:!1,items:[]};l=n?`\\d{1,9}\\${l.slice(-1)}`:`\\${l}`,this.options.pedantic&&(l=n?l:"[*+-]");let o=this.rules.other.listItemRegex(l),i=!1;for(;a;){let u=!1,k="",f="";if(!(t=o.exec(a))||this.rules.block.hr.test(a))break;k=t[0],a=a.substring(k.length);let R=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,V=>" ".repeat(3*V.length)),T=a.split(`
`,1)[0],z=!R.trim(),U=0;if(this.options.pedantic?(U=2,f=R.trimStart()):z?U=t[1].length+1:(U=t[2].search(this.rules.other.nonSpaceChar),U=U>4?1:U,f=R.slice(U),U+=t[1].length),z&&this.rules.other.blankLine.test(T)&&(k+=T+`
`,a=a.substring(T.length+1),u=!0),!u){let V=this.rules.other.nextBulletRegex(U),N=this.rules.other.hrRegex(U),j=this.rules.other.fencesBeginRegex(U),K=this.rules.other.headingBeginRegex(U),h=this.rules.other.htmlBeginRegex(U);for(;a;){let C=a.split(`
`,1)[0],b;if(T=C,this.options.pedantic?(T=T.replace(this.rules.other.listReplaceNesting,"  "),b=T):b=T.replace(this.rules.other.tabCharGlobal,"    "),j.test(T)||K.test(T)||h.test(T)||V.test(T)||N.test(T))break;if(b.search(this.rules.other.nonSpaceChar)>=U||!T.trim())f+=`
`+b.slice(U);else{if(z||R.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||j.test(R)||K.test(R)||N.test(R))break;f+=`
`+T}!z&&!T.trim()&&(z=!0),k+=C+`
`,a=a.substring(C.length+1),R=b.slice(U)}}s.loose||(i?s.loose=!0:this.rules.other.doubleBlankLine.test(k)&&(i=!0)),s.items.push({type:"list_item",raw:k,task:!!this.options.gfm&&this.rules.other.listIsTask.test(f),loose:!1,text:f,tokens:[]}),s.raw+=k}let v=s.items.at(-1);if(v)v.raw=v.raw.trimEnd(),v.text=v.text.trimEnd();else return;s.raw=s.raw.trimEnd();for(let u of s.items){if(this.lexer.state.top=!1,u.tokens=this.lexer.blockTokens(u.text,[]),u.task){if(u.text=u.text.replace(this.rules.other.listReplaceTask,""),u.tokens[0]?.type==="text"||u.tokens[0]?.type==="paragraph"){u.tokens[0].raw=u.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),u.tokens[0].text=u.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let f=this.lexer.inlineQueue.length-1;f>=0;f--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[f].src)){this.lexer.inlineQueue[f].src=this.lexer.inlineQueue[f].src.replace(this.rules.other.listReplaceTask,"");break}}let k=this.rules.other.listTaskCheckbox.exec(u.raw);if(k){let f={type:"checkbox",raw:k[0]+" ",checked:k[0]!=="[ ]"};u.checked=f.checked,s.loose?u.tokens[0]&&["paragraph","text"].includes(u.tokens[0].type)&&"tokens"in u.tokens[0]&&u.tokens[0].tokens?(u.tokens[0].raw=f.raw+u.tokens[0].raw,u.tokens[0].text=f.raw+u.tokens[0].text,u.tokens[0].tokens.unshift(f)):u.tokens.unshift({type:"paragraph",raw:f.raw,text:f.raw,tokens:[f]}):u.tokens.unshift(f)}}if(!s.loose){let k=u.tokens.filter(R=>R.type==="space"),f=k.length>0&&k.some(R=>this.rules.other.anyLine.test(R.raw));s.loose=f}}if(s.loose)for(let u of s.items){u.loose=!0;for(let k of u.tokens)k.type==="text"&&(k.type="paragraph")}return s}}html(a){let t=this.rules.block.html.exec(a);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(a){let t=this.rules.block.def.exec(a);if(t){let l=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:l,raw:t[0],href:n,title:s}}}table(a){let t=this.rules.block.table.exec(a);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let l=Kt(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(l.length===n.length){for(let i of n)this.rules.other.tableAlignRight.test(i)?o.align.push("right"):this.rules.other.tableAlignCenter.test(i)?o.align.push("center"):this.rules.other.tableAlignLeft.test(i)?o.align.push("left"):o.align.push(null);for(let i=0;i<l.length;i++)o.header.push({text:l[i],tokens:this.lexer.inline(l[i]),header:!0,align:o.align[i]});for(let i of s)o.rows.push(Kt(i,o.header.length).map((v,u)=>({text:v,tokens:this.lexer.inline(v),header:!1,align:o.align[u]})));return o}}lheading(a){let t=this.rules.block.lheading.exec(a);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(a){let t=this.rules.block.paragraph.exec(a);if(t){let l=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:l,tokens:this.lexer.inline(l)}}}text(a){let t=this.rules.block.text.exec(a);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(a){let t=this.rules.inline.escape.exec(a);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(a){let t=this.rules.inline.tag.exec(a);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(a){let t=this.rules.inline.link.exec(a);if(t){let l=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(l)){if(!this.rules.other.endAngleBracket.test(l))return;let o=Ee(l.slice(0,-1),"\\");if((l.length-o.length)%2===0)return}else{let o=al(t[2],"()");if(o===-2)return;if(o>-1){let i=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,i).trim(),t[3]=""}}let n=t[2],s="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(n);o&&(n=o[1],s=o[3])}else s=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(l)?n=n.slice(1):n=n.slice(1,-1)),jt(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(a,t){let l;if((l=this.rules.inline.reflink.exec(a))||(l=this.rules.inline.nolink.exec(a))){let n=(l[2]||l[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=t[n.toLowerCase()];if(!s){let o=l[0].charAt(0);return{type:"text",raw:o,text:o}}return jt(l,s,l[0],this.lexer,this.rules)}}emStrong(a,t,l=""){let n=this.rules.inline.emStrongLDelim.exec(a);if(!(!n||n[3]&&l.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!l||this.rules.inline.punctuation.exec(l))){let s=[...n[0]].length-1,o,i,v=s,u=0,k=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(k.lastIndex=0,t=t.slice(-1*a.length+s);(n=k.exec(t))!=null;){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(i=[...o].length,n[3]||n[4]){v+=i;continue}else if((n[5]||n[6])&&s%3&&!((s+i)%3)){u+=i;continue}if(v-=i,v>0)continue;i=Math.min(i,i+v+u);let f=[...n[0]][0].length,R=a.slice(0,s+n.index+f+i);if(Math.min(s,i)%2){let z=R.slice(1,-1);return{type:"em",raw:R,text:z,tokens:this.lexer.inlineTokens(z)}}let T=R.slice(2,-2);return{type:"strong",raw:R,text:T,tokens:this.lexer.inlineTokens(T)}}}}codespan(a){let t=this.rules.inline.code.exec(a);if(t){let l=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(l),s=this.rules.other.startingSpaceChar.test(l)&&this.rules.other.endingSpaceChar.test(l);return n&&s&&(l=l.substring(1,l.length-1)),{type:"codespan",raw:t[0],text:l}}}br(a){let t=this.rules.inline.br.exec(a);if(t)return{type:"br",raw:t[0]}}del(a){let t=this.rules.inline.del.exec(a);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(a){let t=this.rules.inline.autolink.exec(a);if(t){let l,n;return t[2]==="@"?(l=t[1],n="mailto:"+l):(l=t[1],n=l),{type:"link",raw:t[0],text:l,href:n,tokens:[{type:"text",raw:l,text:l}]}}}url(a){let t;if(t=this.rules.inline.url.exec(a)){let l,n;if(t[2]==="@")l=t[0],n="mailto:"+l;else{let s;do s=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(s!==t[0]);l=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:l,href:n,tokens:[{type:"text",raw:l,text:l}]}}}inlineText(a){let t=this.rules.inline.text.exec(a);if(t){let l=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:l}}}},fe=class xt{tokens;options;state;inlineQueue;tokenizer;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Be,this.options.tokenizer=this.options.tokenizer||new We,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let l={other:ae,block:Ze.normal,inline:Ve.normal};this.options.pedantic?(l.block=Ze.pedantic,l.inline=Ve.pedantic):this.options.gfm&&(l.block=Ze.gfm,this.options.breaks?l.inline=Ve.breaks:l.inline=Ve.gfm),this.tokenizer.rules=l}static get rules(){return{block:Ze,inline:Ve}}static lex(t,l){return new xt(l).lex(t)}static lexInline(t,l){return new xt(l).inlineTokens(t)}lex(t){t=t.replace(ae.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let l=0;l<this.inlineQueue.length;l++){let n=this.inlineQueue[l];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,l=[],n=!1){for(this.options.pedantic&&(t=t.replace(ae.tabCharGlobal,"    ").replace(ae.spaceLine,""));t;){let s;if(this.options.extensions?.block?.some(i=>(s=i.call({lexer:this},t,l))?(t=t.substring(s.raw.length),l.push(s),!0):!1))continue;if(s=this.tokenizer.space(t)){t=t.substring(s.raw.length);let i=l.at(-1);s.raw.length===1&&i!==void 0?i.raw+=`
`:l.push(s);continue}if(s=this.tokenizer.code(t)){t=t.substring(s.raw.length);let i=l.at(-1);i?.type==="paragraph"||i?.type==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+s.raw,i.text+=`
`+s.text,this.inlineQueue.at(-1).src=i.text):l.push(s);continue}if(s=this.tokenizer.fences(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.heading(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.hr(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.blockquote(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.list(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.html(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.def(t)){t=t.substring(s.raw.length);let i=l.at(-1);i?.type==="paragraph"||i?.type==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+s.raw,i.text+=`
`+s.raw,this.inlineQueue.at(-1).src=i.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title},l.push(s));continue}if(s=this.tokenizer.table(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.lheading(t)){t=t.substring(s.raw.length),l.push(s);continue}let o=t;if(this.options.extensions?.startBlock){let i=1/0,v=t.slice(1),u;this.options.extensions.startBlock.forEach(k=>{u=k.call({lexer:this},v),typeof u=="number"&&u>=0&&(i=Math.min(i,u))}),i<1/0&&i>=0&&(o=t.substring(0,i+1))}if(this.state.top&&(s=this.tokenizer.paragraph(o))){let i=l.at(-1);n&&i?.type==="paragraph"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+s.raw,i.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):l.push(s),n=o.length!==t.length,t=t.substring(s.raw.length);continue}if(s=this.tokenizer.text(t)){t=t.substring(s.raw.length);let i=l.at(-1);i?.type==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+s.raw,i.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):l.push(s);continue}if(t){let i="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(i);break}else throw new Error(i)}}return this.state.top=!0,l}inline(t,l=[]){return this.inlineQueue.push({src:t,tokens:l}),l}inlineTokens(t,l=[]){let n=t,s=null;if(this.tokens.links){let u=Object.keys(this.tokens.links);if(u.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)u.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,s.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)o=s[2]?s[2].length:0,n=n.slice(0,s.index+o)+"["+"a".repeat(s[0].length-o-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=this.options.hooks?.emStrongMask?.call({lexer:this},n)??n;let i=!1,v="";for(;t;){i||(v=""),i=!1;let u;if(this.options.extensions?.inline?.some(f=>(u=f.call({lexer:this},t,l))?(t=t.substring(u.raw.length),l.push(u),!0):!1))continue;if(u=this.tokenizer.escape(t)){t=t.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.tag(t)){t=t.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.link(t)){t=t.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(u.raw.length);let f=l.at(-1);u.type==="text"&&f?.type==="text"?(f.raw+=u.raw,f.text+=u.text):l.push(u);continue}if(u=this.tokenizer.emStrong(t,n,v)){t=t.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.codespan(t)){t=t.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.br(t)){t=t.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.del(t)){t=t.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.autolink(t)){t=t.substring(u.raw.length),l.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(t))){t=t.substring(u.raw.length),l.push(u);continue}let k=t;if(this.options.extensions?.startInline){let f=1/0,R=t.slice(1),T;this.options.extensions.startInline.forEach(z=>{T=z.call({lexer:this},R),typeof T=="number"&&T>=0&&(f=Math.min(f,T))}),f<1/0&&f>=0&&(k=t.substring(0,f+1))}if(u=this.tokenizer.inlineText(k)){t=t.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(v=u.raw.slice(-1)),i=!0;let f=l.at(-1);f?.type==="text"?(f.raw+=u.raw,f.text+=u.text):l.push(u);continue}if(t){let f="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return l}},Xe=class{options;parser;constructor(a){this.options=a||Be}space(a){return""}code({text:a,lang:t,escaped:l}){let n=(t||"").match(ae.notSpaceStart)?.[0],s=a.replace(ae.endingNewline,"")+`
`;return n?'<pre><code class="language-'+we(n)+'">'+(l?s:we(s,!0))+`</code></pre>
`:"<pre><code>"+(l?s:we(s,!0))+`</code></pre>
`}blockquote({tokens:a}){return`<blockquote>
${this.parser.parse(a)}</blockquote>
`}html({text:a}){return a}def(a){return""}heading({tokens:a,depth:t}){return`<h${t}>${this.parser.parseInline(a)}</h${t}>
`}hr(a){return`<hr>
`}list(a){let t=a.ordered,l=a.start,n="";for(let i=0;i<a.items.length;i++){let v=a.items[i];n+=this.listitem(v)}let s=t?"ol":"ul",o=t&&l!==1?' start="'+l+'"':"";return"<"+s+o+`>
`+n+"</"+s+`>
`}listitem(a){return`<li>${this.parser.parse(a.tokens)}</li>
`}checkbox({checked:a}){return"<input "+(a?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:a}){return`<p>${this.parser.parseInline(a)}</p>
`}table(a){let t="",l="";for(let s=0;s<a.header.length;s++)l+=this.tablecell(a.header[s]);t+=this.tablerow({text:l});let n="";for(let s=0;s<a.rows.length;s++){let o=a.rows[s];l="";for(let i=0;i<o.length;i++)l+=this.tablecell(o[i]);n+=this.tablerow({text:l})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:a}){return`<tr>
${a}</tr>
`}tablecell(a){let t=this.parser.parseInline(a.tokens),l=a.header?"th":"td";return(a.align?`<${l} align="${a.align}">`:`<${l}>`)+t+`</${l}>
`}strong({tokens:a}){return`<strong>${this.parser.parseInline(a)}</strong>`}em({tokens:a}){return`<em>${this.parser.parseInline(a)}</em>`}codespan({text:a}){return`<code>${we(a,!0)}</code>`}br(a){return"<br>"}del({tokens:a}){return`<del>${this.parser.parseInline(a)}</del>`}link({href:a,title:t,tokens:l}){let n=this.parser.parseInline(l),s=Nt(a);if(s===null)return n;a=s;let o='<a href="'+a+'"';return t&&(o+=' title="'+we(t)+'"'),o+=">"+n+"</a>",o}image({href:a,title:t,text:l,tokens:n}){n&&(l=this.parser.parseInline(n,this.parser.textRenderer));let s=Nt(a);if(s===null)return we(l);a=s;let o=`<img src="${a}" alt="${l}"`;return t&&(o+=` title="${we(t)}"`),o+=">",o}text(a){return"tokens"in a&&a.tokens?this.parser.parseInline(a.tokens):"escaped"in a&&a.escaped?a.text:we(a.text)}},zt=class{strong({text:a}){return a}em({text:a}){return a}codespan({text:a}){return a}del({text:a}){return a}html({text:a}){return a}text({text:a}){return a}link({text:a}){return""+a}image({text:a}){return""+a}br(){return""}checkbox({raw:a}){return a}},be=class $t{options;renderer;textRenderer;constructor(t){this.options=t||Be,this.options.renderer=this.options.renderer||new Xe,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new zt}static parse(t,l){return new $t(l).parse(t)}static parseInline(t,l){return new $t(l).parseInline(t)}parse(t){let l="";for(let n=0;n<t.length;n++){let s=t[n];if(this.options.extensions?.renderers?.[s.type]){let i=s,v=this.options.extensions.renderers[i.type].call({parser:this},i);if(v!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(i.type)){l+=v||"";continue}}let o=s;switch(o.type){case"space":{l+=this.renderer.space(o);break}case"hr":{l+=this.renderer.hr(o);break}case"heading":{l+=this.renderer.heading(o);break}case"code":{l+=this.renderer.code(o);break}case"table":{l+=this.renderer.table(o);break}case"blockquote":{l+=this.renderer.blockquote(o);break}case"list":{l+=this.renderer.list(o);break}case"checkbox":{l+=this.renderer.checkbox(o);break}case"html":{l+=this.renderer.html(o);break}case"def":{l+=this.renderer.def(o);break}case"paragraph":{l+=this.renderer.paragraph(o);break}case"text":{l+=this.renderer.text(o);break}default:{let i='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return l}parseInline(t,l=this.renderer){let n="";for(let s=0;s<t.length;s++){let o=t[s];if(this.options.extensions?.renderers?.[o.type]){let v=this.options.extensions.renderers[o.type].call({parser:this},o);if(v!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=v||"";continue}}let i=o;switch(i.type){case"escape":{n+=l.text(i);break}case"html":{n+=l.html(i);break}case"link":{n+=l.link(i);break}case"image":{n+=l.image(i);break}case"checkbox":{n+=l.checkbox(i);break}case"strong":{n+=l.strong(i);break}case"em":{n+=l.em(i);break}case"codespan":{n+=l.codespan(i);break}case"br":{n+=l.br(i);break}case"del":{n+=l.del(i);break}case"text":{n+=l.text(i);break}default:{let v='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(v),"";throw new Error(v)}}}return n}},Oe=class{options;block;constructor(a){this.options=a||Be}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(a){return a}postprocess(a){return a}processAllTokens(a){return a}emStrongMask(a){return a}provideLexer(){return this.block?fe.lex:fe.lexInline}provideParser(){return this.block?be.parse:be.parseInline}},il=class{defaults=Ct();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=be;Renderer=Xe;TextRenderer=zt;Lexer=fe;Tokenizer=We;Hooks=Oe;constructor(...a){this.use(...a)}walkTokens(a,t){let l=[];for(let n of a)switch(l=l.concat(t.call(this,n)),n.type){case"table":{let s=n;for(let o of s.header)l=l.concat(this.walkTokens(o.tokens,t));for(let o of s.rows)for(let i of o)l=l.concat(this.walkTokens(i.tokens,t));break}case"list":{let s=n;l=l.concat(this.walkTokens(s.items,t));break}default:{let s=n;this.defaults.extensions?.childTokens?.[s.type]?this.defaults.extensions.childTokens[s.type].forEach(o=>{let i=s[o].flat(1/0);l=l.concat(this.walkTokens(i,t))}):s.tokens&&(l=l.concat(this.walkTokens(s.tokens,t)))}}return l}use(...a){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return a.forEach(l=>{let n={...l};if(n.async=this.defaults.async||n.async||!1,l.extensions&&(l.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let o=t.renderers[s.name];o?t.renderers[s.name]=function(...i){let v=s.renderer.apply(this,i);return v===!1&&(v=o.apply(this,i)),v}:t.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=t[s.level];o?o.unshift(s.tokenizer):t[s.level]=[s.tokenizer],s.start&&(s.level==="block"?t.startBlock?t.startBlock.push(s.start):t.startBlock=[s.start]:s.level==="inline"&&(t.startInline?t.startInline.push(s.start):t.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(t.childTokens[s.name]=s.childTokens)}),n.extensions=t),l.renderer){let s=this.defaults.renderer||new Xe(this.defaults);for(let o in l.renderer){if(!(o in s))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let i=o,v=l.renderer[i],u=s[i];s[i]=(...k)=>{let f=v.apply(s,k);return f===!1&&(f=u.apply(s,k)),f||""}}n.renderer=s}if(l.tokenizer){let s=this.defaults.tokenizer||new We(this.defaults);for(let o in l.tokenizer){if(!(o in s))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let i=o,v=l.tokenizer[i],u=s[i];s[i]=(...k)=>{let f=v.apply(s,k);return f===!1&&(f=u.apply(s,k)),f}}n.tokenizer=s}if(l.hooks){let s=this.defaults.hooks||new Oe;for(let o in l.hooks){if(!(o in s))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let i=o,v=l.hooks[i],u=s[i];Oe.passThroughHooks.has(o)?s[i]=k=>{if(this.defaults.async&&Oe.passThroughHooksRespectAsync.has(o))return(async()=>{let R=await v.call(s,k);return u.call(s,R)})();let f=v.call(s,k);return u.call(s,f)}:s[i]=(...k)=>{if(this.defaults.async)return(async()=>{let R=await v.apply(s,k);return R===!1&&(R=await u.apply(s,k)),R})();let f=v.apply(s,k);return f===!1&&(f=u.apply(s,k)),f}}n.hooks=s}if(l.walkTokens){let s=this.defaults.walkTokens,o=l.walkTokens;n.walkTokens=function(i){let v=[];return v.push(o.call(this,i)),s&&(v=v.concat(s.call(this,i))),v}}this.defaults={...this.defaults,...n}}),this}setOptions(a){return this.defaults={...this.defaults,...a},this}lexer(a,t){return fe.lex(a,t??this.defaults)}parser(a,t){return be.parse(a,t??this.defaults)}parseMarkdown(a){return(t,l)=>{let n={...l},s={...this.defaults,...n},o=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&n.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=a),s.async)return(async()=>{let i=s.hooks?await s.hooks.preprocess(t):t,v=await(s.hooks?await s.hooks.provideLexer():a?fe.lex:fe.lexInline)(i,s),u=s.hooks?await s.hooks.processAllTokens(v):v;s.walkTokens&&await Promise.all(this.walkTokens(u,s.walkTokens));let k=await(s.hooks?await s.hooks.provideParser():a?be.parse:be.parseInline)(u,s);return s.hooks?await s.hooks.postprocess(k):k})().catch(o);try{s.hooks&&(t=s.hooks.preprocess(t));let i=(s.hooks?s.hooks.provideLexer():a?fe.lex:fe.lexInline)(t,s);s.hooks&&(i=s.hooks.processAllTokens(i)),s.walkTokens&&this.walkTokens(i,s.walkTokens);let v=(s.hooks?s.hooks.provideParser():a?be.parse:be.parseInline)(i,s);return s.hooks&&(v=s.hooks.postprocess(v)),v}catch(i){return o(i)}}}onError(a,t){return l=>{if(l.message+=`
Please report this to https://github.com/markedjs/marked.`,a){let n="<p>An error occurred:</p><pre>"+we(l.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(l);throw l}}},Ie=new il;function G(a,t){return Ie.parse(a,t)}G.options=G.setOptions=function(a){return Ie.setOptions(a),G.defaults=Ie.defaults,Xt(G.defaults),G};G.getDefaults=Ct;G.defaults=Be;G.use=function(...a){return Ie.use(...a),G.defaults=Ie.defaults,Xt(G.defaults),G};G.walkTokens=function(a,t){return Ie.walkTokens(a,t)};G.parseInline=Ie.parseInline;G.Parser=be;G.parser=be.parse;G.Renderer=Xe;G.TextRenderer=zt;G.Lexer=fe;G.lexer=fe.lex;G.Tokenizer=We;G.Hooks=Oe;G.parse=G;G.options;G.setOptions;G.use;G.walkTokens;G.parseInline;be.parse;fe.lex;const rl={class:"overview-grid"},ul={class:"overview-card summary-card"},cl={class:"card-header"},dl={class:"card-title-with-selector"},pl={class:"card-title-icon"},vl={class:"card-header-actions"},gl={class:"template-status"},ml={class:"template-description"},hl={class:"card-content markdown-content"},fl={key:0,class:"loading-text"},bl=["innerHTML"],kl={key:2,class:"placeholder-text"},yl={class:"overview-card stats-card"},_l={class:"stats-grid"},wl={class:"stat-item"},xl={class:"stat-value"},$l={class:"stat-item"},Cl={class:"stat-value"},Sl={class:"export-actions"},Pl=["disabled"],Al=["disabled"],Tl=ye({__name:"OverviewPanel",setup(a){const t=$e(),l=w("no_spoiler"),n=w(""),s=w(!1),o=w([]),i=[{value:"no_spoiler",label:"æ— å‰§é€ç®€ä»‹",icon:"ğŸ",description:"ä¸å«å‰§é€çš„ç®€çŸ­ä»‹ç»ï¼Œé€‚åˆæ¨èç»™ä»–äºº"},{value:"story_summary",label:"æ•…äº‹æ¦‚è¦",icon:"ğŸ“–",description:"å®Œæ•´çš„å‰§æƒ…å›é¡¾ï¼ŒåŒ…å«æ‰€æœ‰å‰§é€"},{value:"recap",label:"å‰æƒ…å›é¡¾",icon:"âª",description:"ä¹‹å‰å‘ç”Ÿçš„é‡è¦äº‹ä»¶å›é¡¾"},{value:"character_guide",label:"è§’è‰²å›¾é‰´",icon:"ğŸ‘¥",description:"ä¸»è¦è§’è‰²ä»‹ç»å’Œå…³ç³»"},{value:"world_setting",label:"ä¸–ç•Œè§‚è®¾å®š",icon:"ğŸŒ",description:"æ•…äº‹èƒŒæ™¯å’Œä¸–ç•Œè§‚è®¾å®š"},{value:"highlights",label:"ååœºé¢ç›˜ç‚¹",icon:"âœ¨",description:"ç²¾å½©ç‰‡æ®µå’Œç»å…¸åœºæ™¯å›é¡¾"},{value:"reading_notes",label:"é˜…è¯»ç¬”è®°",icon:"ğŸ“",description:"é˜…è¯»è¿‡ç¨‹ä¸­çš„é‡ç‚¹ç¬”è®°"}],v=i.map(h=>({label:`${h.icon} ${h.label}`,value:h.value})),u=L(()=>i.find(C=>C.value===l.value)?.icon||"ğŸ“Š"),k=L(()=>i.find(C=>C.value===l.value)?.description||""),f=L(()=>o.value.includes(l.value)?"å·²ç”Ÿæˆ":""),R=L(()=>n.value?G.parse(n.value):"");async function T(){await z(!1)}async function z(h){if(t.currentBookId){s.value=!0,n.value="";try{let C;h?C=await Es(t.currentBookId,l.value,!0):C=await Zt(t.currentBookId,l.value),C.success&&(C.content?(n.value=C.content,o.value.includes(l.value)||o.value.push(l.value)):C.cached||(n.value=""))}catch(C){console.error("åŠ è½½æ¦‚è§ˆå¤±è´¥:",C),n.value="åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"}finally{s.value=!1}}}async function U(h){await z(h)}async function V(){if(t.currentBookId)try{const h=await Gt(t.currentBookId);h.success&&(h.generated?o.value=h.generated:h.templates&&Array.isArray(h.templates)&&(o.value=h.templates))}catch(h){console.error("åŠ è½½æ¨¡æ¿åˆ—è¡¨å¤±è´¥:",h)}}const N=w(!1);async function j(){if(!t.currentBookId){alert("è¯·å…ˆé€‰æ‹©ä¹¦ç±");return}N.value=!0;try{const h=await Wt(t.currentBookId);if(h.success&&h.markdown){const C=new Blob([h.markdown],{type:"text/markdown"}),b=URL.createObjectURL(C),p=document.createElement("a");p.href=b,p.download=`${t.currentBookId}_analysis.md`,p.click(),URL.revokeObjectURL(b),alert("å¯¼å‡ºæˆåŠŸ")}else alert("å¯¼å‡ºå¤±è´¥: "+(h.error||"æœªçŸ¥é”™è¯¯"))}catch(h){console.error("å¯¼å‡ºå¤±è´¥:",h),alert("å¯¼å‡ºå¤±è´¥")}finally{N.value=!1}}function K(){if(!n.value){alert("æš‚æ— å†…å®¹å¯å¯¼å‡º");return}const h=i.find(E=>E.value===l.value),C=`${t.currentBookId}_${l.value}.md`,b=`# ${h?.label||l.value}

${n.value}`,p=new Blob([b],{type:"text/markdown"}),g=URL.createObjectURL(p),m=document.createElement("a");m.href=g,m.download=C,m.click(),URL.revokeObjectURL(g)}return ze(async()=>{await V(),o.value.includes(l.value)&&await z(!1)}),Ke(()=>t.currentBookId,async h=>{h&&(n.value="",o.value=[],await V(),o.value.includes(l.value)&&await z(!1))}),(h,C)=>(c(),d("div",rl,[e("div",ul,[e("div",cl,[e("div",dl,[e("span",pl,x(u.value),1),ne(ve,{modelValue:l.value,"onUpdate:modelValue":C[0]||(C[0]=b=>l.value=b),options:pe(v),onChange:T},null,8,["modelValue","options"])]),e("div",vl,[e("span",gl,x(f.value),1),e("button",{class:"btn-icon",title:"ç”Ÿæˆ/åŠ è½½",onClick:C[1]||(C[1]=b=>U(!1))}," ğŸ“„ "),e("button",{class:"btn-icon",title:"é‡æ–°ç”Ÿæˆ",onClick:C[2]||(C[2]=b=>U(!0))}," ğŸ”„ ")])]),e("p",ml,x(k.value),1),e("div",hl,[s.value?(c(),d("div",fl,"åŠ è½½ä¸­...")):n.value?(c(),d("div",{key:1,innerHTML:R.value},null,8,bl)):(c(),d("div",kl,"é€‰æ‹©æ¨¡æ¿ç±»å‹ï¼Œç‚¹å‡»ç”ŸæˆæŒ‰é’®"))])]),e("div",yl,[C[5]||(C[5]=e("h3",{class:"card-title"},"ğŸ“Š åˆ†æç»Ÿè®¡",-1)),e("div",_l,[e("div",wl,[e("span",xl,x(pe(t).analyzedPageCount),1),C[3]||(C[3]=e("span",{class:"stat-label"},"å·²åˆ†æé¡µé¢",-1))]),e("div",$l,[e("span",Cl,x(pe(t).chapters.length),1),C[4]||(C[4]=e("span",{class:"stat-label"},"ç« èŠ‚æ•°",-1))])]),e("div",Sl,[e("button",{class:"btn btn-secondary btn-sm",disabled:N.value||!n.value,title:"å¯¼å‡ºå½“å‰æ¦‚è§ˆ",onClick:K}," ğŸ“„ å¯¼å‡ºå½“å‰ ",8,Pl),e("button",{class:"btn btn-primary btn-sm",disabled:N.value,title:"å¯¼å‡ºå®Œæ•´åˆ†ææ•°æ®",onClick:j},x(N.value?"å¯¼å‡ºä¸­...":"ğŸ“¤ å¯¼å‡ºå…¨éƒ¨"),9,Al)])]),C[6]||(C[6]=e("div",{class:"overview-card recent-card"},[e("h3",{class:"card-title"},"ğŸ• æœ€è¿‘åˆ†æ"),e("div",{class:"recent-pages"},[e("div",{class:"placeholder-text"},"æš‚æ— åˆ†æè®°å½•")])],-1))]))}}),Il=xe(Tl,[["__scopeId","data-v-e36329ba"]]),Bl={class:"timeline-tab"},Rl={class:"timeline-header"},zl=["disabled"],Ll={key:0,class:"btn-spinner"},Ul={key:0,class:"error-message"},Ml={class:"timeline-container"},ql={key:0,class:"loading-state"},Vl={key:1,class:"timeline-empty-state"},El=["disabled"],Ol={class:"timeline-stats"},Dl={key:0,class:"stat-badge"},Nl={class:"stat-badge"},Kl={key:1,class:"stat-badge"},jl={key:2,class:"stat-badge"},Fl={class:"stat-badge"},Ql={key:0,class:"timeline-summary-card"},Hl={class:"one-sentence"},Zl={key:0,class:"themes"},Gl={key:1,class:"characters-section"},Jl={class:"characters-grid"},Wl=["onClick"],Xl={class:"character-name"},Yl={class:"character-desc"},ea={class:"character-page"},ta={key:2,class:"timeline-section"},sa={key:3,class:"timeline-track"},na={class:"timeline-node"},la=["onClick"],aa={class:"timeline-card"},oa=["onClick"],ia=["src","alt","onClick"],ra={class:"timeline-card-title"},ua={class:"timeline-page-range"},ca={class:"timeline-event-count"},da={class:"expand-icon"},pa={key:0,class:"timeline-summary"},va={key:1,class:"timeline-mood"},ga={key:4,class:"timeline-track"},ma={class:"timeline-node"},ha=["onClick"],fa={class:"timeline-card"},ba=["onClick"],ka=["src","alt","onClick"],ya={class:"timeline-card-title"},_a={class:"timeline-page-range"},wa={class:"timeline-event-count"},xa={class:"expand-icon"},$a={key:0,class:"timeline-summary"},Ca={key:1,class:"timeline-events-list"},Sa={key:5,class:"timeline-section"},Pa={class:"plot-threads-list"},Aa={class:"thread-header"},Ta={class:"thread-name"},Ia={key:0,class:"thread-desc"},Ba={key:1,class:"thread-intro"},Ra={key:6,class:"placeholder-text"},za=ye({__name:"TimelinePanel",setup(a){const t=$e(),l=w(!1),n=w(!1),s=w(null);w("simple");const o=w(new Set),i=w(""),v=L(()=>{if(!s.value)return!1;const C=s.value.groups&&s.value.groups.length>0,b=s.value.plot_arcs&&s.value.plot_arcs.length>0;return C||b}),u=L(()=>s.value?.stats?.total_events||0),k=L(()=>s.value?.stats?.total_pages||0),f=L(()=>s.value?.mode==="enhanced"||!!s.value?.story_summary||!!s.value?.plot_arcs?.length),R=L(()=>s.value?.main_characters||[]),T=L(()=>s.value?.plot_arcs||[]),z=L(()=>s.value?.story_summary||"");async function U(){if(t.currentBookId){l.value=!0,i.value="";try{const C=await Jt(t.currentBookId);console.log("Timeline API response:",C),C.success?(s.value={mode:C.mode||"simple",groups:C.groups||[],stats:C.stats,story_summary:C.summary?.one_sentence||"",main_characters:C.characters||[],plot_arcs:C.story_arcs||[],plot_threads:C.plot_threads||[],events:C.events||[],cached:C.cached},console.log("Parsed timelineData:",s.value)):i.value=C.error||"åŠ è½½æ—¶é—´çº¿å¤±è´¥"}catch(C){console.error("åŠ è½½æ—¶é—´çº¿å¤±è´¥:",C),i.value=C instanceof Error?C.message:"åŠ è½½å¤±è´¥"}finally{l.value=!1}}}async function V(){if(t.currentBookId){n.value=!0,i.value="";try{const C=await Os(t.currentBookId);C.success?s.value=C:i.value="é‡æ–°ç”Ÿæˆå¤±è´¥"}catch(C){console.error("é‡æ–°ç”Ÿæˆæ—¶é—´çº¿å¤±è´¥:",C),i.value=C instanceof Error?C.message:"é‡æ–°ç”Ÿæˆå¤±è´¥"}finally{n.value=!1}}}function N(C){return t.currentBookId?Ht(t.currentBookId,C):""}function j(C){t.selectPage(C)}function K(C){o.value.has(C)?o.value.delete(C):o.value.add(C)}function h(C){return o.value.has(C)}return ze(()=>{t.currentBookId&&U()}),Ke(()=>t.currentBookId,C=>{C&&(s.value=null,U())}),(C,b)=>(c(),d("div",Bl,[e("div",Rl,[b[2]||(b[2]=e("h3",null,"ğŸ“ˆ å‰§æƒ…æ—¶é—´çº¿",-1)),e("button",{class:F(["btn btn-secondary btn-sm",{loading:n.value}]),disabled:l.value||n.value,onClick:V},[n.value?(c(),d("span",Ll)):I("",!0),Y(" "+x(n.value?"ç”Ÿæˆä¸­...":"ğŸ”„ é‡æ–°ç”Ÿæˆ"),1)],10,zl)]),i.value?(c(),d("div",Ul," âš ï¸ "+x(i.value),1)):I("",!0),e("div",Ml,[l.value?(c(),d("div",ql,[...b[3]||(b[3]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"åŠ è½½æ—¶é—´çº¿...",-1)])])):v.value?(c(),d(X,{key:2},[e("div",Ol,[s.value?.stats?.total_arcs?(c(),d("span",Dl,"ğŸ­ "+x(s.value.stats.total_arcs)+" ä¸ªå‰§æƒ…å¼§",1)):I("",!0),e("span",Nl,"ğŸ“Š "+x(u.value)+" ä¸ªäº‹ä»¶",1),s.value?.stats?.total_characters?(c(),d("span",Kl,"ğŸ‘¥ "+x(s.value.stats.total_characters)+" ä¸ªè§’è‰²",1)):I("",!0),s.value?.stats?.total_threads?(c(),d("span",jl,"ğŸ”— "+x(s.value.stats.total_threads)+" æ¡çº¿ç´¢",1)):I("",!0),e("span",Fl,"ğŸ“„ "+x(k.value)+" é¡µ",1)]),z.value?(c(),d("div",Ql,[b[8]||(b[8]=e("h4",null,"ğŸ“– æ•…äº‹æ¦‚è¦",-1)),e("p",Hl,x(z.value),1),s.value?.plot_threads?.length?(c(),d("div",Zl,[b[7]||(b[7]=e("span",null,"ä¸»é¢˜ï¼š",-1)),(c(!0),d(X,null,se(s.value.plot_threads.slice(0,5),p=>(c(),d("span",{key:p.id,class:"theme-tag"},x(p.name),1))),128))])):I("",!0)])):I("",!0),R.value.length>0?(c(),d("div",Gl,[b[9]||(b[9]=e("h4",null,"ğŸ‘¥ ä¸»è¦è§’è‰²",-1)),e("div",Jl,[(c(!0),d(X,null,se(R.value,p=>(c(),d("div",{key:p.name,class:"character-card",onClick:g=>j(p.first_appearance)},[e("div",Xl,x(p.name),1),e("div",Yl,x(p.description),1),e("div",ea,"é¦–æ¬¡å‡ºç°ï¼šç¬¬ "+x(p.first_appearance)+" é¡µ",1)],8,Wl))),128))])])):I("",!0),f.value&&T.value.length>0?(c(),d("div",ta,[...b[10]||(b[10]=[e("h4",null,"ğŸ­ å‰§æƒ…å‘å±•",-1)])])):I("",!0),f.value&&T.value.length>0?(c(),d("div",sa,[(c(!0),d(X,null,se(T.value,(p,g)=>(c(),d("div",{key:p.id||p.name,class:F(["timeline-group",{expanded:h(p.id||`arc-${g}`)}])},[e("div",na,[e("div",{class:"timeline-node-dot",onClick:m=>K(p.id||`arc-${g}`)},null,8,la),b[11]||(b[11]=e("div",{class:"timeline-node-line"},null,-1))]),e("div",aa,[e("div",{class:"timeline-card-header",onClick:m=>K(p.id||`arc-${g}`)},[e("img",{class:"timeline-thumbnail",src:N(p.page_range?.start||1),alt:`ç¬¬${p.page_range?.start||1}é¡µ`,loading:"lazy",onError:b[0]||(b[0]=m=>m.target.style.display="none"),onClick:ue(m=>j(p.page_range?.start||1),["stop"])},null,40,ia),e("div",ra,[e("span",ua," ç¬¬ "+x(p.page_range?.start||p.start_page||"?")+"-"+x(p.page_range?.end||p.end_page||"?")+" é¡µ ",1),e("span",ca,x(p.name),1)]),e("span",da,x(h(p.id||`arc-${g}`)?"â–¼":"â–¶"),1)],8,oa),p.description?(c(),d("div",pa,x(p.description),1)):I("",!0),p.mood?(c(),d("div",va,[b[12]||(b[12]=e("span",{class:"label"},"ğŸ¨ æ°›å›´ï¼š",-1)),Y(x(p.mood),1)])):I("",!0)])],2))),128))])):s.value?.groups&&s.value.groups.length>0?(c(),d("div",ga,[(c(!0),d(X,null,se(s.value.groups,p=>(c(),d("div",{key:p.id,class:F(["timeline-group",{expanded:h(p.id)}])},[e("div",ma,[e("div",{class:"timeline-node-dot",onClick:g=>K(p.id)},null,8,ha),b[13]||(b[13]=e("div",{class:"timeline-node-line"},null,-1))]),e("div",fa,[e("div",{class:"timeline-card-header",onClick:g=>K(p.id)},[e("img",{class:"timeline-thumbnail",src:N(p.thumbnail_page||p.page_range.start),alt:`ç¬¬${p.page_range.start}é¡µ`,loading:"lazy",onError:b[1]||(b[1]=g=>g.target.style.display="none"),onClick:ue(g=>j(p.page_range.start),["stop"])},null,40,ka),e("div",ya,[e("span",_a," ç¬¬ "+x(p.page_range.start)+"-"+x(p.page_range.end)+" é¡µ ",1),e("span",wa,x(p.events.length)+" ä¸ªäº‹ä»¶",1)]),e("span",xa,x(h(p.id)?"â–¼":"â–¶"),1)],8,ba),p.summary?(c(),d("div",$a,x(p.summary),1)):I("",!0),h(p.id)&&p.events.length>0?(c(),d("ul",Ca,[(c(!0),d(X,null,se(p.events,(g,m)=>(c(),d("li",{key:m,class:"timeline-event-item"},x(g),1))),128))])):I("",!0)])],2))),128))])):I("",!0),s.value?.plot_threads&&s.value.plot_threads.length>0?(c(),d("div",Sa,[b[14]||(b[14]=e("h4",null,"ğŸ”— ä¼ç¬”ä¸çº¿ç´¢",-1)),e("div",Pa,[(c(!0),d(X,null,se(s.value.plot_threads,p=>(c(),d("div",{key:p.id,class:F(["plot-thread-item",{resolved:p.status==="å·²è§£å†³"}])},[e("div",Aa,[e("span",Ta,x(p.name||"æœªå‘½åçº¿ç´¢"),1),e("span",{class:F(["thread-status",{resolved:p.status==="å·²è§£å†³"}])},x(p.status||"è¿›è¡Œä¸­"),3)]),p.description?(c(),d("p",Ia,x(p.description),1)):I("",!0),p.introduced_at?(c(),d("span",Ba,"ç¬¬ "+x(p.introduced_at)+" é¡µå¼•å…¥",1)):I("",!0)],2))),128))])])):I("",!0),v.value?I("",!0):(c(),d("div",Ra,' æš‚æ— è¯¦ç»†æ—¶é—´çº¿æ•°æ®ï¼Œç‚¹å‡»"é‡æ–°ç”Ÿæˆ"æŒ‰é’®ç”Ÿæˆ '))],64)):(c(),d("div",Vl,[b[4]||(b[4]=e("div",{class:"empty-icon"},"ğŸ“ˆ",-1)),b[5]||(b[5]=e("h4",null,"æ—¶é—´çº¿å°šæœªç”Ÿæˆ",-1)),b[6]||(b[6]=e("p",null,"å®Œæˆæ¼«ç”»åˆ†æåä¼šè‡ªåŠ¨ç”Ÿæˆæ—¶é—´çº¿ï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰‹åŠ¨ç”Ÿæˆ",-1)),e("button",{class:"btn btn-primary btn-sm",disabled:n.value,onClick:V},x(n.value?"ç”Ÿæˆä¸­...":"ç”Ÿæˆæ—¶é—´çº¿"),9,El)]))])]))}}),La=xe(za,[["__scopeId","data-v-d8519d79"]]),Ua={class:"qa-container"},Ma={key:0,class:"welcome-message"},qa={class:"message-avatar"},Va={key:0,src:Ts,alt:"ç”¨æˆ·",class:"avatar-img"},Ea={key:0,class:"message-content"},Oa={key:1,class:"message-content markdown-content"},Da={key:0,class:"loading-dots"},Na={key:0,class:"answer-mode-badge"},Ka=["innerHTML"],ja={key:1,class:"message-citations"},Fa=["onClick"],Qa=["disabled","onClick"],Ha={class:"chat-input-container"},Za={class:"chat-options"},Ga={class:"qa-mode-toggle",title:"ç²¾ç¡®æ¨¡å¼ï¼šä½¿ç”¨RAGæ£€ç´¢ç›¸å…³ç‰‡æ®µï¼›å…¨å±€æ¨¡å¼ï¼šä½¿ç”¨å…¨æ–‡æ‘˜è¦"},Ja={key:0,class:"precise-mode-options"},Wa={class:"checkbox-label compact",title:"å¯ç”¨çˆ¶å­å—æ¨¡å¼"},Xa={class:"checkbox-label compact",title:"å¯ç”¨æ¨ç†æ£€ç´¢"},Ya={class:"checkbox-label compact",title:"å¯ç”¨é‡æ’åº"},eo={class:"input-label compact",title:"è¿”å›çš„æœ€å¤§ç»“æœæ•°"},to={class:"input-label compact",title:"ç›¸å…³æ€§é˜ˆå€¼"},so={key:1,class:"global-mode-hint"},no={class:"chat-input-wrapper"},lo=["disabled"],ao=["disabled"],oo={key:0,class:"modal note-modal show"},io={class:"modal-content note-modal-content"},ro={class:"modal-body"},uo={key:0,class:"qa-preview"},co={class:"qa-preview-section"},po={class:"qa-preview-content"},vo={class:"qa-preview-section"},go=["innerHTML"],mo={key:0,class:"qa-preview-section"},ho={class:"qa-preview-citations"},fo={class:"note-form"},bo={class:"form-group"},ko={class:"form-group"},yo=ye({__name:"QAPanel",setup(a){const t=$e(),l=w(""),n=w("precise"),s=w(!0),o=w(!0),i=w(!0),v=w(5),u=w(0),k=w(null),f=L(()=>t.qaHistory),R=L(()=>t.isStreaming),T=L(()=>n.value==="precise");function z(A){n.value=A}async function U(){const A=l.value.trim();if(!A||!t.currentBookId||R.value)return;l.value="",t.clearQAHistory(),t.addQAMessage({id:Date.now().toString(),role:"user",content:A,timestamp:new Date().toISOString()}),await qt(),N();const $=n.value==="global"?"æ­£åœ¨åˆ†æå…¨æ–‡...":"æ€è€ƒä¸­...";t.addQAMessage({id:(Date.now()+1).toString(),role:"assistant",content:$,timestamp:new Date().toISOString(),isLoading:!0}),t.setStreaming(!0);try{const B=await(await fetch(`/api/manga-insight/${t.currentBookId}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:A,use_parent_child:s.value,use_reasoning:o.value,use_reranker:i.value,top_k:v.value,threshold:u.value,use_global_context:n.value==="global"})})).json();if(t.removeLoadingMessages(),B.success){const q=B.mode==="global"?"ğŸŒ å…¨å±€æ¨¡å¼":"ğŸ¯ ç²¾ç¡®æ¨¡å¼";t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:B.answer||"",timestamp:new Date().toISOString(),mode:q,citations:B.citations||[]})}else t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:"æŠ±æ­‰ï¼Œå¤„ç†é—®é¢˜æ—¶å‡ºé”™: "+(B.error||"æœªçŸ¥é”™è¯¯"),timestamp:new Date().toISOString()})}catch(P){console.error("é—®ç­”è¯·æ±‚å¤±è´¥:",P),t.removeLoadingMessages(),t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:"æŠ±æ­‰ï¼Œç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚",timestamp:new Date().toISOString()})}finally{t.setStreaming(!1),await qt(),N()}}function V(A){A.key==="Enter"&&!A.shiftKey&&(A.preventDefault(),U())}function N(){k.value&&(k.value.scrollTop=k.value.scrollHeight)}async function j(){t.currentBookId&&confirm("ç¡®å®šè¦é‡å»ºå‘é‡ç´¢å¼•å—ï¼Ÿè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚")&&console.log("é‡å»ºå‘é‡ç´¢å¼•")}function K(A){return A?G.parse(A):""}function h(A){t.setCurrentPage(A)}const C=w(!1),b=w(null),p=w(""),g=w("");function m(A){if(!t.currentBookId)return;const P=t.qaHistory.find(B=>B.role==="user")?.content||"";b.value={messageId:A.id,question:P,answer:A.content,citations:A.citations||[]},p.value="",g.value="",C.value=!0}function E(){C.value=!1,b.value=null}async function M(){if(!t.currentBookId||!b.value)return;const A=new Date().toISOString(),$={id:Date.now().toString(),type:"qa",title:p.value||b.value.question.substring(0,30),content:b.value.answer,question:b.value.question,answer:b.value.answer,citations:b.value.citations,comment:g.value||void 0,createdAt:A,updatedAt:A};try{await t.addNote($);const P=t.qaHistory.find(B=>B.id===b.value?.messageId);P&&(P.saved=!0),E()}catch(P){console.error("ä¿å­˜ç¬”è®°å¤±è´¥:",P),alert("ä¿å­˜ç¬”è®°å¤±è´¥")}}return ze(()=>{N()}),(A,$)=>(c(),d("div",Ua,[e("div",{ref_key:"messagesContainer",ref:k,class:"chat-messages"},[f.value.length===0?(c(),d("div",Ma,[...$[10]||($[10]=[e("div",{class:"welcome-icon"},"ğŸ’¬",-1),e("h3",null,"æ™ºèƒ½é—®ç­”",-1),e("p",null,"é’ˆå¯¹å·²åˆ†æçš„æ¼«ç”»å†…å®¹æé—®ï¼Œè·å–ç²¾å‡†å›ç­”",-1)])])):I("",!0),(c(!0),d(X,null,se(f.value,P=>(c(),d("div",{key:P.id,class:F(["chat-message",P.role])},[e("div",qa,[P.role==="user"?(c(),d("img",Va)):(c(),d(X,{key:1},[Y(" ğŸ¤– ")],64))]),P.role==="user"?(c(),d("div",Ea,x(P.content),1)):(c(),d("div",Oa,[P.isLoading?(c(),d("div",Da,x(P.content),1)):(c(),d(X,{key:1},[P.mode?(c(),d("div",Na,x(P.mode),1)):I("",!0),e("div",{class:"answer-text",innerHTML:K(P.content)},null,8,Ka),P.citations&&P.citations.length>0?(c(),d("div",ja,[$[11]||($[11]=e("span",null,"ğŸ“– å¼•ç”¨: ",-1)),(c(!0),d(X,null,se(P.citations,B=>(c(),d("span",{key:B.page,class:"citation-item",onClick:q=>h(B.page)}," ç¬¬"+x(B.page)+"é¡µ ",9,Fa))),128))])):I("",!0),P.content&&!P.isLoading?(c(),d("button",{key:2,class:F(["message-save-btn",{saved:P.saved}]),disabled:P.saved,onClick:B=>m(P)},x(P.saved?"âœ… å·²ä¿å­˜":"ğŸ“ ä¿å­˜ä¸ºç¬”è®°"),11,Qa)):I("",!0)],64))]))],2))),128))],512),e("div",Ha,[e("div",Za,[e("div",Ga,[e("button",{type:"button",class:F(["qa-mode-btn",{active:n.value==="precise"}]),onClick:$[0]||($[0]=P=>z("precise"))}," ğŸ¯ ç²¾ç¡®æ¨¡å¼ ",2),e("button",{type:"button",class:F(["qa-mode-btn",{active:n.value==="global"}]),onClick:$[1]||($[1]=P=>z("global"))}," ğŸŒ å…¨å±€æ¨¡å¼ ",2)]),$[20]||($[20]=e("span",{class:"chat-option-divider"},"|",-1)),T.value?(c(),d("div",Ja,[e("label",Wa,[D(e("input",{"onUpdate:modelValue":$[2]||($[2]=P=>s.value=P),type:"checkbox"},null,512),[[Te,s.value]]),$[12]||($[12]=e("span",null,"çˆ¶å­å—æ¨¡å¼",-1))]),e("label",Xa,[D(e("input",{"onUpdate:modelValue":$[3]||($[3]=P=>o.value=P),type:"checkbox"},null,512),[[Te,o.value]]),$[13]||($[13]=e("span",null,"æ¨ç†æ£€ç´¢",-1))]),e("label",Ya,[D(e("input",{"onUpdate:modelValue":$[4]||($[4]=P=>i.value=P),type:"checkbox"},null,512),[[Te,i.value]]),$[14]||($[14]=e("span",null,"é‡æ’åº",-1))]),$[17]||($[17]=e("span",{class:"chat-option-divider"},"|",-1)),e("label",eo,[$[15]||($[15]=e("span",null,"Top K:",-1)),D(e("input",{"onUpdate:modelValue":$[5]||($[5]=P=>v.value=P),type:"number",min:"1",max:"20",class:"input-small"},null,512),[[H,v.value,void 0,{number:!0}]])]),e("label",to,[$[16]||($[16]=e("span",null,"é˜ˆå€¼:",-1)),D(e("input",{"onUpdate:modelValue":$[6]||($[6]=P=>u.value=P),type:"number",min:"0",max:"1",step:"0.1",class:"input-small"},null,512),[[H,u.value,void 0,{number:!0}]])]),$[18]||($[18]=e("span",{class:"chat-option-divider"},"|",-1)),e("button",{type:"button",class:"btn btn-sm btn-secondary",title:"é‡å»ºå‘é‡ç´¢å¼•",onClick:j}," ğŸ”„ é‡å»ºå‘é‡ ")])):(c(),d("div",so,[...$[19]||($[19]=[e("span",{class:"hint-text"},"ğŸ’¡ å…¨å±€æ¨¡å¼ä½¿ç”¨å…¨æ–‡æ‘˜è¦å›ç­”ï¼Œé€‚åˆæ€»ç»“æ€§é—®é¢˜",-1)])]))]),e("div",no,[D(e("textarea",{"onUpdate:modelValue":$[7]||($[7]=P=>l.value=P),placeholder:"è¾“å…¥ä½ çš„é—®é¢˜...",rows:"1",disabled:R.value,onKeydown:V},null,40,lo),[[H,l.value]]),e("button",{class:"send-btn",disabled:R.value||!l.value.trim(),onClick:U},[...$[21]||($[21]=[e("span",null,"å‘é€",-1)])],8,ao)])]),C.value?(c(),d("div",oo,[e("div",{class:"modal-overlay",onClick:E}),e("div",io,[e("div",{class:"modal-header"},[$[22]||($[22]=e("h2",null,"ğŸ“ æ·»åŠ ç¬”è®°",-1)),e("button",{class:"modal-close",onClick:E},"Ã—")]),e("div",ro,[b.value?(c(),d("div",uo,[e("div",co,[$[23]||($[23]=e("label",null,"é—®é¢˜",-1)),e("div",po,x(b.value.question),1)]),e("div",vo,[$[24]||($[24]=e("label",null,"å›ç­”",-1)),e("div",{class:"qa-preview-content",innerHTML:K(b.value.answer)},null,8,go)]),b.value.citations.length>0?(c(),d("div",mo,[$[25]||($[25]=e("label",null,"å¼•ç”¨é¡µç ",-1)),e("div",ho,[(c(!0),d(X,null,se(b.value.citations,P=>(c(),d("span",{key:P.page,class:"qa-citation-badge"}," ç¬¬"+x(P.page)+"é¡µ ",1))),128))])])):I("",!0)])):I("",!0),e("div",fo,[e("div",bo,[$[26]||($[26]=e("label",{for:"qaNoteTitle"},[Y("ç¬”è®°æ ‡é¢˜ "),e("span",{class:"optional"},"(å¯é€‰)")],-1)),D(e("input",{"onUpdate:modelValue":$[8]||($[8]=P=>p.value=P),type:"text",id:"qaNoteTitle",class:"form-input",placeholder:"é»˜è®¤ä½¿ç”¨é—®é¢˜ä½œä¸ºæ ‡é¢˜..."},null,512),[[H,p.value]])]),e("div",ko,[$[27]||($[27]=e("label",{for:"qaNoteComment"},[Y("è¡¥å……è¯´æ˜ "),e("span",{class:"optional"},"(å¯é€‰)")],-1)),D(e("textarea",{"onUpdate:modelValue":$[9]||($[9]=P=>g.value=P),id:"qaNoteComment",class:"form-textarea",rows:"3",placeholder:"æ·»åŠ ä½ çš„è¯„è®ºæˆ–è¡¥å……..."},null,512),[[H,g.value]])])])]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-secondary",onClick:E},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:M},"ä¿å­˜ç¬”è®°")])])])):I("",!0)]))}}),_o=xe(yo,[["__scopeId","data-v-a6bdbb50"]]),wo={class:"workspace-section notes-section"},xo={class:"section-header-with-actions"},$o={class:"notes-filter"},Co={class:"notes-list"},So={key:0,class:"placeholder-text"},Po=["onClick"],Ao={class:"note-header"},To={class:"note-type-icon"},Io={class:"note-date"},Bo={class:"note-actions"},Ro=["onClick"],zo=["onClick"],Lo={key:0,class:"note-title"},Uo={key:1,class:"note-content"},Mo={class:"qa-preview-text"},qo={key:2,class:"note-content"},Vo={key:3,class:"note-tags"},Eo={key:4,class:"note-citations"},Oo=["onClick"],Do={key:0,class:"citation-badge"},No={key:5,class:"note-page-link"},Ko=["onClick"],jo={class:"modal-content modal-sm"},Fo={class:"modal-header"},Qo={class:"modal-body"},Ho={class:"qa-note-view"},Zo={class:"qa-section"},Go={class:"qa-content"},Jo={class:"qa-section"},Wo={class:"qa-content qa-answer"},Xo={key:0,class:"qa-section"},Yo={class:"qa-citations"},ei=["onClick"],ti={key:1,class:"qa-section"},si={class:"qa-content"},ni={class:"form-group"},li={class:"form-group"},ai={class:"form-group"},oi={class:"form-group"},ii={class:"form-group"},ri={class:"form-group"},ui={class:"modal-footer"},ci=["disabled"],di=ye({__name:"NotesPanel",setup(a){const t=[{label:"å…¨éƒ¨",value:"all"},{label:"æ–‡æœ¬ç¬”è®°",value:"text"},{label:"é—®ç­”ç¬”è®°",value:"qa"}],l=[{label:"æ–‡æœ¬ç¬”è®°",value:"text"},{label:"é—®ç­”ç¬”è®°",value:"qa"}],n=$e(),s=w(!1),o=w(null),i=w(""),v=w(""),u=w("text"),k=w(null),f=w(""),R=L(()=>n.filteredNotes),T=L({get:()=>n.noteTypeFilter,set:p=>n.setNoteTypeFilter(p)});function z(){o.value=null,i.value="",v.value="",u.value="text",k.value=n.selectedPageNum,f.value="",s.value=!0}function U(p){o.value=p,i.value=p.title||"",v.value=p.content,u.value=p.type,k.value=p.pageNum||null,f.value=(p.tags||[]).join(", "),s.value=!0}function V(){s.value=!1,o.value=null,i.value="",v.value="",f.value=""}function N(p){return p.trim()?p.split(/[,ï¼Œ]/).map(g=>g.trim()).filter(g=>g):[]}async function j(){if(!v.value.trim())return;const p=N(f.value);if(o.value)await n.updateNote(o.value.id,{title:i.value||void 0,content:v.value,type:u.value,pageNum:k.value||void 0,tags:p.length>0?p:void 0});else{const g={id:Date.now().toString(),type:u.value,title:i.value||void 0,content:v.value,pageNum:k.value||void 0,tags:p.length>0?p:void 0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await n.addNote(g)}V()}async function K(p){confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¬”è®°å—ï¼Ÿ")&&await n.deleteNote(p)}function h(p){n.selectPage(p)}function C(p){return new Date(p).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function b(p){return p==="qa"?"ğŸ’¬":"ğŸ“"}return(p,g)=>(c(),d("div",wo,[e("div",xo,[g[7]||(g[7]=e("h3",{class:"section-title"},"ğŸ“ ç¬”è®°",-1)),e("div",$o,[ne(ve,{modelValue:T.value,"onUpdate:modelValue":g[0]||(g[0]=m=>T.value=m),options:t},null,8,["modelValue"])])]),e("div",Co,[R.value.length===0?(c(),d("div",So," æš‚æ— ç¬”è®° ")):I("",!0),(c(!0),d(X,null,se(R.value,m=>(c(),d("div",{key:m.id,class:F(["note-item",{"qa-note":m.type==="qa"}]),onClick:E=>U(m)},[e("div",Ao,[e("span",To,x(b(m.type)),1),e("span",Io,x(C(m.createdAt)),1),e("div",Bo,[e("button",{class:"btn-icon-sm",title:"ç¼–è¾‘",onClick:ue(E=>U(m),["stop"])}," âœï¸ ",8,Ro),e("button",{class:"btn-icon-sm",title:"åˆ é™¤",onClick:ue(E=>K(m.id),["stop"])}," ğŸ—‘ï¸ ",8,zo)])]),m.title?(c(),d("div",Lo,x(m.title),1)):I("",!0),m.type==="qa"?(c(),d("div",Uo,[e("div",Mo,"Q: "+x(m.question?.substring(0,60))+"...",1)])):(c(),d("div",qo,x(m.content),1)),m.tags&&m.tags.length>0?(c(),d("div",Vo,[(c(!0),d(X,null,se(m.tags,E=>(c(),d("span",{key:E,class:"note-tag"},x(E),1))),128))])):I("",!0),m.type==="qa"&&m.citations&&m.citations.length>0?(c(),d("div",Eo,[(c(!0),d(X,null,se(m.citations.slice(0,3),E=>(c(),d("span",{key:E.page,class:"citation-badge",onClick:ue(M=>h(E.page),["stop"])}," ç¬¬"+x(E.page)+"é¡µ ",9,Oo))),128)),m.citations.length>3?(c(),d("span",Do,"+"+x(m.citations.length-3),1)):I("",!0)])):I("",!0),m.pageNum?(c(),d("div",No,[e("button",{class:"btn-link",onClick:ue(E=>h(m.pageNum),["stop"])}," ğŸ“„ ç¬¬ "+x(m.pageNum)+" é¡µ ",9,Ko)])):I("",!0)],10,Po))),128))]),e("button",{class:"btn btn-secondary btn-block btn-sm",onClick:z}," + æ·»åŠ ç¬”è®° "),s.value?(c(),d("div",{key:0,class:"modal show",onClick:ue(V,["self"])},[e("div",jo,[e("div",Fo,[e("h3",null,x(o.value?"ç¼–è¾‘ç¬”è®°":"æ·»åŠ ç¬”è®°"),1),e("button",{class:"modal-close",onClick:V},"Ã—")]),e("div",Qo,[o.value&&o.value.type==="qa"?(c(),d(X,{key:0},[e("div",Ho,[e("div",Zo,[g[8]||(g[8]=e("label",{class:"qa-label"},"é—®é¢˜",-1)),e("div",Go,x(o.value.question),1)]),e("div",Jo,[g[9]||(g[9]=e("label",{class:"qa-label"},"å›ç­”",-1)),e("div",Wo,x(o.value.answer),1)]),o.value.citations&&o.value.citations.length>0?(c(),d("div",Xo,[g[10]||(g[10]=e("label",{class:"qa-label"},"å¼•ç”¨é¡µç ",-1)),e("div",Yo,[(c(!0),d(X,null,se(o.value.citations,m=>(c(),d("span",{key:m.page,class:"qa-citation-badge",onClick:E=>h(m.page)}," ç¬¬"+x(m.page)+"é¡µ ",9,ei))),128))])])):I("",!0),o.value.comment?(c(),d("div",ti,[g[11]||(g[11]=e("label",{class:"qa-label"},"è¡¥å……è¯´æ˜",-1)),e("div",si,x(o.value.comment),1)])):I("",!0)]),e("div",ni,[g[12]||(g[12]=e("label",null,[Y("ç¬”è®°æ ‡é¢˜ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),D(e("input",{"onUpdate:modelValue":g[1]||(g[1]=m=>i.value=m),type:"text",class:"form-input",placeholder:"ä¿®æ”¹æ ‡é¢˜..."},null,512),[[H,i.value]])])],64)):(c(),d(X,{key:1},[e("div",li,[g[13]||(g[13]=e("label",null,"ç¬”è®°ç±»å‹",-1)),ne(ve,{modelValue:u.value,"onUpdate:modelValue":g[2]||(g[2]=m=>u.value=m),options:l},null,8,["modelValue"])]),e("div",ai,[g[14]||(g[14]=e("label",null,[Y("æ ‡é¢˜ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),D(e("input",{"onUpdate:modelValue":g[3]||(g[3]=m=>i.value=m),type:"text",class:"form-input",placeholder:"ç»™ç¬”è®°èµ·ä¸ªæ ‡é¢˜..."},null,512),[[H,i.value]])]),e("div",oi,[g[15]||(g[15]=e("label",null,[Y("å†…å®¹ "),e("span",{class:"label-required"},"*")],-1)),D(e("textarea",{"onUpdate:modelValue":g[4]||(g[4]=m=>v.value=m),class:"form-textarea",rows:"5",placeholder:"å†™ä¸‹ä½ çš„æƒ³æ³•..."},null,512),[[H,v.value]])]),e("div",ii,[g[16]||(g[16]=e("label",null,[Y("å…³è”é¡µç  "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),D(e("input",{"onUpdate:modelValue":g[5]||(g[5]=m=>k.value=m),type:"number",class:"form-input",placeholder:"è¾“å…¥é¡µç ",min:"1"},null,512),[[H,k.value,void 0,{number:!0}]])]),e("div",ri,[g[17]||(g[17]=e("label",null,[Y("æ ‡ç­¾ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),D(e("input",{"onUpdate:modelValue":g[6]||(g[6]=m=>f.value=m),type:"text",class:"form-input",placeholder:"å¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”ï¼Œå¦‚: è§’è‰²,å‰§æƒ…"},null,512),[[H,f.value]])])],64))]),e("div",ui,[e("button",{class:"btn btn-secondary",onClick:V},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:o.value?.type!=="qa"&&!v.value.trim(),onClick:j}," ä¿å­˜ ",8,ci)])])])):I("",!0)]))}}),pi=xe(di,[["__scopeId","data-v-0971eaea"]]),vi={class:"workspace-section page-detail-section"},gi={class:"page-detail"},mi={key:0,class:"placeholder-text"},hi={key:1,class:"loading-state"},fi={key:2,class:"page-detail-content"},bi={class:"page-detail-header"},ki={class:"page-nav-buttons"},yi=["disabled"],_i={class:"page-indicator"},wi=["disabled"],xi={key:0,class:"error-message"},$i=["src","alt"],Ci={key:1,class:"page-summary"},Si={key:2,class:"page-summary empty"},Pi={key:3,class:"scene-mood-info"},Ai={key:0,class:"info-item"},Ti={class:"info-value"},Ii={key:1,class:"info-item"},Bi={class:"info-value"},Ri={key:4,class:"dialogues-section"},zi={class:"dialogue-speaker"},Li={class:"dialogue-text"},Ui={key:0,class:"dialogue-original"},Mi={key:5,class:"dialogues-section empty"},qi={class:"page-detail-actions"},Vi=["disabled"],Ei={key:0,class:"btn-spinner"},Oi=["src","alt"],Di={class:"preview-nav"},Ni=["disabled"],Ki={class:"preview-page-info"},ji=["disabled"],Fi=ye({__name:"PageDetail",setup(a){const t=$e(),l=w(null),n=w(!1),s=w(!1),o=w(!1),i=w(""),v=L(()=>t.selectedPageNum),u=L(()=>t.totalPageCount),k=L(()=>v.value!==null&&v.value>1),f=L(()=>v.value!==null&&v.value<u.value),R=L(()=>!t.currentBookId||!v.value?"":qs(t.currentBookId,v.value)),T=L(()=>{if(!l.value?.panels)return[];const g=[];for(const m of l.value.panels)if(m.dialogues)for(const E of m.dialogues){const M=E.translated_text||E.text;M&&g.push({speaker:E.speaker_name||E.character||"æœªçŸ¥",text:M,originalText:E.text!==E.translated_text?E.text:void 0})}return g}),z=L(()=>l.value?.analyzed===!0||!!l.value?.page_summary),U=L(()=>l.value?.scene||""),V=L(()=>l.value?.mood||"");async function N(){if(!t.currentBookId||!v.value){l.value=null;return}n.value=!0,i.value="";try{const g=await Ms(t.currentBookId,v.value);g.success?g.analysis?l.value=g.analysis:g.page?l.value=g.page:l.value=null:(l.value=null,g.error&&(i.value=g.error))}catch(g){console.error("åŠ è½½é¡µé¢è¯¦æƒ…å¤±è´¥:",g),l.value=null,i.value=g instanceof Error?g.message:"åŠ è½½å¤±è´¥"}finally{n.value=!1}}function j(){k.value&&v.value&&t.selectPage(v.value-1)}function K(){f.value&&v.value&&t.selectPage(v.value+1)}async function h(){if(!(!t.currentBookId||!v.value)){s.value=!0,i.value="";try{const g=await Qt(t.currentBookId,v.value);g.success?await N():i.value=g.error||"é‡æ–°åˆ†æå¤±è´¥"}catch(g){console.error("é‡æ–°åˆ†æå¤±è´¥:",g),i.value=g instanceof Error?g.message:"é‡æ–°åˆ†æå¤±è´¥"}finally{s.value=!1}}}function C(){o.value=!0}function b(){o.value=!1}function p(g){if(o.value)switch(g.key){case"Escape":b();break;case"ArrowLeft":k.value&&j();break;case"ArrowRight":f.value&&K();break}}return Ke(v,()=>{N()},{immediate:!0}),(g,m)=>(c(),d("div",vi,[m[12]||(m[12]=e("h3",{class:"section-title"},"ğŸ“„ é¡µé¢è¯¦æƒ…",-1)),e("div",gi,[v.value?n.value?(c(),d("div",hi,[...m[3]||(m[3]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"åŠ è½½ä¸­...",-1)])])):(c(),d("div",fi,[e("div",bi,[e("h4",null,"ğŸ“„ ç¬¬ "+x(v.value)+" é¡µ",1),e("div",ki,[e("button",{class:F(["btn-page-nav",{disabled:!k.value}]),disabled:!k.value,title:"ä¸Šä¸€é¡µ (â†)",onClick:j}," â—€ ä¸Šä¸€å¼  ",10,yi),e("span",_i,x(v.value)+" / "+x(u.value),1),e("button",{class:F(["btn-page-nav",{disabled:!f.value}]),disabled:!f.value,title:"ä¸‹ä¸€é¡µ (â†’)",onClick:K}," ä¸‹ä¸€å¼  â–¶ ",10,wi)])]),i.value?(c(),d("div",xi," âš ï¸ "+x(i.value),1)):I("",!0),e("div",{class:"page-detail-image",onClick:C},[e("img",{src:R.value,alt:`ç¬¬${v.value}é¡µ`,onError:m[0]||(m[0]=E=>E.target.style.display="none")},null,40,$i),m[4]||(m[4]=e("div",{class:"image-overlay"},[e("span",{class:"zoom-hint"},"ğŸ” ç‚¹å‡»æ”¾å¤§")],-1))]),e("div",{class:F(["analysis-status-tag",{analyzed:z.value}])},x(z.value?"âœ“ å·²åˆ†æ":"â—‹ æœªåˆ†æ"),3),l.value?.page_summary?(c(),d("div",Ci,[m[5]||(m[5]=e("h5",null,"ğŸ“ é¡µé¢æ‘˜è¦",-1)),e("p",null,x(l.value.page_summary),1)])):(c(),d("div",Si,[...m[6]||(m[6]=[e("p",null,"æ­¤é¡µå°šæœªåˆ†æï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹åˆ†æ",-1)])])),U.value||V.value?(c(),d("div",Pi,[U.value?(c(),d("div",Ai,[m[7]||(m[7]=e("span",{class:"info-label"},"ğŸ¬ åœºæ™¯ï¼š",-1)),e("span",Ti,x(U.value),1)])):I("",!0),V.value?(c(),d("div",Ii,[m[8]||(m[8]=e("span",{class:"info-label"},"ğŸ­ æ°›å›´ï¼š",-1)),e("span",Bi,x(V.value),1)])):I("",!0)])):I("",!0),T.value.length>0?(c(),d("div",Ri,[e("h5",null,"ğŸ’¬ å¯¹è¯å†…å®¹ ("+x(T.value.length)+")",1),(c(!0),d(X,null,se(T.value,(E,M)=>(c(),d("div",{key:M,class:"dialogue-item"},[e("div",zi,[m[9]||(m[9]=e("span",{class:"speaker-icon"},"ğŸ‘¤",-1)),Y(" "+x(E.speaker),1)]),e("div",Li,x(E.text),1),E.originalText?(c(),d("div",Ui,[m[10]||(m[10]=e("span",{class:"original-label"},"åŸæ–‡ï¼š",-1)),Y(x(E.originalText),1)])):I("",!0)]))),128))])):z.value?(c(),d("div",Mi,[...m[11]||(m[11]=[e("p",null,"æ­¤é¡µæ²¡æœ‰æ£€æµ‹åˆ°å¯¹è¯å†…å®¹",-1)])])):I("",!0),e("div",qi,[e("button",{class:F(["btn btn-secondary btn-sm",{loading:s.value}]),disabled:s.value,onClick:h},[s.value?(c(),d("span",Ei)):I("",!0),Y(" "+x(s.value?"åˆ†æä¸­...":"ğŸ”„ é‡æ–°åˆ†æ"),1)],10,Vi)])])):(c(),d("div",mi,[...m[2]||(m[2]=[e("div",{class:"empty-icon"},"ğŸ“„",-1),e("p",null,"ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ‘ä¸­çš„é¡µé¢æŸ¥çœ‹è¯¦æƒ…",-1)])]))]),o.value?(c(),d("div",{key:0,class:"image-preview-modal",tabindex:"0",onClick:b,onKeydown:p},[e("div",{class:"image-preview-content",onClick:m[1]||(m[1]=ue(()=>{},["stop"]))},[e("button",{class:"preview-close",title:"å…³é—­ (Esc)",onClick:b},"Ã—"),e("img",{src:R.value,alt:`ç¬¬${v.value}é¡µ`},null,8,Oi),e("div",Di,[e("button",{class:"preview-nav-btn prev",disabled:!k.value,title:"ä¸Šä¸€é¡µ (â†)",onClick:ue(j,["stop"])}," â—€ ",8,Ni),e("span",Ki,x(v.value)+" / "+x(u.value),1),e("button",{class:"preview-nav-btn next",disabled:!f.value,title:"ä¸‹ä¸€é¡µ (â†’)",onClick:ue(K,["stop"])}," â–¶ ",8,ji)])])],32)):I("",!0)]))}}),Qi=xe(Fi,[["__scopeId","data-v-7c4b8a3c"]]),Hi={class:"sidebar-section pages-tree-section"},Zi={class:"section-header"},Gi={class:"page-count-badge"},Ji={class:"pages-tree"},Wi={key:0,class:"empty-hint"},Xi={key:1,class:"tree-all-pages"},Yi=["data-page","onClick"],er=["src","alt"],tr={class:"tree-page-num"},sr={key:2,class:"tree-load-more"},nr=["onClick"],lr={class:"tree-chapter-info"},ar={class:"tree-chapter-title"},or={class:"tree-chapter-meta"},ir=["onClick"],rr={class:"tree-pages-grid"},ur=["data-page","onClick","onContextmenu"],cr=["src","alt"],dr={class:"tree-page-num"},pr=ye({__name:"PagesTree",setup(a){const t=$e(),l=w(new Set),n=w(new Map),s=w(100),o=L(()=>t.chapters),i=L(()=>t.totalPageCount);function v(b){l.value.has(b)?l.value.delete(b):l.value.add(b)}function u(b){return l.value.has(b)}function k(b){t.selectPage(b)}function f(b){return n.value.get(b)||!1}function R(b){return t.selectedPageNum===b}function T(b,p){const g=[];for(let m=b;m<=p;m++)g.push(m);return g}function z(b){return t.currentBookId?Ht(t.currentBookId,b):""}function U(){s.value=Math.min(s.value+100,i.value)}function V(b){const p=b.target;p.style.opacity="0"}function N(b){const p=b.endPage-b.startPage+1;let g=0;for(let m=b.startPage;m<=b.endPage;m++)n.value.get(m)&&g++;return g===p}async function j(b){if(confirm("ç¡®å®šè¦é‡æ–°åˆ†ææ­¤ç« èŠ‚å—ï¼Ÿ"))try{const g=await(await fetch(`/api/manga-insight/${t.currentBookId}/reanalyze/chapter/${b}`,{method:"POST"})).json();g.success?alert("ç« èŠ‚åˆ†æå·²å¯åŠ¨"):alert("å¯åŠ¨å¤±è´¥: "+(g.error||"æœªçŸ¥é”™è¯¯"))}catch(p){console.error("é‡æ–°åˆ†æç« èŠ‚å¤±è´¥:",p),alert("é‡æ–°åˆ†æå¤±è´¥")}}function K(b,p){const g=prompt(`ç¬¬ ${p} é¡µæ“ä½œ:
1. æŸ¥çœ‹è¯¦æƒ…
2. é‡æ–°åˆ†æ
3. æ·»åŠ ç¬”è®°

è¯·è¾“å…¥æ•°å­—:`);g==="1"?k(p):g==="2"?h(p):g==="3"&&alert("ç¬”è®°åŠŸèƒ½å¼€å‘ä¸­")}async function h(b){try{const p=await Qt(t.currentBookId,b);p.success?alert(`ç¬¬ ${b} é¡µåˆ†æå·²å¯åŠ¨`):alert("åˆ†æå¤±è´¥: "+(p.error||"æœªçŸ¥é”™è¯¯"))}catch(p){console.error("é‡æ–°åˆ†æé¡µé¢å¤±è´¥:",p),alert("é‡æ–°åˆ†æå¤±è´¥")}}async function C(){if(t.currentBookId)try{const p=await(await fetch(`/api/manga-insight/${t.currentBookId}/pages`)).json();p.success&&p.pages&&p.pages.forEach(m=>{n.value.set(m,!0)})}catch(b){console.error("åŠ è½½å·²åˆ†æé¡µé¢å¤±è´¥:",b)}}return ze(async()=>{await C(),o.value.length>0&&o.value[0]&&l.value.add(o.value[0].id)}),(b,p)=>(c(),d("div",Hi,[e("div",Zi,[p[2]||(p[2]=e("h3",{class:"section-title"},"å†…å®¹å¯¼èˆª",-1)),e("span",Gi,x(i.value)+"é¡µ",1)]),e("div",Ji,[o.value.length===0?(c(),d(X,{key:0},[i.value===0?(c(),d("div",Wi," æš‚æ— é¡µé¢ ")):(c(),d("div",Xi,[(c(!0),d(X,null,se(T(1,Math.min(i.value,s.value)),g=>(c(),d("div",{key:g,class:F(["tree-page-item",{selected:R(g),analyzed:f(g)}]),"data-page":g,onClick:m=>k(g)},[e("img",{src:z(g),alt:`ç¬¬${g}é¡µ`,class:"tree-page-thumb",loading:"lazy",onError:p[0]||(p[0]=m=>V(m))},null,40,er),e("span",tr,x(g),1)],10,Yi))),128))])),i.value>s.value?(c(),d("div",sr,[e("button",{class:"btn-load-more",onClick:U}," åŠ è½½æ›´å¤š (è¿˜æœ‰ "+x(i.value-s.value)+" é¡µ) ",1)])):I("",!0)],64)):(c(!0),d(X,{key:1},se(o.value,g=>(c(),d("div",{key:g.id,class:F(["tree-chapter",{expanded:u(g.id)}])},[e("div",{class:"tree-chapter-header",onClick:m=>v(g.id)},[p[3]||(p[3]=e("span",{class:"tree-expand-icon"},[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8 5l8 7-8 7z"})])],-1)),e("div",lr,[e("span",ar,x(g.title),1),e("span",or,x(g.endPage-g.startPage+1)+"é¡µ",1)]),e("span",{class:F(["tree-chapter-status",{analyzed:N(g)}])},null,2),e("button",{class:"btn-reanalyze-chapter",title:"é‡æ–°åˆ†ææ­¤ç« èŠ‚",onClick:ue(m=>j(g.id),["stop"])}," ğŸ”„ ",8,ir)],8,nr),e("div",rr,[(c(!0),d(X,null,se(T(g.startPage,g.endPage),m=>(c(),d("div",{key:m,class:F(["tree-page-item",{selected:R(m),analyzed:f(m)}]),"data-page":m,onClick:E=>k(m),onContextmenu:ue(E=>K(E,m),["prevent"])},[e("img",{src:z(m),alt:`ç¬¬${m}é¡µ`,class:"tree-page-thumb",loading:"lazy",onError:p[1]||(p[1]=E=>V(E))},null,40,cr),e("span",dr,x(m),1)],42,ur))),128))])],2))),128))])]))}}),vr=xe(pr,[["__scopeId","data-v-df8466b3"]]),gr={class:"settings-tabs"},mr={key:1,class:"insight-settings-content"},hr={class:"form-group"},fr={class:"form-group"},br={class:"form-group"},kr={key:0,class:"form-group"},yr={class:"form-row"},_r={class:"form-group"},wr={class:"form-group"},xr={class:"form-group"},$r={class:"checkbox-label"},Cr={class:"form-group"},Sr={class:"checkbox-label"},Pr={class:"form-group"},Ar=["disabled"],Tr={key:2,class:"insight-settings-content"},Ir={class:"form-group"},Br={class:"checkbox-label"},Rr={class:"form-group"},zr={class:"form-group"},Lr={class:"form-group"},Ur={key:0,class:"form-group"},Mr={class:"form-group"},qr={class:"checkbox-label"},Vr={key:3,class:"insight-settings-content"},Er={class:"form-group"},Or={class:"form-hint"},Dr={class:"form-group"},Nr={class:"form-group"},Kr={class:"form-hint"},jr={key:0,style:{"margin-top":"16px"}},Fr={style:{"margin-bottom":"8px"}},Qr={style:{"min-width":"50px",color:"#666","font-size":"13px"}},Hr=["value","disabled","onChange"],Zr=["value","disabled","title","onChange"],Gr={style:{display:"flex","flex-direction":"column","align-items":"center",gap:"2px","font-size":"11px",cursor:"pointer","min-width":"40px","text-align":"center"}},Jr=["checked","onChange"],Wr=["onClick"],Xr={class:"batch-info-box"},Yr={class:"layers-preview-list"},eu={key:0,class:"align-badge"},tu={class:"batch-estimate-box"},su={key:4,class:"insight-settings-content"},nu={class:"form-group"},lu={class:"form-group"},au={class:"form-group"},ou={key:0,class:"form-group"},iu={class:"form-group"},ru=["disabled"],uu={key:5,class:"insight-settings-content"},cu={class:"form-group"},du={class:"form-group"},pu={class:"form-group"},vu={key:0,class:"form-group"},gu={class:"form-group"},mu=["disabled"],hu={key:6,class:"insight-settings-content prompts-settings"},fu={class:"form-group"},bu={class:"form-hint"},ku={class:"form-group"},yu={class:"prompts-library-section"},_u={class:"library-header"},wu={class:"library-actions"},xu={class:"saved-prompts-list"},$u={key:0,class:"loading-text"},Cu={key:1,class:"placeholder-text"},Su=["onClick"],Pu={class:"prompt-name"},Au={class:"prompt-type-badge"},Tu=["onClick"],Iu=["disabled"],Bu=ye({__name:"InsightSettingsModal",emits:["close"],setup(a,{emit:t}){const l=t,n=$e(),s=w("vlm"),o=w(!1),i=w(!1),v=w(""),u=w(""),k=w(n.config.vlm.provider),f=w(n.config.vlm.apiKey),R=w(n.config.vlm.model),T=w(n.config.vlm.baseUrl),z=w(n.config.vlm.rpmLimit),U=w(n.config.vlm.temperature),V=w(n.config.vlm.forceJson),N=w(n.config.vlm.useStream),j=w(n.config.vlm.imageMaxSize),K=w(n.config.llm.useSameAsVlm),h=w(n.config.llm.provider),C=w(n.config.llm.apiKey),b=w(n.config.llm.model),p=w(n.config.llm.baseUrl),g=w(n.config.llm.useStream),m=w(n.config.batch.pagesPerBatch),E=w(n.config.batch.contextBatchCount),M=w(n.config.batch.architecturePreset),A={simple:{name:"ç®€æ´æ¨¡å¼",description:"é€‚åˆ100é¡µä»¥å†…çš„çŸ­ç¯‡æ¼«ç”»",layers:[{name:"æ‰¹é‡åˆ†æ",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},standard:{name:"æ ‡å‡†æ¨¡å¼",description:"é€‚åˆå¤§å¤šæ•°æ¼«ç”»ï¼Œå¹³è¡¡æ•ˆæœä¸é€Ÿåº¦",layers:[{name:"æ‰¹é‡åˆ†æ",units:5,align:!1},{name:"æ®µè½æ€»ç»“",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},chapter_based:{name:"ç« èŠ‚æ¨¡å¼",description:"é€‚åˆæœ‰æ˜ç¡®ç« èŠ‚åˆ’åˆ†çš„æ¼«ç”»ï¼Œä¼šåœ¨ç« èŠ‚è¾¹ç•Œå¤„åˆ‡åˆ†",layers:[{name:"æ‰¹é‡åˆ†æ",units:5,align:!0},{name:"ç« èŠ‚æ€»ç»“",units:0,align:!0},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},full:{name:"å®Œæ•´æ¨¡å¼",description:"é€‚åˆé•¿ç¯‡è¿è½½ï¼Œæä¾›æœ€è¯¦ç»†çš„åˆ†å±‚æ€»ç»“",layers:[{name:"æ‰¹é‡åˆ†æ",units:5,align:!1},{name:"å°æ€»ç»“",units:5,align:!1},{name:"ç« èŠ‚æ€»ç»“",units:0,align:!0},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]}},$=w(n.config.batch.customLayers?.length>0?n.config.batch.customLayers.map(_=>({name:_.name,units:_.units_per_group??_.units??5,align:_.align_to_chapter??_.align??!1})):[{name:"æ‰¹é‡åˆ†æ",units:5,align:!1},{name:"æ®µè½æ€»ç»“",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]),P=w(n.config.embedding.provider),B=w(n.config.embedding.apiKey),q=w(n.config.embedding.model),te=w(n.config.embedding.baseUrl),le=w(n.config.embedding.rpmLimit),ce=w(n.config.reranker.provider),_e=w(n.config.reranker.apiKey),ge=w(n.config.reranker.model),Pe=w(n.config.reranker.baseUrl),Re=w(n.config.reranker.topK),ie=w("batch_analysis"),oe=w(""),me=w({}),re=w([]),Le=w(!1),Fe=[{value:"gemini",label:"Google Gemini"},{value:"openai",label:"OpenAI"},{value:"qwen",label:"é˜¿é‡Œé€šä¹‰åƒé—®"},{value:"siliconflow",label:"SiliconFlow"},{value:"deepseek",label:"DeepSeek"},{value:"volcano",label:"ç«å±±å¼•æ“"},{value:"custom",label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹"}],tt=[{value:"openai",label:"OpenAI"},{value:"siliconflow",label:"SiliconFlow"},{value:"custom",label:"è‡ªå®šä¹‰"}],st=[{value:"jina",label:"Jina AI"},{value:"cohere",label:"Cohere"},{value:"siliconflow",label:"SiliconFlow"},{value:"custom",label:"è‡ªå®šä¹‰"}],nt=[{value:"simple",label:"ç®€æ´æ¨¡å¼ - æ‰¹é‡åˆ†æ â†’ å…¨ä¹¦æ€»ç»“ï¼ˆçŸ­ç¯‡ï¼‰"},{value:"standard",label:"æ ‡å‡†æ¨¡å¼ - æ‰¹é‡åˆ†æ â†’ æ®µè½æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"chapter_based",label:"ç« èŠ‚æ¨¡å¼ - æ‰¹é‡åˆ†æ â†’ ç« èŠ‚æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"full",label:"å®Œæ•´æ¨¡å¼ - æ‰¹é‡åˆ†æ â†’ å°æ€»ç»“ â†’ ç« èŠ‚æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"custom",label:"è‡ªå®šä¹‰æ¨¡å¼ - å®Œå…¨è‡ªå®šä¹‰å±‚çº§æ¶æ„"}],lt=[{value:"batch_analysis",label:"ğŸ“„ æ‰¹é‡åˆ†ææç¤ºè¯"},{value:"segment_summary",label:"ğŸ“‘ æ®µè½æ€»ç»“æç¤ºè¯"},{value:"chapter_summary",label:"ğŸ“– ç« èŠ‚æ€»ç»“æç¤ºè¯"},{value:"qa_response",label:"ğŸ’¬ é—®ç­”å“åº”æç¤ºè¯"}],at={gemini:"gemini-2.0-flash",openai:"gpt-4o",qwen:"qwen-vl-max",deepseek:"deepseek-chat",siliconflow:"Qwen/Qwen2.5-VL-72B-Instruct",volcano:"doubao-1.5-vision-pro-32k"},ot={gemini:"gemini-2.0-flash",openai:"gpt-4o-mini",qwen:"qwen-turbo",deepseek:"deepseek-chat",siliconflow:"Qwen/Qwen2.5-72B-Instruct",volcano:"doubao-1.5-pro-32k"},Qe={openai:"text-embedding-3-small",siliconflow:"BAAI/bge-m3"},it={jina:"jina-reranker-v2-base-multilingual",cohere:"rerank-multilingual-v3.0",siliconflow:"BAAI/bge-reranker-v2-m3"},rt=L(()=>k.value==="custom"),ut=L(()=>h.value==="custom"),ct=L(()=>P.value==="custom"),dt=L(()=>ce.value==="custom"),pt=L(()=>`æ¯æ‰¹æ¬¡åˆ†æ ${m.value||5} é¡µ`),vt=L(()=>M.value==="custom"),gt=L(()=>M.value==="custom"?"å®Œå…¨è‡ªå®šä¹‰å±‚çº§æ¶æ„ï¼Œçµæ´»é…ç½®åˆ†ææµç¨‹":A[M.value]?.description||"æ ¹æ®æ¼«ç”»ç±»å‹é€‰æ‹©åˆé€‚çš„åˆ†ææ¶æ„"),mt=L(()=>{if(M.value==="custom")return $.value;const _=A[M.value];return _?_.layers:A.standard.layers});function Ce(_){s.value=_,v.value="",u.value=""}function Ue(){l("close")}function ke(){const _=$.value.length-1;$.value.splice(_,0,{name:`æ±‡æ€»å±‚${_}`,units:5,align:!1})}function ht(_){_>0&&_<$.value.length-1&&$.value.splice(_,1)}function Me(_,r,S){$.value[_]&&($.value[_][r]=S,_===0&&r==="units"&&(m.value=S))}function ft(){$.value.length>0&&$.value[0]&&($.value[0].units=m.value)}function bt(_){return _>0&&_<$.value.length-1&&$.value.length>2}function kt(_){return _>0&&_<$.value.length-1}function y(_){return _<$.value.length-1}function O(_){return _===0?"æ¯æ‰¹åˆ†æçš„é¡µæ•°":"æ¯ç»„åŒ…å«å•å…ƒæ•°ï¼ˆ0=å…¨éƒ¨æ±‡æ€»ï¼‰"}function Z(){const _=at[k.value];_&&(R.value=_)}function he(){const _=ot[h.value];_&&(b.value=_)}function Se(){K.value||C.value||(h.value=k.value,C.value=f.value,b.value=R.value,p.value=T.value)}function Lt(){const _=Qe[P.value];_&&(q.value=_)}function Ae(){const _=it[ce.value];_&&(ge.value=_)}function J(_,r){v.value=_,u.value=r,setTimeout(()=>{v.value="",u.value=""},3e3)}async function qe(){if(!i.value){i.value=!0,v.value="";try{const _=await Ks({provider:k.value,api_key:f.value,model:R.value,base_url:T.value||void 0});_.success?J("VLM è¿æ¥æˆåŠŸ","success"):J("è¿æ¥å¤±è´¥: "+(_.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(_){J("æµ‹è¯•å¤±è´¥: "+(_ instanceof Error?_.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{i.value=!1}}}async function us(){if(!i.value){i.value=!0,v.value="";try{const _=await js({provider:P.value,api_key:B.value,model:q.value,base_url:te.value||void 0});_.success?J("Embedding è¿æ¥æˆåŠŸ","success"):J("è¿æ¥å¤±è´¥: "+(_.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(_){J("æµ‹è¯•å¤±è´¥: "+(_ instanceof Error?_.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{i.value=!1}}}async function cs(){if(!i.value){i.value=!0,v.value="";try{const _=await Fs({provider:ce.value,api_key:_e.value,model:ge.value,base_url:Pe.value||void 0});_.success?J("Reranker è¿æ¥æˆåŠŸ","success"):J("è¿æ¥å¤±è´¥: "+(_.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(_){J("æµ‹è¯•å¤±è´¥: "+(_ instanceof Error?_.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{i.value=!1}}}async function ds(){Le.value=!0;try{const _=await Qs();_.success&&_.library&&(re.value=_.library)}catch(_){console.error("åŠ è½½æç¤ºè¯åº“å¤±è´¥:",_),re.value=[]}finally{Le.value=!1}}function Ut(){oe.value&&(me.value[ie.value]=oe.value);const _=ie.value;oe.value=me.value[_]||_t[_]||""}function ps(){if(confirm("ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯å—ï¼Ÿå½“å‰ç¼–è¾‘çš„å†…å®¹å°†ä¸¢å¤±ã€‚")){const _=ie.value;oe.value=_t[_]||"",delete me.value[_],J("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯","success")}}async function vs(){try{await navigator.clipboard.writeText(oe.value),J("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿","success")}catch{J("å¤åˆ¶å¤±è´¥","error")}}async function gs(){const _=oe.value.trim();if(!_){J("æç¤ºè¯å†…å®¹ä¸èƒ½ä¸ºç©º","error");return}const r=prompt("è¯·è¾“å…¥æç¤ºè¯åç§°ï¼š");if(!r||!r.trim())return;const S={id:Date.now().toString(),name:r.trim(),type:ie.value,content:_,created_at:new Date().toISOString()};try{const W=await Hs(S);W.success?(re.value.push(S),J("æç¤ºè¯å·²ä¿å­˜åˆ°åº“","success")):J("ä¿å­˜å¤±è´¥: "+(W.error||"æœªçŸ¥é”™è¯¯"),"error")}catch{J("ä¿å­˜å¤±è´¥","error")}}function ms(_){ie.value=_.type,oe.value=_.content,me.value[_.type]=_.content,J(`å·²åŠ è½½æç¤ºè¯: ${_.name}`,"success")}async function hs(_){if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæç¤ºè¯å—ï¼Ÿ"))try{(await Zs(_)).success?(re.value=re.value.filter(S=>S.id!==_),J("æç¤ºè¯å·²åˆ é™¤","success")):J("åˆ é™¤å¤±è´¥","error")}catch{J("åˆ é™¤å¤±è´¥","error")}}function fs(){oe.value&&(me.value[ie.value]=oe.value);const _={version:"1.0",exported_at:new Date().toISOString(),prompts:me.value,library:re.value},r=new Blob([JSON.stringify(_,null,2)],{type:"application/json"}),S=URL.createObjectURL(r),W=document.createElement("a");W.href=S,W.download=`manga-insight-prompts-${new Date().toISOString().slice(0,10)}.json`,W.click(),URL.revokeObjectURL(S),J("æç¤ºè¯å·²å¯¼å‡º","success")}function bs(){const _=document.getElementById("promptsFileInput");_&&_.click()}async function ks(_){const r=_.target,S=r.files?.[0];if(S){try{const W=await S.text(),de=JSON.parse(W);if(de.prompts&&(me.value={...me.value,...de.prompts}),de.library&&Array.isArray(de.library)){const ws=new Set(re.value.map(He=>He.id));for(const He of de.library)ws.has(He.id)||re.value.push(He);await Gs(re.value)}Ut(),J("æç¤ºè¯å¯¼å…¥æˆåŠŸ","success")}catch(W){console.error("å¯¼å…¥å¤±è´¥:",W),J("å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼","error")}r.value=""}}async function ys(){if(!o.value){o.value=!0;try{n.updateVlmConfig({provider:k.value,apiKey:f.value,model:R.value,baseUrl:T.value,rpmLimit:z.value,temperature:U.value,forceJson:V.value,useStream:N.value,imageMaxSize:j.value}),n.updateLlmConfig({useSameAsVlm:K.value,provider:h.value,apiKey:C.value,model:b.value,baseUrl:p.value,useStream:g.value}),n.updateEmbeddingConfig({provider:P.value,apiKey:B.value,model:q.value,baseUrl:te.value,rpmLimit:le.value}),n.updateRerankerConfig({provider:ce.value,apiKey:_e.value,model:ge.value,baseUrl:Pe.value,topK:Re.value}),n.updateBatchConfig({pagesPerBatch:m.value,contextBatchCount:E.value,architecturePreset:M.value});const _=n.getConfigForApi(),r=await Ns(_);r.success?(J("è®¾ç½®å·²ä¿å­˜","success"),setTimeout(()=>{Ue()},500)):J("ä¿å­˜å¤±è´¥: "+(r.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(_){J("ä¿å­˜å¤±è´¥: "+(_ instanceof Error?_.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{o.value=!1}}}async function _s(){try{n.loadConfigFromStorage();const _=await Ds();_.success&&_.config&&n.setConfigFromApi(_.config),Mt()}catch(_){console.error("åŠ è½½é…ç½®å¤±è´¥:",_),Mt()}}function Mt(){k.value=n.config.vlm.provider,f.value=n.config.vlm.apiKey,R.value=n.config.vlm.model,T.value=n.config.vlm.baseUrl,z.value=n.config.vlm.rpmLimit,U.value=n.config.vlm.temperature,V.value=n.config.vlm.forceJson,N.value=n.config.vlm.useStream,j.value=n.config.vlm.imageMaxSize,K.value=n.config.llm.useSameAsVlm,h.value=n.config.llm.provider,C.value=n.config.llm.apiKey,b.value=n.config.llm.model,p.value=n.config.llm.baseUrl,g.value=n.config.llm.useStream,P.value=n.config.embedding.provider,B.value=n.config.embedding.apiKey,q.value=n.config.embedding.model,te.value=n.config.embedding.baseUrl,le.value=n.config.embedding.rpmLimit,ce.value=n.config.reranker.provider,_e.value=n.config.reranker.apiKey,ge.value=n.config.reranker.model,Pe.value=n.config.reranker.baseUrl,Re.value=n.config.reranker.topK,m.value=n.config.batch.pagesPerBatch,E.value=n.config.batch.contextBatchCount,M.value=n.config.batch.architecturePreset}return ze(async()=>{await _s(),await ds(),oe.value=me.value[ie.value]||_t[ie.value]||""}),(_,r)=>(c(),De(Is,{title:"æ¼«ç”»åˆ†æè®¾ç½®",size:"large",customClass:"insight-settings-modal",onClose:Ue},{footer:Ge(()=>[e("button",{class:"btn btn-secondary",onClick:Ue},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:o.value,onClick:ys},x(o.value?"ä¿å­˜ä¸­...":"ä¿å­˜"),9,Iu)]),default:Ge(()=>[e("div",gr,[e("button",{class:F(["settings-tab",{active:s.value==="vlm"}]),onClick:r[0]||(r[0]=S=>Ce("vlm"))}," ğŸ–¼ï¸ VLM å¤šæ¨¡æ€ ",2),e("button",{class:F(["settings-tab",{active:s.value==="llm"}]),onClick:r[1]||(r[1]=S=>Ce("llm"))}," ğŸ’¬ LLM å¯¹è¯ ",2),e("button",{class:F(["settings-tab",{active:s.value==="batch"}]),onClick:r[2]||(r[2]=S=>Ce("batch"))}," ğŸ“Š æ‰¹é‡åˆ†æ ",2),e("button",{class:F(["settings-tab",{active:s.value==="embedding"}]),onClick:r[3]||(r[3]=S=>Ce("embedding"))}," ğŸ”¢ å‘é‡æ¨¡å‹ ",2),e("button",{class:F(["settings-tab",{active:s.value==="reranker"}]),onClick:r[4]||(r[4]=S=>Ce("reranker"))}," ğŸ”„ é‡æ’åº ",2),e("button",{class:F(["settings-tab",{active:s.value==="prompts"}]),onClick:r[5]||(r[5]=S=>Ce("prompts"))}," ğŸ“ æç¤ºè¯ ",2)]),v.value?(c(),d("div",{key:0,class:F(["test-message",u.value])},x(v.value),3)):I("",!0),s.value==="vlm"?(c(),d("div",mr,[r[50]||(r[50]=e("p",{class:"settings-hint"},"VLMï¼ˆè§†è§‰è¯­è¨€æ¨¡å‹ï¼‰ç”¨äºåˆ†ææ¼«ç”»å›¾ç‰‡å†…å®¹ï¼Œæå–å¯¹è¯å’Œåœºæ™¯ä¿¡æ¯ã€‚",-1)),e("div",hr,[r[36]||(r[36]=e("label",null,"æœåŠ¡å•†",-1)),ne(ve,{modelValue:k.value,"onUpdate:modelValue":r[6]||(r[6]=S=>k.value=S),options:Fe,onChange:Z},null,8,["modelValue"])]),e("div",fr,[r[37]||(r[37]=e("label",null,"API Key",-1)),D(e("input",{"onUpdate:modelValue":r[7]||(r[7]=S=>f.value=S),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[H,f.value]])]),e("div",br,[r[38]||(r[38]=e("label",null,"æ¨¡å‹",-1)),D(e("input",{"onUpdate:modelValue":r[8]||(r[8]=S=>R.value=S),type:"text",placeholder:"ä¾‹å¦‚: gemini-2.0-flash"},null,512),[[H,R.value]])]),rt.value?(c(),d("div",kr,[r[39]||(r[39]=e("label",null,"Base URL",-1)),D(e("input",{"onUpdate:modelValue":r[9]||(r[9]=S=>T.value=S),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[H,T.value]])])):I("",!0),e("div",yr,[e("div",_r,[r[40]||(r[40]=e("label",null,"RPM é™åˆ¶",-1)),D(e("input",{"onUpdate:modelValue":r[10]||(r[10]=S=>z.value=S),type:"number",min:"1",max:"100"},null,512),[[H,z.value,void 0,{number:!0}]]),r[41]||(r[41]=e("p",{class:"form-hint"},"æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°",-1))]),e("div",wr,[r[42]||(r[42]=e("label",null,"æ¸©åº¦",-1)),D(e("input",{"onUpdate:modelValue":r[11]||(r[11]=S=>U.value=S),type:"number",min:"0",max:"1",step:"0.1"},null,512),[[H,U.value,void 0,{number:!0}]]),r[43]||(r[43]=e("p",{class:"form-hint"},"0-1ï¼Œè¶Šä½è¶Šç¡®å®š",-1))])]),e("div",xr,[e("label",$r,[D(e("input",{"onUpdate:modelValue":r[12]||(r[12]=S=>V.value=S),type:"checkbox"},null,512),[[Te,V.value]]),r[44]||(r[44]=e("span",null,"å¼ºåˆ¶ JSON è¾“å‡º",-1))]),r[45]||(r[45]=e("p",{class:"form-hint"},"å¯¹ OpenAI å…¼å®¹ API å¯ç”¨ response_format: json_object",-1))]),e("div",Cr,[e("label",Sr,[D(e("input",{"onUpdate:modelValue":r[13]||(r[13]=S=>N.value=S),type:"checkbox"},null,512),[[Te,N.value]]),r[46]||(r[46]=e("span",null,"ä½¿ç”¨æµå¼è¯·æ±‚",-1))]),r[47]||(r[47]=e("p",{class:"form-hint"},"æµå¼è¯·æ±‚å¯é¿å…é•¿æ—¶é—´ç­‰å¾…å¯¼è‡´çš„è¶…æ—¶é—®é¢˜",-1))]),e("div",Pr,[r[48]||(r[48]=e("label",null,"å›¾ç‰‡å‹ç¼©ï¼ˆæœ€å¤§è¾¹é•¿ï¼‰",-1)),D(e("input",{"onUpdate:modelValue":r[14]||(r[14]=S=>j.value=S),type:"number",min:"0",max:"4096",step:"128",placeholder:"0 è¡¨ç¤ºä¸å‹ç¼©"},null,512),[[H,j.value,void 0,{number:!0}]]),r[49]||(r[49]=e("p",{class:"form-hint"},"å‘é€å‰å°†å›¾ç‰‡ç­‰æ¯”ä¾‹ç¼©æ”¾åˆ°æŒ‡å®šæœ€å¤§è¾¹é•¿ï¼ˆåƒç´ ï¼‰ï¼Œ0 è¡¨ç¤ºä¸å‹ç¼©",-1))]),e("button",{class:"btn btn-secondary",disabled:i.value,onClick:qe},x(i.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,Ar)])):I("",!0),s.value==="llm"?(c(),d("div",Tr,[r[57]||(r[57]=e("p",{class:"settings-hint"},"LLMï¼ˆå¯¹è¯æ¨¡å‹ï¼‰ç”¨äºç”Ÿæˆæ•…äº‹æ¦‚è¦ã€æ™ºèƒ½é—®ç­”ç­‰æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ã€‚",-1)),e("div",Ir,[e("label",Br,[D(e("input",{"onUpdate:modelValue":r[15]||(r[15]=S=>K.value=S),type:"checkbox",onChange:Se},null,544),[[Te,K.value]]),r[51]||(r[51]=e("span",null,"ä½¿ç”¨ä¸ VLM ç›¸åŒçš„é…ç½®",-1))])]),K.value?I("",!0):(c(),d(X,{key:0},[e("div",Rr,[r[52]||(r[52]=e("label",null,"æœåŠ¡å•†",-1)),ne(ve,{modelValue:h.value,"onUpdate:modelValue":r[16]||(r[16]=S=>h.value=S),options:Fe,onChange:he},null,8,["modelValue"])]),e("div",zr,[r[53]||(r[53]=e("label",null,"API Key",-1)),D(e("input",{"onUpdate:modelValue":r[17]||(r[17]=S=>C.value=S),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[H,C.value]])]),e("div",Lr,[r[54]||(r[54]=e("label",null,"æ¨¡å‹",-1)),D(e("input",{"onUpdate:modelValue":r[18]||(r[18]=S=>b.value=S),type:"text",placeholder:"ä¾‹å¦‚: gpt-4o-mini"},null,512),[[H,b.value]])]),ut.value?(c(),d("div",Ur,[r[55]||(r[55]=e("label",null,"Base URL",-1)),D(e("input",{"onUpdate:modelValue":r[19]||(r[19]=S=>p.value=S),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[H,p.value]])])):I("",!0),e("div",Mr,[e("label",qr,[D(e("input",{"onUpdate:modelValue":r[20]||(r[20]=S=>g.value=S),type:"checkbox"},null,512),[[Te,g.value]]),r[56]||(r[56]=e("span",null,"ä½¿ç”¨æµå¼è¯·æ±‚",-1))])])],64))])):I("",!0),s.value==="batch"?(c(),d("div",Vr,[r[68]||(r[68]=e("p",{class:"settings-hint"},"é…ç½®æ‰¹é‡åˆ†æçš„å‚æ•°ï¼Œå½±å“åˆ†æé€Ÿåº¦å’Œè´¨é‡ã€‚",-1)),e("div",Er,[r[58]||(r[58]=e("label",null,"æ¯æ‰¹æ¬¡åˆ†æé¡µæ•°",-1)),D(e("input",{"onUpdate:modelValue":r[21]||(r[21]=S=>m.value=S),type:"number",min:"1",max:"10",onChange:ft},null,544),[[H,m.value,void 0,{number:!0}]]),e("p",Or,"æ¯æ¬¡å‘é€ç»™ VLM çš„å›¾ç‰‡æ•°é‡ï¼Œå»ºè®® 3-5 å¼ ã€‚"+x(pt.value),1)]),e("div",Dr,[r[59]||(r[59]=e("label",null,"ä¸Šæ–‡å‚è€ƒæ‰¹æ¬¡æ•°",-1)),D(e("input",{"onUpdate:modelValue":r[22]||(r[22]=S=>E.value=S),type:"number",min:"0",max:"5"},null,512),[[H,E.value,void 0,{number:!0}]]),r[60]||(r[60]=e("p",{class:"form-hint"},"æ¯æ‰¹åˆ†ææ—¶å‚è€ƒå‰å‡ æ‰¹çš„ç»“æœä½œä¸ºä¸Šä¸‹æ–‡ï¼Œ0 è¡¨ç¤ºä¸å‚è€ƒ",-1))]),e("div",Nr,[r[61]||(r[61]=e("label",null,"åˆ†ææ¶æ„",-1)),ne(ve,{modelValue:M.value,"onUpdate:modelValue":r[23]||(r[23]=S=>M.value=S),options:nt},null,8,["modelValue"]),e("p",Kr,x(gt.value),1)]),vt.value?(c(),d("div",jr,[r[63]||(r[63]=e("label",{style:{display:"block","margin-bottom":"8px","font-weight":"500","font-size":"14px"}},"è‡ªå®šä¹‰å±‚çº§",-1)),e("div",Fr,[(c(!0),d(X,null,se($.value,(S,W)=>(c(),d("div",{key:W,style:{display:"flex","flex-direction":"row",gap:"8px","align-items":"center","margin-bottom":"8px",padding:"12px",background:"#f5f5f5","border-radius":"8px",border:"1px solid #e0e0e0"}},[e("span",Qr,"ç¬¬"+x(W+1)+"å±‚",1),e("input",{type:"text",value:S.name,disabled:!kt(W),placeholder:"å±‚çº§åç§°",style:{flex:"1",padding:"8px 12px",border:"1px solid #e0e0e0","border-radius":"6px","font-size":"14px"},onChange:de=>Me(W,"name",de.target.value)},null,40,Hr),e("input",{type:"number",value:S.units,disabled:!y(W),title:O(W),min:"0",max:"20",style:{width:"70px",padding:"8px 12px",border:"1px solid #e0e0e0","border-radius":"6px","font-size":"14px"},onChange:de=>Me(W,"units",parseInt(de.target.value)||0)},null,40,Zr),e("label",Gr,[e("input",{type:"checkbox",checked:S.align,style:{width:"16px",height:"16px"},onChange:de=>Me(W,"align",de.target.checked)},null,40,Jr),r[62]||(r[62]=e("span",{style:{"line-height":"1.2"}},[Y("ç« èŠ‚"),e("br"),Y("å¯¹é½")],-1))]),bt(W)?(c(),d("button",{key:0,type:"button",style:{padding:"6px 12px",background:"#ef4444",color:"white",border:"none","border-radius":"6px",cursor:"pointer","font-size":"13px","font-weight":"500"},onClick:de=>ht(W)}," åˆ é™¤ ",8,Wr)):I("",!0)]))),128))]),e("button",{type:"button",class:"btn btn-sm",style:{"margin-top":"4px",border:"1px solid #e0e0e0"},onClick:ke}," + æ·»åŠ å±‚çº§ "),r[64]||(r[64]=e("p",{class:"form-hint"},"ç¬¬ä¸€å±‚å›ºå®šä¸ºæ‰¹é‡åˆ†æï¼Œæœ€åä¸€å±‚å›ºå®šä¸ºå…¨ä¹¦æ€»ç»“ã€‚ä¸­é—´å¯æ·»åŠ ä»»æ„æ±‡æ€»å±‚çº§ã€‚",-1))])):I("",!0),e("div",Xr,[r[65]||(r[65]=e("h4",null,"å½“å‰æ¶æ„é¢„è§ˆ",-1)),e("ul",Yr,[(c(!0),d(X,null,se(mt.value,(S,W)=>(c(),d("li",{key:W},[e("strong",null,"ç¬¬"+x(W+1)+"å±‚ - "+x(S.name),1),Y(" "+x(S.units>0?` - æ¯${S.units}ä¸ªå•å…ƒæ±‡æ€»`:" - æ±‡æ€»å…¨éƒ¨")+" ",1),S.align?(c(),d("span",eu,"(æŒ‰ç« èŠ‚å¯¹é½)")):I("",!0)]))),128))])]),e("div",tu,[e("p",null,[r[66]||(r[66]=Y("å½“å‰é…ç½®ï¼šæ¯ ",-1)),e("strong",null,x(m.value),1),r[67]||(r[67]=Y(" é¡µä¸€æ‰¹",-1))])])])):I("",!0),s.value==="embedding"?(c(),d("div",su,[r[75]||(r[75]=e("p",{class:"settings-hint"},"Embeddingï¼ˆå‘é‡åŒ–æ¨¡å‹ï¼‰ç”¨äºå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢å’Œé—®ç­”åŠŸèƒ½ã€‚",-1)),e("div",nu,[r[69]||(r[69]=e("label",null,"æœåŠ¡å•†",-1)),ne(ve,{modelValue:P.value,"onUpdate:modelValue":r[24]||(r[24]=S=>P.value=S),options:tt,onChange:Lt},null,8,["modelValue"])]),e("div",lu,[r[70]||(r[70]=e("label",null,"API Key",-1)),D(e("input",{"onUpdate:modelValue":r[25]||(r[25]=S=>B.value=S),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[H,B.value]])]),e("div",au,[r[71]||(r[71]=e("label",null,"æ¨¡å‹",-1)),D(e("input",{"onUpdate:modelValue":r[26]||(r[26]=S=>q.value=S),type:"text",placeholder:"ä¾‹å¦‚: text-embedding-3-small"},null,512),[[H,q.value]])]),ct.value?(c(),d("div",ou,[r[72]||(r[72]=e("label",null,"Base URL",-1)),D(e("input",{"onUpdate:modelValue":r[27]||(r[27]=S=>te.value=S),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[H,te.value]])])):I("",!0),e("div",iu,[r[73]||(r[73]=e("label",null,"RPM é™åˆ¶",-1)),D(e("input",{"onUpdate:modelValue":r[28]||(r[28]=S=>le.value=S),type:"number",min:"0",max:"1000"},null,512),[[H,le.value,void 0,{number:!0}]]),r[74]||(r[74]=e("p",{class:"form-hint"},"æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°ï¼Œ0 è¡¨ç¤ºä¸é™åˆ¶",-1))]),e("button",{class:"btn btn-secondary",disabled:i.value,onClick:us},x(i.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,ru)])):I("",!0),s.value==="reranker"?(c(),d("div",uu,[r[82]||(r[82]=e("p",{class:"settings-hint"},"Rerankerï¼ˆé‡æ’åºæ¨¡å‹ï¼‰ç”¨äºå¯¹æœç´¢ç»“æœè¿›è¡Œé‡æ–°æ’åºï¼Œæé«˜é—®ç­”å‡†ç¡®æ€§ã€‚",-1)),e("div",cu,[r[76]||(r[76]=e("label",null,"æœåŠ¡å•†",-1)),ne(ve,{modelValue:ce.value,"onUpdate:modelValue":r[29]||(r[29]=S=>ce.value=S),options:st,onChange:Ae},null,8,["modelValue"])]),e("div",du,[r[77]||(r[77]=e("label",null,"API Key",-1)),D(e("input",{"onUpdate:modelValue":r[30]||(r[30]=S=>_e.value=S),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[H,_e.value]])]),e("div",pu,[r[78]||(r[78]=e("label",null,"æ¨¡å‹",-1)),D(e("input",{"onUpdate:modelValue":r[31]||(r[31]=S=>ge.value=S),type:"text",placeholder:"ä¾‹å¦‚: jina-reranker-v2-base-multilingual"},null,512),[[H,ge.value]])]),dt.value?(c(),d("div",vu,[r[79]||(r[79]=e("label",null,"Base URL",-1)),D(e("input",{"onUpdate:modelValue":r[32]||(r[32]=S=>Pe.value=S),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[H,Pe.value]])])):I("",!0),e("div",gu,[r[80]||(r[80]=e("label",null,"Top K",-1)),D(e("input",{"onUpdate:modelValue":r[33]||(r[33]=S=>Re.value=S),type:"number",min:"1",max:"20"},null,512),[[H,Re.value,void 0,{number:!0}]]),r[81]||(r[81]=e("p",{class:"form-hint"},"é‡æ’åºåè¿”å›çš„ç»“æœæ•°é‡",-1))]),e("button",{class:"btn btn-secondary",disabled:i.value,onClick:cs},x(i.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,mu)])):I("",!0),s.value==="prompts"?(c(),d("div",hu,[r[86]||(r[86]=e("p",{class:"settings-hint"},"è‡ªå®šä¹‰åˆ†æè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æç¤ºè¯æ¨¡æ¿ã€‚",-1)),e("div",fu,[r[83]||(r[83]=e("label",null,"æç¤ºè¯ç±»å‹",-1)),ne(ve,{modelValue:ie.value,"onUpdate:modelValue":r[34]||(r[34]=S=>ie.value=S),options:lt,onChange:Ut},null,8,["modelValue"]),e("p",bu,x(Vt[ie.value]?.hint),1)]),e("div",ku,[r[84]||(r[84]=e("label",null,"æç¤ºè¯å†…å®¹",-1)),D(e("textarea",{"onUpdate:modelValue":r[35]||(r[35]=S=>oe.value=S),class:"prompt-editor",rows:"12",placeholder:"è¾“å…¥æç¤ºè¯å†…å®¹..."},null,512),[[H,oe.value]])]),e("div",{class:"prompt-actions-bar"},[e("button",{class:"btn btn-secondary btn-sm",onClick:ps,title:"é‡ç½®ä¸ºé»˜è®¤"}," ğŸ”„ é‡ç½® "),e("button",{class:"btn btn-secondary btn-sm",onClick:vs,title:"å¤åˆ¶åˆ°å‰ªè´´æ¿"}," ğŸ“‹ å¤åˆ¶ "),e("button",{class:"btn btn-primary btn-sm",onClick:gs,title:"ä¿å­˜åˆ°åº“"}," ğŸ’¾ ä¿å­˜åˆ°åº“ ")]),r[87]||(r[87]=e("hr",{class:"section-divider"},null,-1)),e("div",yu,[e("div",_u,[r[85]||(r[85]=e("h4",null,"ğŸ“š æç¤ºè¯åº“",-1)),e("div",wu,[e("button",{class:"btn btn-secondary btn-sm",onClick:fs,title:"å¯¼å‡ºæ‰€æœ‰æç¤ºè¯"}," ğŸ“¤ å¯¼å‡º "),e("button",{class:"btn btn-secondary btn-sm",onClick:bs,title:"å¯¼å…¥æç¤ºè¯"}," ğŸ“¥ å¯¼å…¥ "),e("input",{id:"promptsFileInput",type:"file",accept:".json",style:{display:"none"},onChange:ks},null,32)])]),e("div",xu,[Le.value?(c(),d("div",$u,"åŠ è½½ä¸­...")):re.value.length===0?(c(),d("div",Cu," æš‚æ— ä¿å­˜çš„æç¤ºè¯ ")):(c(!0),d(X,{key:2},se(re.value,S=>(c(),d("div",{key:S.id,class:"saved-prompt-item",onClick:W=>ms(S)},[e("span",Pu,x(S.name),1),e("span",Au,x(Vt[S.type]?.label||S.type),1),e("button",{class:"btn-icon-sm",onClick:ue(W=>hs(S.id),["stop"]),title:"åˆ é™¤"}," ğŸ—‘ï¸ ",8,Tu)],8,Su))),128))])])])):I("",!0)]),_:1}))}}),Ru={class:"insight-page"},zu={class:"app-header"},Lu={class:"header-content"},Uu={class:"logo-container"},Mu={class:"header-links"},qu={class:"insight-main"},Vu={class:"sidebar-section book-info-section"},Eu={class:"book-cover-wrapper"},Ou=["src"],Du={key:1,class:"book-cover-placeholder"},Nu=["title"],Ku={class:"book-meta"},ju={class:"meta-item"},Fu={id:"totalPages"},Qu={class:"meta-item"},Hu={id:"analyzedPages"},Zu={class:"insight-content"},Gu={key:0,class:"select-book-prompt"},Ju={key:1,class:"content-tabs"},Wu={class:"tabs-wrapper"},Xu={class:"tab-content"},Yu={class:"tab-content"},ec={class:"tab-content"},tc=ye({__name:"InsightView",setup(a){const t=Cs(),l=As(),n=$e(),s=Ft(),o=w("overview"),i=w(!1),v=w(!1),u=w(!1);let k=null;const f=w(null),R=L(()=>f.value?f.value:n.currentBookId?s.books.find(M=>M.id===n.currentBookId):null),T=L(()=>!!n.currentBookId),z=L(()=>R.value?.cover?R.value.cover:"");function U(M){o.value=M}async function V(M){if(M){n.setCurrentBook(M),n.setLoading(!0);try{const $=await(await fetch(`/api/bookshelf/books/${M}`)).json();if(!$.success)throw new Error($.error||"è·å–ä¹¦ç±ä¿¡æ¯å¤±è´¥");if($.book&&(f.value={id:$.book.id,title:$.book.title,cover:$.book.cover,total_pages:$.book.total_pages||0},n.setBookTotalPages($.book.total_pages||0),$.book.chapters&&$.book.chapters.length>0)){let P=0;const B=$.book.chapters.map((q,te)=>{const le=q.id||q.chapter_id||`ch_${te+1}`,ce=q.page_count||q.pages?.length||0,_e=P+1,ge=P+ce;return P=ge,{id:le,title:q.title||`ç¬¬ ${te+1} ç« `,startPage:_e,endPage:ge}});n.setChapters(B)}if(await N(),n.chapters.length===0)try{const P=await Vs(M);P.success&&P.chapters&&P.chapters.length>0&&n.setChapters(P.chapters.map(B=>({id:B.id,title:B.title,startPage:B.start_page,endPage:B.end_page})))}catch(P){console.warn("è·å–ç« èŠ‚åˆ—è¡¨å¤±è´¥:",P)}await n.loadNotesFromAPI(),n.analyzedPageCount>0&&await h(),l.replace({query:{book:M}}),n.isAnalyzing&&j()}catch(A){console.error("åŠ è½½ä¹¦ç±å¤±è´¥:",A),n.setError(A instanceof Error?A.message:"åŠ è½½ä¹¦ç±å¤±è´¥")}finally{n.setLoading(!1)}}}async function N(){if(n.currentBookId)try{const M=await Us(n.currentBookId);if(M.success)if(M.analyzed_pages_count!==void 0&&n.setAnalyzedPagesCount(M.analyzed_pages_count),M.current_task){const A=M.current_task.status;A==="running"?(n.setAnalysisStatus("running"),M.current_task.progress&&n.updateProgress(M.current_task.progress.analyzed_pages||0,M.current_task.progress.total_pages||0)):A==="paused"?n.setAnalysisStatus("paused"):A==="completed"?n.setAnalysisStatus("completed"):A==="failed"?n.setAnalysisStatus("failed"):n.setAnalysisStatus("idle")}else M.analyzed?n.setAnalysisStatus("completed"):n.setAnalysisStatus("idle")}catch(M){console.error("è·å–åˆ†æçŠ¶æ€å¤±è´¥:",M)}}function j(){K(),k=setInterval(async()=>{await N(),n.isAnalyzing||K()},3e3)}function K(){k&&(clearInterval(k),k=null)}async function h(){if(n.currentBookId)try{const M=await Gt(n.currentBookId);let A="story_summary";M.success&&M.generated&&M.generated.length>0&&(A=M.generated[0],n.setGeneratedTemplates(M.generated));try{const P=await Zt(n.currentBookId,A);P.success&&P.content&&n.setOverview({type:A,content:P.content})}catch(P){console.warn("åŠ è½½æ¦‚è§ˆå¤±è´¥:",P)}const $=await Jt(n.currentBookId);$.success&&n.setTimeline($)}catch(M){console.error("åŠ è½½æ¦‚è§ˆæ•°æ®å¤±è´¥:",M)}}function C(){i.value=!0}function b(){i.value=!1}function p(){v.value=!v.value,v.value&&(u.value=!1)}function g(){u.value=!u.value,u.value&&(v.value=!1)}function m(){n.currentBookId?l.push({path:"/translate",query:{book:n.currentBookId}}):l.push("/translate")}function E(){document.body.classList.toggle("dark-mode")}return ze(async()=>{await s.fetchBooks();const M=t.query.book;M&&await V(M)}),Ss(()=>{K()}),Ke(()=>n.isAnalyzing,M=>{M?j():K()}),(M,A)=>{const $=Ps("router-link");return c(),d("div",Ru,[e("header",zu,[e("div",Lu,[e("div",Uu,[ne($,{to:"/",title:"ä¹¦æ¶é¦–é¡µ"},{default:Ge(()=>[...A[3]||(A[3]=[e("img",{src:"/pic/logo.png",alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",Mu,[ne($,{to:"/",class:"nav-link"},{default:Ge(()=>[...A[4]||(A[4]=[Y("ğŸ“š ä¹¦æ¶",-1)])]),_:1}),e("a",{href:"javascript:void(0)",class:"nav-link",onClick:m},"ğŸŒ ç¿»è¯‘"),A[6]||(A[6]=e("span",{class:"nav-link active"},"ğŸ” åˆ†æ",-1)),e("button",{id:"settingsBtn",class:"btn btn-icon",title:"è®¾ç½®",onClick:C},"âš™ï¸"),e("button",{id:"themeToggle",class:"theme-toggle",title:"åˆ‡æ¢äº®æš—æ¨¡å¼",onClick:E},[...A[5]||(A[5]=[e("span",{class:"theme-icon light-icon"},"â˜€ï¸",-1),e("span",{class:"theme-icon dark-icon"},"ğŸŒ™",-1)])])])])]),e("main",qu,[e("aside",{class:F(["insight-sidebar",{"mobile-visible":v.value}])},[e("div",Vu,[e("div",Eu,[z.value?(c(),d("img",{key:0,src:z.value,alt:"å°é¢",class:"book-cover"},null,8,Ou)):(c(),d("div",Du,[...A[7]||(A[7]=[e("span",null,"ğŸ“–",-1)])]))]),e("h2",{class:"book-title",title:R.value?.title},x(R.value?.title||"é€‰æ‹©ä¹¦ç±"),9,Nu),e("div",Ku,[e("span",ju,[A[8]||(A[8]=e("span",{class:"meta-icon"},"ğŸ“„",-1)),e("span",Fu,x(R.value?.total_pages||0),1),A[9]||(A[9]=Y(" é¡µ ",-1))]),e("span",Qu,[A[10]||(A[10]=e("span",{class:"meta-icon"},"ğŸ“Š",-1)),e("span",Hu,x(pe(n).analyzedPageCount),1),A[11]||(A[11]=Y(" å·²åˆ†æ ",-1))])])]),T.value?(c(),De($n,{key:0,onStartPolling:j,onStopPolling:K})):I("",!0),T.value?(c(),De(vr,{key:1})):I("",!0)],2),e("div",Zu,[T.value?(c(),d("div",Ju,[e("button",{class:"mobile-nav-btn",onClick:p,"aria-label":"æ‰“å¼€å¯¼èˆª"}," ğŸ“š "),e("div",Wu,[e("button",{class:F(["tab-btn",{active:o.value==="overview"}]),onClick:A[0]||(A[0]=P=>U("overview"))},[...A[15]||(A[15]=[e("span",{class:"tab-icon"},"ğŸ“Š",-1),Y(" æ¦‚è§ˆ ",-1)])],2),e("button",{class:F(["tab-btn",{active:o.value==="qa"}]),onClick:A[1]||(A[1]=P=>U("qa"))},[...A[16]||(A[16]=[e("span",{class:"tab-icon"},"ğŸ’¬",-1),Y(" æ™ºèƒ½é—®ç­” ",-1)])],2),e("button",{class:F(["tab-btn",{active:o.value==="timeline"}]),onClick:A[2]||(A[2]=P=>U("timeline"))},[...A[17]||(A[17]=[e("span",{class:"tab-icon"},"ğŸ“ˆ",-1),Y(" æ—¶é—´çº¿ ",-1)])],2)]),e("button",{class:"mobile-nav-btn",onClick:g,"aria-label":"æ‰“å¼€ç¬”è®°"}," ğŸ“ ")])):(c(),d("div",Gu,[A[12]||(A[12]=e("div",{class:"prompt-icon"},"ğŸ“š",-1)),A[13]||(A[13]=e("h2",null,"é€‰æ‹©è¦åˆ†æçš„ä¹¦ç±",-1)),A[14]||(A[14]=e("p",null,"ä»ä¸‹æ–¹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€æœ¬ä¹¦ç±å¼€å§‹æ™ºèƒ½åˆ†æ",-1)),ne(Xs,{onSelect:V})])),D(e("div",Xu,[ne(Il)],512),[[yt,o.value==="overview"&&T.value]]),D(e("div",Yu,[ne(_o)],512),[[yt,o.value==="qa"&&T.value]]),D(e("div",ec,[ne(La)],512),[[yt,o.value==="timeline"&&T.value]])]),T.value?(c(),d("aside",{key:0,class:F(["insight-workspace",{"mobile-visible":u.value}])},[ne(Qi),ne(pi)],2)):I("",!0)]),i.value?(c(),De(Bu,{key:0,onClose:b})):I("",!0)])}}}),cc=xe(tc,[["__scopeId","data-v-6e13be02"]]);export{cc as default};
