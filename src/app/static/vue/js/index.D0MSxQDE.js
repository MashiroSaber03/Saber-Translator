const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/config.CbW489zd.js","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js","js/BookshelfView.CqarHizL.js","js/bookshelfStore.DRMKtdSW.js","js/vue-vendor.BToK7iAN.js","js/bookshelf.C_zUWUVG.js","js/system.DQNodmdY.js","js/BaseModal.Chcbe_b7.js","assets/BaseModal.CgStYIKv.css","assets/BookshelfView.DMwBfkUW.css","js/TranslateView.C6w955tC.js","js/CustomSelect.vue_vue_type_style_index_0_lang.CWP4Q_ni.js","assets/CustomSelect.zudElYG6.css","assets/TranslateView.CZg_MRpM.css","js/ReaderView.D7PeE1Ym.js","assets/ReaderView.DG0xzFSs.css","js/InsightView.HhkxI93U.js","assets/InsightView.BnIOwJpT.css"])))=>i.map(i=>d[i]);
import{d as ro,r as R,c as _,a as ne,o as so,b as no,e as oe,f as $,T as lo,w as uo,g as co,h as y,i as S,F as le,j as mo,u as ue,n as po,t as fo,k as vo,l as ho,R as go,m as To,p as Oo,q as xo,s as _o}from"./vue-vendor.BToK7iAN.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const m of l)if(m.type==="childList")for(const p of m.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&s(p)}).observe(document,{childList:!0,subtree:!0});function t(l){const m={};return l.integrity&&(m.integrity=l.integrity),l.referrerPolicy&&(m.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?m.credentials="include":l.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function s(l){if(l.ep)return;l.ep=!0;const m=t(l);fetch(l.href,m)}})();const Ro="modulepreload",yo=function(o){return"/static/vue/"+o},ae={},E=function(i,t,s){let l=Promise.resolve();if(t&&t.length>0){let q=function(h){return Promise.all(h.map(T=>Promise.resolve(T).then(O=>({status:"fulfilled",value:O}),O=>({status:"rejected",reason:O}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),f=p?.nonce||p?.getAttribute("nonce");l=q(t.map(h=>{if(h=yo(h),h in ae)return;ae[h]=!0;const T=h.endsWith(".css"),O=T?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${O}`))return;const g=document.createElement("link");if(g.rel=T?"stylesheet":Ro,T||(g.as="script"),g.crossOrigin="",g.href=h,f&&g.setAttribute("nonce",f),document.head.appendChild(g),T)return new Promise((b,D)=>{g.addEventListener("load",b),g.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${h}`)))})}))}function m(p){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=p,window.dispatchEvent(f),!f.defaultPrevented)throw p}return l.then(p=>{for(const f of p||[])f.status==="rejected"&&m(f.reason);return i().catch(m)})},Eo="#FFFFFF",ce=`你是一个ocr助手，你需要将我发送给你的图片中的文字提取出来并返回给我，要求：
1、完整识别：我发送给你的图片中的文字都是需要识别的内容
2、非贪婪输出：不要返回任何其他解释和说明。`,Po=`你是一个专业的翻译引擎。请将用户提供的文本翻译成简体中文。
要求：
1. 保留原文的表达意图和情感
2. 使用地道、流畅的表达方式
3. 不要添加任何额外的解释或对话
4. 直接返回翻译结果`,qo=`你是一个专业的翻译引擎。请将用户提供的文本翻译成简体中文。
当文本中包含特殊字符（如大括号{}、引号""、反斜杠\\等）时，请在输出中保留它们但不要将它们视为JSON语法的一部分。
请严格按照以下 JSON 格式返回结果，不要添加任何额外的解释或对话:
{
  "translated_text": "[翻译后的文本放在这里]"
}`,So=`你是一个OCR助手。请将我发送给你的图片中的所有文字提取出来。
当文本中包含特殊字符（如大括号{}、引号""、反斜杠\\等）时，请在输出中保留它们但不要将它们视为JSON语法的一部分。如果需要，你可以使用转义字符\\来表示这些特殊字符。
请严格按照以下 JSON 格式返回结果，不要添加任何额外的解释或对话:
{
  "extracted_text": "[这里放入所有识别到的文字，可以包含换行符以大致保留原始分段，但不要包含任何其他非文本内容]"
}`,Mo=`你是一个漫画翻译助手，我会提供原始漫画图片和导出的只含原文不含译文JSON翻译文件，帮我将原文翻译成中文
翻译要求：
1.仅修改JSON中的"translated"译文，保持其他所有结构和字段不变。
2.json中的"imagelndex"序号是每张图片的页码，在翻译前先根据json文件中每页图片的原文内容和所有漫画图片对我给你的所有图片进行排序，在进行上下文对比时要严格按照"imagelndex"序号进行对比，你在翻译时要按照"imagelndex"的顺序进行顺序翻译，从而使得每句翻译足够连贯，上下文不会突兀
3.通过json中每页图片的"original"原文内容和所有的漫画图片明确每句话在那页图的哪个位置，并结合漫画图像和上下文语境，让翻译更加连贯自然，符合角色语气和场景
4.json中的"bubblelndex"标号可能不正确，你需要根据图片自行判断每句话的正确顺序，从而输出符合上下文连贯的翻译，但在输出翻译时不要修改原本的"bubblelndex"标号
5.保留原文的表达意图和情感，但使用更地道、流畅的表达方式
6.注意专有名词和术语的一致性翻译
7.如遇幽默、双关语或文化特定内容，请尽量找到目标语言中恰当的表达
8.不要添加原文中不存在的信息或解释
9.保持简洁明了，符合气泡空间限制
10.译文字数尽量不要超过原文
11.你需要直接返回修改后的完整JSON文件，无需解释每处修改原因。`,ia=`你是一个专业的漫画校对助手，请帮我校对漫画翻译结果。我会给你漫画未经翻译的原图、由漫画原文和已有的翻译文本组成的JSON文件，请根据图片内容和上下文关系，检查并改进翻译质量。
校对要点：
1. json中的"imagelndex"序号是每张图片的页码，在翻译前先根据json文件中每页图片的原文内容和所有漫画图片对我给你的所有图片进行排序，在进行上下文对比时要严格按照"imagelndex"序号进行对比，你在翻译时要按照"imagelndex"的顺序进行顺序翻译，从而使得每句翻译足够连贯，上下文不会突兀
2. 通过json中每页图片的"original"原文内容和所有的漫画图片明确每句话在那页图的哪个位置，并结合漫画图像和上下文语境，让翻译更加连贯自然，符合角色语气和场景
3. json中的"bubblelndex"标号可能不正确，你需要根据图片自行判断每句话的正确顺序，从而输出符合上下文连贯的翻译，但在输出翻译时不要修改原本的"bubblelndex"标号
4. 针对特殊术语或专有名词的翻译进行统一
5. 重点关注易错点的人称和语气词
6. 修正任何语法或表达错误
请直接返回修改后的JSON数据，保持原有格式，只需更新"translated"字段的内容。`,H=0,z=0,Ao=!0,Lo="#FFFFFF",No=3,ra=[16,20,24,28,32,36,40,48,56,64],sa=2,na=10,la=100,G=3,Y=2,N=2,ua=5,ca=200,ma=30,pa="edit_mode_layout",te="translationSettings",ie="theme",re="providerConfigs",se="modelHistory",Vo={fontSize:25,autoFontSize:!0,fontFamily:"fonts/STSONG.TTF",layoutDirection:"auto",textColor:"#000000",fillColor:Eo,strokeEnabled:Ao,strokeColor:Lo,strokeWidth:No,inpaintMethod:"solid"},Uo={apiKey:"",secretKey:"",version:"standard",sourceLanguage:"JAP"},Io={provider:"gemini",apiKey:"",modelName:"",prompt:ce,rpmLimit:z,customBaseUrl:"",isJsonMode:!1},bo={provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",rpmLimit:H,maxRetries:G,isJsonMode:!1},Do={provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",batchSize:3,sessionReset:20,rpmLimit:7,maxRetries:Y,lowReasoning:!1,noThinkingMethod:"gemini",forceJsonOutput:!0,useStream:!1,prompt:Mo},Bo={enabled:!1,rounds:[],maxRetries:N},Fo={ratio:0,top:0,bottom:0,left:0,right:0},Ko={enabled:!1,dilateSize:5,boxExpandRatio:0};function j(){return{textStyle:{...Vo},ocrEngine:"manga_ocr",sourceLanguage:"japanese",textDetector:"default",baiduOcr:{...Uo},aiVisionOcr:{...Io},translation:{...bo},targetLanguage:"zh-CN",translatePrompt:"",useTextboxPrompt:!1,textboxPrompt:"",hqTranslation:{...Do},proofreading:{...Bo},boxExpand:{...Fo},preciseMask:{...Ko},pdfProcessingMethod:"frontend",showDetectionDebug:!1}}const me=ro("settings",()=>{const o=R(j()),i=R("light"),t=R({translation:{},hqTranslation:{},aiVisionOcr:{}}),s=R({}),l=R([]),m=_(()=>o.value.textStyle),p=_(()=>o.value.ocrEngine),f=_(()=>o.value.sourceLanguage),q=_(()=>o.value.translation.provider),h=_(()=>o.value.hqTranslation.provider),T=_(()=>o.value.proofreading.enabled),O=_(()=>i.value==="dark");function g(e){Object.assign(o.value,e),u(),console.log("翻译设置已更新:",Object.keys(e))}function b(e){Object.assign(o.value.textStyle,e),u(),console.log("文字样式已更新:",Object.keys(e))}function D(e){o.value.ocrEngine=e,u(),console.log(`OCR引擎已设置为: ${e}`)}function de(e){o.value.textDetector=e,u(),console.log(`文本检测器已设置为: ${e}`)}function he(e){o.value.sourceLanguage=e,u(),console.log(`源语言已设置为: ${e}`)}function ge(e){Object.assign(o.value.baiduOcr,e),u()}function Te(e){Object.assign(o.value.aiVisionOcr,e),u()}function Oe(e){const a=o.value.aiVisionOcr.provider;a!==e&&(J(a),o.value.aiVisionOcr.provider=e,C(e),u(),console.log(`AI视觉OCR服务商已切换为: ${e}`))}function xe(e){const a=o.value.translation.provider;a!==e&&(B(a),o.value.translation.provider=e,F(e),u(),console.log(`翻译服务商已切换为: ${e}`))}function _e(e){Object.assign(o.value.translation,e),u()}function Re(e){o.value.translatePrompt=e,u()}function ye(e){o.value.textboxPrompt=e,u()}function Ee(e){o.value.useTextboxPrompt=e,u()}function Pe(e){o.value.translation.isJsonMode=e;const a=e?qo:Po;o.value.translatePrompt=a,u(),console.log(`翻译提示词模式已切换为: ${e?"JSON格式":"普通模式"}`)}function qe(e){o.value.aiVisionOcr.isJsonMode=e;const a=e?So:ce;o.value.aiVisionOcr.prompt=a,u(),console.log(`AI视觉OCR提示词模式已切换为: ${e?"JSON格式":"普通模式"}`)}function Se(e){const a=o.value.hqTranslation.provider;a!==e&&(K(a),o.value.hqTranslation.provider=e,w(e),u(),console.log(`高质量翻译服务商已切换为: ${e}`))}function Me(e){Object.assign(o.value.hqTranslation,e),u()}function Ae(e){o.value.hqTranslation.useStream=e,u()}function Le(e){o.value.hqTranslation.noThinkingMethod=e,u()}function Ne(e){o.value.hqTranslation.forceJsonOutput=e,u()}function Ve(e){o.value.proofreading.enabled=e,u(),console.log(`AI校对已${e?"启用":"禁用"}`)}function Ue(e){o.value.proofreading.rounds.push(e),u(),console.log(`已添加校对轮次: ${e.name}`)}function Ie(e,a){if(e>=0&&e<o.value.proofreading.rounds.length){const r=o.value.proofreading.rounds[e];r&&(Object.assign(r,a),u())}}function be(e){if(e>=0&&e<o.value.proofreading.rounds.length){const a=o.value.proofreading.rounds.splice(e,1);u(),console.log(`已删除校对轮次: ${a[0]?.name}`)}}function De(e){o.value.proofreading.maxRetries=e,u()}function Be(e){Object.assign(o.value.boxExpand,e),u()}function Fe(e){Object.assign(o.value.preciseMask,e),u()}function Ke(e){o.value.pdfProcessingMethod=e,u(),console.log(`PDF处理方式已设置为: ${e}`)}function we(e){o.value.showDetectionDebug=e,u()}function Je(){i.value=i.value==="light"?"dark":"light",M(),W(),console.log(`主题已切换为: ${i.value}`)}function Ce(e){i.value=e,M(),W()}function M(){typeof document<"u"&&document.documentElement.setAttribute("data-theme",i.value)}function B(e){if(!e)return;const a={apiKey:o.value.translation.apiKey,modelName:o.value.translation.modelName,customBaseUrl:o.value.translation.customBaseUrl,rpmLimit:o.value.translation.rpmLimit,maxRetries:o.value.translation.maxRetries,isJsonMode:o.value.translation.isJsonMode};t.value.translation[e]=a,A(),console.log(`[Settings] 保存翻译服务商配置: ${e}`,a)}function F(e){if(!e)return;const a=t.value.translation[e];a?(a.apiKey!==void 0&&(o.value.translation.apiKey=a.apiKey),a.modelName!==void 0&&(o.value.translation.modelName=a.modelName),a.customBaseUrl!==void 0&&(o.value.translation.customBaseUrl=a.customBaseUrl),a.rpmLimit!==void 0&&(o.value.translation.rpmLimit=a.rpmLimit),a.maxRetries!==void 0&&(o.value.translation.maxRetries=a.maxRetries),a.isJsonMode!==void 0&&(o.value.translation.isJsonMode=a.isJsonMode),console.log(`[Settings] 恢复翻译服务商配置: ${e}`,a)):(o.value.translation.apiKey="",o.value.translation.modelName="",o.value.translation.customBaseUrl="",console.log(`[Settings] ${e} 无缓存配置，使用默认值`))}function K(e){if(!e)return;const a={apiKey:o.value.hqTranslation.apiKey,modelName:o.value.hqTranslation.modelName,customBaseUrl:o.value.hqTranslation.customBaseUrl,batchSize:o.value.hqTranslation.batchSize,sessionReset:o.value.hqTranslation.sessionReset,rpmLimit:o.value.hqTranslation.rpmLimit,maxRetries:o.value.hqTranslation.maxRetries,lowReasoning:o.value.hqTranslation.lowReasoning,noThinkingMethod:o.value.hqTranslation.noThinkingMethod,forceJsonOutput:o.value.hqTranslation.forceJsonOutput,useStream:o.value.hqTranslation.useStream,prompt:o.value.hqTranslation.prompt};t.value.hqTranslation[e]=a,A(),console.log(`[Settings] 保存高质量翻译服务商配置: ${e}`,a)}function w(e){if(!e)return;const a=t.value.hqTranslation[e];a?(a.apiKey!==void 0&&(o.value.hqTranslation.apiKey=a.apiKey),a.modelName!==void 0&&(o.value.hqTranslation.modelName=a.modelName),a.customBaseUrl!==void 0&&(o.value.hqTranslation.customBaseUrl=a.customBaseUrl),a.batchSize!==void 0&&(o.value.hqTranslation.batchSize=a.batchSize),a.sessionReset!==void 0&&(o.value.hqTranslation.sessionReset=a.sessionReset),a.rpmLimit!==void 0&&(o.value.hqTranslation.rpmLimit=a.rpmLimit),a.maxRetries!==void 0&&(o.value.hqTranslation.maxRetries=a.maxRetries),a.lowReasoning!==void 0&&(o.value.hqTranslation.lowReasoning=a.lowReasoning),a.noThinkingMethod!==void 0&&(o.value.hqTranslation.noThinkingMethod=a.noThinkingMethod),a.forceJsonOutput!==void 0&&(o.value.hqTranslation.forceJsonOutput=a.forceJsonOutput),a.useStream!==void 0&&(o.value.hqTranslation.useStream=a.useStream),a.prompt!==void 0&&(o.value.hqTranslation.prompt=a.prompt),console.log(`[Settings] 恢复高质量翻译服务商配置: ${e}`,a)):(o.value.hqTranslation.apiKey="",o.value.hqTranslation.modelName="",o.value.hqTranslation.customBaseUrl="",console.log(`[Settings] ${e} 无缓存配置，使用默认值`))}function J(e){if(!e)return;const a={apiKey:o.value.aiVisionOcr.apiKey,modelName:o.value.aiVisionOcr.modelName,customBaseUrl:o.value.aiVisionOcr.customBaseUrl,prompt:o.value.aiVisionOcr.prompt,rpmLimit:o.value.aiVisionOcr.rpmLimit,isJsonMode:o.value.aiVisionOcr.isJsonMode};t.value.aiVisionOcr[e]=a,A(),console.log(`[Settings] 保存AI视觉OCR服务商配置: ${e}`,a)}function C(e){if(!e)return;const a=t.value.aiVisionOcr[e];a?(a.apiKey!==void 0&&(o.value.aiVisionOcr.apiKey=a.apiKey),a.modelName!==void 0&&(o.value.aiVisionOcr.modelName=a.modelName),a.customBaseUrl!==void 0&&(o.value.aiVisionOcr.customBaseUrl=a.customBaseUrl),a.prompt!==void 0&&(o.value.aiVisionOcr.prompt=a.prompt),a.rpmLimit!==void 0&&(o.value.aiVisionOcr.rpmLimit=a.rpmLimit),a.isJsonMode!==void 0&&(o.value.aiVisionOcr.isJsonMode=a.isJsonMode),console.log(`[Settings] 恢复AI视觉OCR服务商配置: ${e}`,a)):(o.value.aiVisionOcr.apiKey="",o.value.aiVisionOcr.modelName="",o.value.aiVisionOcr.customBaseUrl="",console.log(`[Settings] ${e} 无缓存配置，使用默认值`))}function je(e,a){e==="translation"?B(a):e==="hqTranslation"?K(a):e==="aiVisionOcr"&&J(a)}function $e(e,a){e==="translation"?F(a):e==="hqTranslation"?w(a):e==="aiVisionOcr"&&C(a)}function He(e,a){if(!e||!a)return;s.value[e]||(s.value[e]=[]);const r=s.value[e].indexOf(a);r!==-1&&s.value[e].splice(r,1),s.value[e].unshift(a),s.value[e].length>20&&(s.value[e]=s.value[e].slice(0,20)),ee(),console.log(`[Settings] 添加模型到历史: ${e} -> ${a}`)}function ze(e){return s.value[e]||[]}function Ge(e){s.value[e]&&(delete s.value[e],ee(),console.log(`[Settings] 清除模型历史: ${e}`))}function Ye(e){l.value.includes(e)||(l.value.push(e),l.value.sort((a,r)=>a-r),k(),console.log(`已添加自定义字号预设: ${e}`))}function Xe(e){const a=l.value.indexOf(e);a!==-1&&(l.value.splice(a,1),k(),console.log(`已删除自定义字号预设: ${e}`))}function u(){try{const e=JSON.stringify(o.value);localStorage.setItem(te,e)}catch(e){console.error("保存设置到 localStorage 失败:",e)}}function Z(){try{const e=localStorage.getItem(te);if(e){const a=JSON.parse(e);o.value=io(j(),a),console.log("已从 localStorage 加载设置")}}catch(e){console.error("从 localStorage 加载设置失败:",e)}}function W(){try{localStorage.setItem(ie,i.value)}catch(e){console.error("保存主题到 localStorage 失败:",e)}}function Q(){try{const e=localStorage.getItem(ie);(e==="light"||e==="dark")&&(i.value=e,M(),console.log(`已从 localStorage 加载主题: ${i.value}`))}catch(e){console.error("从 localStorage 加载主题失败:",e)}}function k(){try{const e=JSON.stringify(l.value);localStorage.setItem("customFontSizePresets",e)}catch(e){console.error("保存自定义字号预设失败:",e)}}function A(){try{const e=JSON.stringify(t.value);localStorage.setItem(re,e)}catch(e){console.error("保存服务商配置缓存失败:",e)}}function Ze(){try{const e=localStorage.getItem(re);if(e){const a=JSON.parse(e);t.value={translation:a.translation||{},hqTranslation:a.hqTranslation||{},aiVisionOcr:a.aiVisionOcr||{}},console.log("已从 localStorage 加载服务商配置缓存")}}catch(e){console.error("加载服务商配置缓存失败:",e)}}function ee(){try{const e=JSON.stringify(s.value);localStorage.setItem(se,e)}catch(e){console.error("保存模型历史记录失败:",e)}}function We(){try{const e=localStorage.getItem(se);e&&(s.value=JSON.parse(e),console.log("已从 localStorage 加载模型历史记录"))}catch(e){console.error("加载模型历史记录失败:",e)}}function Qe(){try{const e=localStorage.getItem("customFontSizePresets");e&&(l.value=JSON.parse(e))}catch(e){console.error("加载自定义字号预设失败:",e)}}function ke(){Z(),Q(),Qe(),Ze(),We()}async function eo(){try{console.log("[Settings] 开始从后端加载设置...");const{getUserSettings:e}=await E(async()=>{const{getUserSettings:r}=await import("./config.CbW489zd.js");return{getUserSettings:r}},__vite__mapDeps([0,1,2])),a=await e();if(console.log("[Settings] API 响应:",a),a.success&&a.settings){const r=a.settings;return console.log("[Settings] 从后端加载设置:",r),console.log("[Settings] 设置字段数量:",Object.keys(r).length),oo(r),u(),A(),console.log("[Settings] 后端设置已应用，当前翻译服务商:",o.value.translation.provider),console.log("[Settings] 当前翻译 API Key:",o.value.translation.apiKey?"已设置":"未设置"),!0}else return console.warn("[Settings] 后端无设置数据，使用 localStorage 或默认值",a),!1}catch(e){return console.error("[Settings] 从后端加载设置失败:",e),!1}}function oo(e){const a=(r,n)=>{if(r==null||r==="")return n;const c=typeof r=="string"?parseFloat(r):Number(r);return isNaN(c)?n:c};if(e.ocrEngine&&(o.value.ocrEngine=e.ocrEngine),e.sourceLanguage&&(o.value.sourceLanguage=e.sourceLanguage),e.textDetector&&(o.value.textDetector=e.textDetector),e.baiduApiKey&&(o.value.baiduOcr.apiKey=e.baiduApiKey),e.baiduSecretKey&&(o.value.baiduOcr.secretKey=e.baiduSecretKey),e.baiduVersion&&(o.value.baiduOcr.version=e.baiduVersion),e.baiduSourceLanguage&&(o.value.baiduOcr.sourceLanguage=e.baiduSourceLanguage),e.aiVisionProvider&&(o.value.aiVisionOcr.provider=e.aiVisionProvider),e.aiVisionApiKey&&(o.value.aiVisionOcr.apiKey=e.aiVisionApiKey),e.aiVisionModelName&&(o.value.aiVisionOcr.modelName=e.aiVisionModelName),e.aiVisionOcrPrompt&&(o.value.aiVisionOcr.prompt=e.aiVisionOcrPrompt),e.customAiVisionBaseUrl&&(o.value.aiVisionOcr.customBaseUrl=e.customAiVisionBaseUrl),e.rpmAiVisionOcr!==void 0&&(o.value.aiVisionOcr.rpmLimit=a(e.rpmAiVisionOcr,z)),e.aiVisionPromptModeSelect==="json"&&(o.value.aiVisionOcr.isJsonMode=!0),e.modelProvider&&(o.value.translation.provider=e.modelProvider),e.apiKey&&(o.value.translation.apiKey=e.apiKey),e.modelName&&(o.value.translation.modelName=e.modelName),e.customBaseUrl&&(o.value.translation.customBaseUrl=e.customBaseUrl),e.rpmTranslation!==void 0&&(o.value.translation.rpmLimit=a(e.rpmTranslation,H)),e.translationMaxRetries!==void 0&&(o.value.translation.maxRetries=a(e.translationMaxRetries,G)),e.translatePromptModeSelect==="json"&&(o.value.translation.isJsonMode=!0),e.promptContent&&(o.value.translatePrompt=e.promptContent),e.enableTextboxPrompt!==void 0&&(o.value.useTextboxPrompt=e.enableTextboxPrompt),e.textboxPromptContent&&(o.value.textboxPrompt=e.textboxPromptContent),e.hqTranslateProvider&&(o.value.hqTranslation.provider=e.hqTranslateProvider),e.hqApiKey&&(o.value.hqTranslation.apiKey=e.hqApiKey),e.hqModelName&&(o.value.hqTranslation.modelName=e.hqModelName),e.hqCustomBaseUrl&&(o.value.hqTranslation.customBaseUrl=e.hqCustomBaseUrl),e.hqBatchSize!==void 0&&(o.value.hqTranslation.batchSize=a(e.hqBatchSize,3)),e.hqSessionReset!==void 0&&(o.value.hqTranslation.sessionReset=a(e.hqSessionReset,20)),e.hqRpmLimit!==void 0&&(o.value.hqTranslation.rpmLimit=a(e.hqRpmLimit,7)),e.hqMaxRetries!==void 0&&(o.value.hqTranslation.maxRetries=a(e.hqMaxRetries,Y)),e.hqPrompt&&(o.value.hqTranslation.prompt=e.hqPrompt),e.hqLowReasoning!==void 0&&(o.value.hqTranslation.lowReasoning=e.hqLowReasoning),e.hqNoThinkingMethod&&(o.value.hqTranslation.noThinkingMethod=e.hqNoThinkingMethod),e.hqForceJsonOutput!==void 0&&(o.value.hqTranslation.forceJsonOutput=e.hqForceJsonOutput),e.hqUseStream!==void 0&&(o.value.hqTranslation.useStream=e.hqUseStream),e.proofreadingEnabled!==void 0&&(o.value.proofreading.enabled=e.proofreadingEnabled),e.proofreadingMaxRetries!==void 0&&(o.value.proofreading.maxRetries=a(e.proofreadingMaxRetries,N)),e.proofreading&&typeof e.proofreading=="object"){const r=e.proofreading;r.enabled!==void 0&&(o.value.proofreading.enabled=r.enabled),r.maxRetries!==void 0&&(o.value.proofreading.maxRetries=a(r.maxRetries,N)),Array.isArray(r.rounds)&&(o.value.proofreading.rounds=r.rounds.map(n=>({name:n.name||"轮次",provider:n.provider||"siliconflow",apiKey:n.apiKey||"",modelName:n.modelName||"",customBaseUrl:n.customBaseUrl||"",prompt:n.prompt||"",batchSize:a(n.batchSize,3),sessionReset:a(n.sessionReset,20),rpmLimit:a(n.rpmLimit,7),maxRetries:a(n.maxRetries,N),lowReasoning:n.lowReasoning||!1,noThinkingMethod:n.noThinkingMethod||"gemini",forceJsonOutput:n.forceJsonOutput||!1})))}if(e.boxExpandRatio!==void 0&&(o.value.boxExpand.ratio=a(e.boxExpandRatio,0)),e.boxExpandTop!==void 0&&(o.value.boxExpand.top=a(e.boxExpandTop,0)),e.boxExpandBottom!==void 0&&(o.value.boxExpand.bottom=a(e.boxExpandBottom,0)),e.boxExpandLeft!==void 0&&(o.value.boxExpand.left=a(e.boxExpandLeft,0)),e.boxExpandRight!==void 0&&(o.value.boxExpand.right=a(e.boxExpandRight,0)),e.usePreciseMask!==void 0&&(o.value.preciseMask.enabled=e.usePreciseMask),e.maskDilateSize!==void 0&&(o.value.preciseMask.dilateSize=a(e.maskDilateSize,5)),e.maskBoxExpandRatio!==void 0&&(o.value.preciseMask.boxExpandRatio=a(e.maskBoxExpandRatio,0)),e.pdfProcessingMethod&&(o.value.pdfProcessingMethod=e.pdfProcessingMethod),e.showDetectionDebug!==void 0&&(o.value.showDetectionDebug=e.showDetectionDebug),e.providerSettings&&typeof e.providerSettings=="object"){const r=e.providerSettings;if(r.modelProvider)for(const[n,c]of Object.entries(r.modelProvider))t.value.translation[n]={apiKey:c.apiKey,modelName:c.modelName,customBaseUrl:c.customBaseUrl,rpmLimit:a(c.rpmTranslation,H),maxRetries:a(c.translationMaxRetries,G)};if(r.hqTranslateProvider)for(const[n,c]of Object.entries(r.hqTranslateProvider))t.value.hqTranslation[n]={apiKey:c.hqApiKey,modelName:c.hqModelName,customBaseUrl:c.hqCustomBaseUrl,batchSize:a(c.hqBatchSize,3),sessionReset:a(c.hqSessionReset,20),rpmLimit:a(c.hqRpmLimit,7),maxRetries:a(c.hqMaxRetries,Y),lowReasoning:c.hqLowReasoning,forceJsonOutput:c.hqForceJsonOutput,useStream:c.hqUseStream,prompt:c.hqPrompt};if(r.aiVisionProvider)for(const[n,c]of Object.entries(r.aiVisionProvider))t.value.aiVisionOcr[n]={apiKey:c.aiVisionApiKey,modelName:c.aiVisionModelName,prompt:c.aiVisionOcrPrompt,rpmLimit:a(c.rpmAiVisionOcr,z),isJsonMode:c.aiVisionPromptModeSelect==="json"}}console.log("[Settings] 后端设置映射完成")}async function ao(){try{const{saveUserSettings:e}=await E(async()=>{const{saveUserSettings:n}=await import("./config.CbW489zd.js");return{saveUserSettings:n}},__vite__mapDeps([0,1,2])),a={ocrEngine:o.value.ocrEngine,sourceLanguage:o.value.sourceLanguage,textDetector:o.value.textDetector,baiduApiKey:o.value.baiduOcr.apiKey,baiduSecretKey:o.value.baiduOcr.secretKey,baiduVersion:o.value.baiduOcr.version,baiduSourceLanguage:o.value.baiduOcr.sourceLanguage,aiVisionProvider:o.value.aiVisionOcr.provider,aiVisionApiKey:o.value.aiVisionOcr.apiKey,aiVisionModelName:o.value.aiVisionOcr.modelName,aiVisionOcrPrompt:o.value.aiVisionOcr.prompt,customAiVisionBaseUrl:o.value.aiVisionOcr.customBaseUrl,rpmAiVisionOcr:String(o.value.aiVisionOcr.rpmLimit),aiVisionPromptModeSelect:o.value.aiVisionOcr.isJsonMode?"json":"normal",modelProvider:o.value.translation.provider,apiKey:o.value.translation.apiKey,modelName:o.value.translation.modelName,customBaseUrl:o.value.translation.customBaseUrl,rpmTranslation:String(o.value.translation.rpmLimit),translationMaxRetries:String(o.value.translation.maxRetries),translatePromptModeSelect:o.value.translation.isJsonMode?"json":"normal",promptContent:o.value.translatePrompt,enableTextboxPrompt:o.value.useTextboxPrompt,textboxPromptContent:o.value.textboxPrompt,hqTranslateProvider:o.value.hqTranslation.provider,hqApiKey:o.value.hqTranslation.apiKey,hqModelName:o.value.hqTranslation.modelName,hqCustomBaseUrl:o.value.hqTranslation.customBaseUrl,hqBatchSize:String(o.value.hqTranslation.batchSize),hqSessionReset:String(o.value.hqTranslation.sessionReset),hqRpmLimit:String(o.value.hqTranslation.rpmLimit),hqMaxRetries:String(o.value.hqTranslation.maxRetries),hqPrompt:o.value.hqTranslation.prompt,hqLowReasoning:o.value.hqTranslation.lowReasoning,hqNoThinkingMethod:o.value.hqTranslation.noThinkingMethod,hqForceJsonOutput:o.value.hqTranslation.forceJsonOutput,hqUseStream:o.value.hqTranslation.useStream,proofreadingEnabled:o.value.proofreading.enabled,proofreadingMaxRetries:String(o.value.proofreading.maxRetries),proofreading:{enabled:o.value.proofreading.enabled,maxRetries:String(o.value.proofreading.maxRetries),rounds:o.value.proofreading.rounds.map(n=>({name:n.name,provider:n.provider,apiKey:n.apiKey,modelName:n.modelName,customBaseUrl:n.customBaseUrl,prompt:n.prompt,batchSize:n.batchSize,sessionReset:n.sessionReset,rpmLimit:n.rpmLimit,lowReasoning:n.lowReasoning,forceJsonOutput:n.forceJsonOutput}))},boxExpandRatio:String(o.value.boxExpand.ratio),boxExpandTop:String(o.value.boxExpand.top),boxExpandBottom:String(o.value.boxExpand.bottom),boxExpandLeft:String(o.value.boxExpand.left),boxExpandRight:String(o.value.boxExpand.right),usePreciseMask:o.value.preciseMask.enabled,maskDilateSize:String(o.value.preciseMask.dilateSize),maskBoxExpandRatio:String(o.value.preciseMask.boxExpandRatio||0),pdfProcessingMethod:o.value.pdfProcessingMethod,showDetectionDebug:o.value.showDetectionDebug},r=await e(a);return r.success?(console.log("[Settings] 设置已保存到后端"),!0):(console.error("[Settings] 保存设置到后端失败:",r),!1)}catch(e){return console.error("[Settings] 保存设置到后端出错:",e),!1}}function to(){o.value=j(),u(),console.log("设置已重置为默认值")}function io(e,a){const r={...e};for(const n in a)if(Object.prototype.hasOwnProperty.call(a,n)){const c=n,x=a[c],L=r[c];x!=null&&typeof x=="object"&&!Array.isArray(x)&&L!==null&&typeof L=="object"&&!Array.isArray(L)?r[c]={...L,...x}:x!==void 0&&(r[c]=x)}return r}return{settings:o,theme:i,providerConfigs:t,customFontPresets:l,textStyle:m,ocrEngine:p,sourceLanguage:f,translationProvider:q,hqProvider:h,isProofreadingEnabled:T,isDarkTheme:O,updateSettings:g,updateTextStyle:b,setOcrEngine:D,setTextDetector:de,setSourceLanguage:he,updateBaiduOcr:ge,updateAiVisionOcr:Te,setTranslationProvider:xe,updateTranslationService:_e,setTranslatePrompt:Re,setTextboxPrompt:ye,setUseTextboxPrompt:Ee,setTranslatePromptMode:Pe,setAiVisionOcrPromptMode:qe,setHqProvider:Se,updateHqTranslation:Me,setHqUseStream:Ae,setHqNoThinkingMethod:Le,setHqForceJsonOutput:Ne,setProofreadingEnabled:Ve,addProofreadingRound:Ue,updateProofreadingRound:Ie,removeProofreadingRound:be,setProofreadingMaxRetries:De,updateBoxExpand:Be,updatePreciseMask:Fe,setPdfProcessingMethod:Ke,setShowDetectionDebug:we,toggleTheme:Je,setTheme:Ce,applyTheme:M,saveProviderConfig:je,restoreProviderConfig:$e,saveTranslationProviderConfig:B,restoreTranslationProviderConfig:F,saveHqProviderConfig:K,restoreHqProviderConfig:w,saveAiVisionOcrProviderConfig:J,restoreAiVisionOcrProviderConfig:C,setAiVisionOcrProvider:Oe,modelHistory:s,addModelToHistory:He,getModelHistory:ze,clearModelHistory:Ge,addCustomFontPreset:Ye,removeCustomFontPreset:Xe,saveToStorage:u,loadFromStorage:Z,loadThemeFromStorage:Q,initSettings:ke,resetToDefaults:to,loadFromBackend:eo,saveToBackend:ao}}),fa=Object.freeze(Object.defineProperty({__proto__:null,useSettingsStore:me},Symbol.toStringTag,{value:"Module"})),d=R([]);let pe=0;const fe=3e4,U=o=>{o.timer&&(clearTimeout(o.timer),o.timer=void 0),o.safetyTimer&&(clearTimeout(o.safetyTimer),o.safetyTimer=void 0)},P=(o,i="info",t=3e3)=>{const s=++pe,l=`msg_${Date.now()}_${Math.floor(Math.random()*1e3)}`,m={id:s,messageId:l,message:o,type:i,isHTML:!1};return t>0?m.timer=setTimeout(()=>{V(s)},t):m.safetyTimer=setTimeout(()=>{V(s)},fe),d.value.push(m),s},V=o=>{const i=d.value.findIndex(t=>t.id===o);if(i!==-1){const t=d.value[i];t&&U(t),d.value.splice(i,1)}},X=()=>{d.value.forEach(o=>{U(o)}),d.value=[]},wo=(o,i)=>P(o,"success",i),Jo=(o,i)=>P(o,"error",i),Co=(o,i)=>P(o,"info",i),jo=(o,i)=>P(o,"warning",i),$o=(o,i="info",t=!1,s=5e3,l="")=>{const m=l||`msg_${Date.now()}_${Math.floor(Math.random()*1e3)}`;X();const p=++pe,f={id:p,messageId:m,message:o,type:i,isHTML:t},q=s>0?s:fe;return f.timer=setTimeout(()=>{V(p)},q),d.value.push(f),m},Ho=o=>{if(!o)return;const i=d.value.findIndex(t=>t.messageId===o);if(i!==-1){const t=d.value[i];t&&U(t),d.value.splice(i,1)}},zo=(o="")=>{if(o==="")X();else{const i=[];d.value.forEach((t,s)=>{t.type===o&&(U(t),i.push(s))});for(let t=i.length-1;t>=0;t--){const s=i[t];s!==void 0&&d.value.splice(s,1)}}},v={toasts:d,addToast:P,removeToast:V,clearAll:X,success:wo,error:Jo,info:Co,warning:jo,showGeneralMessage:$o,clearGeneralMessageById:Ho,clearAllGeneralMessages:zo};function va(){return v}function da(o,i="info",t=3e3){return P(o,i,t)}const Go={class:"vue-toast-container"},Yo=["innerHTML"],Xo={key:1},Zo=["onClick"],Wo=ne({__name:"ToastNotification",setup(o,{expose:i}){const t=v.toasts,s=l=>{v.removeToast(l)};return so(()=>{v.clearAll()}),i({toasts:t,addToast:v.addToast,removeToast:v.removeToast,clearAll:v.clearAll,success:v.success,error:v.error,info:v.info,warning:v.warning,showGeneralMessage:v.showGeneralMessage,clearGeneralMessageById:v.clearGeneralMessageById,clearAllGeneralMessages:v.clearAllGeneralMessages}),(l,m)=>(y(),no(co,{to:"body"},[oe("div",Go,[$(lo,{name:"toast-slide"},{default:uo(()=>[(y(!0),S(le,null,mo(ue(t),p=>(y(),S("div",{key:p.id,class:po(["vue-toast-message","vue-toast-"+p.type])},[p.isHTML?(y(),S("span",{key:0,innerHTML:p.message},null,8,Yo)):(y(),S("span",Xo,fo(p.message),1)),oe("button",{class:"vue-toast-close",onClick:vo(f=>s(p.id),["stop"])},"×",8,Zo)],2))),128))]),_:1})])]))}}),Qo=(o,i)=>{const t=o.__vccOpts||o;for(const[s,l]of i)t[s]=l;return t},ko=Qo(Wo,[["__scopeId","data-v-28b4c9eb"]]),ea=ne({__name:"App",setup(o){const i=me();return ho(()=>{i.loadFromStorage(),i.applyTheme()}),(t,s)=>(y(),S(le,null,[$(ue(go)),$(ko)],64))}}),oa=[{path:"/",name:"bookshelf",component:()=>E(()=>import("./BookshelfView.CqarHizL.js"),__vite__mapDeps([3,4,5,6,1,2,7,8,9,10])),meta:{title:"书架"}},{path:"/translate",name:"translate",component:()=>E(()=>import("./TranslateView.C6w955tC.js"),__vite__mapDeps([11,5,7,1,2,0,12,13,8,9,6,14])),meta:{title:"翻译"},props:o=>({bookId:o.query.book,chapterId:o.query.chapter})},{path:"/reader",name:"reader",component:()=>E(()=>import("./ReaderView.D7PeE1Ym.js"),__vite__mapDeps([15,5,6,1,2,16])),meta:{title:"阅读器"},props:o=>({bookId:o.query.book,chapterId:o.query.chapter}),beforeEnter:(o,i,t)=>{!o.query.book||!o.query.chapter?t({name:"bookshelf"}):t()}},{path:"/insight",name:"insight",component:()=>E(()=>import("./InsightView.HhkxI93U.js"),__vite__mapDeps([17,5,4,6,1,2,12,13,8,9,18])),meta:{title:"漫画分析"},props:o=>({bookId:o.query.book})},{path:"/:pathMatch(.*)*",redirect:{name:"bookshelf"}}],ve=To({history:Oo("/static/vue/"),routes:oa});ve.beforeEach((o,i,t)=>{const s=o.meta.title;document.title=s?`${s} - Saber Translator`:"Saber Translator",t()});const I=xo(ea),aa=_o();I.use(aa);I.use(ve);I.config.errorHandler=(o,i,t)=>{console.error("Vue 错误:",o,t)};I.mount("#app");export{ca as B,No as D,sa as F,pa as L,Qo as _,E as a,Lo as b,Ao as c,Eo as d,va as e,So as f,ce as g,qo as h,Po as i,Mo as j,ia as k,ua as l,ma as m,la as n,na as o,ra as p,fa as q,da as s,me as u};
