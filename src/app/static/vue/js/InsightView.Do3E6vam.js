import{d as Ds,r as k,c as U,a as Me,i as p,f as pe,h as c,K as st,e,v as T,b as et,n as G,t as _,x as Ns,u as $e,y as O,z as Y,l as nt,F as W,j as oe,B as ie,k as Pe,I as tt,D as as,w as ft,J as js,o as Fs,E as Qs,G as Ft,C as Hs}from"./vue-vendor.BU3zOQRA.js";import{u as ms,_ as Js}from"./bookshelfStore.fm3KUtmx.js";import{_ as Ae}from"./CustomSelect.vue_vue_type_style_index_0_lang.qSOIWfjV.js";import{_ as Oe,s as Gs}from"./index.3m4ltW8l.js";import{apiClient as re}from"./client.Bht704G-.js";import{B as Zs}from"./BaseModal.CnDw-5RG.js";import{fetchModels as Ws}from"./config.CwRcCkM9.js";import"./bookshelf.CDzdK045.js";import"./utils-vendor.B9ygI19o.js";async function Xs(a,t){return re.post(`/api/manga-insight/${a}/analyze/start`,t)}async function Ys(a,t){return re.post(`/api/manga-insight/${a}/analyze/pause`,{task_id:t})}async function en(a,t){return re.post(`/api/manga-insight/${a}/analyze/resume`,{task_id:t})}async function tn(a,t){return re.post(`/api/manga-insight/${a}/analyze/cancel`,{task_id:t})}async function gs(a){return re.get(`/api/manga-insight/${a}/analyze/status`)}async function hs(a,t){return re.post(`/api/manga-insight/${a}/reanalyze/page/${t}`)}async function sn(a,t){return re.get(`/api/manga-insight/${a}/pages/${t}`)}function nn(a,t){return`/api/manga-insight/${a}/page-image/${t}`}function fs(a,t){return`/api/manga-insight/${a}/thumbnail/${t}`}async function ln(a){return re.get(`/api/manga-insight/${a}/chapters`)}async function bs(a,t){return t?re.get(`/api/manga-insight/${a}/overview/${t}`):re.get(`/api/manga-insight/${a}/overview`)}async function an(a,t,l=!1){return re.post(`/api/manga-insight/${a}/overview/generate`,{template:t,force:l})}async function ks(a){return re.get(`/api/manga-insight/${a}/overview/templates`)}async function ys(a){return re.get(`/api/manga-insight/${a}/timeline`)}async function on(a){return re.post(`/api/manga-insight/${a}/regenerate/timeline`,{})}async function rn(a,t,l){return re.post(`/api/manga-insight/${a}/chat`,{question:t,...l})}async function un(a){return re.post(`/api/manga-insight/${a}/rebuild-embeddings`,{})}async function cn(){return re.get("/api/manga-insight/config")}async function dn(a){return re.post("/api/manga-insight/config",a)}async function pn(a){return re.post("/api/manga-insight/config/test/vlm",a)}async function vn(a){return re.post("/api/manga-insight/config/test/embedding",a)}async function mn(a){return re.post("/api/manga-insight/config/test/reranker",a)}async function gn(a){return re.post("/api/manga-insight/config/test/llm",a)}const os={batch_analysis:{label:"ğŸ“„ æ‰¹é‡åˆ†ææç¤ºè¯",hint:"ç”¨äºæ‰¹é‡åˆ†æå¤šä¸ªé¡µé¢ã€‚æ”¯æŒå˜é‡ï¼š{page_count}, {start_page}, {end_page}"},segment_summary:{label:"ğŸ“‘ æ®µè½æ€»ç»“æç¤ºè¯",hint:"ç”¨äºæ±‡æ€»å¤šä¸ªæ‰¹æ¬¡çš„åˆ†æç»“æœç”Ÿæˆæ®µè½æ€»ç»“ã€‚"},chapter_summary:{label:"ğŸ“– ç« èŠ‚æ€»ç»“æç¤ºè¯",hint:"ç”¨äºç”Ÿæˆç« èŠ‚çº§åˆ«çš„å®Œæ•´æ€»ç»“ã€‚"},qa_response:{label:"ğŸ’¬ é—®ç­”å“åº”æç¤ºè¯",hint:"ç”¨äºå›ç­”ç”¨æˆ·å…³äºæ¼«ç”»å†…å®¹çš„é—®é¢˜ã€‚"}},Ye={batch_analysis:`ã€è¾“å‡ºä¸­æ–‡ã€‘åˆ†æä»¥ä¸‹ {page_count} é¡µæ¼«ç”»å†…å®¹ï¼ˆç¬¬ {start_page} é¡µåˆ°ç¬¬ {end_page} é¡µï¼‰ã€‚

è¯·æå–ä»¥ä¸‹ä¿¡æ¯ï¼Œä»¥ JSON æ ¼å¼è¾“å‡ºï¼š
{
    "pages": [
        {
            "page_num": <é¡µç >,
            "summary": "<è¯¥é¡µå†…å®¹æ¦‚è¿°ï¼Œ2-3å¥è¯>",
            "dialogues": [
                {"character": "<è§’è‰²åæˆ–'æ—ç™½'>", "text": "<å¯¹è¯å†…å®¹>"}
            ],
            "scene": "<åœºæ™¯æè¿°>",
            "mood": "<æ°›å›´/æƒ…ç»ª>"
        }
    ],
    "batch_summary": "<è¿™å‡ é¡µçš„æ•´ä½“æ¦‚è¿°ï¼Œ3-5å¥è¯>",
    "key_events": ["<å…³é”®äº‹ä»¶1>", "<å…³é”®äº‹ä»¶2>"]
}

è¦æ±‚ï¼š
1. å‡†ç¡®è¯†åˆ«å¯¹è¯å†…å®¹å’Œè¯´è¯è€…
2. æ³¨æ„ç”»é¢ä¸­çš„æ–‡å­—ã€éŸ³æ•ˆ
3. æè¿°é‡è¦çš„è§†è§‰å…ƒç´ å’Œè¡¨æƒ…`,segment_summary:`ã€è¾“å‡ºä¸­æ–‡ã€‘åŸºäºä»¥ä¸‹æ‰¹æ¬¡åˆ†æç»“æœï¼Œç”Ÿæˆæ®µè½æ€»ç»“ã€‚

è¯·ç”Ÿæˆæ®µè½æ€»ç»“ï¼ŒJSON æ ¼å¼ï¼š
{
    "summary": "<æ®µè½æ•´ä½“æ¦‚è¿°ï¼Œ3-5å¥è¯>",
    "plot_points": ["<å‰§æƒ…è¦ç‚¹1>", "<å‰§æƒ…è¦ç‚¹2>"],
    "character_developments": ["<è§’è‰²å‘å±•1>"],
    "themes": ["<ä¸»é¢˜1>"]
}

è¦æ±‚ï¼š
1. ç»¼åˆå¤šä¸ªæ‰¹æ¬¡çš„ä¿¡æ¯
2. çªå‡ºé‡è¦è§’è‰²å’Œå…³é”®äº‹ä»¶
3. æ³¨æ„å‰§æƒ…çš„å› æœå…³ç³»`,chapter_summary:`ã€è¾“å‡ºä¸­æ–‡ã€‘åŸºäºä»¥ä¸‹å†…å®¹ï¼Œç”Ÿæˆå®Œæ•´çš„ç« èŠ‚æ€»ç»“ã€‚

è¯·ç”Ÿæˆç« èŠ‚æ€»ç»“ï¼ŒJSON æ ¼å¼ï¼š
{
    "summary": "<ç« èŠ‚æ•´ä½“æ¦‚è¿°ï¼Œ5-8å¥è¯>",
    "main_plot": "<ä¸»è¦å‰§æƒ…çº¿æè¿°>",
    "key_events": ["<ç« èŠ‚å…³é”®äº‹ä»¶ï¼ŒæŒ‰é¡ºåº>"],
    "themes": ["<æœ¬ç« ä¸»é¢˜>"],
    "atmosphere": "<æ•´ä½“æ°›å›´>"
}

è¦æ±‚ï¼š
1. ç»¼åˆæ‰€æœ‰å†…å®¹ï¼Œå½¢æˆå®Œæ•´çš„ç« èŠ‚å™è¿°
2. ç†æ¸…äººç‰©å…³ç³»å’Œå‰§æƒ…è„‰ç»œ
3. æç‚¼ç« èŠ‚ä¸»é¢˜å’Œæ ¸å¿ƒå†²çª`,qa_response:`ã€è¾“å‡ºä¸­æ–‡ã€‘æ ¹æ®åˆ†æç»“æœå›ç­”ç”¨æˆ·é—®é¢˜ï¼Œå¼•ç”¨ç›¸å…³é¡µé¢ã€‚
å›ç­”æ—¶è¯·ï¼š
1. åŸºäºæä¾›çš„æ¼«ç”»å†…å®¹å›ç­”
2. å¼•ç”¨å…·ä½“é¡µç ä½œä¸ºä¾æ®
3. å¦‚æœé—®é¢˜è¶…å‡ºå·²åˆ†æå†…å®¹ï¼Œè¯·è¯šå®è¯´æ˜`};async function hn(){return re.get("/api/manga-insight/prompts/library")}async function fn(a){return re.post("/api/manga-insight/prompts/library",a)}async function bn(a){return re.delete(`/api/manga-insight/prompts/library/${a}`)}async function kn(a){return re.post("/api/manga-insight/prompts/library/import",{library:a})}async function _s(a){return re.get(`/api/manga-insight/${a}/export`)}const rs="insight_provider_configs",Ne=Ds("insight",()=>{const a=k(null),t=k(null),l=k("idle"),s=k({current:0,total:0,status:"idle"}),n=k(0),o=k(0),r=k("full"),h=k(!0),m=k([]),y=k(new Map),C=k(null),z=k([]),B=k([]),M=k([]),R=k([]),q=k(null),N=k("all"),j=k(!1),Q=k(!1),F=k(null),u=k({vlm:{provider:"gemini",apiKey:"",model:"gemini-2.0-flash",baseUrl:"",rpmLimit:10,temperature:.3,forceJson:!1,useStream:!0,imageMaxSize:0},llm:{useSameAsVlm:!0,provider:"gemini",apiKey:"",model:"gemini-2.0-flash",baseUrl:"",useStream:!0},embedding:{provider:"openai",apiKey:"",model:"text-embedding-3-small",baseUrl:"",rpmLimit:0},reranker:{provider:"jina",apiKey:"",model:"jina-reranker-v2-base-multilingual",baseUrl:"",topK:5},batch:{pagesPerBatch:5,contextBatchCount:1,architecturePreset:"standard",customLayers:[]},prompts:{}}),P=k({vlm:{},llm:{},embedding:{},reranker:{}}),v=U(()=>s.value.total===0?0:Math.round(s.value.current/s.value.total*100)),g=U(()=>l.value==="running"),x=U(()=>l.value==="completed"),A=U(()=>{if(o.value>0)return o.value;let d=0;return y.value.forEach(w=>{w.analyzed&&d++}),d}),V=U(()=>n.value||y.value.size),K=U(()=>N.value==="all"?R.value:R.value.filter(d=>d.type===N.value)),te=U(()=>q.value===null?null:y.value.get(q.value)||null);function E(d){a.value=d,d?(console.log(`å½“å‰åˆ†æä¹¦ç±: ${d}`),console.log("å‡†å¤‡åŠ è½½ç¬”è®°..."),ye()):R.value=[]}function $(d){l.value=d,s.value.status=d,console.log(`åˆ†æçŠ¶æ€: ${d}`)}function S(d){t.value=d}function I(d,w,H){s.value={current:d,total:w,status:l.value,message:H}}function L(d){r.value=d}function se(d){h.value=d}function ae(d){n.value=d,console.log(`ä¹¦ç±æ€»é¡µæ•°: ${d}`)}function ve(d){o.value=d,console.log(`å·²åˆ†æé¡µæ•°: ${d}`)}function Ie(d){m.value=d,console.log(`ç« èŠ‚åˆ—è¡¨å·²è®¾ç½®ï¼Œå…± ${d.length} ç« `)}function ke(d,w){y.value.set(d,w)}function He(d){y.value.clear();for(const w of d)y.value.set(w.pageNum,w);console.log(`é¡µé¢æ•°æ®å·²è®¾ç½®ï¼Œå…± ${d.length} é¡µ`)}function ue(d){q.value=d}function we(d){C.value=d,d&&!z.value.includes(d.type)&&z.value.push(d.type)}function xe(d){z.value=d}function Ce(d){B.value=d,console.log(`æ—¶é—´çº¿å·²è®¾ç½®ï¼Œå…± ${d.length} ä¸ªäº‹ä»¶`)}function Ee(d){M.value.push(d)}function je(d){const w=M.value[M.value.length-1];w&&w.role==="assistant"&&(w.content=d)}function Le(){M.value=[]}function Ve(){M.value=M.value.filter(d=>!d.isLoading)}function Se(d){Q.value=d}function qe(d){q.value=d}async function Fe(d){if(await lt(d))R.value.unshift(d),console.log(`å·²æ·»åŠ ç¬”è®°: ${d.id}`);else throw new Error("ä¿å­˜ç¬”è®°åˆ°åç«¯å¤±è´¥")}async function ge(d,w){const H=R.value.find(_e=>_e.id===d);H&&(Object.assign(H,w,{updatedAt:new Date().toISOString()}),await gt(d,w),console.log(`å·²æ›´æ–°ç¬”è®°: ${d}`))}async function ce(d){const w=R.value.findIndex(H=>H.id===d);w>=0&&(await wt(d)?(R.value.splice(w,1),console.log(`å·²åˆ é™¤ç¬”è®°: ${d}`)):console.error(`åˆ é™¤ç¬”è®°å¤±è´¥: ${d}`))}function me(d){N.value=d}async function ye(){if(console.log("loadNotesFromAPI è¢«è°ƒç”¨, bookId:",a.value),!!a.value)try{const w=await(await fetch(`/api/manga-insight/${a.value}/notes`)).json();console.log("ç¬”è®°APIå“åº”:",w),w.success&&w.notes?(R.value=w.notes,console.log(`å·²ä»APIåŠ è½½ ${R.value.length} æ¡ç¬”è®°`)):(console.log("APIè¿”å›æ— ç¬”è®°æ•°æ®"),R.value=[])}catch(d){console.error("ä»APIåŠ è½½ç¬”è®°å¤±è´¥:",d),R.value=[]}}async function lt(d){if(!a.value)return!1;try{return(await(await fetch(`/api/manga-insight/${a.value}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).json()).success}catch(w){return console.error("ä¿å­˜ç¬”è®°åˆ°APIå¤±è´¥:",w),!1}}async function gt(d,w){if(!a.value)return!1;try{return(await(await fetch(`/api/manga-insight/${a.value}/notes/${d}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)})).json()).success}catch(H){return console.error("æ›´æ–°ç¬”è®°åˆ°APIå¤±è´¥:",H),!1}}async function wt(d){if(!a.value)return!1;try{return(await(await fetch(`/api/manga-insight/${a.value}/notes/${d}`,{method:"DELETE"})).json()).success}catch(w){return console.error("ä»APIåˆ é™¤ç¬”è®°å¤±è´¥:",w),!1}}function xt(d){j.value=d}function Ct(d){F.value=d}function St(d){u.value.vlm={...u.value.vlm,...d},at(u.value.vlm.provider),fe()}function Pt(d){u.value.llm={...u.value.llm,...d},Ge(u.value.llm.provider),fe()}function It(d){u.value.embedding={...u.value.embedding,...d},ot(u.value.embedding.provider),fe()}function Tt(d){u.value.reranker={...u.value.reranker,...d},it(u.value.reranker.provider),fe()}function At(d){u.value.batch={...u.value.batch,...d},fe()}function Lt(d){u.value.prompts={...u.value.prompts,...d},fe()}function Bt(d){const w=u.value.vlm.provider;w!==d&&(at(w),u.value.vlm.provider=d,Qe(d),fe(),console.log(`[Insight] VLM æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${d}`))}function Rt(d){const w=u.value.llm.provider;w!==d&&(Ge(w),u.value.llm.provider=d,Et(d),fe(),console.log(`[Insight] LLM æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${d}`))}function zt(d){const w=u.value.embedding.provider;w!==d&&(ot(w),u.value.embedding.provider=d,rt(d),fe(),console.log(`[Insight] Embedding æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${d}`))}function Ut(d){const w=u.value.reranker.provider;w!==d&&(it(w),u.value.reranker.provider=d,Vt(d),fe(),console.log(`[Insight] Reranker æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${d}`))}function Je(){localStorage.setItem(rs,JSON.stringify(P.value))}function Mt(){const d=localStorage.getItem(rs);if(d)try{const w=JSON.parse(d);P.value={vlm:w.vlm||{},llm:w.llm||{},embedding:w.embedding||{},reranker:w.reranker||{}},console.log("[Insight] å·²åŠ è½½æœåŠ¡å•†é…ç½®ç¼“å­˜")}catch(w){console.error("[Insight] åŠ è½½æœåŠ¡å•†é…ç½®ç¼“å­˜å¤±è´¥:",w)}}function at(d){d&&(P.value.vlm[d]={apiKey:u.value.vlm.apiKey,model:u.value.vlm.model,baseUrl:u.value.vlm.baseUrl,rpmLimit:u.value.vlm.rpmLimit,temperature:u.value.vlm.temperature,forceJson:u.value.vlm.forceJson,useStream:u.value.vlm.useStream,imageMaxSize:u.value.vlm.imageMaxSize},Je(),console.log(`[Insight] ä¿å­˜ VLM æœåŠ¡å•†é…ç½®: ${d}`))}function Qe(d){if(!d)return;const w=P.value.vlm[d];w?(w.apiKey!==void 0&&(u.value.vlm.apiKey=w.apiKey),w.model!==void 0&&(u.value.vlm.model=w.model),w.baseUrl!==void 0&&(u.value.vlm.baseUrl=w.baseUrl),w.rpmLimit!==void 0&&(u.value.vlm.rpmLimit=w.rpmLimit),w.temperature!==void 0&&(u.value.vlm.temperature=w.temperature),w.forceJson!==void 0&&(u.value.vlm.forceJson=w.forceJson),w.useStream!==void 0&&(u.value.vlm.useStream=w.useStream),w.imageMaxSize!==void 0&&(u.value.vlm.imageMaxSize=w.imageMaxSize),console.log(`[Insight] æ¢å¤ VLM æœåŠ¡å•†é…ç½®: ${d}`)):(u.value.vlm.apiKey="",u.value.vlm.model="",u.value.vlm.baseUrl="",console.log(`[Insight] ${d} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function Ge(d){d&&(P.value.llm[d]={apiKey:u.value.llm.apiKey,model:u.value.llm.model,baseUrl:u.value.llm.baseUrl,useStream:u.value.llm.useStream},Je(),console.log(`[Insight] ä¿å­˜ LLM æœåŠ¡å•†é…ç½®: ${d}`))}function Et(d){if(!d)return;const w=P.value.llm[d];w?(w.apiKey!==void 0&&(u.value.llm.apiKey=w.apiKey),w.model!==void 0&&(u.value.llm.model=w.model),w.baseUrl!==void 0&&(u.value.llm.baseUrl=w.baseUrl),w.useStream!==void 0&&(u.value.llm.useStream=w.useStream),console.log(`[Insight] æ¢å¤ LLM æœåŠ¡å•†é…ç½®: ${d}`)):(u.value.llm.apiKey="",u.value.llm.model="",u.value.llm.baseUrl="",console.log(`[Insight] ${d} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function ot(d){d&&(P.value.embedding[d]={apiKey:u.value.embedding.apiKey,model:u.value.embedding.model,baseUrl:u.value.embedding.baseUrl,rpmLimit:u.value.embedding.rpmLimit},Je(),console.log(`[Insight] ä¿å­˜ Embedding æœåŠ¡å•†é…ç½®: ${d}`))}function rt(d){if(!d)return;const w=P.value.embedding[d];w?(w.apiKey!==void 0&&(u.value.embedding.apiKey=w.apiKey),w.model!==void 0&&(u.value.embedding.model=w.model),w.baseUrl!==void 0&&(u.value.embedding.baseUrl=w.baseUrl),w.rpmLimit!==void 0&&(u.value.embedding.rpmLimit=w.rpmLimit),console.log(`[Insight] æ¢å¤ Embedding æœåŠ¡å•†é…ç½®: ${d}`)):(u.value.embedding.apiKey="",u.value.embedding.model="",u.value.embedding.baseUrl="",console.log(`[Insight] ${d} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function it(d){d&&(P.value.reranker[d]={apiKey:u.value.reranker.apiKey,model:u.value.reranker.model,baseUrl:u.value.reranker.baseUrl,topK:u.value.reranker.topK},Je(),console.log(`[Insight] ä¿å­˜ Reranker æœåŠ¡å•†é…ç½®: ${d}`))}function Vt(d){if(!d)return;const w=P.value.reranker[d];w?(w.apiKey!==void 0&&(u.value.reranker.apiKey=w.apiKey),w.model!==void 0&&(u.value.reranker.model=w.model),w.baseUrl!==void 0&&(u.value.reranker.baseUrl=w.baseUrl),w.topK!==void 0&&(u.value.reranker.topK=w.topK),console.log(`[Insight] æ¢å¤ Reranker æœåŠ¡å•†é…ç½®: ${d}`)):(u.value.reranker.apiKey="",u.value.reranker.model="",u.value.reranker.baseUrl="",console.log(`[Insight] ${d} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function qt(d){u.value=d,fe()}function fe(){localStorage.setItem("manga_insight_config",JSON.stringify(u.value))}function Kt(){Mt();const w=localStorage.getItem("manga_insight_config");if(w)try{const H=JSON.parse(w);u.value={vlm:{...u.value.vlm,...H.vlm},llm:{...u.value.llm,...H.llm},embedding:{...u.value.embedding,...H.embedding},reranker:{...u.value.reranker,...H.reranker},batch:{...u.value.batch,...H.batch},prompts:H.prompts||{}},console.log("å·²åŠ è½½æ¼«ç”»åˆ†æé…ç½®")}catch(H){console.error("åŠ è½½æ¼«ç”»åˆ†æé…ç½®å¤±è´¥:",H)}}function Ot(){return{vlm:{provider:u.value.vlm.provider,api_key:u.value.vlm.apiKey,model:u.value.vlm.model,base_url:u.value.vlm.baseUrl||null,rpm_limit:u.value.vlm.rpmLimit,temperature:u.value.vlm.temperature,force_json:u.value.vlm.forceJson,use_stream:u.value.vlm.useStream,image_max_size:u.value.vlm.imageMaxSize},chat_llm:{use_same_as_vlm:u.value.llm.useSameAsVlm,provider:u.value.llm.provider,api_key:u.value.llm.apiKey,model:u.value.llm.model,base_url:u.value.llm.baseUrl||null,use_stream:u.value.llm.useStream},embedding:{provider:u.value.embedding.provider,api_key:u.value.embedding.apiKey,model:u.value.embedding.model,base_url:u.value.embedding.baseUrl||null,rpm_limit:u.value.embedding.rpmLimit},reranker:{provider:u.value.reranker.provider,api_key:u.value.reranker.apiKey,model:u.value.reranker.model,base_url:u.value.reranker.baseUrl||null,top_k:u.value.reranker.topK},analysis:{batch:{pages_per_batch:u.value.batch.pagesPerBatch,context_batch_count:u.value.batch.contextBatchCount,architecture_preset:u.value.batch.architecturePreset,custom_layers:u.value.batch.customLayers.map(d=>({name:d.name,units_per_group:d.units,align_to_chapter:d.align}))}},prompts:u.value.prompts,providerSettings:Dt()}}function Dt(){const d={},w={},H={},_e={};for(const[he,ne]of Object.entries(P.value.vlm))d[he]={api_key:ne.apiKey||"",model:ne.model||"",base_url:ne.baseUrl||"",rpm_limit:ne.rpmLimit??10,temperature:ne.temperature??.3,force_json:ne.forceJson??!1,use_stream:ne.useStream??!0,image_max_size:ne.imageMaxSize??0};for(const[he,ne]of Object.entries(P.value.llm))w[he]={api_key:ne.apiKey||"",model:ne.model||"",base_url:ne.baseUrl||"",use_stream:ne.useStream??!0};for(const[he,ne]of Object.entries(P.value.embedding))H[he]={api_key:ne.apiKey||"",model:ne.model||"",base_url:ne.baseUrl||"",rpm_limit:ne.rpmLimit??0};for(const[he,ne]of Object.entries(P.value.reranker))_e[he]={api_key:ne.apiKey||"",model:ne.model||"",base_url:ne.baseUrl||"",top_k:ne.topK??5};return{vlmProvider:d,llmProvider:w,embeddingProvider:H,rerankerProvider:_e}}function Nt(d){const w=d.vlm,H=d.chat_llm,_e=d.embedding,he=d.reranker,Ke=d.analysis?.batch;if(w&&(u.value.vlm={provider:w.provider||"gemini",apiKey:w.api_key||"",model:w.model||"",baseUrl:w.base_url||"",rpmLimit:w.rpm_limit||10,temperature:w.temperature||.3,forceJson:w.force_json||!1,useStream:w.use_stream!==!1,imageMaxSize:w.image_max_size||0}),H&&(u.value.llm={useSameAsVlm:H.use_same_as_vlm!==!1,provider:H.provider||u.value.vlm.provider,apiKey:H.api_key||u.value.vlm.apiKey,model:H.model||u.value.vlm.model,baseUrl:H.base_url||u.value.vlm.baseUrl,useStream:H.use_stream!==!1}),_e&&(u.value.embedding={provider:_e.provider||"openai",apiKey:_e.api_key||"",model:_e.model||"",baseUrl:_e.base_url||"",rpmLimit:_e.rpm_limit??0}),he&&(u.value.reranker={provider:he.provider||"jina",apiKey:he.api_key||"",model:he.model||"",baseUrl:he.base_url||"",topK:he.top_k||5}),Ke){const Re=Ke.custom_layers;u.value.batch={pagesPerBatch:Ke.pages_per_batch||5,contextBatchCount:Ke.context_batch_count??1,architecturePreset:Ke.architecture_preset||"standard",customLayers:Re?.map(le=>({name:le.name||"",units:le.units_per_group||1,align:le.align_to_chapter||!1}))||[]}}const Be=d.providerSettings;if(Be){if(Be.vlmProvider)for(const[Re,le]of Object.entries(Be.vlmProvider))P.value.vlm[Re]={apiKey:le.api_key||"",model:le.model||"",baseUrl:le.base_url||"",rpmLimit:le.rpm_limit??10,temperature:le.temperature??.3,forceJson:le.force_json??!1,useStream:le.use_stream??!0,imageMaxSize:le.image_max_size??0};if(Be.llmProvider)for(const[Re,le]of Object.entries(Be.llmProvider))P.value.llm[Re]={apiKey:le.api_key||"",model:le.model||"",baseUrl:le.base_url||"",useStream:le.use_stream??!0};if(Be.embeddingProvider)for(const[Re,le]of Object.entries(Be.embeddingProvider))P.value.embedding[Re]={apiKey:le.api_key||"",model:le.model||"",baseUrl:le.base_url||"",rpmLimit:le.rpm_limit??0};if(Be.rerankerProvider)for(const[Re,le]of Object.entries(Be.rerankerProvider))P.value.reranker[Re]={apiKey:le.api_key||"",model:le.model||"",baseUrl:le.base_url||"",topK:le.top_k??5};console.log("[Insight] å·²ä»åç«¯æ¢å¤æœåŠ¡å•†é…ç½®ç¼“å­˜"),Je()}const ut=d.prompts;ut&&(u.value.prompts=ut),fe(),at(u.value.vlm.provider),Ge(u.value.llm.provider),ot(u.value.embedding.provider),it(u.value.reranker.provider),console.log("[Insight] å·²ä» API åŠ è½½é…ç½®")}function jt(){l.value="idle",s.value={current:0,total:0,status:"idle"},y.value.clear(),C.value=null,B.value=[],console.log("åˆ†æçŠ¶æ€å·²é‡ç½®")}function D(){a.value=null,l.value="idle",s.value={current:0,total:0,status:"idle"},r.value="full",h.value=!0,m.value=[],y.value.clear(),C.value=null,z.value=[],B.value=[],M.value=[],R.value=[],q.value=null,N.value="all",j.value=!1,Q.value=!1,F.value=null,console.log("æ¼«ç”»åˆ†æçŠ¶æ€å·²é‡ç½®")}return{currentBookId:a,currentTaskId:t,analysisStatus:l,progress:s,analysisMode:r,incrementalAnalysis:h,chapters:m,pages:y,overview:C,generatedTemplates:z,timeline:B,qaHistory:M,notes:R,selectedPageNum:q,noteTypeFilter:N,isLoading:j,isStreaming:Q,error:F,config:u,progressPercent:v,isAnalyzing:g,isAnalysisCompleted:x,analyzedPageCount:A,totalPageCount:V,filteredNotes:K,selectedPage:te,setCurrentBook:E,setCurrentTaskId:S,setAnalysisStatus:$,updateProgress:I,setAnalysisMode:L,setIncrementalAnalysis:se,setBookTotalPages:ae,setAnalyzedPagesCount:ve,setChapters:Ie,setPageData:ke,setPages:He,selectPage:ue,setOverview:we,setGeneratedTemplates:xe,setTimeline:Ce,addQAMessage:Ee,updateLastAssistantMessage:je,clearQAHistory:Le,removeLoadingMessages:Ve,setStreaming:Se,setCurrentPage:qe,addNote:Fe,updateNote:ge,deleteNote:ce,setNoteTypeFilter:me,loadNotesFromAPI:ye,setLoading:xt,setError:Ct,updateVlmConfig:St,updateLlmConfig:Pt,updateEmbeddingConfig:It,updateRerankerConfig:Tt,updateBatchConfig:At,updatePrompts:Lt,setConfig:qt,saveConfigToStorage:fe,loadConfigFromStorage:Kt,getConfigForApi:Ot,setConfigFromApi:Nt,setVlmProvider:Bt,setLlmProvider:Rt,setEmbeddingProvider:zt,setRerankerProvider:Ut,resetAnalysis:jt,reset:D}}),yn={class:"book-selector"},_n=Me({__name:"BookSelector",emits:["select"],setup(a,{emit:t}){const l=t,s=ms(),n=U(()=>s.books),o=U(()=>{const m=[{label:"-- é€‰æ‹©ä¹¦ç± --",value:""}];return n.value.forEach(y=>{m.push({label:y.title||y.id,value:y.id})}),m}),r=k("");function h(m){const y=String(m);r.value=y,y&&l("select",y)}return(m,y)=>(c(),p("div",yn,[pe(Ae,{modelValue:r.value,"onUpdate:modelValue":y[0]||(y[0]=C=>r.value=C),options:o.value,onChange:h},null,8,["modelValue","options"])]))}}),$n=Oe(_n,[["__scopeId","data-v-d6052909"]]),wn={class:"sidebar-section analysis-control-compact"},xn={class:"analysis-status-bar"},Cn={class:"status-left"},Sn={class:"status-label"},Pn={class:"status-right"},In={class:"status-progress"},Tn={key:1,class:"progress-message"},An={class:"analysis-btn-group"},Ln={key:0,class:"btn-group-idle"},Bn=["disabled"],Rn={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},zn={key:1,class:"loading-spinner"},Un={key:1,class:"btn-group-running"},Mn={key:2,class:"btn-group-paused"},En={key:4,class:"page-input-wrapper"},Vn=["max"],qn={class:"page-hint"},Kn={key:5,class:"mode-description"},On={key:6,class:"estimated-time"},Dn={class:"analysis-options-row"},Nn={class:"checkbox-compact",title:"ä»…åˆ†ææœªåˆ†æçš„é¡µé¢ï¼Œè·³è¿‡å·²åˆ†æçš„é¡µé¢"},jn=["checked"],Fn=["disabled"],Qn=Me({__name:"AnalysisProgress",emits:["start-polling","stop-polling"],setup(a,{emit:t}){const l=[{label:"å…¨ä¹¦",value:"full"},{label:"ç« èŠ‚",value:"chapter"},{label:"å•é¡µ",value:"page"}],s=U(()=>{const $=[{label:"é€‰æ‹©ç« èŠ‚...",value:""}];return o.chapters.forEach(S=>{$.push({label:`${S.title} (${S.startPage}-${S.endPage}é¡µ)`,value:S.id})}),$}),n=t,o=Ne(),r=k("full"),h=k(""),m=k(null),y=k(!1),C=k(""),z=U(()=>{const $=o.analysisStatus;return{"status-dot":!0,running:$==="running",paused:$==="paused",completed:$==="completed",failed:$==="failed"}}),B=U(()=>{switch(o.analysisStatus){case"running":return"åˆ†æä¸­";case"paused":return"å·²æš‚åœ";case"completed":return"å·²å®Œæˆ";case"failed":return"åˆ†æå¤±è´¥";default:return"æœªåˆ†æ"}}),M=U(()=>{const{current:$,total:S}=o.progress;return S===0?"":`${$}/${S}`}),R=U(()=>o.analysisStatus==="idle"||o.analysisStatus==="completed"),q=U(()=>o.analysisStatus==="running"),N=U(()=>o.analysisStatus==="paused"),j=U(()=>o.analysisStatus==="completed"?"é‡æ–°åˆ†æ":"å¼€å§‹åˆ†æ"),Q=U(()=>r.value==="chapter"),F=U(()=>r.value==="page"),u=U(()=>!(y.value||o.isAnalyzing||r.value==="chapter"&&!h.value||r.value==="page"&&!m.value)),P=U(()=>{switch(r.value){case"full":return"åˆ†ææ•´æœ¬ä¹¦çš„æ‰€æœ‰é¡µé¢";case"chapter":return"ä»…åˆ†æé€‰ä¸­ç« èŠ‚çš„é¡µé¢";case"page":return"ä»…åˆ†ææŒ‡å®šçš„å•ä¸ªé¡µé¢";default:return""}}),v=U(()=>{const $=o.totalPageCount;if($===0)return"";const S=o.config.batch.pagesPerBatch||5,L=Math.ceil($/S)*10;return L<60?`çº¦ ${L} ç§’`:`çº¦ ${Math.ceil(L/60)} åˆ†é’Ÿ`});function g(){o.setAnalysisMode(r.value)}async function x(){if(o.currentBookId){if(o.isAnalyzing||y.value){console.warn("åˆ†ææ­£åœ¨è¿›è¡Œä¸­æˆ–æ­£åœ¨å¯åŠ¨");return}if(r.value==="chapter"&&!h.value){C.value="è¯·é€‰æ‹©è¦åˆ†æçš„ç« èŠ‚";return}if(r.value==="page"&&!m.value){C.value="è¯·è¾“å…¥è¦åˆ†æçš„é¡µç ";return}y.value=!0,C.value="";try{const $={};r.value==="chapter"&&h.value?($.mode="chapters",$.chapters=[h.value]):r.value==="page"&&m.value?($.mode="pages",$.pages=[m.value]):$.mode=o.incrementalAnalysis?"incremental":"full";const S=await Xs(o.currentBookId,$);S.success?(S.task_id&&o.setCurrentTaskId(S.task_id),o.setAnalysisStatus("running"),n("start-polling")):(C.value=S.error||"å¯åŠ¨åˆ†æå¤±è´¥",console.error("å¯åŠ¨åˆ†æå¤±è´¥:",S.error))}catch($){C.value=$ instanceof Error?$.message:"å¯åŠ¨åˆ†æå¤±è´¥",console.error("å¯åŠ¨åˆ†æå¤±è´¥:",$)}finally{y.value=!1}}}async function A(){if(o.currentBookId)try{(await Ys(o.currentBookId,o.currentTaskId||void 0)).success&&o.setAnalysisStatus("paused")}catch($){console.error("æš‚åœåˆ†æå¤±è´¥:",$)}}async function V(){if(o.currentBookId)try{(await en(o.currentBookId,o.currentTaskId||void 0)).success&&(o.setAnalysisStatus("running"),n("start-polling"))}catch($){console.error("ç»§ç»­åˆ†æå¤±è´¥:",$)}}async function K(){if(o.currentBookId&&confirm("ç¡®å®šè¦å–æ¶ˆåˆ†æå—ï¼Ÿ"))try{(await tn(o.currentBookId,o.currentTaskId||void 0)).success&&(o.setAnalysisStatus("idle"),o.setCurrentTaskId(null),n("stop-polling"))}catch($){console.error("å–æ¶ˆåˆ†æå¤±è´¥:",$)}}async function te(){if(!o.currentBookId){C.value="è¯·å…ˆé€‰æ‹©ä¹¦ç±";return}try{const $=await _s(o.currentBookId);if($.success&&$.markdown){const S=new Blob([$.markdown],{type:"text/markdown"}),I=URL.createObjectURL(S),L=document.createElement("a");L.href=I,L.download=`${o.currentBookId}_analysis.md`,L.click(),URL.revokeObjectURL(I)}else C.value=$.error||"å¯¼å‡ºå¤±è´¥"}catch($){C.value=$ instanceof Error?$.message:"å¯¼å‡ºå¤±è´¥",console.error("å¯¼å‡ºå¤±è´¥:",$)}}function E(){C.value=""}return st(r,()=>{E()}),($,S)=>(c(),p("div",wn,[e("div",xn,[e("div",Cn,[e("span",{class:G(z.value)},null,2),e("span",Sn,_(B.value),1)]),e("div",Pn,[e("span",In,_(M.value),1)])]),q.value||N.value?(c(),p("div",{key:0,class:G(["progress-bar-slim",{paused:N.value}])},[e("div",{class:"progress-fill-slim",style:Ns({width:$e(o).progressPercent+"%"})},null,4)],2)):T("",!0),$e(o).progress.message&&(q.value||N.value)?(c(),p("div",Tn,_($e(o).progress.message),1)):T("",!0),C.value?(c(),p("div",{key:2,class:"error-message",onClick:E}," âš ï¸ "+_(C.value),1)):T("",!0),e("div",An,[R.value?(c(),p("div",Ln,[pe(Ae,{modelValue:r.value,"onUpdate:modelValue":S[0]||(S[0]=I=>r.value=I),options:l,onChange:g},null,8,["modelValue"]),e("button",{class:G(["btn-analysis-start",{loading:y.value}]),disabled:!u.value,onClick:x},[y.value?T("",!0):(c(),p("svg",Rn,[...S[4]||(S[4]=[e("path",{d:"M8 5v14l11-7z"},null,-1)])])),y.value?(c(),p("span",zn)):T("",!0),e("span",null,_(y.value?"å¯åŠ¨ä¸­...":j.value),1)],10,Bn)])):T("",!0),q.value?(c(),p("div",Un,[e("button",{class:"btn-control btn-pause",title:"æš‚åœåˆ†æ",onClick:A},[...S[5]||(S[5]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})],-1),e("span",{class:"btn-label"},"æš‚åœ",-1)])]),e("button",{class:"btn-control btn-cancel",title:"å–æ¶ˆåˆ†æ",onClick:K},[...S[6]||(S[6]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 6h12v12H6z"})],-1),e("span",{class:"btn-label"},"å–æ¶ˆ",-1)])])])):T("",!0),N.value?(c(),p("div",Mn,[e("button",{class:"btn-control btn-resume",title:"ç»§ç»­åˆ†æ",onClick:V},[...S[7]||(S[7]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8 5v14l11-7z"})],-1),e("span",{class:"btn-label"},"ç»§ç»­",-1)])]),e("button",{class:"btn-control btn-cancel",title:"å–æ¶ˆåˆ†æ",onClick:K},[...S[8]||(S[8]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 6h12v12H6z"})],-1),e("span",{class:"btn-label"},"å–æ¶ˆ",-1)])])])):T("",!0)]),Q.value?(c(),et(Ae,{key:3,modelValue:h.value,"onUpdate:modelValue":S[1]||(S[1]=I=>h.value=I),options:s.value},null,8,["modelValue","options"])):T("",!0),F.value?(c(),p("div",En,[O(e("input",{"onUpdate:modelValue":S[2]||(S[2]=I=>m.value=I),type:"number",class:"form-input-compact",placeholder:"è¾“å…¥é¡µç ",min:"1",max:$e(o).totalPageCount||void 0},null,8,Vn),[[Y,m.value,void 0,{number:!0}]]),e("span",qn,"/ "+_($e(o).totalPageCount||"?"),1)])):T("",!0),R.value&&P.value?(c(),p("div",Kn,_(P.value),1)):T("",!0),R.value&&r.value==="full"&&v.value?(c(),p("div",On," â±ï¸ "+_(v.value),1)):T("",!0),e("div",Dn,[e("label",Nn,[e("input",{type:"checkbox",checked:$e(o).incrementalAnalysis,onChange:S[3]||(S[3]=I=>$e(o).setIncrementalAnalysis(I.target.checked))},null,40,jn),S[9]||(S[9]=e("span",null,"å¢é‡æ¨¡å¼",-1))]),e("button",{class:"btn-icon-sm",title:"å¯¼å‡ºåˆ†ææŠ¥å‘Š",disabled:$e(o).analyzedPageCount===0,onClick:te},[...S[10]||(S[10]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,Fn)])]))}}),Hn=Oe(Qn,[["__scopeId","data-v-1421f4fe"]]);function Gt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Xe=Gt();function $s(a){Xe=a}var vt={exec:()=>null};function X(a,t=""){let l=typeof a=="string"?a:a.source,s={replace:(n,o)=>{let r=typeof o=="string"?o:o.source;return r=r.replace(be.caret,"$1"),l=l.replace(n,r),s},getRegex:()=>new RegExp(l,t)};return s}var Jn=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),be={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:a=>new RegExp(`^( {0,3}${a})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:a=>new RegExp(`^ {0,${Math.min(3,a-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:a=>new RegExp(`^ {0,${Math.min(3,a-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:a=>new RegExp(`^ {0,${Math.min(3,a-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:a=>new RegExp(`^ {0,${Math.min(3,a-1)}}#`),htmlBeginRegex:a=>new RegExp(`^ {0,${Math.min(3,a-1)}}<(?:[a-z].*>|!--)`,"i")},Gn=/^(?:[ \t]*(?:\n|$))+/,Zn=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Wn=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,mt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Xn=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Zt=/(?:[*+-]|\d{1,9}[.)])/,ws=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,xs=X(ws).replace(/bull/g,Zt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Yn=X(ws).replace(/bull/g,Zt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Wt=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,el=/^[^\n]+/,Xt=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,tl=X(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Xt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),sl=X(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Zt).getRegex(),_t="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Yt=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,nl=X("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Yt).replace("tag",_t).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Cs=X(Wt).replace("hr",mt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",_t).getRegex(),ll=X(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Cs).getRegex(),es={blockquote:ll,code:Zn,def:tl,fences:Wn,heading:Xn,hr:mt,html:nl,lheading:xs,list:sl,newline:Gn,paragraph:Cs,table:vt,text:el},is=X("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",mt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",_t).getRegex(),al={...es,lheading:Yn,table:is,paragraph:X(Wt).replace("hr",mt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",is).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",_t).getRegex()},ol={...es,html:X(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Yt).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:vt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:X(Wt).replace("hr",mt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",xs).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},rl=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,il=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Ss=/^( {2,}|\\)\n(?!\s*$)/,ul=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,$t=/[\p{P}\p{S}]/u,ts=/[\s\p{P}\p{S}]/u,Ps=/[^\s\p{P}\p{S}]/u,cl=X(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,ts).getRegex(),Is=/(?!~)[\p{P}\p{S}]/u,dl=/(?!~)[\s\p{P}\p{S}]/u,pl=/(?:[^\s\p{P}\p{S}]|~)/u,vl=X(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",Jn?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Ts=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,ml=X(Ts,"u").replace(/punct/g,$t).getRegex(),gl=X(Ts,"u").replace(/punct/g,Is).getRegex(),As="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",hl=X(As,"gu").replace(/notPunctSpace/g,Ps).replace(/punctSpace/g,ts).replace(/punct/g,$t).getRegex(),fl=X(As,"gu").replace(/notPunctSpace/g,pl).replace(/punctSpace/g,dl).replace(/punct/g,Is).getRegex(),bl=X("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Ps).replace(/punctSpace/g,ts).replace(/punct/g,$t).getRegex(),kl=X(/\\(punct)/,"gu").replace(/punct/g,$t).getRegex(),yl=X(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),_l=X(Yt).replace("(?:-->|$)","-->").getRegex(),$l=X("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",_l).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),bt=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,wl=X(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",bt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ls=X(/^!?\[(label)\]\[(ref)\]/).replace("label",bt).replace("ref",Xt).getRegex(),Bs=X(/^!?\[(ref)\](?:\[\])?/).replace("ref",Xt).getRegex(),xl=X("reflink|nolink(?!\\()","g").replace("reflink",Ls).replace("nolink",Bs).getRegex(),us=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,ss={_backpedal:vt,anyPunctuation:kl,autolink:yl,blockSkip:vl,br:Ss,code:il,del:vt,emStrongLDelim:ml,emStrongRDelimAst:hl,emStrongRDelimUnd:bl,escape:rl,link:wl,nolink:Bs,punctuation:cl,reflink:Ls,reflinkSearch:xl,tag:$l,text:ul,url:vt},Cl={...ss,link:X(/^!?\[(label)\]\((.*?)\)/).replace("label",bt).getRegex(),reflink:X(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",bt).getRegex()},Qt={...ss,emStrongRDelimAst:fl,emStrongLDelim:gl,url:X(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",us).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:X(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",us).getRegex()},Sl={...Qt,br:X(Ss).replace("{2,}","*").getRegex(),text:X(Qt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ht={normal:es,gfm:al,pedantic:ol},ct={normal:ss,gfm:Qt,breaks:Sl,pedantic:Cl},Pl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},cs=a=>Pl[a];function De(a,t){if(t){if(be.escapeTest.test(a))return a.replace(be.escapeReplace,cs)}else if(be.escapeTestNoEncode.test(a))return a.replace(be.escapeReplaceNoEncode,cs);return a}function ds(a){try{a=encodeURI(a).replace(be.percentDecode,"%")}catch{return null}return a}function ps(a,t){let l=a.replace(be.findPipe,(o,r,h)=>{let m=!1,y=r;for(;--y>=0&&h[y]==="\\";)m=!m;return m?"|":" |"}),s=l.split(be.splitPipe),n=0;if(s[0].trim()||s.shift(),s.length>0&&!s.at(-1)?.trim()&&s.pop(),t)if(s.length>t)s.splice(t);else for(;s.length<t;)s.push("");for(;n<s.length;n++)s[n]=s[n].trim().replace(be.slashPipe,"|");return s}function dt(a,t,l){let s=a.length;if(s===0)return"";let n=0;for(;n<s&&a.charAt(s-n-1)===t;)n++;return a.slice(0,s-n)}function Il(a,t){if(a.indexOf(t[1])===-1)return-1;let l=0;for(let s=0;s<a.length;s++)if(a[s]==="\\")s++;else if(a[s]===t[0])l++;else if(a[s]===t[1]&&(l--,l<0))return s;return l>0?-2:-1}function vs(a,t,l,s,n){let o=t.href,r=t.title||null,h=a[1].replace(n.other.outputLinkReplace,"$1");s.state.inLink=!0;let m={type:a[0].charAt(0)==="!"?"image":"link",raw:l,href:o,title:r,text:h,tokens:s.inlineTokens(h)};return s.state.inLink=!1,m}function Tl(a,t,l){let s=a.match(l.other.indentCodeCompensation);if(s===null)return t;let n=s[1];return t.split(`
`).map(o=>{let r=o.match(l.other.beginningSpace);if(r===null)return o;let[h]=r;return h.length>=n.length?o.slice(n.length):o}).join(`
`)}var kt=class{options;rules;lexer;constructor(a){this.options=a||Xe}space(a){let t=this.rules.block.newline.exec(a);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(a){let t=this.rules.block.code.exec(a);if(t){let l=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?l:dt(l,`
`)}}}fences(a){let t=this.rules.block.fences.exec(a);if(t){let l=t[0],s=Tl(l,t[3]||"",this.rules);return{type:"code",raw:l,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:s}}}heading(a){let t=this.rules.block.heading.exec(a);if(t){let l=t[2].trim();if(this.rules.other.endingHash.test(l)){let s=dt(l,"#");(this.options.pedantic||!s||this.rules.other.endingSpaceChar.test(s))&&(l=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:l,tokens:this.lexer.inline(l)}}}hr(a){let t=this.rules.block.hr.exec(a);if(t)return{type:"hr",raw:dt(t[0],`
`)}}blockquote(a){let t=this.rules.block.blockquote.exec(a);if(t){let l=dt(t[0],`
`).split(`
`),s="",n="",o=[];for(;l.length>0;){let r=!1,h=[],m;for(m=0;m<l.length;m++)if(this.rules.other.blockquoteStart.test(l[m]))h.push(l[m]),r=!0;else if(!r)h.push(l[m]);else break;l=l.slice(m);let y=h.join(`
`),C=y.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");s=s?`${s}
${y}`:y,n=n?`${n}
${C}`:C;let z=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(C,o,!0),this.lexer.state.top=z,l.length===0)break;let B=o.at(-1);if(B?.type==="code")break;if(B?.type==="blockquote"){let M=B,R=M.raw+`
`+l.join(`
`),q=this.blockquote(R);o[o.length-1]=q,s=s.substring(0,s.length-M.raw.length)+q.raw,n=n.substring(0,n.length-M.text.length)+q.text;break}else if(B?.type==="list"){let M=B,R=M.raw+`
`+l.join(`
`),q=this.list(R);o[o.length-1]=q,s=s.substring(0,s.length-B.raw.length)+q.raw,n=n.substring(0,n.length-M.raw.length)+q.raw,l=R.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:s,tokens:o,text:n}}}list(a){let t=this.rules.block.list.exec(a);if(t){let l=t[1].trim(),s=l.length>1,n={type:"list",raw:"",ordered:s,start:s?+l.slice(0,-1):"",loose:!1,items:[]};l=s?`\\d{1,9}\\${l.slice(-1)}`:`\\${l}`,this.options.pedantic&&(l=s?l:"[*+-]");let o=this.rules.other.listItemRegex(l),r=!1;for(;a;){let m=!1,y="",C="";if(!(t=o.exec(a))||this.rules.block.hr.test(a))break;y=t[0],a=a.substring(y.length);let z=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,q=>" ".repeat(3*q.length)),B=a.split(`
`,1)[0],M=!z.trim(),R=0;if(this.options.pedantic?(R=2,C=z.trimStart()):M?R=t[1].length+1:(R=t[2].search(this.rules.other.nonSpaceChar),R=R>4?1:R,C=z.slice(R),R+=t[1].length),M&&this.rules.other.blankLine.test(B)&&(y+=B+`
`,a=a.substring(B.length+1),m=!0),!m){let q=this.rules.other.nextBulletRegex(R),N=this.rules.other.hrRegex(R),j=this.rules.other.fencesBeginRegex(R),Q=this.rules.other.headingBeginRegex(R),F=this.rules.other.htmlBeginRegex(R);for(;a;){let u=a.split(`
`,1)[0],P;if(B=u,this.options.pedantic?(B=B.replace(this.rules.other.listReplaceNesting,"  "),P=B):P=B.replace(this.rules.other.tabCharGlobal,"    "),j.test(B)||Q.test(B)||F.test(B)||q.test(B)||N.test(B))break;if(P.search(this.rules.other.nonSpaceChar)>=R||!B.trim())C+=`
`+P.slice(R);else{if(M||z.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||j.test(z)||Q.test(z)||N.test(z))break;C+=`
`+B}!M&&!B.trim()&&(M=!0),y+=u+`
`,a=a.substring(u.length+1),z=P.slice(R)}}n.loose||(r?n.loose=!0:this.rules.other.doubleBlankLine.test(y)&&(r=!0)),n.items.push({type:"list_item",raw:y,task:!!this.options.gfm&&this.rules.other.listIsTask.test(C),loose:!1,text:C,tokens:[]}),n.raw+=y}let h=n.items.at(-1);if(h)h.raw=h.raw.trimEnd(),h.text=h.text.trimEnd();else return;n.raw=n.raw.trimEnd();for(let m of n.items){if(this.lexer.state.top=!1,m.tokens=this.lexer.blockTokens(m.text,[]),m.task){if(m.text=m.text.replace(this.rules.other.listReplaceTask,""),m.tokens[0]?.type==="text"||m.tokens[0]?.type==="paragraph"){m.tokens[0].raw=m.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),m.tokens[0].text=m.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let C=this.lexer.inlineQueue.length-1;C>=0;C--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[C].src)){this.lexer.inlineQueue[C].src=this.lexer.inlineQueue[C].src.replace(this.rules.other.listReplaceTask,"");break}}let y=this.rules.other.listTaskCheckbox.exec(m.raw);if(y){let C={type:"checkbox",raw:y[0]+" ",checked:y[0]!=="[ ]"};m.checked=C.checked,n.loose?m.tokens[0]&&["paragraph","text"].includes(m.tokens[0].type)&&"tokens"in m.tokens[0]&&m.tokens[0].tokens?(m.tokens[0].raw=C.raw+m.tokens[0].raw,m.tokens[0].text=C.raw+m.tokens[0].text,m.tokens[0].tokens.unshift(C)):m.tokens.unshift({type:"paragraph",raw:C.raw,text:C.raw,tokens:[C]}):m.tokens.unshift(C)}}if(!n.loose){let y=m.tokens.filter(z=>z.type==="space"),C=y.length>0&&y.some(z=>this.rules.other.anyLine.test(z.raw));n.loose=C}}if(n.loose)for(let m of n.items){m.loose=!0;for(let y of m.tokens)y.type==="text"&&(y.type="paragraph")}return n}}html(a){let t=this.rules.block.html.exec(a);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(a){let t=this.rules.block.def.exec(a);if(t){let l=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),s=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:l,raw:t[0],href:s,title:n}}}table(a){let t=this.rules.block.table.exec(a);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let l=ps(t[1]),s=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),n=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(l.length===s.length){for(let r of s)this.rules.other.tableAlignRight.test(r)?o.align.push("right"):this.rules.other.tableAlignCenter.test(r)?o.align.push("center"):this.rules.other.tableAlignLeft.test(r)?o.align.push("left"):o.align.push(null);for(let r=0;r<l.length;r++)o.header.push({text:l[r],tokens:this.lexer.inline(l[r]),header:!0,align:o.align[r]});for(let r of n)o.rows.push(ps(r,o.header.length).map((h,m)=>({text:h,tokens:this.lexer.inline(h),header:!1,align:o.align[m]})));return o}}lheading(a){let t=this.rules.block.lheading.exec(a);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(a){let t=this.rules.block.paragraph.exec(a);if(t){let l=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:l,tokens:this.lexer.inline(l)}}}text(a){let t=this.rules.block.text.exec(a);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(a){let t=this.rules.inline.escape.exec(a);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(a){let t=this.rules.inline.tag.exec(a);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(a){let t=this.rules.inline.link.exec(a);if(t){let l=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(l)){if(!this.rules.other.endAngleBracket.test(l))return;let o=dt(l.slice(0,-1),"\\");if((l.length-o.length)%2===0)return}else{let o=Il(t[2],"()");if(o===-2)return;if(o>-1){let r=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,r).trim(),t[3]=""}}let s=t[2],n="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(s);o&&(s=o[1],n=o[3])}else n=t[3]?t[3].slice(1,-1):"";return s=s.trim(),this.rules.other.startAngleBracket.test(s)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(l)?s=s.slice(1):s=s.slice(1,-1)),vs(t,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:n&&n.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(a,t){let l;if((l=this.rules.inline.reflink.exec(a))||(l=this.rules.inline.nolink.exec(a))){let s=(l[2]||l[1]).replace(this.rules.other.multipleSpaceGlobal," "),n=t[s.toLowerCase()];if(!n){let o=l[0].charAt(0);return{type:"text",raw:o,text:o}}return vs(l,n,l[0],this.lexer,this.rules)}}emStrong(a,t,l=""){let s=this.rules.inline.emStrongLDelim.exec(a);if(!(!s||s[3]&&l.match(this.rules.other.unicodeAlphaNumeric))&&(!(s[1]||s[2])||!l||this.rules.inline.punctuation.exec(l))){let n=[...s[0]].length-1,o,r,h=n,m=0,y=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(y.lastIndex=0,t=t.slice(-1*a.length+n);(s=y.exec(t))!=null;){if(o=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!o)continue;if(r=[...o].length,s[3]||s[4]){h+=r;continue}else if((s[5]||s[6])&&n%3&&!((n+r)%3)){m+=r;continue}if(h-=r,h>0)continue;r=Math.min(r,r+h+m);let C=[...s[0]][0].length,z=a.slice(0,n+s.index+C+r);if(Math.min(n,r)%2){let M=z.slice(1,-1);return{type:"em",raw:z,text:M,tokens:this.lexer.inlineTokens(M)}}let B=z.slice(2,-2);return{type:"strong",raw:z,text:B,tokens:this.lexer.inlineTokens(B)}}}}codespan(a){let t=this.rules.inline.code.exec(a);if(t){let l=t[2].replace(this.rules.other.newLineCharGlobal," "),s=this.rules.other.nonSpaceChar.test(l),n=this.rules.other.startingSpaceChar.test(l)&&this.rules.other.endingSpaceChar.test(l);return s&&n&&(l=l.substring(1,l.length-1)),{type:"codespan",raw:t[0],text:l}}}br(a){let t=this.rules.inline.br.exec(a);if(t)return{type:"br",raw:t[0]}}del(a){let t=this.rules.inline.del.exec(a);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(a){let t=this.rules.inline.autolink.exec(a);if(t){let l,s;return t[2]==="@"?(l=t[1],s="mailto:"+l):(l=t[1],s=l),{type:"link",raw:t[0],text:l,href:s,tokens:[{type:"text",raw:l,text:l}]}}}url(a){let t;if(t=this.rules.inline.url.exec(a)){let l,s;if(t[2]==="@")l=t[0],s="mailto:"+l;else{let n;do n=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(n!==t[0]);l=t[0],t[1]==="www."?s="http://"+t[0]:s=t[0]}return{type:"link",raw:t[0],text:l,href:s,tokens:[{type:"text",raw:l,text:l}]}}}inlineText(a){let t=this.rules.inline.text.exec(a);if(t){let l=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:l}}}},ze=class Ht{tokens;options;state;inlineQueue;tokenizer;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Xe,this.options.tokenizer=this.options.tokenizer||new kt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let l={other:be,block:ht.normal,inline:ct.normal};this.options.pedantic?(l.block=ht.pedantic,l.inline=ct.pedantic):this.options.gfm&&(l.block=ht.gfm,this.options.breaks?l.inline=ct.breaks:l.inline=ct.gfm),this.tokenizer.rules=l}static get rules(){return{block:ht,inline:ct}}static lex(t,l){return new Ht(l).lex(t)}static lexInline(t,l){return new Ht(l).inlineTokens(t)}lex(t){t=t.replace(be.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let l=0;l<this.inlineQueue.length;l++){let s=this.inlineQueue[l];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,l=[],s=!1){for(this.options.pedantic&&(t=t.replace(be.tabCharGlobal,"    ").replace(be.spaceLine,""));t;){let n;if(this.options.extensions?.block?.some(r=>(n=r.call({lexer:this},t,l))?(t=t.substring(n.raw.length),l.push(n),!0):!1))continue;if(n=this.tokenizer.space(t)){t=t.substring(n.raw.length);let r=l.at(-1);n.raw.length===1&&r!==void 0?r.raw+=`
`:l.push(n);continue}if(n=this.tokenizer.code(t)){t=t.substring(n.raw.length);let r=l.at(-1);r?.type==="paragraph"||r?.type==="text"?(r.raw+=(r.raw.endsWith(`
`)?"":`
`)+n.raw,r.text+=`
`+n.text,this.inlineQueue.at(-1).src=r.text):l.push(n);continue}if(n=this.tokenizer.fences(t)){t=t.substring(n.raw.length),l.push(n);continue}if(n=this.tokenizer.heading(t)){t=t.substring(n.raw.length),l.push(n);continue}if(n=this.tokenizer.hr(t)){t=t.substring(n.raw.length),l.push(n);continue}if(n=this.tokenizer.blockquote(t)){t=t.substring(n.raw.length),l.push(n);continue}if(n=this.tokenizer.list(t)){t=t.substring(n.raw.length),l.push(n);continue}if(n=this.tokenizer.html(t)){t=t.substring(n.raw.length),l.push(n);continue}if(n=this.tokenizer.def(t)){t=t.substring(n.raw.length);let r=l.at(-1);r?.type==="paragraph"||r?.type==="text"?(r.raw+=(r.raw.endsWith(`
`)?"":`
`)+n.raw,r.text+=`
`+n.raw,this.inlineQueue.at(-1).src=r.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title},l.push(n));continue}if(n=this.tokenizer.table(t)){t=t.substring(n.raw.length),l.push(n);continue}if(n=this.tokenizer.lheading(t)){t=t.substring(n.raw.length),l.push(n);continue}let o=t;if(this.options.extensions?.startBlock){let r=1/0,h=t.slice(1),m;this.options.extensions.startBlock.forEach(y=>{m=y.call({lexer:this},h),typeof m=="number"&&m>=0&&(r=Math.min(r,m))}),r<1/0&&r>=0&&(o=t.substring(0,r+1))}if(this.state.top&&(n=this.tokenizer.paragraph(o))){let r=l.at(-1);s&&r?.type==="paragraph"?(r.raw+=(r.raw.endsWith(`
`)?"":`
`)+n.raw,r.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=r.text):l.push(n),s=o.length!==t.length,t=t.substring(n.raw.length);continue}if(n=this.tokenizer.text(t)){t=t.substring(n.raw.length);let r=l.at(-1);r?.type==="text"?(r.raw+=(r.raw.endsWith(`
`)?"":`
`)+n.raw,r.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=r.text):l.push(n);continue}if(t){let r="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(r);break}else throw new Error(r)}}return this.state.top=!0,l}inline(t,l=[]){return this.inlineQueue.push({src:t,tokens:l}),l}inlineTokens(t,l=[]){let s=t,n=null;if(this.tokens.links){let m=Object.keys(this.tokens.links);if(m.length>0)for(;(n=this.tokenizer.rules.inline.reflinkSearch.exec(s))!=null;)m.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(s=s.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(n=this.tokenizer.rules.inline.anyPunctuation.exec(s))!=null;)s=s.slice(0,n.index)+"++"+s.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(n=this.tokenizer.rules.inline.blockSkip.exec(s))!=null;)o=n[2]?n[2].length:0,s=s.slice(0,n.index+o)+"["+"a".repeat(n[0].length-o-2)+"]"+s.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);s=this.options.hooks?.emStrongMask?.call({lexer:this},s)??s;let r=!1,h="";for(;t;){r||(h=""),r=!1;let m;if(this.options.extensions?.inline?.some(C=>(m=C.call({lexer:this},t,l))?(t=t.substring(m.raw.length),l.push(m),!0):!1))continue;if(m=this.tokenizer.escape(t)){t=t.substring(m.raw.length),l.push(m);continue}if(m=this.tokenizer.tag(t)){t=t.substring(m.raw.length),l.push(m);continue}if(m=this.tokenizer.link(t)){t=t.substring(m.raw.length),l.push(m);continue}if(m=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(m.raw.length);let C=l.at(-1);m.type==="text"&&C?.type==="text"?(C.raw+=m.raw,C.text+=m.text):l.push(m);continue}if(m=this.tokenizer.emStrong(t,s,h)){t=t.substring(m.raw.length),l.push(m);continue}if(m=this.tokenizer.codespan(t)){t=t.substring(m.raw.length),l.push(m);continue}if(m=this.tokenizer.br(t)){t=t.substring(m.raw.length),l.push(m);continue}if(m=this.tokenizer.del(t)){t=t.substring(m.raw.length),l.push(m);continue}if(m=this.tokenizer.autolink(t)){t=t.substring(m.raw.length),l.push(m);continue}if(!this.state.inLink&&(m=this.tokenizer.url(t))){t=t.substring(m.raw.length),l.push(m);continue}let y=t;if(this.options.extensions?.startInline){let C=1/0,z=t.slice(1),B;this.options.extensions.startInline.forEach(M=>{B=M.call({lexer:this},z),typeof B=="number"&&B>=0&&(C=Math.min(C,B))}),C<1/0&&C>=0&&(y=t.substring(0,C+1))}if(m=this.tokenizer.inlineText(y)){t=t.substring(m.raw.length),m.raw.slice(-1)!=="_"&&(h=m.raw.slice(-1)),r=!0;let C=l.at(-1);C?.type==="text"?(C.raw+=m.raw,C.text+=m.text):l.push(m);continue}if(t){let C="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(C);break}else throw new Error(C)}}return l}},yt=class{options;parser;constructor(a){this.options=a||Xe}space(a){return""}code({text:a,lang:t,escaped:l}){let s=(t||"").match(be.notSpaceStart)?.[0],n=a.replace(be.endingNewline,"")+`
`;return s?'<pre><code class="language-'+De(s)+'">'+(l?n:De(n,!0))+`</code></pre>
`:"<pre><code>"+(l?n:De(n,!0))+`</code></pre>
`}blockquote({tokens:a}){return`<blockquote>
${this.parser.parse(a)}</blockquote>
`}html({text:a}){return a}def(a){return""}heading({tokens:a,depth:t}){return`<h${t}>${this.parser.parseInline(a)}</h${t}>
`}hr(a){return`<hr>
`}list(a){let t=a.ordered,l=a.start,s="";for(let r=0;r<a.items.length;r++){let h=a.items[r];s+=this.listitem(h)}let n=t?"ol":"ul",o=t&&l!==1?' start="'+l+'"':"";return"<"+n+o+`>
`+s+"</"+n+`>
`}listitem(a){return`<li>${this.parser.parse(a.tokens)}</li>
`}checkbox({checked:a}){return"<input "+(a?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:a}){return`<p>${this.parser.parseInline(a)}</p>
`}table(a){let t="",l="";for(let n=0;n<a.header.length;n++)l+=this.tablecell(a.header[n]);t+=this.tablerow({text:l});let s="";for(let n=0;n<a.rows.length;n++){let o=a.rows[n];l="";for(let r=0;r<o.length;r++)l+=this.tablecell(o[r]);s+=this.tablerow({text:l})}return s&&(s=`<tbody>${s}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+s+`</table>
`}tablerow({text:a}){return`<tr>
${a}</tr>
`}tablecell(a){let t=this.parser.parseInline(a.tokens),l=a.header?"th":"td";return(a.align?`<${l} align="${a.align}">`:`<${l}>`)+t+`</${l}>
`}strong({tokens:a}){return`<strong>${this.parser.parseInline(a)}</strong>`}em({tokens:a}){return`<em>${this.parser.parseInline(a)}</em>`}codespan({text:a}){return`<code>${De(a,!0)}</code>`}br(a){return"<br>"}del({tokens:a}){return`<del>${this.parser.parseInline(a)}</del>`}link({href:a,title:t,tokens:l}){let s=this.parser.parseInline(l),n=ds(a);if(n===null)return s;a=n;let o='<a href="'+a+'"';return t&&(o+=' title="'+De(t)+'"'),o+=">"+s+"</a>",o}image({href:a,title:t,text:l,tokens:s}){s&&(l=this.parser.parseInline(s,this.parser.textRenderer));let n=ds(a);if(n===null)return De(l);a=n;let o=`<img src="${a}" alt="${l}"`;return t&&(o+=` title="${De(t)}"`),o+=">",o}text(a){return"tokens"in a&&a.tokens?this.parser.parseInline(a.tokens):"escaped"in a&&a.escaped?a.text:De(a.text)}},ns=class{strong({text:a}){return a}em({text:a}){return a}codespan({text:a}){return a}del({text:a}){return a}html({text:a}){return a}text({text:a}){return a}link({text:a}){return""+a}image({text:a}){return""+a}br(){return""}checkbox({raw:a}){return a}},Ue=class Jt{options;renderer;textRenderer;constructor(t){this.options=t||Xe,this.options.renderer=this.options.renderer||new yt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ns}static parse(t,l){return new Jt(l).parse(t)}static parseInline(t,l){return new Jt(l).parseInline(t)}parse(t){let l="";for(let s=0;s<t.length;s++){let n=t[s];if(this.options.extensions?.renderers?.[n.type]){let r=n,h=this.options.extensions.renderers[r.type].call({parser:this},r);if(h!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(r.type)){l+=h||"";continue}}let o=n;switch(o.type){case"space":{l+=this.renderer.space(o);break}case"hr":{l+=this.renderer.hr(o);break}case"heading":{l+=this.renderer.heading(o);break}case"code":{l+=this.renderer.code(o);break}case"table":{l+=this.renderer.table(o);break}case"blockquote":{l+=this.renderer.blockquote(o);break}case"list":{l+=this.renderer.list(o);break}case"checkbox":{l+=this.renderer.checkbox(o);break}case"html":{l+=this.renderer.html(o);break}case"def":{l+=this.renderer.def(o);break}case"paragraph":{l+=this.renderer.paragraph(o);break}case"text":{l+=this.renderer.text(o);break}default:{let r='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(r),"";throw new Error(r)}}}return l}parseInline(t,l=this.renderer){let s="";for(let n=0;n<t.length;n++){let o=t[n];if(this.options.extensions?.renderers?.[o.type]){let h=this.options.extensions.renderers[o.type].call({parser:this},o);if(h!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){s+=h||"";continue}}let r=o;switch(r.type){case"escape":{s+=l.text(r);break}case"html":{s+=l.html(r);break}case"link":{s+=l.link(r);break}case"image":{s+=l.image(r);break}case"checkbox":{s+=l.checkbox(r);break}case"strong":{s+=l.strong(r);break}case"em":{s+=l.em(r);break}case"codespan":{s+=l.codespan(r);break}case"br":{s+=l.br(r);break}case"del":{s+=l.del(r);break}case"text":{s+=l.text(r);break}default:{let h='Token with "'+r.type+'" type was not found.';if(this.options.silent)return console.error(h),"";throw new Error(h)}}}return s}},pt=class{options;block;constructor(a){this.options=a||Xe}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(a){return a}postprocess(a){return a}processAllTokens(a){return a}emStrongMask(a){return a}provideLexer(){return this.block?ze.lex:ze.lexInline}provideParser(){return this.block?Ue.parse:Ue.parseInline}},Al=class{defaults=Gt();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Ue;Renderer=yt;TextRenderer=ns;Lexer=ze;Tokenizer=kt;Hooks=pt;constructor(...a){this.use(...a)}walkTokens(a,t){let l=[];for(let s of a)switch(l=l.concat(t.call(this,s)),s.type){case"table":{let n=s;for(let o of n.header)l=l.concat(this.walkTokens(o.tokens,t));for(let o of n.rows)for(let r of o)l=l.concat(this.walkTokens(r.tokens,t));break}case"list":{let n=s;l=l.concat(this.walkTokens(n.items,t));break}default:{let n=s;this.defaults.extensions?.childTokens?.[n.type]?this.defaults.extensions.childTokens[n.type].forEach(o=>{let r=n[o].flat(1/0);l=l.concat(this.walkTokens(r,t))}):n.tokens&&(l=l.concat(this.walkTokens(n.tokens,t)))}}return l}use(...a){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return a.forEach(l=>{let s={...l};if(s.async=this.defaults.async||s.async||!1,l.extensions&&(l.extensions.forEach(n=>{if(!n.name)throw new Error("extension name required");if("renderer"in n){let o=t.renderers[n.name];o?t.renderers[n.name]=function(...r){let h=n.renderer.apply(this,r);return h===!1&&(h=o.apply(this,r)),h}:t.renderers[n.name]=n.renderer}if("tokenizer"in n){if(!n.level||n.level!=="block"&&n.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=t[n.level];o?o.unshift(n.tokenizer):t[n.level]=[n.tokenizer],n.start&&(n.level==="block"?t.startBlock?t.startBlock.push(n.start):t.startBlock=[n.start]:n.level==="inline"&&(t.startInline?t.startInline.push(n.start):t.startInline=[n.start]))}"childTokens"in n&&n.childTokens&&(t.childTokens[n.name]=n.childTokens)}),s.extensions=t),l.renderer){let n=this.defaults.renderer||new yt(this.defaults);for(let o in l.renderer){if(!(o in n))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let r=o,h=l.renderer[r],m=n[r];n[r]=(...y)=>{let C=h.apply(n,y);return C===!1&&(C=m.apply(n,y)),C||""}}s.renderer=n}if(l.tokenizer){let n=this.defaults.tokenizer||new kt(this.defaults);for(let o in l.tokenizer){if(!(o in n))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let r=o,h=l.tokenizer[r],m=n[r];n[r]=(...y)=>{let C=h.apply(n,y);return C===!1&&(C=m.apply(n,y)),C}}s.tokenizer=n}if(l.hooks){let n=this.defaults.hooks||new pt;for(let o in l.hooks){if(!(o in n))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let r=o,h=l.hooks[r],m=n[r];pt.passThroughHooks.has(o)?n[r]=y=>{if(this.defaults.async&&pt.passThroughHooksRespectAsync.has(o))return(async()=>{let z=await h.call(n,y);return m.call(n,z)})();let C=h.call(n,y);return m.call(n,C)}:n[r]=(...y)=>{if(this.defaults.async)return(async()=>{let z=await h.apply(n,y);return z===!1&&(z=await m.apply(n,y)),z})();let C=h.apply(n,y);return C===!1&&(C=m.apply(n,y)),C}}s.hooks=n}if(l.walkTokens){let n=this.defaults.walkTokens,o=l.walkTokens;s.walkTokens=function(r){let h=[];return h.push(o.call(this,r)),n&&(h=h.concat(n.call(this,r))),h}}this.defaults={...this.defaults,...s}}),this}setOptions(a){return this.defaults={...this.defaults,...a},this}lexer(a,t){return ze.lex(a,t??this.defaults)}parser(a,t){return Ue.parse(a,t??this.defaults)}parseMarkdown(a){return(t,l)=>{let s={...l},n={...this.defaults,...s},o=this.onError(!!n.silent,!!n.async);if(this.defaults.async===!0&&s.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(n.hooks&&(n.hooks.options=n,n.hooks.block=a),n.async)return(async()=>{let r=n.hooks?await n.hooks.preprocess(t):t,h=await(n.hooks?await n.hooks.provideLexer():a?ze.lex:ze.lexInline)(r,n),m=n.hooks?await n.hooks.processAllTokens(h):h;n.walkTokens&&await Promise.all(this.walkTokens(m,n.walkTokens));let y=await(n.hooks?await n.hooks.provideParser():a?Ue.parse:Ue.parseInline)(m,n);return n.hooks?await n.hooks.postprocess(y):y})().catch(o);try{n.hooks&&(t=n.hooks.preprocess(t));let r=(n.hooks?n.hooks.provideLexer():a?ze.lex:ze.lexInline)(t,n);n.hooks&&(r=n.hooks.processAllTokens(r)),n.walkTokens&&this.walkTokens(r,n.walkTokens);let h=(n.hooks?n.hooks.provideParser():a?Ue.parse:Ue.parseInline)(r,n);return n.hooks&&(h=n.hooks.postprocess(h)),h}catch(r){return o(r)}}}onError(a,t){return l=>{if(l.message+=`
Please report this to https://github.com/markedjs/marked.`,a){let s="<p>An error occurred:</p><pre>"+De(l.message+"",!0)+"</pre>";return t?Promise.resolve(s):s}if(t)return Promise.reject(l);throw l}}},We=new Al;function ee(a,t){return We.parse(a,t)}ee.options=ee.setOptions=function(a){return We.setOptions(a),ee.defaults=We.defaults,$s(ee.defaults),ee};ee.getDefaults=Gt;ee.defaults=Xe;ee.use=function(...a){return We.use(...a),ee.defaults=We.defaults,$s(ee.defaults),ee};ee.walkTokens=function(a,t){return We.walkTokens(a,t)};ee.parseInline=We.parseInline;ee.Parser=Ue;ee.parser=Ue.parse;ee.Renderer=yt;ee.TextRenderer=ns;ee.Lexer=ze;ee.lexer=ze.lex;ee.Tokenizer=kt;ee.Hooks=pt;ee.parse=ee;ee.options;ee.setOptions;ee.use;ee.walkTokens;ee.parseInline;Ue.parse;ze.lex;const Ll={class:"overview-grid"},Bl={class:"overview-card summary-card"},Rl={class:"card-header"},zl={class:"card-title-with-selector"},Ul={class:"card-title-icon"},Ml={class:"card-header-actions"},El={class:"template-status"},Vl={class:"template-description"},ql={class:"card-content markdown-content"},Kl={key:0,class:"loading-text"},Ol=["innerHTML"],Dl={key:2,class:"placeholder-text"},Nl={class:"overview-card stats-card"},jl={class:"stats-grid"},Fl={class:"stat-item"},Ql={class:"stat-value"},Hl={class:"stat-item"},Jl={class:"stat-value"},Gl={class:"export-actions"},Zl=["disabled"],Wl=["disabled"],Xl={class:"overview-card recent-card"},Yl={class:"recent-pages"},ea={key:0,class:"placeholder-text"},ta=["onClick"],sa={class:"page-number"},na={key:0,class:"page-summary"},la=Me({__name:"OverviewPanel",setup(a){const t=Ne(),l=k("no_spoiler"),s=k(""),n=k(!1),o=k([]),r=k([]),h=[{value:"no_spoiler",label:"æ— å‰§é€ç®€ä»‹",icon:"ğŸ",description:"ä¸å«å‰§é€çš„ç®€çŸ­ä»‹ç»ï¼Œé€‚åˆæ¨èç»™ä»–äºº"},{value:"story_summary",label:"æ•…äº‹æ¦‚è¦",icon:"ğŸ“–",description:"å®Œæ•´çš„å‰§æƒ…å›é¡¾ï¼ŒåŒ…å«æ‰€æœ‰å‰§é€"},{value:"recap",label:"å‰æƒ…å›é¡¾",icon:"âª",description:"ä¹‹å‰å‘ç”Ÿçš„é‡è¦äº‹ä»¶å›é¡¾"},{value:"character_guide",label:"è§’è‰²å›¾é‰´",icon:"ğŸ‘¥",description:"ä¸»è¦è§’è‰²ä»‹ç»å’Œå…³ç³»"},{value:"world_setting",label:"ä¸–ç•Œè§‚è®¾å®š",icon:"ğŸŒ",description:"æ•…äº‹èƒŒæ™¯å’Œä¸–ç•Œè§‚è®¾å®š"},{value:"highlights",label:"ååœºé¢ç›˜ç‚¹",icon:"âœ¨",description:"ç²¾å½©ç‰‡æ®µå’Œç»å…¸åœºæ™¯å›é¡¾"},{value:"reading_notes",label:"é˜…è¯»ç¬”è®°",icon:"ğŸ“",description:"é˜…è¯»è¿‡ç¨‹ä¸­çš„é‡ç‚¹ç¬”è®°"}],m=h.map(v=>({label:`${v.icon} ${v.label}`,value:v.value})),y=U(()=>h.find(g=>g.value===l.value)?.icon||"ğŸ“Š"),C=U(()=>h.find(g=>g.value===l.value)?.description||""),z=U(()=>o.value.includes(l.value)?"å·²ç”Ÿæˆ":""),B=U(()=>s.value?ee.parse(s.value):"");async function M(){await R(!1)}async function R(v){if(t.currentBookId){n.value=!0,s.value="";try{let g;v?g=await an(t.currentBookId,l.value,!0):g=await bs(t.currentBookId,l.value),g.success&&(g.content?(s.value=g.content,o.value.includes(l.value)||o.value.push(l.value)):g.cached||(s.value=""))}catch(g){console.error("åŠ è½½æ¦‚è§ˆå¤±è´¥:",g),s.value="åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"}finally{n.value=!1}}}async function q(v){await R(v)}async function N(){if(t.currentBookId)try{const v=await ks(t.currentBookId);if(v.success){let g=[];v.generated?g=v.generated:v.templates&&Array.isArray(v.templates)&&(g=v.templates),o.value=g,g.length>0&&!g.includes(l.value)&&(l.value=g[0],console.log(`é»˜è®¤æ¨¡æ¿æœªç”Ÿæˆï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å·²ç”Ÿæˆçš„æ¨¡æ¿: ${g[0]}`))}}catch(v){console.error("åŠ è½½æ¨¡æ¿åˆ—è¡¨å¤±è´¥:",v)}}const j=k(!1);async function Q(){if(!t.currentBookId){alert("è¯·å…ˆé€‰æ‹©ä¹¦ç±");return}j.value=!0;try{const v=await _s(t.currentBookId);if(v.success&&v.markdown){const g=new Blob([v.markdown],{type:"text/markdown"}),x=URL.createObjectURL(g),A=document.createElement("a");A.href=x,A.download=`${t.currentBookId}_analysis.md`,A.click(),URL.revokeObjectURL(x),alert("å¯¼å‡ºæˆåŠŸ")}else alert("å¯¼å‡ºå¤±è´¥: "+(v.error||"æœªçŸ¥é”™è¯¯"))}catch(v){console.error("å¯¼å‡ºå¤±è´¥:",v),alert("å¯¼å‡ºå¤±è´¥")}finally{j.value=!1}}function F(){if(!s.value){alert("æš‚æ— å†…å®¹å¯å¯¼å‡º");return}const v=h.find(te=>te.value===l.value),g=`${t.currentBookId}_${l.value}.md`,x=`# ${v?.label||l.value}

${s.value}`,A=new Blob([x],{type:"text/markdown"}),V=URL.createObjectURL(A),K=document.createElement("a");K.href=V,K.download=g,K.click(),URL.revokeObjectURL(V)}async function u(){if(t.currentBookId)try{if((await gs(t.currentBookId)).success&&t.analyzedPageCount>0){const g=t.totalPageCount,x=t.analyzedPageCount,A=[],V=Math.max(1,x-4);for(let K=0;K<Math.min(5,x);K++){const te=V+K;te<=g&&A.push({page_num:te,summary:`ç¬¬ ${te} é¡µ`})}r.value=A.reverse()}}catch(v){console.error("åŠ è½½æœ€è¿‘åˆ†æé¡µé¢å¤±è´¥:",v)}}function P(v){t.selectPage(v)}return nt(async()=>{await N(),await u(),o.value.includes(l.value)&&await R(!1)}),st(()=>t.currentBookId,async v=>{v&&(s.value="",o.value=[],r.value=[],await N(),await u(),o.value.includes(l.value)&&await R(!1))}),(v,g)=>(c(),p("div",Ll,[e("div",Bl,[e("div",Rl,[e("div",zl,[e("span",Ul,_(y.value),1),pe(Ae,{modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=x=>l.value=x),options:$e(m),onChange:M},null,8,["modelValue","options"])]),e("div",Ml,[e("span",El,_(z.value),1),e("button",{class:"btn-icon",title:"ç”Ÿæˆ/åŠ è½½",onClick:g[1]||(g[1]=x=>q(!1))}," ğŸ“„ "),e("button",{class:"btn-icon",title:"é‡æ–°ç”Ÿæˆ",onClick:g[2]||(g[2]=x=>q(!0))}," ğŸ”„ ")])]),e("p",Vl,_(C.value),1),e("div",ql,[n.value?(c(),p("div",Kl,"åŠ è½½ä¸­...")):s.value?(c(),p("div",{key:1,innerHTML:B.value},null,8,Ol)):(c(),p("div",Dl,"é€‰æ‹©æ¨¡æ¿ç±»å‹ï¼Œç‚¹å‡»ç”ŸæˆæŒ‰é’®"))])]),e("div",Nl,[g[5]||(g[5]=e("h3",{class:"card-title"},"ğŸ“Š åˆ†æç»Ÿè®¡",-1)),e("div",jl,[e("div",Fl,[e("span",Ql,_($e(t).analyzedPageCount),1),g[3]||(g[3]=e("span",{class:"stat-label"},"å·²åˆ†æé¡µé¢",-1))]),e("div",Hl,[e("span",Jl,_($e(t).chapters.length),1),g[4]||(g[4]=e("span",{class:"stat-label"},"ç« èŠ‚æ•°",-1))])]),e("div",Gl,[e("button",{class:"btn btn-secondary btn-sm",disabled:j.value||!s.value,title:"å¯¼å‡ºå½“å‰æ¦‚è§ˆ",onClick:F}," ğŸ“„ å¯¼å‡ºå½“å‰ ",8,Zl),e("button",{class:"btn btn-primary btn-sm",disabled:j.value,title:"å¯¼å‡ºå®Œæ•´åˆ†ææ•°æ®",onClick:Q},_(j.value?"å¯¼å‡ºä¸­...":"ğŸ“¤ å¯¼å‡ºå…¨éƒ¨"),9,Wl)])]),e("div",Xl,[g[6]||(g[6]=e("h3",{class:"card-title"},"ğŸ• æœ€è¿‘åˆ†æ",-1)),e("div",Yl,[r.value.length===0?(c(),p("div",ea,"æš‚æ— åˆ†æè®°å½•")):T("",!0),(c(!0),p(W,null,oe(r.value,x=>(c(),p("div",{key:x.page_num,class:"recent-page-item",onClick:A=>P(x.page_num)},[e("span",sa,"ç¬¬ "+_(x.page_num)+" é¡µ",1),x.summary?(c(),p("span",na,_(x.summary),1)):T("",!0)],8,ta))),128))])])]))}}),aa=Oe(la,[["__scopeId","data-v-60a768ec"]]),oa={class:"timeline-tab"},ra={class:"timeline-header"},ia=["disabled"],ua={key:0,class:"btn-spinner"},ca={key:0,class:"error-message"},da={class:"timeline-container"},pa={key:0,class:"loading-state"},va={key:1,class:"timeline-empty-state"},ma=["disabled"],ga={class:"timeline-stats"},ha={key:0,class:"stat-badge"},fa={class:"stat-badge"},ba={key:1,class:"stat-badge"},ka={key:2,class:"stat-badge"},ya={class:"stat-badge"},_a={key:0,class:"timeline-summary-card"},$a={class:"one-sentence"},wa={key:0,class:"themes"},xa={key:1,class:"characters-section"},Ca={class:"characters-grid"},Sa=["onClick"],Pa={class:"character-name"},Ia={class:"character-desc"},Ta={class:"character-page"},Aa={key:2,class:"timeline-section"},La={key:3,class:"timeline-track"},Ba={class:"timeline-node"},Ra=["onClick"],za={class:"timeline-card"},Ua=["onClick"],Ma=["src","alt","onClick"],Ea={class:"timeline-card-title"},Va={class:"timeline-page-range"},qa={class:"timeline-event-count"},Ka={class:"expand-icon"},Oa={key:0,class:"timeline-summary"},Da={key:1,class:"timeline-mood"},Na={key:4,class:"timeline-track"},ja={class:"timeline-node"},Fa=["onClick"],Qa={class:"timeline-card"},Ha=["onClick"],Ja=["src","alt","onClick"],Ga={class:"timeline-card-title"},Za={class:"timeline-page-range"},Wa={class:"timeline-event-count"},Xa={class:"expand-icon"},Ya={key:0,class:"timeline-summary"},eo={key:1,class:"timeline-events-list"},to={key:5,class:"timeline-section"},so={class:"plot-threads-list"},no={class:"thread-header"},lo={class:"thread-name"},ao={key:0,class:"thread-desc"},oo={key:1,class:"thread-intro"},ro={key:6,class:"placeholder-text"},io=Me({__name:"TimelinePanel",setup(a){const t=Ne(),l=k(!1),s=k(!1),n=k(null);k("simple");const o=k(new Set),r=k(""),h=U(()=>{if(!n.value)return!1;const u=n.value.groups&&n.value.groups.length>0,P=n.value.plot_arcs&&n.value.plot_arcs.length>0;return u||P}),m=U(()=>n.value?.stats?.total_events||0),y=U(()=>n.value?.stats?.total_pages||0),C=U(()=>n.value?.mode==="enhanced"||!!n.value?.story_summary||!!n.value?.plot_arcs?.length),z=U(()=>n.value?.main_characters||[]),B=U(()=>n.value?.plot_arcs||[]),M=U(()=>n.value?.story_summary||"");async function R(){if(t.currentBookId){l.value=!0,r.value="";try{const u=await ys(t.currentBookId);console.log("Timeline API response:",u),u.success?(n.value={mode:u.mode||"simple",groups:u.groups||[],stats:u.stats,story_summary:u.summary?.one_sentence||"",main_characters:u.characters||[],plot_arcs:u.story_arcs||[],plot_threads:u.plot_threads||[],events:u.events||[],cached:u.cached},console.log("Parsed timelineData:",n.value)):r.value=u.error||"åŠ è½½æ—¶é—´çº¿å¤±è´¥"}catch(u){console.error("åŠ è½½æ—¶é—´çº¿å¤±è´¥:",u),r.value=u instanceof Error?u.message:"åŠ è½½å¤±è´¥"}finally{l.value=!1}}}async function q(){if(t.currentBookId){s.value=!0,r.value="";try{const u=await on(t.currentBookId);u.success?n.value=u:r.value="é‡æ–°ç”Ÿæˆå¤±è´¥"}catch(u){console.error("é‡æ–°ç”Ÿæˆæ—¶é—´çº¿å¤±è´¥:",u),r.value=u instanceof Error?u.message:"é‡æ–°ç”Ÿæˆå¤±è´¥"}finally{s.value=!1}}}function N(u){return t.currentBookId?fs(t.currentBookId,u):""}function j(u){t.selectPage(u)}function Q(u){o.value.has(u)?o.value.delete(u):o.value.add(u)}function F(u){return o.value.has(u)}return nt(()=>{t.currentBookId&&R()}),st(()=>t.currentBookId,u=>{u&&(n.value=null,R())}),(u,P)=>(c(),p("div",oa,[e("div",ra,[P[2]||(P[2]=e("h3",null,"ğŸ“ˆ å‰§æƒ…æ—¶é—´çº¿",-1)),e("button",{class:G(["btn btn-secondary btn-sm",{loading:s.value}]),disabled:l.value||s.value,onClick:q},[s.value?(c(),p("span",ua)):T("",!0),ie(" "+_(s.value?"ç”Ÿæˆä¸­...":"ğŸ”„ é‡æ–°ç”Ÿæˆ"),1)],10,ia)]),r.value?(c(),p("div",ca," âš ï¸ "+_(r.value),1)):T("",!0),e("div",da,[l.value?(c(),p("div",pa,[...P[3]||(P[3]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"åŠ è½½æ—¶é—´çº¿...",-1)])])):h.value?(c(),p(W,{key:2},[e("div",ga,[n.value?.stats?.total_arcs?(c(),p("span",ha,"ğŸ­ "+_(n.value.stats.total_arcs)+" ä¸ªå‰§æƒ…å¼§",1)):T("",!0),e("span",fa,"ğŸ“Š "+_(m.value)+" ä¸ªäº‹ä»¶",1),n.value?.stats?.total_characters?(c(),p("span",ba,"ğŸ‘¥ "+_(n.value.stats.total_characters)+" ä¸ªè§’è‰²",1)):T("",!0),n.value?.stats?.total_threads?(c(),p("span",ka,"ğŸ”— "+_(n.value.stats.total_threads)+" æ¡çº¿ç´¢",1)):T("",!0),e("span",ya,"ğŸ“„ "+_(y.value)+" é¡µ",1)]),M.value?(c(),p("div",_a,[P[8]||(P[8]=e("h4",null,"ğŸ“– æ•…äº‹æ¦‚è¦",-1)),e("p",$a,_(M.value),1),n.value?.plot_threads?.length?(c(),p("div",wa,[P[7]||(P[7]=e("span",null,"ä¸»é¢˜ï¼š",-1)),(c(!0),p(W,null,oe(n.value.plot_threads.slice(0,5),v=>(c(),p("span",{key:v.id,class:"theme-tag"},_(v.name),1))),128))])):T("",!0)])):T("",!0),z.value.length>0?(c(),p("div",xa,[P[9]||(P[9]=e("h4",null,"ğŸ‘¥ ä¸»è¦è§’è‰²",-1)),e("div",Ca,[(c(!0),p(W,null,oe(z.value,v=>(c(),p("div",{key:v.name,class:"character-card",onClick:g=>j(v.first_appearance)},[e("div",Pa,_(v.name),1),e("div",Ia,_(v.description),1),e("div",Ta,"é¦–æ¬¡å‡ºç°ï¼šç¬¬ "+_(v.first_appearance)+" é¡µ",1)],8,Sa))),128))])])):T("",!0),C.value&&B.value.length>0?(c(),p("div",Aa,[...P[10]||(P[10]=[e("h4",null,"ğŸ­ å‰§æƒ…å‘å±•",-1)])])):T("",!0),C.value&&B.value.length>0?(c(),p("div",La,[(c(!0),p(W,null,oe(B.value,(v,g)=>(c(),p("div",{key:v.id||v.name,class:G(["timeline-group",{expanded:F(v.id||`arc-${g}`)}])},[e("div",Ba,[e("div",{class:"timeline-node-dot",onClick:x=>Q(v.id||`arc-${g}`)},null,8,Ra),P[11]||(P[11]=e("div",{class:"timeline-node-line"},null,-1))]),e("div",za,[e("div",{class:"timeline-card-header",onClick:x=>Q(v.id||`arc-${g}`)},[e("img",{class:"timeline-thumbnail",src:N(v.page_range?.start||1),alt:`ç¬¬${v.page_range?.start||1}é¡µ`,loading:"lazy",onError:P[0]||(P[0]=x=>x.target.style.display="none"),onClick:Pe(x=>j(v.page_range?.start||1),["stop"])},null,40,Ma),e("div",Ea,[e("span",Va," ç¬¬ "+_(v.page_range?.start||v.start_page||"?")+"-"+_(v.page_range?.end||v.end_page||"?")+" é¡µ ",1),e("span",qa,_(v.name),1)]),e("span",Ka,_(F(v.id||`arc-${g}`)?"â–¼":"â–¶"),1)],8,Ua),v.description?(c(),p("div",Oa,_(v.description),1)):T("",!0),v.mood?(c(),p("div",Da,[P[12]||(P[12]=e("span",{class:"label"},"ğŸ¨ æ°›å›´ï¼š",-1)),ie(_(v.mood),1)])):T("",!0)])],2))),128))])):n.value?.groups&&n.value.groups.length>0?(c(),p("div",Na,[(c(!0),p(W,null,oe(n.value.groups,v=>(c(),p("div",{key:v.id,class:G(["timeline-group",{expanded:F(v.id)}])},[e("div",ja,[e("div",{class:"timeline-node-dot",onClick:g=>Q(v.id)},null,8,Fa),P[13]||(P[13]=e("div",{class:"timeline-node-line"},null,-1))]),e("div",Qa,[e("div",{class:"timeline-card-header",onClick:g=>Q(v.id)},[e("img",{class:"timeline-thumbnail",src:N(v.thumbnail_page||v.page_range.start),alt:`ç¬¬${v.page_range.start}é¡µ`,loading:"lazy",onError:P[1]||(P[1]=g=>g.target.style.display="none"),onClick:Pe(g=>j(v.page_range.start),["stop"])},null,40,Ja),e("div",Ga,[e("span",Za," ç¬¬ "+_(v.page_range.start)+"-"+_(v.page_range.end)+" é¡µ ",1),e("span",Wa,_(v.events.length)+" ä¸ªäº‹ä»¶",1)]),e("span",Xa,_(F(v.id)?"â–¼":"â–¶"),1)],8,Ha),v.summary?(c(),p("div",Ya,_(v.summary),1)):T("",!0),F(v.id)&&v.events.length>0?(c(),p("ul",eo,[(c(!0),p(W,null,oe(v.events,(g,x)=>(c(),p("li",{key:x,class:"timeline-event-item"},_(g),1))),128))])):T("",!0)])],2))),128))])):T("",!0),n.value?.plot_threads&&n.value.plot_threads.length>0?(c(),p("div",to,[P[14]||(P[14]=e("h4",null,"ğŸ”— ä¼ç¬”ä¸çº¿ç´¢",-1)),e("div",so,[(c(!0),p(W,null,oe(n.value.plot_threads,v=>(c(),p("div",{key:v.id,class:G(["plot-thread-item",{resolved:v.status==="å·²è§£å†³"}])},[e("div",no,[e("span",lo,_(v.name||"æœªå‘½åçº¿ç´¢"),1),e("span",{class:G(["thread-status",{resolved:v.status==="å·²è§£å†³"}])},_(v.status||"è¿›è¡Œä¸­"),3)]),v.description?(c(),p("p",ao,_(v.description),1)):T("",!0),v.introduced_at?(c(),p("span",oo,"ç¬¬ "+_(v.introduced_at)+" é¡µå¼•å…¥",1)):T("",!0)],2))),128))])])):T("",!0),h.value?T("",!0):(c(),p("div",ro,' æš‚æ— è¯¦ç»†æ—¶é—´çº¿æ•°æ®ï¼Œç‚¹å‡»"é‡æ–°ç”Ÿæˆ"æŒ‰é’®ç”Ÿæˆ '))],64)):(c(),p("div",va,[P[4]||(P[4]=e("div",{class:"empty-icon"},"ğŸ“ˆ",-1)),P[5]||(P[5]=e("h4",null,"æ—¶é—´çº¿å°šæœªç”Ÿæˆ",-1)),P[6]||(P[6]=e("p",null,"å®Œæˆæ¼«ç”»åˆ†æåä¼šè‡ªåŠ¨ç”Ÿæˆæ—¶é—´çº¿ï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰‹åŠ¨ç”Ÿæˆ",-1)),e("button",{class:"btn btn-primary btn-sm",disabled:s.value,onClick:q},_(s.value?"ç”Ÿæˆä¸­...":"ç”Ÿæˆæ—¶é—´çº¿"),9,ma)]))])]))}}),uo=Oe(io,[["__scopeId","data-v-9fed9f04"]]),co={class:"qa-container"},po={key:0,class:"welcome-message"},vo={class:"message-avatar"},mo={key:0,src:Js,alt:"ç”¨æˆ·",class:"avatar-img"},go={key:0,class:"message-content"},ho={key:1,class:"message-content markdown-content"},fo={key:0,class:"loading-dots"},bo={key:0,class:"answer-mode-badge"},ko=["innerHTML"],yo={key:1,class:"message-citations"},_o=["onClick"],$o=["disabled","onClick"],wo={class:"chat-input-container"},xo={class:"chat-options"},Co={class:"qa-mode-toggle",title:"ç²¾ç¡®æ¨¡å¼ï¼šä½¿ç”¨RAGæ£€ç´¢ç›¸å…³ç‰‡æ®µï¼›å…¨å±€æ¨¡å¼ï¼šä½¿ç”¨å…¨æ–‡æ‘˜è¦"},So={key:0,class:"precise-mode-options"},Po={class:"checkbox-label compact",title:"å¯ç”¨çˆ¶å­å—æ¨¡å¼"},Io={class:"checkbox-label compact",title:"å¯ç”¨æ¨ç†æ£€ç´¢"},To={class:"checkbox-label compact",title:"å¯ç”¨é‡æ’åº"},Ao={class:"input-label compact",title:"è¿”å›çš„æœ€å¤§ç»“æœæ•°"},Lo={class:"input-label compact",title:"ç›¸å…³æ€§é˜ˆå€¼"},Bo={key:1,class:"global-mode-hint"},Ro={class:"welcome-examples"},zo=["onClick"],Uo={class:"chat-input-wrapper"},Mo=["disabled"],Eo=["disabled"],Vo={key:0,class:"modal note-modal show"},qo={class:"modal-content note-modal-content"},Ko={class:"modal-body"},Oo={key:0,class:"qa-preview"},Do={class:"qa-preview-section"},No={class:"qa-preview-content"},jo={class:"qa-preview-section"},Fo=["innerHTML"],Qo={key:0,class:"qa-preview-section"},Ho={class:"qa-preview-citations"},Jo={class:"note-form"},Go={class:"form-group"},Zo={class:"form-group"},Wo=Me({__name:"QAPanel",setup(a){const t=Ne(),l=k(""),s=k("precise"),n=k(!0),o=k(!0),r=k(!0),h=k(5),m=k(0),y=k(null),C=U(()=>t.qaHistory),z=U(()=>t.isStreaming),B=U(()=>s.value==="precise");function M(E){s.value=E}async function R(){const E=l.value.trim();if(!E||!t.currentBookId||z.value)return;l.value="",t.clearQAHistory(),t.addQAMessage({id:Date.now().toString(),role:"user",content:E,timestamp:new Date().toISOString()}),await as(),N();const $=s.value==="global"?"æ­£åœ¨åˆ†æå…¨æ–‡...":"æ€è€ƒä¸­...";t.addQAMessage({id:(Date.now()+1).toString(),role:"assistant",content:$,timestamp:new Date().toISOString(),isLoading:!0}),t.setStreaming(!0);try{const S=await rn(t.currentBookId,E,{use_parent_child:n.value,use_reasoning:o.value,use_reranker:r.value,top_k:h.value,threshold:m.value,use_global_context:s.value==="global"});if(t.removeLoadingMessages(),S.success){const I=S.mode==="global"?"ğŸŒ å…¨å±€æ¨¡å¼":"ğŸ¯ ç²¾ç¡®æ¨¡å¼";t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:S.answer||"",timestamp:new Date().toISOString(),mode:I,citations:S.citations||[]})}else t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:"æŠ±æ­‰ï¼Œå¤„ç†é—®é¢˜æ—¶å‡ºé”™: "+(S.error||"æœªçŸ¥é”™è¯¯"),timestamp:new Date().toISOString()})}catch(S){console.error("é—®ç­”è¯·æ±‚å¤±è´¥:",S),t.removeLoadingMessages(),t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:"æŠ±æ­‰ï¼Œç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚",timestamp:new Date().toISOString()})}finally{t.setStreaming(!1),await as(),N()}}function q(E){E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),R())}function N(){y.value&&(y.value.scrollTop=y.value.scrollHeight)}async function j(){if(t.currentBookId&&confirm(`ç¡®å®šè¦é‡å»ºå‘é‡ç´¢å¼•å—ï¼Ÿ

è¿™å°†åˆ é™¤ç°æœ‰çš„å‘é‡æ•°æ®å¹¶é‡æ–°æ„å»ºï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚`)){t.setLoading(!0);try{const E=await un(t.currentBookId);if(E.success){let $="å‘é‡ç´¢å¼•é‡å»ºå®Œæˆ";E.stats&&($+=`
é¡µé¢å‘é‡: ${E.stats.pages_count||0} æ¡`,E.stats.dialogues_count&&($+=`
å¯¹è¯å‘é‡: ${E.stats.dialogues_count} æ¡`)),alert($)}else alert("é‡å»ºå¤±è´¥: "+(E.error||"æœªçŸ¥é”™è¯¯"))}catch(E){console.error("é‡å»ºå‘é‡ç´¢å¼•å¤±è´¥:",E),alert("é‡å»ºå‘é‡ç´¢å¼•å¤±è´¥")}finally{t.setLoading(!1)}}}function Q(E){return E?ee.parse(E):""}function F(E){t.setCurrentPage(E)}const u=["æ•…äº‹çš„ä¸»é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ","ä¸»è§’çš„æ€§æ ¼æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ","ç»“å±€æ˜¯æ€æ ·çš„ï¼Ÿ"];function P(E){l.value=E,R()}const v=k(!1),g=k(null),x=k(""),A=k("");function V(E){if(!t.currentBookId)return;const S=t.qaHistory.find(I=>I.role==="user")?.content||"";g.value={messageId:E.id,question:S,answer:E.content,citations:E.citations||[]},x.value="",A.value="",v.value=!0}function K(){v.value=!1,g.value=null}async function te(){if(!t.currentBookId||!g.value)return;const E=new Date().toISOString(),$={id:Date.now().toString(),type:"qa",title:x.value||g.value.question.substring(0,30),content:g.value.answer,question:g.value.question,answer:g.value.answer,citations:g.value.citations,comment:A.value||void 0,createdAt:E,updatedAt:E};try{await t.addNote($);const S=t.qaHistory.find(I=>I.id===g.value?.messageId);S&&(S.saved=!0),K()}catch(S){console.error("ä¿å­˜ç¬”è®°å¤±è´¥:",S),alert("ä¿å­˜ç¬”è®°å¤±è´¥")}}return nt(()=>{N()}),(E,$)=>(c(),p("div",co,[e("div",{ref_key:"messagesContainer",ref:y,class:"chat-messages"},[C.value.length===0?(c(),p("div",po,[...$[10]||($[10]=[e("div",{class:"welcome-icon"},"ğŸ’¬",-1),e("h3",null,"æ™ºèƒ½é—®ç­”",-1),e("p",null,"é’ˆå¯¹å·²åˆ†æçš„æ¼«ç”»å†…å®¹æé—®ï¼Œè·å–ç²¾å‡†å›ç­”",-1)])])):T("",!0),(c(!0),p(W,null,oe(C.value,S=>(c(),p("div",{key:S.id,class:G(["chat-message",S.role])},[e("div",vo,[S.role==="user"?(c(),p("img",mo)):(c(),p(W,{key:1},[ie(" ğŸ¤– ")],64))]),S.role==="user"?(c(),p("div",go,_(S.content),1)):(c(),p("div",ho,[S.isLoading?(c(),p("div",fo,_(S.content),1)):(c(),p(W,{key:1},[S.mode?(c(),p("div",bo,_(S.mode),1)):T("",!0),e("div",{class:"answer-text",innerHTML:Q(S.content)},null,8,ko),S.citations&&S.citations.length>0?(c(),p("div",yo,[$[11]||($[11]=e("span",null,"ğŸ“– å¼•ç”¨: ",-1)),(c(!0),p(W,null,oe(S.citations,I=>(c(),p("span",{key:I.page,class:"citation-item",onClick:L=>F(I.page)}," ç¬¬"+_(I.page)+"é¡µ ",9,_o))),128))])):T("",!0),S.content&&!S.isLoading?(c(),p("button",{key:2,class:G(["message-save-btn",{saved:S.saved}]),disabled:S.saved,onClick:I=>V(S)},_(S.saved?"âœ… å·²ä¿å­˜":"ğŸ“ ä¿å­˜ä¸ºç¬”è®°"),11,$o)):T("",!0)],64))]))],2))),128))],512),e("div",wo,[e("div",xo,[e("div",Co,[e("button",{type:"button",class:G(["qa-mode-btn",{active:s.value==="precise"}]),onClick:$[0]||($[0]=S=>M("precise"))}," ğŸ¯ ç²¾ç¡®æ¨¡å¼ ",2),e("button",{type:"button",class:G(["qa-mode-btn",{active:s.value==="global"}]),onClick:$[1]||($[1]=S=>M("global"))}," ğŸŒ å…¨å±€æ¨¡å¼ ",2)]),$[20]||($[20]=e("span",{class:"chat-option-divider"},"|",-1)),B.value?(c(),p("div",So,[e("label",Po,[O(e("input",{"onUpdate:modelValue":$[2]||($[2]=S=>n.value=S),type:"checkbox"},null,512),[[tt,n.value]]),$[12]||($[12]=e("span",null,"çˆ¶å­å—æ¨¡å¼",-1))]),e("label",Io,[O(e("input",{"onUpdate:modelValue":$[3]||($[3]=S=>o.value=S),type:"checkbox"},null,512),[[tt,o.value]]),$[13]||($[13]=e("span",null,"æ¨ç†æ£€ç´¢",-1))]),e("label",To,[O(e("input",{"onUpdate:modelValue":$[4]||($[4]=S=>r.value=S),type:"checkbox"},null,512),[[tt,r.value]]),$[14]||($[14]=e("span",null,"é‡æ’åº",-1))]),$[17]||($[17]=e("span",{class:"chat-option-divider"},"|",-1)),e("label",Ao,[$[15]||($[15]=e("span",null,"Top K:",-1)),O(e("input",{"onUpdate:modelValue":$[5]||($[5]=S=>h.value=S),type:"number",min:"1",max:"20",class:"input-small"},null,512),[[Y,h.value,void 0,{number:!0}]])]),e("label",Lo,[$[16]||($[16]=e("span",null,"é˜ˆå€¼:",-1)),O(e("input",{"onUpdate:modelValue":$[6]||($[6]=S=>m.value=S),type:"number",min:"0",max:"1",step:"0.1",class:"input-small"},null,512),[[Y,m.value,void 0,{number:!0}]])]),$[18]||($[18]=e("span",{class:"chat-option-divider"},"|",-1)),e("button",{type:"button",class:"btn btn-sm btn-secondary",title:"é‡å»ºå‘é‡ç´¢å¼•",onClick:j}," ğŸ”„ é‡å»ºå‘é‡ ")])):(c(),p("div",Bo,[$[19]||($[19]=e("span",{class:"hint-text"},"ğŸ’¡ å…¨å±€æ¨¡å¼ä½¿ç”¨å…¨æ–‡æ‘˜è¦å›ç­”ï¼Œé€‚åˆæ€»ç»“æ€§é—®é¢˜",-1)),e("div",Ro,[(c(),p(W,null,oe(u,(S,I)=>e("span",{key:I,class:"example-tag",onClick:L=>P(S)},_(S),9,zo)),64))])]))]),e("div",Uo,[O(e("textarea",{"onUpdate:modelValue":$[7]||($[7]=S=>l.value=S),placeholder:"è¾“å…¥ä½ çš„é—®é¢˜...",rows:"1",disabled:z.value,onKeydown:q},null,40,Mo),[[Y,l.value]]),e("button",{class:"send-btn",disabled:z.value||!l.value.trim(),onClick:R},[...$[21]||($[21]=[e("span",null,"å‘é€",-1)])],8,Eo)])]),v.value?(c(),p("div",Vo,[e("div",{class:"modal-overlay",onClick:K}),e("div",qo,[e("div",{class:"modal-header"},[$[22]||($[22]=e("h2",null,"ğŸ“ æ·»åŠ ç¬”è®°",-1)),e("button",{class:"modal-close",onClick:K},"Ã—")]),e("div",Ko,[g.value?(c(),p("div",Oo,[e("div",Do,[$[23]||($[23]=e("label",null,"é—®é¢˜",-1)),e("div",No,_(g.value.question),1)]),e("div",jo,[$[24]||($[24]=e("label",null,"å›ç­”",-1)),e("div",{class:"qa-preview-content",innerHTML:Q(g.value.answer)},null,8,Fo)]),g.value.citations.length>0?(c(),p("div",Qo,[$[25]||($[25]=e("label",null,"å¼•ç”¨é¡µç ",-1)),e("div",Ho,[(c(!0),p(W,null,oe(g.value.citations,S=>(c(),p("span",{key:S.page,class:"qa-citation-badge"}," ç¬¬"+_(S.page)+"é¡µ ",1))),128))])])):T("",!0)])):T("",!0),e("div",Jo,[e("div",Go,[$[26]||($[26]=e("label",{for:"qaNoteTitle"},[ie("ç¬”è®°æ ‡é¢˜ "),e("span",{class:"optional"},"(å¯é€‰)")],-1)),O(e("input",{"onUpdate:modelValue":$[8]||($[8]=S=>x.value=S),type:"text",id:"qaNoteTitle",class:"form-input",placeholder:"é»˜è®¤ä½¿ç”¨é—®é¢˜ä½œä¸ºæ ‡é¢˜..."},null,512),[[Y,x.value]])]),e("div",Zo,[$[27]||($[27]=e("label",{for:"qaNoteComment"},[ie("è¡¥å……è¯´æ˜ "),e("span",{class:"optional"},"(å¯é€‰)")],-1)),O(e("textarea",{"onUpdate:modelValue":$[9]||($[9]=S=>A.value=S),id:"qaNoteComment",class:"form-textarea",rows:"3",placeholder:"æ·»åŠ ä½ çš„è¯„è®ºæˆ–è¡¥å……..."},null,512),[[Y,A.value]])])])]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-secondary",onClick:K},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:te},"ä¿å­˜ç¬”è®°")])])])):T("",!0)]))}}),Xo=Oe(Wo,[["__scopeId","data-v-0019a5fe"]]),Yo={class:"workspace-section notes-section"},er={class:"section-header-with-actions"},tr={class:"notes-filter"},sr={class:"notes-list"},nr={key:0,class:"placeholder-text"},lr=["onClick"],ar={class:"note-header"},or={class:"note-type-icon"},rr={class:"note-date"},ir={class:"note-actions"},ur=["onClick"],cr=["onClick"],dr={key:0,class:"note-title"},pr={key:1,class:"note-content"},vr={class:"qa-preview-text"},mr={key:2,class:"note-content"},gr={key:3,class:"note-tags"},hr={key:4,class:"note-citations"},fr=["onClick"],br={key:0,class:"citation-badge"},kr={key:5,class:"note-page-link"},yr=["onClick"],_r={class:"modal-content modal-sm"},$r={class:"modal-header"},wr={class:"modal-body"},xr={class:"qa-note-view"},Cr={class:"qa-section"},Sr={class:"qa-content"},Pr={class:"qa-section"},Ir={class:"qa-content qa-answer"},Tr={key:0,class:"qa-section"},Ar={class:"qa-citations"},Lr=["onClick"],Br={key:1,class:"qa-section"},Rr={class:"qa-content"},zr={class:"form-group"},Ur={class:"form-group"},Mr={class:"form-group"},Er={class:"form-group"},Vr={class:"form-group"},qr={class:"form-group"},Kr={class:"modal-footer"},Or=["disabled"],Dr=Me({__name:"NotesPanel",setup(a){const t=[{label:"å…¨éƒ¨",value:"all"},{label:"æ–‡æœ¬ç¬”è®°",value:"text"},{label:"é—®ç­”ç¬”è®°",value:"qa"}],l=[{label:"æ–‡æœ¬ç¬”è®°",value:"text"},{label:"é—®ç­”ç¬”è®°",value:"qa"}],s=Ne(),n=k(!1),o=k(null),r=k(""),h=k(""),m=k("text"),y=k(null),C=k(""),z=U(()=>s.filteredNotes),B=U({get:()=>s.noteTypeFilter,set:v=>s.setNoteTypeFilter(v)});function M(){o.value=null,r.value="",h.value="",m.value="text",y.value=s.selectedPageNum,C.value="",n.value=!0}function R(v){o.value=v,r.value=v.title||"",h.value=v.content,m.value=v.type,y.value=v.pageNum||null,C.value=(v.tags||[]).join(", "),n.value=!0}function q(){n.value=!1,o.value=null,r.value="",h.value="",C.value=""}function N(v){return v.trim()?v.split(/[,ï¼Œ]/).map(g=>g.trim()).filter(g=>g):[]}async function j(){if(!h.value.trim())return;const v=N(C.value);if(o.value)await s.updateNote(o.value.id,{title:r.value||void 0,content:h.value,type:m.value,pageNum:y.value||void 0,tags:v.length>0?v:void 0});else{const g={id:Date.now().toString(),type:m.value,title:r.value||void 0,content:h.value,pageNum:y.value||void 0,tags:v.length>0?v:void 0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await s.addNote(g)}q()}async function Q(v){confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¬”è®°å—ï¼Ÿ")&&await s.deleteNote(v)}function F(v){s.selectPage(v)}function u(v){return new Date(v).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function P(v){return v==="qa"?"ğŸ’¬":"ğŸ“"}return(v,g)=>(c(),p("div",Yo,[e("div",er,[g[7]||(g[7]=e("h3",{class:"section-title"},"ğŸ“ ç¬”è®°",-1)),e("div",tr,[pe(Ae,{modelValue:B.value,"onUpdate:modelValue":g[0]||(g[0]=x=>B.value=x),options:t},null,8,["modelValue"])])]),e("div",sr,[z.value.length===0?(c(),p("div",nr," æš‚æ— ç¬”è®° ")):T("",!0),(c(!0),p(W,null,oe(z.value,x=>(c(),p("div",{key:x.id,class:G(["note-item",{"qa-note":x.type==="qa"}]),onClick:A=>R(x)},[e("div",ar,[e("span",or,_(P(x.type)),1),e("span",rr,_(u(x.createdAt)),1),e("div",ir,[e("button",{class:"btn-icon-sm",title:"ç¼–è¾‘",onClick:Pe(A=>R(x),["stop"])}," âœï¸ ",8,ur),e("button",{class:"btn-icon-sm",title:"åˆ é™¤",onClick:Pe(A=>Q(x.id),["stop"])}," ğŸ—‘ï¸ ",8,cr)])]),x.title?(c(),p("div",dr,_(x.title),1)):T("",!0),x.type==="qa"?(c(),p("div",pr,[e("div",vr,"Q: "+_(x.question?.substring(0,60))+"...",1)])):(c(),p("div",mr,_(x.content),1)),x.tags&&x.tags.length>0?(c(),p("div",gr,[(c(!0),p(W,null,oe(x.tags,A=>(c(),p("span",{key:A,class:"note-tag"},_(A),1))),128))])):T("",!0),x.type==="qa"&&x.citations&&x.citations.length>0?(c(),p("div",hr,[(c(!0),p(W,null,oe(x.citations.slice(0,3),A=>(c(),p("span",{key:A.page,class:"citation-badge",onClick:Pe(V=>F(A.page),["stop"])}," ç¬¬"+_(A.page)+"é¡µ ",9,fr))),128)),x.citations.length>3?(c(),p("span",br,"+"+_(x.citations.length-3),1)):T("",!0)])):T("",!0),x.pageNum?(c(),p("div",kr,[e("button",{class:"btn-link",onClick:Pe(A=>F(x.pageNum),["stop"])}," ğŸ“„ ç¬¬ "+_(x.pageNum)+" é¡µ ",9,yr)])):T("",!0)],10,lr))),128))]),e("button",{class:"btn btn-secondary btn-block btn-sm",onClick:M}," + æ·»åŠ ç¬”è®° "),n.value?(c(),p("div",{key:0,class:"modal show",onClick:Pe(q,["self"])},[e("div",_r,[e("div",$r,[e("h3",null,_(o.value?"ç¼–è¾‘ç¬”è®°":"æ·»åŠ ç¬”è®°"),1),e("button",{class:"modal-close",onClick:q},"Ã—")]),e("div",wr,[o.value&&o.value.type==="qa"?(c(),p(W,{key:0},[e("div",xr,[e("div",Cr,[g[8]||(g[8]=e("label",{class:"qa-label"},"é—®é¢˜",-1)),e("div",Sr,_(o.value.question),1)]),e("div",Pr,[g[9]||(g[9]=e("label",{class:"qa-label"},"å›ç­”",-1)),e("div",Ir,_(o.value.answer),1)]),o.value.citations&&o.value.citations.length>0?(c(),p("div",Tr,[g[10]||(g[10]=e("label",{class:"qa-label"},"å¼•ç”¨é¡µç ",-1)),e("div",Ar,[(c(!0),p(W,null,oe(o.value.citations,x=>(c(),p("span",{key:x.page,class:"qa-citation-badge",onClick:A=>F(x.page)}," ç¬¬"+_(x.page)+"é¡µ ",9,Lr))),128))])])):T("",!0),o.value.comment?(c(),p("div",Br,[g[11]||(g[11]=e("label",{class:"qa-label"},"è¡¥å……è¯´æ˜",-1)),e("div",Rr,_(o.value.comment),1)])):T("",!0)]),e("div",zr,[g[12]||(g[12]=e("label",null,[ie("ç¬”è®°æ ‡é¢˜ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),O(e("input",{"onUpdate:modelValue":g[1]||(g[1]=x=>r.value=x),type:"text",class:"form-input",placeholder:"ä¿®æ”¹æ ‡é¢˜..."},null,512),[[Y,r.value]])])],64)):(c(),p(W,{key:1},[e("div",Ur,[g[13]||(g[13]=e("label",null,"ç¬”è®°ç±»å‹",-1)),pe(Ae,{modelValue:m.value,"onUpdate:modelValue":g[2]||(g[2]=x=>m.value=x),options:l},null,8,["modelValue"])]),e("div",Mr,[g[14]||(g[14]=e("label",null,[ie("æ ‡é¢˜ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),O(e("input",{"onUpdate:modelValue":g[3]||(g[3]=x=>r.value=x),type:"text",class:"form-input",placeholder:"ç»™ç¬”è®°èµ·ä¸ªæ ‡é¢˜..."},null,512),[[Y,r.value]])]),e("div",Er,[g[15]||(g[15]=e("label",null,[ie("å†…å®¹ "),e("span",{class:"label-required"},"*")],-1)),O(e("textarea",{"onUpdate:modelValue":g[4]||(g[4]=x=>h.value=x),class:"form-textarea",rows:"5",placeholder:"å†™ä¸‹ä½ çš„æƒ³æ³•..."},null,512),[[Y,h.value]])]),e("div",Vr,[g[16]||(g[16]=e("label",null,[ie("å…³è”é¡µç  "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),O(e("input",{"onUpdate:modelValue":g[5]||(g[5]=x=>y.value=x),type:"number",class:"form-input",placeholder:"è¾“å…¥é¡µç ",min:"1"},null,512),[[Y,y.value,void 0,{number:!0}]])]),e("div",qr,[g[17]||(g[17]=e("label",null,[ie("æ ‡ç­¾ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),O(e("input",{"onUpdate:modelValue":g[6]||(g[6]=x=>C.value=x),type:"text",class:"form-input",placeholder:"å¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”ï¼Œå¦‚: è§’è‰²,å‰§æƒ…"},null,512),[[Y,C.value]])])],64))]),e("div",Kr,[e("button",{class:"btn btn-secondary",onClick:q},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:o.value?.type!=="qa"&&!h.value.trim(),onClick:j}," ä¿å­˜ ",8,Or)])])])):T("",!0)]))}}),Nr=Oe(Dr,[["__scopeId","data-v-45521d3c"]]),jr={class:"workspace-section page-detail-section"},Fr={class:"page-detail"},Qr={key:0,class:"placeholder-text"},Hr={key:1,class:"loading-state"},Jr={key:2,class:"page-detail-content"},Gr={class:"page-detail-header"},Zr={class:"page-nav-buttons"},Wr=["disabled"],Xr={class:"page-indicator"},Yr=["disabled"],ei={key:0,class:"error-message"},ti=["src","alt"],si={key:1,class:"page-summary"},ni={key:2,class:"page-summary empty"},li={key:3,class:"scene-mood-info"},ai={key:0,class:"info-item"},oi={class:"info-value"},ri={key:1,class:"info-item"},ii={class:"info-value"},ui={key:4,class:"dialogues-section"},ci={class:"dialogue-speaker"},di={class:"dialogue-text"},pi={key:0,class:"dialogue-original"},vi={key:5,class:"dialogues-section empty"},mi={class:"page-detail-actions"},gi=["disabled"],hi={key:0,class:"btn-spinner"},fi=["disabled"],bi=["src","alt"],ki={class:"preview-nav"},yi=["disabled"],_i={class:"preview-page-info"},$i=["disabled"],wi=Me({__name:"PageDetail",setup(a){const t=Ne(),l=k(null),s=k(!1),n=k(!1),o=k(!1),r=k(""),h=U(()=>t.selectedPageNum),m=U(()=>t.totalPageCount),y=U(()=>h.value!==null&&h.value>1),C=U(()=>h.value!==null&&h.value<m.value),z=U(()=>!t.currentBookId||!h.value?"":nn(t.currentBookId,h.value)),B=U(()=>{if(!l.value?.panels)return[];const A=[];for(const V of l.value.panels)if(V.dialogues)for(const K of V.dialogues){const te=K.translated_text||K.text;te&&A.push({speaker:K.speaker_name||K.character||"æœªçŸ¥",text:te,originalText:K.text!==K.translated_text?K.text:void 0})}return A}),M=U(()=>l.value?.analyzed===!0||!!l.value?.page_summary),R=U(()=>l.value?.scene||""),q=U(()=>l.value?.mood||"");async function N(){if(!t.currentBookId||!h.value){l.value=null;return}s.value=!0,r.value="";try{const A=await sn(t.currentBookId,h.value);A.success?A.analysis?l.value=A.analysis:A.page?l.value=A.page:l.value=null:(l.value=null,A.error&&(r.value=A.error))}catch(A){console.error("åŠ è½½é¡µé¢è¯¦æƒ…å¤±è´¥:",A),l.value=null,r.value=A instanceof Error?A.message:"åŠ è½½å¤±è´¥"}finally{s.value=!1}}function j(){y.value&&h.value&&t.selectPage(h.value-1)}function Q(){C.value&&h.value&&t.selectPage(h.value+1)}async function F(){if(!(!t.currentBookId||!h.value)){n.value=!0,r.value="";try{const A=await hs(t.currentBookId,h.value);A.success?await N():r.value=A.error||"é‡æ–°åˆ†æå¤±è´¥"}catch(A){console.error("é‡æ–°åˆ†æå¤±è´¥:",A),r.value=A instanceof Error?A.message:"é‡æ–°åˆ†æå¤±è´¥"}finally{n.value=!1}}}function u(){o.value=!0}function P(){o.value=!1}function v(A){if(o.value)switch(A.key){case"Escape":P();break;case"ArrowLeft":y.value&&j();break;case"ArrowRight":C.value&&Q();break}}const g=k(!1);async function x(){if(!(!t.currentBookId||!h.value||!l.value)){g.value=!0;try{let A=`# ç¬¬ ${h.value} é¡µåˆ†ææ•°æ®

`;if(l.value.page_summary&&(A+=`## ğŸ“ é¡µé¢æ‘˜è¦

${l.value.page_summary}

`),l.value.scene&&(A+=`## ğŸ¬ åœºæ™¯

${l.value.scene}

`),l.value.mood&&(A+=`## ğŸ­ æ°›å›´

${l.value.mood}

`),B.value.length>0){A+=`## ğŸ’¬ å¯¹è¯å†…å®¹

`;for(const E of B.value)A+=`**${E.speaker}**: ${E.text}

`,E.originalText&&(A+=`> åŸæ–‡: ${E.originalText}

`)}const V=new Blob([A],{type:"text/markdown"}),K=URL.createObjectURL(V),te=document.createElement("a");te.href=K,te.download=`${t.currentBookId}_page_${h.value}.md`,te.click(),URL.revokeObjectURL(K)}catch(A){console.error("å¯¼å‡ºé¡µé¢æ•°æ®å¤±è´¥:",A),r.value="å¯¼å‡ºå¤±è´¥"}finally{g.value=!1}}}return st(h,()=>{N()},{immediate:!0}),(A,V)=>(c(),p("div",jr,[V[12]||(V[12]=e("h3",{class:"section-title"},"ğŸ“„ é¡µé¢è¯¦æƒ…",-1)),e("div",Fr,[h.value?s.value?(c(),p("div",Hr,[...V[3]||(V[3]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"åŠ è½½ä¸­...",-1)])])):(c(),p("div",Jr,[e("div",Gr,[e("h4",null,"ğŸ“„ ç¬¬ "+_(h.value)+" é¡µ",1),e("div",Zr,[e("button",{class:G(["btn-page-nav",{disabled:!y.value}]),disabled:!y.value,title:"ä¸Šä¸€é¡µ (â†)",onClick:j}," â—€ ä¸Šä¸€å¼  ",10,Wr),e("span",Xr,_(h.value)+" / "+_(m.value),1),e("button",{class:G(["btn-page-nav",{disabled:!C.value}]),disabled:!C.value,title:"ä¸‹ä¸€é¡µ (â†’)",onClick:Q}," ä¸‹ä¸€å¼  â–¶ ",10,Yr)])]),r.value?(c(),p("div",ei," âš ï¸ "+_(r.value),1)):T("",!0),e("div",{class:"page-detail-image",onClick:u},[e("img",{src:z.value,alt:`ç¬¬${h.value}é¡µ`,onError:V[0]||(V[0]=K=>K.target.style.display="none")},null,40,ti),V[4]||(V[4]=e("div",{class:"image-overlay"},[e("span",{class:"zoom-hint"},"ğŸ” ç‚¹å‡»æ”¾å¤§")],-1))]),e("div",{class:G(["analysis-status-tag",{analyzed:M.value}])},_(M.value?"âœ“ å·²åˆ†æ":"â—‹ æœªåˆ†æ"),3),l.value?.page_summary?(c(),p("div",si,[V[5]||(V[5]=e("h5",null,"ğŸ“ é¡µé¢æ‘˜è¦",-1)),e("p",null,_(l.value.page_summary),1)])):(c(),p("div",ni,[...V[6]||(V[6]=[e("p",null,"æ­¤é¡µå°šæœªåˆ†æï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹åˆ†æ",-1)])])),R.value||q.value?(c(),p("div",li,[R.value?(c(),p("div",ai,[V[7]||(V[7]=e("span",{class:"info-label"},"ğŸ¬ åœºæ™¯ï¼š",-1)),e("span",oi,_(R.value),1)])):T("",!0),q.value?(c(),p("div",ri,[V[8]||(V[8]=e("span",{class:"info-label"},"ğŸ­ æ°›å›´ï¼š",-1)),e("span",ii,_(q.value),1)])):T("",!0)])):T("",!0),B.value.length>0?(c(),p("div",ui,[e("h5",null,"ğŸ’¬ å¯¹è¯å†…å®¹ ("+_(B.value.length)+")",1),(c(!0),p(W,null,oe(B.value,(K,te)=>(c(),p("div",{key:te,class:"dialogue-item"},[e("div",ci,[V[9]||(V[9]=e("span",{class:"speaker-icon"},"ğŸ‘¤",-1)),ie(" "+_(K.speaker),1)]),e("div",di,_(K.text),1),K.originalText?(c(),p("div",pi,[V[10]||(V[10]=e("span",{class:"original-label"},"åŸæ–‡ï¼š",-1)),ie(_(K.originalText),1)])):T("",!0)]))),128))])):M.value?(c(),p("div",vi,[...V[11]||(V[11]=[e("p",null,"æ­¤é¡µæ²¡æœ‰æ£€æµ‹åˆ°å¯¹è¯å†…å®¹",-1)])])):T("",!0),e("div",mi,[e("button",{class:G(["btn btn-secondary btn-sm",{loading:n.value}]),disabled:n.value,onClick:F},[n.value?(c(),p("span",hi)):T("",!0),ie(" "+_(n.value?"åˆ†æä¸­...":"ğŸ”„ é‡æ–°åˆ†æ"),1)],10,gi),M.value?(c(),p("button",{key:0,class:"btn btn-secondary btn-sm",disabled:g.value,onClick:x},_(g.value?"å¯¼å‡ºä¸­...":"ğŸ“„ å¯¼å‡ºæ­¤é¡µ"),9,fi)):T("",!0)])])):(c(),p("div",Qr,[...V[2]||(V[2]=[e("div",{class:"empty-icon"},"ğŸ“„",-1),e("p",null,"ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ‘ä¸­çš„é¡µé¢æŸ¥çœ‹è¯¦æƒ…",-1)])]))]),o.value?(c(),p("div",{key:0,class:"image-preview-modal",tabindex:"0",onClick:P,onKeydown:v},[e("div",{class:"image-preview-content",onClick:V[1]||(V[1]=Pe(()=>{},["stop"]))},[e("button",{class:"preview-close",title:"å…³é—­ (Esc)",onClick:P},"Ã—"),e("img",{src:z.value,alt:`ç¬¬${h.value}é¡µ`},null,8,bi),e("div",ki,[e("button",{class:"preview-nav-btn prev",disabled:!y.value,title:"ä¸Šä¸€é¡µ (â†)",onClick:Pe(j,["stop"])}," â—€ ",8,yi),e("span",_i,_(h.value)+" / "+_(m.value),1),e("button",{class:"preview-nav-btn next",disabled:!C.value,title:"ä¸‹ä¸€é¡µ (â†’)",onClick:Pe(Q,["stop"])}," â–¶ ",8,$i)])])],32)):T("",!0)]))}}),xi=Oe(wi,[["__scopeId","data-v-25a66086"]]),Ci={class:"sidebar-section pages-tree-section"},Si={class:"section-header"},Pi={class:"page-count-badge"},Ii={class:"pages-tree"},Ti={key:0,class:"empty-hint"},Ai={key:1,class:"tree-all-pages"},Li=["data-page","onClick"],Bi=["src","alt"],Ri={class:"tree-page-num"},zi={key:2,class:"tree-load-more"},Ui=["onClick"],Mi={class:"tree-chapter-info"},Ei={class:"tree-chapter-title"},Vi={class:"tree-chapter-meta"},qi=["onClick"],Ki={class:"tree-pages-grid"},Oi=["data-page","onClick","onContextmenu"],Di=["src","alt"],Ni={class:"tree-page-num"},ji=Me({__name:"PagesTree",setup(a){const t=Ne(),l=k(new Set),s=k(new Map),n=k(100),o=U(()=>t.chapters),r=U(()=>t.totalPageCount);function h(P){l.value.has(P)?l.value.delete(P):l.value.add(P)}function m(P){return l.value.has(P)}function y(P){t.selectPage(P)}function C(P){return s.value.get(P)||!1}function z(P){return t.selectedPageNum===P}function B(P,v){const g=[];for(let x=P;x<=v;x++)g.push(x);return g}function M(P){return t.currentBookId?fs(t.currentBookId,P):""}function R(){n.value=Math.min(n.value+100,r.value)}function q(P){const v=P.target;v.style.opacity="0"}function N(P){const v=P.endPage-P.startPage+1;let g=0;for(let x=P.startPage;x<=P.endPage;x++)s.value.get(x)&&g++;return g===v}async function j(P){if(confirm("ç¡®å®šè¦é‡æ–°åˆ†ææ­¤ç« èŠ‚å—ï¼Ÿ"))try{const g=await(await fetch(`/api/manga-insight/${t.currentBookId}/reanalyze/chapter/${P}`,{method:"POST"})).json();g.success?alert("ç« èŠ‚åˆ†æå·²å¯åŠ¨"):alert("å¯åŠ¨å¤±è´¥: "+(g.error||"æœªçŸ¥é”™è¯¯"))}catch(v){console.error("é‡æ–°åˆ†æç« èŠ‚å¤±è´¥:",v),alert("é‡æ–°åˆ†æå¤±è´¥")}}function Q(P,v){const g=prompt(`ç¬¬ ${v} é¡µæ“ä½œ:
1. æŸ¥çœ‹è¯¦æƒ…
2. é‡æ–°åˆ†æ
3. æ·»åŠ ç¬”è®°

è¯·è¾“å…¥æ•°å­—:`);g==="1"?y(v):g==="2"?F(v):g==="3"&&alert("ç¬”è®°åŠŸèƒ½å¼€å‘ä¸­")}async function F(P){try{const v=await hs(t.currentBookId,P);v.success?alert(`ç¬¬ ${P} é¡µåˆ†æå·²å¯åŠ¨`):alert("åˆ†æå¤±è´¥: "+(v.error||"æœªçŸ¥é”™è¯¯"))}catch(v){console.error("é‡æ–°åˆ†æé¡µé¢å¤±è´¥:",v),alert("é‡æ–°åˆ†æå¤±è´¥")}}async function u(){if(t.currentBookId)try{const v=await(await fetch(`/api/manga-insight/${t.currentBookId}/pages`)).json();v.success&&v.pages&&v.pages.forEach(x=>{s.value.set(x,!0)})}catch(P){console.error("åŠ è½½å·²åˆ†æé¡µé¢å¤±è´¥:",P)}}return nt(async()=>{await u(),o.value.length>0&&o.value[0]&&l.value.add(o.value[0].id)}),(P,v)=>(c(),p("div",Ci,[e("div",Si,[v[2]||(v[2]=e("h3",{class:"section-title"},"å†…å®¹å¯¼èˆª",-1)),e("span",Pi,_(r.value)+"é¡µ",1)]),e("div",Ii,[o.value.length===0?(c(),p(W,{key:0},[r.value===0?(c(),p("div",Ti," æš‚æ— é¡µé¢ ")):(c(),p("div",Ai,[(c(!0),p(W,null,oe(B(1,Math.min(r.value,n.value)),g=>(c(),p("div",{key:g,class:G(["tree-page-item",{selected:z(g),analyzed:C(g)}]),"data-page":g,onClick:x=>y(g)},[e("img",{src:M(g),alt:`ç¬¬${g}é¡µ`,class:"tree-page-thumb",loading:"lazy",onError:v[0]||(v[0]=x=>q(x))},null,40,Bi),e("span",Ri,_(g),1)],10,Li))),128))])),r.value>n.value?(c(),p("div",zi,[e("button",{class:"btn-load-more",onClick:R}," åŠ è½½æ›´å¤š (è¿˜æœ‰ "+_(r.value-n.value)+" é¡µ) ",1)])):T("",!0)],64)):(c(!0),p(W,{key:1},oe(o.value,g=>(c(),p("div",{key:g.id,class:G(["tree-chapter",{expanded:m(g.id)}])},[e("div",{class:"tree-chapter-header",onClick:x=>h(g.id)},[v[3]||(v[3]=e("span",{class:"tree-expand-icon"},[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8 5l8 7-8 7z"})])],-1)),e("div",Mi,[e("span",Ei,_(g.title),1),e("span",Vi,_(g.endPage-g.startPage+1)+"é¡µ",1)]),e("span",{class:G(["tree-chapter-status",{analyzed:N(g)}])},null,2),e("button",{class:"btn-reanalyze-chapter",title:"é‡æ–°åˆ†ææ­¤ç« èŠ‚",onClick:Pe(x=>j(g.id),["stop"])}," ğŸ”„ ",8,qi)],8,Ui),e("div",Ki,[(c(!0),p(W,null,oe(B(g.startPage,g.endPage),x=>(c(),p("div",{key:x,class:G(["tree-page-item",{selected:z(x),analyzed:C(x)}]),"data-page":x,onClick:A=>y(x),onContextmenu:Pe(A=>Q(A,x),["prevent"])},[e("img",{src:M(x),alt:`ç¬¬${x}é¡µ`,class:"tree-page-thumb",loading:"lazy",onError:v[1]||(v[1]=A=>q(A))},null,40,Di),e("span",Ni,_(x),1)],42,Oi))),128))])],2))),128))])]))}}),Fi=Oe(ji,[["__scopeId","data-v-8bc2a2a4"]]),Qi={class:"settings-tabs"},Hi={key:1,class:"insight-settings-content"},Ji={class:"form-group"},Gi={class:"form-group"},Zi={class:"form-group"},Wi={class:"model-input-row"},Xi=["disabled"],Yi={key:0,class:"model-select-container"},eu=["value"],tu=["value"],su={class:"model-count"},nu={key:0,class:"form-group"},lu={class:"form-row"},au={class:"form-group"},ou={class:"form-group"},ru={class:"form-group"},iu={class:"checkbox-label"},uu={class:"form-group"},cu={class:"checkbox-label"},du={class:"form-group"},pu=["disabled"],vu={key:2,class:"insight-settings-content"},mu={class:"form-group"},gu={class:"form-group"},hu={class:"form-group"},fu={class:"model-input-row"},bu=["disabled"],ku={key:0,class:"model-select-container"},yu=["value"],_u=["value"],$u={class:"model-count"},wu={key:0,class:"form-group"},xu={class:"form-group"},Cu={class:"checkbox-label"},Su=["disabled"],Pu={key:3,class:"insight-settings-content"},Iu={class:"form-group"},Tu={class:"form-hint"},Au={class:"form-group"},Lu={class:"form-group"},Bu={class:"form-hint"},Ru={key:0,style:{"margin-top":"16px"}},zu={style:{"margin-bottom":"8px"}},Uu={style:{"min-width":"50px",color:"#666","font-size":"13px"}},Mu=["value","disabled","onChange"],Eu=["value","disabled","title","onChange"],Vu={style:{display:"flex","flex-direction":"column","align-items":"center",gap:"2px","font-size":"11px",cursor:"pointer","min-width":"40px","text-align":"center"}},qu=["checked","onChange"],Ku=["onClick"],Ou={class:"batch-info-box"},Du={class:"layers-preview-list"},Nu={key:0,class:"align-badge"},ju={class:"batch-estimate-box"},Fu={key:4,class:"insight-settings-content"},Qu={class:"form-group"},Hu={class:"form-group"},Ju={class:"form-group"},Gu={class:"model-input-row"},Zu=["disabled"],Wu={key:0,class:"model-select-container"},Xu=["value"],Yu=["value"],ec={class:"model-count"},tc={key:0,class:"form-group"},sc={class:"form-group"},nc=["disabled"],lc={key:5,class:"insight-settings-content"},ac={class:"form-group"},oc={class:"form-group"},rc={class:"form-group"},ic={class:"model-input-row"},uc=["disabled"],cc={key:0,class:"model-select-container"},dc=["value"],pc=["value"],vc={class:"model-count"},mc={key:0,class:"form-group"},gc={class:"form-group"},hc=["disabled"],fc={key:6,class:"insight-settings-content prompts-settings"},bc={class:"form-group"},kc={class:"form-hint"},yc={class:"form-group"},_c={class:"prompts-library-section"},$c={class:"library-header"},wc={class:"library-actions"},xc={class:"saved-prompts-list"},Cc={key:0,class:"loading-text"},Sc={key:1,class:"placeholder-text"},Pc=["onClick"],Ic={class:"prompt-name"},Tc={class:"prompt-type-badge"},Ac=["onClick"],Lc=["disabled"],Bc=Me({__name:"InsightSettingsModal",emits:["close"],setup(a,{emit:t}){const l=t,s=Ne(),n=k("vlm"),o=k(!1),r=k(!1),h=k(""),m=k(""),y=k([]),C=k([]),z=k([]),B=k([]),M=k(!1),R=k(!1),q=k(!1),N=k(!1),j=k(!1),Q=k(!1),F=k(!1),u=k(!1),P=k(!1),v=k(s.config.vlm.provider),g=k(s.config.vlm.apiKey),x=k(s.config.vlm.model),A=k(s.config.vlm.baseUrl),V=k(s.config.vlm.rpmLimit),K=k(s.config.vlm.temperature),te=k(s.config.vlm.forceJson),E=k(s.config.vlm.useStream),$=k(s.config.vlm.imageMaxSize),S=k(s.config.llm.provider),I=k(s.config.llm.apiKey),L=k(s.config.llm.model),se=k(s.config.llm.baseUrl),ae=k(s.config.llm.useStream),ve=k(s.config.batch.pagesPerBatch),Ie=k(s.config.batch.contextBatchCount),ke=k(s.config.batch.architecturePreset),He={simple:{name:"ç®€æ´æ¨¡å¼",description:"é€‚åˆ100é¡µä»¥å†…çš„çŸ­ç¯‡æ¼«ç”»",layers:[{name:"æ‰¹é‡åˆ†æ",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},standard:{name:"æ ‡å‡†æ¨¡å¼",description:"é€‚åˆå¤§å¤šæ•°æ¼«ç”»ï¼Œå¹³è¡¡æ•ˆæœä¸é€Ÿåº¦",layers:[{name:"æ‰¹é‡åˆ†æ",units:5,align:!1},{name:"æ®µè½æ€»ç»“",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},chapter_based:{name:"ç« èŠ‚æ¨¡å¼",description:"é€‚åˆæœ‰æ˜ç¡®ç« èŠ‚åˆ’åˆ†çš„æ¼«ç”»ï¼Œä¼šåœ¨ç« èŠ‚è¾¹ç•Œå¤„åˆ‡åˆ†",layers:[{name:"æ‰¹é‡åˆ†æ",units:5,align:!0},{name:"ç« èŠ‚æ€»ç»“",units:0,align:!0},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},full:{name:"å®Œæ•´æ¨¡å¼",description:"é€‚åˆé•¿ç¯‡è¿è½½ï¼Œæä¾›æœ€è¯¦ç»†çš„åˆ†å±‚æ€»ç»“",layers:[{name:"æ‰¹é‡åˆ†æ",units:5,align:!1},{name:"å°æ€»ç»“",units:5,align:!1},{name:"ç« èŠ‚æ€»ç»“",units:0,align:!0},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]}},ue=k(s.config.batch.customLayers?.length>0?s.config.batch.customLayers.map(b=>({name:b.name,units:b.units_per_group??b.units??5,align:b.align_to_chapter??b.align??!1})):[{name:"æ‰¹é‡åˆ†æ",units:5,align:!1},{name:"æ®µè½æ€»ç»“",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]),we=k(s.config.embedding.provider),xe=k(s.config.embedding.apiKey),Ce=k(s.config.embedding.model),Ee=k(s.config.embedding.baseUrl),je=k(s.config.embedding.rpmLimit),Le=k(s.config.reranker.provider),Ve=k(s.config.reranker.apiKey),Se=k(s.config.reranker.model),qe=k(s.config.reranker.baseUrl),Fe=k(s.config.reranker.topK),ge=k("batch_analysis"),ce=k(""),me=k({}),ye=k([]),lt=k(!1),gt=[{value:"gemini",label:"Google Gemini"},{value:"openai",label:"OpenAI"},{value:"qwen",label:"é˜¿é‡Œé€šä¹‰åƒé—®"},{value:"siliconflow",label:"SiliconFlow"},{value:"deepseek",label:"DeepSeek"},{value:"volcano",label:"ç«å±±å¼•æ“"},{value:"custom",label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹"}],wt=[{value:"openai",label:"OpenAI"},{value:"siliconflow",label:"SiliconFlow"},{value:"custom",label:"è‡ªå®šä¹‰"}],xt=[{value:"jina",label:"Jina AI"},{value:"cohere",label:"Cohere"},{value:"siliconflow",label:"SiliconFlow"},{value:"custom",label:"è‡ªå®šä¹‰"}],Ct=[{value:"simple",label:"ç®€æ´æ¨¡å¼ - æ‰¹é‡åˆ†æ â†’ å…¨ä¹¦æ€»ç»“ï¼ˆçŸ­ç¯‡ï¼‰"},{value:"standard",label:"æ ‡å‡†æ¨¡å¼ - æ‰¹é‡åˆ†æ â†’ æ®µè½æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"chapter_based",label:"ç« èŠ‚æ¨¡å¼ - æ‰¹é‡åˆ†æ â†’ ç« èŠ‚æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"full",label:"å®Œæ•´æ¨¡å¼ - æ‰¹é‡åˆ†æ â†’ å°æ€»ç»“ â†’ ç« èŠ‚æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"custom",label:"è‡ªå®šä¹‰æ¨¡å¼ - å®Œå…¨è‡ªå®šä¹‰å±‚çº§æ¶æ„"}],St=[{value:"batch_analysis",label:"ğŸ“„ æ‰¹é‡åˆ†ææç¤ºè¯"},{value:"segment_summary",label:"ğŸ“‘ æ®µè½æ€»ç»“æç¤ºè¯"},{value:"chapter_summary",label:"ğŸ“– ç« èŠ‚æ€»ç»“æç¤ºè¯"},{value:"qa_response",label:"ğŸ’¬ é—®ç­”å“åº”æç¤ºè¯"}],Pt={gemini:"gemini-2.0-flash",openai:"gpt-4o",qwen:"qwen-vl-max",deepseek:"deepseek-chat",siliconflow:"Qwen/Qwen2.5-VL-72B-Instruct",volcano:"doubao-1.5-vision-pro-32k"},It={gemini:"gemini-2.0-flash",openai:"gpt-4o-mini",qwen:"qwen-turbo",deepseek:"deepseek-chat",siliconflow:"Qwen/Qwen2.5-72B-Instruct",volcano:"doubao-1.5-pro-32k"},Tt={openai:"text-embedding-3-small",siliconflow:"BAAI/bge-m3"},At={jina:"jina-reranker-v2-base-multilingual",cohere:"rerank-multilingual-v3.0",siliconflow:"BAAI/bge-reranker-v2-m3"},Lt=U(()=>v.value==="custom"),Bt=U(()=>S.value==="custom"),Rt=U(()=>we.value==="custom"),zt=U(()=>Le.value==="custom"),Ut=U(()=>`æ¯æ‰¹æ¬¡åˆ†æ ${ve.value||5} é¡µ`),Je=U(()=>ke.value==="custom"),Mt=U(()=>ke.value==="custom"?"å®Œå…¨è‡ªå®šä¹‰å±‚çº§æ¶æ„ï¼Œçµæ´»é…ç½®åˆ†ææµç¨‹":He[ke.value]?.description||"æ ¹æ®æ¼«ç”»ç±»å‹é€‰æ‹©åˆé€‚çš„åˆ†ææ¶æ„"),at=U(()=>{if(ke.value==="custom")return ue.value;const b=He[ke.value];return b?b.layers:He.standard.layers});function Qe(b){n.value=b,h.value="",m.value=""}function Ge(){l("close")}function Et(){const b=ue.value.length-1;ue.value.splice(b,0,{name:`æ±‡æ€»å±‚${b}`,units:5,align:!1})}function ot(b){b>0&&b<ue.value.length-1&&ue.value.splice(b,1)}function rt(b,i,f){ue.value[b]&&(ue.value[b][i]=f,b===0&&i==="units"&&(ve.value=f))}function it(){ue.value.length>0&&ue.value[0]&&(ue.value[0].units=ve.value)}function Vt(b){return b>0&&b<ue.value.length-1&&ue.value.length>2}function qt(b){return b>0&&b<ue.value.length-1}function fe(b){return b<ue.value.length-1}function Kt(b){return b===0?"æ¯æ‰¹åˆ†æçš„é¡µæ•°":"æ¯ç»„åŒ…å«å•å…ƒæ•°ï¼ˆ0=å…¨éƒ¨æ±‡æ€»ï¼‰"}function Ot(){const b=v.value;if(s.config.vlm.provider!==b&&(s.config.vlm.apiKey=g.value,s.config.vlm.model=x.value,s.config.vlm.baseUrl=A.value,s.config.vlm.rpmLimit=V.value,s.config.vlm.temperature=K.value,s.config.vlm.forceJson=te.value,s.config.vlm.useStream=E.value,s.config.vlm.imageMaxSize=$.value),s.setVlmProvider(b),g.value=s.config.vlm.apiKey,x.value=s.config.vlm.model,A.value=s.config.vlm.baseUrl,V.value=s.config.vlm.rpmLimit,K.value=s.config.vlm.temperature,te.value=s.config.vlm.forceJson,E.value=s.config.vlm.useStream,$.value=s.config.vlm.imageMaxSize,!x.value){const f=Pt[b];f&&(x.value=f)}}function Dt(){const b=S.value;if(s.config.llm.provider!==b&&(s.config.llm.apiKey=I.value,s.config.llm.model=L.value,s.config.llm.baseUrl=se.value,s.config.llm.useStream=ae.value),s.setLlmProvider(b),I.value=s.config.llm.apiKey,L.value=s.config.llm.model,se.value=s.config.llm.baseUrl,ae.value=s.config.llm.useStream,!L.value){const f=It[b];f&&(L.value=f)}}function Nt(){const b=we.value;if(s.config.embedding.provider!==b&&(s.config.embedding.apiKey=xe.value,s.config.embedding.model=Ce.value,s.config.embedding.baseUrl=Ee.value,s.config.embedding.rpmLimit=je.value),s.setEmbeddingProvider(b),xe.value=s.config.embedding.apiKey,Ce.value=s.config.embedding.model,Ee.value=s.config.embedding.baseUrl,je.value=s.config.embedding.rpmLimit,!Ce.value){const f=Tt[b];f&&(Ce.value=f)}}function jt(){const b=Le.value;if(s.config.reranker.provider!==b&&(s.config.reranker.apiKey=Ve.value,s.config.reranker.model=Se.value,s.config.reranker.baseUrl=qe.value,s.config.reranker.topK=Fe.value),s.setRerankerProvider(b),Ve.value=s.config.reranker.apiKey,Se.value=s.config.reranker.model,qe.value=s.config.reranker.baseUrl,Fe.value=s.config.reranker.topK,!Se.value){const f=At[b];f&&(Se.value=f)}}function D(b,i){h.value=b,m.value=i,setTimeout(()=>{h.value="",m.value=""},3e3)}async function d(){if(!r.value){r.value=!0,h.value="";try{const b=await pn({provider:v.value,api_key:g.value,model:x.value,base_url:A.value||void 0});b.success?D("VLM è¿æ¥æˆåŠŸ","success"):D("è¿æ¥å¤±è´¥: "+(b.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(b){D("æµ‹è¯•å¤±è´¥: "+(b instanceof Error?b.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{r.value=!1}}}async function w(){if(!r.value){r.value=!0,h.value="";try{const b=await vn({provider:we.value,api_key:xe.value,model:Ce.value,base_url:Ee.value||void 0});b.success?D("Embedding è¿æ¥æˆåŠŸ","success"):D("è¿æ¥å¤±è´¥: "+(b.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(b){D("æµ‹è¯•å¤±è´¥: "+(b instanceof Error?b.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{r.value=!1}}}async function H(){if(!r.value){r.value=!0,h.value="";try{const b=await mn({provider:Le.value,api_key:Ve.value,model:Se.value,base_url:qe.value||void 0});b.success?D("Reranker è¿æ¥æˆåŠŸ","success"):D("è¿æ¥å¤±è´¥: "+(b.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(b){D("æµ‹è¯•å¤±è´¥: "+(b instanceof Error?b.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{r.value=!1}}}async function _e(){if(!P.value){P.value=!0,h.value="";try{const b=await gn({provider:S.value,api_key:I.value,model:L.value,base_url:se.value||void 0});b.success?D("LLM è¿æ¥æˆåŠŸ","success"):D("è¿æ¥å¤±è´¥: "+(b.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(b){D("æµ‹è¯•å¤±è´¥: "+(b instanceof Error?b.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{P.value=!1}}}const he=["siliconflow","deepseek","volcano","gemini","qwen","openai","custom"];async function ne(b){let i,f,J,de,Ze,Te;switch(b){case"vlm":i=v.value,f=g.value,J=A.value,de=Z=>{j.value=Z},Ze=Z=>{y.value=Z},Te=Z=>{M.value=Z};break;case"llm":i=S.value,f=I.value,J=se.value,de=Z=>{Q.value=Z},Ze=Z=>{C.value=Z},Te=Z=>{R.value=Z};break;case"embedding":i=we.value,f=xe.value,J=Ee.value,de=Z=>{F.value=Z},Ze=Z=>{z.value=Z},Te=Z=>{q.value=Z};break;case"reranker":i=Le.value,f=Ve.value,J=qe.value,de=Z=>{u.value=Z},Ze=Z=>{B.value=Z},Te=Z=>{N.value=Z};break}if(!f){D("è¯·å…ˆå¡«å†™ API Key","error");return}if(!he.includes(i)){D(`${i} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`,"error");return}if(i==="custom"&&!J){D("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL","error");return}const Os=i==="custom"?"custom_openai":i;de(!0);try{const Z=await Ws(Os,f,J||void 0);Z.success&&Z.models&&Z.models.length>0?(Ze(Z.models),Te(!0),D(`è·å–åˆ° ${Z.models.length} ä¸ªæ¨¡å‹`,"success")):(D(Z.message||"æœªè·å–åˆ°æ¨¡å‹åˆ—è¡¨","error"),Te(!1))}catch(Z){D("è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥: "+(Z instanceof Error?Z.message:"ç½‘ç»œé”™è¯¯"),"error"),Te(!1)}finally{de(!1)}}function Ke(b,i){if(i)switch(b){case"vlm":x.value=i;break;case"llm":L.value=i;break;case"embedding":Ce.value=i;break;case"reranker":Se.value=i;break}}async function Be(){lt.value=!0;try{const b=await hn();b.success&&b.library&&(ye.value=b.library)}catch(b){console.error("åŠ è½½æç¤ºè¯åº“å¤±è´¥:",b),ye.value=[]}finally{lt.value=!1}}function ut(){const b=ge.value;ce.value=me.value[b]||Ye[b]||""}function Re(){if(confirm("ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯å—ï¼Ÿå½“å‰ç¼–è¾‘çš„å†…å®¹å°†ä¸¢å¤±ã€‚")){const b=ge.value;ce.value=Ye[b]||"",delete me.value[b],D("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯","success")}}async function le(){try{await navigator.clipboard.writeText(ce.value),D("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿","success")}catch{D("å¤åˆ¶å¤±è´¥","error")}}async function Rs(){const b=ce.value.trim();if(!b){D("æç¤ºè¯å†…å®¹ä¸èƒ½ä¸ºç©º","error");return}const i=prompt("è¯·è¾“å…¥æç¤ºè¯åç§°ï¼š");if(!i||!i.trim())return;const f={id:Date.now().toString(),name:i.trim(),type:ge.value,content:b,created_at:new Date().toISOString()};try{const J=await fn(f);J.success?(ye.value.push(f),D("æç¤ºè¯å·²ä¿å­˜åˆ°åº“","success")):D("ä¿å­˜å¤±è´¥: "+(J.error||"æœªçŸ¥é”™è¯¯"),"error")}catch{D("ä¿å­˜å¤±è´¥","error")}}function zs(b){ge.value=b.type,ce.value=b.content,me.value[b.type]=b.content,D(`å·²åŠ è½½æç¤ºè¯: ${b.name}`,"success")}async function Us(b){if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæç¤ºè¯å—ï¼Ÿ"))try{(await bn(b)).success?(ye.value=ye.value.filter(f=>f.id!==b),D("æç¤ºè¯å·²åˆ é™¤","success")):D("åˆ é™¤å¤±è´¥","error")}catch{D("åˆ é™¤å¤±è´¥","error")}}function Ms(){ce.value&&(me.value[ge.value]=ce.value);const b={version:"1.0",exported_at:new Date().toISOString(),prompts:me.value,library:ye.value},i=new Blob([JSON.stringify(b,null,2)],{type:"application/json"}),f=URL.createObjectURL(i),J=document.createElement("a");J.href=f,J.download=`manga-insight-prompts-${new Date().toISOString().slice(0,10)}.json`,J.click(),URL.revokeObjectURL(f),D("æç¤ºè¯å·²å¯¼å‡º","success")}function Es(){const b=document.getElementById("promptsFileInput");b&&b.click()}async function Vs(b){const i=b.target,f=i.files?.[0];if(f){try{const J=await f.text(),de=JSON.parse(J);if(de.prompts&&(me.value={...me.value,...de.prompts}),de.library&&Array.isArray(de.library)){const Ze=new Set(ye.value.map(Te=>Te.id));for(const Te of de.library)Ze.has(Te.id)||ye.value.push(Te);await kn(ye.value)}ut(),D("æç¤ºè¯å¯¼å…¥æˆåŠŸ","success")}catch(J){console.error("å¯¼å…¥å¤±è´¥:",J),D("å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼","error")}i.value=""}}async function qs(){if(!o.value){o.value=!0;try{s.updateVlmConfig({provider:v.value,apiKey:g.value,model:x.value,baseUrl:v.value==="custom"?A.value:"",rpmLimit:V.value,temperature:K.value,forceJson:te.value,useStream:E.value,imageMaxSize:$.value}),s.updateLlmConfig({useSameAsVlm:!1,provider:S.value,apiKey:I.value,model:L.value,baseUrl:S.value==="custom"?se.value:"",useStream:ae.value}),s.updateEmbeddingConfig({provider:we.value,apiKey:xe.value,model:Ce.value,baseUrl:we.value==="custom"?Ee.value:"",rpmLimit:je.value}),s.updateRerankerConfig({provider:Le.value,apiKey:Ve.value,model:Se.value,baseUrl:Le.value==="custom"?qe.value:"",topK:Fe.value}),s.updateBatchConfig({pagesPerBatch:ve.value,contextBatchCount:Ie.value,architecturePreset:ke.value}),ce.value&&(me.value[ge.value]=ce.value),s.updatePrompts(me.value);const b=s.getConfigForApi(),i=await dn(b);i.success?(D("è®¾ç½®å·²ä¿å­˜","success"),setTimeout(()=>{Ge()},500)):D("ä¿å­˜å¤±è´¥: "+(i.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(b){D("ä¿å­˜å¤±è´¥: "+(b instanceof Error?b.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{o.value=!1}}}async function Ks(){try{s.loadConfigFromStorage();const b=await cn();b.success&&b.config&&s.setConfigFromApi(b.config),ls()}catch(b){console.error("åŠ è½½é…ç½®å¤±è´¥:",b),ls()}}function ls(){if(v.value=s.config.vlm.provider,g.value=s.config.vlm.apiKey,x.value=s.config.vlm.model,A.value=s.config.vlm.baseUrl,V.value=s.config.vlm.rpmLimit,K.value=s.config.vlm.temperature,te.value=s.config.vlm.forceJson,E.value=s.config.vlm.useStream,$.value=s.config.vlm.imageMaxSize,S.value=s.config.llm.provider,I.value=s.config.llm.apiKey,L.value=s.config.llm.model,se.value=s.config.llm.baseUrl,ae.value=s.config.llm.useStream,we.value=s.config.embedding.provider,xe.value=s.config.embedding.apiKey,Ce.value=s.config.embedding.model,Ee.value=s.config.embedding.baseUrl,je.value=s.config.embedding.rpmLimit,Le.value=s.config.reranker.provider,Ve.value=s.config.reranker.apiKey,Se.value=s.config.reranker.model,qe.value=s.config.reranker.baseUrl,Fe.value=s.config.reranker.topK,ve.value=s.config.batch.pagesPerBatch,Ie.value=s.config.batch.contextBatchCount,ke.value=s.config.batch.architecturePreset,s.config.prompts){me.value={...s.config.prompts};const b=ge.value;ce.value=me.value[b]||Ye[b]||""}else me.value={},ce.value=Ye[ge.value]||""}return st(ge,(b,i)=>{i&&ce.value&&(me.value[i]=ce.value),b&&(ce.value=me.value[b]||Ye[b]||"")}),nt(async()=>{await Ks(),await Be(),ce.value=me.value[ge.value]||Ye[ge.value]||""}),(b,i)=>(c(),et(Zs,{title:"æ¼«ç”»åˆ†æè®¾ç½®",size:"large",customClass:"insight-settings-modal",onClose:Ge},{footer:ft(()=>[e("button",{class:"btn btn-secondary",onClick:Ge},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:o.value,onClick:qs},_(o.value?"ä¿å­˜ä¸­...":"ä¿å­˜"),9,Lc)]),default:ft(()=>[e("div",Qi,[e("button",{class:G(["settings-tab",{active:n.value==="vlm"}]),onClick:i[0]||(i[0]=f=>Qe("vlm"))}," ğŸ–¼ï¸ VLM å¤šæ¨¡æ€ ",2),e("button",{class:G(["settings-tab",{active:n.value==="llm"}]),onClick:i[1]||(i[1]=f=>Qe("llm"))}," ğŸ’¬ LLM å¯¹è¯ ",2),e("button",{class:G(["settings-tab",{active:n.value==="batch"}]),onClick:i[2]||(i[2]=f=>Qe("batch"))}," ğŸ“Š æ‰¹é‡åˆ†æ ",2),e("button",{class:G(["settings-tab",{active:n.value==="embedding"}]),onClick:i[3]||(i[3]=f=>Qe("embedding"))}," ğŸ”¢ å‘é‡æ¨¡å‹ ",2),e("button",{class:G(["settings-tab",{active:n.value==="reranker"}]),onClick:i[4]||(i[4]=f=>Qe("reranker"))}," ğŸ”„ é‡æ’åº ",2),e("button",{class:G(["settings-tab",{active:n.value==="prompts"}]),onClick:i[5]||(i[5]=f=>Qe("prompts"))}," ğŸ“ æç¤ºè¯ ",2)]),h.value?(c(),p("div",{key:0,class:G(["test-message",m.value])},_(h.value),3)):T("",!0),n.value==="vlm"?(c(),p("div",Hi,[i[58]||(i[58]=e("p",{class:"settings-hint"},"VLMï¼ˆè§†è§‰è¯­è¨€æ¨¡å‹ï¼‰ç”¨äºåˆ†ææ¼«ç”»å›¾ç‰‡å†…å®¹ï¼Œæå–å¯¹è¯å’Œåœºæ™¯ä¿¡æ¯ã€‚",-1)),e("div",Ji,[i[43]||(i[43]=e("label",null,"æœåŠ¡å•†",-1)),pe(Ae,{modelValue:v.value,"onUpdate:modelValue":i[6]||(i[6]=f=>v.value=f),options:gt,onChange:Ot},null,8,["modelValue"])]),e("div",Gi,[i[44]||(i[44]=e("label",null,"API Key",-1)),O(e("input",{"onUpdate:modelValue":i[7]||(i[7]=f=>g.value=f),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[Y,g.value]])]),e("div",Zi,[i[46]||(i[46]=e("label",null,"æ¨¡å‹",-1)),e("div",Wi,[O(e("input",{"onUpdate:modelValue":i[8]||(i[8]=f=>x.value=f),type:"text",placeholder:"ä¾‹å¦‚: gemini-2.0-flash"},null,512),[[Y,x.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:j.value,onClick:i[9]||(i[9]=f=>ne("vlm"))},_(j.value?"è·å–ä¸­...":"ğŸ” è·å–æ¨¡å‹"),9,Xi)]),M.value&&y.value.length>0?(c(),p("div",Yi,[e("select",{class:"model-select",value:x.value,onChange:i[10]||(i[10]=f=>Ke("vlm",f.target.value))},[i[45]||(i[45]=e("option",{value:""},"-- é€‰æ‹©æ¨¡å‹ --",-1)),(c(!0),p(W,null,oe(y.value,f=>(c(),p("option",{key:f.id,value:f.id},_(f.name||f.id),9,tu))),128))],40,eu),e("span",su,"å…± "+_(y.value.length)+" ä¸ªæ¨¡å‹",1)])):T("",!0)]),Lt.value?(c(),p("div",nu,[i[47]||(i[47]=e("label",null,"Base URL",-1)),O(e("input",{"onUpdate:modelValue":i[11]||(i[11]=f=>A.value=f),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[Y,A.value]])])):T("",!0),e("div",lu,[e("div",au,[i[48]||(i[48]=e("label",null,"RPM é™åˆ¶",-1)),O(e("input",{"onUpdate:modelValue":i[12]||(i[12]=f=>V.value=f),type:"number",min:"1",max:"100"},null,512),[[Y,V.value,void 0,{number:!0}]]),i[49]||(i[49]=e("p",{class:"form-hint"},"æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°",-1))]),e("div",ou,[i[50]||(i[50]=e("label",null,"æ¸©åº¦",-1)),O(e("input",{"onUpdate:modelValue":i[13]||(i[13]=f=>K.value=f),type:"number",min:"0",max:"1",step:"0.1"},null,512),[[Y,K.value,void 0,{number:!0}]]),i[51]||(i[51]=e("p",{class:"form-hint"},"0-1ï¼Œè¶Šä½è¶Šç¡®å®š",-1))])]),e("div",ru,[e("label",iu,[O(e("input",{"onUpdate:modelValue":i[14]||(i[14]=f=>te.value=f),type:"checkbox"},null,512),[[tt,te.value]]),i[52]||(i[52]=e("span",null,"å¼ºåˆ¶ JSON è¾“å‡º",-1))]),i[53]||(i[53]=e("p",{class:"form-hint"},"å¯¹ OpenAI å…¼å®¹ API å¯ç”¨ response_format: json_object",-1))]),e("div",uu,[e("label",cu,[O(e("input",{"onUpdate:modelValue":i[15]||(i[15]=f=>E.value=f),type:"checkbox"},null,512),[[tt,E.value]]),i[54]||(i[54]=e("span",null,"ä½¿ç”¨æµå¼è¯·æ±‚",-1))]),i[55]||(i[55]=e("p",{class:"form-hint"},"æµå¼è¯·æ±‚å¯é¿å…é•¿æ—¶é—´ç­‰å¾…å¯¼è‡´çš„è¶…æ—¶é—®é¢˜",-1))]),e("div",du,[i[56]||(i[56]=e("label",null,"å›¾ç‰‡å‹ç¼©ï¼ˆæœ€å¤§è¾¹é•¿ï¼‰",-1)),O(e("input",{"onUpdate:modelValue":i[16]||(i[16]=f=>$.value=f),type:"number",min:"0",max:"4096",step:"128",placeholder:"0 è¡¨ç¤ºä¸å‹ç¼©"},null,512),[[Y,$.value,void 0,{number:!0}]]),i[57]||(i[57]=e("p",{class:"form-hint"},"å‘é€å‰å°†å›¾ç‰‡ç­‰æ¯”ä¾‹ç¼©æ”¾åˆ°æŒ‡å®šæœ€å¤§è¾¹é•¿ï¼ˆåƒç´ ï¼‰ï¼Œ0 è¡¨ç¤ºä¸å‹ç¼©",-1))]),e("button",{class:"btn btn-secondary",disabled:r.value,onClick:d},_(r.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,pu)])):T("",!0),n.value==="llm"?(c(),p("div",vu,[i[65]||(i[65]=e("p",{class:"settings-hint"},"LLMï¼ˆå¯¹è¯æ¨¡å‹ï¼‰ç”¨äºç”Ÿæˆæ•…äº‹æ¦‚è¦ã€æ™ºèƒ½é—®ç­”ç­‰æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ã€‚",-1)),e("div",mu,[i[59]||(i[59]=e("label",null,"æœåŠ¡å•†",-1)),pe(Ae,{modelValue:S.value,"onUpdate:modelValue":i[17]||(i[17]=f=>S.value=f),options:gt,onChange:Dt},null,8,["modelValue"])]),e("div",gu,[i[60]||(i[60]=e("label",null,"API Key",-1)),O(e("input",{"onUpdate:modelValue":i[18]||(i[18]=f=>I.value=f),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[Y,I.value]])]),e("div",hu,[i[62]||(i[62]=e("label",null,"æ¨¡å‹",-1)),e("div",fu,[O(e("input",{"onUpdate:modelValue":i[19]||(i[19]=f=>L.value=f),type:"text",placeholder:"ä¾‹å¦‚: gpt-4o-mini"},null,512),[[Y,L.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:Q.value,onClick:i[20]||(i[20]=f=>ne("llm"))},_(Q.value?"è·å–ä¸­...":"ğŸ” è·å–æ¨¡å‹"),9,bu)]),R.value&&C.value.length>0?(c(),p("div",ku,[e("select",{class:"model-select",value:L.value,onChange:i[21]||(i[21]=f=>Ke("llm",f.target.value))},[i[61]||(i[61]=e("option",{value:""},"-- é€‰æ‹©æ¨¡å‹ --",-1)),(c(!0),p(W,null,oe(C.value,f=>(c(),p("option",{key:f.id,value:f.id},_(f.name||f.id),9,_u))),128))],40,yu),e("span",$u,"å…± "+_(C.value.length)+" ä¸ªæ¨¡å‹",1)])):T("",!0)]),Bt.value?(c(),p("div",wu,[i[63]||(i[63]=e("label",null,"Base URL",-1)),O(e("input",{"onUpdate:modelValue":i[22]||(i[22]=f=>se.value=f),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[Y,se.value]])])):T("",!0),e("div",xu,[e("label",Cu,[O(e("input",{"onUpdate:modelValue":i[23]||(i[23]=f=>ae.value=f),type:"checkbox"},null,512),[[tt,ae.value]]),i[64]||(i[64]=e("span",null,"ä½¿ç”¨æµå¼è¯·æ±‚",-1))])]),e("button",{class:"btn btn-secondary",disabled:P.value,onClick:_e},_(P.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,Su)])):T("",!0),n.value==="batch"?(c(),p("div",Pu,[i[76]||(i[76]=e("p",{class:"settings-hint"},"é…ç½®æ‰¹é‡åˆ†æçš„å‚æ•°ï¼Œå½±å“åˆ†æé€Ÿåº¦å’Œè´¨é‡ã€‚",-1)),e("div",Iu,[i[66]||(i[66]=e("label",null,"æ¯æ‰¹æ¬¡åˆ†æé¡µæ•°",-1)),O(e("input",{"onUpdate:modelValue":i[24]||(i[24]=f=>ve.value=f),type:"number",min:"1",max:"10",onChange:it},null,544),[[Y,ve.value,void 0,{number:!0}]]),e("p",Tu,"æ¯æ¬¡å‘é€ç»™ VLM çš„å›¾ç‰‡æ•°é‡ï¼Œå»ºè®® 3-5 å¼ ã€‚"+_(Ut.value),1)]),e("div",Au,[i[67]||(i[67]=e("label",null,"ä¸Šæ–‡å‚è€ƒæ‰¹æ¬¡æ•°",-1)),O(e("input",{"onUpdate:modelValue":i[25]||(i[25]=f=>Ie.value=f),type:"number",min:"0",max:"5"},null,512),[[Y,Ie.value,void 0,{number:!0}]]),i[68]||(i[68]=e("p",{class:"form-hint"},"æ¯æ‰¹åˆ†ææ—¶å‚è€ƒå‰å‡ æ‰¹çš„ç»“æœä½œä¸ºä¸Šä¸‹æ–‡ï¼Œ0 è¡¨ç¤ºä¸å‚è€ƒ",-1))]),e("div",Lu,[i[69]||(i[69]=e("label",null,"åˆ†ææ¶æ„",-1)),pe(Ae,{modelValue:ke.value,"onUpdate:modelValue":i[26]||(i[26]=f=>ke.value=f),options:Ct},null,8,["modelValue"]),e("p",Bu,_(Mt.value),1)]),Je.value?(c(),p("div",Ru,[i[71]||(i[71]=e("label",{style:{display:"block","margin-bottom":"8px","font-weight":"500","font-size":"14px"}},"è‡ªå®šä¹‰å±‚çº§",-1)),e("div",zu,[(c(!0),p(W,null,oe(ue.value,(f,J)=>(c(),p("div",{key:J,style:{display:"flex","flex-direction":"row",gap:"8px","align-items":"center","margin-bottom":"8px",padding:"12px",background:"#f5f5f5","border-radius":"8px",border:"1px solid #e0e0e0"}},[e("span",Uu,"ç¬¬"+_(J+1)+"å±‚",1),e("input",{type:"text",value:f.name,disabled:!qt(J),placeholder:"å±‚çº§åç§°",style:{flex:"1",padding:"8px 12px",border:"1px solid #e0e0e0","border-radius":"6px","font-size":"14px"},onChange:de=>rt(J,"name",de.target.value)},null,40,Mu),e("input",{type:"number",value:f.units,disabled:!fe(J),title:Kt(J),min:"0",max:"20",style:{width:"70px",padding:"8px 12px",border:"1px solid #e0e0e0","border-radius":"6px","font-size":"14px"},onChange:de=>rt(J,"units",parseInt(de.target.value)||0)},null,40,Eu),e("label",Vu,[e("input",{type:"checkbox",checked:f.align,style:{width:"16px",height:"16px"},onChange:de=>rt(J,"align",de.target.checked)},null,40,qu),i[70]||(i[70]=e("span",{style:{"line-height":"1.2"}},[ie("ç« èŠ‚"),e("br"),ie("å¯¹é½")],-1))]),Vt(J)?(c(),p("button",{key:0,type:"button",style:{padding:"6px 12px",background:"#ef4444",color:"white",border:"none","border-radius":"6px",cursor:"pointer","font-size":"13px","font-weight":"500"},onClick:de=>ot(J)}," åˆ é™¤ ",8,Ku)):T("",!0)]))),128))]),e("button",{type:"button",class:"btn btn-sm",style:{"margin-top":"4px",border:"1px solid #e0e0e0"},onClick:Et}," + æ·»åŠ å±‚çº§ "),i[72]||(i[72]=e("p",{class:"form-hint"},"ç¬¬ä¸€å±‚å›ºå®šä¸ºæ‰¹é‡åˆ†æï¼Œæœ€åä¸€å±‚å›ºå®šä¸ºå…¨ä¹¦æ€»ç»“ã€‚ä¸­é—´å¯æ·»åŠ ä»»æ„æ±‡æ€»å±‚çº§ã€‚",-1))])):T("",!0),e("div",Ou,[i[73]||(i[73]=e("h4",null,"å½“å‰æ¶æ„é¢„è§ˆ",-1)),e("ul",Du,[(c(!0),p(W,null,oe(at.value,(f,J)=>(c(),p("li",{key:J},[e("strong",null,"ç¬¬"+_(J+1)+"å±‚ - "+_(f.name),1),ie(" "+_(f.units>0?` - æ¯${f.units}ä¸ªå•å…ƒæ±‡æ€»`:" - æ±‡æ€»å…¨éƒ¨")+" ",1),f.align?(c(),p("span",Nu,"(æŒ‰ç« èŠ‚å¯¹é½)")):T("",!0)]))),128))])]),e("div",ju,[e("p",null,[i[74]||(i[74]=ie("å½“å‰é…ç½®ï¼šæ¯ ",-1)),e("strong",null,_(ve.value),1),i[75]||(i[75]=ie(" é¡µä¸€æ‰¹",-1))])])])):T("",!0),n.value==="embedding"?(c(),p("div",Fu,[i[84]||(i[84]=e("p",{class:"settings-hint"},"Embeddingï¼ˆå‘é‡åŒ–æ¨¡å‹ï¼‰ç”¨äºå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢å’Œé—®ç­”åŠŸèƒ½ã€‚",-1)),e("div",Qu,[i[77]||(i[77]=e("label",null,"æœåŠ¡å•†",-1)),pe(Ae,{modelValue:we.value,"onUpdate:modelValue":i[27]||(i[27]=f=>we.value=f),options:wt,onChange:Nt},null,8,["modelValue"])]),e("div",Hu,[i[78]||(i[78]=e("label",null,"API Key",-1)),O(e("input",{"onUpdate:modelValue":i[28]||(i[28]=f=>xe.value=f),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[Y,xe.value]])]),e("div",Ju,[i[80]||(i[80]=e("label",null,"æ¨¡å‹",-1)),e("div",Gu,[O(e("input",{"onUpdate:modelValue":i[29]||(i[29]=f=>Ce.value=f),type:"text",placeholder:"ä¾‹å¦‚: text-embedding-3-small"},null,512),[[Y,Ce.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:F.value,onClick:i[30]||(i[30]=f=>ne("embedding"))},_(F.value?"è·å–ä¸­...":"ğŸ” è·å–æ¨¡å‹"),9,Zu)]),q.value&&z.value.length>0?(c(),p("div",Wu,[e("select",{class:"model-select",value:Ce.value,onChange:i[31]||(i[31]=f=>Ke("embedding",f.target.value))},[i[79]||(i[79]=e("option",{value:""},"-- é€‰æ‹©æ¨¡å‹ --",-1)),(c(!0),p(W,null,oe(z.value,f=>(c(),p("option",{key:f.id,value:f.id},_(f.name||f.id),9,Yu))),128))],40,Xu),e("span",ec,"å…± "+_(z.value.length)+" ä¸ªæ¨¡å‹",1)])):T("",!0)]),Rt.value?(c(),p("div",tc,[i[81]||(i[81]=e("label",null,"Base URL",-1)),O(e("input",{"onUpdate:modelValue":i[32]||(i[32]=f=>Ee.value=f),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[Y,Ee.value]])])):T("",!0),e("div",sc,[i[82]||(i[82]=e("label",null,"RPM é™åˆ¶",-1)),O(e("input",{"onUpdate:modelValue":i[33]||(i[33]=f=>je.value=f),type:"number",min:"0",max:"1000"},null,512),[[Y,je.value,void 0,{number:!0}]]),i[83]||(i[83]=e("p",{class:"form-hint"},"æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°ï¼Œ0 è¡¨ç¤ºä¸é™åˆ¶",-1))]),e("button",{class:"btn btn-secondary",disabled:r.value,onClick:w},_(r.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,nc)])):T("",!0),n.value==="reranker"?(c(),p("div",lc,[i[92]||(i[92]=e("p",{class:"settings-hint"},"Rerankerï¼ˆé‡æ’åºæ¨¡å‹ï¼‰ç”¨äºå¯¹æœç´¢ç»“æœè¿›è¡Œé‡æ–°æ’åºï¼Œæé«˜é—®ç­”å‡†ç¡®æ€§ã€‚",-1)),e("div",ac,[i[85]||(i[85]=e("label",null,"æœåŠ¡å•†",-1)),pe(Ae,{modelValue:Le.value,"onUpdate:modelValue":i[34]||(i[34]=f=>Le.value=f),options:xt,onChange:jt},null,8,["modelValue"])]),e("div",oc,[i[86]||(i[86]=e("label",null,"API Key",-1)),O(e("input",{"onUpdate:modelValue":i[35]||(i[35]=f=>Ve.value=f),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[Y,Ve.value]])]),e("div",rc,[i[88]||(i[88]=e("label",null,"æ¨¡å‹",-1)),e("div",ic,[O(e("input",{"onUpdate:modelValue":i[36]||(i[36]=f=>Se.value=f),type:"text",placeholder:"ä¾‹å¦‚: jina-reranker-v2-base-multilingual"},null,512),[[Y,Se.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:u.value,onClick:i[37]||(i[37]=f=>ne("reranker"))},_(u.value?"è·å–ä¸­...":"ğŸ” è·å–æ¨¡å‹"),9,uc)]),N.value&&B.value.length>0?(c(),p("div",cc,[e("select",{class:"model-select",value:Se.value,onChange:i[38]||(i[38]=f=>Ke("reranker",f.target.value))},[i[87]||(i[87]=e("option",{value:""},"-- é€‰æ‹©æ¨¡å‹ --",-1)),(c(!0),p(W,null,oe(B.value,f=>(c(),p("option",{key:f.id,value:f.id},_(f.name||f.id),9,pc))),128))],40,dc),e("span",vc,"å…± "+_(B.value.length)+" ä¸ªæ¨¡å‹",1)])):T("",!0)]),zt.value?(c(),p("div",mc,[i[89]||(i[89]=e("label",null,"Base URL",-1)),O(e("input",{"onUpdate:modelValue":i[39]||(i[39]=f=>qe.value=f),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[Y,qe.value]])])):T("",!0),e("div",gc,[i[90]||(i[90]=e("label",null,"Top K",-1)),O(e("input",{"onUpdate:modelValue":i[40]||(i[40]=f=>Fe.value=f),type:"number",min:"1",max:"20"},null,512),[[Y,Fe.value,void 0,{number:!0}]]),i[91]||(i[91]=e("p",{class:"form-hint"},"é‡æ’åºåè¿”å›çš„ç»“æœæ•°é‡",-1))]),e("button",{class:"btn btn-secondary",disabled:r.value,onClick:H},_(r.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,hc)])):T("",!0),n.value==="prompts"?(c(),p("div",fc,[i[96]||(i[96]=e("p",{class:"settings-hint"},"è‡ªå®šä¹‰åˆ†æè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æç¤ºè¯æ¨¡æ¿ã€‚",-1)),e("div",bc,[i[93]||(i[93]=e("label",null,"æç¤ºè¯ç±»å‹",-1)),pe(Ae,{modelValue:ge.value,"onUpdate:modelValue":i[41]||(i[41]=f=>ge.value=f),options:St,onChange:ut},null,8,["modelValue"]),e("p",kc,_(os[ge.value]?.hint),1)]),e("div",yc,[i[94]||(i[94]=e("label",null,"æç¤ºè¯å†…å®¹",-1)),O(e("textarea",{"onUpdate:modelValue":i[42]||(i[42]=f=>ce.value=f),class:"prompt-editor",rows:"12",placeholder:"è¾“å…¥æç¤ºè¯å†…å®¹..."},null,512),[[Y,ce.value]])]),e("div",{class:"prompt-actions-bar"},[e("button",{class:"btn btn-secondary btn-sm",onClick:Re,title:"é‡ç½®ä¸ºé»˜è®¤"}," ğŸ”„ é‡ç½® "),e("button",{class:"btn btn-secondary btn-sm",onClick:le,title:"å¤åˆ¶åˆ°å‰ªè´´æ¿"}," ğŸ“‹ å¤åˆ¶ "),e("button",{class:"btn btn-primary btn-sm",onClick:Rs,title:"ä¿å­˜åˆ°åº“"}," ğŸ’¾ ä¿å­˜åˆ°åº“ ")]),i[97]||(i[97]=e("hr",{class:"section-divider"},null,-1)),e("div",_c,[e("div",$c,[i[95]||(i[95]=e("h4",null,"ğŸ“š æç¤ºè¯åº“",-1)),e("div",wc,[e("button",{class:"btn btn-secondary btn-sm",onClick:Ms,title:"å¯¼å‡ºæ‰€æœ‰æç¤ºè¯"}," ğŸ“¤ å¯¼å‡º "),e("button",{class:"btn btn-secondary btn-sm",onClick:Es,title:"å¯¼å…¥æç¤ºè¯"}," ğŸ“¥ å¯¼å…¥ "),e("input",{id:"promptsFileInput",type:"file",accept:".json",style:{display:"none"},onChange:Vs},null,32)])]),e("div",xc,[lt.value?(c(),p("div",Cc,"åŠ è½½ä¸­...")):ye.value.length===0?(c(),p("div",Sc," æš‚æ— ä¿å­˜çš„æç¤ºè¯ ")):(c(!0),p(W,{key:2},oe(ye.value,f=>(c(),p("div",{key:f.id,class:"saved-prompt-item",onClick:J=>zs(f)},[e("span",Ic,_(f.name),1),e("span",Tc,_(os[f.type]?.label||f.type),1),e("button",{class:"btn-icon-sm",onClick:Pe(J=>Us(f.id),["stop"]),title:"åˆ é™¤"}," ğŸ—‘ï¸ ",8,Ac)],8,Pc))),128))])])])):T("",!0)]),_:1}))}}),Rc={class:"modal chapter-select-modal show"},zc={class:"modal-content"},Uc={class:"modal-body"},Mc={class:"chapters-list"},Ec=["onClick"],Vc={class:"chapter-info"},qc={class:"chapter-title"},Kc={key:0,class:"chapter-pages"},Oc={key:0,class:"check-icon"},Dc={class:"modal-footer"},Nc=["disabled"],jc=Me({__name:"ChapterSelectModal",props:{chapters:{}},emits:["close","select"],setup(a,{emit:t}){const l=t,s=k("");function n(h){s.value=h}function o(){s.value&&l("select",s.value)}function r(){l("close")}return(h,m)=>(c(),p("div",Rc,[e("div",{class:"modal-overlay",onClick:r}),e("div",zc,[e("div",{class:"modal-header"},[m[0]||(m[0]=e("h2",null,"ğŸ“– é€‰æ‹©ç« èŠ‚",-1)),e("button",{class:"modal-close",onClick:r},"Ã—")]),e("div",Uc,[m[1]||(m[1]=e("p",{class:"hint-text"},"è¯·é€‰æ‹©è¦ç¿»è¯‘çš„ç« èŠ‚ï¼š",-1)),e("div",Mc,[(c(!0),p(W,null,oe(a.chapters,y=>(c(),p("div",{key:y.id,class:G(["chapter-item",{selected:s.value===y.id}]),onClick:C=>n(y.id)},[e("div",Vc,[e("span",qc,_(y.title),1),y.startPage&&y.endPage?(c(),p("span",Kc," ç¬¬ "+_(y.startPage)+"-"+_(y.endPage)+" é¡µ ",1)):T("",!0)]),s.value===y.id?(c(),p("span",Oc,"âœ“")):T("",!0)],10,Ec))),128))])]),e("div",Dc,[e("button",{class:"btn btn-secondary",onClick:r},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:!s.value,onClick:o}," ç¡®å®š ",8,Nc)])])]))}}),Fc=Oe(jc,[["__scopeId","data-v-5f4c62c9"]]),Qc={class:"insight-page"},Hc={class:"app-header"},Jc={class:"header-content"},Gc={class:"logo-container"},Zc={class:"header-links"},Wc={class:"insight-main"},Xc={class:"sidebar-section book-info-section"},Yc={class:"book-cover-wrapper"},ed=["src"],td={key:1,class:"book-cover-placeholder"},sd=["title"],nd={class:"book-meta"},ld={class:"meta-item"},ad={id:"totalPages"},od={class:"meta-item"},rd={id:"analyzedPages"},id={class:"insight-content"},ud={key:0,class:"select-book-prompt"},cd={key:1,class:"content-tabs"},dd={class:"tabs-wrapper"},pd={class:"tab-content"},vd={class:"tab-content"},md={class:"tab-content"},gd=Me({__name:"InsightView",setup(a){const t=js(),l=Hs(),s=Ne(),n=ms(),o=k("overview"),r=k(!1),h=k(!1),m=k(!1);let y=null;const C=k(null),z=k(!1),B=U(()=>C.value?C.value:s.currentBookId?n.books.find(I=>I.id===s.currentBookId):null),M=U(()=>!!s.currentBookId),R=U(()=>B.value?.cover?B.value.cover:"");function q(I){o.value=I}async function N(I){if(I){s.setCurrentBook(I),s.setLoading(!0);try{const se=await(await fetch(`/api/bookshelf/books/${I}`)).json();if(!se.success)throw new Error(se.error||"è·å–ä¹¦ç±ä¿¡æ¯å¤±è´¥");if(se.book&&(C.value={id:se.book.id,title:se.book.title,cover:se.book.cover,total_pages:se.book.total_pages||0},s.setBookTotalPages(se.book.total_pages||0),se.book.chapters&&se.book.chapters.length>0)){let ae=0;const ve=se.book.chapters.map((Ie,ke)=>{const He=Ie.id||Ie.chapter_id||`ch_${ke+1}`,ue=Ie.page_count||Ie.pages?.length||0,we=ae+1,xe=ae+ue;return ae=xe,{id:He,title:Ie.title||`ç¬¬ ${ke+1} ç« `,startPage:we,endPage:xe}});s.setChapters(ve)}if(await j(),s.chapters.length===0)try{const ae=await ln(I);ae.success&&ae.chapters&&ae.chapters.length>0&&s.setChapters(ae.chapters.map(ve=>({id:ve.id,title:ve.title,startPage:ve.start_page,endPage:ve.end_page})))}catch(ae){console.warn("è·å–ç« èŠ‚åˆ—è¡¨å¤±è´¥:",ae)}await s.loadNotesFromAPI(),s.analyzedPageCount>0&&await u(),l.replace({query:{book:I}}),s.isAnalyzing&&Q()}catch(L){console.error("åŠ è½½ä¹¦ç±å¤±è´¥:",L),s.setError(L instanceof Error?L.message:"åŠ è½½ä¹¦ç±å¤±è´¥")}finally{s.setLoading(!1)}}}async function j(){if(s.currentBookId)try{const I=await gs(s.currentBookId);if(I.success)if(I.analyzed_pages_count!==void 0&&s.setAnalyzedPagesCount(I.analyzed_pages_count),I.current_task){const L=I.current_task.status;L==="running"?(s.setAnalysisStatus("running"),I.current_task.progress&&s.updateProgress(I.current_task.progress.analyzed_pages||0,I.current_task.progress.total_pages||0)):L==="paused"?s.setAnalysisStatus("paused"):L==="completed"?s.setAnalysisStatus("completed"):L==="failed"?s.setAnalysisStatus("failed"):s.setAnalysisStatus("idle")}else I.analyzed?s.setAnalysisStatus("completed"):s.setAnalysisStatus("idle")}catch(I){console.error("è·å–åˆ†æçŠ¶æ€å¤±è´¥:",I)}}function Q(){F(),y=setInterval(async()=>{await j();const I=s.analysisStatus;(I==="completed"||I==="failed"||I==="idle")&&(F(),I==="completed"&&(console.log("åˆ†æå®Œæˆï¼Œè‡ªåŠ¨åˆ·æ–°æ¦‚è§ˆæ•°æ®"),await u(),await j()))},3e3)}function F(){y&&(clearInterval(y),y=null)}async function u(){if(s.currentBookId)try{const I=await ks(s.currentBookId);let L="story_summary";I.success&&I.generated&&I.generated.length>0&&(L=I.generated[0],s.setGeneratedTemplates(I.generated));try{const ae=await bs(s.currentBookId,L);ae.success&&ae.content&&s.setOverview({type:L,content:ae.content})}catch(ae){console.warn("åŠ è½½æ¦‚è§ˆå¤±è´¥:",ae)}const se=await ys(s.currentBookId);se.success&&s.setTimeline(se)}catch(I){console.error("åŠ è½½æ¦‚è§ˆæ•°æ®å¤±è´¥:",I)}}function P(){r.value=!0}function v(){Gs("ğŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}function g(){r.value=!1}function x(){h.value=!h.value,h.value&&(m.value=!1)}function A(){m.value=!m.value,m.value&&(h.value=!1)}function V(){if(!s.currentBookId){l.push("/translate");return}const I=s.chapters;!I||I.length===0?l.push({path:"/translate",query:{book:s.currentBookId}}):I.length===1?l.push({path:"/translate",query:{book:s.currentBookId,chapter:I[0].id}}):z.value=!0}function K(I){z.value=!1,l.push({path:"/translate",query:{book:s.currentBookId,chapter:I}})}function te(){z.value=!1}let E="",$="",S="";return nt(async()=>{const I=document.body.style;E=I.padding,$=I.margin,S=I.overflow,I.padding="0",I.margin="0",I.overflow="hidden",await n.fetchBooks();const L=t.query.book;L&&await N(L)}),Fs(()=>{F();const I=document.body.style;I.padding=E,I.margin=$,I.overflow=S}),st(()=>s.isAnalyzing,I=>{I?Q():F()}),(I,L)=>{const se=Qs("router-link");return c(),p("div",Qc,[e("header",Hc,[e("div",Jc,[e("div",Gc,[pe(se,{to:"/",title:"ä¹¦æ¶é¦–é¡µ"},{default:ft(()=>[...L[3]||(L[3]=[e("img",{src:"/pic/logo.png",alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",Zc,[pe(se,{to:"/",class:"nav-link"},{default:ft(()=>[...L[4]||(L[4]=[ie("ğŸ“š ä¹¦æ¶",-1)])]),_:1}),e("a",{href:"javascript:void(0)",class:"nav-link",onClick:V},"ğŸŒ ç¿»è¯‘"),L[6]||(L[6]=e("span",{class:"nav-link active"},"ğŸ” åˆ†æ",-1)),L[7]||(L[7]=e("a",{href:"https://www.mashirosaber.top/use/manga-insight.html",target:"_blank",class:"nav-link",title:"ä½¿ç”¨æ•™ç¨‹"},"ğŸ“– æ•™ç¨‹",-1)),e("button",{id:"settingsBtn",class:"btn btn-icon",title:"è®¾ç½®",onClick:P},"âš™ï¸"),e("button",{id:"themeToggle",class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:v},[...L[5]||(L[5]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("main",Wc,[e("aside",{class:G(["insight-sidebar",{"mobile-visible":h.value}])},[e("div",Xc,[e("div",Yc,[R.value?(c(),p("img",{key:0,src:R.value,alt:"å°é¢",class:"book-cover"},null,8,ed)):(c(),p("div",td,[...L[8]||(L[8]=[e("span",null,"ğŸ“–",-1)])]))]),e("h2",{class:"book-title",title:B.value?.title},_(B.value?.title||"é€‰æ‹©ä¹¦ç±"),9,sd),e("div",nd,[e("span",ld,[L[9]||(L[9]=e("span",{class:"meta-icon"},"ğŸ“„",-1)),e("span",ad,_(B.value?.total_pages||0),1),L[10]||(L[10]=ie(" é¡µ ",-1))]),e("span",od,[L[11]||(L[11]=e("span",{class:"meta-icon"},"ğŸ“Š",-1)),e("span",rd,_($e(s).analyzedPageCount),1),L[12]||(L[12]=ie(" å·²åˆ†æ ",-1))])])]),M.value?(c(),et(Hn,{key:0,onStartPolling:Q,onStopPolling:F})):T("",!0),M.value?(c(),et(Fi,{key:1})):T("",!0)],2),e("div",id,[M.value?(c(),p("div",cd,[e("button",{class:"mobile-nav-btn",onClick:x,"aria-label":"æ‰“å¼€å¯¼èˆª"}," ğŸ“š "),e("div",dd,[e("button",{class:G(["tab-btn",{active:o.value==="overview"}]),onClick:L[0]||(L[0]=ae=>q("overview"))},[...L[16]||(L[16]=[e("span",{class:"tab-icon"},"ğŸ“Š",-1),ie(" æ¦‚è§ˆ ",-1)])],2),e("button",{class:G(["tab-btn",{active:o.value==="qa"}]),onClick:L[1]||(L[1]=ae=>q("qa"))},[...L[17]||(L[17]=[e("span",{class:"tab-icon"},"ğŸ’¬",-1),ie(" æ™ºèƒ½é—®ç­” ",-1)])],2),e("button",{class:G(["tab-btn",{active:o.value==="timeline"}]),onClick:L[2]||(L[2]=ae=>q("timeline"))},[...L[18]||(L[18]=[e("span",{class:"tab-icon"},"ğŸ“ˆ",-1),ie(" æ—¶é—´çº¿ ",-1)])],2)]),e("button",{class:"mobile-nav-btn",onClick:A,"aria-label":"æ‰“å¼€ç¬”è®°"}," ğŸ“ ")])):(c(),p("div",ud,[L[13]||(L[13]=e("div",{class:"prompt-icon"},"ğŸ“š",-1)),L[14]||(L[14]=e("h2",null,"é€‰æ‹©è¦åˆ†æçš„ä¹¦ç±",-1)),L[15]||(L[15]=e("p",null,"ä»ä¸‹æ–¹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€æœ¬ä¹¦ç±å¼€å§‹æ™ºèƒ½åˆ†æ",-1)),pe($n,{onSelect:N})])),O(e("div",pd,[pe(aa)],512),[[Ft,o.value==="overview"&&M.value]]),O(e("div",vd,[pe(Xo)],512),[[Ft,o.value==="qa"&&M.value]]),O(e("div",md,[pe(uo)],512),[[Ft,o.value==="timeline"&&M.value]])]),M.value?(c(),p("aside",{key:0,class:G(["insight-workspace",{"mobile-visible":m.value}])},[pe(xi),pe(Nr)],2)):T("",!0)]),r.value?(c(),et(Bc,{key:0,onClose:g})):T("",!0),z.value&&$e(s).currentBookId?(c(),et(Fc,{key:1,chapters:$e(s).chapters,onSelect:K,onClose:te},null,8,["chapters"])):T("",!0)])}}}),Cd=Oe(gd,[["__scopeId","data-v-753e6087"]]);export{Cd as default};
