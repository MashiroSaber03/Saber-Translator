const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/system.B9lB2QDm.js","js/index.BFW997V4.js","js/vue-vendor.DIYfje1l.js","assets/index.BYanE9pL.css","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js","js/session.Kpy-QhBa.js"])))=>i.map(i=>d[i]);
import{D as nn,b as ao,c as lo,d as io,e as sn,a as lt,S as Bo,_ as qe,f as Ue,s as be,u as rt,g as Gn,h as Yn,i as Ao,j as Lo,k as Fo,l as Uo,B as Oo,m as zo,n as Xn,F as Qt,o as No,p as Vo,q as Zn,L as Wo,W as Qn}from"./index.BFW997V4.js";import{d as Ut,r as _,c as K,a as He,e as A,h as ge,f as e,t as oe,i as ot,k as P,g as st,n as Te,u as pe,o as ut,v as ne,x as Fe,l as xe,s as Ko,m as yt,K as tt,D as V,F as Ae,j as Je,M as ro,N as es,L as an,w as Ce,B as dt,O as Ct,z as Se,p as et,P as no,b as Pt,Q as xt,S as qo,A as ln,U as ts,T as rn,C as os}from"./vue-vendor.DIYfje1l.js";import{p as ns,a as ss,b as as,c as ls,d as is,e as rs,f as us,h as cs,i as ds,j as gs,k as uo,l as un}from"./system.B9lB2QDm.js";import{getFontList as cn,uploadFont as ps,getTextboxPrompts as ms,getPrompts as vs,configApi as We,getFontListApi as fs}from"./config.CwRcCkM9.js";import{_ as Ne}from"./CustomSelect.vue_vue_type_style_index_0_lang.BbTiIb--.js";import{apiClient as Ze}from"./client.Bht704G-.js";import{B as dn}from"./BaseModal.DHlRgdSx.js";import{getBookDetail as bs}from"./bookshelf.B4ums9uK.js";import"./utils-vendor.B9ygI19o.js";function Ho(){return{firecrawl:{apiKey:""},agent:{provider:"openai",apiKey:"",customBaseUrl:"",modelName:"gpt-4o-mini",useStream:!1,forceJsonOutput:!0,maxRetries:3,timeout:120},extraction:{prompt:nn,maxIterations:10},download:{concurrency:3,timeout:30,retries:3,delay:100,useReferer:!0},imagePreprocess:{enabled:!1,autoRotate:!0,compression:{enabled:!1,quality:85,maxWidth:0,maxHeight:0},formatConvert:{enabled:!1,targetFormat:"original"}},advanced:{customCookie:"",customHeaders:"",bypassProxy:!1},ui:{showAgentLogs:!0,autoImport:!1}}}function hs(s,t){function n(b){s.value.firecrawl.apiKey=b,t()}function o(b){s.value.agent.provider=b,t()}function l(b){s.value.agent.apiKey=b,t()}function i(b){s.value.agent.customBaseUrl=b,t()}function a(b){s.value.agent.modelName=b,t()}function r(b){s.value.agent.useStream=b,t()}function h(b){s.value.agent.forceJsonOutput=b,t()}function T(b){s.value.agent.timeout=b,t()}function S(b){s.value.extraction.prompt=b,t()}function M(b){s.value.extraction.maxIterations=b,t()}function L(){s.value.extraction.prompt=nn,t()}function D(b){s.value.download.concurrency=b,t()}function U(b){s.value.download.timeout=b,t()}function w(b){s.value.download.retries=b,t()}function W(b){s.value.download.delay=b,t()}function q(b){s.value.download.useReferer=b,t()}function O(b){s.value.imagePreprocess.enabled=b,t()}function f(b){s.value.imagePreprocess.autoRotate=b,t()}function c(b){s.value.imagePreprocess.compression.enabled=b,t()}function k(b){s.value.imagePreprocess.compression.quality=b,t()}function C(b){s.value.imagePreprocess.compression.maxWidth=b,t()}function N(b){s.value.imagePreprocess.compression.maxHeight=b,t()}function Y(b){s.value.imagePreprocess.formatConvert.enabled=b,t()}function ie(b){s.value.imagePreprocess.formatConvert.targetFormat=b,t()}function X(b){s.value.advanced.customCookie=b,t()}function ae(b){s.value.advanced.customHeaders=b,t()}function Z(b){s.value.advanced.bypassProxy=b,t()}function d(b){s.value.ui.showAgentLogs=b,t()}function m(b){s.value.ui.autoImport=b,t()}function x(b){s.value={...s.value,...b},t()}return{setFirecrawlApiKey:n,setAgentProvider:o,setAgentApiKey:l,setAgentBaseUrl:i,setAgentModelName:a,setAgentUseStream:r,setAgentForceJson:h,setAgentTimeout:T,setExtractionPrompt:S,setExtractionMaxIterations:M,resetExtractionPrompt:L,setDownloadConcurrency:D,setDownloadTimeout:U,setDownloadRetries:w,setDownloadDelay:W,setDownloadUseReferer:q,setImagePreprocessEnabled:O,setImageAutoRotate:f,setImageCompressionEnabled:c,setImageCompressionQuality:k,setImageMaxWidth:C,setImageMaxHeight:N,setImageFormatConvertEnabled:Y,setImageTargetFormat:ie,setCustomCookie:X,setCustomHeaders:ae,setBypassProxy:Z,setShowAgentLogs:d,setAutoImport:m,updateWebImportSettings:x}}async function co(s){return Ze.post("/api/re_render_image",s)}async function ys(s){try{return{success:!0,data:await Ze.post("/api/translate_single_text",s)}}catch(t){return{success:!1,error:t instanceof Error?t.message:"ç¿»è¯‘å¤±è´¥"}}}async function Rt(s){return Ze.post("/api/hq_translate_batch",s)}async function so(s,t,n){return Ze.post("/api/detect_boxes",{image:s,detector_type:t,...n})}async function gn(s,t,n,o){return Ze.post("/api/ocr_single_bubble",{image_data:s,bubble_coords:t,ocr_engine:n,...o})}async function go(s,t,n){return Ze.post("/api/inpaint_single_bubble",{image_data:s,bubble_coords:t,bubble_angle:n?.bubbleAngle??0,method:n?.method??"lama",lama_model:n?.lamaModel??"lama_mpe",...n?.maskData&&{mask_data:n.maskData}})}const xs=Object.freeze(Object.defineProperty({__proto__:null,detectBoxes:so,hqTranslateBatch:Rt,inpaintSingleBubble:go,ocrSingleBubble:gn,reRenderImage:co,translateSingleText:ys},Symbol.toStringTag,{value:"Module"}));async function _s(){return Ze.get("/api/plugins")}async function Cs(s){const t=encodeURIComponent(s);return Ze.post(`/api/plugins/${t}/enable`)}async function ks(s){const t=encodeURIComponent(s);return Ze.post(`/api/plugins/${t}/disable`)}async function Ss(s){const t=encodeURIComponent(s);return Ze.delete(`/api/plugins/${t}`)}async function ws(s){const t=encodeURIComponent(s);return Ze.get(`/api/plugins/${t}/config_schema`)}async function $s(s){const t=encodeURIComponent(s);return Ze.get(`/api/plugins/${t}/config`)}async function Ts(s,t){const n=encodeURIComponent(s);return Ze.post(`/api/plugins/${n}/config`,t)}async function Is(){return Ze.get("/api/plugins/default_states")}async function Rs(s,t){const n=encodeURIComponent(s);return Ze.post(`/api/plugins/${n}/set_default_state`,{enabled:t})}async function Ds(){return{states:(await Is()).default_states}}const Ps=Rs,Ms=ws,Es=$s,Bs=Ts;function As(){return`img_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function jo(s,t,n){return{id:As(),fileName:s,originalDataURL:t,translatedDataURL:null,cleanImageData:null,bubbleStates:null,translationStatus:"pending",translationFailed:!1,fontSize:25,autoFontSize:!1,fontFamily:"fonts/STSONG.TTF",layoutDirection:"auto",textColor:"#000000",fillColor:sn,inpaintMethod:"solid",strokeEnabled:io,strokeColor:lo,strokeWidth:ao,hasUnsavedChanges:!1,...n}}const Qe=Ut("image",()=>{const s=_([]),t=_(-1),n=_(!1),o=K(()=>t.value>=0&&t.value<s.value.length?s.value[t.value]??null:null),l=K(()=>s.value.length),i=K(()=>s.value.length>0),a=K(()=>t.value>0),r=K(()=>t.value<s.value.length-1),h=K(()=>s.value.filter(b=>b.translationFailed).length),T=K(()=>s.value.filter(b=>b.translationStatus==="completed").length),S=K(()=>s.value.filter(b=>b.translationStatus==="pending").length);function M(b,p,g){const E=jo(b,p,g);return s.value.push(E),s.value.length===1&&(t.value=0),console.log(`å›¾ç‰‡å·²æ·»åŠ : ${b}ï¼Œå½“å‰å…± ${s.value.length} å¼ å›¾ç‰‡`),E}function L(b){const p=b.map(({fileName:E,originalDataURL:H,overrides:I})=>jo(E,H,I)),g=s.value.length===0;return s.value.push(...p),g&&s.value.length>0&&(t.value=0),console.log(`æ‰¹é‡æ·»åŠ äº† ${p.length} å¼ å›¾ç‰‡ï¼Œå½“å‰å…± ${s.value.length} å¼ `),p}function D(b){s.value=b.map(p=>({...p,strokeEnabled:p.strokeEnabled??io,strokeColor:p.strokeColor||lo,strokeWidth:p.strokeWidth??ao,hasUnsavedChanges:p.hasUnsavedChanges||!1})),s.value.length>0?t.value=Math.min(Math.max(0,t.value),s.value.length-1):t.value=-1,console.log(`å›¾ç‰‡æ•°ç»„å·²è®¾ç½®ï¼Œå…± ${s.value.length} å¼ å›¾ç‰‡`)}function U(b){return b<0||b>=s.value.length?(console.warn(`åˆ é™¤å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${b}`),!1):(s.value.splice(b,1),t.value===b?(t.value=Math.min(b,s.value.length-1),s.value.length===0&&(t.value=-1)):t.value>b&&t.value--,console.log(`å›¾ç‰‡å·²åˆ é™¤ï¼Œå½“å‰å…± ${s.value.length} å¼ å›¾ç‰‡`),!0)}function w(){return U(t.value)}function W(){s.value=[],t.value=-1,n.value=!1,console.log("æ‰€æœ‰å›¾ç‰‡å·²æ¸…é™¤")}function q(){const b=o.value?.id||null;if(s.value.sort((p,g)=>p.fileName.localeCompare(g.fileName,void 0,{numeric:!0,sensitivity:"base"})),b){const p=s.value.findIndex(g=>g.id===b);p>=0&&p!==t.value&&(console.log(`å›¾ç‰‡æ’åº: currentImageIndex ä» ${t.value} æ›´æ–°ä¸º ${p}`),t.value=p)}console.log("å›¾ç‰‡å·²æŒ‰æ–‡ä»¶åæ’åº")}function O(b){b>=-1&&b<s.value.length?(t.value=b,console.log(`å½“å‰å›¾ç‰‡ç´¢å¼•å·²è®¾ç½®ä¸º ${b}`)):console.warn(`è®¾ç½®ç´¢å¼•å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${b}`)}function f(){return a.value?(t.value--,!0):!1}function c(){return r.value?(t.value++,!0):!1}function k(b){o.value?(Object.assign(o.value,b),console.log("å½“å‰å›¾ç‰‡å±æ€§å·²æ›´æ–°:",Object.keys(b))):console.warn("æ›´æ–°å¤±è´¥: å½“å‰æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡")}function C(b,p){if(b>=0&&b<s.value.length){const g=s.value[b];g&&(Object.assign(g,p),console.log(`å›¾ç‰‡ ${b} å±æ€§å·²æ›´æ–°:`,Object.keys(p)))}else console.warn(`æ›´æ–°å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${b}`)}function N(b){o.value&&(o.value.bubbleStates=b,o.value.hasUnsavedChanges=!0,console.log(`å½“å‰å›¾ç‰‡æ°”æ³¡çŠ¶æ€å·²æ›´æ–°ï¼Œå…± ${b?.length??0} ä¸ªæ°”æ³¡`))}function Y(b){o.value&&(o.value.isManuallyAnnotated=b,o.value.hasUnsavedChanges=!0,console.log(`æ‰‹åŠ¨æ ‡æ³¨æ ‡è®°å·²è®¾ç½®ä¸º: ${b}`))}function ie(b,p){o.value?(o.value[b]=p,o.value.hasUnsavedChanges=!0,console.log(`å½“å‰å›¾ç‰‡å±æ€§ ${String(b)} å·²æ›´æ–°`)):console.warn("æ›´æ–°å¤±è´¥: å½“å‰æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡")}function X(b,p){o.value&&(o.value.translatedDataURL=b,p&&(o.value.cleanImageData=p),o.value.translationStatus="completed",o.value.translationFailed=!1,o.value.hasUnsavedChanges=!0,console.log("å½“å‰å›¾ç‰‡ç¿»è¯‘ç»“æœå·²æ›´æ–°"))}function ae(b,p,g){if(b>=0&&b<s.value.length){const E=s.value[b];E&&(E.translationStatus=p,E.translationFailed=p==="failed",g&&(E.errorMessage=g),console.log(`å›¾ç‰‡ ${b} ç¿»è¯‘çŠ¶æ€: ${p}`))}}function Z(b){o.value&&(o.value.translationStatus="failed",o.value.translationFailed=!0,o.value.errorMessage=b,console.log(`å½“å‰å›¾ç‰‡ç¿»è¯‘å¤±è´¥: ${b}`))}function d(){s.value.forEach(b=>{b.translationStatus="pending",b.translationFailed=!1,b.errorMessage=void 0}),console.log("æ‰€æœ‰å›¾ç‰‡ç¿»è¯‘çŠ¶æ€å·²é‡ç½®")}function m(b){n.value=b,console.log(`æ‰¹é‡ç¿»è¯‘çŠ¶æ€: ${b?"è¿›è¡Œä¸­":"å·²å®Œæˆ"}`)}function x(){return s.value.map((b,p)=>b.translationFailed?p:-1).filter(b=>b!==-1)}return{images:s,currentImageIndex:t,isBatchTranslationInProgress:n,currentImage:o,imageCount:l,hasImages:i,canGoPrevious:a,canGoNext:r,failedImageCount:h,completedImageCount:T,pendingImageCount:S,addImage:M,addImages:L,setImages:D,deleteImage:U,deleteCurrentImage:w,clearImages:W,sortImagesByFileName:q,setCurrentImageIndex:O,goToPrevious:f,goToNext:c,updateCurrentImage:k,updateImageByIndex:C,updateCurrentBubbleStates:N,setManuallyAnnotated:Y,updateCurrentImageProperty:ie,updateCurrentTranslationResult:X,setTranslationStatus:ae,markCurrentAsFailed:Z,resetAllTranslationStatus:d,setBatchTranslationInProgress:m,getFailedImageIndices:x}}),Jo=Object.freeze(Object.defineProperty({__proto__:null,useImageStore:Qe},Symbol.toStringTag,{value:"Module"})),pn=Ut("session",()=>{const s=_(null),t=_({bookId:null,chapterId:null,bookTitle:null,chapterTitle:null}),n=_([]),o=_(!1),l=_({current:0,total:0,message:""}),i=_(null),a=_(!1),r=K(()=>t.value.bookId!==null&&t.value.chapterId!==null),h=K(()=>t.value.bookId),T=K(()=>t.value.chapterId);function S(d,m,x=null,b=null){t.value={bookId:d,chapterId:m,bookTitle:x,chapterTitle:b},console.log(`ä¼šè¯ä¸Šä¸‹æ–‡å·²è®¾ç½®: ä¹¦ç±=${d}, ç« èŠ‚=${m}`)}function M(d,m,x,b){S(d,m,x,b)}function L(){t.value={bookId:null,chapterId:null,bookTitle:null,chapterTitle:null},console.log("ä¼šè¯ä¸Šä¸‹æ–‡å·²æ¸…é™¤")}function D(d){const m=d.get("book"),x=d.get("chapter");m&&x&&S(m,x)}function U(d){s.value=d,console.log(`å½“å‰ä¼šè¯åç§°: ${d}`)}function w(){s.value=null}function W(d){n.value=d,console.log(`ä¼šè¯åˆ—è¡¨å·²æ›´æ–°ï¼Œå…± ${d.length} ä¸ªä¼šè¯`)}function q(d){const m=n.value.findIndex(x=>x.name===d.name);m>=0?n.value[m]=d:n.value.unshift(d)}function O(d){const m=n.value.findIndex(x=>x.name===d);m>=0&&n.value.splice(m,1)}function f(d,m){const x=n.value.find(b=>b.name===d);x&&(x.name=m)}function c(d){o.value=d}function k(d){a.value=d}function C(d){i.value=d}function N(d,m,x,b){return{name:d,version:"2.0",savedAt:new Date().toISOString(),imageCount:m.length,ui_settings:b,images:m.map(p=>({originalDataURL:p.originalDataURL,translatedDataURL:p.translatedDataURL||void 0,cleanImageData:p.cleanImageData||void 0,bubbleStates:p.bubbleStates||void 0,isManuallyAnnotated:p.isManuallyAnnotated||void 0,relativePath:p.relativePath||void 0,folderPath:p.folderPath||void 0,fileName:p.fileName,fontSize:p.fontSize,autoFontSize:p.autoFontSize,fontFamily:p.fontFamily,layoutDirection:p.layoutDirection,userLayoutDirection:p.userLayoutDirection,useAutoTextColor:p.useAutoTextColor,textColor:p.textColor,fillColor:p.fillColor,inpaintMethod:p.inpaintMethod,strokeEnabled:p.strokeEnabled,strokeColor:p.strokeColor,strokeWidth:p.strokeWidth,translationStatus:p.translationStatus,translationFailed:p.translationFailed})),currentImageIndex:x}}function Y(){s.value=null,t.value={bookId:null,chapterId:null,bookTitle:null,chapterTitle:null},n.value=[],o.value=!1,a.value=!1,i.value=null,console.log("ä¼šè¯çŠ¶æ€å·²é‡ç½®")}async function ie(d){if(!d||typeof d!="string")return null;if(d.startsWith("data:"))return d;if(!d.startsWith("/api/"))return null;try{const m=await fetch(d);if(!m.ok)return null;const x=await m.blob();return new Promise(b=>{const p=new FileReader;p.onloadend=()=>b(p.result),p.onerror=()=>b(null),p.readAsDataURL(x)})}catch(m){return console.error(`è½¬æ¢å›¾ç‰‡ URL å¤±è´¥: ${d}`,m),null}}async function X(d,m){const x=d.length;for(let b=0;b<x;b++){const p=d[b];if(p){if(m&&m(b+1,x),p.originalDataURL&&p.originalDataURL.startsWith("/api/")){const g=await ie(p.originalDataURL);g&&(p.originalDataURL=g)}if(p.translatedDataURL&&p.translatedDataURL.startsWith("/api/")){const g=await ie(p.translatedDataURL);g&&(p.translatedDataURL=g)}if(p.cleanImageData&&p.cleanImageData.startsWith("/api/")){const g=await ie(p.cleanImageData);g&&(p.cleanImageData=g.replace(/^data:image\/\w+;base64,/,""))}}}}async function ae(d){c(!0),C(null),l.value={current:0,total:0,message:"æ­£åœ¨åŠ è½½..."};try{const{useImageStore:m}=await lt(async()=>{const{useImageStore:v}=await Promise.resolve().then(()=>Jo);return{useImageStore:v}},void 0),{useSettingsStore:x}=await lt(async()=>{const{useSettingsStore:v}=await import("./system.B9lB2QDm.js").then(B=>B.s);return{useSettingsStore:v}},__vite__mapDeps([0,1,2,3,4,5])),{useBubbleStore:b}=await lt(async()=>{const{useBubbleStore:v}=await Promise.resolve().then(()=>El);return{useBubbleStore:v}},void 0),p=m(),g=x(),E=b(),{loadSessionByPathApi:H}=await lt(async()=>{const{loadSessionByPathApi:v}=await import("./session.Kpy-QhBa.js");return{loadSessionByPathApi:v}},__vite__mapDeps([6,4,5])),I=await H(d);if(!I.success||!I.session)throw new Error(I.error||"åŠ è½½ä¼šè¯å¤±è´¥");const $=I.session;if($.images&&$.images.length>0){const v=$.images.map((y,ue)=>({id:`session-${ue}-${Date.now()}`,originalDataURL:y.originalDataURL,translatedDataURL:y.translatedDataURL||null,cleanImageData:y.cleanImageData||null,bubbleStates:y.bubbleStates!==void 0&&y.bubbleStates!==null?y.bubbleStates:null,isManuallyAnnotated:!!y.isManuallyAnnotated,relativePath:y.relativePath||void 0,folderPath:y.folderPath||void 0,fileName:y.fileName||`image-${ue+1}.png`,translationStatus:y.translationStatus||"pending",translationFailed:!!y.translationFailed,hasUnsavedChanges:!1,fontSize:y.fontSize||24,autoFontSize:y.autoFontSize??!1,fontFamily:y.fontFamily||"Microsoft YaHei",layoutDirection:y.layoutDirection||"auto",userLayoutDirection:y.userLayoutDirection||void 0,useAutoTextColor:y.useAutoTextColor??void 0,textColor:y.textColor||"#000000",fillColor:y.fillColor||"#FFFFFF",inpaintMethod:y.inpaintMethod||"litelama",strokeEnabled:y.strokeEnabled??!1,strokeColor:y.strokeColor||"#FFFFFF",strokeWidth:y.strokeWidth||2}));v.length>0&&(console.log("æ­£åœ¨åŠ è½½å›¾ç‰‡..."),l.value={current:0,total:v.length,message:"æ­£åœ¨åŠ è½½å›¾ç‰‡..."},await X(v,(y,ue)=>{const F=y/ue*100;l.value={current:y,total:ue,message:`åŠ è½½å›¾ç‰‡ ${y}/${ue}...`},console.log(`åŠ è½½å›¾ç‰‡ ${y}/${ue}... (${F.toFixed(0)}%)`)}),l.value={current:v.length,total:v.length,message:"åŠ è½½å®Œæˆ"},console.log("å›¾ç‰‡åŠ è½½å®Œæˆï¼Œå·²è½¬æ¢ä¸º Base64"),setTimeout(()=>{l.value={current:0,total:0,message:""}},500)),p.setImages(v);let B=0;typeof $.currentImageIndex=="number"&&(B=$.currentImageIndex,(B>=v.length||B<0)&&(B=v.length>0?0:-1)),p.setCurrentImageIndex(B);const u=v[B];u&&u.bubbleStates&&u.bubbleStates.length>0?E.setBubbles(u.bubbleStates,!0):E.clearBubblesLocal(),console.log(`æŒ‰è·¯å¾„åŠ è½½ä¼šè¯æˆåŠŸ: ${d}, å…± ${v.length} å¼ å›¾ç‰‡`)}const R=$.ui_settings;if(R){(R.targetLanguage||R.sourceLanguage)&&g.updateSettings({targetLanguage:R.targetLanguage||void 0,sourceLanguage:R.sourceLanguage||void 0});const v=R.useInpaintingMethod,u=["solid","lama_mpe","litelama"].includes(v)?v:g.settings.textStyle.inpaintMethod;g.updateTextStyle({fontSize:R.fontSize||g.settings.textStyle.fontSize,autoFontSize:R.autoFontSize??g.settings.textStyle.autoFontSize,fontFamily:R.fontFamily||g.settings.textStyle.fontFamily,layoutDirection:R.layoutDirection||g.settings.textStyle.layoutDirection,textColor:R.textColor||g.settings.textStyle.textColor,fillColor:R.fillColor||g.settings.textStyle.fillColor,inpaintMethod:u,strokeEnabled:R.strokeEnabled??g.settings.textStyle.strokeEnabled,strokeColor:R.strokeColor||g.settings.textStyle.strokeColor,strokeWidth:R.strokeWidth||g.settings.textStyle.strokeWidth}),console.log("UI è®¾ç½®å·²æ¢å¤")}return U(d),!0}catch(m){const x=m instanceof Error?m.message:"åŠ è½½ä¼šè¯å¤±è´¥";throw C(x),console.error(`æŒ‰è·¯å¾„åŠ è½½ä¼šè¯å¤±è´¥: ${d}`,m),m}finally{c(!1)}}async function Z(d,m){if(!d||!m)return console.log("æœªåœ¨ä¹¦ç±/ç« èŠ‚æ¨¡å¼ï¼Œä¸æ”¯æŒä¿å­˜"),!1;console.log(`ä¿å­˜ç« èŠ‚ä¼šè¯ï¼ˆåˆ†æ‰¹ï¼‰: book=${d}, chapter=${m}`);const{useImageStore:x}=await lt(async()=>{const{useImageStore:I}=await Promise.resolve().then(()=>Jo);return{useImageStore:I}},void 0),{useSettingsStore:b}=await lt(async()=>{const{useSettingsStore:I}=await import("./system.B9lB2QDm.js").then($=>$.s);return{useSettingsStore:I}},__vite__mapDeps([0,1,2,3,4,5])),p=x(),g=b(),E=Array.isArray(p.images)?p.images:[];if(!E||E.length===0)return console.log("æ²¡æœ‰å›¾ç‰‡æ•°æ®å¯ä¿å­˜"),!1;const H=`bookshelf/${d}/${m}`;k(!0),C(null),l.value={current:0,total:100,message:"å‡†å¤‡ä¿å­˜..."};try{const{batchSaveStartApi:I,batchSaveImageApi:$,batchSaveCompleteApi:R}=await lt(async()=>{const{batchSaveStartApi:z,batchSaveImageApi:te,batchSaveCompleteApi:ee}=await import("./session.Kpy-QhBa.js");return{batchSaveStartApi:z,batchSaveImageApi:te,batchSaveCompleteApi:ee}},__vite__mapDeps([6,4,5])),v=E.length;E.some(z=>z.originalDataURL&&z.originalDataURL.startsWith("/api/")||z.translatedDataURL&&z.translatedDataURL.startsWith("/api/")||z.cleanImageData&&z.cleanImageData.startsWith("/api/"))&&(console.log("[saveChapterSession] æ£€æµ‹åˆ° /api/ URL æ ¼å¼å›¾ç‰‡ï¼Œå¼€å§‹è½¬æ¢ä¸º Base64..."),l.value={current:2,total:100,message:"è½¬æ¢å›¾ç‰‡æ ¼å¼..."},await X(E,(z,te)=>{const ee=2+z/te*3;l.value={current:Math.round(ee),total:100,message:`è½¬æ¢å›¾ç‰‡ ${z}/${te}...`}}),console.log("[saveChapterSession] å›¾ç‰‡æ ¼å¼è½¬æ¢å®Œæˆ")),l.value={current:5,total:100,message:"æ”¶é›†å…ƒæ•°æ®..."};const{textStyle:u,targetLanguage:y,sourceLanguage:ue}=g.settings,F={targetLanguage:y,sourceLanguage:ue,fontSize:u.fontSize,autoFontSize:u.autoFontSize,fontFamily:u.fontFamily,layoutDirection:u.layoutDirection,textColor:u.textColor,useInpaintingMethod:u.inpaintMethod,fillColor:u.fillColor,strokeEnabled:u.strokeEnabled,strokeColor:u.strokeColor,strokeWidth:u.strokeWidth},j=E.map(z=>{const te={};for(const ee of Object.keys(z))ee!=="originalDataURL"&&ee!=="translatedDataURL"&&ee!=="cleanImageData"&&(te[ee]=z[ee]);return te.hasOriginalData=!!z.originalDataURL,te.hasTranslatedData=!!z.translatedDataURL,te.hasCleanData=!!z.cleanImageData,te}),le={ui_settings:F,images_meta:j,currentImageIndex:p.currentImageIndex};l.value={current:10,total:100,message:"åˆå§‹åŒ–ä¿å­˜..."};const _e=await I(H,le);if(!_e.success)throw new Error(_e.error||"åˆå§‹åŒ–ä¿å­˜å¤±è´¥");const $e=_e.session_folder;if(!$e)throw new Error("æœªè·å–åˆ°ä¼šè¯æ–‡ä»¶å¤¹è·¯å¾„");console.log(`ä¼šè¯æ–‡ä»¶å¤¹: ${$e}`);let Ee=0,Me=0;const se=z=>!!z&&typeof z=="string"&&z.startsWith("data:");for(let z=0;z<v;z++){const te=E[z];if(!te)continue;const ee=10+z/v*80;if(l.value={current:Math.round(ee),total:100,message:`ä¿å­˜å›¾ç‰‡ ${z+1}/${v}...`},se(te.originalDataURL))try{const ce=await $($e,z,"original",te.originalDataURL);ce.success||(console.error(`ä¿å­˜å›¾ç‰‡ ${z} original å¤±è´¥:`,ce.error),Me++)}catch(ce){console.error(`ä¿å­˜å›¾ç‰‡ ${z} original å‡ºé”™:`,ce),Me++}if(se(te.translatedDataURL))try{const ce=await $($e,z,"translated",te.translatedDataURL);ce.success||(console.error(`ä¿å­˜å›¾ç‰‡ ${z} translated å¤±è´¥:`,ce.error),Me++)}catch(ce){console.error(`ä¿å­˜å›¾ç‰‡ ${z} translated å‡ºé”™:`,ce),Me++}if(te.cleanImageData&&typeof te.cleanImageData=="string"&&!te.cleanImageData.startsWith("/api/"))try{const ce=await $($e,z,"clean",te.cleanImageData);ce.success||(console.error(`ä¿å­˜å›¾ç‰‡ ${z} clean å¤±è´¥:`,ce.error),Me++)}catch(ce){console.error(`ä¿å­˜å›¾ç‰‡ ${z} clean å‡ºé”™:`,ce),Me++}Ee++}l.value={current:95,total:100,message:"å®Œæˆä¿å­˜..."};const J=await R($e,j);if(!J.success)throw new Error(J.error||"å®Œæˆä¿å­˜å¤±è´¥");return l.value={current:100,total:100,message:"ä¿å­˜å®Œæˆ"},console.log(`åˆ†æ‰¹ä¿å­˜å®Œæˆ: ${Ee} å¼ å›¾ç‰‡, ${Me} ä¸ªå¤±è´¥`),setTimeout(()=>{l.value={current:0,total:0,message:""}},1e3),!0}catch(I){const $=I instanceof Error?I.message:"ä¿å­˜ç« èŠ‚ä¼šè¯å¤±è´¥";return C($),console.error("åˆ†æ‰¹ä¿å­˜å¤±è´¥:",I),l.value={current:0,total:0,message:""},!1}finally{k(!1)}}return{currentSessionName:s,context:t,sessionList:n,isLoading:o,isSaving:a,error:i,loadingProgress:l,isBookshelfMode:r,currentBookId:h,currentChapterId:T,setContext:S,clearContext:L,parseContextFromUrl:D,setSessionName:U,clearSessionName:w,setSessionList:W,addToSessionList:q,removeFromSessionList:O,renameInSessionList:f,setLoading:c,setSaving:k,setError:C,createSessionData:N,imageUrlToBase64:ie,saveChapterSession:Z,loadSessionByPath:ae,setBookChapterContext:M,reset:Y}}),Mt={originalText:"",translatedText:"",textboxText:"",coords:[0,0,100,100],polygon:[],fontSize:25,fontFamily:"fonts/STSONG.TTF",textDirection:"vertical",autoTextDirection:"vertical",textColor:"#000000",fillColor:sn,rotationAngle:0,position:{x:0,y:0},strokeEnabled:io,strokeColor:lo,strokeWidth:ao,inpaintMethod:"solid",autoFgColor:null,autoBgColor:null,colorConfidence:0};function Ls(s){return{...{...Mt,...s},coords:s?.coords?[...s.coords]:[...Mt.coords],polygon:s?.polygon?s.polygon.map(n=>[...n]):[],position:s?.position?{...Mt.position,...s.position}:{...Mt.position}}}function Fs(s){const[t,n,o,l]=s,i=Math.abs(o-t);return Math.abs(l-n)>i?"vertical":"horizontal"}function Et(s){return s.map(t=>({...t,coords:[...t.coords],polygon:t.polygon?t.polygon.map(n=>[...n]):[],position:{...t.position},autoFgColor:t.autoFgColor?[...t.autoFgColor]:null,autoBgColor:t.autoBgColor?[...t.autoBgColor]:null}))}function Us(s){if(!s||typeof s!="object")return!1;const t=s;if(!Array.isArray(t.coords)||t.coords.length!==4||!t.coords.every(l=>typeof l=="number"&&!isNaN(l))||typeof t.fontSize!="number"||t.fontSize<=0)return!1;const n=["vertical","horizontal","auto"];if(typeof t.textDirection!="string"||!n.includes(t.textDirection))return!1;const o=["solid","lama_mpe","litelama"];return!(typeof t.inpaintMethod!="string"||!o.includes(t.inpaintMethod))}function Os(s){let t=s,n=0,o=0,l=Date.now();const i=()=>t<=0?0:Math.ceil(6e4/t);return{async acquire(){if(t<=0)return;const a=Date.now(),r=i();if(a-l>=6e4&&(l=a,o=0),o>=t){const T=6e4-(a-l);T>0&&await Go(T),l=Date.now(),o=0}const h=a-n;h<r&&await Go(r-h),n=Date.now(),o++},reset(){n=0,o=0,l=Date.now()},getRpm(){return t},setRpm(a){t=a,this.reset()}}}function Go(s){return new Promise(t=>setTimeout(t,s))}function Yo(s){const t=s.replace(/\\/g,"/"),n=[],o=/(\d+)/g;let l=0,i;for(;(i=o.exec(t))!==null;){if(i.index>l){const a=t.slice(l,i.index);a&&n.push([!0,a.toLowerCase()])}n.push([!1,parseInt(i[0],10)]),l=o.lastIndex}if(l<t.length){const a=t.slice(l);a&&n.push([!0,a.toLowerCase()])}return n}function zs(s,t){const n=Yo(s),o=Yo(t),l=Math.min(n.length,o.length);for(let i=0;i<l;i++){const[a,r]=n[i],[h,T]=o[i];if(a!==h)return a?1:-1;if(r<T)return-1;if(r>T)return 1}return n.length-o.length}function Ns(s,t=n=>String(n)){return[...s].sort((n,o)=>zs(t(n),t(o)))}const Xo="webImportDisclaimerAccepted",po=Ut("webImport",()=>{const s=_(Ho()),t=_("idle"),n=_(""),o=_([]),l=_(null),i=_(new Set),a=_({current:0,total:0}),r=_([]),h=_(null),T=_(!1),S=_(!1),M=_(!1),L=K(()=>t.value==="extracting"),D=K(()=>t.value==="downloading"),U=K(()=>L.value||D.value),w=K(()=>i.value.size),W=K(()=>a.value.total===0?0:Math.round(a.value.current/a.value.total*100));function q(){try{localStorage.setItem(Bo,JSON.stringify(s.value))}catch($){console.error("ä¿å­˜ç½‘é¡µå¯¼å…¥è®¾ç½®å¤±è´¥:",$)}}function O(){try{const $=localStorage.getItem(Bo);if($){const R=JSON.parse($);s.value=f(Ho(),R)}}catch($){console.error("åŠ è½½ç½‘é¡µå¯¼å…¥è®¾ç½®å¤±è´¥:",$)}}function f($,R){const v={...$};for(const B in R)if(Object.prototype.hasOwnProperty.call(R,B)){const u=R[B],y=$[B];u!==null&&typeof u=="object"&&!Array.isArray(u)&&y!==null&&typeof y=="object"&&!Array.isArray(y)?v[B]=f(y,u):u!==void 0&&(v[B]=u)}return v}function c(){S.value?T.value=!0:M.value=!0}function k(){S.value=!0,M.value=!1,T.value=!0;try{localStorage.setItem(Xo,"true")}catch($){console.error("ä¿å­˜å…è´£å£°æ˜çŠ¶æ€å¤±è´¥:",$)}}function C(){M.value=!1}function N(){try{const $=localStorage.getItem(Xo);S.value=$==="true"}catch($){console.error("åŠ è½½å…è´£å£°æ˜çŠ¶æ€å¤±è´¥:",$)}}function Y(){T.value=!1}function ie(){t.value="idle",n.value="",o.value=[],l.value=null,i.value=new Set,a.value={current:0,total:0},r.value=[],h.value=null}function X($){n.value=$}function ae($){o.value.push($)}function Z(){o.value=[]}function d($){l.value&&l.value.pages.length>0?(l.value.comicTitle=$.comicTitle,l.value.chapterTitle=$.chapterTitle,l.value.totalPages=$.totalPages,l.value.sourceUrl=$.sourceUrl,l.value.referer=$.referer,l.value.engine=$.engine,l.value.success=$.success,l.value.error=$.error):(l.value=$,$.success&&$.pages&&(i.value=new Set($.pages.map(R=>R.pageNumber))))}function m($){i.value.has($)?i.value.delete($):i.value.add($),i.value=new Set(i.value)}function x(){l.value?.pages&&(i.value.size===l.value.pages.length?i.value=new Set:i.value=new Set(l.value.pages.map($=>$.pageNumber)))}function b($){t.value=$}function p($){h.value=$,$&&(t.value="error")}function g($,R){a.value={current:$,total:R}}function E($){r.value=$}function H($){l.value||(l.value={success:!0,comicTitle:"",chapterTitle:"",pages:[],totalPages:0,sourceUrl:n.value,referer:"",engine:"gallery-dl"}),l.value.pages.push($),l.value.totalPages=l.value.pages.length,i.value.add($.pageNumber),i.value=new Set(i.value)}const I=hs(s,q);return O(),N(),{settings:s,status:t,url:n,logs:o,extractResult:l,selectedPages:i,downloadProgress:a,downloadedImages:r,error:h,modalVisible:T,disclaimerAccepted:S,disclaimerVisible:M,isExtracting:L,isDownloading:D,isProcessing:U,selectedCount:w,downloadProgressPercent:W,saveToStorage:q,loadFromStorage:O,openModal:c,closeModal:Y,resetState:ie,setUrl:X,addLog:ae,clearLogs:Z,setExtractResult:d,togglePageSelection:m,toggleSelectAll:x,setStatus:b,setError:p,updateDownloadProgress:g,setDownloadedImages:E,addPageIncremental:H,acceptDisclaimer:k,rejectDisclaimer:C,...I}}),Vs={key:0,class:"translation-progress-bar"},Ws={class:"progress-bar-label"},Ks={class:"progress-bar"},qs=He({__name:"ProgressBar",props:{visible:{type:Boolean,default:!0},percentage:{},label:{default:"è¿›åº¦"}},setup(s){return(t,n)=>s.visible?(P(),A("div",Vs,[e("div",Ws,oe(s.label),1),e("div",Ks,[e("div",{class:"progress",style:ot({width:`${s.percentage}%`})},null,4)])])):ge("",!0)}}),mo=qe(qs,[["__scopeId","data-v-f915cadf"]]),Hs={class:"image-upload"},js={class:"error-text"},Js={key:2,class:"loading-overlay"},Gs=He({__name:"ImageUpload",emits:["uploadComplete"],setup(s,{expose:t,emit:n}){const o=n,l=Qe(),i=Ue(),a=po(),r=_(null),h=_(null),T=_(!1),S=_(!1),M=_(""),L=_(0),D=_(""),U=_(!1),w=K(()=>i.settings.pdfProcessingMethod);function W(){r.value?.click()}function q(){a.openModal()}function O(){h.value?.click()}async function f(p){const g=p.target;if(!g.files||g.files.length===0)return;const H=Array.from(g.files).filter($=>$.type.startsWith("image/"));if(H.length===0){be("æ‰€é€‰æ–‡ä»¶å¤¹ä¸­æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶","warning"),g.value="";return}const I=Ns(H,$=>$.webkitRelativePath);console.log(`ä»æ–‡ä»¶å¤¹å¯¼å…¥ ${I.length} å¼ å›¾ç‰‡`),await c(I),g.value=""}async function c(p){if(p.length!==0){T.value=!0,U.value=!0,L.value=0;try{let g=0;const E=p.length;for(let H=0;H<p.length;H++){const I=p[H];if(!I||!I.type.startsWith("image/"))continue;D.value=I.name;const $=I.webkitRelativePath||"",R=$.includes("/")?$.substring(0,$.lastIndexOf("/")):"";await new Promise((v,B)=>{const u=new FileReader;u.onload=y=>{const ue=y.target?.result;l.addImage(I.name,ue,{relativePath:$,folderPath:R}),v()},u.onerror=()=>B(new Error(`è¯»å–å›¾ç‰‡å¤±è´¥: ${I.name}`)),u.readAsDataURL(I)}),g++,L.value=Math.round((H+1)/E*100)}g>0&&(be(`å·²æ·»åŠ  ${g} å¼ å›¾ç‰‡`,"success"),o("uploadComplete",g))}catch(g){console.error("å¤„ç†æ–‡ä»¶å¤±è´¥:",g);const E=g instanceof Error?g.message:"å¤„ç†æ–‡ä»¶å¤±è´¥";be(E,"error")}finally{T.value=!1,U.value=!1}}}async function k(p){const g=p.target;!g.files||g.files.length===0||(await ie(Array.from(g.files)),g.value="")}async function C(p){p.preventDefault(),S.value=!1,!(!p.dataTransfer?.files||p.dataTransfer.files.length===0)&&await ie(Array.from(p.dataTransfer.files))}function N(p){p.preventDefault(),S.value=!0}function Y(p){const g=p.currentTarget.getBoundingClientRect(),E=p.clientX,H=p.clientY;(E<g.left||E>g.right||H<g.top||H>g.bottom)&&(S.value=!1)}async function ie(p){if(p.length!==0){T.value=!0,M.value="",U.value=!0,L.value=0;try{let g=0;const E=p.length;for(let H=0;H<p.length;H++){const I=p[H];if(!I)continue;D.value=I.name;const $=I.type,R=I.name.toLowerCase();if($.startsWith("image/"))await X(I),g++;else if($==="application/pdf"||R.endsWith(".pdf")){const v=await ae(I);g+=v}else if(R.endsWith(".mobi")||R.endsWith(".azw")||R.endsWith(".azw3")){const v=await x(I);g+=v}else console.warn(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${I.name}`),be(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${I.name}`,"warning");L.value=Math.round((H+1)/E*100)}g>0&&(be(`å·²æ·»åŠ  ${g} å¼ å›¾ç‰‡`,"success"),o("uploadComplete",g))}catch(g){console.error("å¤„ç†æ–‡ä»¶å¤±è´¥:",g);const E=g instanceof Error?g.message:"å¤„ç†æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•";M.value=E,be(E,"error")}finally{T.value=!1,U.value=!1,D.value=""}}}async function X(p){return new Promise((g,E)=>{const H=new FileReader;H.onload=I=>{const $=I.target?.result;l.addImage(p.name,$),g()},H.onerror=()=>E(new Error(`è¯»å–å›¾ç‰‡æ–‡ä»¶å¤±è´¥: ${p.name}`)),H.readAsDataURL(p)})}async function ae(p){return w.value==="frontend"?await d(p):await m(p)}function Z(p){return new Promise((g,E)=>{const H=new FileReader;H.onload=()=>g(H.result),H.onerror=E,H.readAsDataURL(p)})}async function d(p){try{const g=await lt(()=>import("./pdf.U7tdldy2.js").then(v=>v.p),[]);g.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${g.version}/pdf.worker.min.js`;const E=await p.arrayBuffer(),H=await g.getDocument({data:E}).promise,I=H.numPages;console.log(`PDF ${p.name} å…± ${I} é¡µï¼Œå¼€å§‹æœ¬åœ°æ¸²æŸ“...`),be(`æ­£åœ¨è§£æ PDFï¼Œå…± ${I} é¡µ...`,"info");const $=typeof OffscreenCanvas<"u";$&&console.log("ä½¿ç”¨ OffscreenCanvas åå°æ¸²æŸ“æ¨¡å¼");let R=0;for(let v=1;v<=I;v++){D.value=`${p.name} - ç¬¬ ${v}/${I} é¡µ`,L.value=Math.round(v/I*100);try{const B=await H.getPage(v),y=B.getViewport({scale:2});let ue;if($){const j=new OffscreenCanvas(y.width,y.height),le=j.getContext("2d");await B.render({canvasContext:le,viewport:y}).promise;const _e=await j.convertToBlob({type:"image/jpeg",quality:1});ue=await Z(_e)}else{const j=document.createElement("canvas"),le=j.getContext("2d");j.width=y.width,j.height=y.height,await B.render({canvasContext:le,viewport:y}).promise,ue=j.toDataURL("image/jpeg",1)}const F=`${p.name}_é¡µé¢${v}`;l.addImage(F,ue),R++,console.log(`  é¡µé¢ ${v}/${I} å¤„ç†å®Œæˆ`)}catch(B){console.warn(`PDF ${p.name} ç¬¬ ${v} é¡µæ¸²æŸ“å¤±è´¥:`,B)}}return console.log(`PDF ${p.name} å…¨éƒ¨ ${I} é¡µå¤„ç†å®Œæˆ`),R}catch(g){return console.error("å‰ç«¯ PDF è§£æå¤±è´¥:",g),be("å‰ç«¯ PDF è§£æå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨åç«¯è§£æ...","warning"),await m(p)}}async function m(p){let E=null;try{be("æ­£åœ¨ä¸Šä¼  PDF æ–‡ä»¶...","info");const H=await ns(p,5);if(!H.success||!H.session_id)throw new Error(H.error||"PDF è§£æå¯åŠ¨å¤±è´¥");E=H.session_id;const I=H.total_pages||0;console.log(`PDF ${p.name} å…± ${I} é¡µï¼Œå¼€å§‹åç«¯åˆ†æ‰¹è§£æ...`),be(`æ­£åœ¨è§£æ PDFï¼Œå…± ${I} é¡µ...`,"info");let $=0;for(let R=0;R<I;R+=5){D.value=`${p.name} - å¤„ç†ä¸­ ${Math.min(R+5,I)}/${I} é¡µ`,L.value=I>0?Math.round(R/I*100):0;const v=await ss(E,R,5);if(!v.success){console.warn(`æ‰¹æ¬¡ ${R} è·å–å¤±è´¥:`,v.error);continue}if(v.images&&v.images.length>0)for(const B of v.images){if(!B||!B.data_url)continue;const u=`${p.name}_é¡µé¢${String(B.page_index+1).padStart(4,"0")}`;l.addImage(u,B.data_url),$++}console.log(`  å·²åŠ è½½ ${$}/${I} é¡µ`)}return console.log(`PDF ${p.name} å…¨éƒ¨ ${$} é¡µå¤„ç†å®Œæˆ`),$}catch(H){throw console.error("åç«¯ PDF è§£æå¤±è´¥:",H),H}finally{if(E)try{await as(E)}catch(H){console.warn("PDF ä¼šè¯æ¸…ç†å¤±è´¥:",H)}}}async function x(p){let g=null;try{be("æ­£åœ¨ä¸Šä¼ ç”µå­ä¹¦æ–‡ä»¶...","info");const E=await ls(p,5);if(!E.success||!E.session_id)throw new Error(E.error||"MOBI/AZW è§£æå¯åŠ¨å¤±è´¥");g=E.session_id;const H=E.total_images||0;be(`æ­£åœ¨è§£æç”µå­ä¹¦ï¼Œå…± ${H} å¼ å›¾ç‰‡...`,"info");let I=0,$=!0;for(;$;){D.value=`${p.name} - å·²å¤„ç† ${I}/${H} å¼ `,L.value=H>0?Math.round(I/H*100):0;const R=await is(g);if(!R.success)throw new Error(R.error||"MOBI/AZW æ‰¹æ¬¡è§£æå¤±è´¥");if(R.images&&R.images.length>0){for(let v=0;v<R.images.length;v++){const B=R.images[v];if(!B)continue;const u=I+v+1,y=`${p.name.replace(/\.(mobi|azw|azw3)$/i,"")}_image_${String(u).padStart(3,"0")}.png`,ue=B.startsWith("data:")?B:`data:image/png;base64,${B}`;l.addImage(y,ue)}I+=R.images.length}$=R.has_more??!1}return I}catch(E){throw console.error("MOBI/AZW è§£æå¤±è´¥:",E),E}finally{if(g)try{await rs(g)}catch(E){console.warn("MOBI/AZW ä¼šè¯æ¸…ç†å¤±è´¥:",E)}}}function b(){M.value=""}return t({triggerFileSelect:W,triggerFolderSelect:O,processFiles:ie,clearError:b}),(p,g)=>(P(),A("div",Hs,[e("div",{id:"drop-area",class:Te(["drop-area",{"drag-over":S.value,loading:T.value}]),onDragover:N,onDragleave:Y,onDrop:C},[e("div",{class:"drop-content"},[e("p",{class:"drop-text"},[g[0]||(g[0]=pe(" æ‹–æ‹½å›¾ç‰‡ã€PDFæˆ–MOBIæ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ– ",-1)),e("span",{class:"select-link",onClick:W}," é€‰æ‹©æ–‡ä»¶ "),g[1]||(g[1]=e("span",{class:"separator"}," | ",-1)),e("span",{class:"select-link folder-link",onClick:O}," ğŸ“ é€‰æ‹©æ–‡ä»¶å¤¹ "),g[2]||(g[2]=e("span",{class:"separator"}," | ",-1)),e("span",{class:"select-link web-import-link",onClick:q}," ğŸŒ ä»ç½‘é¡µå¯¼å…¥ ")])]),e("input",{ref_key:"fileInputRef",ref:r,type:"file",id:"imageUpload",accept:"image/*,application/pdf,.mobi,.azw,.azw3",multiple:"",class:"file-input",onChange:k},null,544),e("input",{ref_key:"folderInputRef",ref:h,type:"file",webkitdirectory:"",class:"file-input",onChange:f},null,544)],34),U.value?(P(),st(mo,{key:0,visible:!0,percentage:L.value,label:D.value||"å¤„ç†ä¸­..."},null,8,["percentage","label"])):ge("",!0),M.value?(P(),A("div",{key:1,class:"error-message",onClick:b},[g[3]||(g[3]=e("span",{class:"error-icon"},"âš ï¸",-1)),e("span",js,oe(M.value),1),g[4]||(g[4]=e("span",{class:"error-close"},"Ã—",-1))])):ge("",!0),T.value&&!U.value?(P(),A("div",Js,[...g[5]||(g[5]=[e("div",{class:"spinner"},null,-1),e("span",{class:"loading-text"},"å¤„ç†ä¸­...",-1)])])):ge("",!0)]))}}),Ys=qe(Gs,[["__scopeId","data-v-5ff3dc04"]]),Xs={id:"settings-sidebar",class:"settings-sidebar"},Zs={class:"card settings-card"},Qs={id:"font-settings",class:"settings-card collapsible-panel"},ea={class:"toggle-icon"},ta={class:"collapsible-content"},oa={class:"settings-form"},na={class:"form-group"},sa=["value","disabled","title"],aa={class:"auto-fontSize-option",title:"å‹¾é€‰åï¼Œé¦–æ¬¡ç¿»è¯‘æ—¶è‡ªåŠ¨ä¸ºæ¯ä¸ªæ°”æ³¡è®¡ç®—åˆé€‚çš„å­—å·"},la=["checked"],ia={class:"form-group"},ra={class:"form-group"},ua={class:"form-group"},ca={class:"color-with-auto"},da={class:"auto-color-toggle",title:"ç¿»è¯‘æ—¶è‡ªåŠ¨ä½¿ç”¨è¯†åˆ«åˆ°çš„æ–‡å­—é¢œè‰²"},ga=["checked"],pa=["value","disabled"],ma={key:0,class:"auto-color-hint"},va={class:"form-group"},fa={class:"checkbox-label"},ba=["checked"],ha={key:0,id:"strokeOptions",class:"stroke-options"},ya={class:"form-group"},xa=["value"],_a={class:"form-group"},Ca=["value"],ka={class:"form-group"},Sa={key:0,id:"solidColorOptions",class:"form-group"},wa=["value"],$a={class:"apply-settings-group"},Ta=["disabled"],Ia={key:0,class:"apply-options-dropdown"},Ra={class:"apply-option"},Da=["checked"],Pa={class:"apply-option"},Ma={class:"apply-option"},Ea={class:"apply-option"},Ba={class:"apply-option"},Aa={class:"apply-option"},La={class:"apply-option"},Fa={class:"apply-option"},Ua={class:"apply-option"},Oa={class:"action-buttons"},za=["disabled"],Na=["disabled"],Va=["disabled"],Wa=["disabled"],Ka=["disabled"],qa=["disabled"],Ha=["disabled"],ja=["disabled"],Ja={class:"navigation-buttons"},Ga=["disabled"],Ya=["disabled"],Xa=He({__name:"SettingsSidebar",emits:["translateCurrent","translateAll","hqTranslate","proofread","removeText","removeAllText","deleteCurrent","clearAll","cleanTemp","openPlugins","openSettings","previous","next","applyToAll","textStyleChanged","autoFontSizeChanged"],setup(s,{emit:t}){const n=t,o=Qe(),l=Ue(),i=_(!0),a=_(!1),r=_({fontSize:!0,fontFamily:!0,layoutDirection:!0,textColor:!0,fillColor:!0,strokeEnabled:!0,strokeColor:!0,strokeWidth:!0}),h=[{label:"è‡ªåŠ¨ (æ ¹æ®æ£€æµ‹)",value:"auto"},{label:"ç«–å‘æ’ç‰ˆ",value:"vertical"},{label:"æ¨ªå‘æ’ç‰ˆ",value:"horizontal"}],T=[{label:"çº¯è‰²å¡«å……",value:"solid"},{label:"LAMAä¿®å¤ (é€Ÿåº¦ä¼˜åŒ–)",value:"lama_mpe"},{label:"LAMAä¿®å¤ (é€šç”¨)",value:"litelama"}],S=K(()=>o.currentImage),M=K(()=>o.hasImages),L=K(()=>M.value&&!o.isBatchTranslationInProgress),D=K(()=>o.canGoPrevious),U=K(()=>o.canGoNext),w=K(()=>l.textStyle),W=_([]),q=["fonts/STSONG.TTF","fonts/msyh.ttc","fonts/simhei.ttf","fonts/simsun.ttc"],O=_(null),f=K(()=>{const R=W.value.map(v=>({label:ie(v),value:v}));return R.push({label:"è‡ªå®šä¹‰å­—ä½“...",value:"custom-font"}),R});ut(async()=>{await c();const R=w.value.fontFamily;R&&!W.value.includes(R)&&(W.value=[R,...W.value])});async function c(){try{const R=await cn();if(R.fonts&&Array.isArray(R.fonts)&&R.fonts.length>0){const v=R.fonts[0];if(typeof v=="object"&&"path"in v){const B=R.fonts.map(u=>typeof u=="object"?u.path:u);W.value=B}else W.value=R.fonts}else W.value=[...q]}catch(R){console.error("åŠ è½½å­—ä½“åˆ—è¡¨å¤±è´¥:",R),W.value=[...q]}}function k(){i.value=!i.value}function C(R){const v=parseInt(R.target.value);isNaN(v)||(l.updateTextStyle({fontSize:v}),n("textStyleChanged","fontSize",v))}function N(R){const v=R.target.checked;l.updateTextStyle({autoFontSize:v}),console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${v}`),n("autoFontSizeChanged",v)}async function Y(R){const v=R.target,B=v.files?.[0];if(!B)return;const u=[".ttf",".ttc",".otf"],y=B.name.toLowerCase();if(!u.some(F=>y.endsWith(F))){be("è¯·é€‰æ‹© .ttfã€.ttc æˆ– .otf æ ¼å¼çš„å­—ä½“æ–‡ä»¶","error"),v.value="";return}try{const F=await ps(B);F.success&&F.fontPath?(await c(),l.updateTextStyle({fontFamily:F.fontPath}),be("å­—ä½“ä¸Šä¼ æˆåŠŸ","success")):be(F.error||"å­—ä½“ä¸Šä¼ å¤±è´¥","error")}catch(F){console.error("å­—ä½“ä¸Šä¼ å¤±è´¥:",F),be("å­—ä½“ä¸Šä¼ å¤±è´¥","error")}finally{v.value=""}}function ie(R){const v={"fonts/STXINGKA.TTF":"åæ–‡è¡Œæ¥·","fonts/STXINWEI.TTF":"åæ–‡æ–°é­","fonts/STZHONGS.TTF":"åæ–‡ä¸­å®‹","fonts/STKAITI.TTF":"æ¥·ä½“","fonts/STLITI.TTF":"éš¶ä¹¦","fonts/STSONG.TTF":"åæ–‡å®‹ä½“","fonts/msyh.ttc":"å¾®è½¯é›…é»‘","fonts/msyhbd.ttc":"å¾®è½¯é›…é»‘ç²—ä½“","fonts/SIMYOU.TTF":"å¹¼åœ†","fonts/STFANGSO.TTF":"ä»¿å®‹","fonts/STHUPO.TTF":"åæ–‡ç¥ç€","fonts/STXIHEI.TTF":"åæ–‡ç»†é»‘","fonts/simkai.ttf":"ä¸­æ˜“æ¥·ä½“","fonts/simfang.ttf":"ä¸­æ˜“ä»¿å®‹","fonts/simhei.ttf":"ä¸­æ˜“é»‘ä½“","fonts/SIMLI.TTF":"ä¸­æ˜“éš¶ä¹¦","fonts/simsun.ttc":"å®‹ä½“"};if(v[R])return v[R];const B=R.split("/").pop()||R;for(const[u,y]of Object.entries(v))if((u.split("/").pop()||"").toLowerCase()===B.toLowerCase())return y;return B.replace(/\.(ttf|ttc|otf)$/i,"")}function X(R){const v=String(R);if(v==="custom-font"){O.value?.click();return}l.updateTextStyle({fontFamily:v}),n("textStyleChanged","fontFamily",v)}function ae(R){const v=String(R);l.updateTextStyle({layoutDirection:v}),n("textStyleChanged","layoutDirection",v)}function Z(R){const v=String(R);l.updateTextStyle({inpaintMethod:v})}function d(R){const v=R.target.value;l.updateTextStyle({textColor:v}),n("textStyleChanged","textColor",v)}function m(R){const v=R.target.checked;l.updateTextStyle({useAutoTextColor:v})}function x(R){const v=R.target.checked;l.updateTextStyle({strokeEnabled:v}),n("textStyleChanged","strokeEnabled",v)}function b(R){const v=R.target.value;l.updateTextStyle({strokeColor:v}),n("textStyleChanged","strokeColor",v)}function p(R){const v=parseInt(R.target.value);isNaN(v)||(l.updateTextStyle({strokeWidth:v}),n("textStyleChanged","strokeWidth",v))}function g(R){const v=R.target.value;l.updateTextStyle({fillColor:v}),n("textStyleChanged","fillColor",v)}function E(){a.value=!a.value}function H(){const v=!Object.values(r.value).every(B=>B);r.value={fontSize:v,fontFamily:v,layoutDirection:v,textColor:v,fillColor:v,strokeEnabled:v,strokeColor:v,strokeWidth:v}}function I(){n("applyToAll",{...r.value}),a.value=!1}function $(R){R.target.closest(".apply-settings-group")||(a.value=!1)}return typeof window<"u"&&window.addEventListener("click",$),(R,v)=>(P(),A("aside",Xs,[e("div",Zs,[v[43]||(v[43]=e("h2",null,"ç¿»è¯‘è®¾ç½®",-1)),e("div",Qs,[e("h3",{class:"collapsible-header",onClick:k},[v[20]||(v[20]=pe(" æ–‡å­—è®¾ç½® ",-1)),e("span",ea,oe(i.value?"â–¼":"â–¶"),1)]),ne(e("div",ta,[e("div",oa,[e("div",na,[v[22]||(v[22]=e("label",{for:"fontSize"},"å­—å·å¤§å°:",-1)),e("input",{type:"number",id:"fontSize",value:w.value.fontSize,min:"10",max:"100",disabled:w.value.autoFontSize,class:Te({"disabled-input":w.value.autoFontSize}),title:w.value.autoFontSize?"å·²å¯ç”¨è‡ªåŠ¨å­—å·ï¼Œé¦–æ¬¡ç¿»è¯‘æ—¶å°†è‡ªåŠ¨è®¡ç®—":"",onInput:C},null,42,sa),e("span",aa,[e("input",{type:"checkbox",id:"autoFontSize",checked:w.value.autoFontSize,onChange:N},null,40,la),v[21]||(v[21]=e("label",{for:"autoFontSize"},"è‡ªåŠ¨è®¡ç®—åˆå§‹å­—å·",-1))])]),e("div",ia,[v[23]||(v[23]=e("label",{for:"fontFamily"},"æ–‡æœ¬å­—ä½“:",-1)),xe(Ne,{"model-value":w.value.fontFamily,options:f.value,onChange:X},null,8,["model-value","options"]),e("input",{ref_key:"fontUploadInput",ref:O,type:"file",id:"fontUpload",accept:".ttf,.ttc,.otf",style:{display:"none"},onChange:Y},null,544)]),e("div",ra,[v[24]||(v[24]=e("label",{for:"layoutDirection"},"æ’ç‰ˆè®¾ç½®:",-1)),xe(Ne,{"model-value":w.value.layoutDirection,options:h,onChange:ae},null,8,["model-value"])]),e("div",ua,[v[26]||(v[26]=e("label",{for:"textColor"},"æ–‡å­—é¢œè‰²:",-1)),e("div",ca,[e("label",da,[e("input",{type:"checkbox",checked:w.value.useAutoTextColor,onChange:m},null,40,ga),v[25]||(v[25]=e("span",null,"è‡ªåŠ¨",-1))]),e("input",{type:"color",id:"textColor",value:w.value.textColor,disabled:w.value.useAutoTextColor,onInput:d},null,40,pa)]),w.value.useAutoTextColor?(P(),A("div",ma," ğŸ’¡ ç¿»è¯‘æ—¶å°†è‡ªåŠ¨ä½¿ç”¨è¯†åˆ«åˆ°çš„æ–‡å­—é¢œè‰² ")):ge("",!0)]),e("div",va,[e("span",fa,[e("input",{type:"checkbox",id:"strokeEnabled",checked:w.value.strokeEnabled,onChange:x},null,40,ba),v[27]||(v[27]=e("label",{for:"strokeEnabled"},"å¯ç”¨æ–‡æœ¬æè¾¹:",-1))])]),xe(Ko,{name:"stroke-slide"},{default:yt(()=>[w.value.strokeEnabled?(P(),A("div",ha,[e("div",ya,[v[28]||(v[28]=e("label",{for:"strokeColor"},"æè¾¹é¢œè‰²:",-1)),e("input",{type:"color",id:"strokeColor",value:w.value.strokeColor,onInput:b},null,40,xa)]),e("div",_a,[v[29]||(v[29]=e("label",{for:"strokeWidth"},"æè¾¹å®½åº¦ (px):",-1)),e("input",{type:"number",id:"strokeWidth",value:w.value.strokeWidth,min:"0",max:"10",style:{width:"60px",padding:"5px"},onInput:p},null,40,Ca),v[30]||(v[30]=e("div",{class:"input-hint"},"0 è¡¨ç¤ºæ— æè¾¹ã€‚",-1))])])):ge("",!0)]),_:1}),e("div",ka,[v[31]||(v[31]=e("label",{for:"useInpainting"},"æ°”æ³¡å¡«å……æ–¹å¼:",-1)),xe(Ne,{"model-value":w.value.inpaintMethod,options:T,onChange:Z},null,8,["model-value"])]),xe(Ko,{name:"slide-fade"},{default:yt(()=>[w.value.inpaintMethod==="solid"?(P(),A("div",Sa,[v[32]||(v[32]=e("label",{for:"fillColor"},"å¡«å……é¢œè‰²:",-1)),e("input",{type:"color",id:"fillColor",value:w.value.fillColor,onInput:g},null,40,wa)])):ge("",!0)]),_:1})]),e("div",$a,[e("button",{type:"button",class:"settings-button",disabled:!M.value,onClick:I}," åº”ç”¨åˆ°å…¨éƒ¨ ",8,Ta),e("button",{type:"button",class:"settings-gear-btn",title:"é€‰æ‹©è¦åº”ç”¨çš„å‚æ•°",onClick:E}," âš™ï¸ "),a.value?(P(),A("div",Ia,[e("div",Ra,[e("input",{type:"checkbox",id:"apply_selectAll",checked:Object.values(r.value).every(B=>B),onChange:H},null,40,Da),v[33]||(v[33]=e("label",{for:"apply_selectAll"},"å…¨é€‰",-1))]),v[42]||(v[42]=e("hr",null,null,-1)),e("div",Pa,[ne(e("input",{type:"checkbox",id:"apply_fontSize","onUpdate:modelValue":v[0]||(v[0]=B=>r.value.fontSize=B)},null,512),[[tt,r.value.fontSize]]),v[34]||(v[34]=e("label",{for:"apply_fontSize"},"å­—å·",-1))]),e("div",Ma,[ne(e("input",{type:"checkbox",id:"apply_fontFamily","onUpdate:modelValue":v[1]||(v[1]=B=>r.value.fontFamily=B)},null,512),[[tt,r.value.fontFamily]]),v[35]||(v[35]=e("label",{for:"apply_fontFamily"},"å­—ä½“",-1))]),e("div",Ea,[ne(e("input",{type:"checkbox",id:"apply_layoutDirection","onUpdate:modelValue":v[2]||(v[2]=B=>r.value.layoutDirection=B)},null,512),[[tt,r.value.layoutDirection]]),v[36]||(v[36]=e("label",{for:"apply_layoutDirection"},"æ’ç‰ˆæ–¹å‘",-1))]),e("div",Ba,[ne(e("input",{type:"checkbox",id:"apply_textColor","onUpdate:modelValue":v[3]||(v[3]=B=>r.value.textColor=B)},null,512),[[tt,r.value.textColor]]),v[37]||(v[37]=e("label",{for:"apply_textColor"},"æ–‡å­—é¢œè‰²",-1))]),e("div",Aa,[ne(e("input",{type:"checkbox",id:"apply_fillColor","onUpdate:modelValue":v[4]||(v[4]=B=>r.value.fillColor=B)},null,512),[[tt,r.value.fillColor]]),v[38]||(v[38]=e("label",{for:"apply_fillColor"},"å¡«å……é¢œè‰²",-1))]),e("div",La,[ne(e("input",{type:"checkbox",id:"apply_strokeEnabled","onUpdate:modelValue":v[5]||(v[5]=B=>r.value.strokeEnabled=B)},null,512),[[tt,r.value.strokeEnabled]]),v[39]||(v[39]=e("label",{for:"apply_strokeEnabled"},"æè¾¹å¼€å…³",-1))]),e("div",Fa,[ne(e("input",{type:"checkbox",id:"apply_strokeColor","onUpdate:modelValue":v[6]||(v[6]=B=>r.value.strokeColor=B)},null,512),[[tt,r.value.strokeColor]]),v[40]||(v[40]=e("label",{for:"apply_strokeColor"},"æè¾¹é¢œè‰²",-1))]),e("div",Ua,[ne(e("input",{type:"checkbox",id:"apply_strokeWidth","onUpdate:modelValue":v[7]||(v[7]=B=>r.value.strokeWidth=B)},null,512),[[tt,r.value.strokeWidth]]),v[41]||(v[41]=e("label",{for:"apply_strokeWidth"},"æè¾¹å®½åº¦",-1))])])):ge("",!0)])],512),[[Fe,i.value]])]),e("div",Oa,[e("button",{id:"translateButton",disabled:!L.value,onClick:v[8]||(v[8]=B=>n("translateCurrent"))}," ç¿»è¯‘å½“å‰å›¾ç‰‡ ",8,za),e("button",{id:"translateAllButton",disabled:!L.value,onClick:v[9]||(v[9]=B=>n("translateAll"))}," ç¿»è¯‘æ‰€æœ‰å›¾ç‰‡ ",8,Na),e("button",{id:"startHqTranslationBtn",class:"settings-button purple-button",disabled:!L.value,title:"ä½¿ç”¨é«˜è´¨é‡ç¿»è¯‘æ¨¡å¼ï¼ˆéœ€åœ¨è®¾ç½®ä¸­é…ç½®ï¼‰",onClick:v[10]||(v[10]=B=>n("hqTranslate"))}," é«˜è´¨é‡ç¿»è¯‘ ",8,Va),e("button",{id:"proofreadButton",disabled:!L.value,onClick:v[11]||(v[11]=B=>n("proofread"))}," AIæ ¡å¯¹ ",8,Wa),e("button",{id:"removeTextOnlyButton",disabled:!S.value,title:"æ¶ˆé™¤å›¾ç‰‡ä¸­çš„æ°”æ³¡æ–‡å­—ï¼Œæ— éœ€å¡«å†™ç¿»è¯‘æœåŠ¡å•†å’ŒAPI Key",onClick:v[12]||(v[12]=B=>n("removeText"))}," ä»…æ¶ˆé™¤æ–‡å­— ",8,Ka),e("button",{id:"removeAllTextButton",disabled:!M.value,title:"æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡ä¸­çš„æ°”æ³¡æ–‡å­—ï¼Œæ— éœ€å¡«å†™ç¿»è¯‘æœåŠ¡å•†å’ŒAPI Key",onClick:v[13]||(v[13]=B=>n("removeAllText"))}," æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡æ–‡å­— ",8,qa),e("button",{id:"deleteCurrentImageButton",class:"settings-button red-button",disabled:!S.value,onClick:v[14]||(v[14]=B=>n("deleteCurrent"))}," åˆ é™¤å½“å‰å›¾ç‰‡ ",8,Ha),e("button",{id:"clearAllImagesButton",class:"settings-button red-button",disabled:!M.value,onClick:v[15]||(v[15]=B=>n("clearAll"))}," æ¸…é™¤æ‰€æœ‰å›¾ç‰‡ ",8,ja),e("button",{id:"cleanDebugFilesButton",class:"settings-button orange-button",onClick:v[16]||(v[16]=B=>n("cleanTemp"))}," æ¸…ç†ä¸´æ—¶æ–‡ä»¶ "),e("button",{id:"managePluginsButton",class:"settings-button blue-button",onClick:v[17]||(v[17]=B=>n("openPlugins"))}," æ’ä»¶ç®¡ç† ")]),e("div",Ja,[e("button",{id:"prevImageButton",disabled:!D.value,onClick:v[18]||(v[18]=B=>n("previous"))}," ä¸Šä¸€å¼  ",8,Ga),e("button",{id:"nextImageButton",disabled:!U.value,onClick:v[19]||(v[19]=B=>n("next"))}," ä¸‹ä¸€å¼  ",8,Ya)])])]))}}),Za=qe(Xa,[["__scopeId","data-v-df51db99"]]);function kt(s){if(s.textDirection==="vertical"||s.textDirection==="horizontal")return s.textDirection;if(s.autoTextDirection==="vertical"||s.autoTextDirection==="horizontal")return s.autoTextDirection;if(s.coords){const[t,n,o,l]=s.coords;return l-n>o-t?"vertical":"horizontal"}return"vertical"}function Qa(){const s=Qe(),t=Ue(),n=rt(),o=_(!1),l=_(0),i=_(""),a=_(!1),r=_(0),h=_(""),T=K(()=>s.hasImages),S=K(()=>s.hasImages),M=K(()=>s.hasImages);function L(){const f=s.images;if(f.length===0){n.warning("æ²¡æœ‰å¯å¯¼å‡ºçš„å›¾ç‰‡æ–‡æœ¬");return}const c=[];for(let ae=0;ae<f.length;ae++){const Z=f[ae];if(!Z)continue;const d=Z.bubbleStates||[],m={imageIndex:ae,bubbles:[]};for(let x=0;x<d.length;x++){const b=d[x];if(!b)continue;const p=b.originalText||"",g=b.translatedText||b.textboxText||"";let E="vertical";b.textDirection&&b.textDirection!=="auto"?E=b.textDirection:b.autoTextDirection&&(E=b.autoTextDirection),m.bubbles.push({bubbleIndex:x,original:p,translated:g,textDirection:E})}c.push(m)}const k=JSON.stringify(c,null,2),C=new Blob([k],{type:"application/json"}),N=URL.createObjectURL(C),Y=document.createElement("a");Y.href=N;const X=new Date().toISOString().replace(/[-:T]/g,"").slice(0,15);Y.download=`translations_${X}.json`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(N),n.success("æ–‡æœ¬å¯¼å‡ºæˆåŠŸï¼")}function D(){const f=s.images;if(f.length===0)return null;const c=[];for(let k=0;k<f.length;k++){const C=f[k];if(!C)continue;const N=C.bubbleStates||[],Y={imageIndex:k,bubbles:[]};for(let ie=0;ie<N.length;ie++){const X=N[ie];if(!X)continue;const ae=X.originalText||"",Z=X.translatedText||X.textboxText||"";let d="vertical";X.textDirection&&X.textDirection!=="auto"?d=X.textDirection:X.autoTextDirection&&(d=X.autoTextDirection),Y.bubbles.push({bubbleIndex:ie,original:ae,translated:Z,textDirection:d})}c.push(Y)}return c}async function U(f){if(!f){n.warning("æœªé€‰æ‹©æ–‡ä»¶");return}a.value=!0,r.value=0,h.value="å‡†å¤‡å¯¼å…¥æ–‡æœ¬...",n.info("æ­£åœ¨å¯¼å…¥æ–‡æœ¬...",0);try{const c=await w(f);r.value=10,h.value="è§£æ JSON æ•°æ®...";const k=JSON.parse(c);if(!Array.isArray(k))throw new Error("å¯¼å…¥çš„ JSON æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸ºæ•°ç»„");let C=0,N=0;const Y=t.settings.textStyle,ie=Y.autoFontSize?"auto":Y.fontSize,X=Y.fontFamily,ae=Y.textColor,Z=Y.fillColor;r.value=20,h.value="å¼€å§‹æ›´æ–°å›¾ç‰‡...";const d=k.length;let m=0;const x=[];for(const g of k){m++;const E=20+m/d*60;r.value=E,h.value=`å¤„ç†å›¾ç‰‡ ${m}/${d}`;const H=g.imageIndex;if(H<0||H>=s.images.length){console.warn(`è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${H}`);continue}const I=s.images[H];if(!I)continue;let $=!1;I.bubbleStates||(I.bubbleStates=[]),I.bubbleTexts||(I.bubbleTexts=[]),I.originalTexts||(I.originalTexts=[]);for(const R of g.bubbles){const v=R.bubbleIndex,B=R.original,u=R.translated,y=R.textDirection,ue=y==="vertical"||y==="horizontal"?y:"vertical";for(;I.bubbleTexts.length<=v;)I.bubbleTexts.push("");for(;I.originalTexts.length<=v;)I.originalTexts.push("");for(B&&(I.originalTexts[v]=B),u&&(I.bubbleTexts[v]=u);I.bubbleStates.length<=v;)I.bubbleStates.push(W(ie,X,ae,Z));const F=I.bubbleStates[v];F&&(B&&(F.originalText=B),u&&(F.translatedText=u,F.textboxText=u),F.textDirection=ue,$=!0,N++)}$&&I.bubbleStates&&(I.bubbleTexts=I.bubbleStates.map(R=>R.translatedText||"")),$&&(C++,I.hasUnsavedChanges=!0,I.translatedDataURL&&I.bubbleStates&&I.bubbleStates.length>0&&x.push(H))}if(x.length>0){r.value=80,h.value="å¼€å§‹æ¸²æŸ“å›¾ç‰‡...",n.info("æ­£åœ¨æ¸²æŸ“å›¾ç‰‡ï¼Œè¯·ç¨å€™...",0);const g=t.settings.textStyle,E=g.layoutDirection,H=E==="auto";for(let I=0;I<x.length;I++){const $=x[I];if($===void 0)continue;const R=s.images[$];if(!(!R||!R.bubbleStates)){r.value=80+I/x.length*20,h.value=`æ¸²æŸ“å›¾ç‰‡ ${I+1}/${x.length}`;try{let v="";if(R.cleanImageData?v=R.cleanImageData.includes("base64,")?R.cleanImageData.split("base64,")[1]||"":R.cleanImageData:R.originalDataURL&&(v=R.originalDataURL.includes("base64,")?R.originalDataURL.split("base64,")[1]||"":R.originalDataURL,console.log(`importText: å›¾ç‰‡ ${$} ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰`)),!v){console.log(`importText: å›¾ç‰‡ ${$} æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡`);continue}const B=R.bubbleStates.map(y=>({translatedText:y.translatedText||"",coords:y.coords,fontSize:y.fontSize||g.fontSize,fontFamily:y.fontFamily||g.fontFamily,textDirection:kt(y),textColor:y.textColor||g.textColor,rotationAngle:y.rotationAngle||0,position:y.position||{x:0,y:0},strokeEnabled:y.strokeEnabled??g.strokeEnabled,strokeColor:y.strokeColor||g.strokeColor,strokeWidth:y.strokeWidth??g.strokeWidth})),u=await co({clean_image:v,bubble_texts:B.map(y=>y.translatedText),bubble_coords:B.map(y=>y.coords),fontSize:g.fontSize,fontFamily:g.fontFamily,textDirection:H?"vertical":E,textColor:g.textColor,bubble_states:B,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,is_font_style_change:!0,strokeEnabled:g.strokeEnabled,strokeColor:g.strokeColor,strokeWidth:g.strokeWidth});u.rendered_image&&(s.updateImageByIndex($,{translatedDataURL:`data:image/png;base64,${u.rendered_image}`,hasUnsavedChanges:!0}),console.log(`importText: å›¾ç‰‡ ${$} æ¸²æŸ“æˆåŠŸ`))}catch(v){console.error(`importText: é‡æ¸²æŸ“å›¾ç‰‡ ${$} å¤±è´¥:`,v)}}}}r.value=100,h.value="å¯¼å…¥å®Œæˆ";const b=x.length,p=b>0?`å¯¼å…¥æˆåŠŸï¼æ›´æ–°äº† ${C} å¼ å›¾ç‰‡ä¸­çš„ ${N} ä¸ªæ°”æ³¡æ–‡æœ¬ï¼Œé‡æ¸²æŸ“äº† ${b} å¼ å›¾ç‰‡`:`å¯¼å…¥æˆåŠŸï¼æ›´æ–°äº† ${C} å¼ å›¾ç‰‡ä¸­çš„ ${N} ä¸ªæ°”æ³¡æ–‡æœ¬`;n.success(p)}catch(c){console.error("å¯¼å…¥æ–‡æœ¬å‡ºé”™:",c),n.error(`å¯¼å…¥å¤±è´¥: ${c instanceof Error?c.message:String(c)}`)}finally{a.value=!1,setTimeout(()=>{r.value=0,h.value=""},2e3)}}function w(f){return new Promise((c,k)=>{const C=new FileReader;C.onload=N=>{N.target?.result?c(N.target.result):k(new Error("è¯»å–æ–‡ä»¶å¤±è´¥"))},C.onerror=()=>k(new Error("è¯»å–æ–‡ä»¶æ—¶å‡ºé”™")),C.readAsText(f)})}function W(f,c,k,C){const N=t.settings.textStyle;return{coords:[0,0,100,100],polygon:[],originalText:"",translatedText:"",textboxText:"",fontSize:typeof f=="number"?f:25,fontFamily:c,textDirection:"vertical",autoTextDirection:"vertical",textColor:k,fillColor:C,rotationAngle:0,position:{x:0,y:0},strokeEnabled:N.strokeEnabled,strokeColor:N.strokeColor,strokeWidth:N.strokeWidth,inpaintMethod:N.inpaintMethod}}function q(){const f=s.currentImage;if(!f){n.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}const c=f.translatedDataURL||f.originalDataURL;if(!c){n.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}o.value=!0;try{const k=c.split(",")[1];if(!k)throw new Error("æ— æ•ˆçš„å›¾ç‰‡æ•°æ®");const C=atob(k),N=[];for(let d=0;d<C.length;d+=512){const m=C.slice(d,d+512),x=new Array(m.length);for(let p=0;p<m.length;p++)x[p]=m.charCodeAt(p);const b=new Uint8Array(x);N.push(b.buffer)}const Y=new Blob(N,{type:"image/png"}),ie=URL.createObjectURL(Y),X=document.createElement("a");X.href=ie;let ae=f.fileName||`image_${s.currentImageIndex}.png`;ae=`${f.translatedDataURL?"translated":"original"}_${ae.replace(/\.[^/.]+$/,"")}.png`,X.download=ae,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(ie),n.success(`ä¸‹è½½æˆåŠŸ: ${ae}`)}catch(k){console.error("ä¸‹è½½å›¾ç‰‡æ—¶å‡ºé”™:",k),n.error("ä¸‹è½½å¤±è´¥")}finally{o.value=!1}}async function O(f="zip"){const c=s.images;if(c.length===0){n.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}o.value=!0,l.value=0,i.value="å‡†å¤‡ä¸‹è½½...",n.info("ä¸‹è½½ä¸­...å¤„ç†å¯èƒ½éœ€è¦ä¸€å®šæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…...",0);try{const k=[];let C=0,N=0;l.value=5,i.value="æ£€æŸ¥å›¾ç‰‡æ•°æ®...";for(let p=0;p<c.length;p++){const g=c[p];g&&(g.translatedDataURL?(k.push({index:p,type:"translated"}),C++):g.originalDataURL&&(k.push({index:p,type:"original"}),N++))}if(k.length===0){n.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}l.value=10,i.value="åˆ›å»ºä¸‹è½½ä¼šè¯...";const Y=await us(k.length);if(!Y.success||!Y.session_id)throw new Error(Y.error||"åˆ›å»ºä¼šè¯å¤±è´¥");const ie=Y.session_id,X=k.length;let ae=0,Z=0;for(let p=0;p<k.length;p++){const g=k[p];if(!g)continue;const E=c[g.index];if(!E)continue;const H=g.type==="translated"?E.translatedDataURL:E.originalDataURL;if(!H)continue;const I=10+p/X*70;l.value=I,i.value=`ä¸Šä¼ å›¾ç‰‡ ${p+1}/${X}...`;try{const $=await cs(ie,H,p);$.success?ae++:(console.error(`ä¸Šä¼ å›¾ç‰‡ ${p} å¤±è´¥:`,$.error),Z++)}catch($){console.error(`ä¸Šä¼ å›¾ç‰‡ ${p} å‡ºé”™:`,$),Z++}}if(ae===0)throw new Error("æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ å¤±è´¥");l.value=85,i.value="æ‰“åŒ…æ–‡ä»¶...";const d=await ds(ie,f);if(!d.success||!d.file_id)throw new Error(d.error||"æ‰“åŒ…å¤±è´¥");l.value=95,i.value="å‡†å¤‡ä¸‹è½½...";const m=gs(d.file_id,f),x=document.createElement("a");x.href=m,document.body.appendChild(x),x.click(),document.body.removeChild(x),l.value=100,i.value="ä¸‹è½½å·²å¼€å§‹";let b=`å·²æˆåŠŸå¤„ç† ${ae} å¼ å›¾ç‰‡`;Z>0&&(b+=`ï¼ˆ${Z} å¼ å¤±è´¥ï¼‰`),C>0&&N>0?b+=`ï¼ˆ${C} å¼ ç¿»è¯‘å›¾ç‰‡å’Œ ${N} å¼ åŸå§‹å›¾ç‰‡ï¼‰`:C>0?b+="ï¼ˆå…¨éƒ¨ä¸ºç¿»è¯‘åå›¾ç‰‡ï¼‰":N>0&&(b+="ï¼ˆå…¨éƒ¨ä¸ºåŸå§‹å›¾ç‰‡ï¼‰"),b+="ï¼Œä¸‹è½½å³å°†å¼€å§‹",n.success(b),setTimeout(async()=>{try{const p=await uo();console.log("ä¸´æ—¶æ–‡ä»¶æ¸…ç†ç»“æœ:",p)}catch(p){console.error("æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥:",p)}},6e4)}catch(k){console.error("ä¸‹è½½æ‰€æœ‰å›¾ç‰‡æ—¶å‡ºé”™:",k),n.error(`ä¸‹è½½å¤±è´¥: ${k instanceof Error?k.message:String(k)}`)}finally{o.value=!1,setTimeout(()=>{l.value=0,i.value=""},2e3)}}return{isDownloading:o,downloadProgress:l,downloadProgressText:i,isImporting:a,importProgress:r,importProgressText:h,canExportText:T,canImportText:S,canDownload:M,exportText:L,exportTextToJson:D,importText:U,downloadCurrentImage:q,downloadAllImages:O}}const el={key:0,class:"result-section card result-card"},tl={class:"image-controls"},ol={class:"image-size-control"},nl=["value"],sl={id:"imageSizeValue"},al={class:"content-container"},ll={class:"image-container"},il=["src"],rl={id:"detectedTextInfo",class:"text-info"},ul={id:"detectedTextList"},cl={class:"original-text"},dl={class:"download-section"},gl={class:"download-buttons"},pl=["disabled"],ml={class:"download-all-container"},vl=["disabled"],fl={class:"download-format-selector"},bl=["disabled"],hl=["disabled"],yl={key:1,class:"empty-state-section"},eo=60,xl=He({__name:"ImageResultDisplay",props:{isEditMode:{type:Boolean,default:!1}},emits:["toggle-edit-mode","retry-failed"],setup(s,{emit:t}){const n=[{label:"ZIPå‹ç¼©åŒ…",value:"zip"},{label:"PDFæ–‡æ¡£",value:"pdf"},{label:"CBZæ¼«ç”»",value:"cbz"}],o=t,l=Qe(),i=Ue(),a=Qa(),r=_(100),h=K({get:()=>w.value?.showOriginal??!1,set:I=>{w.value&&l.updateCurrentImage({showOriginal:I})}}),T=_("zip"),S=_(null),M=K(()=>a.isDownloading.value),L=K(()=>a.downloadProgressText.value),D=K(()=>a.downloadProgress.value),U=K(()=>l.hasImages),w=K(()=>l.currentImage),W=K(()=>!!w.value?.translatedDataURL),q=K(()=>!!(w.value?.translatedDataURL||w.value?.originalDataURL)),O=K(()=>w.value?h.value||!w.value.translatedDataURL?w.value.originalDataURL:w.value.translatedDataURL:""),f=K(()=>l.failedImageCount>0),c=K(()=>({width:`${r.value}%`})),k=K(()=>i.settings.useTextboxPrompt),C=K(()=>{if(!w.value)return[];if(w.value.bubbleStates&&w.value.bubbleStates.length>0)return w.value.bubbleStates.map(R=>({original:R.originalText||"",translated:k.value?R.textboxText||R.translatedText||"":R.translatedText||""}));const I=w.value.originalTexts||[],$=k.value?w.value.textboxTexts||w.value.bubbleTexts||[]:w.value.bubbleTexts||[];return I.length===0?[]:I.map((R,v)=>({original:R||"",translated:$[v]||""}))}),N=K(()=>C.value.length>0);function Y(I){if(!I||I.length<=eo)return I;let $="",R="";for(let v=0;v<I.length;v++)if(R+=I[v],R.length>=eo){let B=-1;for(let u=R.length-1;u>=0;u--){const y=R[u];if(y&&["ã€‚","ï¼","ï¼Ÿ",".","!","?","ï¼›",";","ï¼Œ",","].includes(y)){B=u+1;break}}B>eo*.6?($+=R.substring(0,B)+`
`,R=R.substring(B)):($+=R+`
`,R="")}return R&&($+=R),$}function ie(I){return Y((I||"").trim())}function X(I){const $=(I||"").trim();return Y($)}function ae(I){return(I||"").includes("ç¿»è¯‘å¤±è´¥")}function Z(){h.value=!h.value}function d(){o("toggle-edit-mode")}function m(I){const $=I.target;r.value=parseInt($.value,10)}function x(){o("retry-failed")}function b(){a.downloadCurrentImage()}function p(){a.downloadAllImages(T.value)}function g(){a.exportText()}function E(){S.value?.click()}async function H(I){const $=I.target,R=$.files?.[0];R&&(await a.importText(R),$.value="")}return(I,$)=>w.value?(P(),A("section",el,[e("div",tl,[W.value?(P(),A("button",{key:0,id:"toggleImageButton",class:"control-btn",onClick:Z},oe(h.value?"æŸ¥çœ‹ç¿»è¯‘å›¾":"æŸ¥çœ‹åŸå›¾"),1)):ge("",!0),e("button",{id:"toggleEditModeButton",class:Te(["control-btn",{active:s.isEditMode}]),onClick:d},oe(s.isEditMode?"é€€å‡ºç¼–è¾‘":"åˆ‡æ¢ç¼–è¾‘æ¨¡å¼"),3),e("div",ol,[$[1]||($[1]=e("label",{for:"imageSize"},"å›¾ç‰‡å¤§å°:",-1)),e("input",{type:"range",id:"imageSize",min:"50",max:"200",value:r.value,class:"slider range-slider",onInput:m},null,40,nl),e("span",sl,oe(r.value)+"%",1)]),f.value?(P(),A("button",{key:1,id:"retranslateFailedButton",class:"retry-failed-btn",onClick:x,title:"é‡æ–°ç¿»è¯‘æ‰€æœ‰å¤±è´¥çš„å›¾ç‰‡"}," é‡æ–°ç¿»è¯‘å¤±è´¥å›¾ç‰‡ ("+oe(V(l).failedImageCount)+") ",1)):ge("",!0)]),e("div",al,[e("div",ll,[e("img",{id:"translatedImageDisplay",src:O.value,alt:"ç¿»è¯‘åå›¾ç‰‡",style:ot(c.value)},null,12,il)])]),e("div",rl,[$[6]||($[6]=e("h3",null,"æ£€æµ‹åˆ°çš„æ–‡æœ¬ï¼ˆåŸæ–‡ â†’ è¯‘æ–‡ï¼‰",-1)),e("pre",ul,[N.value?(P(!0),A(Ae,{key:0},Je(C.value,(R,v)=>(P(),A("span",{key:v,class:"text-item"},[e("span",cl,oe(ie(R.original)),1),$[2]||($[2]=pe(`
`,-1)),e("span",{class:Te(["translated-text",{"translation-error":ae(R.translated)}])},oe(X(R.translated)),3),$[3]||($[3]=pe(`
`,-1)),$[4]||($[4]=e("span",{class:"separator"},"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",-1)),$[5]||($[5]=pe(`

`,-1))]))),128)):(P(),A(Ae,{key:1},[pe("æœªæ£€æµ‹åˆ°æ–‡æœ¬æˆ–å°šæœªç¿»è¯‘")],64))])]),e("div",dl,[M.value?(P(),st(mo,{key:0,visible:!0,percentage:D.value,label:L.value||"ä¸‹è½½ä¸­ï¼Œè¯·ç¨å€™..."},null,8,["percentage","label"])):ge("",!0),e("div",gl,[e("button",{id:"downloadButton",class:"download-btn primary",disabled:!q.value,onClick:b}," ä¸‹è½½å½“å‰å›¾ç‰‡ ",8,pl),e("div",ml,[e("button",{id:"downloadAllImagesButton",class:"download-btn primary",disabled:!U.value,onClick:p}," ä¸‹è½½æ‰€æœ‰å›¾ç‰‡ ",8,vl),e("div",fl,[xe(Ne,{modelValue:T.value,"onUpdate:modelValue":$[0]||($[0]=R=>T.value=R),options:n},null,8,["modelValue"])])]),e("button",{id:"exportTextButton",class:"download-btn success",disabled:!U.value,onClick:g}," å¯¼å‡ºæ–‡æœ¬ ",8,bl),e("button",{id:"importTextButton",class:"download-btn success",disabled:!U.value,onClick:E}," å¯¼å…¥æ–‡æœ¬ ",8,hl),e("input",{type:"file",ref_key:"importFileInput",ref:S,id:"importTextFileInput",style:{display:"none"},accept:".json",onChange:H},null,544)])])])):(P(),A("section",yl))}}),_l=qe(xl,[["__scopeId","data-v-a26b9c58"]]),Cl={class:"guide-content"},kl={class:"guide-footer"},Sl={class:"dont-show-option"},Bt="saber_translator_dismiss_setup_reminder",wl=He({__name:"FirstTimeGuide",emits:["openSettings"],setup(s,{expose:t,emit:n}){const o=n,l=_(!1),i=_(!1);ut(()=>{localStorage.getItem(Bt)!=="true"&&(l.value=!0)});function a(){i.value&&localStorage.setItem(Bt,"true"),l.value=!1}function r(){localStorage.setItem(Bt,"true"),l.value=!1,o("openSettings")}function h(){localStorage.removeItem(Bt)}return t({resetGuideState:h,showGuide:l}),(T,S)=>(P(),st(dn,{"model-value":l.value,title:"æ¬¢è¿ä½¿ç”¨ Saber-Translator",onClose:a},{default:yt(()=>[e("div",Cl,[S[3]||(S[3]=e("div",{class:"guide-icon"},"ğŸ‰",-1)),S[4]||(S[4]=e("div",{class:"guide-message"},[e("p",{class:"guide-title"},"é¦–æ¬¡ä½¿ç”¨æé†’"),e("p",{class:"guide-text"}," åœ¨å¼€å§‹ç¿»è¯‘ä¹‹å‰ï¼Œè¯·å…ˆé…ç½®ç¿»è¯‘æœåŠ¡ã€‚ "),e("p",{class:"guide-text"},[pe(" ç‚¹å‡»å³ä¸Šè§’çš„ "),e("span",{class:"highlight"},"âš™ï¸ è®¾ç½®"),pe(" æŒ‰é’®ï¼Œé…ç½®ä»¥ä¸‹å†…å®¹ï¼š ")]),e("ul",{class:"guide-list"},[e("li",null,"é€‰æ‹© OCR å¼•æ“ï¼ˆæ–‡å­—è¯†åˆ«ï¼‰"),e("li",null,"é…ç½®ç¿»è¯‘æœåŠ¡å•†å’Œ API Key"),e("li",null,"ï¼ˆå¯é€‰ï¼‰é…ç½®é«˜è´¨é‡ç¿»è¯‘å’Œ AI æ ¡å¯¹")])],-1)),e("div",{class:"guide-actions"},[e("button",{class:"guide-btn primary",onClick:r},[...S[1]||(S[1]=[e("span",{class:"btn-icon"},"âš™ï¸",-1),pe(" ç«‹å³é…ç½® ",-1)])]),e("button",{class:"guide-btn secondary",onClick:a}," ç¨åé…ç½® ")]),e("div",kl,[e("label",Sl,[ne(e("input",{type:"checkbox","onUpdate:modelValue":S[0]||(S[0]=M=>i.value=M)},null,512),[[tt,i.value]]),S[2]||(S[2]=e("span",null,"ä¸å†æ˜¾ç¤ºæ­¤æé†’",-1))])])])]),_:1},8,["model-value"]))}}),$l=qe(wl,[["__scopeId","data-v-eda18e4a"]]),to="saber_translator_dismiss_setup_reminder",Tl=["siliconflow","deepseek","volcano","caiyun","baidu_translate","youdao_translate","gemini","custom_openai"],Il={manga_ocr:"MangaOCR",paddle_ocr:"PaddleOCR",baidu_ocr:"ç™¾åº¦OCR",ai_vision:"AIè§†è§‰OCR"},Rl=["ollama","sakura"],Dl=["custom_openai"],Pl=["custom_openai"],Ml={siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",caiyun:"å½©äº‘å°è¯‘",baidu_translate:"ç™¾åº¦ç¿»è¯‘",youdao_translate:"æœ‰é“ç¿»è¯‘",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰ OpenAI",ollama:"Ollama",sakura:"Sakura"};function mn(){const s=Ue(),t=rt(),n=_(!1),o=_(!1),l=K(()=>{try{return localStorage.getItem(to)==="true"}catch{return!1}});function i(C){return Ml[C]||C}function a(C){return Tl.includes(C)}function r(C){return Rl.includes(C)}function h(C){return Dl.includes(C)}function T(C){return Pl.includes(C)}function S(C){return Il[C]||C}function M(){const C=s.settings,N=C.ocrEngine,Y=C.baiduOcr,ie=C.aiVisionOcr,X=[];return N?(N==="baidu_ocr"&&((!Y?.apiKey||Y.apiKey.trim()==="")&&X.push("ç™¾åº¦OCR çš„ API Key"),(!Y?.secretKey||Y.secretKey.trim()==="")&&X.push("ç™¾åº¦OCR çš„ Secret Key")),N==="ai_vision"&&(ie?.provider||X.push("AIè§†è§‰OCR çš„æœåŠ¡å•†"),(!ie?.apiKey||ie.apiKey.trim()==="")&&X.push("AIè§†è§‰OCR çš„ API Key"),(!ie?.modelName||ie.modelName.trim()==="")&&X.push("AIè§†è§‰OCR çš„æ¨¡å‹åç§°"),ie?.provider==="custom"&&(!ie?.customBaseUrl||ie.customBaseUrl.trim()==="")&&X.push("AIè§†è§‰OCR çš„è‡ªå®šä¹‰ Base URL")),X.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${X[0]}`,missingItems:X}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹© OCR å¼•æ“",missingItems:["OCR å¼•æ“"]}}function L(){const{translation:C}=s.settings,{provider:N,apiKey:Y,modelName:ie,customBaseUrl:X}=C,ae=[];return N?(a(N)&&(!Y||Y.trim()==="")&&ae.push(`${i(N)} çš„ API Key`),(!ie||ie.trim()==="")&&(r(N)||a(N))&&ae.push(`${i(N)} çš„æ¨¡å‹åç§°`),h(N)&&(!X||X.trim()==="")&&ae.push("è‡ªå®šä¹‰ OpenAI æœåŠ¡çš„ Base URL"),ae.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${ae[0]}`,missingItems:ae}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹©ç¿»è¯‘æœåŠ¡å•†",missingItems:["ç¿»è¯‘æœåŠ¡å•†"]}}function D(){const{hqTranslation:C}=s.settings,{provider:N,apiKey:Y,modelName:ie,customBaseUrl:X}=C,ae=[];return N?((!Y||Y.trim()==="")&&ae.push("é«˜è´¨é‡ç¿»è¯‘çš„ API Key"),(!ie||ie.trim()==="")&&ae.push("é«˜è´¨é‡ç¿»è¯‘çš„æ¨¡å‹åç§°"),T(N)&&(!X||X.trim()==="")&&ae.push("é«˜è´¨é‡ç¿»è¯‘çš„ Base URL"),ae.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${ae[0]}`,missingItems:ae}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹©é«˜è´¨é‡ç¿»è¯‘çš„æœåŠ¡å•†",missingItems:["é«˜è´¨é‡ç¿»è¯‘æœåŠ¡å•†"]}}function U(C){const N=C||s.settings.proofreading.rounds,Y=[];if(!N||N.length===0)return{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­æ·»åŠ è‡³å°‘ä¸€ä¸ªæ ¡å¯¹è½®æ¬¡",missingItems:["æ ¡å¯¹è½®æ¬¡"]};for(let ie=0;ie<N.length;ie++){const X=N[ie];if(!X)continue;const ae=X.name||`è½®æ¬¡${ie+1}`;if(X.provider||Y.push(`æ ¡å¯¹ ${ae} çš„æœåŠ¡å•†`),(!X.apiKey||X.apiKey.trim()==="")&&Y.push(`æ ¡å¯¹ ${ae} çš„ API Key`),(!X.modelName||X.modelName.trim()==="")&&Y.push(`æ ¡å¯¹ ${ae} çš„æ¨¡å‹åç§°`),Y.length>0)return{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­ä¸º ${Y[0]}`,missingItems:Y}}return{valid:!0,message:""}}function w(C="normal",N={}){let Y;switch(C){case"normal":Y=L();break;case"hq":Y=D();break;case"proofread":Y=U(N.proofreadingRounds);break;case"ocr":Y=M();break;default:Y=L()}return Y.valid?!0:(t.error(Y.message),q(),!1)}function W(){const C=M();if(!C.valid)return t.error(C.message),q(),!1;const N=L();return N.valid?!0:(t.error(N.message),q(),!1)}function q(){const C=document.getElementById("openSettingsBtn");C&&(o.value=!0,C.style.animation="settingsBtnPulse 0.5s ease-in-out 3",C.style.boxShadow="0 0 10px var(--primary-color, #4a90d9)",setTimeout(()=>{C.style.animation="",C.style.boxShadow="",o.value=!1},3e3))}function O(){if(l.value){console.log("ç”¨æˆ·å·²é€‰æ‹©ä¸å†æ˜¾ç¤ºè®¾ç½®æé†’");return}n.value=!0}function f(C=!1){if(C)try{localStorage.setItem(to,"true"),console.log("ç”¨æˆ·é€‰æ‹©æ°¸ä¹…å…³é—­è®¾ç½®æé†’")}catch(N){console.error("ä¿å­˜è®¾ç½®æé†’çŠ¶æ€å¤±è´¥:",N)}n.value=!1}function c(){try{localStorage.removeItem(to),console.log("è®¾ç½®æé†’çŠ¶æ€å·²é‡ç½®")}catch(C){console.error("é‡ç½®è®¾ç½®æé†’çŠ¶æ€å¤±è´¥:",C)}}function k(){setTimeout(()=>{O()},500)}return{showSetupReminder:n,isSettingsButtonHighlighted:o,isSetupReminderDismissed:l,validateOcrConfig:M,validateTranslationConfig:L,validateHqTranslationConfig:D,validateProofreadingConfig:U,validateBeforeTranslation:w,validateFullTranslationConfig:W,highlightSettingsButton:q,checkAndShowSetupReminder:O,closeSetupReminder:f,resetSetupReminderDismiss:c,initValidation:k,getProviderDisplayName:i,getOcrEngineDisplayName:S,requiresApiKey:a,isLocalProvider:r,requiresBaseUrl:h}}const ct=Ut("bubble",()=>{const s=_([]),t=_(-1),n=_([]),o=_([]),l=_(!1),i=_(-1),a=_(0),r=_(0),h=_(0),T=_(0),S=_(!1),M=_(-1),L=_(null),D=_(!1),U=_(-1),w=_(0),W=K(()=>t.value>=0&&t.value<s.value.length?s.value[t.value]??null:null),q=K(()=>s.value.length),O=K(()=>s.value.length>0),f=K(()=>t.value>=0),c=K(()=>n.value.length>1),k=K(()=>n.value.filter(F=>F>=0&&F<s.value.length).map(F=>s.value[F]).filter(F=>F!==void 0));function C(){const j=Qe().currentImage;j&&(j.bubbleStates=Et(s.value),j.hasUnsavedChanges=!0,console.log("æ°”æ³¡çŠ¶æ€å·²åŒæ­¥åˆ°å½“å‰å›¾ç‰‡"))}function N(F,j=!1){s.value=F,o.value=Et(F),x(),console.log(`æ°”æ³¡æ•°ç»„å·²è®¾ç½®ï¼Œå…± ${F.length} ä¸ªæ°”æ³¡`),j||C()}function Y(F,j){const le=Fs(F),$e=Ue().settings.textStyle,Ee=$e.layoutDirection,Me=Ee==="vertical"||Ee==="horizontal"?Ee:le==="vertical"||le==="horizontal"?le:"vertical",se=Ls({coords:F,translatedText:"",autoTextDirection:le,fontSize:$e.fontSize,fontFamily:$e.fontFamily,textDirection:Me,textColor:$e.textColor,fillColor:$e.fillColor,inpaintMethod:$e.inpaintMethod,strokeEnabled:$e.strokeEnabled,strokeColor:$e.strokeColor,strokeWidth:$e.strokeWidth,rotationAngle:0,position:{x:0,y:0},...j});return s.value.push(se),console.log(`å·²æ·»åŠ æ°”æ³¡ï¼Œå½“å‰å…± ${s.value.length} ä¸ª`),C(),se}function ie(F){return F<0||F>=s.value.length?(console.warn(`åˆ é™¤å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${F}`),!1):(s.value.splice(F,1),t.value===F?t.value=-1:t.value>F&&t.value--,n.value=n.value.filter(j=>j!==F).map(j=>j>F?j-1:j),console.log(`å·²åˆ é™¤æ°”æ³¡ï¼Œå½“å‰å…± ${s.value.length} ä¸ª`),C(),!0)}function X(){if(n.value.length===0&&t.value<0)return;const F=[...new Set([...n.value,t.value])].filter(j=>j>=0).sort((j,le)=>le-j);for(const j of F)s.value.splice(j,1);x(),console.log(`å·²åˆ é™¤ ${F.length} ä¸ªæ°”æ³¡`),C()}function ae(){s.value=[],o.value=[],x(),console.log("æ‰€æœ‰æ°”æ³¡å·²æ¸…é™¤"),C()}function Z(){s.value=[],o.value=[],x(),console.log("æœ¬åœ°æ°”æ³¡çŠ¶æ€å·²æ¸…é™¤ï¼ˆä¸åŒæ­¥åˆ°imageStoreï¼‰")}function d(F){F>=-1&&F<s.value.length&&(t.value=F,n.value=F>=0?[F]:[],console.log(`å·²é€‰ä¸­æ°”æ³¡ ${F}`))}function m(F){if(F<0||F>=s.value.length)return;const j=n.value.indexOf(F);j>=0?(n.value.splice(j,1),t.value===F&&(t.value=n.value[0]??-1)):(n.value.push(F),t.value=F),console.log(`å¤šé€‰çŠ¶æ€: ${n.value.join(", ")}`)}function x(){t.value=-1,n.value=[]}function b(){t.value>=0?n.value=[t.value]:n.value=[]}function p(){if(s.value.length===0)return!1;const F=t.value<s.value.length-1?t.value+1:0;return d(F),!0}function g(){if(s.value.length===0)return!1;const F=t.value>0?t.value-1:s.value.length-1;return d(F),!0}function E(F,j){if(F<0||F>=s.value.length)return console.warn(`æ›´æ–°å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${F}`),!1;const le=s.value[F];return le?(Object.assign(le,j),console.log(`å·²æ›´æ–°æ°”æ³¡ ${F}`),C(),!0):!1}function H(F){return t.value<0?(console.warn("æ›´æ–°å¤±è´¥: æ²¡æœ‰é€‰ä¸­çš„æ°”æ³¡"),!1):E(t.value,F)}function I(F){const j=n.value.length>0?n.value:t.value>=0?[t.value]:[];for(const le of j){const _e=s.value[le];_e&&Object.assign(_e,F)}C(),console.log(`å·²æ‰¹é‡æ›´æ–° ${j.length} ä¸ªæ°”æ³¡`)}function $(F){for(let j=0;j<s.value.length;j++){const le=s.value[j];le&&Object.assign(le,F)}C(),console.log(`å·²æ›´æ–°æ‰€æœ‰ ${s.value.length} ä¸ªæ°”æ³¡`)}function R(){if(s.value.length!==o.value.length)return!0;for(let F=0;F<s.value.length;F++){const j=s.value[F],le=o.value[F];if(!(!j||!le)&&(j.translatedText!==le.translatedText||j.textboxText!==le.textboxText||j.fontSize!==le.fontSize||j.fontFamily!==le.fontFamily||j.textDirection!==le.textDirection||j.textColor!==le.textColor||j.fillColor!==le.fillColor||j.rotationAngle!==le.rotationAngle||j.strokeEnabled!==le.strokeEnabled||j.strokeColor!==le.strokeColor||j.strokeWidth!==le.strokeWidth||j.inpaintMethod!==le.inpaintMethod||JSON.stringify(j.coords)!==JSON.stringify(le.coords)))return!0}return!1}function v(){s.value=Et(o.value),x(),console.log("æ°”æ³¡çŠ¶æ€å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€")}function B(){o.value=Et(s.value),console.log("å½“å‰çŠ¶æ€å·²ä¿å­˜ä¸ºåˆå§‹çŠ¶æ€")}function u(){return{bubble_coords:s.value.map(F=>F.coords),bubble_texts:s.value.map(F=>F.translatedText),textbox_texts:s.value.map(F=>F.textboxText),font_sizes:s.value.map(F=>F.fontSize),font_families:s.value.map(F=>F.fontFamily),text_directions:s.value.map(F=>F.textDirection==="vertical"||F.textDirection==="horizontal"?F.textDirection==="vertical"?"v":"h":F.autoTextDirection==="vertical"||F.autoTextDirection==="horizontal"?F.autoTextDirection==="vertical"?"v":"h":"v"),text_colors:s.value.map(F=>F.textColor),fill_colors:s.value.map(F=>F.fillColor),rotation_angles:s.value.map(F=>F.rotationAngle),stroke_enabled:s.value.map(F=>F.strokeEnabled),stroke_colors:s.value.map(F=>F.strokeColor),stroke_widths:s.value.map(F=>F.strokeWidth),inpaint_methods:s.value.map(F=>F.inpaintMethod)}}function y(){return JSON.stringify(s.value)}function ue(F){try{const j=JSON.parse(F);if(!Array.isArray(j))return console.error("ååºåˆ—åŒ–å¤±è´¥: æ•°æ®ä¸æ˜¯æ•°ç»„"),!1;const le=[];for(const _e of j)Us(_e)?le.push(_e):console.warn("è·³è¿‡æ— æ•ˆçš„æ°”æ³¡çŠ¶æ€:",_e);return N(le),!0}catch(j){return console.error("ååºåˆ—åŒ–å¤±è´¥:",j),!1}}return{bubbles:s,selectedIndex:t,selectedIndices:n,initialStates:o,isDragging:l,draggingIndex:i,dragOffsetX:a,dragOffsetY:r,dragInitialX:h,dragInitialY:T,isResizing:S,resizingIndex:M,resizeCurrentCoords:L,isRotating:D,rotatingIndex:U,rotateCurrentAngle:w,selectedBubble:W,bubbleCount:q,hasBubbles:O,hasSelection:f,isMultiSelect:c,selectedBubbles:k,setBubbles:N,addBubble:Y,deleteBubble:ie,deleteSelected:X,clearBubbles:ae,clearBubblesLocal:Z,selectBubble:d,toggleMultiSelect:m,clearSelection:x,clearMultiSelect:b,selectNext:p,selectPrevious:g,updateBubble:E,updateSelectedBubble:H,updateAllSelected:I,updateAllBubbles:$,hasChanges:R,resetToInitial:v,saveAsInitial:B,toApiRequest:u,serialize:y,deserialize:ue}}),El=Object.freeze(Object.defineProperty({__proto__:null,useBubbleStore:ct},Symbol.toStringTag,{value:"Module"}));function Bl(){const s=_({current:0,total:0,completed:0,failed:0,isInProgress:!1,label:"",percentage:0});return{progress:s,reporter:{init(n,o){s.value={current:0,total:n,completed:0,failed:0,isInProgress:!0,label:o||"å‡†å¤‡ä¸­...",percentage:0}},update(n,o){s.value.current=n,o!==void 0&&(s.value.label=o),s.value.total>0&&(s.value.percentage=Math.round(n/s.value.total*100))},setPercentage(n,o){s.value.percentage=Math.min(100,Math.max(0,n)),o!==void 0&&(s.value.label=o)},incrementCompleted(){s.value.completed++},incrementFailed(){s.value.failed++},finish(){s.value.isInProgress=!1,s.value.percentage=100},getProgress(){return{...s.value}}}}}async function vn(s){return Ze.post("/api/parallel/detect",s)}async function fn(s){return Ze.post("/api/parallel/ocr",s)}async function bn(s){return Ze.post("/api/parallel/color",s)}async function hn(s){return Ze.post("/api/parallel/translate",s)}async function yn(s){return Ze.post("/api/parallel/inpaint",s)}async function xn(s){return Ze.post("/api/parallel/render",s)}const Zo={standard:["detection","ocr","color","translate","inpaint","render"],hq:["detection","ocr","color","aiTranslate","inpaint","render"],proofread:["aiTranslate","render"],removeText:["detection","inpaint","render"]},oo={detection:"æ°”æ³¡æ£€æµ‹",ocr:"æ–‡å­—è¯†åˆ«",color:"é¢œè‰²æå–",translate:"ç¿»è¯‘",aiTranslate:"AIç¿»è¯‘",inpaint:"èƒŒæ™¯ä¿®å¤",render:"æ¸²æŸ“"};function Al(){const s=Qe(),t=ct(),n=Ue(),o=mn(),l=rt(),{progress:i,reporter:a}=Bl(),r=_(!1),h=_(null);let T=null,S="standard";const M=K(()=>r.value||s.isBatchTranslationInProgress),L=K(()=>i.value.percentage||0);function D(){const d=n.settings.translation.rpmLimit;h.value?h.value.setRpm(d):h.value=Os(d)}function U(d){const m=d.mode==="hq"?"hq":d.mode==="proofread"?"proofread":d.mode==="removeText"?"ocr":"normal";return o.validateBeforeTranslation(m)}function w(){const{textStyle:d}=n.settings,m=d.layoutDirection;T={fontFamily:d.fontFamily,fontSize:d.fontSize,autoFontSize:d.autoFontSize,autoTextDirection:m==="auto",textDirection:m==="auto"?"vertical":m,layoutDirection:m,fillColor:d.fillColor,textColor:d.textColor,rotationAngle:0,strokeEnabled:d.strokeEnabled,strokeColor:d.strokeColor,strokeWidth:d.strokeWidth,useAutoTextColor:d.useAutoTextColor}}function W(d){return d.includes("base64,")?d.split("base64,")[1]||"":d}function q(d){const m=s.images;if(d.scope==="current"){const x=s.currentImage;return x?[{image:x,index:s.currentImageIndex}]:[]}return d.scope==="failed"?s.getFailedImageIndices().map(x=>({image:m[x],index:x})).filter(x=>x.image!==void 0):m.map((x,b)=>({image:x,index:b}))}async function O(d){const m=n.settings,x=W(d.image.originalDataURL),b=await vn({image:x,detector_type:m.textDetector,box_expand_ratio:m.boxExpand.ratio,box_expand_top:m.boxExpand.top,box_expand_bottom:m.boxExpand.bottom,box_expand_left:m.boxExpand.left,box_expand_right:m.boxExpand.right});if(!b.success)throw new Error(b.error||"æ£€æµ‹å¤±è´¥");d.bubbleCoords=b.bubble_coords||[],d.bubbleAngles=b.bubble_angles||[],d.bubblePolygons=b.bubble_polygons||[],d.autoDirections=b.auto_directions||[],d.rawMask=b.raw_mask,d.textlinesPerBubble=b.textlines_per_bubble||[]}async function f(d){if(d.bubbleCoords.length===0){d.originalTexts=[];return}const m=n.settings,x=W(d.image.originalDataURL),b=await fn({image:x,bubble_coords:d.bubbleCoords,source_language:m.sourceLanguage,ocr_engine:m.ocrEngine,baidu_api_key:m.baiduOcr?.apiKey,baidu_secret_key:m.baiduOcr?.secretKey,baidu_version:m.baiduOcr?.version,baidu_ocr_language:m.baiduOcr?.sourceLanguage,ai_vision_provider:m.aiVisionOcr?.provider,ai_vision_api_key:m.aiVisionOcr?.apiKey,ai_vision_model_name:m.aiVisionOcr?.modelName,ai_vision_ocr_prompt:m.aiVisionOcr?.prompt,custom_ai_vision_base_url:m.aiVisionOcr?.customBaseUrl,textlines_per_bubble:d.textlinesPerBubble});if(!b.success)throw new Error(b.error||"OCRå¤±è´¥");d.originalTexts=b.original_texts||[]}async function c(d){if(d.bubbleCoords.length===0){d.colors=[];return}const m=W(d.image.originalDataURL),x=await bn({image:m,bubble_coords:d.bubbleCoords,textlines_per_bubble:d.textlinesPerBubble});if(!x.success)throw new Error(x.error||"é¢œè‰²æå–å¤±è´¥");d.colors=x.colors||[]}async function k(d){if(d.originalTexts.length===0){d.translatedTexts=[],d.textboxTexts=[];return}const m=n.settings,x=await hn({original_texts:d.originalTexts,target_language:m.targetLanguage,source_language:m.sourceLanguage,model_provider:m.translation.provider,model_name:m.translation.modelName,api_key:m.translation.apiKey,custom_base_url:m.translation.customBaseUrl,prompt_content:m.translatePrompt,textbox_prompt_content:m.textboxPrompt,use_textbox_prompt:m.useTextboxPrompt,rpm_limit:m.translation.rpmLimit,max_retries:m.translation.maxRetries,use_json_format:m.translation.isJsonMode});if(!x.success)throw new Error(x.error||"ç¿»è¯‘å¤±è´¥");d.translatedTexts=x.translated_texts||[],d.textboxTexts=x.textbox_texts||[]}async function C(d){const m=n.settings,x=S==="proofread",b=d.map(j=>x?{imageIndex:j.imageIndex,bubbles:(j.image.bubbleStates||[]).map((le,_e)=>({bubbleIndex:_e,original:le.originalText||"",translated:m.useTextboxPrompt?le.textboxText||le.translatedText||"":le.translatedText||"",textDirection:le.textDirection==="vertical"||le.textDirection==="horizontal"?le.textDirection:le.autoTextDirection==="vertical"||le.autoTextDirection==="horizontal"?le.autoTextDirection:"vertical"}))}:{imageIndex:j.imageIndex,bubbles:j.originalTexts.map((le,_e)=>({bubbleIndex:_e,original:le,translated:"",textDirection:j.autoDirections[_e]||"vertical"}))}),p=d.map(j=>{const le=x&&j.image.translatedDataURL||j.image.originalDataURL;return W(le)}),g=x?m.proofreading.rounds[0]:m.hqTranslation,E=x?g?.prompt:m.hqTranslation.prompt,H=x?"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘æ ¡å¯¹åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹æ£€æŸ¥å’Œä¿®æ­£ç¿»è¯‘ã€‚":"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹å’Œä¸Šä¸‹æ–‡æä¾›é«˜è´¨é‡çš„ç¿»è¯‘ã€‚",I=JSON.stringify(b,null,2),$=[{type:"text",text:(E||"")+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®:
\`\`\`json
`+I+"\n```"}];for(const j of p)$.push({type:"image_url",image_url:{url:`data:image/png;base64,${j}`}});const R=[{role:"system",content:H},{role:"user",content:$}],v=m.hqTranslation,B=x?g:null,u=await Rt({provider:(x?B?.provider:v.provider)||"openai",api_key:(x?B?.apiKey:v.apiKey)||"",model_name:(x?B?.modelName:v.modelName)||"",custom_base_url:x?B?.customBaseUrl:v.customBaseUrl,messages:R,low_reasoning:x?B?.lowReasoning:v.lowReasoning,force_json_output:x?B?.forceJsonOutput:v.forceJsonOutput,no_thinking_method:x?B?.noThinkingMethod:v.noThinkingMethod,use_stream:x?!1:v.useStream,max_retries:x?m.proofreading.maxRetries||2:v.maxRetries||2}),y=x?B?.forceJsonOutput||!1:v.forceJsonOutput;let F=ie(u,y)||b;if(x&&m.proofreading.rounds.length>1)for(let j=1;j<m.proofreading.rounds.length;j++){const le=m.proofreading.rounds[j],_e=JSON.stringify(F,null,2),$e=[{type:"text",text:le.prompt+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®:
\`\`\`json
`+_e+"\n```"}];for(const J of p)$e.push({type:"image_url",image_url:{url:`data:image/png;base64,${J}`}});const Ee=[{role:"system",content:H},{role:"user",content:$e}],Me=await Rt({provider:le.provider,api_key:le.apiKey,model_name:le.modelName,custom_base_url:le.customBaseUrl,messages:Ee,low_reasoning:le.lowReasoning,force_json_output:le.forceJsonOutput,no_thinking_method:le.noThinkingMethod,use_stream:!1,max_retries:le.maxRetries||m.proofreading.maxRetries||2}),se=ie(Me,le.forceJsonOutput);se&&(F=se)}for(const j of d){const le=F?.find(_e=>_e.imageIndex===j.imageIndex);le?j.translatedTexts=le.bubbles.map(_e=>_e.translated):j.translatedTexts=[],j.textboxTexts=[]}}async function N(d){if(d.bubbleCoords.length===0){d.cleanImage=W(d.image.originalDataURL);return}const m=n.settings,{textStyle:x,preciseMask:b}=m,p=W(d.image.originalDataURL),g=await yn({image:p,bubble_coords:d.bubbleCoords,bubble_polygons:d.bubblePolygons,raw_mask:d.rawMask,method:x.inpaintMethod==="solid"?"solid":"lama",lama_model:x.inpaintMethod==="litelama"?"litelama":"lama_mpe",fill_color:x.fillColor,mask_dilate_size:b.dilateSize,mask_box_expand_ratio:b.boxExpandRatio});if(!g.success)throw new Error(g.error||"èƒŒæ™¯ä¿®å¤å¤±è´¥");d.cleanImage=g.clean_image}async function Y(d){if(!d.cleanImage)throw new Error("ç¼ºå°‘å¹²å‡€èƒŒæ™¯å›¾ç‰‡");const{textStyle:m}=n.settings,x=T?.autoTextDirection?"auto":T?.textDirection||m.layoutDirection,b=d.bubbleCoords.map((g,E)=>{const H=d.autoDirections[E]||"vertical",I=H==="v"?"vertical":H==="h"?"horizontal":H==="vertical"||H==="horizontal"?H:"vertical",$=x==="vertical"||x==="horizontal"?x:I,R=T?.useAutoTextColor??m.useAutoTextColor;let v=T?.textColor||m.textColor,B=T?.fillColor||m.fillColor;const u=d.colors[E];return R&&u&&(u.textColor&&(v=u.textColor),u.bgColor&&(B=u.bgColor)),{coords:g,polygon:[],position:{x:0,y:0},rotationAngle:d.bubbleAngles[E]||0,originalText:d.originalTexts[E]||"",translatedText:d.translatedTexts[E]||"",textboxText:d.textboxTexts[E]||"",textDirection:$,autoTextDirection:I,fontSize:T?.fontSize||m.fontSize,fontFamily:T?.fontFamily||m.fontFamily,autoFontSize:T?.autoFontSize??m.autoFontSize,textColor:v,fillColor:B,strokeEnabled:T?.strokeEnabled??m.strokeEnabled,strokeColor:T?.strokeColor||m.strokeColor,strokeWidth:T?.strokeWidth||m.strokeWidth,inpaintMethod:m.inpaintMethod,autoFgColor:d.colors[E]?.autoFgColor||null,autoBgColor:d.colors[E]?.autoBgColor||null}}),p=await xn({clean_image:d.cleanImage,bubble_states:b,fontSize:T?.fontSize||m.fontSize,fontFamily:T?.fontFamily||m.fontFamily,textDirection:T?.textDirection||m.layoutDirection,textColor:T?.textColor||m.textColor,strokeEnabled:T?.strokeEnabled??m.strokeEnabled,strokeColor:T?.strokeColor||m.strokeColor,strokeWidth:T?.strokeWidth||m.strokeWidth,autoFontSize:T?.autoFontSize??m.autoFontSize,use_individual_styles:!0});if(!p.success)throw new Error(p.error||"æ¸²æŸ“å¤±è´¥");d.finalImage=p.final_image,d.bubbleStates=p.bubble_states||b}function ie(d,m){if(!d.success)return console.error("APIè°ƒç”¨å¤±è´¥:",d.error),null;if(d.results&&d.results.length>0){const b=d.results[0];if(b&&"imageIndex"in b&&"bubbles"in b)return d.results}const x=d.content;if(x)if(m)try{return JSON.parse(x)}catch{return null}else{const b=x.match(/```json\s*([\s\S]*?)\s*```/);if(b?.[1])try{return JSON.parse(b[1])}catch{return null}}return null}function X(d){const m=d.finalImage?`data:image/png;base64,${d.finalImage}`:d.cleanImage?`data:image/png;base64,${d.cleanImage}`:null;s.updateImageByIndex(d.imageIndex,{translatedDataURL:m,cleanImageData:d.cleanImage||null,bubbleStates:d.bubbleStates,bubbleCoords:d.bubbleCoords,bubbleAngles:d.bubbleAngles,originalTexts:d.originalTexts,textboxTexts:d.textboxTexts,bubbleTexts:d.translatedTexts,translationStatus:"completed",translationFailed:!1,showOriginal:!1,hasUnsavedChanges:!0,userLayoutDirection:T?.layoutDirection,autoFontSize:T?.autoFontSize??!1,useAutoTextColor:T?.useAutoTextColor??!1}),d.imageIndex===s.currentImageIndex&&d.bubbleStates&&t.setBubbles(d.bubbleStates)}async function ae(d){if(!U(d))return{success:!1,completed:0,failed:0,errors:["é…ç½®éªŒè¯å¤±è´¥"]};if(s.images.length===0)return l.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),{success:!1,completed:0,failed:0,errors:["æ²¡æœ‰å›¾ç‰‡"]};S=d.mode;const x=Zo[d.mode];console.log(`ğŸš€ é¡ºåºç®¡çº¿å¯åŠ¨ï¼Œæ¨¡å¼: ${d.mode}, æ­¥éª¤é“¾: [${x.join(" â†’ ")}]`),r.value=!0,(d.scope==="all"||d.scope==="failed")&&s.setBatchTranslationInProgress(!0),D(),w();const b=q(d),p=[];let g=0,E=0;const H=b.map(({image:I,index:$})=>({imageIndex:$,image:I,bubbleCoords:[],bubbleAngles:[],bubblePolygons:[],autoDirections:[],textlinesPerBubble:[],originalTexts:[],colors:[],translatedTexts:[],textboxTexts:[]}));try{a.init(b.length,`${d.mode} æ¨¡å¼å¯åŠ¨...`);for(let $=0;$<x.length;$++){const R=x[$],v=Math.floor($/x.length*90);if(a.setPercentage(v,`æ‰§è¡Œ: ${oo[R]}`),l.info(`æ­¥éª¤ ${$+1}/${x.length}: ${oo[R]}...`),R==="aiTranslate")await C(H);else for(let B=0;B<H.length;B++){const u=H[B];if(d.scope==="all"&&!s.isBatchTranslationInProgress)break;h.value&&await h.value.acquire();try{switch(s.setTranslationStatus(u.imageIndex,"processing"),R){case"detection":await O(u);break;case"ocr":await f(u);break;case"color":await c(u);break;case"translate":await k(u);break;case"inpaint":await N(u);break;case"render":await Y(u),X(u);break}}catch(F){const j=F instanceof Error?F.message:"æœªçŸ¥é”™è¯¯";p.push(`å›¾ç‰‡ ${u.imageIndex}: ${R} - ${j}`),s.setTranslationStatus(u.imageIndex,"failed",j)}const y=Math.floor((B+1)/H.length*100),ue=v+Math.floor(y/100*(90/x.length));a.setPercentage(ue,`${oo[R]}: ${B+1}/${H.length}`)}}for(const $ of H){const R=s.images[$.imageIndex]?.translationStatus;R==="completed"?g++:R==="failed"?E++:x.includes("render")||(X($),g++)}a.setPercentage(100,"å®Œæˆï¼");const I={standard:"ç¿»è¯‘",hq:"é«˜è´¨é‡ç¿»è¯‘",proofread:"AIæ ¡å¯¹",removeText:"æ¶ˆé™¤æ–‡å­—"};return l.success(`${I[d.mode]}å®Œæˆï¼`),{success:E===0,completed:g,failed:E,errors:p.length>0?p:void 0}}catch(I){const $=I instanceof Error?I.message:"æ‰§è¡Œå¤±è´¥";return l.error($),p.push($),{success:!1,completed:0,failed:b.length,errors:p}}finally{r.value=!1,s.setBatchTranslationInProgress(!1);const I=s.currentImageIndex,$=s.images[I];$?.bubbleStates&&$.bubbleStates.length>0&&t.setBubbles($.bubbleStates),setTimeout(()=>a.finish(),1e3)}}function Z(){s.isBatchTranslationInProgress&&(s.setBatchTranslationInProgress(!1),l.info("æ“ä½œå·²å–æ¶ˆ"))}return{progress:i,isExecuting:r,isTranslating:M,progressPercent:L,execute:ae,cancel:Z,STEP_CHAIN_CONFIGS:Zo}}class Ll{currentCount=0;maxCount;waitQueue=[];holders=[];constructor(t=1){this.maxCount=Math.max(1,t)}setSize(t){this.maxCount=Math.max(1,t),this.tryWakeUp()}getSize(){return this.maxCount}async acquire(t){if(this.currentCount<this.maxCount){this.currentCount++,this.holders.push(t);return}return new Promise(n=>{this.waitQueue.push({resolve:n,poolName:t})})}release(t){const n=this.holders.indexOf(t);n>=0&&(this.holders.splice(n,1),this.currentCount--),this.tryWakeUp()}tryWakeUp(){for(;this.currentCount<this.maxCount&&this.waitQueue.length>0;){const t=this.waitQueue.shift();this.currentCount++,this.holders.push(t.poolName),t.resolve()}}async withLock(t,n){await this.acquire(t);try{return await n()}finally{this.release(t)}}getStatus(){return{isLocked:this.currentCount>=this.maxCount,currentCount:this.currentCount,maxCount:this.maxCount,holders:[...this.holders],waitingCount:this.waitQueue.length,waitingPools:this.waitQueue.map(t=>t.poolName)}}isWaiting(t){return this.waitQueue.some(n=>n.poolName===t)}isHolding(t){return this.holders.includes(t)}reset(){this.currentCount=0,this.holders=[];for(const t of this.waitQueue)t.resolve();this.waitQueue=[]}}class St{queue=[];currentTask=null;isRunning=!1;isCancelled=!1;completedCount=0;nextPool;name;icon;lock;progressTracker;onTaskComplete;constructor(t,n,o,l,i,a){this.name=t,this.icon=n,this.nextPool=o,this.lock=l,this.progressTracker=i,this.onTaskComplete=a}getName(){return this.name}getIcon(){return this.icon}setNextPool(t){this.nextPool=t}enqueue(t){this.isCancelled||(this.queue.push(t),this.progressTracker.updatePool(this.name,{waiting:this.queue.length}),this.tryProcessNext())}enqueueBatch(t){if(!this.isCancelled){for(const n of t)this.queue.push(n);this.progressTracker.updatePool(this.name,{waiting:this.queue.length}),this.tryProcessNext()}}async tryProcessNext(){if(!(this.isRunning||this.isCancelled||this.queue.length===0)){this.isRunning=!0,this.currentTask=this.queue.shift(),this.progressTracker.updatePool(this.name,{waiting:this.queue.length,isProcessing:!0,currentPage:this.currentTask.imageIndex+1,isWaitingLock:!1});try{let t;this.lock?(this.progressTracker.updatePool(this.name,{isWaitingLock:!0}),t=await this.lock.withLock(this.name,async()=>(this.progressTracker.updatePool(this.name,{isWaitingLock:!1}),await this.process(this.currentTask)))):t=await this.process(this.currentTask),this.completedCount++,this.progressTracker.updatePool(this.name,{completed:this.completedCount}),this.nextPool&&t.status!=="failed"&&t.status!=="buffered"&&this.nextPool.enqueue(t),this.onTaskComplete?.(t)}catch(t){this.currentTask.status="failed",this.currentTask.error=t.message,console.error(`[${this.name}] å¤„ç†ä»»åŠ¡å¤±è´¥:`,t),this.onTaskComplete?.(this.currentTask)}finally{this.currentTask=null,this.isRunning=!1,this.progressTracker.updatePool(this.name,{isProcessing:!1,currentPage:void 0}),this.tryProcessNext()}}}getStatus(){return{name:this.name,icon:this.icon,waiting:this.queue.length,processing:this.isRunning,currentPage:this.currentTask?.imageIndex,completed:this.completedCount,isWaitingLock:this.lock?.isWaiting(this.name)??!1}}cancel(){this.isCancelled=!0,this.queue=[]}reset(){this.isCancelled=!1,this.queue=[],this.currentTask=null,this.isRunning=!1,this.completedCount=0}getCompletedCount(){return this.completedCount}getWaitingCount(){return this.queue.length}isProcessing(){return this.isRunning}}const Fl=[{name:"æ£€æµ‹",icon:"ğŸ“"},{name:"OCR",icon:"ğŸ“–"},{name:"é¢œè‰²",icon:"ğŸ¨"},{name:"ç¿»è¯‘",icon:"ğŸŒ"},{name:"ä¿®å¤",icon:"ğŸ–Œï¸"},{name:"æ¸²æŸ“",icon:"âœ¨"}];class Ul{poolStatuses=new Map;totalPages=0;startTime=0;progress=ro({pools:[],totalCompleted:0,totalFailed:0,totalPages:0,estimatedTimeRemaining:0});constructor(){this.initPools()}initPools(){for(const t of Fl){const n={name:t.name,icon:t.icon,waiting:0,processing:!1,completed:0,isWaitingLock:!1};this.poolStatuses.set(t.name,n)}this.syncToReactive()}init(t){this.totalPages=t,this.startTime=Date.now();for(const n of this.poolStatuses.values())n.waiting=0,n.processing=!1,n.currentPage=void 0,n.completed=0,n.isWaitingLock=!1;this.progress.totalCompleted=0,this.progress.totalFailed=0,this.progress.totalPages=t,this.progress.estimatedTimeRemaining=0,this.syncToReactive()}updatePool(t,n){const o=this.poolStatuses.get(t);o&&(n.waiting!==void 0&&(o.waiting=n.waiting),n.isProcessing!==void 0&&(o.processing=n.isProcessing),n.currentPage!==void 0&&(o.currentPage=n.currentPage),n.completed!==void 0&&(o.completed=n.completed),n.isWaitingLock!==void 0&&(o.isWaitingLock=n.isWaitingLock),this.syncToReactive(),this.updateEstimatedTime())}incrementCompleted(){this.progress.totalCompleted++,this.updateEstimatedTime()}incrementFailed(){this.progress.totalFailed++}updateEstimatedTime(){if(this.progress.totalCompleted===0){this.progress.estimatedTimeRemaining=0;return}const n=(Date.now()-this.startTime)/1e3/this.progress.totalCompleted,o=this.totalPages-this.progress.totalCompleted-this.progress.totalFailed;this.progress.estimatedTimeRemaining=Math.ceil(n*o)}syncToReactive(){this.progress.pools=Array.from(this.poolStatuses.values()).map(t=>({...t}))}getPoolStatus(t){return this.poolStatuses.get(t)}getAllPoolStatuses(){return Array.from(this.poolStatuses.values())}getProgress(){return{...this.progress}}reset(){this.totalPages=0,this.startTime=0,this.initPools()}formatRemainingTime(){const t=this.progress.estimatedTimeRemaining;if(t<=0)return"--";const n=Math.floor(t/60),o=t%60;return n>0?`${n}åˆ†${o}ç§’`:`${o}ç§’`}}class Ol{results=new Map;totalExpected=0;completedCount=0;failedCount=0;resolveWaitAll=null;init(t){this.results.clear(),this.totalExpected=t,this.completedCount=0,this.failedCount=0,this.resolveWaitAll=null}add(t){this.results.set(t.imageIndex,t),t.status==="completed"?this.completedCount++:t.status==="failed"&&this.failedCount++,this.completedCount+this.failedCount>=this.totalExpected&&this.resolveWaitAll&&(this.resolveWaitAll({success:this.completedCount,failed:this.failedCount}),this.resolveWaitAll=null)}waitForAll(t){return this.totalExpected=t,this.completedCount+this.failedCount>=t?Promise.resolve({success:this.completedCount,failed:this.failedCount}):new Promise(n=>{this.resolveWaitAll=n})}get(t){return this.results.get(t)}getAll(){return Array.from(this.results.values()).sort((t,n)=>t.imageIndex-n.imageIndex)}getSuccessful(){return this.getAll().filter(t=>t.status==="completed")}getFailed(){return this.getAll().filter(t=>t.status==="failed")}getStats(){return{total:this.totalExpected,completed:this.completedCount,failed:this.failedCount,pending:this.totalExpected-this.completedCount-this.failedCount}}reset(){this.results.clear(),this.totalExpected=0,this.completedCount=0,this.failedCount=0,this.resolveWaitAll=null}}class zl extends St{constructor(t,n,o,l){super("æ£€æµ‹","ğŸ“",t,n,o,l)}async process(t){const{imageData:n}=t,l=Ue().settings,i=this.extractBase64(n.originalDataURL),a=await vn({image:i,detector_type:l.textDetector,box_expand_ratio:l.boxExpand.ratio,box_expand_top:l.boxExpand.top,box_expand_bottom:l.boxExpand.bottom,box_expand_left:l.boxExpand.left,box_expand_right:l.boxExpand.right});if(!a.success)throw new Error(a.error||"æ£€æµ‹å¤±è´¥");return t.detectionResult={bubbleCoords:a.bubble_coords||[],bubbleAngles:a.bubble_angles||[],bubblePolygons:a.bubble_polygons||[],autoDirections:a.auto_directions||[],rawMask:a.raw_mask,textlinesPerBubble:a.textlines_per_bubble||[]},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}class Nl extends St{constructor(t,n,o,l){super("OCR","ğŸ“–",t,n,o,l)}async process(t){const{imageData:n,detectionResult:o}=t,i=Ue().settings;if(!o||o.bubbleCoords.length===0)return t.ocrResult={originalTexts:[],textlinesPerBubble:[]},t.status="processing",t;const a=this.extractBase64(n.originalDataURL),r=await fn({image:a,bubble_coords:o.bubbleCoords,source_language:i.sourceLanguage,ocr_engine:i.ocrEngine,baidu_api_key:i.baiduOcr?.apiKey,baidu_secret_key:i.baiduOcr?.secretKey,baidu_version:i.baiduOcr?.version,baidu_ocr_language:i.baiduOcr?.sourceLanguage,ai_vision_provider:i.aiVisionOcr?.provider,ai_vision_api_key:i.aiVisionOcr?.apiKey,ai_vision_model_name:i.aiVisionOcr?.modelName,ai_vision_ocr_prompt:i.aiVisionOcr?.prompt,custom_ai_vision_base_url:i.aiVisionOcr?.customBaseUrl,textlines_per_bubble:o.textlinesPerBubble});if(!r.success)throw new Error(r.error||"OCRå¤±è´¥");return t.ocrResult={originalTexts:r.original_texts||[],textlinesPerBubble:r.textlines_per_bubble||[]},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}class Vl extends St{constructor(t,n,o,l){super("é¢œè‰²","ğŸ¨",t,n,o,l)}async process(t){const{imageData:n,detectionResult:o,ocrResult:l}=t;if(!o||o.bubbleCoords.length===0)return t.colorResult={colors:[]},t.status="processing",t;const i=this.extractBase64(n.originalDataURL),a=await bn({image:i,bubble_coords:o.bubbleCoords,textlines_per_bubble:l?.textlinesPerBubble||o.textlinesPerBubble});if(!a.success)throw new Error(a.error||"é¢œè‰²æå–å¤±è´¥");return t.colorResult={colors:a.colors||[]},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}class Wl extends St{mode="standard";batchBuffer=[];totalTasks=0;processedCount=0;constructor(t,n,o){super("ç¿»è¯‘","ğŸŒ",t,null,n,o)}setMode(t,n,o){this.mode=t,this.totalTasks=n,this.batchBuffer=[],this.processedCount=0,this.nextPool=o}async process(t){switch(this.mode){case"standard":return this.handleStandardTranslate(t);case"hq":return this.handleHqTranslate(t);case"proofread":return this.handleProofread(t);case"removeText":return this.handleRemoveTextOnly(t);default:return t}}async handleStandardTranslate(t){const o=Ue().settings;if(!t.ocrResult||t.ocrResult.originalTexts.length===0)return t.translateResult={translatedTexts:[],textboxTexts:[]},t.status="processing",t;const l=await hn({original_texts:t.ocrResult.originalTexts,target_language:o.targetLanguage,source_language:o.sourceLanguage,model_provider:o.translation.provider,model_name:o.translation.modelName,api_key:o.translation.apiKey,custom_base_url:o.translation.customBaseUrl,prompt_content:o.translatePrompt,textbox_prompt_content:o.textboxPrompt,use_textbox_prompt:o.useTextboxPrompt,rpm_limit:o.translation.rpmLimit,max_retries:o.translation.maxRetries,use_json_format:o.translation.isJsonMode});if(!l.success)throw new Error(l.error||"ç¿»è¯‘å¤±è´¥");return t.translateResult={translatedTexts:l.translated_texts||[],textboxTexts:l.textbox_texts||[]},t.status="processing",t}async handleHqTranslate(t){this.batchBuffer.push(t),this.processedCount++;const n=Ue(),{hqTranslation:o}=n.settings,l=o.batchSize||3,i=this.processedCount>=this.totalTasks;if(!(this.batchBuffer.length>=l||i))return t.status="buffered",t;const r=[...this.batchBuffer];this.batchBuffer=[];const h=r.map(w=>({imageIndex:w.imageIndex,bubbles:(w.ocrResult?.originalTexts||[]).map((W,q)=>({bubbleIndex:q,original:W,translated:"",textDirection:w.detectionResult?.autoDirections[q]||"vertical"}))})),T=r.map(w=>this.extractBase64(w.imageData.originalDataURL)),S=JSON.stringify(h,null,2),M=[{type:"text",text:o.prompt+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®:
\`\`\`json
`+S+"\n```"}];for(const w of T)M.push({type:"image_url",image_url:{url:`data:image/png;base64,${w}`}});const L=[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹å’Œä¸Šä¸‹æ–‡æä¾›é«˜è´¨é‡çš„ç¿»è¯‘ã€‚"},{role:"user",content:M}],D=await Rt({provider:o.provider,api_key:o.apiKey,model_name:o.modelName,custom_base_url:o.customBaseUrl,messages:L,low_reasoning:o.lowReasoning,force_json_output:o.forceJsonOutput,no_thinking_method:o.noThinkingMethod,use_stream:o.useStream,max_retries:o.maxRetries||2}),U=this.parseHqResponse(D,o.forceJsonOutput);for(const w of r){const W=U?.find(q=>q.imageIndex===w.imageIndex);W?w.translateResult={translatedTexts:W.bubbles.map(q=>q.translated),textboxTexts:[]}:w.translateResult={translatedTexts:[],textboxTexts:[]},w.status="processing",this.nextPool&&this.nextPool.enqueue(w)}return t}async handleProofread(t){this.batchBuffer.push(t),this.processedCount++;const n=Ue(),{proofreading:o,useTextboxPrompt:l}=n.settings,i=o.rounds[0]?.batchSize||3,a=this.processedCount>=this.totalTasks;if(!(this.batchBuffer.length>=i||a))return t.status="buffered",t;const h=[...this.batchBuffer];this.batchBuffer=[];const T=h.map(L=>({imageIndex:L.imageIndex,bubbles:(L.imageData.bubbleStates||[]).map((D,U)=>({bubbleIndex:U,original:D.originalText||"",translated:l?D.textboxText||D.translatedText||"":D.translatedText||"",textDirection:D.textDirection==="vertical"||D.textDirection==="horizontal"?D.textDirection:D.autoTextDirection==="vertical"||D.autoTextDirection==="horizontal"?D.autoTextDirection:"vertical"}))})),S=h.map(L=>{const D=L.imageData.translatedDataURL||L.imageData.originalDataURL;return this.extractBase64(D)});let M=T;for(const L of o.rounds){const D=JSON.stringify(M,null,2),U=[{type:"text",text:L.prompt+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®:
\`\`\`json
`+D+"\n```"}];for(const O of S)U.push({type:"image_url",image_url:{url:`data:image/png;base64,${O}`}});const w=[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘æ ¡å¯¹åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹æ£€æŸ¥å’Œä¿®æ­£ç¿»è¯‘ã€‚"},{role:"user",content:U}],W=await Rt({provider:L.provider,api_key:L.apiKey,model_name:L.modelName,custom_base_url:L.customBaseUrl,messages:w,low_reasoning:L.lowReasoning,force_json_output:L.forceJsonOutput,no_thinking_method:L.noThinkingMethod,use_stream:!1,max_retries:L.maxRetries||o.maxRetries||2}),q=this.parseHqResponse(W,L.forceJsonOutput);q&&(M=q)}for(const L of h){const D=M.find(U=>U.imageIndex===L.imageIndex);D?L.translateResult={translatedTexts:D.bubbles.map(U=>U.translated),textboxTexts:[]}:L.translateResult={translatedTexts:[],textboxTexts:[]},L.status="processing",this.nextPool&&this.nextPool.enqueue(L)}return t}async handleRemoveTextOnly(t){return t.translateResult={translatedTexts:[],textboxTexts:[]},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}parseHqResponse(t,n){if(!t.success)return console.error("APIè°ƒç”¨å¤±è´¥:",t.error),null;if(t.results&&t.results.length>0){const l=t.results[0];if(l&&"imageIndex"in l&&"bubbles"in l)return t.results}const o=t.content;if(o)if(n)try{return JSON.parse(o)}catch(l){return console.error("è§£æAIå¼ºåˆ¶JSONè¿”å›çš„å†…å®¹å¤±è´¥:",l),null}else{const l=o.match(/```json\s*([\s\S]*?)\s*```/);if(l?.[1])try{return JSON.parse(l[1])}catch(i){return console.error("è§£æAIè¿”å›çš„JSONå¤±è´¥:",i),null}}return null}}class Kl extends St{constructor(t,n,o,l){super("ä¿®å¤","ğŸ–Œï¸",t,n,o,l)}async process(t){const{imageData:n,detectionResult:o}=t,i=Ue().settings;if(!o||o.bubbleCoords.length===0)return t.inpaintResult={cleanImage:this.extractBase64(n.originalDataURL)},t.status="processing",t;const a=this.extractBase64(n.originalDataURL),r=i.textStyle.inpaintMethod,h=r==="lama_mpe"||r==="litelama",T=await yn({image:a,bubble_coords:o.bubbleCoords,bubble_polygons:o.bubblePolygons,raw_mask:o.rawMask,method:h?"lama":"solid",lama_model:h?r:void 0,fill_color:i.textStyle.fillColor,mask_dilate_size:i.preciseMask.dilateSize,mask_box_expand_ratio:i.preciseMask.boxExpandRatio});if(!T.success)throw new Error(T.error||"ä¿®å¤å¤±è´¥");return t.inpaintResult={cleanImage:T.clean_image||""},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}class ql extends St{resultCollector;constructor(t,n,o){super("æ¸²æŸ“","âœ¨",null,null,t,o),this.resultCollector=n}async process(t){const n=Qe(),o=ct(),l=Ue(),i=this.buildBubbleStates(t,l);if(i.length===0){const h=t.inpaintResult?.cleanImage||t.imageData.cleanImageData||this.extractBase64(t.imageData.originalDataURL);return t.renderResult={finalImage:h,bubbleStates:[]},t.status="completed",this.updateImageToUI(t,n,o,l),this.resultCollector.add(t),t}const a=t.inpaintResult?.cleanImage||t.imageData.cleanImageData||this.extractBase64(t.imageData.translatedDataURL||t.imageData.originalDataURL),r=await xn({clean_image:a,bubble_states:i,fontSize:l.settings.textStyle.fontSize,fontFamily:l.settings.textStyle.fontFamily,textDirection:l.settings.textStyle.layoutDirection,textColor:l.settings.textStyle.textColor,strokeEnabled:l.settings.textStyle.strokeEnabled,strokeColor:l.settings.textStyle.strokeColor,strokeWidth:l.settings.textStyle.strokeWidth,autoFontSize:l.settings.textStyle.autoFontSize,use_individual_styles:!0});if(!r.success)throw new Error(r.error||"æ¸²æŸ“å¤±è´¥");return t.renderResult={finalImage:r.final_image||"",bubbleStates:r.bubble_states||i},t.status="completed",this.updateImageToUI(t,n,o,l),this.resultCollector.add(t),t}updateImageToUI(t,n,o,l){const i=t.imageIndex,a=(t.detectionResult?.bubbleCoords||[]).map(r=>r.length>=4?[r[0],r[1],r[2],r[3]]:[0,0,0,0]);n.updateImageByIndex(i,{translatedDataURL:`data:image/png;base64,${t.renderResult.finalImage}`,cleanImageData:t.inpaintResult?.cleanImage||null,bubbleStates:t.renderResult.bubbleStates,bubbleCoords:a,bubbleAngles:t.detectionResult?.bubbleAngles||[],originalTexts:t.ocrResult?.originalTexts||[],bubbleTexts:t.translateResult?.translatedTexts||[],textboxTexts:t.translateResult?.textboxTexts||[],translationStatus:"completed",translationFailed:!1,showOriginal:!1,hasUnsavedChanges:!0,userLayoutDirection:l.settings.textStyle.layoutDirection,autoFontSize:l.settings.textStyle.autoFontSize,useAutoTextColor:l.settings.textStyle.useAutoTextColor}),i===n.currentImageIndex&&t.renderResult?.bubbleStates&&o.setBubbles(t.renderResult.bubbleStates),this.progressTracker.incrementCompleted(),console.log(`âœ… å›¾ç‰‡ ${i+1} æ¸²æŸ“å®Œæˆå¹¶å·²æ›´æ–°åˆ°ç•Œé¢`)}buildBubbleStates(t,n){if(!t.detectionResult&&t.imageData.bubbleStates&&t.imageData.bubbleStates.length>0){const M=t.translateResult?.translatedTexts||[];return t.imageData.bubbleStates.map((L,D)=>({...L,translatedText:M[D]||L.translatedText||""}))}if(t.detectionResult&&!t.translateResult)return console.log(`[æ¸²æŸ“æ± ] å›¾ç‰‡ ${t.imageIndex+1}: æ£€æµ‹åˆ°æ¶ˆé™¤æ–‡å­—æ¨¡å¼ï¼ˆæ— ç¿»è¯‘ç»“æœï¼‰ï¼Œè·³è¿‡æ¸²æŸ“`),[];const o=t.detectionResult?.bubbleCoords||[],l=t.translateResult?.translatedTexts||[],i=t.ocrResult?.originalTexts||[],a=t.colorResult?.colors||[],r=t.detectionResult?.bubbleAngles||[],h=t.detectionResult?.autoDirections||[],T=t.detectionResult?.bubblePolygons||[],S=n.settings;return o.map((M,L)=>{const D=h[L],U=D==="v"?"vertical":D==="h"?"horizontal":"vertical",w=S.textStyle.layoutDirection,W=w==="vertical"||w==="horizontal"?w:U;let q=S.textStyle.textColor,O=S.textStyle.fillColor;const f=a[L];return S.textStyle.useAutoTextColor&&f&&(f.textColor&&(q=f.textColor),f.bgColor&&(O=f.bgColor)),{originalText:i[L]||"",translatedText:l[L]||"",textboxText:"",coords:M.length>=4?[M[0],M[1],M[2],M[3]]:[0,0,0,0],polygon:T[L]||[],fontSize:S.textStyle.fontSize,fontFamily:S.textStyle.fontFamily,textDirection:W,autoTextDirection:U,textColor:q,fillColor:O,rotationAngle:r[L]||0,position:{x:0,y:0},strokeEnabled:S.textStyle.strokeEnabled,strokeColor:S.textStyle.strokeColor,strokeWidth:S.textStyle.strokeWidth,inpaintMethod:S.textStyle.inpaintMethod,autoFgColor:f?.autoFgColor||null,autoBgColor:f?.autoBgColor||null}})}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}const Qo={standard:["detection","ocr","color","translate","inpaint","render"],hq:["detection","ocr","color","translate","inpaint","render"],proofread:["translate","render"],removeText:["detection","inpaint","render"]};class Hl{lock;progressTracker;resultCollector;detectionPool;ocrPool;colorPool;translatePool;inpaintPool;renderPool;isCancelled=!1;config;constructor(t){this.config=t,this.lock=new Ll(t.deepLearningLockSize),this.progressTracker=new Ul,this.resultCollector=new Ol,this.renderPool=new ql(this.progressTracker,this.resultCollector),this.inpaintPool=new Kl(this.renderPool,this.lock,this.progressTracker),this.translatePool=new Wl(this.inpaintPool,this.progressTracker),this.colorPool=new Vl(this.translatePool,this.lock,this.progressTracker),this.ocrPool=new Nl(this.colorPool,this.lock,this.progressTracker),this.detectionPool=new zl(this.ocrPool,this.lock,this.progressTracker)}updateConfig(t){t.deepLearningLockSize!==void 0&&(this.lock.setSize(t.deepLearningLockSize),this.config.deepLearningLockSize=t.deepLearningLockSize),t.enabled!==void 0&&(this.config.enabled=t.enabled)}async execute(t,n){this.reset(),this.progressTracker.init(t.length),this.resultCollector.init(t.length),this.setupPoolChain(n,t.length);const o=t.map((a,r)=>({id:`task-${r}`,imageIndex:r,imageData:a,status:"pending"})),l=this.getEntryPool(n);for(const a of o)l.enqueue(a);const i=await this.resultCollector.waitForAll(t.length);return{success:i.success,failed:i.failed,errors:this.resultCollector.getFailed().map(a=>a.error||"æœªçŸ¥é”™è¯¯")}}setupPoolChain(t,n){const o=Qo[t],l=this.getPoolMap();for(let h=0;h<o.length-1;h++){const T=o[h],S=o[h+1],M=l[T],L=l[S];M&&L&&M.setNextPool(L)}const i=o[o.length-1],a=l[i];a&&a.setNextPool(null);const r=o.indexOf("translate");if(r>=0&&r<o.length-1){const h=o[r+1];this.translatePool.setMode(t,n,l[h]||null)}else r===o.length-1&&this.translatePool.setMode(t,n,null)}getPoolMap(){return{detection:this.detectionPool,ocr:this.ocrPool,color:this.colorPool,translate:this.translatePool,inpaint:this.inpaintPool,render:this.renderPool}}getEntryPool(t){const o=Qo[t][0];return this.getPoolMap()[o]||this.detectionPool}cancel(){this.isCancelled=!0,this.detectionPool.cancel(),this.ocrPool.cancel(),this.colorPool.cancel(),this.translatePool.cancel(),this.inpaintPool.cancel(),this.renderPool.cancel(),this.lock.reset()}reset(){this.isCancelled=!1,this.detectionPool.reset(),this.ocrPool.reset(),this.colorPool.reset(),this.translatePool.reset(),this.inpaintPool.reset(),this.renderPool.reset(),this.resultCollector.reset(),this.progressTracker.reset()}get progress(){return this.progressTracker.progress}getProgressTracker(){return this.progressTracker}getLockStatus(){return this.lock.getStatus()}get cancelled(){return this.isCancelled}}function jl(s){return new Hl(s)}const mt=ro({pools:[{name:"æ£€æµ‹",icon:"ğŸ“",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"OCR",icon:"ğŸ“–",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"é¢œè‰²",icon:"ğŸ¨",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"ç¿»è¯‘",icon:"ğŸŒ",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"ä¿®å¤",icon:"ğŸ–Œï¸",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"æ¸²æŸ“",icon:"âœ¨",waiting:0,processing:!1,completed:0,isWaitingLock:!1}],totalCompleted:0,totalFailed:0,totalPages:0,estimatedTimeRemaining:0}),Jl=_(!1);function _n(){const s=Qe(),t=Ue(),n=es(null),o=K(()=>t.settings.parallel),l=K(()=>o.value?.enabled??!1),i=Jl,a=K(()=>mt);function r(){const L=t.settings;return L.proofreading?.enabled&&L.proofreading.rounds.length>0?"proofread":["gemini","openai","claude","deepseek"].includes(L.hqTranslation?.provider||"")&&L.hqTranslation?.apiKey?"hq":"standard"}function h(){if(!n.value)return;const L=n.value.progress;L&&(mt.pools=L.pools.map(D=>({...D})),mt.totalCompleted=L.totalCompleted,mt.totalFailed=L.totalFailed,mt.totalPages=L.totalPages,mt.estimatedTimeRemaining=L.estimatedTimeRemaining)}async function T(L){if(i.value)return{success:0,failed:0,errors:["ç¿»è¯‘æ­£åœ¨è¿›è¡Œä¸­"]};const D=s.images;if(D.length===0)return{success:0,failed:0,errors:["æ²¡æœ‰å›¾ç‰‡"]};i.value=!0,mt.totalPages=D.length,mt.totalCompleted=0,mt.totalFailed=0;const U=setInterval(h,200);try{n.value=jl({enabled:!0,deepLearningLockSize:o.value?.deepLearningLockSize??1});const w=L??r();console.log(`ğŸš€ å¼€å§‹å¹¶è¡Œç¿»è¯‘ï¼Œæ¨¡å¼: ${w}ï¼Œå›¾ç‰‡æ•°: ${D.length}`);const W=await n.value.execute(D,w);return h(),console.log(`âœ… å¹¶è¡Œç¿»è¯‘å®Œæˆï¼ŒæˆåŠŸ: ${W.success}ï¼Œå¤±è´¥: ${W.failed}`),W}catch(w){return console.error("å¹¶è¡Œç¿»è¯‘å‡ºé”™:",w),{success:0,failed:D.length,errors:[w.message]}}finally{clearInterval(U),i.value=!1}}function S(){n.value&&n.value.cancel(),i.value=!1}function M(){n.value=null,i.value=!1}return{isEnabled:l,isRunning:i,progress:a,executeParallel:T,cancel:S,reset:M,determineMode:r}}function Gl(){const s=Qe(),t=Ue(),n=rt(),o=Al(),l=_n(),i=K(()=>o.isTranslating.value||s.isBatchTranslationInProgress),a=K(()=>o.progressPercent.value);async function r(S){return s.images.length===0?(n.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),{success:!1,completed:0,failed:0,errors:["æ²¡æœ‰å›¾ç‰‡"]}):t.settings.parallel?.enabled&&S.scope==="all"?(console.log(`ğŸš€ ä½¿ç”¨å¹¶è¡Œç®¡çº¿ï¼Œæ¨¡å¼: ${S.mode}`),h(S)):(console.log(`ğŸš€ ä½¿ç”¨é¡ºåºç®¡çº¿ï¼Œæ¨¡å¼: ${S.mode}`),o.execute(S))}async function h(S){const M=s.images;try{const L=S.mode;console.log(`ğŸš€ å¯åŠ¨å¹¶è¡Œç¿»è¯‘æ¨¡å¼: ${L}`),n.info(`å¹¶è¡Œç¿»è¯‘å¼€å§‹ï¼Œæ¨¡å¼: ${L}`);const D=await l.executeParallel(L);return D.success>0&&D.failed===0?n.success(`å¹¶è¡Œç¿»è¯‘å®Œæˆï¼ŒæˆåŠŸå¤„ç† ${D.success} å¼ å›¾ç‰‡`):D.success>0&&D.failed>0?n.warning(`å¹¶è¡Œç¿»è¯‘å®Œæˆï¼ŒæˆåŠŸ ${D.success} å¼ ï¼Œå¤±è´¥ ${D.failed} å¼ `):n.error("å¹¶è¡Œç¿»è¯‘å¤±è´¥"),{success:D.failed===0,completed:D.success,failed:D.failed,errors:D.errors}}catch(L){const D=L instanceof Error?L.message:"å¹¶è¡Œç¿»è¯‘å‡ºé”™";return n.error(D),{success:!1,completed:0,failed:M.length,errors:[D]}}}function T(){o.cancel(),l.cancel()}return{progress:o.progress,isExecuting:o.isExecuting,isTranslating:i,progressPercent:a,execute:r,cancel:T,STEP_CHAIN_CONFIGS:o.STEP_CHAIN_CONFIGS}}function At(s="current"){return{mode:"standard",scope:s}}function Yl(s){return{mode:"hq",scope:"all",batchOptions:{batchSize:3,maxRetries:2,rpmLimit:10,sessionResetFrequency:5}}}function Xl(s){return{mode:"proofread",scope:"all",batchOptions:{batchSize:3,maxRetries:2,rpmLimit:10,sessionResetFrequency:5}}}function en(s="current"){return{mode:"removeText",scope:s}}function vo(){const s=Qe(),t=ct(),n=rt(),o=Gl(),l=o.progress,i=o.isExecuting,a=o.isTranslating,r=o.progressPercent,h=K(()=>o.isExecuting.value),T=K(()=>o.isExecuting.value);async function S(){return(await o.execute(At("current"))).success}async function M(c){const k=s.currentImageIndex;s.setCurrentImageIndex(c);const C=await o.execute(At("current"));return s.setCurrentImageIndex(k),C.success}async function L(){return(await o.execute(At("all"))).success}function D(){o.cancel()}async function U(){return(await o.execute(en("current"))).success}async function w(){return(await o.execute(en("all"))).success}async function W(){return s.getFailedImageIndices().length===0?(n.info("æ²¡æœ‰å¤±è´¥çš„å›¾ç‰‡éœ€è¦é‡æ–°ç¿»è¯‘"),!0):(await o.execute(At("failed"))).success}async function q(){return(await o.execute(Yl())).success}async function O(){return(await o.execute(Xl())).success}async function f(){if(!s.currentImage)return n.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;const k=t.bubbles;return!k||k.length===0?(n.error("å½“å‰å›¾ç‰‡æ²¡æœ‰æ°”æ³¡æ¡†ï¼Œè¯·å…ˆæ£€æµ‹æˆ–æ‰‹åŠ¨æ·»åŠ "),!1):(s.setManuallyAnnotated(!0),S())}return{progress:l,isTranslatingSingle:i,isHqTranslating:h,isProofreading:T,isTranslating:a,progressPercent:r,translateCurrentImage:S,translateImageByIndex:M,translateAllImages:L,cancelBatchTranslation:D,removeTextOnly:U,removeAllTexts:w,retryFailedImages:W,executeHqTranslation:q,executeProofreading:O,translateWithCurrentBubbles:f}}function Zl(){const s=ct(),t=Qe(),n=_(!1);function o(){if(!n.value)return;const l=t.currentImage;s.bubbleCount>0?t.updateCurrentBubbleStates([...s.bubbles]):l&&Array.isArray(l.bubbleStates)&&l.bubbleStates.length>0&&(t.updateCurrentBubbleStates([]),console.log("é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼ˆæ— é‡æ¸²æŸ“ï¼‰ï¼Œç”¨æˆ·å·²åˆ é™¤æ‰€æœ‰æ°”æ³¡")),n.value=!1,s.clearSelection(),console.log("å·²é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼ˆæ— é‡æ¸²æŸ“ï¼‰")}return{isActive:n,exitEditModeWithoutRender:o}}function Ql(){const s=an(),t=Ue(),n=Qe(),o=pn(),l=ct(),i=Zl(),a=_(!1),r=_(!1),h=_(null),T=_([]),S=_([]),M=_([]),L=_(null),D=_(null),U=_(null),w=_(null),W=_(!1);async function q(Z=!1){if(!Z&&(a.value||r.value)){console.log("[TranslateInit] å·²ç»åˆå§‹åŒ–ï¼Œä»…é‡æ–°åŠ è½½ä¸Šä¸‹æ–‡"),await C();return}console.log("[TranslateInit] å¼€å§‹åˆå§‹åŒ–åº”ç”¨..."),a.value=!0,h.value=null;try{await O(),await f(),await c(),await k(),await C(),console.log("[TranslateInit] åº”ç”¨åˆå§‹åŒ–å®Œæˆ"),r.value=!0}catch(d){console.error("[TranslateInit] åº”ç”¨åˆå§‹åŒ–å¤±è´¥:",d),h.value=d instanceof Error?d.message:"åˆå§‹åŒ–å¤±è´¥"}finally{a.value=!1}}async function O(){console.log("[TranslateInit] åˆå§‹åŒ–è®¾ç½®..."),t.initSettings();try{const Z=await t.loadFromBackend();console.log(Z?"[TranslateInit] å·²ä»åç«¯åŠ è½½è®¾ç½®":"[TranslateInit] åç«¯æ— è®¾ç½®ï¼Œä½¿ç”¨ localStorage æ•°æ®")}catch(Z){console.warn("[TranslateInit] ä»åç«¯åŠ è½½è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨ localStorage æ•°æ®:",Z)}console.log("[TranslateInit] è®¾ç½®åˆå§‹åŒ–å®Œæˆ")}async function f(){console.log("[TranslateInit] åˆå§‹åŒ–å­—ä½“åˆ—è¡¨...");try{const Z=await cn();Z.fonts&&Z.fonts.length>0?(T.value=Z.fonts,console.log(`[TranslateInit] å·²åŠ è½½ ${Z.fonts.length} ä¸ªå­—ä½“`)):Z.error?console.warn("[TranslateInit] è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:",Z.error):console.warn("[TranslateInit] å­—ä½“åˆ—è¡¨ä¸ºç©º")}catch(Z){console.error("[TranslateInit] è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:",Z)}}async function c(){console.log("[TranslateInit] åˆå§‹åŒ–ç¿»è¯‘æç¤ºè¯è®¾ç½®...");try{const Z=await vs();Z.prompt_names!==void 0?(S.value=Z.prompt_names||[],!t.settings.translatePrompt&&Z.default_prompt_content&&t.setTranslatePrompt(Z.default_prompt_content),console.log(`[TranslateInit] å·²åŠ è½½ ${S.value.length} ä¸ªç¿»è¯‘æç¤ºè¯`)):Z.error&&console.warn("[TranslateInit] è·å–ç¿»è¯‘æç¤ºè¯å¤±è´¥:",Z.error)}catch(Z){console.error("[TranslateInit] è·å–ç¿»è¯‘æç¤ºè¯å¤±è´¥:",Z)}}async function k(){console.log("[TranslateInit] åˆå§‹åŒ–æ–‡æœ¬æ¡†æç¤ºè¯è®¾ç½®...");try{const Z=await ms();Z.prompt_names!==void 0?(M.value=Z.prompt_names||[],!t.settings.textboxPrompt&&Z.default_prompt_content&&t.setTextboxPrompt(Z.default_prompt_content),console.log(`[TranslateInit] å·²åŠ è½½ ${M.value.length} ä¸ªæ–‡æœ¬æ¡†æç¤ºè¯`)):Z.error&&console.warn("[TranslateInit] è·å–æ–‡æœ¬æ¡†æç¤ºè¯å¤±è´¥:",Z.error)}catch(Z){console.error("[TranslateInit] è·å–æ–‡æœ¬æ¡†æç¤ºè¯å¤±è´¥:",Z)}}async function C(){const Z=s.query.book,d=s.query.chapter;if(!Z||!d){console.log("[TranslateInit] æœªæŒ‡å®šä¹¦ç±/ç« èŠ‚å‚æ•°ï¼Œä½¿ç”¨ç‹¬ç«‹æ¨¡å¼"),W.value=!1,L.value=null,D.value=null,U.value=null,w.value=null,o.clearContext();return}console.log(`[TranslateInit] æ£€æµ‹åˆ°ä¹¦ç±/ç« èŠ‚å‚æ•°: book=${Z}, chapter=${d}`),W.value=!0,L.value=Z,D.value=d;try{const m=await bs(Z);if(!m.success||!m.book){console.warn("[TranslateInit] ä¹¦ç±ä¸å­˜åœ¨:",Z),be("ä¹¦ç±ä¸å­˜åœ¨","warning");return}const x=m.book,b=x.chapters?.find(p=>p.id===d);if(!b){console.warn("[TranslateInit] ç« èŠ‚ä¸å­˜åœ¨:",d),be("ç« èŠ‚ä¸å­˜åœ¨","warning");return}if(U.value=x.title,w.value=b.title,o.setBookChapterContext(Z,d,x.title,b.title),typeof document<"u"&&(document.title=`${b.title} - ${x.title} - Saber-Translator`),b.session_path){console.log(`[TranslateInit] å°è¯•åŠ è½½ç« èŠ‚ä¼šè¯: ${b.session_path}`);try{await o.loadSessionByPath(b.session_path),be(`å·²åŠ è½½ç« èŠ‚: ${b.title}`,"success")}catch{console.log("[TranslateInit] ç« èŠ‚ä¼šè¯æ•°æ®ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥ï¼Œå°†åˆ›å»ºæ–°ä¼šè¯")}}}catch(m){console.error("[TranslateInit] åŠ è½½ä¹¦ç±/ç« èŠ‚ä¿¡æ¯å¤±è´¥:",m),be("åŠ è½½ä¹¦ç±ä¿¡æ¯å¤±è´¥","error")}}function N(Z){if(Z<0||Z>=n.imageCount){console.warn(`[TranslateInit] æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${Z}`);return}window._isChangingFromSwitchImage=!0,i.isActive.value&&i.exitEditModeWithoutRender(),n.currentImage&&l.bubbles.length>0&&n.updateCurrentImageProperty("bubbleStates",l.bubbles),n.setCurrentImageIndex(Z);const m=n.currentImage;if(!m){console.warn("[TranslateInit] åˆ‡æ¢åˆ°çš„å›¾ç‰‡ä¸å­˜åœ¨"),window._isChangingFromSwitchImage=!1;return}console.log(`[TranslateInit] åˆ‡æ¢åˆ°å›¾ç‰‡: ${Z}, ${m.fileName}`),m.bubbleStates&&m.bubbleStates.length>0?l.setBubbles(m.bubbleStates,!0):l.clearBubblesLocal(),Y(m),setTimeout(()=>{window._isChangingFromSwitchImage=!1,console.log("[TranslateInit] å·²é‡ç½®åˆ‡æ¢å›¾ç‰‡æ“ä½œæ ‡è®°")},100)}function Y(Z){if(!Z)return;const d=Z.bubbleStates?.[0];d&&t.updateTextStyle({fontSize:d.fontSize||t.settings.textStyle.fontSize,fontFamily:d.fontFamily||t.settings.textStyle.fontFamily,layoutDirection:Z.userLayoutDirection||t.settings.textStyle.layoutDirection,textColor:d.textColor||t.settings.textStyle.textColor,fillColor:d.fillColor||t.settings.textStyle.fillColor,strokeEnabled:d.strokeEnabled??t.settings.textStyle.strokeEnabled,strokeColor:d.strokeColor||t.settings.textStyle.strokeColor,strokeWidth:d.strokeWidth||t.settings.textStyle.strokeWidth,inpaintMethod:d.inpaintMethod||t.settings.textStyle.inpaintMethod,autoFontSize:Z.autoFontSize??t.settings.textStyle.autoFontSize,useAutoTextColor:Z.useAutoTextColor??t.settings.textStyle.useAutoTextColor})}function ie(){n.canGoPrevious&&N(n.currentImageIndex-1)}function X(){n.canGoNext&&N(n.currentImageIndex+1)}function ae(){ut(async()=>{await q()})}return{isInitializing:a,isInitialized:r,initError:h,fontList:T,promptNames:S,textboxPromptNames:M,currentBookId:L,currentChapterId:D,currentBookTitle:U,currentChapterTitle:w,isBookshelfMode:W,initializeApp:q,initializeSettings:O,initializeFontList:f,initializePromptSettings:c,initializeTextboxPromptSettings:k,initializeBookChapterContext:C,switchImage:N,goToPrevious:ie,goToNext:X,loadImageSettingsToStore:Y,editMode:i,setupAutoInit:ae}}const ei={key:0,id:"translationProgressBar",class:"translation-progress-bar"},ti={class:"parallel-header"},oi={class:"header-title"},ni={class:"pools-list"},si={class:"pool-label"},ai={class:"pool-icon"},li={class:"pool-name"},ii={class:"pool-progress-bar"},ri={class:"pool-stats"},ui={class:"completed-count"},ci={class:"total-count"},di={key:0,class:"waiting-badge"},gi={key:1,class:"lock-indicator",title:"ç­‰å¾…æ·±åº¦å­¦ä¹ é”"},pi={class:"overall-section"},mi={class:"overall-label"},vi={key:0,class:"failed-text"},fi={class:"overall-progress-bar"},bi={class:"progress-bar-label"},hi={key:0,class:"failed-count"},yi={class:"progress-bar"},xi=He({__name:"TranslationProgress",props:{progress:{}},setup(s){const t=s,n=Qe(),o=Ue(),l=vo(),i=_n(),a=K(()=>o.settings.parallel?.enabled&&i.isRunning.value),r=K(()=>i.progress.value),h=K(()=>{const O=r.value;return!O||O.totalPages===0?0:Math.round(O.totalCompleted/O.totalPages*100)});function T(O){const f=r.value?.totalPages||0;return f===0?0:Math.round(O.completed/f*100)}function S(){const O=r.value?.totalPages||0;return O===0?0:Math.max(3,Math.round(1/O*100))}const M=K(()=>t.progress||l.progress.value),L=K(()=>M.value.isInProgress||n.isBatchTranslationInProgress||a.value),D=K(()=>M.value.current),U=K(()=>M.value.total),w=K(()=>M.value.failed),W=K(()=>M.value.percentage!==void 0?M.value.percentage:U.value===0?0:Math.round(D.value/U.value*100)),q=K(()=>M.value.label?M.value.label:`ç¿»è¯‘ä¸­ï¼š${D.value} / ${U.value}`);return(O,f)=>L.value?(P(),A("div",ei,[a.value&&r.value?(P(),A(Ae,{key:0},[e("div",ti,[e("span",oi,"ğŸš€ å¹¶è¡Œç¿»è¯‘ä¸­ï¼š"+oe(r.value.totalCompleted)+"/"+oe(r.value.totalPages),1)]),e("div",ni,[(P(!0),A(Ae,null,Je(r.value.pools,c=>(P(),A("div",{key:c.name,class:Te(["pool-row",{"pool-processing":c.processing,"pool-waiting-lock":c.isWaitingLock}])},[e("div",si,[e("span",ai,oe(c.icon),1),e("span",li,oe(c.name),1)]),e("div",ii,[e("div",{class:"progress-completed",style:ot({width:T(c)+"%"})},null,4),c.processing?(P(),A("div",{key:0,class:"progress-processing",style:ot({left:T(c)+"%",width:S()+"%"})},null,4)):ge("",!0)]),e("div",ri,[e("span",ui,oe(c.completed),1),e("span",ci,"/ "+oe(r.value.totalPages),1),c.waiting>0?(P(),A("span",di,"+"+oe(c.waiting),1)):ge("",!0),c.isWaitingLock?(P(),A("span",gi,"ğŸ”’")):ge("",!0)])],2))),128))]),f[0]||(f[0]=e("div",{class:"divider"},null,-1)),e("div",pi,[e("div",mi,[pe(" æ€»è¿›åº¦ï¼š"+oe(h.value)+"% ",1),r.value.totalFailed>0?(P(),A("span",vi," ï¼ˆ"+oe(r.value.totalFailed)+" å¤±è´¥ï¼‰ ",1)):ge("",!0)]),e("div",fi,[e("div",{class:"overall-progress-fill",style:ot({width:h.value+"%"})},null,4)])])],64)):(P(),A(Ae,{key:1},[e("div",bi,[pe(oe(q.value)+" ",1),w.value>0?(P(),A("span",hi,"ï¼ˆ"+oe(w.value)+" å¼ å¤±è´¥ï¼‰",1)):ge("",!0)]),e("div",yi,[e("div",{class:"progress",style:ot({width:`${W.value}%`})},null,4)])],64))])):ge("",!0)}}),_i=qe(xi,[["__scopeId","data-v-bbcb3b33"]]),Ci=He({__name:"SponsorModal",emits:["close"],setup(s,{emit:t}){const n=t;return(o,l)=>(P(),st(dn,{title:"æ”¯æŒä½œè€…",onClose:l[1]||(l[1]=i=>n("close"))},{footer:yt(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:l[0]||(l[0]=i=>n("close"))},"å…³é—­")]),default:yt(()=>[l[2]||(l[2]=e("div",{class:"sponsor-content"},[e("p",{class:"sponsor-message"}," å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯·ä½œè€…å–æ¯å’–å•¡ â˜• "),e("div",{class:"qr-codes"},[e("div",{class:"qr-item"},[e("div",{class:"qr-image"},[e("img",{src:"/pic/wechat_qrcode.png",alt:"å¾®ä¿¡æ”¯ä»˜"})]),e("span",{class:"qr-label"},"å¾®ä¿¡æ”¯ä»˜")]),e("div",{class:"qr-item"},[e("div",{class:"qr-image"},[e("img",{src:"/pic/alipay_qrcode.png",alt:"æ”¯ä»˜å®"})]),e("span",{class:"qr-label"},"æ”¯ä»˜å®")])]),e("p",{class:"sponsor-thanks"},"æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼ğŸ™")],-1))]),_:1}))}}),ki=qe(Ci,[["__scopeId","data-v-02b6948e"]]);function Si(s){const t=_(""),n=K(()=>s.value.some(D=>D.folderPath)),o=K(()=>{if(!n.value)return null;const D={name:"æ ¹ç›®å½•",path:"",images:[],subfolders:[]},U=new Map;U.set("",D);for(const w of s.value){const W=w.folderPath||"";if(W&&!U.has(W)){const q=W.split("/");let O="";for(const f of q){const c=O;if(O=O?`${O}/${f}`:f,!U.has(O)){const k={name:f,path:O,images:[],subfolders:[]};U.set(O,k),U.has(c)&&U.get(c).subfolders.push(k)}}}U.has(W)&&U.get(W).images.push(w)}return D}),l=K(()=>{if(!t.value)return[{name:"æ ¹ç›®å½•",path:""}];const D=t.value.split("/"),U=[{name:"æ ¹ç›®å½•",path:""}];let w="";for(const W of D)w=w?`${w}/${W}`:W,U.push({name:W,path:w});return U}),i=K(()=>{if(!o.value)return null;if(!t.value)return o.value;const D=(U,w)=>{if(U.path===w)return U;for(const W of U.subfolders){const q=D(W,w);if(q)return q}return null};return D(o.value,t.value)}),a=K(()=>i.value?.subfolders||[]),r=K(()=>i.value?.images||[]);function h(D){t.value=D}function T(){if(!t.value)return;const D=t.value.lastIndexOf("/");t.value=D>0?t.value.substring(0,D):""}function S(D){t.value=D}function M(D){let U=D.images.length;for(const w of D.subfolders)U+=M(w);return U}function L(){t.value=""}return{currentFolderPath:t,useTreeMode:n,folderTree:o,breadcrumbs:l,currentFolder:i,currentSubfolders:a,currentImages:r,enterFolder:h,goUp:T,navigateTo:S,getFolderImageCount:M,resetToRoot:L}}const wi={id:"thumbnail-sidebar",class:"thumbnail-sidebar"},$i={class:"card thumbnail-card"},Ti={class:"breadcrumb-nav"},Ii=["onClick"],Ri={key:0,class:"breadcrumb-sep"},Di=["onClick"],Pi={class:"folder-info"},Mi=["title"],Ei={class:"folder-count"},Bi=["title","onClick"],Ai=["src","alt"],Li={key:1,class:"translation-failed-indicator"},Fi={key:2,class:"labeled-indicator"},Ui={key:3,class:"thumbnail-processing-indicator"},Oi={key:0,class:"empty-folder"},zi=["title","data-index","onClick"],Ni=["src","alt"],Vi={key:1,class:"translation-failed-indicator"},Wi={key:2,class:"labeled-indicator"},Ki={key:3,class:"thumbnail-processing-indicator"},qi={key:2,class:"empty-state"},Hi=He({__name:"ThumbnailSidebar",emits:["select"],setup(s,{emit:t}){const n=t,o=Qe(),l=_(null),i=_([]),a=K(()=>o.images),r=K(()=>o.currentImageIndex),h=K(()=>o.hasImages),{useTreeMode:T,breadcrumbs:S,currentSubfolders:M,currentImages:L,currentFolderPath:D,enterFolder:U,goUp:w,navigateTo:W,getFolderImageCount:q,folderTree:O,resetToRoot:f}=Si(a);Ce(()=>a.value.length,(d,m)=>{(d===0||m===0&&d>0)&&f()});function c(d){return a.value.findIndex(m=>m.id===d.id)}function k(d){return d.translationFailed?"failed":d.isManuallyAnnotated?"labeled":d.translationStatus==="processing"?"processing":null}function C(d){n("select",d)}function N(d){U(d.path)}function Y(d){W(d)}function ie(){dt(()=>{const d=i.value[r.value];if(d&&l.value){const m=l.value,x=d.offsetTop-m.clientHeight/2+d.clientHeight/2;m.scrollTo({top:Math.max(0,x),behavior:"smooth"})}})}function X(d,m){i.value[m]=d}function ae(d){const m=[];return d.translationFailed&&m.push("translation-failed"),d.isManuallyAnnotated&&m.push("has-manual-labels"),m}function Z(d){return d.translationFailed?"ç¿»è¯‘å¤±è´¥ï¼Œç‚¹å‡»å¯é‡è¯•":d.isManuallyAnnotated?"åŒ…å«æ‰‹åŠ¨æ ‡æ³¨":d.fileName||""}return Ce(r,()=>{ie()}),ut(()=>{h.value&&ie()}),(d,m)=>(P(),A("aside",wi,[e("div",$i,[m[5]||(m[5]=e("h2",null,"å›¾ç‰‡æ¦‚è§ˆ",-1)),h.value&&V(T)&&V(O)?(P(),A(Ae,{key:0},[e("div",Ti,[(P(!0),A(Ae,null,Je(V(S),(x,b)=>(P(),A(Ae,{key:x.path},[e("span",{class:Te(["breadcrumb-item",{active:b===V(S).length-1}]),onClick:p=>b<V(S).length-1&&Y(x.path)},oe(b===0?"ğŸ“":"")+oe(x.name),11,Ii),b<V(S).length-1?(P(),A("span",Ri,"/")):ge("",!0)],64))),128))]),V(D)?(P(),A("div",{key:0,class:"folder-back-btn",onClick:m[0]||(m[0]=(...x)=>V(w)&&V(w)(...x))},[...m[1]||(m[1]=[e("span",{class:"back-icon"},"â¬…ï¸",-1),e("span",null,"è¿”å›ä¸Šçº§",-1)])])):ge("",!0),e("div",{ref_key:"containerRef",ref:l,class:"folder-content-list"},[(P(!0),A(Ae,null,Je(V(M),x=>(P(),A("div",{key:x.path,class:"folder-item",onClick:b=>N(x)},[m[2]||(m[2]=e("span",{class:"folder-icon"},"ğŸ“",-1)),e("div",Pi,[e("span",{class:"folder-name",title:x.name},oe(x.name),9,Mi),e("span",Ei,"("+oe(V(q)(x))+")",1)])],8,Di))),128)),(P(!0),A(Ae,null,Je(V(L),x=>(P(),A("div",{key:x.id,ref_for:!0,ref:b=>X(b,c(x)),class:Te(["thumbnail-item",[{active:c(x)===r.value},...ae(x)]]),title:Z(x),onClick:b=>C(c(x))},[x.originalDataURL?(P(),A("img",{key:0,src:x.originalDataURL,alt:x.fileName,class:"thumbnail-image"},null,8,Ai)):ge("",!0),k(x)==="failed"?(P(),A("span",Li,"!")):k(x)==="labeled"?(P(),A("span",Fi,"âœï¸")):ge("",!0),k(x)==="processing"?(P(),A("div",Ui,"âŸ³")):ge("",!0)],10,Bi))),128)),V(M).length===0&&V(L).length===0?(P(),A("div",Oi,[...m[3]||(m[3]=[e("p",null,"æ­¤æ–‡ä»¶å¤¹ä¸ºç©º",-1)])])):ge("",!0)],512)],64)):h.value?(P(),A("ul",{key:1,ref_key:"containerRef",ref:l,id:"thumbnailList",class:"thumbnail-list"},[(P(!0),A(Ae,null,Je(a.value,(x,b)=>(P(),A("li",{key:x.id,ref_for:!0,ref:p=>X(p,b),class:Te(["thumbnail-item",[{active:b===r.value},...ae(x)]]),title:Z(x),"data-index":b,onClick:p=>C(b)},[x.originalDataURL?(P(),A("img",{key:0,src:x.originalDataURL,alt:x.fileName,class:"thumbnail-image"},null,8,Ni)):ge("",!0),k(x)==="failed"?(P(),A("span",Vi,"!")):k(x)==="labeled"?(P(),A("span",Wi,"âœï¸")):ge("",!0),k(x)==="processing"?(P(),A("div",Ki," âŸ³ ")):ge("",!0)],10,zi))),128))],512)):(P(),A("div",qi,[...m[4]||(m[4]=[e("p",null,"æš‚æ— å›¾ç‰‡",-1)])]))])]))}}),ji=qe(Hi,[["__scopeId","data-v-6aa1c6be"]]),Ji={class:"saved-prompts-picker"},Gi={class:"prompts-chips-container"},Yi={key:0,class:"empty-hint"},Xi={key:1,class:"empty-hint"},Zi=["title","onClick"],Qi=He({__name:"SavedPromptsPicker",props:{promptType:{}},emits:["select"],setup(s,{expose:t,emit:n}){const o=s,l=n,i=_([]),a=_(!1);async function r(){a.value=!0;try{let T;o.promptType==="textbox"?T=await We.getTextboxPrompts():T=await We.getPrompts(o.promptType);const S=T.prompt_names||[];i.value=S.map(M=>({name:M}))}catch(T){console.error("åŠ è½½æç¤ºè¯åˆ—è¡¨å¤±è´¥:",T),i.value=[]}finally{a.value=!1}}async function h(T){try{let S;o.promptType==="textbox"?S=await We.getTextboxPromptContent(T):S=await We.getPromptContent(o.promptType,T),S.prompt_content&&l("select",S.prompt_content,T)}catch(S){console.error("åŠ è½½æç¤ºè¯å†…å®¹å¤±è´¥:",S)}}return Ce(()=>o.promptType,()=>{r()}),ut(()=>{r()}),t({refresh:r}),(T,S)=>(P(),A("div",Ji,[S[1]||(S[1]=e("span",{class:"picker-label"},"ğŸ“‘ å¿«é€Ÿé€‰æ‹©:",-1)),e("div",Gi,[a.value?(P(),A("span",Yi,"åŠ è½½ä¸­...")):i.value.length===0?(P(),A("span",Xi,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(P(!0),A(Ae,{key:2},Je(i.value,M=>(P(),A("button",{key:M.name,type:"button",class:"prompt-chip",title:M.name,onClick:L=>h(M.name)},[S[0]||(S[0]=e("span",{class:"chip-icon"},"ğŸ“",-1)),pe(" "+oe(M.name),1)],8,Zi))),128))])]))}}),Dt=qe(Qi,[["__scopeId","data-v-2ebbb8b3"]]),er={class:"ocr-settings"},tr={class:"settings-group"},or={class:"settings-item"},nr={class:"settings-item"},sr={class:"input-hint"},ar={class:"settings-group"},lr={class:"settings-row"},ir={class:"settings-item"},rr={class:"password-input-wrapper"},ur=["type"],cr={key:0,class:"eye-icon"},dr={key:1,class:"eye-off-icon"},gr={class:"settings-item"},pr={class:"password-input-wrapper"},mr=["type"],vr={key:0,class:"eye-icon"},fr={key:1,class:"eye-off-icon"},br={class:"settings-row"},hr={class:"settings-item"},yr={class:"settings-item"},xr=["disabled"],_r={class:"settings-group"},Cr={class:"settings-row"},kr={class:"settings-item"},Sr={class:"settings-item"},wr={class:"password-input-wrapper"},$r=["type"],Tr={key:0,class:"eye-icon"},Ir={key:1,class:"eye-off-icon"},Rr={class:"settings-item"},Dr={class:"settings-item"},Pr={class:"model-input-with-fetch"},Mr=["disabled"],Er={class:"fetch-text"},Br={key:0,class:"model-select-container"},Ar={class:"model-count"},Lr={class:"settings-item"},Fr={class:"prompt-format-selector"},Ur={class:"settings-item"},Or=["disabled"],zr=He({__name:"OcrSettings",setup(s){const t=[{label:"MangaOCR (æ—¥è¯­ä¸“ç”¨)",value:"manga_ocr"},{label:"PaddleOCR (å¤šè¯­è¨€)",value:"paddle_ocr"},{label:"PaddleOCR-VL (æ—¥æ¼«ä¸“ç”¨)",value:"paddleocr_vl"},{label:"ç™¾åº¦OCR",value:"baidu_ocr"},{label:"48px OCR",value:"48px_ocr"},{label:"AIè§†è§‰OCR",value:"ai_vision"}],n=[{label:"æ ‡å‡†ç‰ˆ",value:"standard"},{label:"é«˜ç²¾åº¦ç‰ˆ",value:"high_precision"}],o=[{label:"è‡ªåŠ¨æ£€æµ‹",value:"auto_detect"},{label:"ä¸­è‹±æ–‡æ··åˆ",value:"CHN_ENG"},{label:"è‹±æ–‡",value:"ENG"},{label:"æ—¥è¯­",value:"JAP"},{label:"éŸ©è¯­",value:"KOR"},{label:"æ³•è¯­",value:"FRE"},{label:"å¾·è¯­",value:"GER"},{label:"ä¿„è¯­",value:"RUS"}],l=[{label:"SiliconFlow (ç¡…åŸºæµåŠ¨)",value:"siliconflow"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai_vision"}],i=[{label:"æ™®é€šæç¤ºè¯",value:"false"},{label:"JSONæç¤ºè¯",value:"true"}],a=[{label:"ğŸš€ å¸¸ç”¨è¯­è¨€",options:[{label:"æ—¥è¯­",value:"japanese"},{label:"è‹±è¯­",value:"en"},{label:"ç®€ä½“ä¸­æ–‡",value:"chinese"},{label:"ç¹ä½“ä¸­æ–‡",value:"chinese_cht"},{label:"éŸ©è¯­",value:"korean"}]},{label:"ğŸŒ æ‹‰ä¸è¯­ç³»",options:[{label:"æ³•è¯­",value:"french"},{label:"å¾·è¯­",value:"german"},{label:"è¥¿ç­ç‰™è¯­",value:"spanish"},{label:"æ„å¤§åˆ©è¯­",value:"italian"},{label:"è‘¡è„ç‰™è¯­",value:"portuguese"}]},{label:"ğŸŒ å…¶ä»–è¯­ç³»",options:[{label:"ä¿„è¯­",value:"russian"}]}],r=Ue(),h=rt(),T=_({apiKey:r.settings.baiduOcr.apiKey,secretKey:r.settings.baiduOcr.secretKey,version:r.settings.baiduOcr.version,sourceLanguage:r.settings.baiduOcr.sourceLanguage}),S=_({apiKey:r.settings.aiVisionOcr.apiKey,modelName:r.settings.aiVisionOcr.modelName,customBaseUrl:r.settings.aiVisionOcr.customBaseUrl,prompt:r.settings.aiVisionOcr.prompt,rpmLimit:r.settings.aiVisionOcr.rpmLimit}),M=K(()=>r.settings);Ce(()=>T.value.apiKey,d=>{r.updateBaiduOcr({apiKey:d})}),Ce(()=>T.value.secretKey,d=>{r.updateBaiduOcr({secretKey:d})}),Ce(()=>T.value.version,d=>{r.updateBaiduOcr({version:d})}),Ce(()=>T.value.sourceLanguage,d=>{r.updateBaiduOcr({sourceLanguage:d})}),Ce(()=>S.value.apiKey,d=>{r.updateAiVisionOcr({apiKey:d})}),Ce(()=>S.value.modelName,d=>{r.updateAiVisionOcr({modelName:d})}),Ce(()=>S.value.customBaseUrl,d=>{r.updateAiVisionOcr({customBaseUrl:d})}),Ce(()=>S.value.prompt,d=>{r.updateAiVisionOcr({prompt:d})}),Ce(()=>S.value.rpmLimit,d=>{r.updateAiVisionOcr({rpmLimit:d})});const L=_(!1),D=_(!1),U=_(!1),w=_(!1),W=_(!1),q=_([]),O=K(()=>{const d=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return q.value.forEach(m=>{d.push({label:m,value:m})}),d});function f(){r.saveToStorage()}function c(){r.saveToStorage()}function k(){switch(r.settings.ocrEngine){case"manga_ocr":return"MangaOCR ä¸“ä¸ºæ—¥è¯­æ¼«ç”»ä¼˜åŒ–ï¼Œæºè¯­è¨€è®¾ç½®ä¸å½±å“è¯†åˆ«";case"paddle_ocr":return"PaddleOCR ä¼šæ ¹æ®æºè¯­è¨€åŠ è½½å¯¹åº”çš„è¯†åˆ«æ¨¡å‹";case"paddleocr_vl":return"PaddleOCR-VL åŸºäº VLM å¾®è°ƒï¼Œä¸“ä¸ºæ—¥è¯­æ¼«ç”»ä¼˜åŒ–ï¼Œå‡†ç¡®ç‡é«˜è¾¾ 70%";case"baidu_ocr":return"ç™¾åº¦OCR ä½¿ç”¨ç‹¬ç«‹çš„æºè¯­è¨€è®¾ç½®ï¼ˆè§ä¸‹æ–¹ï¼‰";case"ai_vision":return"AIè§†è§‰OCR é€šè¿‡æç¤ºè¯æŒ‡å®šè¯†åˆ«è¯­è¨€";case"48px_ocr":return"48px OCR æ”¯æŒæ—¥ä¸­è‹±éŸ©ç­‰å¤šè¯­è¨€ï¼Œæºè¯­è¨€è®¾ç½®ä¸å½±å“è¯†åˆ«";default:return"é€‰æ‹©è¦è¯†åˆ«çš„åŸæ–‡è¯­è¨€"}}function C(d){r.setAiVisionOcrProvider(d),q.value=[],N()}function N(){S.value.apiKey=r.settings.aiVisionOcr.apiKey,S.value.modelName=r.settings.aiVisionOcr.modelName,S.value.customBaseUrl=r.settings.aiVisionOcr.customBaseUrl,S.value.prompt=r.settings.aiVisionOcr.prompt,S.value.rpmLimit=r.settings.aiVisionOcr.rpmLimit}function Y(){const d=r.settings.aiVisionOcr.isJsonMode?Gn:Yn;r.updateAiVisionOcr({prompt:d}),S.value.prompt=d}async function ie(){const d=T.value.apiKey?.trim(),m=T.value.secretKey?.trim();if(!d||!m){h.warning("è¯·å¡«å†™ç™¾åº¦OCRçš„API Keyå’ŒSecret Key");return}w.value=!0,h.info("æ­£åœ¨æµ‹è¯•ç™¾åº¦OCRè¿æ¥...");try{const x=await We.testBaiduOcrConnection(d,m);x.success?h.success(x.message||"ç™¾åº¦OCRè¿æ¥æˆåŠŸ!"):h.error(x.message||x.error||"ç™¾åº¦OCRè¿æ¥å¤±è´¥")}catch(x){const b=x instanceof Error?x.message:"è¿æ¥æµ‹è¯•å¤±è´¥";h.error(b)}finally{w.value=!1}}async function X(){w.value=!0;try{const d=await We.testAiVisionOcrConnection({provider:r.settings.aiVisionOcr.provider,apiKey:S.value.apiKey,modelName:S.value.modelName,customBaseUrl:S.value.customBaseUrl,prompt:S.value.prompt});d.success?h.success("AIè§†è§‰OCRè¿æ¥æˆåŠŸ"):h.error(`AIè§†è§‰OCRè¿æ¥å¤±è´¥: ${d.error||"æœªçŸ¥é”™è¯¯"}`)}catch(d){const m=d instanceof Error?d.message:"è¿æ¥æµ‹è¯•å¤±è´¥";h.error(m)}finally{w.value=!1}}async function ae(){const d=r.settings.aiVisionOcr.provider,m=S.value.apiKey?.trim(),x=S.value.customBaseUrl?.trim();if(!m){h.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","volcano","gemini","custom_openai_vision"].includes(d)){h.warning("å½“å‰æœåŠ¡å•†ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨");return}if(d==="custom_openai_vision"&&!x){h.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}W.value=!0;try{const p=await We.fetchModels(d,m,x);p.success&&p.models&&p.models.length>0?(q.value=p.models.map(g=>g.id),h.success(`è·å–åˆ° ${p.models.length} ä¸ªæ¨¡å‹`)):h.warning(p.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(p){const g=p instanceof Error?p.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";h.error(g)}finally{W.value=!1}}function Z(d,m){r.updateAiVisionOcr({prompt:d}),S.value.prompt=d,h.success(`å·²åº”ç”¨æç¤ºè¯: ${m}`)}return(d,m)=>(P(),A("div",er,[e("div",tr,[m[19]||(m[19]=e("div",{class:"settings-group-title"},"OCRå¼•æ“é€‰æ‹©",-1)),e("div",or,[m[17]||(m[17]=e("label",{for:"settingsOcrEngine"},"OCRå¼•æ“:",-1)),xe(Ne,{"model-value":M.value.ocrEngine,options:t,onChange:m[0]||(m[0]=x=>{M.value.ocrEngine=x,f()})},null,8,["model-value"])]),ne(e("div",nr,[m[18]||(m[18]=e("label",{for:"settingsSourceLanguage"},"æºè¯­è¨€:",-1)),xe(Ne,{"model-value":M.value.sourceLanguage,groups:a,onChange:m[1]||(m[1]=x=>{M.value.sourceLanguage=x,c()})},null,8,["model-value"]),e("div",sr,oe(k()),1)],512),[[Fe,M.value.ocrEngine==="paddle_ocr"]])]),ne(e("div",ar,[m[24]||(m[24]=e("div",{class:"settings-group-title"},"ç™¾åº¦OCR è®¾ç½®",-1)),e("div",lr,[e("div",ir,[m[20]||(m[20]=e("label",{for:"settingsBaiduApiKey"},"API Key:",-1)),e("div",rr,[ne(e("input",{type:L.value?"text":"password",id:"settingsBaiduApiKey","onUpdate:modelValue":m[2]||(m[2]=x=>T.value.apiKey=x),class:"secure-input",placeholder:"è¯·è¾“å…¥ç™¾åº¦OCR API Key",autocomplete:"off"},null,8,ur),[[Ct,T.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:m[3]||(m[3]=x=>L.value=!L.value)},[L.value?(P(),A("span",dr,"ğŸ‘â€ğŸ—¨")):(P(),A("span",cr,"ğŸ‘"))])])]),e("div",gr,[m[21]||(m[21]=e("label",{for:"settingsBaiduSecretKey"},"Secret Key:",-1)),e("div",pr,[ne(e("input",{type:D.value?"text":"password",id:"settingsBaiduSecretKey","onUpdate:modelValue":m[4]||(m[4]=x=>T.value.secretKey=x),class:"secure-input",placeholder:"è¯·è¾“å…¥Secret Key",autocomplete:"off"},null,8,mr),[[Ct,T.value.secretKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:m[5]||(m[5]=x=>D.value=!D.value)},[D.value?(P(),A("span",fr,"ğŸ‘â€ğŸ—¨")):(P(),A("span",vr,"ğŸ‘"))])])])]),e("div",br,[e("div",hr,[m[22]||(m[22]=e("label",{for:"settingsBaiduVersion"},"è¯†åˆ«ç‰ˆæœ¬:",-1)),xe(Ne,{modelValue:T.value.version,"onUpdate:modelValue":m[6]||(m[6]=x=>T.value.version=x),options:n},null,8,["modelValue"])]),e("div",yr,[m[23]||(m[23]=e("label",{for:"settingsBaiduSourceLanguage"},"æºè¯­è¨€:",-1)),xe(Ne,{modelValue:T.value.sourceLanguage,"onUpdate:modelValue":m[7]||(m[7]=x=>T.value.sourceLanguage=x),options:o},null,8,["modelValue"])])]),e("button",{class:"settings-test-btn",onClick:ie,disabled:w.value},oe(w.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,xr)],512),[[Fe,M.value.ocrEngine==="baidu_ocr"]]),ne(e("div",_r,[m[34]||(m[34]=e("div",{class:"settings-group-title"},"AIè§†è§‰OCR è®¾ç½®",-1)),e("div",Cr,[e("div",kr,[m[25]||(m[25]=e("label",{for:"settingsAiVisionProvider"},"æœåŠ¡å•†:",-1)),xe(Ne,{"model-value":M.value.aiVisionOcr.provider,options:l,onChange:m[8]||(m[8]=x=>C(x))},null,8,["model-value"])]),e("div",Sr,[m[26]||(m[26]=e("label",{for:"settingsAiVisionApiKey"},"API Key:",-1)),e("div",wr,[ne(e("input",{type:U.value?"text":"password",id:"settingsAiVisionApiKey","onUpdate:modelValue":m[9]||(m[9]=x=>S.value.apiKey=x),class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,$r),[[Ct,S.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:m[10]||(m[10]=x=>U.value=!U.value)},[U.value?(P(),A("span",Ir,"ğŸ‘â€ğŸ—¨")):(P(),A("span",Tr,"ğŸ‘"))])])])]),ne(e("div",Rr,[m[27]||(m[27]=e("label",{for:"settingsCustomAiVisionBaseUrl"},"Base URL:",-1)),ne(e("input",{type:"text",id:"settingsCustomAiVisionBaseUrl","onUpdate:modelValue":m[11]||(m[11]=x=>S.value.customBaseUrl=x),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[Se,S.value.customBaseUrl]])],512),[[Fe,M.value.aiVisionOcr.provider==="custom_openai_vision"]]),e("div",Dr,[m[29]||(m[29]=e("label",{for:"settingsAiVisionModelName"},"æ¨¡å‹åç§°:",-1)),e("div",Pr,[ne(e("input",{type:"text",id:"settingsAiVisionModelName","onUpdate:modelValue":m[12]||(m[12]=x=>S.value.modelName=x),placeholder:"å¦‚: silicon-llava2-34b"},null,512),[[Se,S.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:ae,disabled:W.value},[m[28]||(m[28]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",Er,oe(W.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,Mr)]),q.value.length>0?(P(),A("div",Br,[xe(Ne,{modelValue:S.value.modelName,"onUpdate:modelValue":m[13]||(m[13]=x=>S.value.modelName=x),options:O.value},null,8,["modelValue","options"]),e("span",Ar,"å…± "+oe(q.value.length)+" ä¸ªæ¨¡å‹",1)])):ge("",!0)]),e("div",Lr,[m[31]||(m[31]=e("label",{for:"settingsAiVisionOcrPrompt"},"OCRæç¤ºè¯:",-1)),ne(e("textarea",{id:"settingsAiVisionOcrPrompt","onUpdate:modelValue":m[14]||(m[14]=x=>S.value.prompt=x),rows:"3",placeholder:"AIè§†è§‰OCRæç¤ºè¯"},null,512),[[Se,S.value.prompt]]),xe(Dt,{"prompt-type":"ai_vision_ocr",onSelect:Z}),e("div",Fr,[xe(Ne,{"model-value":M.value.aiVisionOcr.isJsonMode?"true":"false",options:i,onChange:m[15]||(m[15]=x=>{M.value.aiVisionOcr.isJsonMode=x==="true",Y()})},null,8,["model-value"]),m[30]||(m[30]=e("span",{class:"input-hint"},"JSONæ ¼å¼è¾“å‡ºæ›´ç»“æ„åŒ–",-1))])]),e("div",Ur,[m[32]||(m[32]=e("label",{for:"settingsRpmAiVisionOcr"},"RPMé™åˆ¶ (æ¯åˆ†é’Ÿè¯·æ±‚æ•°):",-1)),ne(e("input",{type:"number",id:"settingsRpmAiVisionOcr","onUpdate:modelValue":m[16]||(m[16]=x=>S.value.rpmLimit=x),min:"0",step:"1"},null,512),[[Se,S.value.rpmLimit,void 0,{number:!0}]]),m[33]||(m[33]=e("div",{class:"input-hint"},"0 è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("button",{class:"settings-test-btn",onClick:X,disabled:w.value},oe(w.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,Or)],512),[[Fe,M.value.ocrEngine==="ai_vision"]])]))}}),Nr=qe(zr,[["__scopeId","data-v-49a9cd9f"]]),Vr={class:"translation-settings"},Wr={class:"settings-group"},Kr={class:"settings-row"},qr={class:"settings-item"},Hr={class:"settings-item"},jr={for:"settingsApiKey"},Jr={class:"password-input-wrapper"},Gr=["type","placeholder"],Yr={key:0,class:"eye-icon"},Xr={key:1,class:"eye-off-icon"},Zr={class:"settings-item"},Qr={class:"settings-item"},eu={for:"settingsModelName"},tu={class:"model-input-with-fetch"},ou=["placeholder"],nu=["disabled"],su={class:"fetch-text"},au={key:0,class:"model-select-container"},lu={class:"model-count"},iu={class:"settings-item"},ru={class:"local-model-list"},uu={key:0,class:"model-list-container"},cu=["disabled"],du={key:1,class:"model-hint"},gu={key:1,class:"model-list-container"},pu=["disabled"],mu={key:1,class:"model-hint"},vu={class:"settings-row"},fu={class:"settings-item"},bu={class:"settings-item"},hu={class:"settings-item"},yu=["disabled"],xu={class:"settings-item"},_u=["disabled"],Cu={class:"settings-group"},ku={class:"settings-item"},Su={class:"prompt-format-selector"},wu={class:"settings-item"},$u={class:"checkbox-label"},Tu={class:"settings-item"},Iu=He({__name:"TranslationSettings",setup(s){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"å½©äº‘å°è¯‘",value:"caiyun"},{label:"ç™¾åº¦ç¿»è¯‘",value:"baidu_translate"},{label:"æœ‰é“ç¿»è¯‘",value:"youdao_translate"},{label:"Google Gemini",value:"gemini"},{label:"Ollama (æœ¬åœ°)",value:"ollama"},{label:"Sakura (æœ¬åœ°)",value:"sakura"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],n=[{label:"æ™®é€šæç¤ºè¯",value:"normal"},{label:"JSONæç¤ºè¯",value:"json"}],o=Ue(),l=rt(),i=_({modelProvider:o.settings.translation.provider,apiKey:o.settings.translation.apiKey,modelName:o.settings.translation.modelName,customBaseUrl:o.settings.translation.customBaseUrl,rpmTranslation:o.settings.translation.rpmLimit,translationMaxRetries:o.settings.translation.maxRetries,promptContent:o.settings.translatePrompt,translatePromptMode:o.settings.translation.isJsonMode?"json":"normal",enableTextboxPrompt:o.settings.useTextboxPrompt,textboxPromptContent:o.settings.textboxPrompt}),a=_(!1),r=_(!1),h=_(!1),T=_([]),S=_([]),M=_([]),L=K(()=>{const p=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return T.value.forEach(g=>p.push({label:g,value:g})),p}),D=K(()=>{const p=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return S.value.forEach(g=>p.push({label:g,value:g})),p}),U=K(()=>{const p=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return M.value.forEach(g=>p.push({label:g,value:g})),p}),w=K(()=>["ollama","sakura"].includes(i.value.modelProvider)),W=K(()=>!["ollama","sakura","caiyun","baidu_translate","youdao_translate"].includes(i.value.modelProvider)),q=K(()=>["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(i.value.modelProvider)),O=K(()=>{switch(i.value.modelProvider){case"baidu_translate":return"App ID";case"youdao_translate":return"App Key";case"caiyun":return"API Token";default:return"API Key"}}),f=K(()=>{switch(i.value.modelProvider){case"baidu_translate":return"è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘App ID";case"youdao_translate":return"è¯·è¾“å…¥æœ‰é“ç¿»è¯‘åº”ç”¨ID";case"caiyun":return"è¯·è¾“å…¥å½©äº‘å°è¯‘Token";default:return"è¯·è¾“å…¥API Key"}}),c=K(()=>{switch(i.value.modelProvider){case"baidu_translate":return"App Key";case"youdao_translate":return"App Secret";case"caiyun":return"æºè¯­è¨€ (å¯é€‰)";default:return"æ¨¡å‹åç§°"}}),k=K(()=>{switch(i.value.modelProvider){case"baidu_translate":return"è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘App Key";case"youdao_translate":return"è¯·è¾“å…¥æœ‰é“ç¿»è¯‘åº”ç”¨å¯†é’¥";case"caiyun":return"å¯é€‰: auto/æ—¥è¯­/è‹±è¯­";default:return"è¯·è¾“å…¥æ¨¡å‹åç§°"}});function C(){const p=i.value.modelProvider;o.setTranslationProvider(p),i.value.apiKey=o.settings.translation.apiKey,i.value.modelName=o.settings.translation.modelName,i.value.customBaseUrl=o.settings.translation.customBaseUrl,i.value.rpmTranslation=o.settings.translation.rpmLimit,i.value.translationMaxRetries=o.settings.translation.maxRetries,T.value=[]}function N(){const p=i.value.translatePromptMode==="json";p?i.value.promptContent=Ao:i.value.promptContent=Lo,o.updateTranslationService({isJsonMode:p}),o.setTranslatePrompt(i.value.promptContent)}Ce(()=>i.value.apiKey,p=>{o.updateTranslationService({apiKey:p})}),Ce(()=>i.value.modelName,p=>{o.updateTranslationService({modelName:p})}),Ce(()=>i.value.customBaseUrl,p=>{o.updateTranslationService({customBaseUrl:p})}),Ce(()=>i.value.rpmTranslation,p=>{o.updateTranslationService({rpmLimit:p})}),Ce(()=>i.value.translationMaxRetries,p=>{o.updateTranslationService({maxRetries:p})}),Ce(()=>i.value.promptContent,p=>{o.setTranslatePrompt(p)}),Ce(()=>i.value.enableTextboxPrompt,p=>{o.setUseTextboxPrompt(p)}),Ce(()=>i.value.textboxPromptContent,p=>{o.setTextboxPrompt(p)});async function Y(){const p=i.value.modelProvider,g=i.value.apiKey?.trim(),E=i.value.customBaseUrl?.trim();if(!g){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(p)){l.warning(`${ie(p)} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`);return}if(p==="custom_openai"&&!E){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}h.value=!0;try{const I=await We.fetchModels(p,g,E);I.success&&I.models&&I.models.length>0?(T.value=I.models.map($=>$.id),l.success(`è·å–åˆ° ${I.models.length} ä¸ªæ¨¡å‹`)):l.warning(I.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(I){const $=I instanceof Error?I.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";l.error($)}finally{h.value=!1}}function ie(p){return{siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰OpenAI",ollama:"Ollama",sakura:"Sakura",caiyun:"å½©äº‘å°è¯‘",baidu_translate:"ç™¾åº¦ç¿»è¯‘",youdao_translate:"æœ‰é“ç¿»è¯‘"}[p]||p}async function X(){h.value=!0;try{const p=await We.testOllamaConnection();p.success&&p.models?(S.value=p.models,l.success(`è·å–åˆ° ${p.models.length} ä¸ªOllamaæ¨¡å‹`)):l.error(p.error||"Ollamaè¿æ¥å¤±è´¥")}catch(p){const g=p instanceof Error?p.message:"è·å–Ollamaæ¨¡å‹å¤±è´¥";l.error(g)}finally{h.value=!1}}async function ae(){h.value=!0;try{const p=await We.testSakuraConnection();p.success&&p.models?(M.value=p.models,l.success(`è·å–åˆ° ${p.models.length} ä¸ªSakuraæ¨¡å‹`)):l.error(p.error||"Sakuraè¿æ¥å¤±è´¥")}catch(p){const g=p instanceof Error?p.message:"è·å–Sakuraæ¨¡å‹å¤±è´¥";l.error(g)}finally{h.value=!1}}async function Z(){r.value=!0;try{let p;i.value.modelProvider==="ollama"?p=await We.testOllamaConnection():p=await We.testSakuraConnection(),p.success?l.success(`${i.value.modelProvider==="ollama"?"Ollama":"Sakura"} è¿æ¥æˆåŠŸ`):l.error(p.error||"è¿æ¥å¤±è´¥")}catch(p){const g=p instanceof Error?p.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(g)}finally{r.value=!1}}async function d(){const p=i.value.modelProvider,g=i.value.apiKey?.trim(),E=i.value.modelName?.trim(),H=i.value.customBaseUrl?.trim();if(!g){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(p!=="caiyun"&&!E){l.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}if(p==="custom_openai"&&!H){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å¡«å†™ Base URL");return}r.value=!0,l.info("æ­£åœ¨æµ‹è¯•è¿æ¥...");try{let I;switch(p){case"baidu_translate":I=await We.testBaiduTranslateConnection(g,E);break;case"youdao_translate":I=await We.testYoudaoTranslateConnection(g,E);break;default:I=await We.testAiTranslateConnection({provider:p,apiKey:g,modelName:E,baseUrl:H})}I.success?l.success(I.message||`${ie(p)} è¿æ¥æˆåŠŸ!`):l.error(I.message||I.error||"è¿æ¥å¤±è´¥")}catch(I){const $=I instanceof Error?I.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error($)}finally{r.value=!1}}function m(p,g){i.value.promptContent=p,l.success(`å·²åº”ç”¨æç¤ºè¯: ${g}`)}function x(p,g){i.value.textboxPromptContent=p,l.success(`å·²åº”ç”¨æç¤ºè¯: ${g}`)}function b(){i.value.translatePromptMode==="json"?i.value.promptContent=Ao:i.value.promptContent=Lo,l.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}return(p,g)=>(P(),A("div",Vr,[e("div",Wr,[g[21]||(g[21]=e("div",{class:"settings-group-title"},"ç¿»è¯‘æœåŠ¡é…ç½®",-1)),e("div",Kr,[e("div",qr,[g[14]||(g[14]=e("label",{for:"settingsModelProvider"},"ç¿»è¯‘æœåŠ¡å•†:",-1)),xe(Ne,{"model-value":i.value.modelProvider,options:t,onChange:g[0]||(g[0]=E=>{i.value.modelProvider=E,C()})},null,8,["model-value"])]),ne(e("div",Hr,[e("label",jr,oe(O.value)+":",1),e("div",Jr,[ne(e("input",{type:a.value?"text":"password",id:"settingsApiKey","onUpdate:modelValue":g[1]||(g[1]=E=>i.value.apiKey=E),class:"secure-input",placeholder:f.value,autocomplete:"off"},null,8,Gr),[[Ct,i.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:g[2]||(g[2]=E=>a.value=!a.value)},[a.value?(P(),A("span",Xr,"ğŸ‘â€ğŸ—¨")):(P(),A("span",Yr,"ğŸ‘"))])])],512),[[Fe,!w.value]])]),ne(e("div",Zr,[g[15]||(g[15]=e("label",{for:"settingsCustomBaseUrl"},"Base URL:",-1)),ne(e("input",{type:"text",id:"settingsCustomBaseUrl","onUpdate:modelValue":g[3]||(g[3]=E=>i.value.customBaseUrl=E),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[Se,i.value.customBaseUrl]])],512),[[Fe,i.value.modelProvider==="custom_openai"]]),ne(e("div",Qr,[e("label",eu,oe(c.value)+":",1),e("div",tu,[ne(e("input",{type:"text",id:"settingsModelName","onUpdate:modelValue":g[4]||(g[4]=E=>i.value.modelName=E),placeholder:k.value},null,8,ou),[[Se,i.value.modelName]]),ne(e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:Y,disabled:h.value},[g[16]||(g[16]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",su,oe(h.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,nu),[[Fe,q.value]])]),T.value.length>0?(P(),A("div",au,[xe(Ne,{"model-value":i.value.modelName,options:L.value,onChange:g[5]||(g[5]=E=>{i.value.modelName=E})},null,8,["model-value","options"]),e("span",lu,"å…± "+oe(T.value.length)+" ä¸ªæ¨¡å‹",1)])):ge("",!0)],512),[[Fe,!w.value]]),ne(e("div",iu,[g[17]||(g[17]=e("label",null,"æœ¬åœ°æ¨¡å‹:",-1)),e("div",ru,[i.value.modelProvider==="ollama"?(P(),A("div",uu,[e("button",{class:"settings-test-btn",onClick:X,disabled:h.value},oe(h.value?"è·å–ä¸­...":"ğŸ”„ åˆ·æ–°æ¨¡å‹åˆ—è¡¨"),9,cu),S.value.length>0?(P(),st(Ne,{key:0,"model-value":i.value.modelName,options:D.value,onChange:g[6]||(g[6]=E=>i.value.modelName=E)},null,8,["model-value","options"])):(P(),A("p",du,"ç‚¹å‡»åˆ·æ–°è·å–å¯ç”¨æ¨¡å‹"))])):i.value.modelProvider==="sakura"?(P(),A("div",gu,[e("button",{class:"settings-test-btn",onClick:ae,disabled:h.value},oe(h.value?"è·å–ä¸­...":"ğŸ”„ åˆ·æ–°æ¨¡å‹åˆ—è¡¨"),9,pu),M.value.length>0?(P(),st(Ne,{key:0,"model-value":i.value.modelName,options:U.value,onChange:g[7]||(g[7]=E=>i.value.modelName=E)},null,8,["model-value","options"])):(P(),A("p",mu,"ç‚¹å‡»åˆ·æ–°è·å–å¯ç”¨æ¨¡å‹"))])):ge("",!0)])],512),[[Fe,w.value]]),ne(e("div",vu,[e("div",fu,[g[18]||(g[18]=e("label",{for:"settingsRpmTranslation"},"RPMé™åˆ¶:",-1)),ne(e("input",{type:"number",id:"settingsRpmTranslation","onUpdate:modelValue":g[8]||(g[8]=E=>i.value.rpmTranslation=E),min:"0",step:"1"},null,512),[[Se,i.value.rpmTranslation,void 0,{number:!0}]]),g[19]||(g[19]=e("div",{class:"input-hint"},"æ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",bu,[g[20]||(g[20]=e("label",{for:"settingsTranslationMaxRetries"},"é‡è¯•æ¬¡æ•°:",-1)),ne(e("input",{type:"number",id:"settingsTranslationMaxRetries","onUpdate:modelValue":g[9]||(g[9]=E=>i.value.translationMaxRetries=E),min:"0",max:"10",step:"1"},null,512),[[Se,i.value.translationMaxRetries,void 0,{number:!0}]])])],512),[[Fe,W.value]]),ne(e("div",hu,[e("button",{class:"settings-test-btn",onClick:Z,disabled:r.value},oe(r.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,yu)],512),[[Fe,w.value]]),ne(e("div",xu,[e("button",{class:"settings-test-btn",onClick:d,disabled:r.value},oe(r.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,_u)],512),[[Fe,!w.value]])]),e("div",Cu,[g[26]||(g[26]=e("div",{class:"settings-group-title"},"æç¤ºè¯è®¾ç½®",-1)),e("div",ku,[g[23]||(g[23]=e("label",{for:"settingsPromptContent"},"ç¿»è¯‘æç¤ºè¯:",-1)),ne(e("textarea",{id:"settingsPromptContent","onUpdate:modelValue":g[10]||(g[10]=E=>i.value.promptContent=E),rows:"4",placeholder:"ç¿»è¯‘æç¤ºè¯"},null,512),[[Se,i.value.promptContent]]),e("div",Su,[xe(Ne,{"model-value":i.value.translatePromptMode,options:n,onChange:g[11]||(g[11]=E=>{i.value.translatePromptMode=E,N()})},null,8,["model-value"]),g[22]||(g[22]=e("span",{class:"input-hint"},"JSONæ ¼å¼è¾“å‡ºæ›´ç»“æ„åŒ–",-1))]),xe(Dt,{"prompt-type":"translate",onSelect:m}),e("button",{type:"button",class:"reset-btn",onClick:b}," é‡ç½®ä¸ºé»˜è®¤ ")]),e("div",wu,[e("label",$u,[ne(e("input",{type:"checkbox","onUpdate:modelValue":g[12]||(g[12]=E=>i.value.enableTextboxPrompt=E)},null,512),[[tt,i.value.enableTextboxPrompt]]),g[24]||(g[24]=pe(" å¯ç”¨æ–‡æœ¬æ¡†æç¤ºè¯ ",-1))])]),ne(e("div",Tu,[g[25]||(g[25]=e("label",{for:"settingsTextboxPromptContent"},"æ–‡æœ¬æ¡†æç¤ºè¯:",-1)),ne(e("textarea",{id:"settingsTextboxPromptContent","onUpdate:modelValue":g[13]||(g[13]=E=>i.value.textboxPromptContent=E),rows:"3",placeholder:"æ–‡æœ¬æ¡†æç¤ºè¯"},null,512),[[Se,i.value.textboxPromptContent]]),xe(Dt,{"prompt-type":"textbox",onSelect:x})],512),[[Fe,i.value.enableTextboxPrompt]])])]))}}),Ru=qe(Iu,[["__scopeId","data-v-1eaa2d97"]]),Du={class:"detection-settings"},Pu={class:"settings-group"},Mu={class:"settings-item"},Eu={class:"settings-group"},Bu={class:"settings-item"},Au={class:"settings-row"},Lu={class:"settings-item"},Fu={class:"settings-item"},Uu={class:"settings-row"},Ou={class:"settings-item"},zu={class:"settings-item"},Nu={class:"settings-group"},Vu={class:"settings-item"},Wu={class:"checkbox-label"},Ku={class:"settings-row"},qu={class:"settings-item"},Hu={class:"settings-item"},ju={class:"settings-group"},Ju={class:"settings-item"},Gu={class:"checkbox-label"},Yu=He({__name:"DetectionSettings",setup(s){const t=[{label:"CTD (Comic Text Detector)",value:"ctd"},{label:"YOLO",value:"yolo"},{label:"YOLOv5",value:"yolov5"},{label:"Default (DBNet)",value:"default"}],n=Ue(),o=ro({textDetector:n.settings.textDetector,boxExpandRatio:n.settings.boxExpand.ratio,boxExpandTop:n.settings.boxExpand.top,boxExpandBottom:n.settings.boxExpand.bottom,boxExpandLeft:n.settings.boxExpand.left,boxExpandRight:n.settings.boxExpand.right,usePreciseMask:n.settings.preciseMask.enabled,maskDilateSize:n.settings.preciseMask.dilateSize,maskBoxExpandRatio:n.settings.preciseMask.boxExpandRatio,showDetectionDebug:n.settings.showDetectionDebug}),l=K(()=>["ctd","default"].includes(o.textDetector));Ce(()=>o.textDetector,a=>{n.setTextDetector(a)}),Ce(()=>o.boxExpandRatio,a=>{n.updateBoxExpand({ratio:a})}),Ce(()=>o.boxExpandTop,a=>{n.updateBoxExpand({top:a})}),Ce(()=>o.boxExpandBottom,a=>{n.updateBoxExpand({bottom:a})}),Ce(()=>o.boxExpandLeft,a=>{n.updateBoxExpand({left:a})}),Ce(()=>o.boxExpandRight,a=>{n.updateBoxExpand({right:a})}),Ce(()=>o.usePreciseMask,a=>{n.updatePreciseMask({enabled:a})}),Ce(()=>o.maskDilateSize,a=>{n.updatePreciseMask({dilateSize:a})}),Ce(()=>o.maskBoxExpandRatio,a=>{n.updatePreciseMask({boxExpandRatio:a})}),Ce(()=>o.showDetectionDebug,a=>{n.setShowDetectionDebug(a)});function i(){l.value||(o.usePreciseMask=!1)}return(a,r)=>(P(),A("div",Du,[e("div",Pu,[r[11]||(r[11]=e("div",{class:"settings-group-title"},"æ–‡å­—æ£€æµ‹å™¨",-1)),e("div",Mu,[r[10]||(r[10]=e("label",{for:"settingsTextDetector"},"æ£€æµ‹å™¨ç±»å‹:",-1)),xe(Ne,{modelValue:o.textDetector,"onUpdate:modelValue":r[0]||(r[0]=h=>o.textDetector=h),options:t,onChange:i},null,8,["modelValue"])])]),e("div",Eu,[r[18]||(r[18]=e("div",{class:"settings-group-title"},"æ–‡æœ¬æ¡†æ‰©å±•å‚æ•°",-1)),e("div",Bu,[r[12]||(r[12]=e("label",{for:"settingsBoxExpandRatio"},"æ•´ä½“æ‰©å±• (%):",-1)),ne(e("input",{type:"number",id:"settingsBoxExpandRatio","onUpdate:modelValue":r[1]||(r[1]=h=>o.boxExpandRatio=h),min:"0",max:"50",step:"1"},null,512),[[Se,o.boxExpandRatio,void 0,{number:!0}]]),r[13]||(r[13]=e("div",{class:"input-hint"},"å‘å››å‘¨å‡åŒ€æ‰©å±•çš„ç™¾åˆ†æ¯” (0-50%)",-1))]),e("div",Au,[e("div",Lu,[r[14]||(r[14]=e("label",{for:"settingsBoxExpandTop"},"ä¸Šæ–¹æ‰©å±• (%):",-1)),ne(e("input",{type:"number",id:"settingsBoxExpandTop","onUpdate:modelValue":r[2]||(r[2]=h=>o.boxExpandTop=h),min:"0",max:"50",step:"1"},null,512),[[Se,o.boxExpandTop,void 0,{number:!0}]])]),e("div",Fu,[r[15]||(r[15]=e("label",{for:"settingsBoxExpandBottom"},"ä¸‹æ–¹æ‰©å±• (%):",-1)),ne(e("input",{type:"number",id:"settingsBoxExpandBottom","onUpdate:modelValue":r[3]||(r[3]=h=>o.boxExpandBottom=h),min:"0",max:"50",step:"1"},null,512),[[Se,o.boxExpandBottom,void 0,{number:!0}]])])]),e("div",Uu,[e("div",Ou,[r[16]||(r[16]=e("label",{for:"settingsBoxExpandLeft"},"å·¦ä¾§æ‰©å±• (%):",-1)),ne(e("input",{type:"number",id:"settingsBoxExpandLeft","onUpdate:modelValue":r[4]||(r[4]=h=>o.boxExpandLeft=h),min:"0",max:"50",step:"1"},null,512),[[Se,o.boxExpandLeft,void 0,{number:!0}]])]),e("div",zu,[r[17]||(r[17]=e("label",{for:"settingsBoxExpandRight"},"å³ä¾§æ‰©å±• (%):",-1)),ne(e("input",{type:"number",id:"settingsBoxExpandRight","onUpdate:modelValue":r[5]||(r[5]=h=>o.boxExpandRight=h),min:"0",max:"50",step:"1"},null,512),[[Se,o.boxExpandRight,void 0,{number:!0}]])])])]),ne(e("div",Nu,[r[25]||(r[25]=e("div",{class:"settings-group-title"},"ç²¾ç¡®æ–‡å­—æ©è†œ",-1)),e("div",Vu,[e("label",Wu,[ne(e("input",{type:"checkbox","onUpdate:modelValue":r[6]||(r[6]=h=>o.usePreciseMask=h)},null,512),[[tt,o.usePreciseMask]]),r[19]||(r[19]=pe(" å¯ç”¨ç²¾ç¡®æ–‡å­—æ©è†œ ",-1))]),r[20]||(r[20]=e("div",{class:"input-hint"},"ä½¿ç”¨æ›´ç²¾ç¡®çš„æ–‡å­—åŒºåŸŸæ©è†œè¿›è¡Œä¿®å¤",-1))]),ne(e("div",Ku,[e("div",qu,[r[21]||(r[21]=e("label",{for:"settingsMaskDilateSize"},"è†¨èƒ€å¤§å°:",-1)),ne(e("input",{type:"number",id:"settingsMaskDilateSize","onUpdate:modelValue":r[7]||(r[7]=h=>o.maskDilateSize=h),min:"0",step:"1"},null,512),[[Se,o.maskDilateSize,void 0,{number:!0}]]),r[22]||(r[22]=e("div",{class:"input-hint"},"æ©è†œè†¨èƒ€åƒç´ æ•°",-1))]),e("div",Hu,[r[23]||(r[23]=e("label",{for:"settingsMaskBoxExpandRatio"},"æ ‡æ³¨æ¡†æ‰©å¤§æ¯”ä¾‹ (%):",-1)),ne(e("input",{type:"number",id:"settingsMaskBoxExpandRatio","onUpdate:modelValue":r[8]||(r[8]=h=>o.maskBoxExpandRatio=h),min:"0",max:"100",step:"1"},null,512),[[Se,o.maskBoxExpandRatio,void 0,{number:!0}]]),r[24]||(r[24]=e("div",{class:"input-hint"},"æ ‡æ³¨æ¡†åŒºåŸŸæ‰©å¤§ç™¾åˆ†æ¯”",-1))])],512),[[Fe,o.usePreciseMask]])],512),[[Fe,l.value]]),e("div",ju,[r[28]||(r[28]=e("div",{class:"settings-group-title"},"è°ƒè¯•é€‰é¡¹",-1)),e("div",Ju,[e("label",Gu,[ne(e("input",{type:"checkbox","onUpdate:modelValue":r[9]||(r[9]=h=>o.showDetectionDebug=h)},null,512),[[tt,o.showDetectionDebug]]),r[26]||(r[26]=pe(" æ˜¾ç¤ºæ£€æµ‹æ¡†è°ƒè¯•ä¿¡æ¯ ",-1))]),r[27]||(r[27]=e("div",{class:"input-hint"},"åœ¨ç¿»è¯‘ç»“æœä¸­æ˜¾ç¤ºæ°”æ³¡æ£€æµ‹æ¡†ï¼Œç”¨äºè°ƒè¯•",-1))])])]))}}),Xu=qe(Yu,[["__scopeId","data-v-c12c43ee"]]),Zu={class:"hq-translation-settings"},Qu={class:"settings-group"},ec={class:"settings-row"},tc={class:"settings-item"},oc={class:"settings-item"},nc={class:"password-input-wrapper"},sc=["type"],ac={key:0,class:"eye-icon"},lc={key:1,class:"eye-off-icon"},ic={class:"settings-item"},rc={class:"settings-item"},uc={class:"model-input-with-fetch"},cc=["disabled"],dc={class:"fetch-text"},gc={key:0,class:"model-select-container"},pc={class:"model-count"},mc={class:"settings-item"},vc=["disabled"],fc={class:"settings-group"},bc={class:"settings-row"},hc={class:"settings-item"},yc={class:"settings-item"},xc={class:"settings-row"},_c={class:"settings-item"},Cc={class:"settings-item"},kc={class:"settings-group"},Sc={class:"settings-row"},wc={class:"settings-item"},$c={class:"checkbox-label"},Tc={class:"settings-item"},Ic={class:"settings-row"},Rc={class:"settings-item"},Dc={class:"checkbox-label"},Pc={class:"settings-item"},Mc={class:"checkbox-label"},Ec={class:"settings-group"},Bc={class:"settings-item"},Ac=He({__name:"HqTranslationSettings",setup(s){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],n=[{label:"Geminié£æ ¼ (reasoning_effort=low)",value:"gemini"},{label:"ç«å±±å¼•æ“é£æ ¼ (thinking=null)",value:"volcano"}],o=Ue(),l=rt(),i=K(()=>o.settings.hqTranslation),a=_({apiKey:o.settings.hqTranslation.apiKey,modelName:o.settings.hqTranslation.modelName,customBaseUrl:o.settings.hqTranslation.customBaseUrl,batchSize:o.settings.hqTranslation.batchSize,sessionReset:o.settings.hqTranslation.sessionReset,rpmLimit:o.settings.hqTranslation.rpmLimit,maxRetries:o.settings.hqTranslation.maxRetries,lowReasoning:o.settings.hqTranslation.lowReasoning,noThinkingMethod:o.settings.hqTranslation.noThinkingMethod,forceJsonOutput:o.settings.hqTranslation.forceJsonOutput,useStream:o.settings.hqTranslation.useStream,prompt:o.settings.hqTranslation.prompt});Ce(()=>a.value.apiKey,f=>{o.updateHqTranslation({apiKey:f})}),Ce(()=>a.value.modelName,f=>{o.updateHqTranslation({modelName:f})}),Ce(()=>a.value.customBaseUrl,f=>{o.updateHqTranslation({customBaseUrl:f})}),Ce(()=>a.value.batchSize,f=>{o.updateHqTranslation({batchSize:f})}),Ce(()=>a.value.sessionReset,f=>{o.updateHqTranslation({sessionReset:f})}),Ce(()=>a.value.rpmLimit,f=>{o.updateHqTranslation({rpmLimit:f})}),Ce(()=>a.value.maxRetries,f=>{o.updateHqTranslation({maxRetries:f})}),Ce(()=>a.value.lowReasoning,f=>{o.updateHqTranslation({lowReasoning:f})}),Ce(()=>a.value.noThinkingMethod,f=>{o.updateHqTranslation({noThinkingMethod:f})}),Ce(()=>a.value.forceJsonOutput,f=>{o.updateHqTranslation({forceJsonOutput:f})}),Ce(()=>a.value.useStream,f=>{o.updateHqTranslation({useStream:f})}),Ce(()=>a.value.prompt,f=>{o.updateHqTranslation({prompt:f})});const r=_(!1),h=_(!1),T=_([]),S=_(!1),M=K(()=>{const f=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return T.value.forEach(c=>f.push({label:c,value:c})),f});function L(f){o.setHqProvider(f),T.value=[],D()}function D(){const f=o.settings.hqTranslation;a.value.apiKey=f.apiKey,a.value.modelName=f.modelName,a.value.customBaseUrl=f.customBaseUrl,a.value.batchSize=f.batchSize,a.value.sessionReset=f.sessionReset,a.value.rpmLimit=f.rpmLimit,a.value.maxRetries=f.maxRetries,a.value.lowReasoning=f.lowReasoning,a.value.noThinkingMethod=f.noThinkingMethod,a.value.forceJsonOutput=f.forceJsonOutput,a.value.useStream=f.useStream,a.value.prompt=f.prompt}function U(f){return{siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰OpenAI"}[f]||f}async function w(){const f=i.value.provider,c=a.value.apiKey?.trim(),k=a.value.customBaseUrl?.trim();if(!c){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(f)){l.warning(`${U(f)} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`);return}if(f==="custom_openai"&&!k){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}h.value=!0;try{const N=await We.fetchModels(f,c,k);N.success&&N.models&&N.models.length>0?(T.value=N.models.map(Y=>Y.id),l.success(`è·å–åˆ° ${N.models.length} ä¸ªæ¨¡å‹`)):l.warning(N.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(N){const Y=N instanceof Error?N.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";l.error(Y)}finally{h.value=!1}}async function W(){const f=i.value.provider,c=a.value.apiKey?.trim(),k=a.value.modelName?.trim(),C=a.value.customBaseUrl?.trim();if(!c){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!k){l.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}if(f==="custom_openai"&&!C){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å¡«å†™ Base URL");return}S.value=!0,l.info("æ­£åœ¨æµ‹è¯•è¿æ¥...");try{const N=await We.testAiTranslateConnection({provider:f,apiKey:c,modelName:k,baseUrl:C});N.success?l.success(N.message||`${U(f)} è¿æ¥æˆåŠŸ!`):l.error(N.message||N.error||"è¿æ¥å¤±è´¥")}catch(N){const Y=N instanceof Error?N.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(Y)}finally{S.value=!1}}function q(){o.updateHqTranslation({prompt:Fo}),a.value.prompt=Fo,l.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}function O(f,c){o.updateHqTranslation({prompt:f}),a.value.prompt=f,l.success(`å·²åº”ç”¨æç¤ºè¯: ${c}`)}return(f,c)=>(P(),A("div",Zu,[e("div",Qu,[c[20]||(c[20]=e("div",{class:"settings-group-title"},"é«˜è´¨é‡ç¿»è¯‘æœåŠ¡é…ç½®",-1)),e("div",ec,[e("div",tc,[c[15]||(c[15]=e("label",{for:"settingsHqTranslateProvider"},"æœåŠ¡å•†:",-1)),xe(Ne,{"model-value":i.value.provider,options:t,onChange:c[0]||(c[0]=k=>L(k))},null,8,["model-value"])]),e("div",oc,[c[16]||(c[16]=e("label",{for:"settingsHqApiKey"},"API Key:",-1)),e("div",nc,[ne(e("input",{type:r.value?"text":"password",id:"settingsHqApiKey","onUpdate:modelValue":c[1]||(c[1]=k=>a.value.apiKey=k),class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,sc),[[Ct,a.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:c[2]||(c[2]=k=>r.value=!r.value)},[r.value?(P(),A("span",lc,"ğŸ‘â€ğŸ—¨")):(P(),A("span",ac,"ğŸ‘"))])])])]),ne(e("div",ic,[c[17]||(c[17]=e("label",{for:"settingsHqCustomBaseUrl"},"Base URL:",-1)),ne(e("input",{type:"text",id:"settingsHqCustomBaseUrl","onUpdate:modelValue":c[3]||(c[3]=k=>a.value.customBaseUrl=k),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[Se,a.value.customBaseUrl]])],512),[[Fe,i.value.provider==="custom_openai"]]),e("div",rc,[c[19]||(c[19]=e("label",{for:"settingsHqModelName"},"æ¨¡å‹åç§°:",-1)),e("div",uc,[ne(e("input",{type:"text",id:"settingsHqModelName","onUpdate:modelValue":c[4]||(c[4]=k=>a.value.modelName=k),placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},null,512),[[Se,a.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:w,disabled:h.value},[c[18]||(c[18]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",dc,oe(h.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,cc)]),T.value.length>0?(P(),A("div",gc,[xe(Ne,{modelValue:a.value.modelName,"onUpdate:modelValue":c[5]||(c[5]=k=>a.value.modelName=k),options:M.value},null,8,["modelValue","options"]),e("span",pc,"å…± "+oe(T.value.length)+" ä¸ªæ¨¡å‹",1)])):ge("",!0)]),e("div",mc,[e("button",{class:"settings-test-btn",onClick:W,disabled:S.value},oe(S.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,vc)])]),e("div",fc,[c[28]||(c[28]=e("div",{class:"settings-group-title"},"æ‰¹å¤„ç†è®¾ç½®",-1)),e("div",bc,[e("div",hc,[c[21]||(c[21]=e("label",{for:"settingsHqBatchSize"},"æ‰¹æ¬¡å¤§å°:",-1)),ne(e("input",{type:"number",id:"settingsHqBatchSize","onUpdate:modelValue":c[6]||(c[6]=k=>a.value.batchSize=k),min:"1",max:"10",step:"1"},null,512),[[Se,a.value.batchSize,void 0,{number:!0}]]),c[22]||(c[22]=e("div",{class:"input-hint"},"æ¯æ‰¹å¤„ç†çš„å›¾ç‰‡æ•°é‡ (æ¨è3-5å¼ )",-1))]),e("div",yc,[c[23]||(c[23]=e("label",{for:"settingsHqSessionReset"},"ä¼šè¯é‡ç½®é¢‘ç‡:",-1)),ne(e("input",{type:"number",id:"settingsHqSessionReset","onUpdate:modelValue":c[7]||(c[7]=k=>a.value.sessionReset=k),min:"1",step:"1"},null,512),[[Se,a.value.sessionReset,void 0,{number:!0}]]),c[24]||(c[24]=e("div",{class:"input-hint"},"å¤šå°‘æ‰¹æ¬¡åé‡ç½®ä¸Šä¸‹æ–‡",-1))])]),e("div",xc,[e("div",_c,[c[25]||(c[25]=e("label",{for:"settingsHqRpmLimit"},"RPMé™åˆ¶:",-1)),ne(e("input",{type:"number",id:"settingsHqRpmLimit","onUpdate:modelValue":c[8]||(c[8]=k=>a.value.rpmLimit=k),min:"0",step:"1"},null,512),[[Se,a.value.rpmLimit,void 0,{number:!0}]]),c[26]||(c[26]=e("div",{class:"input-hint"},"æ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",Cc,[c[27]||(c[27]=e("label",{for:"settingsHqMaxRetries"},"é‡è¯•æ¬¡æ•°:",-1)),ne(e("input",{type:"number",id:"settingsHqMaxRetries","onUpdate:modelValue":c[9]||(c[9]=k=>a.value.maxRetries=k),min:"0",max:"10",step:"1"},null,512),[[Se,a.value.maxRetries,void 0,{number:!0}]])])])]),e("div",kc,[c[36]||(c[36]=e("div",{class:"settings-group-title"},"é«˜çº§é€‰é¡¹",-1)),e("div",Sc,[e("div",wc,[e("label",$c,[ne(e("input",{type:"checkbox","onUpdate:modelValue":c[10]||(c[10]=k=>a.value.lowReasoning=k)},null,512),[[tt,a.value.lowReasoning]]),c[29]||(c[29]=pe(" ä½æ¨ç†æ¨¡å¼ ",-1))]),c[30]||(c[30]=e("div",{class:"input-hint"},"å‡å°‘æ¨¡å‹æ¨ç†æ·±åº¦ï¼Œæé«˜é€Ÿåº¦",-1))]),e("div",Tc,[c[31]||(c[31]=e("label",{for:"settingsHqNoThinkingMethod"},"å–æ¶ˆæ€è€ƒæ–¹æ³•:",-1)),xe(Ne,{modelValue:a.value.noThinkingMethod,"onUpdate:modelValue":c[11]||(c[11]=k=>a.value.noThinkingMethod=k),options:n},null,8,["modelValue"])])]),e("div",Ic,[e("div",Rc,[e("label",Dc,[ne(e("input",{type:"checkbox","onUpdate:modelValue":c[12]||(c[12]=k=>a.value.forceJsonOutput=k)},null,512),[[tt,a.value.forceJsonOutput]]),c[32]||(c[32]=pe(" å¼ºåˆ¶JSONè¾“å‡º ",-1))]),c[33]||(c[33]=e("div",{class:"input-hint"},"ä½¿ç”¨ response_format: json_object",-1))]),e("div",Pc,[e("label",Mc,[ne(e("input",{type:"checkbox","onUpdate:modelValue":c[13]||(c[13]=k=>a.value.useStream=k)},null,512),[[tt,a.value.useStream]]),c[34]||(c[34]=pe(" æµå¼è°ƒç”¨ ",-1))]),c[35]||(c[35]=e("div",{class:"input-hint"},"ä½¿ç”¨æµå¼APIè°ƒç”¨",-1))])])]),e("div",Ec,[c[37]||(c[37]=e("div",{class:"settings-group-title"},"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯",-1)),e("div",Bc,[ne(e("textarea",{id:"settingsHqPrompt","onUpdate:modelValue":c[14]||(c[14]=k=>a.value.prompt=k),rows:"6",placeholder:"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯"},null,512),[[Se,a.value.prompt]]),xe(Dt,{"prompt-type":"hq_translate",onSelect:O}),e("button",{class:"btn btn-secondary btn-sm",onClick:q},"é‡ç½®ä¸ºé»˜è®¤")])])]))}}),Lc=qe(Ac,[["__scopeId","data-v-23f4a3f7"]]),Fc={class:"proofreading-settings"},Uc={class:"settings-group"},Oc={class:"settings-item"},zc={class:"checkbox-label"},Nc={class:"settings-item"},Vc={class:"settings-group"},Wc={class:"round-header"},Kc={class:"round-title"},qc=["onClick","disabled"],Hc={class:"round-content"},jc={class:"settings-item"},Jc=["onUpdate:modelValue"],Gc={class:"settings-row"},Yc={class:"settings-item"},Xc={class:"settings-item"},Zc={class:"password-input-wrapper"},Qc=["type","onUpdate:modelValue"],ed=["onClick"],td={key:0,class:"eye-icon"},od={key:1,class:"eye-off-icon"},nd={class:"settings-item"},sd=["onUpdate:modelValue"],ad={class:"settings-item"},ld={class:"model-input-with-fetch"},id=["onUpdate:modelValue"],rd=["onClick","disabled"],ud={class:"fetch-text"},cd={key:0,class:"model-select-container"},dd={class:"model-count"},gd={class:"settings-item"},pd=["onClick","disabled"],md={class:"settings-row"},vd={class:"settings-item"},fd=["onUpdate:modelValue"],bd={class:"settings-item"},hd=["onUpdate:modelValue"],yd={class:"settings-item"},xd=["onUpdate:modelValue"],_d={class:"settings-row"},Cd={class:"settings-item"},kd={class:"checkbox-label"},Sd=["onUpdate:modelValue"],wd={class:"settings-item"},$d={class:"settings-item"},Td={class:"checkbox-label"},Id=["onUpdate:modelValue"],Rd={class:"settings-item"},Dd=["onUpdate:modelValue"],Pd=["onClick"],Md=He({__name:"ProofreadingSettings",setup(s){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],n=[{label:"Geminié£æ ¼",value:"gemini"},{label:"ç«å±±å¼•æ“é£æ ¼",value:"volcano"}],o=Ue(),l=rt(),i=_({}),a=_({}),r=_({}),h=K(()=>o.settings.proofreading.rounds),T=K({get:()=>o.settings.proofreading.maxRetries,set:O=>o.setProofreadingMaxRetries(O)}),S=K({get:()=>o.settings.proofreading.enabled,set:O=>o.setProofreadingEnabled(O)});Ce(()=>o.settings.proofreading.rounds,()=>{o.saveToStorage()},{deep:!0});function M(O){const f=r.value[O]||[],c=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return f.forEach(k=>c.push({label:k,value:k})),c}async function L(O){const f=h.value[O];if(!f)return;const c=f.provider,k=f.apiKey?.trim(),C=f.customBaseUrl?.trim();if(!k){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(c)){l.warning("å½“å‰æœåŠ¡å•†ä¸æ”¯æŒè·å–æ¨¡å‹åˆ—è¡¨");return}i.value[O]=!0;try{const Y=await We.fetchModels(c,k,C);Y.success&&Y.models&&Y.models.length>0?(r.value[O]=Y.models.map(ie=>ie.id),l.success(`è½®æ¬¡ ${O+1}: è·å–åˆ° ${Y.models.length} ä¸ªæ¨¡å‹`)):l.warning(Y.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(Y){const ie=Y instanceof Error?Y.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";l.error(ie)}finally{i.value[O]=!1}}async function D(O){const f=h.value[O];if(!f)return;const c=f.provider,k=f.apiKey?.trim(),C=f.modelName?.trim(),N=f.customBaseUrl?.trim();if(!k){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!C){l.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}a.value[O]=!0,l.info(`æ­£åœ¨æµ‹è¯•è½®æ¬¡ ${O+1} çš„è¿æ¥...`);try{const Y=await We.testAiTranslateConnection({provider:c,apiKey:k,modelName:C,baseUrl:N});Y.success?l.success(Y.message||"è¿æ¥æˆåŠŸ!"):l.error(Y.message||Y.error||"è¿æ¥å¤±è´¥")}catch(Y){const ie=Y instanceof Error?Y.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(ie)}finally{a.value[O]=!1}}function U(){const O={name:`ç¬¬${h.value.length+1}è½®æ ¡å¯¹`,provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",batchSize:3,sessionReset:20,rpmLimit:7,lowReasoning:!1,noThinkingMethod:"gemini",forceJsonOutput:!0,prompt:Uo,showApiKey:!1};o.addProofreadingRound(O),l.success("å·²æ·»åŠ æ–°çš„æ ¡å¯¹è½®æ¬¡")}function w(O){if(h.value.length<=1){l.warning("è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªæ ¡å¯¹è½®æ¬¡");return}o.removeProofreadingRound(O),l.success("å·²åˆ é™¤æ ¡å¯¹è½®æ¬¡")}function W(O){o.updateProofreadingRound(O,{prompt:Uo}),l.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}function q(O,f,c){o.updateProofreadingRound(O,{prompt:f}),l.success(`å·²åº”ç”¨æç¤ºè¯: ${c}`)}return(O,f)=>(P(),A("div",Fc,[e("div",Uc,[f[5]||(f[5]=e("div",{class:"settings-group-title"},"AIæ ¡å¯¹è®¾ç½®",-1)),e("div",Oc,[e("label",zc,[ne(e("input",{type:"checkbox","onUpdate:modelValue":f[0]||(f[0]=c=>S.value=c)},null,512),[[tt,S.value]]),f[2]||(f[2]=pe(" å¯ç”¨AIæ ¡å¯¹ ",-1))]),f[3]||(f[3]=e("div",{class:"input-hint"},"ç¿»è¯‘å®Œæˆåè‡ªåŠ¨è¿›è¡ŒAIæ ¡å¯¹",-1))]),e("div",Nc,[f[4]||(f[4]=e("label",{for:"settingsProofreadingMaxRetries"},"å…¨å±€é‡è¯•æ¬¡æ•°:",-1)),ne(e("input",{type:"number",id:"settingsProofreadingMaxRetries","onUpdate:modelValue":f[1]||(f[1]=c=>T.value=c),min:"0",max:"10",step:"1"},null,512),[[Se,T.value,void 0,{number:!0}]])])]),ne(e("div",Vc,[e("div",{class:"settings-group-title"},[f[6]||(f[6]=pe(" æ ¡å¯¹è½®æ¬¡é…ç½® ",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:U},"+ æ·»åŠ è½®æ¬¡")]),(P(!0),A(Ae,null,Je(h.value,(c,k)=>(P(),A("div",{key:k,class:"proofreading-round"},[e("div",Wc,[e("span",Kc,"è½®æ¬¡ "+oe(k+1)+": "+oe(c.name||"æœªå‘½å"),1),e("button",{class:"btn btn-danger btn-sm",onClick:C=>w(k),disabled:h.value.length<=1}," åˆ é™¤ ",8,qc)]),e("div",Hc,[e("div",jc,[f[7]||(f[7]=e("label",null,"è½®æ¬¡åç§°:",-1)),ne(e("input",{type:"text","onUpdate:modelValue":C=>c.name=C,placeholder:"å¦‚: ç¬¬ä¸€è½®æ ¡å¯¹"},null,8,Jc),[[Se,c.name]])]),e("div",Gc,[e("div",Yc,[f[8]||(f[8]=e("label",null,"æœåŠ¡å•†:",-1)),xe(Ne,{modelValue:c.provider,"onUpdate:modelValue":C=>c.provider=C,options:t},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Xc,[f[9]||(f[9]=e("label",null,"API Key:",-1)),e("div",Zc,[ne(e("input",{type:c.showApiKey?"text":"password","onUpdate:modelValue":C=>c.apiKey=C,class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,Qc),[[Ct,c.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:C=>c.showApiKey=!c.showApiKey},[c.showApiKey?(P(),A("span",od,"ğŸ‘â€ğŸ—¨")):(P(),A("span",td,"ğŸ‘"))],8,ed)])])]),ne(e("div",nd,[f[10]||(f[10]=e("label",null,"Base URL:",-1)),ne(e("input",{type:"text","onUpdate:modelValue":C=>c.customBaseUrl=C,placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,8,sd),[[Se,c.customBaseUrl]])],512),[[Fe,c.provider==="custom_openai"]]),e("div",ad,[f[12]||(f[12]=e("label",null,"æ¨¡å‹åç§°:",-1)),e("div",ld,[ne(e("input",{type:"text","onUpdate:modelValue":C=>c.modelName=C,placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},null,8,id),[[Se,c.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:C=>L(k),disabled:i.value[k]},[f[11]||(f[11]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",ud,oe(i.value[k]?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,rd)]),r.value[k]&&r.value[k].length>0?(P(),A("div",cd,[xe(Ne,{modelValue:c.modelName,"onUpdate:modelValue":C=>c.modelName=C,options:M(k)},null,8,["modelValue","onUpdate:modelValue","options"]),e("span",dd,"å…± "+oe(r.value[k].length)+" ä¸ªæ¨¡å‹",1)])):ge("",!0)]),e("div",gd,[e("button",{class:"settings-test-btn",onClick:C=>D(k),disabled:a.value[k]},oe(a.value[k]?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,pd)]),e("div",md,[e("div",vd,[f[13]||(f[13]=e("label",null,"æ‰¹æ¬¡å¤§å°:",-1)),ne(e("input",{type:"number","onUpdate:modelValue":C=>c.batchSize=C,min:"1",max:"10",step:"1"},null,8,fd),[[Se,c.batchSize,void 0,{number:!0}]])]),e("div",bd,[f[14]||(f[14]=e("label",null,"ä¼šè¯é‡ç½®é¢‘ç‡:",-1)),ne(e("input",{type:"number","onUpdate:modelValue":C=>c.sessionReset=C,min:"1",step:"1"},null,8,hd),[[Se,c.sessionReset,void 0,{number:!0}]])]),e("div",yd,[f[15]||(f[15]=e("label",null,"RPMé™åˆ¶:",-1)),ne(e("input",{type:"number","onUpdate:modelValue":C=>c.rpmLimit=C,min:"0",step:"1"},null,8,xd),[[Se,c.rpmLimit,void 0,{number:!0}]])])]),e("div",_d,[e("div",Cd,[e("label",kd,[ne(e("input",{type:"checkbox","onUpdate:modelValue":C=>c.lowReasoning=C},null,8,Sd),[[tt,c.lowReasoning]]),f[16]||(f[16]=pe(" ä½æ¨ç†æ¨¡å¼ ",-1))])]),e("div",wd,[f[17]||(f[17]=e("label",null,"å–æ¶ˆæ€è€ƒæ–¹æ³•:",-1)),xe(Ne,{modelValue:c.noThinkingMethod,"onUpdate:modelValue":C=>c.noThinkingMethod=C,options:n},null,8,["modelValue","onUpdate:modelValue"])]),e("div",$d,[e("label",Td,[ne(e("input",{type:"checkbox","onUpdate:modelValue":C=>c.forceJsonOutput=C},null,8,Id),[[tt,c.forceJsonOutput]]),f[18]||(f[18]=pe(" å¼ºåˆ¶JSONè¾“å‡º ",-1))])])]),e("div",Rd,[f[19]||(f[19]=e("label",null,"æ ¡å¯¹æç¤ºè¯:",-1)),ne(e("textarea",{"onUpdate:modelValue":C=>c.prompt=C,rows:"4",placeholder:"æ ¡å¯¹æç¤ºè¯"},null,8,Dd),[[Se,c.prompt]]),xe(Dt,{"prompt-type":"proofreading",onSelect:(C,N)=>q(k,C,N)},null,8,["onSelect"]),e("button",{class:"btn btn-secondary btn-sm",onClick:C=>W(k)},"é‡ç½®ä¸ºé»˜è®¤",8,Pd)])])]))),128))],512),[[Fe,S.value]])]))}}),Ed=qe(Md,[["__scopeId","data-v-663a7972"]]),Bd={class:"prompt-library"},Ad={class:"settings-group"},Ld={class:"settings-item"},Fd={key:0,class:"settings-item"},Ud={class:"mode-hint"},Od={class:"settings-group"},zd={key:0,class:"loading-hint"},Nd={key:1,class:"empty-hint"},Vd={key:2,class:"prompt-list"},Wd=["onClick"],Kd={class:"prompt-name"},qd={class:"prompt-actions"},Hd=["onClick"],jd=["onClick","disabled"],Jd={class:"settings-group"},Gd={class:"settings-item"},Yd={class:"settings-item"},Xd={class:"prompt-editor-actions"},Zd=["disabled"],Qd=He({__name:"PromptLibrary",setup(s){const t=[{label:"ç¿»è¯‘æç¤ºè¯",value:"translate"},{label:"æ–‡æœ¬æ¡†æç¤ºè¯",value:"textbox"},{label:"AIè§†è§‰OCRæç¤ºè¯",value:"ai_vision_ocr"},{label:"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯",value:"hq_translate"},{label:"æ ¡å¯¹æç¤ºè¯",value:"proofreading"}],n=[{label:"æ™®é€šæ¨¡å¼",value:"false"},{label:"JSONæ ¼å¼æ¨¡å¼",value:"true"}],o=rt(),l=Ue(),i=_("translate"),a=_([]),r=_(""),h=_(""),T=_(""),S=_(!1),M=_(!1),L=K(()=>i.value==="translate"||i.value==="ai_vision_ocr"),D=K(()=>M.value?"é€‚ç”¨äºéœ€è¦ç»“æ„åŒ–è¾“å‡ºçš„åœºæ™¯":"é€‚ç”¨äºæ™®é€šç¿»è¯‘åœºæ™¯");async function U(){S.value=!0;try{let k;i.value==="textbox"?k=await We.getTextboxPrompts():k=await We.getPrompts(i.value);const C=k.prompt_names||[];a.value=C.map(N=>({name:N}))}catch(k){const C=k instanceof Error?k.message:"åŠ è½½æç¤ºè¯åˆ—è¡¨å¤±è´¥";o.error(C)}finally{S.value=!1}}async function w(k){r.value=k,h.value=k,await W(k)}async function W(k){try{let C;i.value==="textbox"?C=await We.getTextboxPromptContent(k):C=await We.getPromptContent(i.value,k),h.value=k,T.value=C.prompt_content||"",r.value=k,o.success("å·²åŠ è½½æç¤ºè¯")}catch(C){const N=C instanceof Error?C.message:"åŠ è½½æç¤ºè¯å†…å®¹å¤±è´¥";o.error(N)}}async function q(){if(!h.value||!T.value){o.warning("è¯·è¾“å…¥æç¤ºè¯åç§°å’Œå†…å®¹");return}try{i.value==="textbox"?await We.saveTextboxPrompt(h.value,T.value):await We.savePrompt(i.value,h.value,T.value),o.success("æç¤ºè¯ä¿å­˜æˆåŠŸ"),h.value="",T.value="",await U()}catch(k){const C=k instanceof Error?k.message:"ä¿å­˜æç¤ºè¯å¤±è´¥";o.error(C)}}async function O(k){if(k==="default"){o.warning("é»˜è®¤æç¤ºè¯ä¸èƒ½åˆ é™¤");return}try{i.value==="textbox"?await We.deleteTextboxPrompt(k):await We.deletePrompt(i.value,k),o.success("æç¤ºè¯åˆ é™¤æˆåŠŸ"),r.value===k&&(r.value="",h.value="",T.value=""),await U()}catch(C){const N=C instanceof Error?C.message:"åˆ é™¤æç¤ºè¯å¤±è´¥";o.error(N)}}function f(){r.value="",h.value="",T.value="",i.value==="translate"?M.value=l.settings.translation.isJsonMode:i.value==="ai_vision_ocr"?M.value=l.settings.aiVisionOcr.isJsonMode:M.value=!1,U()}function c(){i.value==="translate"?l.updateTranslationService({isJsonMode:M.value}):i.value==="ai_vision_ocr"&&l.updateAiVisionOcr({isJsonMode:M.value}),o.info(`å·²åˆ‡æ¢åˆ°${M.value?"JSONæ ¼å¼":"æ™®é€š"}æ¨¡å¼`)}return ut(()=>{M.value=l.settings.translation.isJsonMode,U()}),(k,C)=>(P(),A("div",Bd,[e("div",Ad,[C[6]||(C[6]=e("div",{class:"settings-group-title"},"æç¤ºè¯ç®¡ç†",-1)),e("div",Ld,[C[4]||(C[4]=e("label",{for:"promptType"},"æç¤ºè¯ç±»å‹:",-1)),xe(Ne,{modelValue:i.value,"onUpdate:modelValue":C[0]||(C[0]=N=>i.value=N),options:t,onChange:f},null,8,["modelValue"])]),L.value?(P(),A("div",Fd,[C[5]||(C[5]=e("label",{for:"promptMode"},"æç¤ºè¯æ¨¡å¼:",-1)),xe(Ne,{"model-value":M.value?"true":"false",options:n,onChange:C[1]||(C[1]=N=>{M.value=N==="true",c()})},null,8,["model-value"]),e("span",Ud,oe(D.value),1)])):ge("",!0)]),e("div",Od,[C[7]||(C[7]=e("div",{class:"settings-group-title"},"å·²ä¿å­˜çš„æç¤ºè¯",-1)),S.value?(P(),A("div",zd,"åŠ è½½ä¸­...")):a.value.length===0?(P(),A("div",Nd,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(P(),A("div",Vd,[(P(!0),A(Ae,null,Je(a.value,N=>(P(),A("div",{key:N.name,class:Te(["prompt-item",{active:r.value===N.name}]),onClick:Y=>w(N.name)},[e("span",Kd,oe(N.name),1),e("div",qd,[e("button",{class:"btn btn-sm",onClick:et(Y=>W(N.name),["stop"]),title:"åŠ è½½åˆ°ç¼–è¾‘å™¨"},"ğŸ“¥",8,Hd),e("button",{class:"btn btn-sm btn-danger",onClick:et(Y=>O(N.name),["stop"]),title:"åˆ é™¤",disabled:N.name==="default"}," ğŸ—‘ï¸ ",8,jd)])],10,Wd))),128))]))]),e("div",Jd,[C[10]||(C[10]=e("div",{class:"settings-group-title"},"æç¤ºè¯ç¼–è¾‘",-1)),e("div",Gd,[C[8]||(C[8]=e("label",{for:"promptName"},"æç¤ºè¯åç§°:",-1)),ne(e("input",{type:"text",id:"promptName","onUpdate:modelValue":C[2]||(C[2]=N=>h.value=N),placeholder:"è¯·è¾“å…¥æç¤ºè¯åç§°"},null,512),[[Se,h.value]])]),e("div",Yd,[C[9]||(C[9]=e("label",{for:"promptContent"},"æç¤ºè¯å†…å®¹:",-1)),ne(e("textarea",{id:"promptContent","onUpdate:modelValue":C[3]||(C[3]=N=>T.value=N),rows:"8",placeholder:"è¯·è¾“å…¥æç¤ºè¯å†…å®¹"},null,512),[[Se,T.value]])]),e("div",Xd,[e("button",{class:"btn btn-primary",onClick:q,disabled:!h.value||!T.value},"ä¿å­˜æç¤ºè¯",8,Zd)])])]))}}),eg=qe(Qd,[["__scopeId","data-v-70f0ec19"]]),tg={class:"plugin-manager"},og={class:"settings-group"},ng={key:0,class:"loading-hint"},sg={key:1,class:"empty-hint"},ag={key:2,class:"plugin-list"},lg={class:"plugin-info"},ig={class:"plugin-header"},rg={class:"plugin-name"},ug={class:"plugin-version"},cg={class:"plugin-description"},dg={class:"plugin-controls"},gg={class:"switch"},pg=["checked","onChange"],mg=["onClick"],vg=["onClick"],fg={class:"settings-group"},bg={class:"plugin-name"},hg={class:"switch"},yg=["checked","onChange"],xg={class:"plugin-config-content"},_g={class:"plugin-config-header"},Cg={class:"plugin-config-body"},kg=["for"],Sg=["id","onUpdate:modelValue"],wg=["id","onUpdate:modelValue","min","max"],$g=["id","onUpdate:modelValue","placeholder"],Tg={key:4,class:"field-description"},Ig=He({__name:"PluginManager",setup(s){const t=rt(),n=_([]),o=_({}),l=_(!1),i=_(!1),a=_(null),r=_({}),h=_({});async function T(){l.value=!0;try{const q=await _s();n.value=q.plugins||[]}catch(q){const O=q instanceof Error?q.message:"åŠ è½½æ’ä»¶åˆ—è¡¨å¤±è´¥";t.error(O)}finally{l.value=!1}}async function S(){try{const q=await Ds();o.value=q.states||{}}catch(q){console.error("åŠ è½½é»˜è®¤çŠ¶æ€å¤±è´¥:",q)}}async function M(q){try{q.enabled?(await ks(q.name),q.enabled=!1,t.success(`å·²ç¦ç”¨ ${q.display_name||q.name}`)):(await Cs(q.name),q.enabled=!0,t.success(`å·²å¯ç”¨ ${q.display_name||q.name}`))}catch(O){const f=O instanceof Error?O.message:"æ“ä½œå¤±è´¥";t.error(f)}}async function L(q,O){const f=O.target,c=f.checked;try{await Ps(q,c),o.value[q]=c,t.success("é»˜è®¤çŠ¶æ€å·²æ›´æ–°")}catch(k){const C=k instanceof Error?k.message:"è®¾ç½®å¤±è´¥";t.error(C),f.checked=!c}}async function D(q){a.value=q;try{const O=await Ms(q.name);r.value=O.schema||{};const f=await Es(q.name);h.value=f.config||{},i.value=!0}catch(O){const f=O instanceof Error?O.message:"åŠ è½½é…ç½®å¤±è´¥";t.error(f)}}function U(){i.value=!1,a.value=null,r.value={},h.value={}}async function w(){if(a.value)try{await Bs(a.value.name,h.value),t.success("é…ç½®ä¿å­˜æˆåŠŸ"),U()}catch(q){const O=q instanceof Error?q.message:"ä¿å­˜é…ç½®å¤±è´¥";t.error(O)}}async function W(q){if(confirm(`ç¡®å®šè¦åˆ é™¤æ’ä»¶ "${q.display_name||q.name}" å—ï¼Ÿ`))try{await Ss(q.name),t.success("æ’ä»¶åˆ é™¤æˆåŠŸ"),await T()}catch(O){const f=O instanceof Error?O.message:"åˆ é™¤æ’ä»¶å¤±è´¥";t.error(f)}}return ut(()=>{T(),S()}),(q,O)=>(P(),A("div",tg,[e("div",og,[O[1]||(O[1]=e("div",{class:"settings-group-title"},"å·²å®‰è£…æ’ä»¶",-1)),l.value?(P(),A("div",ng,"åŠ è½½ä¸­...")):n.value.length===0?(P(),A("div",sg,"æš‚æ— å·²å®‰è£…çš„æ’ä»¶")):(P(),A("div",ag,[(P(!0),A(Ae,null,Je(n.value,f=>(P(),A("div",{key:f.name,class:"plugin-item"},[e("div",lg,[e("div",ig,[e("span",rg,oe(f.display_name||f.name),1),e("span",ug,"v"+oe(f.version||"1.0.0"),1)]),e("p",cg,oe(f.description||"æš‚æ— æè¿°"),1)]),e("div",dg,[e("label",gg,[e("input",{type:"checkbox",checked:f.enabled,onChange:c=>M(f)},null,40,pg),O[0]||(O[0]=e("span",{class:"slider"},null,-1))]),f.has_config?(P(),A("button",{key:0,class:"btn btn-sm",onClick:c=>D(f),title:"é…ç½®"},"âš™ï¸",8,mg)):ge("",!0),e("button",{class:"btn btn-sm btn-danger",onClick:c=>W(f),title:"åˆ é™¤"},"ğŸ—‘ï¸",8,vg)])]))),128))]))]),e("div",fg,[O[3]||(O[3]=e("div",{class:"settings-group-title"},"é»˜è®¤å¯ç”¨çŠ¶æ€",-1)),O[4]||(O[4]=e("p",{class:"settings-hint"},"è®¾ç½®æ’ä»¶åœ¨æ–°ä¼šè¯ä¸­çš„é»˜è®¤å¯ç”¨çŠ¶æ€",-1)),(P(!0),A(Ae,null,Je(n.value,f=>(P(),A("div",{key:"default-"+f.name,class:"default-state-item"},[e("span",bg,oe(f.display_name||f.name),1),e("label",hg,[e("input",{type:"checkbox",checked:o.value[f.name],onChange:c=>L(f.name,c)},null,40,yg),O[2]||(O[2]=e("span",{class:"slider"},null,-1))])]))),128))]),i.value?(P(),A("div",{key:0,class:"plugin-config-modal",onClick:et(U,["self"])},[e("div",xg,[e("div",_g,[e("h4",null,oe(a.value?.display_name||a.value?.name)+" é…ç½®",1),e("span",{class:"close-btn",onClick:U},"Ã—")]),e("div",Cg,[(P(!0),A(Ae,null,Je(r.value,(f,c)=>(P(),A("div",{key:c,class:"config-field"},[e("label",{for:"config-"+c},oe(f.label||c)+":",9,kg),f.type==="boolean"?ne((P(),A("input",{key:0,type:"checkbox",id:"config-"+c,"onUpdate:modelValue":k=>h.value[c]=k},null,8,Sg)),[[tt,h.value[c]]]):f.type==="select"?(P(),st(Ne,{key:1,"model-value":String(h.value[c]??""),options:f.options||[],onChange:k=>{h.value[c]=k}},null,8,["model-value","options","onChange"])):f.type==="number"?ne((P(),A("input",{key:2,type:"number",id:"config-"+c,"onUpdate:modelValue":k=>h.value[c]=k,min:f.min,max:f.max},null,8,wg)),[[Se,h.value[c],void 0,{number:!0}]]):ne((P(),A("input",{key:3,type:"text",id:"config-"+c,"onUpdate:modelValue":k=>h.value[c]=k,placeholder:f.placeholder},null,8,$g)),[[Se,h.value[c]]]),f.description?(P(),A("p",Tg,oe(f.description),1)):ge("",!0)]))),128))]),e("div",{class:"plugin-config-footer"},[e("button",{class:"btn btn-secondary",onClick:U},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:w},"ä¿å­˜")])])])):ge("",!0)]))}}),Rg=qe(Ig,[["__scopeId","data-v-a62393a7"]]),Dg={class:"parallel-settings"},Pg={class:"settings-group"},Mg={class:"settings-item"},Eg={class:"toggle-switch"},Bg={class:"number-control"},Ag=["disabled"],Lg=["disabled"],Fg=["disabled"],Ug={key:0,class:"settings-note"},Og=He({__name:"ParallelSettings",setup(s){const t=Ue(),n=K({get:()=>t.settings.parallel.enabled,set:l=>{t.updateSettings({parallel:{...t.settings.parallel,enabled:l}})}}),o=K({get:()=>t.settings.parallel.deepLearningLockSize,set:l=>{t.updateSettings({parallel:{...t.settings.parallel,deepLearningLockSize:Math.max(1,Math.min(4,l))}})}});return(l,i)=>(P(),A("div",Dg,[e("div",Pg,[i[10]||(i[10]=e("div",{class:"settings-group-title"},"ğŸš€ å¹¶è¡Œç¿»è¯‘",-1)),e("div",Mg,[i[5]||(i[5]=e("label",null,"å¯ç”¨å¹¶è¡Œæ¨¡å¼:",-1)),e("label",Eg,[ne(e("input",{type:"checkbox","onUpdate:modelValue":i[0]||(i[0]=a=>n.value=a)},null,512),[[tt,n.value]]),i[4]||(i[4]=e("span",{class:"toggle-slider"},null,-1))]),i[6]||(i[6]=e("div",{class:"input-hint"},"ä½¿ç”¨æµæ°´çº¿å¹¶è¡Œå¤„ç†ï¼Œå¯èƒ½æå‡æ‰¹é‡ç¿»è¯‘é€Ÿåº¦",-1))]),e("div",{class:Te(["settings-item",{"item-disabled":!n.value}])},[i[7]||(i[7]=e("label",null,"æ·±åº¦å­¦ä¹ å¹¶å‘æ•°:",-1)),e("div",Bg,[e("button",{class:"btn btn-sm",onClick:i[1]||(i[1]=a=>o.value=Math.max(1,o.value-1)),disabled:!n.value},"-",8,Ag),ne(e("input",{type:"number","onUpdate:modelValue":i[2]||(i[2]=a=>o.value=a),min:"1",max:"4",disabled:!n.value,class:"number-input"},null,8,Lg),[[Se,o.value,void 0,{number:!0}]]),e("button",{class:"btn btn-sm",onClick:i[3]||(i[3]=a=>o.value=Math.min(4,o.value+1)),disabled:!n.value},"+",8,Fg)]),i[8]||(i[8]=e("div",{class:"input-hint"},"æ§åˆ¶æ£€æµ‹/OCR/é¢œè‰²/ä¿®å¤çš„æœ€å¤§å¹¶å‘æ•°ï¼ˆå»ºè®®1-2ï¼‰",-1))],2),n.value?(P(),A("div",Ug,[...i[9]||(i[9]=[e("div",{class:"note-title"},"âš ï¸ æ³¨æ„äº‹é¡¹ï¼š",-1),e("ul",null,[e("li",null,"å¹¶å‘æ•°è®¾ä¸º1æ—¶ä¸ºä¸²è¡Œæ‰§è¡Œï¼Œæœ€ç¨³å®š"),e("li",null,"å¢å¤§å¹¶å‘æ•°å¯èƒ½åŠ é€Ÿå¤„ç†ï¼Œä½†ä¼šå ç”¨æ›´å¤šGPU/CPUèµ„æº"),e("li",null,"å¦‚æœé‡åˆ°æ˜¾å­˜ä¸è¶³ï¼Œè¯·å°†å¹¶å‘æ•°è®¾ä¸º1")],-1)])])):ge("",!0)])]))}}),zg=qe(Og,[["__scopeId","data-v-4a6e42d5"]]),Ng={class:"more-settings"},Vg={class:"settings-group"},Wg={class:"settings-item"},Kg={class:"settings-group"},qg={class:"settings-item"},Hg=["disabled"],jg={key:0,class:"font-count"},Jg={class:"settings-item"},Gg={class:"settings-group"},Yg={class:"settings-row"},Xg={class:"settings-item"},Zg=["disabled"],Qg={class:"settings-item"},ep=["disabled"],tp=He({__name:"MoreSettings",setup(s){const t=[{label:"å‰ç«¯ pdf.js (æ¨è)",value:"frontend"},{label:"åç«¯ PyMuPDF",value:"backend"}],n=Ue(),o=rt(),l=_(!1),i=_([]),a=_(!1),r=_(null),h=_({pdfProcessingMethod:n.settings.pdfProcessingMethod||"frontend"});Ce(()=>h.value.pdfProcessingMethod,D=>{n.setPdfProcessingMethod(D)});async function T(){l.value=!0;try{const D=await We.getFontList();i.value=D.fonts||[],o.success(`è·å–åˆ° ${i.value.length} ä¸ªå­—ä½“`)}catch(D){const U=D instanceof Error?D.message:"è·å–å­—ä½“åˆ—è¡¨å¤±è´¥";o.error(U)}finally{l.value=!1}}async function S(D){const w=D.target.files?.[0];if(!w)return;const W=[".ttf",".ttc",".otf"],q=w.name.toLowerCase().slice(w.name.lastIndexOf("."));if(!W.includes(q)){o.error("ä¸æ”¯æŒçš„å­—ä½“æ ¼å¼ï¼Œè¯·ä¸Šä¼  .ttf, .ttc æˆ– .otf æ–‡ä»¶");return}try{const O=await We.uploadFont(w);O.success?(o.success(`å­—ä½“ "${O.fontPath||w.name}" ä¸Šä¼ æˆåŠŸ`),await T()):o.error(O.error||"å­—ä½“ä¸Šä¼ å¤±è´¥")}catch(O){const f=O instanceof Error?O.message:"å­—ä½“ä¸Šä¼ å¤±è´¥";o.error(f)}finally{r.value&&(r.value.value="")}}async function M(){a.value=!0;try{const D=await un();D.success?o.success(`å·²æ¸…ç† ${D.deleted_count||0} ä¸ªè°ƒè¯•æ–‡ä»¶`):o.error(D.error||"æ¸…ç†å¤±è´¥")}catch(D){const U=D instanceof Error?D.message:"æ¸…ç†å¤±è´¥";o.error(U)}finally{a.value=!1}}async function L(){a.value=!0;try{const D=await uo();D.success?o.success(`å·²æ¸…ç† ${D.deleted_count||0} ä¸ªä¸´æ—¶æ–‡ä»¶`):o.error(D.error||"æ¸…ç†å¤±è´¥")}catch(D){const U=D instanceof Error?D.message:"æ¸…ç†å¤±è´¥";o.error(U)}finally{a.value=!1}}return(D,U)=>(P(),A("div",Ng,[xe(zg),e("div",Vg,[U[3]||(U[3]=e("div",{class:"settings-group-title"},"PDFå¤„ç†è®¾ç½®",-1)),e("div",Wg,[U[1]||(U[1]=e("label",{for:"settingsPdfProcessingMethod"},"PDFå¤„ç†æ–¹å¼:",-1)),xe(Ne,{modelValue:h.value.pdfProcessingMethod,"onUpdate:modelValue":U[0]||(U[0]=w=>h.value.pdfProcessingMethod=w),options:t},null,8,["modelValue"]),U[2]||(U[2]=e("div",{class:"input-hint"},"å‰ç«¯å¤„ç†é€Ÿåº¦æ›´å¿«ï¼Œåç«¯å¤„ç†å…¼å®¹æ€§æ›´å¥½",-1))])]),e("div",Kg,[U[7]||(U[7]=e("div",{class:"settings-group-title"},"å­—ä½“è®¾ç½®",-1)),e("div",qg,[U[4]||(U[4]=e("label",null,"ç³»ç»Ÿå­—ä½“åˆ—è¡¨:",-1)),e("button",{class:"btn btn-secondary",onClick:T,disabled:l.value},oe(l.value?"åŠ è½½ä¸­...":"ğŸ”„ åˆ·æ–°å­—ä½“åˆ—è¡¨"),9,Hg),i.value.length>0?(P(),A("div",jg,"å…± "+oe(i.value.length)+" ä¸ªå­—ä½“",1)):ge("",!0)]),e("div",Jg,[U[5]||(U[5]=e("label",null,"ä¸Šä¼ è‡ªå®šä¹‰å­—ä½“:",-1)),e("input",{type:"file",accept:".ttf,.ttc,.otf",onChange:S,ref_key:"fontInput",ref:r},null,544),U[6]||(U[6]=e("div",{class:"input-hint"},"æ”¯æŒ .ttf, .ttc, .otf æ ¼å¼",-1))])]),e("div",Gg,[U[10]||(U[10]=e("div",{class:"settings-group-title"},"ç¼“å­˜æ¸…ç†",-1)),e("div",Yg,[e("div",Xg,[e("button",{class:"btn btn-secondary",onClick:M,disabled:a.value},oe(a.value?"æ¸…ç†ä¸­...":"ğŸ—‘ï¸ æ¸…ç†è°ƒè¯•æ–‡ä»¶"),9,Zg),U[8]||(U[8]=e("div",{class:"input-hint"},"æ¸…ç†è°ƒè¯•è¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶",-1))]),e("div",Qg,[e("button",{class:"btn btn-secondary",onClick:L,disabled:a.value},oe(a.value?"æ¸…ç†ä¸­...":"ğŸ—‘ï¸ æ¸…ç†ä¸´æ—¶æ–‡ä»¶"),9,ep),U[9]||(U[9]=e("div",{class:"input-hint"},"æ¸…ç†ä¸‹è½½å’Œå¤„ç†è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶",-1))])])]),U[11]||(U[11]=no('<div class="settings-group" data-v-fc8cf2d0><div class="settings-group-title" data-v-fc8cf2d0>å…³äº</div><div class="about-info" data-v-fc8cf2d0><p data-v-fc8cf2d0><strong data-v-fc8cf2d0>Saber-Translator</strong></p><p data-v-fc8cf2d0>AIé©±åŠ¨çš„æ¼«ç”»ç¿»è¯‘å·¥å…·</p><p class="links" data-v-fc8cf2d0><a href="http://www.mashirosaber.top" target="_blank" data-v-fc8cf2d0>ğŸ“– ä½¿ç”¨æ•™ç¨‹</a><a href="https://github.com/MashiroSaber/saber-translator" target="_blank" data-v-fc8cf2d0>ğŸ™ GitHub</a></p><p class="disclaimer" data-v-fc8cf2d0>æœ¬é¡¹ç›®å®Œå…¨å¼€æºå…è´¹ï¼Œè¯·å‹¿ä¸Šå½“å—éª—</p></div></div>',1))]))}}),op=qe(tp,[["__scopeId","data-v-fc8cf2d0"]]),np={class:"settings-modal-content"},sp={class:"settings-tabs"},ap=["onClick"],lp={class:"settings-tab-content"},ip={class:"settings-tab-pane active"},rp={class:"settings-tab-pane"},up={class:"settings-tab-pane"},cp={class:"settings-tab-pane"},dp={class:"settings-tab-pane"},gp={class:"settings-tab-pane"},pp={class:"settings-tab-pane"},mp={class:"settings-tab-pane"},vp=He({__name:"SettingsModal",props:{modelValue:{type:Boolean},initialTab:{}},emits:["update:modelValue","save"],setup(s,{emit:t}){const n=s,o=t,l=Ue(),i=_(n.modelValue),a=_("ocr"),r=[{id:"ocr",label:"OCRè¯†åˆ«"},{id:"translate",label:"ç¿»è¯‘æœåŠ¡"},{id:"detection",label:"æ£€æµ‹è®¾ç½®"},{id:"hq",label:"é«˜è´¨é‡ç¿»è¯‘"},{id:"proofreading",label:"AIæ ¡å¯¹"},{id:"prompt-library",label:"æç¤ºè¯ç®¡ç†"},{id:"plugins",label:"æ’ä»¶ç®¡ç†"},{id:"more",label:"æ›´å¤š"}];Ce(()=>n.modelValue,M=>{i.value=M,M?(document.body.style.overflow="hidden",n.initialTab&&r.some(L=>L.id===n.initialTab)&&(a.value=n.initialTab)):(document.body.style.overflow="",a.value="ocr")});function h(){i.value=!1,o("update:modelValue",!1),document.body.style.overflow=""}async function T(){l.saveToStorage();try{await l.saveToBackend(),console.log("[SettingsModal] è®¾ç½®å·²ä¿å­˜åˆ°åç«¯")}catch(M){console.warn("[SettingsModal] ä¿å­˜åˆ°åç«¯å¤±è´¥ï¼Œä»…ä¿å­˜åˆ° localStorage:",M)}o("save"),h()}function S(M){M.key==="Escape"&&i.value&&h()}return ut(()=>{document.addEventListener("keydown",S)}),Pt(()=>{document.removeEventListener("keydown",S),document.body.style.overflow=""}),(M,L)=>i.value?(P(),A("div",{key:0,class:"settings-modal",onClick:et(h,["self"])},[e("div",np,[e("div",{class:"settings-modal-header"},[L[0]||(L[0]=e("h3",null,"âš™ï¸ è®¾ç½®",-1)),e("span",{class:"settings-modal-close",onClick:h},"Ã—")]),e("div",sp,[(P(),A(Ae,null,Je(r,D=>e("button",{key:D.id,class:Te(["settings-tab",{active:a.value===D.id}]),onClick:U=>a.value=D.id},oe(D.label),11,ap)),64))]),e("div",lp,[ne(e("div",ip,[xe(Nr)],512),[[Fe,a.value==="ocr"]]),ne(e("div",rp,[xe(Ru)],512),[[Fe,a.value==="translate"]]),ne(e("div",up,[xe(Xu)],512),[[Fe,a.value==="detection"]]),ne(e("div",cp,[xe(Lc)],512),[[Fe,a.value==="hq"]]),ne(e("div",dp,[xe(Ed)],512),[[Fe,a.value==="proofreading"]]),ne(e("div",gp,[xe(eg)],512),[[Fe,a.value==="prompt-library"]]),ne(e("div",pp,[xe(Rg)],512),[[Fe,a.value==="plugins"]]),ne(e("div",mp,[xe(op)],512),[[Fe,a.value==="more"]])]),e("div",{class:"settings-modal-footer"},[e("button",{class:"btn btn-secondary",onClick:h},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:T},"ä¿å­˜è®¾ç½®")])])])):ge("",!0)}}),fp=qe(vp,[["__scopeId","data-v-e1ec20ab"]]),bp={minScale:.1,maxScale:5,zoomSpeed:.1};function tn(s={}){const t={...bp,...s},n=_(1),o=_(0),l=_(0),i=_(!1),a=_(0),r=_(0),h=K(()=>({transform:`translate(${o.value}px, ${l.value}px) scale(${n.value})`}));function T(X,ae,Z){const d=Math.min(Math.max(n.value*Z,t.minScale),t.maxScale),m=d/n.value;o.value=X-(X-o.value)*m,l.value=ae-(ae-l.value)*m,n.value=d,s.onScaleChange?.(n.value),s.onTransformChange?.(C())}function S(X,ae=800,Z=600){T(ae/2,Z/2,X)}function M(){S(1.2)}function L(){S(.8)}function D(X,ae=800,Z=600){const d=X/n.value;T(ae/2,Z/2,d)}function U(X,ae){i.value=!0,a.value=X,r.value=ae}function w(X,ae){if(!i.value)return;const Z=X-a.value,d=ae-r.value;o.value+=Z,l.value+=d,a.value=X,r.value=ae,s.onTransformChange?.(C())}function W(){i.value=!1}function q(X,ae){o.value+=X,l.value+=ae,s.onTransformChange?.(C())}function O(){n.value=1,o.value=0,l.value=0,s.onScaleChange?.(n.value),s.onTransformChange?.(C())}function f(){O()}function c(){n.value=1,o.value=0,l.value=0}function k(X,ae,Z,d){if(!X||!ae)return;const m=Z/X,x=d/ae;n.value=Math.min(m,x)*.95,o.value=(Z-X*n.value)/2,l.value=(d-ae*n.value)/2,s.onScaleChange?.(n.value),s.onTransformChange?.(C())}function C(){return{scale:n.value,translateX:o.value,translateY:l.value}}function N(X){X.scale!==void 0&&(n.value=X.scale),X.translateX!==void 0&&(o.value=X.translateX),X.translateY!==void 0&&(l.value=X.translateY),s.onTransformChange?.(C())}function Y(X){n.value=X.scale,o.value=X.translateX,l.value=X.translateY}function ie(X,ae,Z){if(!X||X.length<4)return;const[d,m,x,b]=X,p=(d+x)/2,g=(m+b)/2,E=ae/2,H=Z/2;o.value=E-p*n.value,l.value=H-g*n.value,s.onTransformChange?.(C())}return{scale:n,translateX:o,translateY:l,isDragging:i,transformStyle:h,zoomAt:T,zoom:S,zoomIn:M,zoomOut:L,setScale:D,startDrag:U,drag:w,endDrag:W,pan:q,reset:O,resetZoom:f,resetTransform:c,fitToScreen:k,getTransform:C,setTransform:N,syncWith:Y,scrollToBubble:ie}}function hp(s){const t=Qe(),n=Ue(),o=_(null),l=_(Xn),i=_(!1),a=_(!1),r=_([]),h=_(0),T=_(0);let S=null,M=null,L=null;const D=K(()=>o.value!==null),U=K(()=>o.value==="repair"?{fill:"rgba(76, 175, 80, 0.4)",border:"#4CAF50"}:o.value==="restore"?{fill:"rgba(33, 150, 243, 0.4)",border:"#2196F3"}:{fill:"transparent",border:"transparent"});function w(g){o.value!==g&&(o.value=g,i.value=!0,r.value=[],console.log(`è¿›å…¥${g==="repair"?"ä¿®å¤":"è¿˜åŸ"}ç¬”åˆ·æ¨¡å¼ï¼Œç¬”åˆ·å¤§å°: ${l.value}px`))}function W(){a.value&&N();const g=o.value!==null;o.value=null,i.value=!1,a.value=!1,r.value=[],ae(),g&&console.log("é€€å‡ºç¬”åˆ·æ¨¡å¼")}function q(g){o.value===g?W():w(g)}function O(g){l.value=Math.max(zo,Math.min(Oo,g))}function f(g){O(l.value+g)}function c(g){if(!D.value)return;g.preventDefault(),g.stopPropagation();const E=g.deltaY>0?-5:5;f(E)}function k(g,E){if(!D.value||g.button!==0)return;g.preventDefault(),g.stopPropagation(),a.value=!0,S=E,r.value=[];const H=Y(g,E);H&&(r.value.push(H),X(E),Z(H)),console.log("å¼€å§‹ç¬”åˆ·æ¶‚æŠ¹")}function C(g){if(h.value=g.clientX,T.value=g.clientY,!a.value||!D.value)return;const E=Y(g,S);E&&(r.value.push(E),Z(E))}function N(){if(!a.value)return;a.value=!1;const g=t.currentImage;if(!g||r.value.length===0){ae(),r.value=[];return}const E=ie();if(!E){ae(),r.value=[];return}const H=o.value;(async()=>{H==="restore"?await d(g,E):H==="repair"&&await m(g,E),s?.onBrushComplete?.()})(),ae(),r.value=[]}function Y(g,E){if(!E)return null;const H=E.querySelector(".image-canvas-wrapper"),I=H?.querySelector("img");if(!I||!I.naturalWidth)return null;const $=H.getBoundingClientRect(),R=window.getComputedStyle(H).transform;let v=1;R&&R!=="none"&&(v=new DOMMatrix(R).a);const B=(g.clientX-$.left)/v,u=(g.clientY-$.top)/v,y=I.naturalWidth,ue=I.naturalHeight;return B<0||u<0||B>y||u>ue?null:{x:B,y:u,scale:v}}function ie(){if(r.value.length===0)return null;const E=r.value[0]?.scale||1,H=l.value/2/E;let I=1/0,$=1/0,R=-1/0,v=-1/0;for(const B of r.value)I=Math.min(I,B.x-H),$=Math.min($,B.y-H),R=Math.max(R,B.x+H),v=Math.max(v,B.y+H);return{x1:Math.max(0,Math.floor(I)),y1:Math.max(0,Math.floor($)),x2:Math.ceil(R),y2:Math.ceil(v),path:[...r.value],radius:H}}function X(g){ae();const E=g.querySelector(".image-canvas-wrapper"),H=E?.querySelector("img");if(!H)return;const I=document.createElement("canvas");I.id="brushOverlayCanvas",I.width=H.naturalWidth,I.height=H.naturalHeight,I.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100;",E.appendChild(I),M=I,L=I.getContext("2d")}function ae(){M&&M.parentNode&&M.parentNode.removeChild(M),M=null,L=null}function Z(g){if(!L||!g)return;const E=U.value.fill,H=l.value/2/(g.scale||1);L.beginPath(),L.arc(g.x,g.y,H,0,Math.PI*2),L.fillStyle=E,L.fill()}async function d(g,E){if(!g.originalDataURL)return;let H;return g.cleanImageData?H="data:image/png;base64,"+g.cleanImageData:H=g.originalDataURL,new Promise(I=>{const $=new Image,R=new Image;let v=0;const B=()=>{if(v++,v<2)return;const u=document.createElement("canvas");u.width=$.naturalWidth,u.height=$.naturalHeight;const y=u.getContext("2d");if(!y){I();return}y.drawImage($,0,0);const ue=document.createElement("canvas");ue.width=u.width,ue.height=u.height;const F=ue.getContext("2d");if(!F){I();return}F.fillStyle="white";for(const le of E.path)F.beginPath(),F.arc(le.x,le.y,E.radius,0,Math.PI*2),F.fill();y.globalCompositeOperation="destination-out",y.drawImage(ue,0,0),y.globalCompositeOperation="destination-over",y.drawImage(R,0,0),y.globalCompositeOperation="source-over";const j=u.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:j}),console.log("è¿˜åŸç¬”åˆ·åŒºåŸŸå®Œæˆ"),I()};$.onload=B,$.onerror=()=>I(),R.onload=B,R.onerror=()=>I(),$.src=H,R.src=g.originalDataURL})}async function m(g,E){const H=s?.getCurrentRepairSettings?.()||{inpaintMethod:"solid",fillColor:"#FFFFFF"},I=H.inpaintMethod;I==="lama_mpe"||I==="litelama"?await x(g,E,I):await b(g,E,H.fillColor)}async function x(g,E,H="lama_mpe"){let I,$;if(g.cleanImageData)I=g.cleanImageData,$="data:image/png;base64,"+g.cleanImageData;else if(g.originalDataURL)I=g.originalDataURL.split(",")[1],$=g.originalDataURL;else{console.error("æ— æ³•è·å–åŸºç¡€å›¾åƒç”¨äº LAMA ä¿®å¤");return}return new Promise(R=>{const v=new Image;v.onload=async()=>{const B=v.naturalWidth,u=v.naturalHeight,y=document.createElement("canvas");y.width=B,y.height=u;const ue=y.getContext("2d");if(!ue){console.error("æ— æ³•åˆ›å»ºæ©è†œç”»å¸ƒä¸Šä¸‹æ–‡"),R();return}ue.fillStyle="black",ue.fillRect(0,0,B,u),ue.fillStyle="white";for(const $e of E.path)ue.beginPath(),ue.arc($e.x,$e.y,E.radius,0,Math.PI*2),ue.fill();const j=y.toDataURL("image/png").split(",")[1],le=[E.x1,E.y1,E.x2,E.y2],_e=H==="litelama"?"litelama":"lama_mpe";try{be("LAMA ä¿®å¤ä¸­...","info");const $e=await go(I,le,{method:"lama",lamaModel:_e,maskData:j});if($e.success&&$e.inpainted_image)t.updateCurrentImage({cleanImageData:$e.inpainted_image}),console.log("ä¿®å¤ç¬”åˆ·åŒºåŸŸå®Œæˆï¼ˆLAMA ä¿®å¤ï¼Œç²¾ç¡®æ©è†œï¼‰"),be("LAMA ä¿®å¤å®Œæˆ","success");else throw new Error($e.error||"LAMA ä¿®å¤è¿”å›æ— æ•ˆæ•°æ®")}catch($e){console.error("LAMA ä¿®å¤å¤±è´¥ï¼Œå›é€€åˆ°çº¯è‰²å¡«å……:",$e),be("LAMA ä¿®å¤å¤±è´¥ï¼Œä½¿ç”¨çº¯è‰²å¡«å……","warning");const Ee=s?.getCurrentRepairSettings?.();await b(g,E,Ee?.fillColor)}R()},v.onerror=()=>{console.error("åŠ è½½å›¾åƒå¤±è´¥ï¼Œæ— æ³•è¿›è¡Œ LAMA ä¿®å¤"),R()},v.src=$})}async function b(g,E,H){const I=H||n.settings.textStyle.fillColor||"#FFFFFF";let $;if(g.cleanImageData)$="data:image/png;base64,"+g.cleanImageData;else if(g.originalDataURL)$=g.originalDataURL;else return;return new Promise(R=>{const v=new Image;v.onload=()=>{const B=document.createElement("canvas");B.width=v.naturalWidth,B.height=v.naturalHeight;const u=B.getContext("2d");if(!u){R();return}u.drawImage(v,0,0),u.fillStyle=I;for(const ue of E.path)u.beginPath(),u.arc(ue.x,ue.y,E.radius,0,Math.PI*2),u.fill();const y=B.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:y}),console.log("ä¿®å¤ç¬”åˆ·åŒºåŸŸå®Œæˆï¼ˆçº¯è‰²å¡«å……ï¼‰"),R()},v.onerror=()=>R(),v.src=$})}async function p(){const g=t.currentImage;if(!g)return console.warn("ensureCleanBackground: æ²¡æœ‰å½“å‰å›¾ç‰‡"),!1;if(g.cleanImageData)return console.log("ensureCleanBackground: å·²æœ‰å¹²å‡€èƒŒæ™¯"),!0;const E=s?.getCurrentRepairSettings?.();if((E?.inpaintMethod||n.settings.textStyle.inpaintMethod)!=="solid")return console.log("ensureCleanBackground: éçº¯è‰²å¡«å……æ¨¡å¼ï¼Œè·³è¿‡"),!1;if(!g.bubbleStates||g.bubbleStates.length===0)return console.warn("ensureCleanBackground: æ²¡æœ‰æ°”æ³¡æ•°æ®"),!1;if(!g.translatedDataURL&&!g.originalDataURL)return console.warn("ensureCleanBackground: æ²¡æœ‰å›¾ç‰‡æ•°æ®"),!1;console.log("ensureCleanBackground: å°è¯•ä¸ºçº¯è‰²å¡«å……æ¨¡å¼åˆ›å»ºä¸´æ—¶å¹²å‡€èƒŒæ™¯");const I=g.translatedDataURL||g.originalDataURL,$=E?.fillColor||n.settings.textStyle.fillColor||"#FFFFFF";return new Promise(R=>{const v=new Image;v.onload=()=>{try{const B=document.createElement("canvas");B.width=v.naturalWidth,B.height=v.naturalHeight;const u=B.getContext("2d");if(!u){console.error("ensureCleanBackground: æ— æ³•è·å– Canvas ä¸Šä¸‹æ–‡"),R(!1);return}u.drawImage(v,0,0),u.fillStyle=$;for(const ue of g.bubbleStates){const[F,j,le,_e]=ue.coords;u.fillRect(F,j,le-F+1,_e-j+1)}const y=B.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:y}),console.log("ensureCleanBackground: æˆåŠŸåˆ›å»ºä¸´æ—¶å¹²å‡€èƒŒæ™¯ï¼ˆçº¯è‰²å¡«å……ï¼‰"),R(!0)}catch(B){console.error("ensureCleanBackground: Canvas æ“ä½œå¤±è´¥:",B),R(!1)}},v.onerror=()=>{console.error("ensureCleanBackground: åŠ è½½å›¾åƒå¤±è´¥"),R(!1)},v.src=I})}return Pt(()=>{W()}),{brushMode:o,brushSize:l,isBrushKeyDown:i,isBrushPainting:a,mouseX:h,mouseY:T,isActive:D,brushColor:U,BRUSH_MIN_SIZE:zo,BRUSH_MAX_SIZE:Oo,enterBrushMode:w,exitBrushMode:W,toggleBrushMode:q,setBrushSize:O,adjustBrushSize:f,handleBrushWheel:c,startBrushPainting:k,continueBrushPainting:C,finishBrushPainting:N,getBrushPositionInImage:Y,getBrushPathBounds:ie,ensureCleanBackground:p}}function yp(s){return[Math.round(s[0]),Math.round(s[1]),Math.round(s[2]),Math.round(s[3])]}function xp(s){const t=ct(),n=Qe(),o=Ue(),{bubbles:l,selectedIndex:i,hasSelection:a}=xt(t),{currentImage:r}=xt(n),h=_(!1),T=_(!1),S=_(null),M=_(0),L=_(0),D=_(!1);function U(u){t.selectBubble(u)}function w(u){t.toggleMultiSelect(u)}function W(){t.clearMultiSelect()}function q(u,y){console.log(`å¼€å§‹æ‹–åŠ¨æ°”æ³¡ #${u+1}`)}function O(u,y){}function f(u,y){t.updateBubble(u,{coords:y}),console.log(`æ°”æ³¡ #${u+1} æ‹–åŠ¨å®Œæˆ:`,y),H()}function c(u,y,ue){console.log(`å¼€å§‹è°ƒæ•´æ°”æ³¡ #${u+1} å¤§å°ï¼Œæ‰‹æŸ„: ${y}`)}function k(u){}function C(u,y){t.updateBubble(u,{coords:y}),console.log(`æ°”æ³¡ #${u+1} è°ƒæ•´å¤§å°å®Œæˆ:`,y),H()}function N(u,y){console.log(`å¼€å§‹æ—‹è½¬æ°”æ³¡ #${u+1}`)}function Y(u){}function ie(u,y){t.updateBubble(u,{rotationAngle:y}),console.log(`æ°”æ³¡ #${u+1} æ—‹è½¬å®Œæˆ: ${y}Â°`),H()}function X(){h.value=!h.value,h.value?console.log("è¿›å…¥ç»˜åˆ¶æ¨¡å¼"):console.log("é€€å‡ºç»˜åˆ¶æ¨¡å¼")}function ae(u){t.addBubble(u),t.selectBubble(t.bubbleCount-1),console.log("å·²æ·»åŠ æ–°æ°”æ³¡:",u),s?.onReRender?.()}function Z(u,y){T.value=!0,M.value=u,L.value=y,S.value=[u,y,u,y]}function d(u,y){T.value&&(S.value=[M.value,L.value,u,y])}function m(){if(!T.value||!S.value)return T.value=!1,S.value=null,null;const[u,y,ue,F]=S.value,j=10;if(Math.abs(ue-u)<j||Math.abs(F-y)<j)return T.value=!1,S.value=null,null;const le=[Math.min(u,ue),Math.min(y,F),Math.max(u,ue),Math.max(y,F)];return T.value=!1,S.value=null,le}function x(){T.value=!1,S.value=null,h.value=!1}function b(){if(!S.value)return{};const[u,y,ue,F]=S.value;return{position:"absolute",left:`${Math.min(u,ue)}px`,top:`${Math.min(y,F)}px`,width:`${Math.abs(ue-u)}px`,height:`${Math.abs(F-y)}px`,border:"2px dashed #00d4ff",background:"rgba(0, 212, 255, 0.1)",pointerEvents:"none",zIndex:"25",boxSizing:"border-box"}}let p=null,g=!1;const E=150;function H(){p&&clearTimeout(p),p=setTimeout(async()=>{if(g){console.log("è·³è¿‡æ¸²æŸ“ï¼Œä¸Šä¸€æ¬¡æ¸²æŸ“ä»åœ¨è¿›è¡Œä¸­");return}console.log("è§¦å‘å»¶è¿Ÿæ¸²æŸ“é¢„è§ˆ"),g=!0;try{s?.onDelayedPreview?await s.onDelayedPreview():s?.onReRender&&await s.onReRender()}catch(u){console.error("å»¶è¿Ÿæ¸²æŸ“é¢„è§ˆå¤±è´¥:",u)}finally{g=!1}},E)}function I(u){t.updateSelectedBubble(u),H()}function $(){a.value&&(t.deleteSelected(),console.log("å·²åˆ é™¤é€‰ä¸­çš„æ°”æ³¡"),s?.onReRender?.())}async function R(){const u=i.value;if(u<0){console.warn("è¯·å…ˆé€‰ä¸­è¦ä¿®å¤çš„æ°”æ³¡æ¡†");return}const y=l.value[u],ue=r.value;if(!y||!ue?.originalDataURL){console.warn("æ— æ³•ä¿®å¤èƒŒæ™¯ï¼šç¼ºå°‘æ°”æ³¡æˆ–å›¾ç‰‡æ•°æ®");return}const F=y.inpaintMethod||"solid",j=y.fillColor||"#FFFFFF",le=y.rotationAngle||0;try{console.log(`å¼€å§‹ä¿®å¤æ°”æ³¡ #${u+1} èƒŒæ™¯ï¼Œæ–¹æ³•: ${F}`);let _e;if(ue.cleanImageData)_e=ue.cleanImageData;else{const Ee=ue.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/);if(_e=Ee&&Ee[1]?Ee[1]:"",!_e){console.error("æ— æ³•è§£æå›¾åƒæ•°æ®");return}}if(F==="lama_mpe"||F==="litelama"){const Ee=F==="litelama"?"litelama":"lama_mpe",Me=yp(y.coords),se=await go(_e,Me,{bubbleAngle:le,method:"lama",lamaModel:Ee});se.success&&se.inpainted_image?(n.updateCurrentImage({cleanImageData:se.inpainted_image}),console.log(`æ°”æ³¡ #${u+1} LAMAèƒŒæ™¯ä¿®å¤æˆåŠŸ`),H()):(console.error("LAMAä¿®å¤å¤±è´¥:",se.error||"æœªçŸ¥é”™è¯¯"),await v(y.coords,j,le),H())}else await v(y.coords,j,le),console.log(`æ°”æ³¡ #${u+1} çº¯è‰²å¡«å……ä¿®å¤æˆåŠŸ`),H()}catch(_e){console.error("èƒŒæ™¯ä¿®å¤å‡ºé”™:",_e)}}async function v(u,y,ue=0){const F=r.value;if(!F)return;const[j,le,_e,$e]=u;let Ee;if(F.cleanImageData)Ee="data:image/png;base64,"+F.cleanImageData;else if(F.originalDataURL)Ee=F.originalDataURL;else{console.error("æ— æ³•æ‰¾åˆ°åŸºç¡€å›¾åƒç”¨äºå¡«å……");return}return new Promise(Me=>{const se=new Image;se.onload=()=>{const J=document.createElement("canvas");J.width=se.naturalWidth,J.height=se.naturalHeight;const z=J.getContext("2d");if(!z){Me();return}if(z.drawImage(se,0,0),z.fillStyle=y,Math.abs(ue)<.1)z.fillRect(j,le,_e-j,$e-le);else{const ee=(j+_e)/2,ce=(le+$e)/2,me=(_e-j)/2,ye=($e-le)/2,he=ue*Math.PI/180,ve=Math.cos(he),Ie=Math.sin(he),we=[[-me,-ye],[me,-ye],[me,ye],[-me,ye]].map(([Oe,De])=>[ee+Oe*ve-De*Ie,ce+Oe*Ie+De*ve]);z.beginPath();const Ve=we[0];if(Ve){z.moveTo(Ve[0],Ve[1]);for(let Oe=1;Oe<we.length;Oe++){const De=we[Oe];De&&z.lineTo(De[0],De[1])}}z.closePath(),z.fill()}const te=J.toDataURL("image/png").split(",")[1];n.updateCurrentImage({cleanImageData:te}),console.log("å·²å¯¹æ°”æ³¡åŒºåŸŸè¿›è¡Œçº¯è‰²å¡«å……:",u,y,"è§’åº¦:",ue),Me()},se.onerror=()=>{console.error("åŠ è½½åŸºç¡€å›¾åƒå¤±è´¥"),Me()},se.src=Ee})}async function B(u){const y=l.value[u],ue=r.value;if(!y||!ue?.originalDataURL){console.warn("æ— æ³•è¿›è¡Œ OCR è¯†åˆ«ï¼šç¼ºå°‘æ°”æ³¡æˆ–å›¾ç‰‡æ•°æ®");return}try{console.log(`å¼€å§‹ OCR è¯†åˆ«æ°”æ³¡ #${u+1}`);const F=ue.originalDataURL.split(",")[1]||"",j=o.settings,le=await gn(F,y.coords,j.ocrEngine||"manga_ocr",{source_language:j.sourceLanguage,baidu_ocr_api_key:j.baiduOcr.apiKey,baidu_ocr_secret_key:j.baiduOcr.secretKey,baidu_version:j.baiduOcr.version,baidu_source_language:j.baiduOcr.sourceLanguage,ai_vision_provider:j.aiVisionOcr.provider,ai_vision_api_key:j.aiVisionOcr.apiKey,ai_vision_model_name:j.aiVisionOcr.modelName,ai_vision_ocr_prompt:j.aiVisionOcr.prompt,custom_ai_vision_base_url:j.aiVisionOcr.customBaseUrl});le.success&&le.text!==void 0?(t.updateBubble(u,{originalText:le.text}),console.log(`OCR è¯†åˆ«æˆåŠŸ: "${le.text}"`)):console.error("OCR è¯†åˆ«å¤±è´¥:",le.error||"æœªçŸ¥é”™è¯¯")}catch(F){console.error("OCR è¯†åˆ«å‡ºé”™:",F)}}return{isDrawingMode:h,isDrawingBox:T,currentDrawingRect:S,isMiddleButtonDown:D,handleBubbleSelect:U,handleBubbleMultiSelect:w,handleClearMultiSelect:W,handleBubbleDragStart:q,handleBubbleDragging:O,handleBubbleDragEnd:f,handleBubbleResizeStart:c,handleBubbleResizing:k,handleBubbleResizeEnd:C,handleBubbleRotateStart:N,handleBubbleRotating:Y,handleBubbleRotateEnd:ie,toggleDrawingMode:X,handleDrawBubble:ae,startDrawingBox:Z,updateDrawingBox:d,finishDrawingBox:m,cancelDrawing:x,getDrawingRectStyle:b,handleBubbleUpdate:I,deleteSelectedBubbles:$,repairSelectedBubble:R,triggerDelayedPreview:H,handleOcrRecognize:B}}function _p(s){const t=ct(),n=Qe(),{bubbles:o}=xt(t),{currentImage:l}=xt(n),i=_(!1),a=_("");let r=null;function h(){const M=l.value;if(!M)return null;if(M.cleanImageData)return M.cleanImageData;if(M.originalDataURL){const L=M.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/);if(L&&L[1])return L[1]}return null}async function T(M=!1){if(!l.value)return console.warn("reRenderFullImage: æ²¡æœ‰å½“å‰å›¾ç‰‡"),!1;if(o.value.length===0){console.log("reRenderFullImage: æ²¡æœ‰æ°”æ³¡ï¼Œè·³è¿‡åç«¯æ¸²æŸ“");const w=h();if(w){const W=`data:image/png;base64,${w}`;n.updateCurrentImage({translatedDataURL:W}),M||s?.onRenderSuccess?.(W)}return!0}const D=h();if(!D)return console.error("reRenderFullImage: ç¼ºå°‘å›¾åƒæ•°æ®"),a.value="ç¼ºå°‘å›¾åƒæ•°æ®",M||s?.onRenderError?.("ç¼ºå°‘å›¾åƒæ•°æ®"),!1;const U=Symbol("render");r=U,i.value=!0,a.value="",M||s?.onRenderStart?.();try{console.log("reRenderFullImage: å¼€å§‹é‡æ–°æ¸²æŸ“ï¼Œæ°”æ³¡æ•°é‡:",o.value.length);const w=o.value,W=w.map(c=>c.translatedText||""),q=w.map(c=>c.coords.map(k=>Math.round(k))),O=w.map(c=>({translatedText:c.translatedText||"",coords:c.coords,fontSize:Number(c.fontSize)||24,fontFamily:c.fontFamily||"fonts/STSONG.TTF",textDirection:kt(c),textColor:c.textColor||"#231816",rotationAngle:Math.round(Number(c.rotationAngle)||0),position:c.position?{x:Math.round(c.position.x||0),y:Math.round(c.position.y||0)}:{x:0,y:0},strokeEnabled:c.strokeEnabled!==void 0?c.strokeEnabled:!0,strokeColor:c.strokeColor||"#FFFFFF",strokeWidth:Number(c.strokeWidth)||3})),f=await co({clean_image:D,bubble_texts:W,bubble_coords:q,bubble_states:O,fontSize:Number(w[0]?.fontSize)||24,fontFamily:w[0]?.fontFamily||"fonts/STSONG.TTF",textDirection:w[0]?kt(w[0]):"vertical",textColor:w[0]?.textColor||"#231816",strokeEnabled:w[0]?.strokeEnabled!==void 0?w[0].strokeEnabled:!0,strokeColor:w[0]?.strokeColor||"#FFFFFF",strokeWidth:Number(w[0]?.strokeWidth)||3,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,is_font_style_change:!0});if(r!==U)return console.log("reRenderFullImage: æ¸²æŸ“ç»“æœå·²è¿‡æœŸï¼Œå¿½ç•¥"),!1;if(f.rendered_image){const c=`data:image/png;base64,${f.rendered_image}`;return n.updateCurrentImage({translatedDataURL:c}),console.log("reRenderFullImage: æ¸²æŸ“æˆåŠŸ"),M||s?.onRenderSuccess?.(c),!0}else{const c=f.error||"æ¸²æŸ“å¤±è´¥";return console.error("reRenderFullImage: æ¸²æŸ“å¤±è´¥ -",c),a.value=c,M||s?.onRenderError?.(c),!1}}catch(w){if(r!==U)return!1;const W=w instanceof Error?w.message:"æ¸²æŸ“è¯·æ±‚å¤±è´¥";return console.error("reRenderFullImage: æ¸²æŸ“å‡ºé”™ -",w),a.value=W,M||s?.onRenderError?.(W),!1}finally{r===U&&(i.value=!1,M||s?.onRenderEnd?.())}}function S(){r=null,i.value=!1}return{isRendering:i,renderError:a,reRenderFullImage:T,cancelRender:S}}const Cp=["data-index","data-coords","data-rotation","onClick","onMousedown"],kp={class:"bubble-index"},Sp=["data-parent-index","onMousedown"],wp=["data-parent-index","onMousedown"],$p=["data-parent-index","onMousedown"],Tp=["data-parent-index","onMousedown"],Ip=["data-parent-index","onMousedown"],Rp=["data-parent-index","onMousedown"],Dp=["data-parent-index","onMousedown"],Pp=["data-parent-index","onMousedown"],Mp=["data-parent-index","onMousedown"],Ep=He({__name:"BubbleOverlay",props:{bubbles:{},selectedIndex:{},selectedIndices:{},scale:{},isDrawingMode:{type:Boolean},isBrushMode:{type:Boolean},imageWidth:{},imageHeight:{}},emits:["select","multiSelect","dragStart","dragging","dragEnd","resizeStart","resizing","resizeEnd","rotateStart","rotating","rotateEnd","drawBubble"],setup(s,{emit:t}){const n=ct(),{isDragging:o,draggingIndex:l,dragOffsetX:i,dragOffsetY:a,dragInitialX:r,dragInitialY:h,isResizing:T,resizingIndex:S,resizeCurrentCoords:M,isRotating:L,rotatingIndex:D,rotateCurrentAngle:U}=xt(n),w=s,W=t,q=_(null),O=_(0),f=_(0),c=_(""),k=_(0),C=_(0),N=_(null),Y=_(0),ie=_(0),X=_(0),ae=_(0),Z=_(!1),d=_(0),m=_(0),x=_(null),b=_(!1);function p(J,z){let te,ee,ce,me,ye=J.rotationAngle||0;if(o.value&&l.value===z){const[we,Ve,Oe,De]=J.coords;te=r.value+i.value,ee=h.value+a.value,ce=te+(Oe-we),me=ee+(De-Ve)}else T.value&&S.value===z&&M.value?[te,ee,ce,me]=M.value:L.value&&D.value===z?([te,ee,ce,me]=J.coords,ye=U.value):[te,ee,ce,me]=J.coords;const he=ce-te,ve=me-ee,Ie={left:`${te}px`,top:`${ee}px`,width:`${he}px`,height:`${ve}px`};return ye&&(Ie.transformOrigin="center center",Ie.transform=`rotate(${ye}deg)`),Ie}function g(){if(!x.value)return{};const[J,z,te,ee]=x.value;return{left:`${Math.min(J,te)}px`,top:`${Math.min(z,ee)}px`,width:`${Math.abs(te-J)}px`,height:`${Math.abs(ee-z)}px`}}function E(J){if(!q.value)return null;const z=q.value.getBoundingClientRect(),te=w.scale||1,ee=(J.clientX-z.left)/te,ce=(J.clientY-z.top)/te;return{x:ee,y:ce}}function H(J,z){w.isBrushMode||z.shiftKey||W("select",J)}function I(J){if(!w.isBrushMode){if(J.button===1){J.preventDefault(),b.value=!0,document.body.classList.add("middle-button-drawing"),_e(J);return}J.button===0&&w.isDrawingMode&&_e(J)}}function $(J,z){if(!w.isBrushMode&&z.button===0){if(z.preventDefault(),z.stopPropagation(),z.shiftKey){W("multiSelect",J);return}if(J!==w.selectedIndex){W("select",J);return}R(J,z)}}function R(J,z){document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",se),o.value=!0,l.value=J,O.value=z.clientX,f.value=z.clientY,i.value=0,a.value=0;const te=w.bubbles[J];te&&(r.value=te.coords[0],h.value=te.coords[1]),W("dragStart",J,z),document.addEventListener("mousemove",Me),document.addEventListener("mouseup",se)}function v(J){const z=w.scale||1,te=(J.clientX-O.value)/z,ee=(J.clientY-f.value)/z;i.value=te,a.value=ee}function B(J){const z=l.value;o.value=!1,l.value=-1,i.value=0,a.value=0;const te=w.scale||1,ee=(J.clientX-O.value)/te,ce=(J.clientY-f.value)/te,me=w.bubbles[z];if(!me)return;const[ye,he,ve,Ie]=me.coords,we=ve-ye,Ve=Ie-he;let Oe=Math.round(r.value+ee),De=Math.round(h.value+ce);const Re=w.imageWidth||2e3,Ge=w.imageHeight||2e3,at=Math.min(we,Re),it=Math.min(Ve,Ge);Oe=Math.max(0,Math.min(Oe,Re-at)),De=Math.max(0,Math.min(De,Ge-it));const ke=[Oe,De,Oe+at,De+it];W("dragEnd",z,ke)}function u(J,z,te){if(w.isBrushMode||te.button!==0)return;te.preventDefault(),te.stopPropagation(),document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",se),T.value=!0,S.value=z,c.value=J,k.value=te.clientX,C.value=te.clientY;const ee=w.bubbles[z];ee&&(N.value=[...ee.coords],M.value=[...ee.coords]),W("resizeStart",z,J,te),document.addEventListener("mousemove",Me),document.addEventListener("mouseup",se)}function y(J){if(!N.value)return;const z=w.scale||1,te=(J.clientX-k.value)/z,ee=(J.clientY-C.value)/z;let[ce,me,ye,he]=N.value;const ve=c.value;ve.includes("w")&&(ce+=te),ve.includes("e")&&(ye+=te),ve.includes("n")&&(me+=ee),ve.includes("s")&&(he+=ee),ce>ye&&([ce,ye]=[ye,ce]),me>he&&([me,he]=[he,me]);const Ie=10;ye-ce<Ie||he-me<Ie||(M.value=[ce,me,ye,he])}function ue(J){if(!N.value)return;const z=w.scale||1,te=(J.clientX-k.value)/z,ee=(J.clientY-C.value)/z;let[ce,me,ye,he]=N.value;const ve=c.value;ve.includes("w")&&(ce+=te),ve.includes("e")&&(ye+=te),ve.includes("n")&&(me+=ee),ve.includes("s")&&(he+=ee),ce>ye&&([ce,ye]=[ye,ce]),me>he&&([me,he]=[he,me]);const Ie=w.imageWidth||2e3,we=w.imageHeight||2e3;ce=Math.max(0,Math.round(ce)),me=Math.max(0,Math.round(me)),ye=Math.min(Ie,Math.round(ye)),he=Math.min(we,Math.round(he));const Ve=10;if(ye-ce<Ve||he-me<Ve){console.warn("è°ƒæ•´åå°ºå¯¸è¿‡å°ï¼Œå·²æ’¤é”€"),T.value=!1,S.value=-1,N.value=null;return}W("resizeEnd",S.value,[ce,me,ye,he]),T.value=!1,S.value=-1,N.value=null,M.value=null}function F(J,z){if(w.isBrushMode||z.button!==0)return;z.preventDefault(),z.stopPropagation(),document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",se),L.value=!0,D.value=J;const te=w.bubbles[J];if(!te||!q.value)return;const[ee,ce,me,ye]=te.coords,he=w.scale||1,ve=q.value.getBoundingClientRect();X.value=ve.left+(ee+me)/2*he,ae.value=ve.top+(ce+ye)/2*he;const Ie=z.clientX-X.value,we=z.clientY-ae.value;Y.value=Math.atan2(we,Ie)*180/Math.PI,ie.value=te.rotationAngle||0,U.value=te.rotationAngle||0,W("rotateStart",J,z),document.body.classList.add("rotating-box"),document.addEventListener("mousemove",Me),document.addEventListener("mouseup",se),console.log(`å¼€å§‹æ—‹è½¬æ°”æ³¡ #${J+1}ï¼Œåˆå§‹è§’åº¦: ${ie.value}Â°`)}function j(J){const z=J.clientX-X.value,te=J.clientY-ae.value,ce=Math.atan2(te,z)*180/Math.PI-Y.value;let me=ie.value+ce;for(;me>180;)me-=360;for(;me<-180;)me+=360;J.shiftKey&&(me=Math.round(me/15)*15),U.value=me}function le(J){document.body.classList.remove("rotating-box");const z=D.value,te=U.value;W("rotateEnd",z,te),L.value=!1,D.value=-1,console.log(`æ°”æ³¡ #${z+1} æ—‹è½¬å®Œæˆï¼Œè§’åº¦: ${te}Â°`)}function _e(J){const z=E(J);if(!z)return;const te=w.imageWidth||2e3,ee=w.imageHeight||2e3;z.x<0||z.x>te||z.y<0||z.y>ee||(Z.value=!0,d.value=z.x,m.value=z.y,x.value=[z.x,z.y,z.x,z.y],document.addEventListener("mousemove",Me),document.addEventListener("mouseup",se),console.log("å¼€å§‹ç»˜åˆ¶æ–°æ¡†:",z.x.toFixed(1),z.y.toFixed(1)))}function $e(J){const z=E(J);!z||!x.value||(x.value=[d.value,m.value,z.x,z.y])}function Ee(J){const z=E(J);if(b.value&&(b.value=!1,document.body.classList.remove("middle-button-drawing")),!z||!x.value){Z.value=!1,x.value=null;return}const te=w.imageWidth||2e3,ee=w.imageHeight||2e3,ce=Math.max(0,Math.round(Math.min(d.value,z.x))),me=Math.max(0,Math.round(Math.min(m.value,z.y))),ye=Math.min(te,Math.round(Math.max(d.value,z.x))),he=Math.min(ee,Math.round(Math.max(m.value,z.y))),ve=10;if(ye-ce<ve||he-me<ve){console.log("ç»˜åˆ¶çš„æ¡†å¤ªå°ï¼Œå·²å¿½ç•¥"),Z.value=!1,x.value=null;return}console.log("å®Œæˆç»˜åˆ¶æ–°æ¡†:",[ce,me,ye,he]),W("drawBubble",[ce,me,ye,he]),Z.value=!1,x.value=null}function Me(J){o.value?v(J):T.value?y(J):L.value?j(J):Z.value&&$e(J)}function se(J){document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",se),(J.button===1||b.value)&&(b.value=!1,document.body.classList.remove("middle-button-drawing")),o.value?B(J):T.value?ue(J):L.value?le():Z.value&&Ee(J)}return ut(()=>{}),Pt(()=>{document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",se),document.body.classList.remove("middle-button-drawing"),document.body.classList.remove("rotating-box")}),(J,z)=>(P(),A("div",{class:Te(["bubble-overlay",{"brush-mode":s.isBrushMode}]),ref_key:"overlayRef",ref:q,onMousedown:I},[(P(!0),A(Ae,null,Je(s.bubbles,(te,ee)=>(P(),A("div",{key:ee,class:Te(["bubble-highlight-box",{selected:ee===s.selectedIndex,"multi-selected":s.selectedIndices.length>1&&s.selectedIndices.includes(ee)&&ee!==s.selectedIndex}]),style:ot(p(te,ee)),"data-index":ee,"data-coords":JSON.stringify(te.coords),"data-rotation":te.rotationAngle||0,onClick:et(ce=>H(ee,ce),["stop"]),onMousedown:et(ce=>$(ee,ce),["stop"])},[e("span",kp,oe(ee+1),1),ee===s.selectedIndex?(P(),A(Ae,{key:0},[e("div",{class:"resize-handle nw","data-handle":"nw","data-parent-index":ee,onMousedown:et(ce=>u("nw",ee,ce),["stop"])},null,40,Sp),e("div",{class:"resize-handle n","data-handle":"n","data-parent-index":ee,onMousedown:et(ce=>u("n",ee,ce),["stop"])},null,40,wp),e("div",{class:"resize-handle ne","data-handle":"ne","data-parent-index":ee,onMousedown:et(ce=>u("ne",ee,ce),["stop"])},null,40,$p),e("div",{class:"resize-handle e","data-handle":"e","data-parent-index":ee,onMousedown:et(ce=>u("e",ee,ce),["stop"])},null,40,Tp),e("div",{class:"resize-handle se","data-handle":"se","data-parent-index":ee,onMousedown:et(ce=>u("se",ee,ce),["stop"])},null,40,Ip),e("div",{class:"resize-handle s","data-handle":"s","data-parent-index":ee,onMousedown:et(ce=>u("s",ee,ce),["stop"])},null,40,Rp),e("div",{class:"resize-handle sw","data-handle":"sw","data-parent-index":ee,onMousedown:et(ce=>u("sw",ee,ce),["stop"])},null,40,Dp),e("div",{class:"resize-handle w","data-handle":"w","data-parent-index":ee,onMousedown:et(ce=>u("w",ee,ce),["stop"])},null,40,Pp),z[0]||(z[0]=e("div",{class:"rotate-line"},null,-1)),e("div",{class:"rotate-handle",title:"æ‹–æ‹½æ—‹è½¬","data-parent-index":ee,onMousedown:et(ce=>F(ee,ce),["stop"])},null,40,Mp)],64)):ge("",!0)],46,Cp))),128)),x.value?(P(),A("div",{key:0,class:"drawing-rect",style:ot(g())},null,4)):ge("",!0)],34))}}),on=qe(Ep,[["__scopeId","data-v-a3e510ac"]]),Bp={key:0,class:"kana-keyboard"},Ap={class:"kana-keyboard-header"},Lp={class:"kana-keyboard-tabs"},Fp=["onClick"],Up={class:"kana-keyboard-options"},Op={class:"kana-mode-select"},zp={class:"kana-target-select"},Np={class:"kana-table"},Vp={class:"row-label"},Wp=["onClick"],Kp={class:"kana-hiragana"},qp={class:"kana-katakana"},Hp={class:"kana-table"},jp={class:"row-label"},Jp=["onClick"],Gp={class:"kana-hiragana"},Yp={class:"kana-katakana"},Xp={class:"kana-table combo-table"},Zp={class:"row-label"},Qp=["onClick"],em={class:"kana-hiragana"},tm={class:"kana-katakana"},om={class:"special-chars-grid"},nm=["onClick"],sm={key:0,class:"char-label"},am=He({__name:"JapaneseKeyboard",props:{visible:{type:Boolean,default:!1},defaultTarget:{default:"original"}},emits:["close","insert","delete"],setup(s,{emit:t}){const n=s,o=t,l=_("basic"),i=_("hiragana"),a=_(n.defaultTarget),r=_(null),h=[{label:"åŸæ–‡",value:"original"},{label:"è¯‘æ–‡",value:"translated"}],T=[{id:"basic",label:"åŸºæœ¬"},{id:"dakuten",label:"æµŠ/åŠæµŠéŸ³"},{id:"combo",label:"æ‹—éŸ³"},{id:"special",label:"ç‰¹æ®Š"}],S=[{label:"ã‚è¡Œ",chars:[{h:"ã‚",k:"ã‚¢"},{h:"ã„",k:"ã‚¤"},{h:"ã†",k:"ã‚¦"},{h:"ãˆ",k:"ã‚¨"},{h:"ãŠ",k:"ã‚ª"}]},{label:"ã‹è¡Œ",chars:[{h:"ã‹",k:"ã‚«"},{h:"ã",k:"ã‚­"},{h:"ã",k:"ã‚¯"},{h:"ã‘",k:"ã‚±"},{h:"ã“",k:"ã‚³"}]},{label:"ã•è¡Œ",chars:[{h:"ã•",k:"ã‚µ"},{h:"ã—",k:"ã‚·"},{h:"ã™",k:"ã‚¹"},{h:"ã›",k:"ã‚»"},{h:"ã",k:"ã‚½"}]},{label:"ãŸè¡Œ",chars:[{h:"ãŸ",k:"ã‚¿"},{h:"ã¡",k:"ãƒ"},{h:"ã¤",k:"ãƒ„"},{h:"ã¦",k:"ãƒ†"},{h:"ã¨",k:"ãƒˆ"}]},{label:"ãªè¡Œ",chars:[{h:"ãª",k:"ãƒŠ"},{h:"ã«",k:"ãƒ‹"},{h:"ã¬",k:"ãƒŒ"},{h:"ã­",k:"ãƒ"},{h:"ã®",k:"ãƒ"}]},{label:"ã¯è¡Œ",chars:[{h:"ã¯",k:"ãƒ"},{h:"ã²",k:"ãƒ’"},{h:"ãµ",k:"ãƒ•"},{h:"ã¸",k:"ãƒ˜"},{h:"ã»",k:"ãƒ›"}]},{label:"ã¾è¡Œ",chars:[{h:"ã¾",k:"ãƒ"},{h:"ã¿",k:"ãƒŸ"},{h:"ã‚€",k:"ãƒ "},{h:"ã‚",k:"ãƒ¡"},{h:"ã‚‚",k:"ãƒ¢"}]},{label:"ã‚„è¡Œ",chars:[{h:"ã‚„",k:"ãƒ¤"},null,{h:"ã‚†",k:"ãƒ¦"},null,{h:"ã‚ˆ",k:"ãƒ¨"}]},{label:"ã‚‰è¡Œ",chars:[{h:"ã‚‰",k:"ãƒ©"},{h:"ã‚Š",k:"ãƒª"},{h:"ã‚‹",k:"ãƒ«"},{h:"ã‚Œ",k:"ãƒ¬"},{h:"ã‚",k:"ãƒ­"}]},{label:"ã‚è¡Œ",chars:[{h:"ã‚",k:"ãƒ¯"},null,null,null,{h:"ã‚’",k:"ãƒ²"}]},{label:"ã‚“",chars:[{h:"ã‚“",k:"ãƒ³"},null,null,null,null]}],M=[{label:"ãŒè¡Œ",chars:[{h:"ãŒ",k:"ã‚¬"},{h:"ã",k:"ã‚®"},{h:"ã",k:"ã‚°"},{h:"ã’",k:"ã‚²"},{h:"ã”",k:"ã‚´"}]},{label:"ã–è¡Œ",chars:[{h:"ã–",k:"ã‚¶"},{h:"ã˜",k:"ã‚¸"},{h:"ãš",k:"ã‚º"},{h:"ãœ",k:"ã‚¼"},{h:"ã",k:"ã‚¾"}]},{label:"ã è¡Œ",chars:[{h:"ã ",k:"ãƒ€"},{h:"ã¢",k:"ãƒ‚"},{h:"ã¥",k:"ãƒ…"},{h:"ã§",k:"ãƒ‡"},{h:"ã©",k:"ãƒ‰"}]},{label:"ã°è¡Œ",chars:[{h:"ã°",k:"ãƒ"},{h:"ã³",k:"ãƒ“"},{h:"ã¶",k:"ãƒ–"},{h:"ã¹",k:"ãƒ™"},{h:"ã¼",k:"ãƒœ"}]},{label:"ã±è¡Œ",chars:[{h:"ã±",k:"ãƒ‘"},{h:"ã´",k:"ãƒ”"},{h:"ã·",k:"ãƒ—"},{h:"ãº",k:"ãƒš"},{h:"ã½",k:"ãƒ"}]}],L=[{label:"ãã‚ƒè¡Œ",chars:[{h:"ãã‚ƒ",k:"ã‚­ãƒ£"},{h:"ãã‚…",k:"ã‚­ãƒ¥"},{h:"ãã‚‡",k:"ã‚­ãƒ§"}]},{label:"ã—ã‚ƒè¡Œ",chars:[{h:"ã—ã‚ƒ",k:"ã‚·ãƒ£"},{h:"ã—ã‚…",k:"ã‚·ãƒ¥"},{h:"ã—ã‚‡",k:"ã‚·ãƒ§"}]},{label:"ã¡ã‚ƒè¡Œ",chars:[{h:"ã¡ã‚ƒ",k:"ãƒãƒ£"},{h:"ã¡ã‚…",k:"ãƒãƒ¥"},{h:"ã¡ã‚‡",k:"ãƒãƒ§"}]},{label:"ã«ã‚ƒè¡Œ",chars:[{h:"ã«ã‚ƒ",k:"ãƒ‹ãƒ£"},{h:"ã«ã‚…",k:"ãƒ‹ãƒ¥"},{h:"ã«ã‚‡",k:"ãƒ‹ãƒ§"}]},{label:"ã²ã‚ƒè¡Œ",chars:[{h:"ã²ã‚ƒ",k:"ãƒ’ãƒ£"},{h:"ã²ã‚…",k:"ãƒ’ãƒ¥"},{h:"ã²ã‚‡",k:"ãƒ’ãƒ§"}]},{label:"ã¿ã‚ƒè¡Œ",chars:[{h:"ã¿ã‚ƒ",k:"ãƒŸãƒ£"},{h:"ã¿ã‚…",k:"ãƒŸãƒ¥"},{h:"ã¿ã‚‡",k:"ãƒŸãƒ§"}]},{label:"ã‚Šã‚ƒè¡Œ",chars:[{h:"ã‚Šã‚ƒ",k:"ãƒªãƒ£"},{h:"ã‚Šã‚…",k:"ãƒªãƒ¥"},{h:"ã‚Šã‚‡",k:"ãƒªãƒ§"}]},{label:"ãã‚ƒè¡Œ",chars:[{h:"ãã‚ƒ",k:"ã‚®ãƒ£"},{h:"ãã‚…",k:"ã‚®ãƒ¥"},{h:"ãã‚‡",k:"ã‚®ãƒ§"}]},{label:"ã˜ã‚ƒè¡Œ",chars:[{h:"ã˜ã‚ƒ",k:"ã‚¸ãƒ£"},{h:"ã˜ã‚…",k:"ã‚¸ãƒ¥"},{h:"ã˜ã‚‡",k:"ã‚¸ãƒ§"}]},{label:"ã³ã‚ƒè¡Œ",chars:[{h:"ã³ã‚ƒ",k:"ãƒ“ãƒ£"},{h:"ã³ã‚…",k:"ãƒ“ãƒ¥"},{h:"ã³ã‚‡",k:"ãƒ“ãƒ§"}]},{label:"ã´ã‚ƒè¡Œ",chars:[{h:"ã´ã‚ƒ",k:"ãƒ”ãƒ£"},{h:"ã´ã‚…",k:"ãƒ”ãƒ¥"},{h:"ã´ã‚‡",k:"ãƒ”ãƒ§"}]}],D=[{char:"ã£",label:"ä¿ƒéŸ³"},{char:"ãƒƒ",label:"ä¿ƒéŸ³"},{char:"ãƒ¼",label:"é•¿éŸ³"},{char:"ã€œ",label:"æ³¢æµª"},{char:"ã€‚",label:"å¥å·"},{char:"ã€",label:"é¡¿å·"},{char:"ã€Œ",label:"å¼•å·"},{char:"ã€",label:"å¼•å·"},{char:"ã€",label:"åŒå¼•"},{char:"ã€",label:"åŒå¼•"},{char:"â€¦",label:"çœç•¥"},{char:"ãƒ»",label:"ä¸­ç‚¹"},{char:"ï¼",label:"æ„Ÿå¹"},{char:"ï¼Ÿ",label:"é—®å·"},{char:"â™ª",label:"éŸ³ç¬¦"},{char:"â™¡",label:"å¿ƒå½¢"},{char:"â˜…",label:"æ˜Ÿå½¢"},{char:"â˜†",label:"ç©ºæ˜Ÿ"},{char:"ã",label:"å°ã‚"},{char:"ãƒ",label:"å°ã„"},{char:"ã…",label:"å°ã†"},{char:"ã‡",label:"å°ãˆ"},{char:"ã‰",label:"å°ãŠ"},{char:"ã‚¡",label:"å°ã‚¢"},{char:"ã‚£",label:"å°ã‚¤"},{char:"ã‚¥",label:"å°ã‚¦"},{char:"ã‚§",label:"å°ã‚¨"},{char:"ã‚©",label:"å°ã‚ª"},{char:"ã‚ƒ",label:"å°ã‚„"},{char:"ã‚…",label:"å°ã‚†"},{char:"ã‚‡",label:"å°ã‚ˆ"},{char:"ãƒ£",label:"å°ãƒ¤"},{char:"ãƒ¥",label:"å°ãƒ¦"},{char:"ãƒ§",label:"å°ãƒ¨"}];function U(){o("close")}function w(O){const f=i.value==="hiragana"?O.h:O.k;r.value=O.h,setTimeout(()=>{r.value=null},100),o("insert",f,a.value)}function W(O){r.value=O,setTimeout(()=>{r.value=null},100),o("insert",O,a.value)}function q(){o("delete",a.value)}return(O,f)=>s.visible?(P(),A("div",Bp,[e("div",Ap,[f[3]||(f[3]=e("span",{class:"kana-keyboard-title"},"50éŸ³é”®ç›˜",-1)),e("div",Lp,[(P(),A(Ae,null,Je(T,c=>e("button",{key:c.id,class:Te(["kana-tab",{active:l.value===c.id}]),onClick:k=>l.value=c.id},oe(c.label),11,Fp)),64))]),e("button",{class:"kana-keyboard-close",onClick:U},"âœ•")]),e("div",Up,[e("div",Op,[e("label",null,[ne(e("input",{type:"radio",name:"kanaMode",value:"hiragana","onUpdate:modelValue":f[0]||(f[0]=c=>i.value=c)},null,512),[[qo,i.value]]),f[4]||(f[4]=pe(" å¹³å‡å ",-1))]),e("label",null,[ne(e("input",{type:"radio",name:"kanaMode",value:"katakana","onUpdate:modelValue":f[1]||(f[1]=c=>i.value=c)},null,512),[[qo,i.value]]),f[5]||(f[5]=pe(" ç‰‡å‡å ",-1))])]),e("div",zp,[f[6]||(f[6]=e("label",null,"è¾“å…¥åˆ°ï¼š",-1)),xe(Ne,{modelValue:a.value,"onUpdate:modelValue":f[2]||(f[2]=c=>a.value=c),options:h},null,8,["modelValue"])])]),e("div",{class:Te(["kana-tab-content",{active:l.value==="basic"}])},[e("table",Np,[f[7]||(f[7]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚æ®µ"),e("th",null,"ã„æ®µ"),e("th",null,"ã†æ®µ"),e("th",null,"ãˆæ®µ"),e("th",null,"ãŠæ®µ")])],-1)),e("tbody",null,[(P(),A(Ae,null,Je(S,c=>e("tr",{key:c.label},[e("td",Vp,oe(c.label),1),(P(!0),A(Ae,null,Je(c.chars,(k,C)=>(P(),A("td",{key:C},[k?(P(),A("button",{key:0,class:Te(["kana-key",{pressed:r.value===k.h}]),onClick:N=>w(k)},[e("span",Kp,oe(k.h),1),e("span",qp,oe(k.k),1)],10,Wp)):ge("",!0)]))),128))])),64))])])],2),e("div",{class:Te(["kana-tab-content",{active:l.value==="dakuten"}])},[e("table",Hp,[f[8]||(f[8]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚æ®µ"),e("th",null,"ã„æ®µ"),e("th",null,"ã†æ®µ"),e("th",null,"ãˆæ®µ"),e("th",null,"ãŠæ®µ")])],-1)),e("tbody",null,[(P(),A(Ae,null,Je(M,c=>e("tr",{key:c.label},[e("td",jp,oe(c.label),1),(P(!0),A(Ae,null,Je(c.chars,(k,C)=>(P(),A("td",{key:C},[k?(P(),A("button",{key:0,class:Te(["kana-key",{pressed:r.value===k.h}]),onClick:N=>w(k)},[e("span",Gp,oe(k.h),1),e("span",Yp,oe(k.k),1)],10,Jp)):ge("",!0)]))),128))])),64))])])],2),e("div",{class:Te(["kana-tab-content",{active:l.value==="combo"}])},[e("table",Xp,[f[9]||(f[9]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚ƒ"),e("th",null,"ã‚…"),e("th",null,"ã‚‡")])],-1)),e("tbody",null,[(P(),A(Ae,null,Je(L,c=>e("tr",{key:c.label},[e("td",Zp,oe(c.label),1),(P(!0),A(Ae,null,Je(c.chars,(k,C)=>(P(),A("td",{key:C},[k?(P(),A("button",{key:0,class:Te(["kana-key",{pressed:r.value===k.h}]),onClick:N=>w(k)},[e("span",em,oe(k.h),1),e("span",tm,oe(k.k),1)],10,Qp)):ge("",!0)]))),128))])),64))])])],2),e("div",{class:Te(["kana-tab-content",{active:l.value==="special"}])},[e("div",om,[(P(),A(Ae,null,Je(D,c=>e("button",{key:c.char,class:Te(["kana-key special-key",{pressed:r.value===c.char}]),onClick:k=>W(c.char)},[pe(oe(c.char)+" ",1),c.label?(P(),A("span",sm,oe(c.label),1)):ge("",!0)],10,nm)),64))])],2),e("div",{class:"kana-keyboard-footer"},[e("button",{class:"kana-backspace",onClick:q},"âŒ« é€€æ ¼")])])):ge("",!0)}}),lm=qe(am,[["__scopeId","data-v-ebfc2125"]]),im={class:"edit-panel-content"},rm={class:"text-column original-text-column text-block"},um={class:"text-column translated-text-column text-block"},cm={class:"style-settings-section text-block"},dm={class:"office-toolbar"},gm={class:"toolbar-row toolbar-row-top"},pm={class:"combo-control font-control"},mm={class:"combo-control size-control"},vm={class:"size-input-wrap"},fm=["min","max","step"],bm={class:"toolbar-row toolbar-row-actions"},hm={class:"toolbar-icon-group","aria-label":"æ’ç‰ˆæ–¹å‘"},ym=["data-active"],xm=["data-active"],_m={class:"toolbar-color-group"},Cm={class:"toolbar-color-picker",title:"æ–‡å­—é¢œè‰²"},km={class:"toolbar-inpaint-group",title:"èƒŒæ™¯ä¿®å¤æ–¹å¼"},Sm={class:"toolbar-stroke-cluster"},wm=["data-active"],$m={class:"toolbar-row toolbar-row-bottom"},Tm={class:"toolbar-rotation-group",title:"æ—‹è½¬è§’åº¦"},Im={class:"toolbar-position-group",title:"ä½ç½®è°ƒæ•´"},Rm={class:"toolbar-position-value"},Dm={class:"fontsize-presets-panel"},Pm={class:"font-size-presets"},Mm=["onClick"],Lt=2,Em=He({__name:"BubbleEditor",props:{bubble:{},bubbleIndex:{}},emits:["update","reRender","ocrRecognize","reTranslate","applyBubble","resetCurrent"],setup(s,{emit:t}){const n=s,o=t,l=ct(),i={originalText:"",translatedText:"",fontSize:24,fontFamily:"fonts/STSONG.TTF",textDirection:"vertical",textColor:"#231816",fillColor:"#FFFFFF",strokeEnabled:!0,strokeColor:"#FFFFFF",strokeWidth:3,rotationAngle:0,inpaintMethod:"solid",position:{x:0,y:0}},a=_(""),r=_(""),h=_(24),T=_("fonts/STSONG.TTF"),S=_("vertical"),M=_("#231816"),L=_("#FFFFFF"),D=_(!0),U=_("#FFFFFF"),w=_(3),W=_(0),q=_("solid"),O=_(0),f=_(0),c=_(null),k=_(null),C=_(null),N=_(null),Y=_(null),ie=_(!1),X=_("original"),ae=_([{name:"åæ–‡å®‹ä½“",path:"fonts/STSONG.TTF"},{name:"åæ–‡æ¥·ä½“",path:"fonts/STKAITI.TTF"},{name:"åæ–‡ç»†é»‘",path:"fonts/STXIHEI.TTF"},{name:"é»‘ä½“",path:"fonts/SIMHEI.TTF"},{name:"å®‹ä½“",path:"fonts/SIMSUN.TTC"}]),Z=_([]),d=K(()=>n.bubble?n.bubble.coords[0]+O.value:0),m=K(()=>n.bubble?n.bubble.coords[1]+f.value:0),x=K(()=>{const ke=[{label:"ç³»ç»Ÿå­—ä½“",options:ae.value.map(Q=>({label:Q.name,value:Q.path}))}];return Z.value.length>0&&ke.push({label:"è‡ªå®šä¹‰å­—ä½“",options:Z.value.map(Q=>({label:Q.name,value:Q.path}))}),ke}),b=[{label:"çº¯è‰²å¡«å……",value:"solid"},{label:"LAMAä¿®å¤(æ¼«ç”»)",value:"lama_mpe"},{label:"LAMAä¿®å¤(é€šç”¨)",value:"litelama"}];function p(ke){const Q=ke||i;a.value=Q.originalText,r.value=Q.translatedText,h.value=Q.fontSize,T.value=Q.fontFamily,S.value=Q.textDirection,M.value=Q.textColor,L.value=Q.fillColor,D.value=Q.strokeEnabled,U.value=Q.strokeColor,w.value=Q.strokeWidth,W.value=Q.rotationAngle,q.value=Q.inpaintMethod,O.value=Q.position?.x||0,f.value=Q.position?.y||0}Ce(()=>n.bubble,ke=>{p(ke)},{deep:!0,immediate:!0});function g(){o("update",{originalText:a.value})}function E(){o("update",{translatedText:r.value})}function H(){navigator.clipboard.writeText(a.value)}function I(){navigator.clipboard.writeText(r.value)}function $(){o("update",{fontSize:h.value})}function R(ke){h.value=ke,o("update",{fontSize:ke})}function v(){h.value=Math.min(No,h.value+Qt),o("update",{fontSize:h.value})}function B(){h.value=Math.max(Vo,h.value-Qt),o("update",{fontSize:h.value})}function u(){o("update",{fontFamily:T.value})}function y(ke){S.value=ke,o("update",{textDirection:ke})}function ue(){C.value?.click()}function F(){o("update",{textColor:M.value})}function j(){N.value?.click()}function le(){o("update",{fillColor:L.value})}function _e(){Y.value?.click()}function $e(){o("update",{strokeColor:U.value})}function Ee(){D.value=!D.value,o("update",{strokeEnabled:D.value})}function Me(){o("update",{strokeWidth:w.value})}function se(){o("update",{inpaintMethod:q.value})}function J(){o("update",{rotationAngle:W.value})}function z(){W.value=Math.max(-180,W.value-5),o("update",{rotationAngle:W.value})}function te(){W.value=Math.min(180,W.value+5),o("update",{rotationAngle:W.value})}function ee(){W.value=0,o("update",{rotationAngle:0})}function ce(){O.value-=Lt,o("update",{position:{x:O.value,y:f.value}})}function me(){O.value+=Lt,o("update",{position:{x:O.value,y:f.value}})}function ye(){f.value-=Lt,o("update",{position:{x:O.value,y:f.value}})}function he(){f.value+=Lt,o("update",{position:{x:O.value,y:f.value}})}function ve(){O.value=0,f.value=0,o("update",{position:{x:0,y:0}})}function Ie(){o("applyBubble",n.bubbleIndex)}function we(){l.updateAllBubbles({fontSize:h.value,fontFamily:T.value,textDirection:S.value,textColor:M.value,fillColor:L.value,strokeEnabled:D.value,strokeColor:U.value,strokeWidth:w.value,inpaintMethod:q.value}),console.log("æ ·å¼å·²åº”ç”¨åˆ°æ‰€æœ‰æ°”æ³¡"),o("reRender")}function Ve(){o("resetCurrent",n.bubbleIndex)}function Oe(){o("ocrRecognize",n.bubbleIndex)}function De(){o("reTranslate",n.bubbleIndex)}function Re(){ie.value=!ie.value}function Ge(ke,Q){if(Q==="original"){const fe=c.value;if(fe){const Ke=fe.selectionStart||a.value.length,Ye=fe.selectionEnd||a.value.length,vt=a.value;a.value=vt.slice(0,Ke)+ke+vt.slice(Ye),dt(()=>{fe.selectionStart=fe.selectionEnd=Ke+ke.length,fe.focus()}),o("update",{originalText:a.value})}}else{const fe=k.value;if(fe){const Ke=fe.selectionStart||r.value.length,Ye=fe.selectionEnd||r.value.length,vt=r.value;r.value=vt.slice(0,Ke)+ke+vt.slice(Ye),dt(()=>{fe.selectionStart=fe.selectionEnd=Ke+ke.length,fe.focus()}),o("update",{translatedText:r.value})}}}function at(ke){if(ke==="original"){const Q=c.value;if(Q&&a.value.length>0){const fe=Q.selectionStart||a.value.length,Ke=Q.selectionEnd||a.value.length,Ye=a.value;fe===Ke&&fe>0?(a.value=Ye.slice(0,fe-1)+Ye.slice(Ke),dt(()=>{Q.selectionStart=Q.selectionEnd=fe-1,Q.focus()})):fe!==Ke&&(a.value=Ye.slice(0,fe)+Ye.slice(Ke),dt(()=>{Q.selectionStart=Q.selectionEnd=fe,Q.focus()})),o("update",{originalText:a.value})}}else{const Q=k.value;if(Q&&r.value.length>0){const fe=Q.selectionStart||r.value.length,Ke=Q.selectionEnd||r.value.length,Ye=r.value;fe===Ke&&fe>0?(r.value=Ye.slice(0,fe-1)+Ye.slice(Ke),dt(()=>{Q.selectionStart=Q.selectionEnd=fe-1,Q.focus()})):fe!==Ke&&(r.value=Ye.slice(0,fe)+Ye.slice(Ke),dt(()=>{Q.selectionStart=Q.selectionEnd=fe,Q.focus()})),o("update",{translatedText:r.value})}}}async function it(){try{const ke=await fs();if(ke.fonts){const Q=[],fe=[];for(const Ke of ke.fonts){const Ye={name:typeof Ke=="string"?Ke:Ke.display_name||Ke.file_name||"",path:typeof Ke=="string"?Ke:Ke.path};Ye.path.startsWith("fonts/")?Q.push(Ye):fe.push(Ye)}Q.length>0&&(ae.value=Q),Z.value=fe}}catch(ke){console.error("åŠ è½½å­—ä½“åˆ—è¡¨å¤±è´¥:",ke)}}return ut(()=>{it()}),(ke,Q)=>(P(),A("div",im,[e("div",rm,[e("div",{class:"text-column-header"},[Q[13]||(Q[13]=e("span",{class:"column-title"},"ğŸ‡¯ğŸ‡µ æ—¥è¯­åŸæ–‡ (OCRç»“æœ)",-1)),e("button",{class:"re-ocr-btn",onClick:Oe,title:"é‡æ–°OCRæ­¤æ°”æ³¡"},"ğŸ”„")]),ne(e("textarea",{ref_key:"originalTextInput",ref:c,"onUpdate:modelValue":Q[0]||(Q[0]=fe=>a.value=fe),class:"text-editor original-editor",placeholder:"OCRè¯†åˆ«çš„æ—¥è¯­åŸæ–‡...",spellcheck:"false",onInput:g},null,544),[[Se,a.value]]),e("div",{class:"text-actions"},[e("button",{class:"copy-btn",onClick:H},"ğŸ“‹ å¤åˆ¶"),e("button",{class:"keyboard-toggle-btn",onClick:Re,title:"æ˜¾ç¤º/éšè—50éŸ³é”®ç›˜"}," âŒ¨ï¸ 50éŸ³ ")]),xe(lm,{visible:ie.value,"default-target":X.value,onClose:Q[1]||(Q[1]=fe=>ie.value=!1),onInsert:Ge,onDelete:at},null,8,["visible","default-target"])]),e("div",um,[e("div",{class:"text-column-header"},[Q[14]||(Q[14]=e("span",{class:"column-title"},"ğŸ‡¨ğŸ‡³ ä¸­æ–‡è¯‘æ–‡",-1)),e("button",{class:"re-translate-btn",onClick:De,title:"é‡æ–°ç¿»è¯‘æ­¤æ°”æ³¡"}," ğŸ”„ ")]),ne(e("textarea",{ref_key:"translatedTextInput",ref:k,"onUpdate:modelValue":Q[2]||(Q[2]=fe=>r.value=fe),class:"text-editor translated-editor",placeholder:"ç¿»è¯‘åçš„ä¸­æ–‡...",spellcheck:"false",onInput:E},null,544),[[Se,r.value]]),e("div",{class:"text-actions"},[e("button",{class:"copy-btn",onClick:I},"ğŸ“‹ å¤åˆ¶"),e("button",{class:"apply-text-btn",onClick:Ie},"âœ“ åº”ç”¨æ–‡æœ¬")])]),e("div",cm,[e("div",dm,[e("div",gm,[e("div",pm,[Q[15]||(Q[15]=e("label",null,"å­—ä½“",-1)),xe(Ne,{modelValue:T.value,"onUpdate:modelValue":Q[3]||(Q[3]=fe=>T.value=fe),groups:x.value,title:"å­—ä½“",onChange:u},null,8,["modelValue","groups"])]),e("div",mm,[Q[16]||(Q[16]=e("label",null,"å­—å·",-1)),e("div",vm,[ne(e("input",{type:"number","onUpdate:modelValue":Q[4]||(Q[4]=fe=>h.value=fe),class:"toolbar-fontsize-input",min:V(Vo),max:V(No),step:V(Qt),title:"å­—å·",onChange:$},null,40,fm),[[Se,h.value,void 0,{number:!0}]]),e("div",{class:"toolbar-fontsize-btns"},[e("button",{class:"toolbar-fontsize-btn",onClick:v,title:"å¢å¤§å­—å·"}," A+ "),e("button",{class:"toolbar-fontsize-btn",onClick:B,title:"å‡å°å­—å·"}," A- ")])])])]),e("div",bm,[e("div",hm,[e("button",{class:"toolbar-btn","data-active":S.value==="vertical",onClick:Q[5]||(Q[5]=fe=>y("vertical")),title:"ç«–å‘æ’ç‰ˆ"},[...Q[17]||(Q[17]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M8 2v12M8 2L5 5M8 2l3 3",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])],8,ym),e("button",{class:"toolbar-btn","data-active":S.value==="horizontal",onClick:Q[6]||(Q[6]=fe=>y("horizontal")),title:"æ¨ªå‘æ’ç‰ˆ"},[...Q[18]||(Q[18]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M2 8h12M14 8l-3-3M14 8l-3 3",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])],8,xm)]),Q[24]||(Q[24]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",_m,[e("div",Cm,[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:ue},[Q[19]||(Q[19]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("text",{x:"3",y:"11","font-size":"10","font-weight":"bold",fill:"currentColor"},"A")],-1)),e("span",{class:"color-indicator",style:ot({background:M.value})},null,4)]),ne(e("input",{ref_key:"textColorInput",ref:C,type:"color","onUpdate:modelValue":Q[7]||(Q[7]=fe=>M.value=fe),class:"hidden-color-input",onInput:F,onChange:F},null,544),[[Se,M.value]])])]),Q[25]||(Q[25]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",km,[xe(Ne,{modelValue:q.value,"onUpdate:modelValue":Q[8]||(Q[8]=fe=>q.value=fe),options:b,onChange:se},null,8,["modelValue"]),e("div",{class:Te(["toolbar-color-picker toolbar-solid-color-options",{hidden:q.value!=="solid"}])},[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:j},[Q[20]||(Q[20]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("rect",{x:"2",y:"2",width:"12",height:"12",rx:"2",fill:"none",stroke:"currentColor","stroke-width":"1.2"}),e("rect",{x:"4",y:"4",width:"8",height:"8",rx:"1",fill:"currentColor",opacity:"0.3"})],-1)),e("span",{class:"color-indicator",style:ot({background:L.value})},null,4)]),ne(e("input",{ref_key:"fillColorInput",ref:N,type:"color","onUpdate:modelValue":Q[9]||(Q[9]=fe=>L.value=fe),class:"hidden-color-input",onChange:le},null,544),[[Se,L.value]])],2)]),Q[26]||(Q[26]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",Sm,[e("button",{class:"toolbar-btn","data-active":D.value,onClick:Ee,title:"æ–‡å­—æè¾¹"},[...Q[21]||(Q[21]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("text",{x:"3",y:"12","font-size":"11","font-weight":"bold",stroke:"currentColor","stroke-width":"2",fill:"none"}," A "),e("text",{x:"3",y:"12","font-size":"11","font-weight":"bold",fill:"currentColor"},"A")],-1)])],8,wm),e("div",{class:Te(["toolbar-color-picker toolbar-stroke-options",{hidden:!D.value}]),title:"æè¾¹é¢œè‰²"},[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:_e},[Q[22]||(Q[22]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"2"})],-1)),e("span",{class:"color-indicator",style:ot({background:U.value})},null,4)]),ne(e("input",{ref_key:"strokeColorInput",ref:Y,type:"color","onUpdate:modelValue":Q[10]||(Q[10]=fe=>U.value=fe),class:"hidden-color-input",onChange:$e},null,544),[[Se,U.value]])],2),e("div",{class:Te(["toolbar-stroke-width toolbar-stroke-options",{hidden:!D.value}]),title:"æè¾¹å®½åº¦"},[ne(e("input",{type:"number","onUpdate:modelValue":Q[11]||(Q[11]=fe=>w.value=fe),class:"toolbar-mini-input",min:"0",max:"10",onChange:Me},null,544),[[Se,w.value,void 0,{number:!0}]]),Q[23]||(Q[23]=e("span",{class:"toolbar-unit"},"px",-1))],2)])]),e("div",$m,[e("div",Tm,[e("button",{class:"toolbar-btn",onClick:z,title:"é€†æ—¶é’ˆæ—‹è½¬"},[...Q[27]||(Q[27]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M2 8a6 6 0 1 1 1.5 4",stroke:"currentColor","stroke-width":"1.5",fill:"none"}),e("path",{d:"M2 5v3.5h3.5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),ne(e("input",{type:"number","onUpdate:modelValue":Q[12]||(Q[12]=fe=>W.value=fe),class:"toolbar-mini-input toolbar-rotation-input",min:"-180",max:"180",step:"5",onChange:J},null,544),[[Se,W.value,void 0,{number:!0}]]),Q[29]||(Q[29]=e("span",{class:"toolbar-unit"},"Â°",-1)),e("button",{class:"toolbar-btn",onClick:te,title:"é¡ºæ—¶é’ˆæ—‹è½¬"},[...Q[28]||(Q[28]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M14 8a6 6 0 1 0-1.5 4",stroke:"currentColor","stroke-width":"1.5",fill:"none"}),e("path",{d:"M14 5v3.5h-3.5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn toolbar-small-btn",onClick:ee,title:"é‡ç½®æ—‹è½¬"}," 0 ")]),Q[35]||(Q[35]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",Im,[e("button",{class:"toolbar-btn",onClick:ce,title:"å·¦ç§»"},[...Q[30]||(Q[30]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M10 3L5 8l5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:me,title:"å³ç§»"},[...Q[31]||(Q[31]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M6 3l5 5-5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:ye,title:"ä¸Šç§»"},[...Q[32]||(Q[32]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M3 10l5-5 5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:he,title:"ä¸‹ç§»"},[...Q[33]||(Q[33]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M3 6l5 5 5-5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("span",Rm,[e("span",null,oe(d.value),1),Q[34]||(Q[34]=pe(",",-1)),e("span",null,oe(m.value),1)]),e("button",{class:"toolbar-btn toolbar-small-btn",onClick:ve,title:"é‡ç½®ä½ç½®"}," âŒ‚ ")])])]),e("details",Dm,[Q[36]||(Q[36]=e("summary",null,"å­—å·é¢„è®¾",-1)),e("div",Pm,[(P(!0),A(Ae,null,Je(V(Zn),fe=>(P(),A("button",{key:fe,class:Te(["preset-btn",{active:h.value===fe}]),onClick:Ke=>R(fe)},oe(fe),11,Mm))),128))])]),e("div",{class:"edit-action-buttons"},[e("button",{class:"btn-apply",onClick:Ie},"åº”ç”¨"),e("button",{class:"btn-apply-all",onClick:we},"åº”ç”¨å…¨éƒ¨"),e("button",{class:"btn-reset",onClick:Ve},"é‡ç½®")])])]))}}),Bm=qe(Em,[["__scopeId","data-v-2806e89b"]]),Am={class:"edit-toolbar-wrapper"},Lm={class:"edit-toolbar toolbar-row-1"},Fm={class:"image-navigator"},Um=["disabled"],Om=["disabled"],zm={class:"bubble-navigator"},Nm=["disabled"],Vm={class:"bubble-indicator"},Wm={id:"currentBubbleNum"},Km={id:"totalBubbleNum"},qm=["disabled"],Hm={class:"view-controls"},jm={key:0,viewBox:"0 0 20 20",width:"16",height:"16"},Jm={key:1,viewBox:"0 0 20 20",width:"16",height:"16"},Gm={id:"zoomLevel"},Ym={class:"edit-toolbar toolbar-row-2"},Xm={class:"annotation-tools"},Zm=["disabled"],Qm=["disabled"],ev={key:0,class:"brush-size-indicator"},tv={key:1,class:"brush-mode-hint"},ov={class:"edit-progress-info"},nv={class:"edit-progress-text"},sv={class:"edit-progress-count"},av={class:"edit-progress-bar"},lv={class:"quick-actions"},iv=He({__name:"EditToolbar",props:{currentImageIndex:{},imageCount:{},canGoPrevious:{type:Boolean},canGoNext:{type:Boolean},showThumbnails:{type:Boolean},hasBubbles:{type:Boolean},selectedBubbleIndex:{},bubbleCount:{},layoutMode:{},syncEnabled:{type:Boolean},scale:{},isDrawingMode:{type:Boolean},hasSelection:{type:Boolean},brushMode:{},brushSize:{},mouseX:{},mouseY:{},isProcessing:{type:Boolean},progressText:{},progressCurrent:{},progressTotal:{}},emits:["go-previous-image","go-next-image","toggle-thumbnails","select-previous-bubble","select-next-bubble","toggle-layout","toggle-view-mode","toggle-sync","fit-to-screen","zoom-in","zoom-out","reset-zoom","exit-edit-mode","auto-detect-bubbles","detect-all-images","translate-with-bubbles","toggle-drawing-mode","delete-selected-bubbles","repair-selected-bubble","activate-repair-brush","activate-restore-brush","apply-and-next"],setup(s){const t=s,n=K(()=>t.progressTotal===0?0:Math.round(t.progressCurrent/t.progressTotal*100)),o=K(()=>t.progressTotal>0&&t.progressCurrent>=t.progressTotal),l=K(()=>{const i=t.brushMode==="repair"?{fill:"rgba(76, 175, 80, 0.4)",border:"#4CAF50"}:{fill:"rgba(33, 150, 243, 0.4)",border:"#2196F3"};return{position:"fixed",left:`${t.mouseX}px`,top:`${t.mouseY}px`,width:`${t.brushSize}px`,height:`${t.brushSize}px`,borderRadius:"50%",border:`2px solid ${i.border}`,backgroundColor:i.fill,pointerEvents:"none",zIndex:99999,transform:"translate(-50%, -50%)",display:t.brushMode?"block":"none"}});return(i,a)=>(P(),A("div",Am,[e("div",Lm,[e("div",Fm,[e("button",{class:"nav-btn",disabled:!s.canGoPrevious,onClick:a[0]||(a[0]=r=>i.$emit("go-previous-image")),title:"ä¸Šä¸€å¼ å›¾ç‰‡ (PageUp)"}," â—€â—€ ",8,Um),e("span",{class:"image-indicator",onClick:a[1]||(a[1]=r=>i.$emit("toggle-thumbnails")),title:"ç‚¹å‡»å±•å¼€ç¼©ç•¥å›¾"},[a[23]||(a[23]=pe(" å›¾ ",-1)),e("span",null,oe(s.currentImageIndex+1),1),a[24]||(a[24]=pe(" / ",-1)),e("span",null,oe(s.imageCount),1)]),e("button",{class:"nav-btn",disabled:!s.canGoNext,onClick:a[2]||(a[2]=r=>i.$emit("go-next-image")),title:"ä¸‹ä¸€å¼ å›¾ç‰‡ (PageDown)"}," â–¶â–¶ ",8,Om),e("button",{class:Te(["thumb-toggle-btn",{active:s.showThumbnails}]),onClick:a[3]||(a[3]=r=>i.$emit("toggle-thumbnails")),title:"æ˜¾ç¤º/éšè—ç¼©ç•¥å›¾"}," â˜· ",2)]),a[30]||(a[30]=e("div",{class:"toolbar-divider"},null,-1)),e("div",zm,[e("button",{id:"prevBubbleBtn",class:"nav-btn",disabled:!s.hasBubbles||s.selectedBubbleIndex<=0,onClick:a[4]||(a[4]=r=>i.$emit("select-previous-bubble")),title:"ä¸Šä¸€ä¸ªæ°”æ³¡ (â†)"}," â—€ ",8,Nm),e("span",Vm,[a[25]||(a[25]=pe(" æ°”æ³¡ ",-1)),e("span",Wm,oe(s.selectedBubbleIndex>=0?s.selectedBubbleIndex+1:0),1),a[26]||(a[26]=pe(" / ",-1)),e("span",Km,oe(s.bubbleCount),1)]),e("button",{id:"nextBubbleBtn",class:"nav-btn",disabled:!s.hasBubbles||s.selectedBubbleIndex>=s.bubbleCount-1,onClick:a[5]||(a[5]=r=>i.$emit("select-next-bubble")),title:"ä¸‹ä¸€ä¸ªæ°”æ³¡ (â†’)"}," â–¶ ",8,qm)]),a[31]||(a[31]=e("div",{class:"toolbar-divider"},null,-1)),e("div",Hm,[e("button",{class:"layout-toggle-btn",onClick:a[6]||(a[6]=r=>i.$emit("toggle-layout")),title:"åˆ‡æ¢å¸ƒå±€ï¼šå·¦å³/ä¸Šä¸‹"},[s.layoutMode==="horizontal"?(P(),A("svg",jm,[...a[27]||(a[27]=[e("rect",{x:"1",y:"2",width:"8",height:"16",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1),e("rect",{x:"11",y:"2",width:"8",height:"16",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1)])])):(P(),A("svg",Jm,[...a[28]||(a[28]=[e("rect",{x:"2",y:"1",width:"16",height:"8",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1),e("rect",{x:"2",y:"11",width:"16",height:"8",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1)])]))]),e("button",{class:"view-mode-btn",onClick:a[7]||(a[7]=r=>i.$emit("toggle-view-mode")),title:"åˆ‡æ¢è§†å›¾æ¨¡å¼"},[...a[29]||(a[29]=[e("span",{class:"dual-icon"},"â§‰",-1)])]),e("button",{class:Te({active:s.syncEnabled}),onClick:a[8]||(a[8]=r=>i.$emit("toggle-sync")),title:"åŒæ­¥ç¼©æ”¾/æ‹–åŠ¨",style:{"font-size":"12px"}}," ğŸ”— ",2),e("button",{onClick:a[9]||(a[9]=r=>i.$emit("fit-to-screen")),title:"é€‚åº”å±å¹• (åŒå‡»)"},"â›¶"),e("button",{onClick:a[10]||(a[10]=r=>i.$emit("zoom-in")),title:"æ”¾å¤§ (+)"},"+"),e("span",Gm,oe(Math.round(s.scale*100))+"%",1),e("button",{onClick:a[11]||(a[11]=r=>i.$emit("zoom-out")),title:"ç¼©å° (-)"},"âˆ’"),e("button",{onClick:a[12]||(a[12]=r=>i.$emit("reset-zoom")),title:"åŸå§‹å¤§å°"},"1:1")]),a[32]||(a[32]=e("div",{class:"toolbar-spacer"},null,-1)),e("button",{class:"secondary-btn",onClick:a[13]||(a[13]=r=>i.$emit("exit-edit-mode"))},"é€€å‡ºç¼–è¾‘")]),e("div",Ym,[e("div",Xm,[e("button",{class:"annotation-btn detect-btn",onClick:a[14]||(a[14]=r=>i.$emit("auto-detect-bubbles")),title:"è‡ªåŠ¨æ£€æµ‹å½“å‰å›¾ç‰‡çš„æ–‡æœ¬æ¡†"},[...a[33]||(a[33]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"6",cy:"6",r:"4",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M9 9l4 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1),e("span",null,"æ£€æµ‹",-1)])]),e("button",{class:"annotation-btn detect-btn",onClick:a[15]||(a[15]=r=>i.$emit("detect-all-images")),title:"æ‰¹é‡æ£€æµ‹æ‰€æœ‰å›¾ç‰‡"},[...a[34]||(a[34]=[no('<svg viewBox="0 0 16 16" width="14" height="14" data-v-b7164359><circle cx="5" cy="5" r="2.5" fill="none" stroke="currentColor" stroke-width="1" data-v-b7164359></circle><path d="M7 7l2 2" stroke="currentColor" stroke-width="1" stroke-linecap="round" data-v-b7164359></path><circle cx="10" cy="10" r="2.5" fill="none" stroke="currentColor" stroke-width="1" data-v-b7164359></circle><path d="M12 12l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-b7164359></path></svg><span data-v-b7164359>æ‰¹é‡æ£€æµ‹</span>',2)])]),e("button",{class:"annotation-btn primary-action-btn",onClick:a[16]||(a[16]=r=>i.$emit("translate-with-bubbles")),title:"ä½¿ç”¨å½“å‰æ–‡æœ¬æ¡†ç¿»è¯‘æ­¤å›¾ç‰‡"},[...a[35]||(a[35]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M2 3h5M4.5 3v7M2 6h5",stroke:"currentColor","stroke-width":"1.2",fill:"none"}),e("path",{d:"M9 13l2-7 2 7M9.5 11h3",stroke:"currentColor","stroke-width":"1.2",fill:"none"})],-1),e("span",null,"ç¿»è¯‘",-1)])]),a[41]||(a[41]=e("div",{class:"toolbar-divider"},null,-1)),e("button",{class:Te(["annotation-btn",{active:s.isDrawingMode}]),onClick:a[17]||(a[17]=r=>i.$emit("toggle-drawing-mode")),title:"æ·»åŠ æ°”æ³¡æ¡†ï¼ˆæˆ–ä¸­é”®æ‹–æ‹½ç»˜åˆ¶ï¼‰"},[...a[36]||(a[36]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("rect",{x:"3",y:"3",width:"10",height:"10",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M8 5v6M5 8h6",stroke:"currentColor","stroke-width":"1.5"})],-1),e("span",null,"æ·»åŠ ",-1)])],2),e("button",{class:"annotation-btn",disabled:!s.hasSelection,onClick:a[18]||(a[18]=r=>i.$emit("delete-selected-bubbles")),title:"åˆ é™¤é€‰ä¸­æ°”æ³¡æ¡† (Delete)"},[...a[37]||(a[37]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("rect",{x:"3",y:"3",width:"10",height:"10",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M5 8h6",stroke:"currentColor","stroke-width":"1.5"})],-1),e("span",null,"åˆ é™¤",-1)])],8,Zm),e("button",{class:"annotation-btn",disabled:!s.hasSelection,onClick:a[19]||(a[19]=r=>i.$emit("repair-selected-bubble")),title:"ä¿®å¤é€‰ä¸­æ°”æ³¡èƒŒæ™¯ (R)"},[...a[38]||(a[38]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M2 14l3-3m0 0l6-6 3 3-6 6m-3 0l-1 1 1-1z",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M11 5l-1-1 2-2 2 2-2 2-1-1z",fill:"currentColor"})],-1),e("span",null,"ä¿®å¤",-1)])],8,Qm),a[42]||(a[42]=e("div",{class:"toolbar-divider"},null,-1)),e("button",{class:Te(["annotation-btn brush-btn",{active:s.brushMode==="repair"}]),onClick:a[20]||(a[20]=r=>i.$emit("activate-repair-brush")),title:"ä¿®å¤ç¬”åˆ· (æŒ‰ä½R+å·¦é”®æ‹–æ‹½)"},[...a[39]||(a[39]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("circle",{cx:"8",cy:"8",r:"2",fill:"currentColor"})],-1),e("span",null,"ä¿®å¤ç¬”åˆ·",-1)])],2),e("button",{class:Te(["annotation-btn brush-btn",{active:s.brushMode==="restore"}]),onClick:a[21]||(a[21]=r=>i.$emit("activate-restore-brush")),title:"è¿˜åŸç¬”åˆ· (æŒ‰ä½U+å·¦é”®æ‹–æ‹½)"},[...a[40]||(a[40]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M5 8h6M8 5v6",stroke:"currentColor","stroke-width":"1",transform:"rotate(45 8 8)"})],-1),e("span",null,"è¿˜åŸç¬”åˆ·",-1)])],2),s.brushMode?(P(),A("span",ev," ç¬”åˆ·: "+oe(s.brushSize)+"px ",1)):ge("",!0),a[43]||(a[43]=no('<div class="help-tooltip-container" data-v-b7164359><button class="help-tooltip-btn" title="å¿«æ·é”®æ“ä½œå¸®åŠ©" data-v-b7164359><svg viewBox="0 0 16 16" width="14" height="14" data-v-b7164359><circle cx="8" cy="8" r="6.5" fill="none" stroke="currentColor" stroke-width="1.2" data-v-b7164359></circle><text x="8" y="11" text-anchor="middle" font-size="9" font-weight="bold" fill="currentColor" data-v-b7164359>?</text></svg><span class="help-btn-text" data-v-b7164359>å¿«æ·é”®</span></button><div class="help-tooltip-popup" data-v-b7164359><div class="help-section" data-v-b7164359><div class="help-title" data-v-b7164359>ğŸ–±ï¸ é¼ æ ‡æ“ä½œ</div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®ç‚¹å‡»æ°”æ³¡</span><span class="help-desc" data-v-b7164359>é€‰æ‹©æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Shift+å·¦é”®ç‚¹å‡»</span><span class="help-desc" data-v-b7164359>å¤šé€‰æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®æ‹–æ‹½å››è§’/è¾¹</span><span class="help-desc" data-v-b7164359>è°ƒæ•´å¤§å°</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®æ‹–æ‹½æ¡†å†…éƒ¨</span><span class="help-desc" data-v-b7164359>ç§»åŠ¨æ°”æ³¡æ¡†</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>ä¸­é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>ç»˜åˆ¶æ–°æ°”æ³¡æ¡†</span></div></div><div class="help-section" data-v-b7164359><div class="help-title" data-v-b7164359>âŒ¨ï¸ å¿«æ·é”®</div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>A / D</span><span class="help-desc" data-v-b7164359>åˆ‡æ¢ä¸Š/ä¸‹ä¸€å¼ å›¾ç‰‡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Ctrl+Enter</span><span class="help-desc" data-v-b7164359>åº”ç”¨å¹¶è·³è½¬ä¸‹ä¸€å¼ </span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Delete / Backspace</span><span class="help-desc" data-v-b7164359>åˆ é™¤é€‰ä¸­æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>æŒ‰ä½R+å·¦é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>ä¿®å¤ç¬”åˆ·</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>æŒ‰ä½U+å·¦é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>è¿˜åŸç¬”åˆ·</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>ç¬”åˆ·æ¨¡å¼ä¸‹æ»šè½®</span><span class="help-desc" data-v-b7164359>è°ƒæ•´ç¬”åˆ·å¤§å°</span></div></div></div></div>',1))]),s.brushMode?(P(),A("div",{key:0,class:"brush-cursor",style:ot(l.value)},null,4)):ge("",!0),s.brushMode?(P(),A("div",tv,oe(s.brushMode==="repair"?"ä¿®å¤ç¬”åˆ· (R)":"è¿˜åŸç¬”åˆ· (U)")+" - æ»šè½®è°ƒæ•´å¤§å° ",1)):ge("",!0),s.isProcessing?(P(),A("div",{key:2,class:Te(["edit-progress-container",{completed:o.value}])},[e("div",ov,[e("span",nv,oe(s.progressText),1),e("span",sv,oe(s.progressCurrent)+"/"+oe(s.progressTotal),1)]),e("div",av,[e("div",{class:Te(["edit-progress-fill",{animating:!o.value}]),style:ot({width:n.value+"%"})},null,6)])],2)):ge("",!0),a[44]||(a[44]=e("div",{class:"toolbar-spacer"},null,-1)),e("div",lv,[e("button",{class:"primary-btn",onClick:a[22]||(a[22]=r=>i.$emit("apply-and-next")),title:"åº”ç”¨æ›´æ”¹å¹¶è·³è½¬ä¸‹ä¸€å¼  (Ctrl+Enter)"}," åº”ç”¨å¹¶ä¸‹ä¸€å¼  ")])])]))}}),rv=qe(iv,[["__scopeId","data-v-b7164359"]]),uv={key:0,class:"edit-thumbnails-panel"},cv={class:"thumbnails-scroll"},dv=["onClick"],gv=["src","alt"],pv={class:"thumb-index"},mv=He({__name:"EditThumbnailPanel",props:{visible:{type:Boolean},images:{},currentImageIndex:{}},emits:["switch-to-image"],setup(s){return(t,n)=>s.visible?(P(),A("div",uv,[e("div",cv,[(P(!0),A(Ae,null,Je(s.images,(o,l)=>(P(),A("div",{key:o.id,class:Te(["edit-thumbnail-item",{active:l===s.currentImageIndex}]),onClick:i=>t.$emit("switch-to-image",l)},[e("img",{src:o.translatedDataURL||o.originalDataURL,alt:`å›¾ç‰‡ ${l+1}`},null,8,gv),e("span",pv,oe(l+1),1)],10,dv))),128))])])):ge("",!0)}}),vv=qe(mv,[["__scopeId","data-v-9d2a43d9"]]),fv=["data-brush-mode"],bv={class:"edit-main-layout"},hv={class:"image-comparison-container"},yv={class:"panel-header"},xv=["src"],_v={class:"panel-header"},Cv=["src"],kv=He({__name:"EditWorkspace",props:{isEditModeActive:{type:Boolean}},emits:["exit"],setup(s,{emit:t}){const n=s,o=t,l=Qe(),i=ct(),{translateWithCurrentBubbles:a}=vo(),{reRenderFullImage:r}=_p({onRenderStart:()=>console.log("å¼€å§‹é‡æ–°æ¸²æŸ“..."),onRenderSuccess:G=>console.log("æ¸²æŸ“æˆåŠŸ:",G.substring(0,50)+"..."),onRenderError:G=>console.error("æ¸²æŸ“å¤±è´¥:",G)}),{isDrawingMode:h,isDrawingBox:T,currentDrawingRect:S,isMiddleButtonDown:M,handleBubbleSelect:L,handleBubbleMultiSelect:D,handleClearMultiSelect:U,handleBubbleDragStart:w,handleBubbleDragging:W,handleBubbleDragEnd:q,handleBubbleResizeStart:O,handleBubbleResizing:f,handleBubbleResizeEnd:c,handleBubbleRotateStart:k,handleBubbleRotating:C,handleBubbleRotateEnd:N,toggleDrawingMode:Y,handleDrawBubble:ie,getDrawingRectStyle:X,handleBubbleUpdate:ae,deleteSelectedBubbles:Z,repairSelectedBubble:d,handleOcrRecognize:m}=xp({onReRender:()=>r(),onDelayedPreview:()=>r()}),x=_(0),b=_(0),{brushMode:p,brushSize:g,mouseX:E,mouseY:H,isBrushKeyDown:I,toggleBrushMode:$,exitBrushMode:R,startBrushPainting:v,continueBrushPainting:B,finishBrushPainting:u,adjustBrushSize:y}=hp({onBrushComplete:()=>r(),getCurrentRepairSettings:()=>({inpaintMethod:ke.value,fillColor:Q.value})}),{images:ue,currentImageIndex:F,currentImage:j,imageCount:le,canGoPrevious:_e,canGoNext:$e}=xt(l),{bubbles:Ee,selectedIndex:Me,selectedIndices:se,selectedBubble:J,bubbleCount:z,hasBubbles:te,hasSelection:ee}=xt(i),ce=K(()=>ve.value?.querySelector("img")?.naturalWidth||2e3),me=K(()=>ve.value?.querySelector("img")?.naturalHeight||2e3),ye=_(null),he=_(null),ve=_(null),Ie=_(null),we=_(null),Ve=_(null),Oe=_("dual"),De=_("horizontal"),Re=_(!1),Ge=_(!0),at=_(!1),it=_(!1),ke=_("solid"),Q=_("#FFFFFF"),fe=_(!1),Ke=_("å¤„ç†ä¸­..."),Ye=_(0),vt=_(0),nt=tn(),Xe=tn(),Ot=K(()=>Xe.scale.value),Cn=K(()=>Xe.translateX.value),kn=K(()=>Xe.translateY.value),Sn=K(()=>nt.scale.value),bt=_(null),wn=K(()=>({transform:`translate(${nt.translateX.value}px, ${nt.translateY.value}px) scale(${nt.scale.value})`})),$n=K(()=>({transform:`translate(${Xe.translateX.value}px, ${Xe.translateY.value}px) scale(${Xe.scale.value})`}));function fo(){Xe.zoomIn(),Ge.value&&nt.setTransform(Xe.getTransform())}function bo(){Xe.zoomOut(),Ge.value&&nt.setTransform(Xe.getTransform())}function ho(){Xe.resetZoom(),Ge.value&&nt.setTransform(Xe.getTransform())}const zt=_(!1),Tn=_(0),Nt=_(!1),$t=_({x:0,y:0,size:0});function Vt(){p.value&&R(),qt()}function Wt(){i.bubbles.length>0&&i.selectBubble(0)}function yo(){_e.value&&(Vt(),l.goToPrevious())}function Kt(){$e.value&&(Vt(),l.goToNext())}function In(G){G!==F.value&&G>=0&&G<le.value&&(Vt(),l.setCurrentImageIndex(G))}function qt(){if(!j.value)return;const G=Array.isArray(j.value.bubbleStates);Ee.value.length>0?(l.updateCurrentBubbleStates([...Ee.value]),l.setManuallyAnnotated(!0),console.log("å·²ä¿å­˜æ°”æ³¡çŠ¶æ€åˆ°å½“å‰å›¾ç‰‡ï¼Œæ ‡è®°ä¸ºæ‰‹åŠ¨æ ‡æ³¨")):G&&(l.updateCurrentBubbleStates([]),l.setManuallyAnnotated(!0),console.log("å·²ä¿å­˜ç©ºæ°”æ³¡çŠ¶æ€åˆ°å½“å‰å›¾ç‰‡ï¼ˆç”¨æˆ·ä¸»åŠ¨æ¸…ç©ºï¼Œæ ‡è®°ä¸ºæ‰‹åŠ¨æ ‡æ³¨ï¼‰"))}function Tt(){j.value?.bubbleStates?(i.setBubbles([...j.value.bubbleStates],!0),console.log(`å·²åŠ è½½ ${j.value.bubbleStates.length} ä¸ªæ°”æ³¡çŠ¶æ€`)):i.clearBubblesLocal(),Wt()}function Rn(){i.selectPrevious()}function Dn(){i.selectNext()}function Pn(){Re.value=!Re.value}function Mn(){De.value=De.value==="horizontal"?"vertical":"horizontal";try{localStorage.setItem(Wo,De.value)}catch(G){console.warn("ä¿å­˜å¸ƒå±€æ¨¡å¼å¤±è´¥:",G)}setTimeout(()=>{It()},300)}function En(){const G=["dual","original","translated"],re=G.indexOf(Oe.value),de=G[(re+1)%G.length];de&&(Oe.value=de)}function Bn(){Ge.value=!Ge.value,console.log("åŒå›¾åŒæ­¥:",Ge.value?"å¼€å¯":"å…³é—­"),Ge.value&&nt.setTransform(Xe.getTransform())}function It(){const G=Ie.value||he.value,re=we.value||ve.value;if(!G||!re)return;const de=re.querySelector("img");if(!de||!de.naturalWidth)return;const je=G.getBoundingClientRect(),Le=je.width/de.naturalWidth,Pe=je.height/de.naturalHeight,ze=Math.min(Le,Pe)*.95,Be=(je.width-de.naturalWidth*ze)/2,ft=(je.height-de.naturalHeight*ze)/2,ht={scale:ze,translateX:Be,translateY:ft};Xe.setTransform(ht),nt.setTransform(ht)}function xo(G,re){if(p.value){const Be=G.deltaY>0?-5:5;y(Be);return}const de=G.currentTarget.getBoundingClientRect(),je=G.clientX-de.left,Le=G.clientY-de.top,Pe=G.deltaY>0?.9:1.1,ze=re==="original"?nt:Xe;ze.zoomAt(je,Le,Pe),Ge.value&&(re==="original"?Xe:nt).setTransform(ze.getTransform())}function _o(G,re){if(p.value){const de=re==="original"?he.value:Ie.value;de&&v(G,de);return}if(G.button===1){M.value=!0,So(G,re),G.preventDefault();return}if(h.value&&G.button===0){So(G,re),G.preventDefault();return}if(G.button===0){if(G.target.closest(".bubble-highlight-box"))return;G.shiftKey||U(),bt.value=re,(re==="original"?nt:Xe).startDrag(G.clientX,G.clientY),document.addEventListener("mousemove",Co),document.addEventListener("mouseup",ko),G.preventDefault()}}function Co(G){if(!bt.value)return;const re=bt.value==="original"?nt:Xe;re.drag(G.clientX,G.clientY),Ge.value&&(bt.value==="original"?Xe:nt).setTransform(re.getTransform())}function ko(){bt.value&&(bt.value==="original"?nt:Xe).endDrag(),bt.value=null,document.removeEventListener("mousemove",Co),document.removeEventListener("mouseup",ko)}let Ht="translated";function So(G,re="translated"){Ht=re;const de=re==="original"?ve.value:we.value,je=re==="original"?nt:Xe;if(!de)return;const Le=de.getBoundingClientRect(),Pe=(G.clientX-Le.left)/je.scale.value,ze=(G.clientY-Le.top)/je.scale.value;x.value=Pe,b.value=ze,T.value=!0,S.value=[Pe,ze,Pe,ze],document.addEventListener("mousemove",jt),document.addEventListener("mouseup",Jt)}function jt(G){if(!T.value)return;const re=Ht==="original"?ve.value:we.value,de=Ht==="original"?nt:Xe;if(!re)return;const je=re.getBoundingClientRect(),Le=(G.clientX-je.left)/de.scale.value,Pe=(G.clientY-je.top)/de.scale.value;S.value=[Math.min(x.value,Le),Math.min(b.value,Pe),Math.max(x.value,Le),Math.max(b.value,Pe)]}function Jt(G){document.removeEventListener("mousemove",jt),document.removeEventListener("mouseup",Jt);const re=M.value;if(!T.value||!S.value){T.value=!1,S.value=null,M.value=!1;return}const[de,je,Le,Pe]=S.value,ze=Le-de,Be=Pe-je;ze>10&&Be>10&&(i.addBubble(S.value),i.selectBubble(i.bubbleCount-1),console.log("å·²æ·»åŠ æ–°æ°”æ³¡:",S.value)),T.value=!1,S.value=null,M.value=!1,!re&&h.value&&(h.value=!1)}function wo(G){console.log(`${G} å›¾ç‰‡åŠ è½½å®Œæˆ`),Ot.value===1&&Cn.value===0&&kn.value===0&&dt(()=>{It()})}function An(){r()}function Ln(G){G.inpaintMethod!==void 0&&(ke.value=G.inpaintMethod),G.fillColor!==void 0&&(Q.value=G.fillColor),Me.value>=0&&ae(G)}function Fn(G){be("æ–‡æœ¬å·²åº”ç”¨","success"),r()}function Un(G){const re=i.initialStates[G];if(!re){console.warn(`æ— æ³•é‡ç½®æ°”æ³¡ #${G+1}ï¼šæ‰¾ä¸åˆ°åˆå§‹çŠ¶æ€`),be("æ— æ³•é‡ç½®ï¼šæ‰¾ä¸åˆ°åˆå§‹çŠ¶æ€","warning");return}const de=JSON.parse(JSON.stringify(re));i.updateBubble(G,de),console.log(`æ°”æ³¡ #${G+1} å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€`),be("æ°”æ³¡å·²é‡ç½®","success"),r()}async function On(G){const re=Ee.value[G];if(!re?.originalText){console.warn("æ— æ³•é‡æ–°ç¿»è¯‘ï¼šç¼ºå°‘æ°”æ³¡æˆ–åŸæ–‡");return}try{console.log(`å¼€å§‹é‡æ–°ç¿»è¯‘æ°”æ³¡ #${G+1}`);const{translateSingleText:de}=await lt(async()=>{const{translateSingleText:ze}=await Promise.resolve().then(()=>xs);return{translateSingleText:ze}},void 0),{useSettingsStore:je}=await lt(async()=>{const{useSettingsStore:ze}=await import("./system.B9lB2QDm.js").then(Be=>Be.s);return{useSettingsStore:ze}},__vite__mapDeps([0,1,2,3,4,5])),Le=je().settings,Pe=await de({original_text:re.originalText,model_provider:Le.translation.provider,api_key:Le.translation.apiKey,model_name:Le.translation.modelName,custom_base_url:Le.translation.customBaseUrl,target_language:Le.targetLanguage,prompt_content:void 0});Pe.success&&Pe.data?.translated_text?(i.updateBubble(G,{translatedText:Pe.data.translated_text}),console.log(`ç¿»è¯‘æˆåŠŸ: "${Pe.data.translated_text}"`),r()):console.error("ç¿»è¯‘å¤±è´¥:",Pe.error||"æœªçŸ¥é”™è¯¯")}catch(de){console.error("ç¿»è¯‘å‡ºé”™:",de)}}function $o(G,re){for(G.bubbleTexts||(G.bubbleTexts=[]),G.originalTexts||(G.originalTexts=[]);G.bubbleTexts.length<re;)G.bubbleTexts.push("");for(;G.originalTexts.length<re;)G.originalTexts.push("")}function To(G,re,de){const je=G.auto_directions||[];return G.bubble_coords.map((Le,Pe)=>{const ze=Le[0]??0,Be=Le[1]??0,ft=Le[2]??0,ht=Le[3]??0;let gt;return je[Pe]?gt=je[Pe]==="v"?"vertical":"horizontal":gt=ht-Be>ft-ze?"vertical":"horizontal",{coords:Le,originalText:re.originalTexts?.[Pe]||"",translatedText:re.bubbleTexts?.[Pe]||"",textboxText:"",fontSize:de.fontSize,fontFamily:de.fontFamily,textDirection:gt,autoTextDirection:gt,textColor:de.textColor,fillColor:de.fillColor,strokeEnabled:de.strokeEnabled,strokeColor:de.strokeColor,strokeWidth:de.strokeWidth,rotationAngle:G.bubble_angles?.[Pe]||0,inpaintMethod:de.inpaintMethod,position:{x:0,y:0},polygon:[]}})}async function zn(){const G=j.value;if(!G?.originalDataURL){be("æ²¡æœ‰æœ‰æ•ˆçš„å›¾ç‰‡ç”¨äºæ£€æµ‹","warning");return}try{be("æ­£åœ¨è‡ªåŠ¨æ£€æµ‹æ–‡æœ¬æ¡†...","info");const de=G.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/)?.[1]||"";if(!de){be("æ— æ³•è§£æå›¾ç‰‡æ•°æ®","error");return}const je=Ue(),{textDetector:Le,boxExpand:Pe,textStyle:ze}=je.settings,Be=await so(de,Le,{box_expand_ratio:Pe.ratio,box_expand_top:Pe.top,box_expand_bottom:Pe.bottom,box_expand_left:Pe.left,box_expand_right:Pe.right});if(Be.success&&Be.bubble_coords){l.updateCurrentImage({bubbleCoords:Be.bubble_coords,bubbleAngles:Be.bubble_angles||[]}),$o(G,Be.bubble_coords.length);const ft={bubble_coords:Be.bubble_coords.map(gt=>[...gt]),bubble_angles:Be.bubble_angles,auto_directions:Be.auto_directions},ht=To(ft,G,ze);i.setBubbles(ht),Wt(),be(`è‡ªåŠ¨æ£€æµ‹åˆ° ${Be.bubble_coords.length} ä¸ªæ–‡æœ¬æ¡†`,"success")}else be(Be.error||"æ£€æµ‹å¤±è´¥","error")}catch(re){console.error("è‡ªåŠ¨æ£€æµ‹å¤±è´¥:",re),be("è‡ªåŠ¨æ£€æµ‹å¤±è´¥","error")}}async function Nn(){if(ue.value.length<=1){be("è‡³å°‘éœ€è¦ä¸¤å¼ å›¾ç‰‡æ‰èƒ½æ‰§è¡Œæ‰¹é‡æ£€æµ‹","warning");return}if(!confirm("æ­¤æ“ä½œå°†å¯¹æ‰€æœ‰å›¾ç‰‡è¿›è¡Œæ–‡æœ¬æ¡†æ£€æµ‹ï¼Œå¯èƒ½ä¼šè¦†ç›–å·²æœ‰çš„æ£€æµ‹ç»“æœã€‚ç¡®å®šç»§ç»­å—ï¼Ÿ"))return;const G=Ue(),{textDetector:re,boxExpand:de,textStyle:je}=G.settings,Le=F.value,Pe=ue.value.length;fe.value=!0,Ke.value="æ‰¹é‡æ£€æµ‹ä¸­",vt.value=Pe,Ye.value=0;try{let ze=0;for(let Be=0;Be<Pe;Be++){const ft=ue.value[Be];if(!ft?.originalDataURL)continue;Ye.value=Be+1;const gt=ft.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/)?.[1]||"";if(!gt)continue;const pt=await so(gt,re,{box_expand_ratio:de.ratio,box_expand_top:de.top,box_expand_bottom:de.bottom,box_expand_left:de.left,box_expand_right:de.right});if(pt.success&&pt.bubble_coords){const _t=ue.value[Be];if(_t){_t.bubbleCoords=pt.bubble_coords,_t.bubbleAngles=pt.bubble_angles||[],$o(_t,pt.bubble_coords.length);const jn={bubble_coords:pt.bubble_coords.map(Jn=>[...Jn]),bubble_angles:pt.bubble_angles,auto_directions:pt.auto_directions};_t.bubbleStates=To(jn,_t,je),ze+=pt.bubble_coords.length,Be===F.value&&Tt()}}}Ke.value="æ£€æµ‹å®Œæˆ",Ye.value=Pe,Le!==F.value&&l.setCurrentImageIndex(Le),Tt(),be(`æ‰¹é‡æ£€æµ‹å®Œæˆï¼å…±å¤„ç† ${Pe} å¼ å›¾ç‰‡ï¼Œæ£€æµ‹åˆ° ${ze} ä¸ªæ–‡æœ¬æ¡†`,"success"),setTimeout(()=>{fe.value=!1},2e3)}catch(ze){console.error("æ‰¹é‡æ£€æµ‹å¤±è´¥:",ze),be("æ‰¹é‡æ£€æµ‹å¤±è´¥","error"),fe.value=!1}}async function Vn(){if(!j.value?.originalDataURL){be("æ²¡æœ‰æœ‰æ•ˆçš„å›¾ç‰‡ç”¨äºç¿»è¯‘","warning");return}if(Ee.value.length===0){be("æ²¡æœ‰æ–‡æœ¬æ¡†å¯ç”¨äºç¿»è¯‘ï¼Œè¯·å…ˆæ£€æµ‹æˆ–æ·»åŠ æ–‡æœ¬æ¡†","warning");return}be("æ­£åœ¨ä½¿ç”¨å½“å‰æ–‡æœ¬æ¡†ç¿»è¯‘...","info");try{await a()&&(be("ç¿»è¯‘æˆåŠŸï¼","success"),Wt())}catch(re){console.error("ç¿»è¯‘å¤±è´¥:",re),be(`ç¿»è¯‘å¤±è´¥: ${re instanceof Error?re.message:"æœªçŸ¥é”™è¯¯"}`,"error")}}function Wn(){$("repair")}function Kn(){$("restore")}function Io(G){B(G)}function Ro(){u()}function qn(G){zt.value=!0,Tn.value=De.value==="horizontal"?G.clientX:G.clientY,document.body.style.cursor=De.value==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",Gt),document.addEventListener("mouseup",Yt),G.preventDefault()}function Gt(G){if(!zt.value)return;const re=he.value?.parentElement?.parentElement;if(!re)return;const de=re.getBoundingClientRect();if(De.value==="horizontal"){const je=G.clientX-de.left,Le=de.width,Pe=Math.max(20,Math.min(80,je/Le*100)),ze=re.querySelector(".original-panel"),Be=re.querySelector(".translated-panel");ze&&Be&&(ze.style.flex=`0 0 ${Pe}%`,Be.style.flex=`0 0 ${100-Pe}%`)}else{const je=G.clientY-de.top,Le=de.height,Pe=Math.max(20,Math.min(80,je/Le*100)),ze=re.querySelector(".original-panel"),Be=re.querySelector(".translated-panel");ze&&Be&&(ze.style.flex=`0 0 ${Pe}%`,Be.style.flex=`0 0 ${100-Pe}%`)}}function Yt(){zt.value=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",Gt),document.removeEventListener("mouseup",Yt)}function Hn(G){Nt.value=!0;const re=Ve.value;re&&($t.value={x:G.clientX,y:G.clientY,size:De.value==="horizontal"?re.offsetWidth:re.offsetHeight},document.body.style.cursor=De.value==="horizontal"?"ew-resize":"ns-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",Xt),document.addEventListener("mouseup",Zt),G.preventDefault())}function Xt(G){if(!(!Nt.value||!Ve.value))if(De.value==="horizontal"){const re=$t.value.x-G.clientX;let de=$t.value.size+re;de=Math.max(300,Math.min(window.innerWidth*.6,de)),Ve.value.style.flex=`0 0 ${de}px`,Ve.value.style.minWidth=`${de}px`}else{const re=$t.value.y-G.clientY;let de=$t.value.size+re;de=Math.max(200,Math.min(window.innerHeight*.5,de)),Ve.value.style.flex=`0 0 ${de}px`,Ve.value.style.height=`${de}px`}}function Zt(){Nt.value=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",Xt),document.removeEventListener("mouseup",Zt)}function Do(G){const re=G.target,de=G.key.toLowerCase();if(de==="r"||de==="u"||de==="a"||de==="d"){if(re.tagName==="TEXTAREA")return;(re.tagName==="INPUT"||re.tagName==="SELECT"||re.tagName==="BUTTON")&&re.blur()}else if(re.tagName==="INPUT"||re.tagName==="TEXTAREA"||re.tagName==="SELECT")return;switch(G.key){case"Escape":Eo();break;case"Delete":case"Backspace":!p.value&&ee.value&&(Z(),G.preventDefault());break;case"a":case"A":p.value||(yo(),G.preventDefault());break;case"d":case"D":p.value||(Kt(),G.preventDefault());break;case"Enter":G.ctrlKey&&!p.value&&(Mo(),G.preventDefault());break;case"r":case"R":I.value||($("repair"),G.preventDefault());break;case"u":case"U":I.value||($("restore"),G.preventDefault());break;case"+":case"=":fo(),G.preventDefault();break;case"-":bo(),G.preventDefault();break;case"0":ho(),G.preventDefault();break}}function Po(G){(G.key==="r"||G.key==="R"||G.key==="u"||G.key==="U")&&(R(),G.preventDefault())}async function Mo(){qt(),await r(),$e.value?Kt():be("å·²æ˜¯æœ€åä¸€å¼ å›¾ç‰‡","info")}function Eo(){qt(),o("exit")}return ut(()=>{try{const G=localStorage.getItem(Wo);(G==="horizontal"||G==="vertical")&&(De.value=G)}catch(G){console.warn("åŠ è½½å¸ƒå±€æ¨¡å¼å¤±è´¥:",G)}document.addEventListener("keydown",Do),document.addEventListener("keyup",Po),document.addEventListener("mousemove",Io),document.addEventListener("mouseup",Ro),n.isEditModeActive&&(Tt(),dt(()=>{ye.value?.focus()}))}),Pt(()=>{document.removeEventListener("keydown",Do),document.removeEventListener("keyup",Po),document.removeEventListener("mousemove",Io),document.removeEventListener("mouseup",Ro),document.removeEventListener("mousemove",jt),document.removeEventListener("mouseup",Jt),document.removeEventListener("mousemove",Gt),document.removeEventListener("mouseup",Yt),document.removeEventListener("mousemove",Xt),document.removeEventListener("mouseup",Zt)}),Ce(()=>n.isEditModeActive,G=>{G&&(Tt(),dt(()=>{ye.value?.focus()}))}),Ce(F,()=>{n.isEditModeActive&&Tt()}),Ce(J,G=>{G&&(ke.value=G.inpaintMethod||"solid",Q.value=G.fillColor||"#FFFFFF")},{immediate:!0}),(G,re)=>s.isEditModeActive?(P(),A("div",{key:0,class:Te(["edit-workspace",[`layout-${De.value}`,{"drawing-mode":V(h)},{"brush-mode-active":!!V(p)}]]),"data-brush-mode":V(p)||void 0,tabindex:"0",ref_key:"workspaceRef",ref:ye},[xe(rv,{"current-image-index":V(F),"image-count":V(le),"can-go-previous":V(_e),"can-go-next":V($e),"show-thumbnails":Re.value,"has-bubbles":V(te),"selected-bubble-index":V(Me),"bubble-count":V(z),"layout-mode":De.value,"sync-enabled":Ge.value,scale:Ot.value,"is-drawing-mode":V(h),"has-selection":V(ee),"brush-mode":V(p),"brush-size":V(g),"mouse-x":V(E),"mouse-y":V(H),"is-processing":fe.value,"progress-text":Ke.value,"progress-current":Ye.value,"progress-total":vt.value,onGoPreviousImage:yo,onGoNextImage:Kt,onToggleThumbnails:Pn,onSelectPreviousBubble:Rn,onSelectNextBubble:Dn,onToggleLayout:Mn,onToggleViewMode:En,onToggleSync:Bn,onFitToScreen:It,onZoomIn:fo,onZoomOut:bo,onResetZoom:ho,onExitEditMode:Eo,onAutoDetectBubbles:zn,onDetectAllImages:Nn,onTranslateWithBubbles:Vn,onToggleDrawingMode:V(Y),onDeleteSelectedBubbles:V(Z),onRepairSelectedBubble:V(d),onActivateRepairBrush:Wn,onActivateRestoreBrush:Kn,onApplyAndNext:Mo},null,8,["current-image-index","image-count","can-go-previous","can-go-next","show-thumbnails","has-bubbles","selected-bubble-index","bubble-count","layout-mode","sync-enabled","scale","is-drawing-mode","has-selection","brush-mode","brush-size","mouse-x","mouse-y","is-processing","progress-text","progress-current","progress-total","onToggleDrawingMode","onDeleteSelectedBubbles","onRepairSelectedBubble"]),xe(vv,{visible:Re.value,images:V(ue),"current-image-index":V(F),onSwitchToImage:In},null,8,["visible","images","current-image-index"]),e("div",bv,[e("div",hv,[ne(e("div",{class:Te(["image-panel original-panel",{collapsed:Oe.value==="translated"||at.value}])},[e("div",yv,[re[8]||(re[8]=e("span",{class:"panel-title"},"ğŸ“– åŸå›¾ (æ—¥æ–‡)",-1)),e("button",{class:"panel-toggle",onClick:re[0]||(re[0]=de=>at.value=!at.value),title:"æŠ˜å /å±•å¼€"},oe(at.value?"+":"âˆ’"),1)]),e("div",{ref_key:"originalViewportRef",ref:he,class:"image-viewport",onWheel:re[2]||(re[2]=et(de=>xo(de,"original"),["prevent"])),onMousedown:re[3]||(re[3]=de=>_o(de,"original")),onDblclick:It},[e("div",{ref_key:"originalWrapperRef",ref:ve,class:"image-canvas-wrapper",style:ot(wn.value)},[V(j)?.originalDataURL?(P(),A("img",{key:0,src:V(j).originalDataURL,alt:"åŸå›¾",onLoad:re[1]||(re[1]=de=>wo("original"))},null,40,xv)):ge("",!0),V(j)?.originalDataURL?(P(),st(on,{key:1,bubbles:V(Ee),"selected-index":V(Me),"selected-indices":V(se),scale:Sn.value,"is-drawing-mode":V(h),"is-brush-mode":!!V(p),"image-width":ce.value,"image-height":me.value,onSelect:V(L),onMultiSelect:V(D),onDragStart:V(w),onDragging:V(W),onDragEnd:V(q),onResizeStart:V(O),onResizing:V(f),onResizeEnd:V(c),onRotateStart:V(k),onRotating:V(C),onRotateEnd:V(N),onDrawBubble:V(ie)},null,8,["bubbles","selected-index","selected-indices","scale","is-drawing-mode","is-brush-mode","image-width","image-height","onSelect","onMultiSelect","onDragStart","onDragging","onDragEnd","onResizeStart","onResizing","onResizeEnd","onRotateStart","onRotating","onRotateEnd","onDrawBubble"])):ge("",!0),V(S)?(P(),A("div",{key:2,class:"drawing-rect-edit",style:ot(V(X)())},null,4)):ge("",!0)],4)],544)],2),[[Fe,Oe.value!=="translated"]]),Oe.value==="dual"?(P(),A("div",{key:0,class:Te(["panel-divider",{"vertical-divider":De.value==="vertical"}]),onMousedown:qn},null,34)):ge("",!0),ne(e("div",{class:Te(["image-panel translated-panel",{collapsed:Oe.value==="original"||it.value}])},[e("div",_v,[re[9]||(re[9]=e("span",{class:"panel-title"},"ğŸ“ ç¿»è¯‘å›¾ (ä¸­æ–‡)",-1)),e("button",{class:"panel-toggle",onClick:re[4]||(re[4]=de=>it.value=!it.value),title:"æŠ˜å /å±•å¼€"},oe(it.value?"+":"âˆ’"),1)]),e("div",{ref_key:"translatedViewportRef",ref:Ie,class:"image-viewport",onWheel:re[6]||(re[6]=et(de=>xo(de,"translated"),["prevent"])),onMousedown:re[7]||(re[7]=de=>_o(de,"translated")),onDblclick:It},[e("div",{ref_key:"translatedWrapperRef",ref:we,class:"image-canvas-wrapper",style:ot($n.value)},[V(j)?.translatedDataURL||V(j)?.originalDataURL?(P(),A("img",{key:0,src:V(j)?.translatedDataURL||V(j)?.originalDataURL,alt:"ç¿»è¯‘å›¾",onLoad:re[5]||(re[5]=de=>wo("translated"))},null,40,Cv)):ge("",!0),V(j)?.translatedDataURL||V(j)?.originalDataURL?(P(),st(on,{key:1,bubbles:V(Ee),"selected-index":V(Me),"selected-indices":V(se),scale:Ot.value,"is-drawing-mode":V(h),"is-brush-mode":!!V(p),"image-width":ce.value,"image-height":me.value,onSelect:V(L),onMultiSelect:V(D),onDragStart:V(w),onDragging:V(W),onDragEnd:V(q),onResizeStart:V(O),onResizing:V(f),onResizeEnd:V(c),onRotateStart:V(k),onRotating:V(C),onRotateEnd:V(N),onDrawBubble:V(ie)},null,8,["bubbles","selected-index","selected-indices","scale","is-drawing-mode","is-brush-mode","image-width","image-height","onSelect","onMultiSelect","onDragStart","onDragging","onDragEnd","onResizeStart","onResizing","onResizeEnd","onRotateStart","onRotating","onRotateEnd","onDrawBubble"])):ge("",!0),V(S)?(P(),A("div",{key:2,class:"drawing-rect-edit translated-drawing-rect",style:ot(V(X)())},null,4)):ge("",!0)],4)],544)],2),[[Fe,Oe.value!=="original"]])]),e("div",{ref_key:"editPanelRef",ref:Ve,class:"edit-panel-container"},[e("div",{class:"panel-resize-handle vertical",onMousedown:Hn}," â‹®â‹®â‹® ",32),xe(Bm,{bubble:V(J),"bubble-index":V(Me),onUpdate:Ln,onReRender:An,onOcrRecognize:V(m),onReTranslate:On,onApplyBubble:Fn,onResetCurrent:Un},null,8,["bubble","bubble-index","onOcrRecognize"])],512)])],10,fv)):ge("",!0)}}),Sv=qe(kv,[["__scopeId","data-v-7cf83f19"]]),wt="/api/web-import";async function wv(s){return(await fetch(`${wt}/check-support?url=${encodeURIComponent(s)}`)).json()}async function $v(){return(await fetch(`${wt}/gallery-dl-images`)).json()}async function Tv(s,t,n,o,l,i="auto",a){const r=await fetch(`${wt}/extract`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:s,config:t,engine:i})});if(!r.ok){const M=await r.json().catch(()=>({error:"è¯·æ±‚å¤±è´¥"}));l(M.error||`HTTP ${r.status}`);return}const h=r.body?.getReader();if(!h){l("æ— æ³•è¯»å–å“åº”æµ");return}const T=new TextDecoder;let S="";try{for(;;){const{done:M,value:L}=await h.read();if(M)break;S+=T.decode(L,{stream:!0});const D=S.split(`
`);S=D.pop()||"";let U="",w="";for(const W of D)if(W.startsWith("event:"))U=W.slice(6).trim();else if(W.startsWith("data:"))w=W.slice(5).trim();else if(W===""&&U&&w){try{const q=JSON.parse(w);U==="log"?n(q):U==="page"?a&&a(q):U==="result"?o(q):U==="error"&&l(q.error||"æœªçŸ¥é”™è¯¯")}catch(q){console.error("è§£æ SSE æ•°æ®å¤±è´¥:",q)}U="",w=""}}}finally{h.releaseLock()}}async function Iv(s,t,n,o="ai-agent"){const l=await fetch(`${wt}/download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pages:s,sourceUrl:t,config:n,engine:o})});if(!l.ok){const i=await l.json().catch(()=>({error:"è¯·æ±‚å¤±è´¥"}));throw new Error(i.error||`HTTP ${l.status}`)}return l.json()}async function Rv(s){return(await fetch(`${wt}/test-firecrawl`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:s})})).json()}async function Dv(s,t,n,o){return(await fetch(`${wt}/test-agent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:s,apiKey:t,customBaseUrl:n,modelName:o})})).json()}const Pv={class:"modal-container"},Mv={class:"modal-body"},Ev={class:"url-section"},Bv=["disabled"],Av=["disabled"],Lv=["disabled"],Fv={key:0,class:"loading-spinner"},Uv={key:1},Ov={key:0,class:"engine-hint"},zv={key:0,class:"hint-checking"},Nv={key:1,class:"hint-supported"},Vv={key:2,class:"hint-unsupported"},Wv={class:"settings-section"},Kv={class:"settings-toggle"},qv={key:0,class:"settings-content"},Hv={class:"settings-tabs"},jv={class:"settings-tab-content"},Jv={class:"settings-group"},Gv={class:"form-row"},Yv={class:"input-group"},Xv=["type","value"],Zv=["disabled"],Qv={class:"settings-group"},ef={class:"form-row"},tf=["value"],of=["value"],nf={class:"form-row"},sf={class:"input-group"},af=["type","value"],lf={key:0,class:"form-row"},rf=["value"],uf={class:"form-row"},cf=["value"],df={class:"form-row inline"},gf={class:"checkbox-label"},pf=["checked"],mf={class:"checkbox-label"},vf=["checked"],ff={class:"form-row"},bf=["disabled"],hf={class:"settings-group"},yf={class:"form-row"},xf=["value"],_f={class:"form-row"},Cf=["value"],kf={class:"settings-group"},Sf={class:"form-grid"},wf={class:"form-row"},$f=["value"],Tf={class:"form-row"},If=["value"],Rf={class:"form-row"},Df=["value"],Pf={class:"form-row"},Mf=["value"],Ef={class:"form-row"},Bf={class:"checkbox-label"},Af=["checked"],Lf={class:"settings-group"},Ff={class:"form-row inline"},Uf={class:"checkbox-label"},Of=["checked"],zf={class:"checkbox-label"},Nf=["checked"],Vf={class:"settings-tab-content"},Wf={class:"settings-group"},Kf={class:"form-row"},qf={class:"checkbox-label"},Hf=["checked"],jf={class:"form-row"},Jf={class:"checkbox-label"},Gf=["checked"],Yf={class:"form-row"},Xf={class:"checkbox-label"},Zf=["checked"],Qf={key:0,class:"form-grid"},eb={class:"form-row"},tb=["value"],ob={class:"form-row"},nb=["value"],sb={class:"form-row"},ab=["value"],lb={class:"form-row"},ib={class:"checkbox-label"},rb=["checked"],ub={key:1,class:"form-row"},cb=["value"],db={class:"settings-tab-content"},gb={class:"settings-group"},pb={class:"form-row"},mb=["value"],vb={class:"form-row"},fb=["value"],bb={class:"form-row"},hb={class:"checkbox-label"},yb=["checked"],xb={key:1,class:"logs-section"},_b={class:"logs-toggle"},Cb={key:0,class:"extracting-hint"},kb={key:0,class:"logs-content"},Sb={class:"log-time"},wb={class:"log-message"},$b={key:2,class:"error-section"},Tb={class:"error-message"},Ib={key:3,class:"result-section"},Rb={class:"result-header"},Db={class:"result-title"},Pb={class:"result-meta"},Mb={class:"result-count"},Eb={key:0,class:"result-engine"},Bb={class:"select-control"},Ab={class:"select-all"},Lb=["checked"],Fb={class:"selected-count"},Ub={class:"image-grid"},Ob=["onClick"],zb={class:"image-checkbox"},Nb=["checked","onChange"],Vb={class:"image-preview"},Wb=["src","alt"],Kb={class:"image-label"},qb={key:4,class:"progress-section"},Hb={class:"progress-label"},jb={class:"progress-bar"},Jb={class:"modal-footer"},Gb=["disabled"],Yb=["disabled"],Xb={key:0,class:"loading-spinner"},Zb={key:1},Qb=He({__name:"WebImportModal",setup(s){const t=po(),n=Qe(),o=_(""),l=_(!0),i=_("auto"),a=_(!1),r=_(!1),h=_(!1),T=_(!1),S=_("basic"),M=_(!1),L=_(!1),D=_(!1),U=_(!1),w=K(()=>t.modalVisible),W=K(()=>t.status),q=K(()=>t.logs),O=K(()=>t.extractResult),f=K(()=>t.selectedPages),c=K(()=>t.selectedCount),k=K(()=>t.downloadProgress),C=K(()=>t.downloadProgressPercent),N=K(()=>t.error),Y=K(()=>t.isProcessing),ie=K(()=>t.settings.ui.showAgentLogs),X=K(()=>O.value?.engine||null),ae=K(()=>{switch(X.value){case"gallery-dl":return"Gallery-DL";case"ai-agent":return"AI Agent";default:return""}}),Z=K(()=>O.value?.pages?c.value===O.value.pages.length:!1);function d(B){return X.value==="gallery-dl",B}let m=null;async function x(B){if(m&&clearTimeout(m),!B.trim()){a.value=!1,r.value=!1;return}m=setTimeout(async()=>{h.value=!0;try{const u=await wv(B);a.value=u.available,r.value=u.supported}catch{a.value=!1,r.value=!1}finally{h.value=!1}},500)}function b(){Y.value&&!confirm("æ­£åœ¨å¤„ç†ä¸­ï¼Œç¡®å®šè¦å…³é—­å—ï¼Ÿ")||(t.closeModal(),t.resetState(),o.value="")}async function p(){const B=o.value.trim();if(!B){alert("è¯·è¾“å…¥ç½‘å€");return}try{new URL(B)}catch{alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€");return}t.resetState(),t.setUrl(B),t.setStatus("extracting");try{await Tv(B,t.settings,u=>{t.addLog(u)},u=>{t.setExtractResult(u),u.success?t.setStatus("extracted"):t.setError(u.error||"æå–å¤±è´¥")},u=>{t.setError(u)},i.value,u=>{t.addPageIncremental(u)})}catch(u){t.setError(u instanceof Error?u.message:"æå–å¤±è´¥")}}function g(B){t.togglePageSelection(B)}function E(){t.toggleSelectAll()}async function H(){if(!O.value?.pages||c.value===0){alert("è¯·é€‰æ‹©è¦å¯¼å…¥çš„å›¾ç‰‡");return}const B=O.value.pages.filter(y=>f.value.has(y.pageNumber));t.setStatus("downloading"),t.updateDownloadProgress(0,B.length);const u=X.value||"ai-agent";try{if(u==="gallery-dl"){const ue=await $v();if(ue.success&&ue.images.length>0){let F=0;const j=Math.min(ue.images.length,B.length);for(let le=0;le<j;le++){const _e=ue.images[le];_e&&_e.filename&&_e.data&&(n.addImage(_e.filename,_e.data),F++,t.updateDownloadProgress(F,j))}t.setStatus("completed"),alert(`æˆåŠŸå¯¼å…¥ ${F} å¼ å›¾ç‰‡`),b();return}else throw new Error(ue.error||"è·å–å›¾ç‰‡å¤±è´¥")}const y=await Iv(B,O.value.sourceUrl,t.settings,u);if(y.success&&y.images.length>0){t.setDownloadedImages(y.images),t.updateDownloadProgress(y.images.length,B.length);for(const F of y.images)n.addImage(F.filename,F.dataUrl);t.setStatus("completed");const ue=y.failedCount>0?`ï¼Œ${y.failedCount} å¼ å¤±è´¥`:"";alert(`æˆåŠŸå¯¼å…¥ ${y.images.length} å¼ å›¾ç‰‡${ue}`),b()}else t.setError(y.error||"ä¸‹è½½å¤±è´¥")}catch(y){t.setError(y instanceof Error?y.message:"ä¸‹è½½å¤±è´¥")}}Ce(w,B=>{B&&setTimeout(()=>{document.querySelector(".url-input")?.focus()},100)}),Ce(o,B=>{x(B)});const I=K(()=>t.settings.agent.provider==="custom_openai");async function $(){if(!t.settings.firecrawl.apiKey){alert("è¯·è¾“å…¥ Firecrawl API Key");return}M.value=!0;try{const B=await Rv(t.settings.firecrawl.apiKey);B.success?alert("âœ… Firecrawl è¿æ¥æˆåŠŸ"):alert(`âŒ è¿æ¥å¤±è´¥: ${B.error}`)}catch(B){alert(`âŒ è¿æ¥å¤±è´¥: ${B instanceof Error?B.message:"æœªçŸ¥é”™è¯¯"}`)}finally{M.value=!1}}async function R(){if(!t.settings.agent.apiKey){alert("è¯·è¾“å…¥ AI Agent API Key");return}L.value=!0;try{const B=await Dv(t.settings.agent.provider,t.settings.agent.apiKey,t.settings.agent.customBaseUrl,t.settings.agent.modelName);B.success?alert("âœ… AI Agent è¿æ¥æˆåŠŸ"):alert(`âŒ è¿æ¥å¤±è´¥: ${B.error}`)}catch(B){alert(`âŒ è¿æ¥å¤±è´¥: ${B instanceof Error?B.message:"æœªçŸ¥é”™è¯¯"}`)}finally{L.value=!1}}function v(){confirm("ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯å—ï¼Ÿ")&&t.resetExtractionPrompt()}return(B,u)=>(P(),st(rn,{to:"body"},[w.value?(P(),A("div",{key:0,class:"modal-overlay",onClick:et(b,["self"])},[e("div",Pv,[e("div",{class:"modal-header"},[u[37]||(u[37]=e("h2",{class:"modal-title"},[e("span",{class:"title-icon"},"ğŸŒ"),pe(" ä»ç½‘é¡µå¯¼å…¥æ¼«ç”» ")],-1)),e("button",{class:"close-btn",onClick:b,title:"å…³é—­"},"Ã—")]),e("div",Mv,[e("div",Ev,[ne(e("input",{"onUpdate:modelValue":u[0]||(u[0]=y=>o.value=y),type:"url",class:"url-input",placeholder:"è¾“å…¥æ¼«ç”»ç½‘é¡µ URLï¼Œå¦‚ https://example.com/chapter-1",disabled:Y.value,onKeyup:ln(p,["enter"])},null,40,Bv),[[Se,o.value]]),ne(e("select",{"onUpdate:modelValue":u[1]||(u[1]=y=>i.value=y),class:"engine-select",disabled:Y.value},[...u[38]||(u[38]=[e("option",{value:"auto"},"è‡ªåŠ¨é€‰æ‹©",-1),e("option",{value:"gallery-dl"},"Gallery-DL",-1),e("option",{value:"ai-agent"},"AI Agent",-1)])],8,Av),[[ts,i.value]]),e("button",{class:"extract-btn",disabled:Y.value||!o.value.trim(),onClick:p},[W.value==="extracting"?(P(),A("span",Fv)):(P(),A("span",Uv,"ğŸ”")),pe(" "+oe(W.value==="extracting"?"æå–ä¸­...":"å¼€å§‹æå–"),1)],8,Lv)]),o.value.trim()&&!Y.value?(P(),A("div",Ov,[h.value?(P(),A("span",zv,"æ£€æŸ¥ä¸­...")):r.value?(P(),A("span",Nv,"âœ“ è¯¥ç½‘ç«™æ”¯æŒ Gallery-DL é«˜é€Ÿä¸‹è½½")):a.value?(P(),A("span",Vv,"è¯¥ç½‘ç«™å°†ä½¿ç”¨ AI Agent æ¨¡å¼")):ge("",!0)])):ge("",!0),u[80]||(u[80]=e("div",{class:"notice"}," âš ï¸ è¯·ä»…çˆ¬å–æ‚¨æœ‰æƒè®¿é—®çš„å†…å®¹ï¼Œå¹¶éµå®ˆç›®æ ‡ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾ã€‚ ",-1)),e("div",Wv,[e("div",{class:"settings-header",onClick:u[2]||(u[2]=y=>T.value=!T.value)},[e("span",Kv,oe(T.value?"â–¼":"â–¶"),1),u[39]||(u[39]=e("span",{class:"settings-title"},"âš™ï¸ è®¾ç½®",-1)),u[40]||(u[40]=e("span",{class:"settings-hint"},"ç‚¹å‡»å±•å¼€é…ç½®",-1))]),T.value?(P(),A("div",qv,[e("div",Hv,[e("button",{class:Te(["settings-tab",{active:S.value==="basic"}]),onClick:u[3]||(u[3]=y=>S.value="basic")}," åŸºæœ¬è®¾ç½® ",2),e("button",{class:Te(["settings-tab",{active:S.value==="preprocess"}]),onClick:u[4]||(u[4]=y=>S.value="preprocess")}," å›¾ç‰‡é¢„å¤„ç† ",2),e("button",{class:Te(["settings-tab",{active:S.value==="advanced"}]),onClick:u[5]||(u[5]=y=>S.value="advanced")}," é«˜çº§è®¾ç½® ",2)]),ne(e("div",jv,[e("div",Jv,[u[42]||(u[42]=e("h4",{class:"group-title"},"Firecrawl é…ç½®",-1)),e("div",Gv,[u[41]||(u[41]=e("label",{class:"form-label"},"API Key",-1)),e("div",Yv,[e("input",{type:D.value?"text":"password",class:"form-input",value:V(t).settings.firecrawl.apiKey,onInput:u[6]||(u[6]=y=>V(t).setFirecrawlApiKey(y.target.value)),placeholder:"fc-xxxxxxxxxxxxxxxx"},null,40,Xv),e("button",{class:"toggle-btn",onClick:u[7]||(u[7]=y=>D.value=!D.value)},oe(D.value?"ğŸ‘":"ğŸ‘â€ğŸ—¨"),1),e("button",{class:"test-btn",disabled:M.value||!V(t).settings.firecrawl.apiKey,onClick:$},oe(M.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,Zv)])])]),e("div",Qv,[u[49]||(u[49]=e("h4",{class:"group-title"},"AI Agent é…ç½®",-1)),e("div",ef,[u[43]||(u[43]=e("label",{class:"form-label"},"æœåŠ¡å•†",-1)),e("select",{class:"form-select",value:V(t).settings.agent.provider,onChange:u[8]||(u[8]=y=>V(t).setAgentProvider(y.target.value))},[(P(!0),A(Ae,null,Je(V(Qn),y=>(P(),A("option",{key:y.value,value:y.value},oe(y.label),9,of))),128))],40,tf)]),e("div",nf,[u[44]||(u[44]=e("label",{class:"form-label"},"API Key",-1)),e("div",sf,[e("input",{type:U.value?"text":"password",class:"form-input",value:V(t).settings.agent.apiKey,onInput:u[9]||(u[9]=y=>V(t).setAgentApiKey(y.target.value)),placeholder:"sk-xxxxxxxxxxxxxxxx"},null,40,af),e("button",{class:"toggle-btn",onClick:u[10]||(u[10]=y=>U.value=!U.value)},oe(U.value?"ğŸ‘":"ğŸ‘â€ğŸ—¨"),1)])]),I.value?(P(),A("div",lf,[u[45]||(u[45]=e("label",{class:"form-label"},"è‡ªå®šä¹‰ API åœ°å€",-1)),e("input",{type:"url",class:"form-input",value:V(t).settings.agent.customBaseUrl,onInput:u[11]||(u[11]=y=>V(t).setAgentBaseUrl(y.target.value)),placeholder:"https://api.example.com/v1"},null,40,rf)])):ge("",!0),e("div",uf,[u[46]||(u[46]=e("label",{class:"form-label"},"æ¨¡å‹åç§°",-1)),e("input",{type:"text",class:"form-input",value:V(t).settings.agent.modelName,onInput:u[12]||(u[12]=y=>V(t).setAgentModelName(y.target.value)),placeholder:"gpt-4o-mini"},null,40,cf)]),e("div",df,[e("label",gf,[e("input",{type:"checkbox",checked:V(t).settings.agent.forceJsonOutput,onChange:u[13]||(u[13]=y=>V(t).setAgentForceJson(y.target.checked))},null,40,pf),u[47]||(u[47]=pe(" å¼ºåˆ¶ JSON æ ¼å¼ ",-1))]),e("label",mf,[e("input",{type:"checkbox",checked:V(t).settings.agent.useStream,onChange:u[14]||(u[14]=y=>V(t).setAgentUseStream(y.target.checked))},null,40,vf),u[48]||(u[48]=pe(" æµå¼è°ƒç”¨ ",-1))])]),e("div",ff,[e("button",{class:"test-btn full",disabled:L.value||!V(t).settings.agent.apiKey,onClick:R},oe(L.value?"æµ‹è¯•ä¸­...":"æµ‹è¯• Agent è¿æ¥"),9,bf)])]),e("div",hf,[e("h4",{class:"group-title"},[u[50]||(u[50]=pe(" æå–è®¾ç½® ",-1)),e("button",{class:"reset-btn",onClick:v},"é‡ç½®ä¸ºé»˜è®¤")]),e("div",yf,[u[51]||(u[51]=e("label",{class:"form-label"},"æå–æç¤ºè¯",-1)),e("textarea",{class:"form-textarea",value:V(t).settings.extraction.prompt,onInput:u[15]||(u[15]=y=>V(t).setExtractionPrompt(y.target.value)),rows:"6",placeholder:"è¾“å…¥æå–æç¤ºè¯..."},null,40,xf)]),e("div",_f,[u[52]||(u[52]=e("label",{class:"form-label"},"æœ€å¤§è¿­ä»£æ¬¡æ•°",-1)),e("input",{type:"number",class:"form-input small",value:V(t).settings.extraction.maxIterations,onInput:u[16]||(u[16]=y=>V(t).setExtractionMaxIterations(Number(y.target.value))),min:"1",max:"20"},null,40,Cf)])]),e("div",kf,[u[58]||(u[58]=e("h4",{class:"group-title"},"ä¸‹è½½è®¾ç½®",-1)),e("div",Sf,[e("div",wf,[u[53]||(u[53]=e("label",{class:"form-label"},"å¹¶å‘æ•°",-1)),e("input",{type:"number",class:"form-input small",value:V(t).settings.download.concurrency,onInput:u[17]||(u[17]=y=>V(t).setDownloadConcurrency(Number(y.target.value))),min:"1",max:"10"},null,40,$f)]),e("div",Tf,[u[54]||(u[54]=e("label",{class:"form-label"},"è¶…æ—¶ (ç§’)",-1)),e("input",{type:"number",class:"form-input small",value:V(t).settings.download.timeout,onInput:u[18]||(u[18]=y=>V(t).setDownloadTimeout(Number(y.target.value))),min:"5",max:"120"},null,40,If)]),e("div",Rf,[u[55]||(u[55]=e("label",{class:"form-label"},"é‡è¯•æ¬¡æ•°",-1)),e("input",{type:"number",class:"form-input small",value:V(t).settings.download.retries,onInput:u[19]||(u[19]=y=>V(t).setDownloadRetries(Number(y.target.value))),min:"0",max:"5"},null,40,Df)]),e("div",Pf,[u[56]||(u[56]=e("label",{class:"form-label"},"ä¸‹è½½é—´éš” (ms)",-1)),e("input",{type:"number",class:"form-input small",value:V(t).settings.download.delay,onInput:u[20]||(u[20]=y=>V(t).setDownloadDelay(Number(y.target.value))),min:"0",max:"2000",step:"100"},null,40,Mf)])]),e("div",Ef,[e("label",Bf,[e("input",{type:"checkbox",checked:V(t).settings.download.useReferer,onChange:u[21]||(u[21]=y=>V(t).setDownloadUseReferer(y.target.checked))},null,40,Af),u[57]||(u[57]=pe(" è‡ªåŠ¨æ·»åŠ  Referer ",-1))])])]),e("div",Lf,[u[61]||(u[61]=e("h4",{class:"group-title"},"ç•Œé¢è®¾ç½®",-1)),e("div",Ff,[e("label",Uf,[e("input",{type:"checkbox",checked:V(t).settings.ui.showAgentLogs,onChange:u[22]||(u[22]=y=>V(t).setShowAgentLogs(y.target.checked))},null,40,Of),u[59]||(u[59]=pe(" æ˜¾ç¤º AI å·¥ä½œæ—¥å¿— ",-1))]),e("label",zf,[e("input",{type:"checkbox",checked:V(t).settings.ui.autoImport,onChange:u[23]||(u[23]=y=>V(t).setAutoImport(y.target.checked))},null,40,Nf),u[60]||(u[60]=pe(" æå–åè‡ªåŠ¨å¯¼å…¥ ",-1))])])])],512),[[Fe,S.value==="basic"]]),ne(e("div",Vf,[e("div",Wf,[e("div",Kf,[e("label",qf,[e("input",{type:"checkbox",checked:V(t).settings.imagePreprocess.enabled,onChange:u[24]||(u[24]=y=>V(t).setImagePreprocessEnabled(y.target.checked))},null,40,Hf),u[62]||(u[62]=pe(" å¯ç”¨å›¾ç‰‡é¢„å¤„ç† ",-1))])]),V(t).settings.imagePreprocess.enabled?(P(),A(Ae,{key:0},[e("div",jf,[e("label",Jf,[e("input",{type:"checkbox",checked:V(t).settings.imagePreprocess.autoRotate,onChange:u[25]||(u[25]=y=>V(t).setImageAutoRotate(y.target.checked))},null,40,Gf),u[63]||(u[63]=pe(" æ ¹æ® EXIF è‡ªåŠ¨æ—‹è½¬ ",-1))])]),u[71]||(u[71]=e("h5",{class:"subsection-title"},"å‹ç¼©è®¾ç½®",-1)),e("div",Yf,[e("label",Xf,[e("input",{type:"checkbox",checked:V(t).settings.imagePreprocess.compression.enabled,onChange:u[26]||(u[26]=y=>V(t).setImageCompressionEnabled(y.target.checked))},null,40,Zf),u[64]||(u[64]=pe(" å¯ç”¨å‹ç¼© ",-1))])]),V(t).settings.imagePreprocess.compression.enabled?(P(),A("div",Qf,[e("div",eb,[u[65]||(u[65]=e("label",{class:"form-label"},"è´¨é‡ (0-100)",-1)),e("input",{type:"number",class:"form-input small",value:V(t).settings.imagePreprocess.compression.quality,onInput:u[27]||(u[27]=y=>V(t).setImageCompressionQuality(Number(y.target.value))),min:"1",max:"100"},null,40,tb)]),e("div",ob,[u[66]||(u[66]=e("label",{class:"form-label"},"æœ€å¤§å®½åº¦ (0=ä¸é™)",-1)),e("input",{type:"number",class:"form-input small",value:V(t).settings.imagePreprocess.compression.maxWidth,onInput:u[28]||(u[28]=y=>V(t).setImageMaxWidth(Number(y.target.value))),min:"0"},null,40,nb)]),e("div",sb,[u[67]||(u[67]=e("label",{class:"form-label"},"æœ€å¤§é«˜åº¦ (0=ä¸é™)",-1)),e("input",{type:"number",class:"form-input small",value:V(t).settings.imagePreprocess.compression.maxHeight,onInput:u[29]||(u[29]=y=>V(t).setImageMaxHeight(Number(y.target.value))),min:"0"},null,40,ab)])])):ge("",!0),u[72]||(u[72]=e("h5",{class:"subsection-title"},"æ ¼å¼è½¬æ¢",-1)),e("div",lb,[e("label",ib,[e("input",{type:"checkbox",checked:V(t).settings.imagePreprocess.formatConvert.enabled,onChange:u[30]||(u[30]=y=>V(t).setImageFormatConvertEnabled(y.target.checked))},null,40,rb),u[68]||(u[68]=pe(" å¯ç”¨æ ¼å¼è½¬æ¢ ",-1))])]),V(t).settings.imagePreprocess.formatConvert.enabled?(P(),A("div",ub,[u[70]||(u[70]=e("label",{class:"form-label"},"ç›®æ ‡æ ¼å¼",-1)),e("select",{class:"form-select",value:V(t).settings.imagePreprocess.formatConvert.targetFormat,onChange:u[31]||(u[31]=y=>V(t).setImageTargetFormat(y.target.value))},[...u[69]||(u[69]=[e("option",{value:"original"},"ä¿æŒåŸæ ¼å¼",-1),e("option",{value:"jpeg"},"JPEG",-1),e("option",{value:"png"},"PNG",-1),e("option",{value:"webp"},"WebP",-1)])],40,cb)])):ge("",!0)],64)):ge("",!0)])],512),[[Fe,S.value==="preprocess"]]),ne(e("div",db,[e("div",gb,[u[76]||(u[76]=e("h4",{class:"group-title"},"è‡ªå®šä¹‰è¯·æ±‚å¤´",-1)),e("div",pb,[u[73]||(u[73]=e("label",{class:"form-label"},"Cookie",-1)),e("input",{type:"text",class:"form-input",value:V(t).settings.advanced.customCookie,onInput:u[32]||(u[32]=y=>V(t).setCustomCookie(y.target.value)),placeholder:"name=value; name2=value2"},null,40,mb)]),e("div",vb,[u[74]||(u[74]=e("label",{class:"form-label"},"Headers (JSON)",-1)),e("textarea",{class:"form-textarea",value:V(t).settings.advanced.customHeaders,onInput:u[33]||(u[33]=y=>V(t).setCustomHeaders(y.target.value)),rows:"3",placeholder:'{"X-Custom-Header": "value"}'},null,40,fb)]),e("div",bb,[e("label",hb,[e("input",{type:"checkbox",checked:V(t).settings.advanced.bypassProxy,onChange:u[34]||(u[34]=y=>V(t).setBypassProxy(y.target.checked))},null,40,yb),u[75]||(u[75]=pe(" ç»•è¿‡ç³»ç»Ÿä»£ç† (è¿æ¥æœ¬åœ°æœåŠ¡æ—¶ä½¿ç”¨) ",-1))])])])],512),[[Fe,S.value==="advanced"]])])):ge("",!0)]),ie.value&&q.value.length>0?(P(),A("div",xb,[e("div",{class:"logs-header",onClick:u[35]||(u[35]=y=>l.value=!l.value)},[e("span",_b,oe(l.value?"â–¼":"â–¶"),1),u[77]||(u[77]=e("span",null,"AI å·¥ä½œæ—¥å¿—",-1)),W.value==="extracting"?(P(),A("span",Cb,"(æå–ä¸­...)")):ge("",!0)]),l.value?(P(),A("div",kb,[(P(!0),A(Ae,null,Je(q.value,(y,ue)=>(P(),A("div",{key:ue,class:Te(["log-item",`log-${y.type}`])},[e("span",Sb,"["+oe(y.timestamp)+"]",1),e("span",wb,oe(y.message),1)],2))),128))])):ge("",!0)])):ge("",!0),N.value?(P(),A("div",$b,[u[78]||(u[78]=e("span",{class:"error-icon"},"âŒ",-1)),e("span",Tb,oe(N.value),1)])):ge("",!0),O.value?.success?(P(),A("div",Ib,[e("div",Rb,[e("span",Db," ğŸ“– ã€Š"+oe(O.value.comicTitle)+"ã€‹- "+oe(O.value.chapterTitle),1),e("span",Pb,[e("span",Mb,"å…± "+oe(O.value.totalPages)+" å¼ ",1),ae.value?(P(),A("span",Eb,"| å¼•æ“: "+oe(ae.value),1)):ge("",!0)])]),e("div",Bb,[e("label",Ab,[e("input",{type:"checkbox",checked:Z.value,onChange:E},null,40,Lb),u[79]||(u[79]=pe(" å…¨é€‰ ",-1))]),e("span",Fb,"å·²é€‰: "+oe(c.value)+" å¼ ",1)]),e("div",Ub,[(P(!0),A(Ae,null,Je(O.value.pages,y=>(P(),A("div",{key:y.pageNumber,class:Te(["image-item",{selected:f.value.has(y.pageNumber)}]),onClick:ue=>g(y.pageNumber)},[e("div",zb,[e("input",{type:"checkbox",checked:f.value.has(y.pageNumber),onClick:u[36]||(u[36]=et(()=>{},["stop"])),onChange:ue=>g(y.pageNumber)},null,40,Nb)]),e("div",Vb,[e("img",{src:d(y.imageUrl),alt:`ç¬¬${y.pageNumber}é¡µ`,loading:"lazy"},null,8,Wb)]),e("div",Kb,"ç¬¬ "+oe(y.pageNumber)+" é¡µ",1)],10,Ob))),128))])])):ge("",!0),W.value==="downloading"?(P(),A("div",qb,[e("div",Hb," ä¸‹è½½è¿›åº¦: "+oe(k.value.current)+"/"+oe(k.value.total),1),e("div",jb,[e("div",{class:"progress-fill",style:ot({width:`${C.value}%`})},null,4)])])):ge("",!0)]),e("div",Jb,[e("button",{class:"cancel-btn",onClick:b,disabled:W.value==="downloading"}," å–æ¶ˆ ",8,Gb),e("button",{class:"import-btn",disabled:!O.value?.success||c.value===0||Y.value,onClick:H},[W.value==="downloading"?(P(),A("span",Xb)):(P(),A("span",Zb,"ğŸ“¥")),pe(" "+oe(W.value==="downloading"?"ä¸‹è½½ä¸­...":"å¯¼å…¥"),1)],8,Yb)])])])):ge("",!0)]))}}),eh=qe(Qb,[["__scopeId","data-v-78fc5cb0"]]),th={class:"disclaimer-container"},oh={class:"disclaimer-content"},nh={class:"confirmation-area"},sh=["placeholder"],ah={key:0,class:"input-error"},lh={class:"disclaimer-footer"},ih=["disabled"],Ft="æˆ‘å·²é˜…è¯»å¹¶åŒæ„",rh=He({__name:"WebImportDisclaimer",setup(s){const t=po(),n=_(""),o=K(()=>t.disclaimerVisible),l=K(()=>n.value.trim()===Ft);function i(){l.value&&(t.acceptDisclaimer(),n.value="")}function a(){t.rejectDisclaimer(),n.value=""}return(r,h)=>(P(),st(rn,{to:"body"},[o.value?(P(),A("div",{key:0,class:"disclaimer-overlay",onClick:et(a,["self"])},[e("div",th,[h[3]||(h[3]=e("div",{class:"disclaimer-header"},[e("span",{class:"warning-icon"},"âš ï¸"),e("h2",{class:"disclaimer-title"},"é‡è¦å…è´£å£°æ˜")],-1)),e("div",oh,[h[2]||(h[2]=e("div",{class:"disclaimer-text"},[e("h3",null,"ğŸ“œ ä½¿ç”¨æ¡æ¬¾ä¸æ³•å¾‹å£°æ˜"),e("div",{class:"section"},[e("h4",null,"1. åŠŸèƒ½è¯´æ˜"),e("p",null,[pe(' "ä»ç½‘é¡µå¯¼å…¥"åŠŸèƒ½å…è®¸æ‚¨ä»äº’è”ç½‘ç½‘é¡µä¸­æå–å›¾ç‰‡ã€‚æ­¤åŠŸèƒ½ä»…ä¾›'),e("strong",null,"æŠ€æœ¯ç ”ç©¶ä¸ä¸ªäººå­¦ä¹ "),pe("ä¹‹ç›®çš„æä¾›ã€‚ ")])]),e("div",{class:"section"},[e("h4",null,"2. ç”¨æˆ·è´£ä»»"),e("ul",null,[e("li",null,[pe("æ‚¨åº”å½“ç¡®ä¿æ‹¥æœ‰"),e("strong",null,"åˆæ³•æƒåˆ©"),pe("è®¿é—®å’Œä¸‹è½½ç›®æ ‡å†…å®¹")]),e("li",null,[pe("æ‚¨åº”å½“éµå®ˆç›®æ ‡ç½‘ç«™çš„"),e("strong",null,"æœåŠ¡æ¡æ¬¾"),pe("å’Œ"),e("strong",null,"ä½¿ç”¨åè®®")]),e("li",null,[pe("æ‚¨åº”å½“å°Šé‡å†…å®¹åˆ›ä½œè€…çš„"),e("strong",null,"ç‰ˆæƒ"),pe("å’Œ"),e("strong",null,"çŸ¥è¯†äº§æƒ")]),e("li",null,[pe("æ‚¨"),e("strong",null,"ä¸å¾—"),pe("å°†ä¸‹è½½çš„å†…å®¹ç”¨äºå•†ä¸šç›®çš„æˆ–éæ³•ä¼ æ’­")]),e("li",null,[pe("æ‚¨"),e("strong",null,"ä¸å¾—"),pe("ä½¿ç”¨æœ¬åŠŸèƒ½ç»•è¿‡ä»˜è´¹å†…å®¹çš„è®¿é—®é™åˆ¶")])])]),e("div",{class:"section"},[e("h4",null,"3. ä½¿ç”¨é™åˆ¶"),e("p",null,[pe("æœ¬åŠŸèƒ½"),e("strong",null,"ä¸¥ç¦"),pe("ç”¨äºä»¥ä¸‹ç›®çš„ï¼š")]),e("ul",null,[e("li",null,[pe("ä¸‹è½½ã€å­˜å‚¨æˆ–ä¼ æ’­"),e("strong",null,"ä¾µæƒå†…å®¹")]),e("li",null,[pe("ç»•è¿‡ç½‘ç«™çš„"),e("strong",null,"ä»˜è´¹å¢™"),pe("æˆ–"),e("strong",null,"è®¿é—®æ§åˆ¶")]),e("li",null,[pe("è¿›è¡Œ"),e("strong",null,"å•†ä¸šç”¨é€”"),pe("æˆ–å¤§è§„æ¨¡"),e("strong",null,"æ‰¹é‡çˆ¬å–")]),e("li",null,[pe("ä»»ä½•è¿å"),e("strong",null,"å½“åœ°æ³•å¾‹æ³•è§„"),pe("çš„æ´»åŠ¨")]),e("li",null,[pe("å¯¹ç›®æ ‡ç½‘ç«™é€ æˆ"),e("strong",null,"æœåŠ¡å™¨è´Ÿæ‹…"),pe("æˆ–"),e("strong",null,"æ¶æ„æ”»å‡»")])])]),e("div",{class:"section"},[e("h4",null,"4. å…è´£æ¡æ¬¾"),e("p",null,[pe(" æœ¬è½¯ä»¶ä½œè€…åŠè´¡çŒ®è€…"),e("strong",null,"ä¸å¯¹æ‚¨ä½¿ç”¨æœ¬åŠŸèƒ½æ‰€å¯¼è‡´çš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥åæœæ‰¿æ‹…è´£ä»»"),pe("ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š ")]),e("ul",null,[e("li",null,"å› ä¾µçŠ¯ç‰ˆæƒè€Œäº§ç”Ÿçš„æ³•å¾‹è´£ä»»"),e("li",null,"å› è¿åæœåŠ¡æ¡æ¬¾è€Œå¯¼è‡´çš„è´¦å·å°ç¦"),e("li",null,"å› æ•°æ®ä¸¢å¤±æˆ–æŸåè€Œé€ æˆçš„æŸå¤±"),e("li",null,"ä»»ä½•å…¶ä»–å› ä½¿ç”¨æœ¬åŠŸèƒ½è€Œäº§ç”Ÿçš„ä¸åˆ©åæœ")])]),e("div",{class:"section warning-section"},[e("h4",null,"5. ç¡®è®¤å£°æ˜"),e("p",null,[pe(" ä½¿ç”¨æœ¬åŠŸèƒ½å³è¡¨ç¤ºæ‚¨"),e("strong",null,"å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„"),pe("ä¸Šè¿°æ‰€æœ‰æ¡æ¬¾ï¼Œå¹¶æ‰¿è¯ºï¼š ")]),e("ul",null,[e("li",null,[pe("ä»…å°†æœ¬åŠŸèƒ½ç”¨äº"),e("strong",null,"åˆæ³•ã€åˆè§„"),pe("çš„ç›®çš„")]),e("li",null,[e("strong",null,"è‡ªè¡Œæ‰¿æ‹…"),pe("ä½¿ç”¨æœ¬åŠŸèƒ½æ‰€å¸¦æ¥çš„ä¸€åˆ‡é£é™©å’Œè´£ä»»")]),e("li",null,[pe("å¦‚å› ä½¿ç”¨æœ¬åŠŸèƒ½å¯¼è‡´ä»»ä½•äº‰è®®ï¼Œ"),e("strong",null,"ä¸æœ¬è½¯ä»¶ä½œè€…æ— å…³")])])])],-1)),e("div",nh,[h[1]||(h[1]=e("p",{class:"confirmation-prompt"}," å¦‚æœæ‚¨å·²å®Œæ•´é˜…è¯»å¹¶åŒæ„ä»¥ä¸Šæ¡æ¬¾ï¼Œè¯·åœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­å‡†ç¡®è¾“å…¥ï¼š ",-1)),e("p",{class:"required-text"},[e("code",null,oe(Ft))]),ne(e("input",{"onUpdate:modelValue":h[0]||(h[0]=T=>n.value=T),type:"text",class:"confirmation-input",placeholder:`è¯·è¾“å…¥: ${Ft}`,onKeyup:ln(i,["enter"])},null,40,sh),[[Se,n.value]]),n.value&&!l.value?(P(),A("p",ah," è¾“å…¥ä¸æ­£ç¡®ï¼Œè¯·å®Œæ•´è¾“å…¥ã€Œ"+oe(Ft)+"ã€ ")):ge("",!0)])]),e("div",lh,[e("button",{class:"btn-cancel",onClick:a}," æˆ‘ä¸åŒæ„ï¼Œè¿”å› "),e("button",{class:"btn-confirm",disabled:!l.value,onClick:i}," âœ“ ç¡®è®¤å¹¶ç»§ç»­ ",8,ih)])])])):ge("",!0)]))}}),uh=qe(rh,[["__scopeId","data-v-3750d090"]]),ch={class:"app-header"},dh={class:"header-content"},gh={class:"logo-container"},ph={class:"header-links"},mh={class:"container"},vh={id:"image-display-area"},fh={id:"upload-section",class:"card upload-card"},bh={class:"upload-actions"},hh={key:1,class:"bookshelf-mode-hint"},yh=He({__name:"TranslateView",setup(s){const t=an(),n=Qe(),o=Ue(),l=pn(),i=ct(),{validateBeforeTranslation:a,initValidation:r}=mn(),h=vo(),T=Ql(),S=_(!1),M=_(void 0),L=_(!1),D=_(!1),U=_(null),w=_(null),W=K(()=>n.currentImage),q=K(()=>n.hasImages);K(()=>n.imageCount),K(()=>n.currentImageIndex+1),K(()=>q.value&&!n.isBatchTranslationInProgress),K(()=>n.canGoPrevious),K(()=>n.canGoNext);const O=K(()=>n.isBatchTranslationInProgress);K(()=>{if(!O.value)return 0;const se=n.completedImageCount,J=n.imageCount;return J>0?Math.round(se/J*100):0}),K(()=>`${n.completedImageCount}/${n.imageCount}`);const f=K(()=>n.failedImageCount>0),c=K(()=>!!t.query.book&&!!t.query.chapter),k=K(()=>t.query.book),C=K(()=>t.query.chapter),N=K(()=>T.currentBookTitle.value),Y=K(()=>T.currentChapterTitle.value),ie=K(()=>c.value&&Y.value&&N.value?`${Y.value} - ${N.value}`:"Saber-Translator");ut(async()=>{n.clearImages(),i.clearBubbles(),await T.initializeApp(),r(),window.addEventListener("keydown",_e)}),Pt(()=>{window.removeEventListener("keydown",_e)}),Ce(()=>[t.query.book,t.query.chapter],async([se,J],[z,te])=>{se&&J?(n.clearImages(),i.clearBubbles(),await X()):z&&te&&!se&&!J&&(n.clearImages(),i.clearBubbles(),await T.initializeBookChapterContext(),console.log("[TranslateView] ä»ä¹¦æ¶æ¨¡å¼åˆ‡æ¢åˆ°å¿«é€Ÿç¿»è¯‘æ¨¡å¼ï¼Œå·²æ¸…ç©ºæ•°æ®"))}),Ce(ie,se=>{typeof document<"u"&&(document.title=se)},{immediate:!0});async function X(){if(!(!k.value||!C.value))try{await T.initializeBookChapterContext()}catch(se){console.error("åŠ è½½ç« èŠ‚ä¼šè¯å¤±è´¥:",se),be("åŠ è½½ç« èŠ‚ä¼šè¯å¤±è´¥","error")}}function ae(se){console.log(`ä¸Šä¼ å®Œæˆï¼Œå…± ${se} å¼ å›¾ç‰‡`),n.hasImages&&(n.sortImagesByFileName(),T.switchImage(0))}async function Z(se){const J=W.value;if(!J||!J.bubbleStates||J.bubbleStates.length===0){be("è¯·å…ˆé€‰æ‹©ä¸€å¼ å·²ç¿»è¯‘çš„å›¾ç‰‡","warning");return}if(n.images.length<=1){be("åªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œæ— éœ€åº”ç”¨åˆ°å…¨éƒ¨","info");return}if(!Object.values(se).some(te=>te)){be("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè¦åº”ç”¨çš„è®¾ç½®é¡¹","warning");return}try{const te=J.bubbleStates[0],ee={};se.fontSize&&(ee.fontSize=te.fontSize),se.fontFamily&&(ee.fontFamily=te.fontFamily),se.layoutDirection&&(ee.textDirection=te.textDirection==="auto"?"vertical":te.textDirection),se.textColor&&(ee.textColor=te.textColor),se.fillColor&&(ee.fillColor=te.fillColor),se.strokeEnabled&&(ee.strokeEnabled=te.strokeEnabled),se.strokeColor&&(ee.strokeColor=te.strokeColor),se.strokeWidth&&(ee.strokeWidth=te.strokeWidth);const ce=Ie=>{const we={...Ie};return se.fontSize&&ee.fontSize!==void 0&&(we.fontSize=ee.fontSize),se.fontFamily&&ee.fontFamily!==void 0&&(we.fontFamily=ee.fontFamily),se.layoutDirection&&ee.textDirection!==void 0&&(we.textDirection=ee.textDirection),se.textColor&&ee.textColor!==void 0&&(we.textColor=ee.textColor),se.fillColor&&ee.fillColor!==void 0&&(we.fillColor=ee.fillColor),se.strokeEnabled&&ee.strokeEnabled!==void 0&&(we.strokeEnabled=ee.strokeEnabled),se.strokeColor&&ee.strokeColor!==void 0&&(we.strokeColor=ee.strokeColor),se.strokeWidth&&ee.strokeWidth!==void 0&&(we.strokeWidth=ee.strokeWidth),we};let me=0;const ye=n.images;for(let Ie=0;Ie<ye.length;Ie++){const we=ye[Ie];if(we&&we.bubbleStates&&we.bubbleStates.length>0){const Ve=we.bubbleStates.map(ce);n.updateImageByIndex(Ie,{bubbleStates:Ve}),me++}}if(i.bubbles.length>0){const Ie=i.bubbles.map(ce);i.setBubbles(Ie)}const he=[];se.fontSize&&he.push("å­—å·"),se.fontFamily&&he.push("å­—ä½“"),se.layoutDirection&&he.push("æ’ç‰ˆæ–¹å‘"),se.textColor&&he.push("æ–‡å­—é¢œè‰²"),se.fillColor&&he.push("å¡«å……é¢œè‰²"),se.strokeEnabled&&he.push("æè¾¹å¼€å…³"),se.strokeColor&&he.push("æè¾¹é¢œè‰²"),se.strokeWidth&&he.push("æè¾¹å®½åº¦");const ve=[];for(let Ie=0;Ie<ye.length;Ie++){const we=ye[Ie];we&&we.translatedDataURL&&we.bubbleStates&&we.bubbleStates.length>0&&ve.push(Ie)}if(ve.length>0){const{apiClient:Ie}=await lt(async()=>{const{apiClient:Oe}=await import("./client.Bht704G-.js");return{apiClient:Oe}},__vite__mapDeps([4,5])),we=o.settings.textStyle.layoutDirection,Ve=we==="auto";for(let Oe=0;Oe<ve.length;Oe++){const De=ve[Oe];if(De===void 0)continue;const Re=n.images[De];if(!(!Re||!Re.bubbleStates))try{let Ge="";if(Re.cleanImageData?Ge=Re.cleanImageData.includes("base64,")?Re.cleanImageData.split("base64,")[1]||"":Re.cleanImageData:Re.originalDataURL&&(Ge=Re.originalDataURL.includes("base64,")?Re.originalDataURL.split("base64,")[1]||"":Re.originalDataURL,console.log(`handleApplyToAll: å›¾ç‰‡ ${De} ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰`)),!Ge){console.log(`handleApplyToAll: å›¾ç‰‡ ${De} æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡`);continue}const at=Re.bubbleStates.map(ke=>({translatedText:ke.translatedText||"",coords:ke.coords,fontSize:ke.fontSize||o.settings.textStyle.fontSize,fontFamily:ke.fontFamily||o.settings.textStyle.fontFamily,textDirection:kt(ke),textColor:ke.textColor||o.settings.textStyle.textColor,rotationAngle:ke.rotationAngle||0,position:ke.position||{x:0,y:0},strokeEnabled:ke.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:ke.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:ke.strokeWidth??o.settings.textStyle.strokeWidth})),it=await Ie.post("/api/re_render_image",{clean_image:Ge,bubble_texts:at.map(ke=>ke.translatedText),bubble_coords:at.map(ke=>ke.coords),fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:Ve?"vertical":we,textColor:o.settings.textStyle.textColor,bubble_states:at,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});it.rendered_image&&n.updateImageByIndex(De,{translatedDataURL:`data:image/png;base64,${it.rendered_image}`,hasUnsavedChanges:!0})}catch(Ge){console.error(`é‡æ¸²æŸ“å›¾ç‰‡ ${De} å¤±è´¥:`,Ge)}}}be(`å·²å°† ${he.join("ã€")} åº”ç”¨åˆ° ${me} å¼ å›¾ç‰‡`,"success"),console.log(`[TranslateView] åº”ç”¨è®¾ç½®åˆ°å…¨éƒ¨å®Œæˆï¼Œæ›´æ–°äº† ${me} å¼ å›¾ç‰‡ï¼Œé‡æ¸²æŸ“äº† ${ve.length} å¼ `)}catch(te){console.error("åº”ç”¨è®¾ç½®åˆ°å…¨éƒ¨å¤±è´¥:",te),be("åº”ç”¨è®¾ç½®å¤±è´¥","error")}}async function d(){W.value&&a("normal")&&await h.translateCurrentImage()}async function m(){q.value&&a("normal")&&await h.translateAllImages()}async function x(){q.value&&a("hq")&&await h.executeHqTranslation()}async function b(){q.value&&a("proofread")&&await h.executeProofreading()}async function p(){W.value&&await h.removeTextOnly()}async function g(){q.value&&await h.removeAllTexts()}function E(){if(!W.value)return;const se=W.value.fileName||`å›¾ç‰‡ ${n.currentImageIndex+1}`;confirm(`ç¡®å®šè¦åˆ é™¤å½“å‰å›¾ç‰‡ (${se}) å—ï¼Ÿ`)&&(n.deleteCurrentImage(),be("å›¾ç‰‡å·²åˆ é™¤","success"))}function H(){q.value&&confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å›¾ç‰‡å—ï¼Ÿè¿™å°†ä¸¢å¤±æ‰€æœ‰æœªä¿å­˜çš„è¿›åº¦ã€‚")&&(n.clearImages(),be("æ‰€æœ‰å›¾ç‰‡å·²æ¸…é™¤","success"))}async function I(){try{const se=await un(),J=await uo();if(se.success&&J.success)be("ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ","success");else{const z=[];se.success||z.push("è°ƒè¯•æ–‡ä»¶æ¸…ç†å¤±è´¥"),J.success||z.push("ä¸´æ—¶æ–‡ä»¶æ¸…ç†å¤±è´¥"),be(z.join("ï¼Œ"),"warning")}}catch{be("æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥","error")}}function $(){T.goToPrevious()}function R(){T.goToNext()}function v(){D.value=!D.value}async function B(){if(!f.value){be("æ²¡æœ‰å¤±è´¥çš„å›¾ç‰‡éœ€è¦é‡æ–°ç¿»è¯‘","info");return}a("normal")&&await h.retryFailedImages()}async function u(){if(!q.value){be("æ²¡æœ‰å¯ä¿å­˜çš„å†…å®¹","warning");return}if(!(!k.value||!C.value))try{await l.saveChapterSession(k.value,C.value)?be("ç« èŠ‚è¿›åº¦å·²ä¿å­˜","success"):be("ä¿å­˜å¤±è´¥","error")}catch(se){console.error("ä¿å­˜ä¼šè¯å¤±è´¥:",se),be("ä¿å­˜å¤±è´¥: "+(se instanceof Error?se.message:"æœªçŸ¥é”™è¯¯"),"error")}}function y(se){M.value=se,S.value=!0}function ue(){y("plugins")}function F(){be("è®¾ç½®å·²ä¿å­˜","success")}function j(){L.value=!0}function le(){be("ğŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}function _e(se){const J=se.target;if(!(J instanceof HTMLInputElement||J instanceof HTMLTextAreaElement||J.getAttribute("contenteditable")==="true"||J.id==="bubbleTextEditor")&&!D.value&&se.altKey)switch(se.key){case"ArrowLeft":se.preventDefault(),$();break;case"ArrowRight":se.preventDefault(),R();break;case"ArrowUp":if(se.preventDefault(),!o.settings.textStyle.autoFontSize){const te=o.settings.textStyle.fontSize;o.updateTextStyle({fontSize:te+1})}break;case"ArrowDown":if(se.preventDefault(),!o.settings.textStyle.autoFontSize){const te=o.settings.textStyle.fontSize;o.updateTextStyle({fontSize:Math.max(10,te-1)})}break}}async function $e(se){const J=W.value;if(!J||!J.translatedDataURL){console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${se} (ä»…å½±å“ä¸‹æ¬¡ç¿»è¯‘)`);return}const z=J.bubbleStates;if(!z||!Array.isArray(z)||z.length===0){console.log("å½“å‰å›¾ç‰‡æ²¡æœ‰ bubbleStatesï¼Œè·³è¿‡é‡æ¸²æŸ“");return}if(console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${se}ï¼Œå°†é‡æ–°æ¸²æŸ“...`),se){console.log("è‡ªåŠ¨å­—å·å·²å¼€å¯ï¼Œé‡æ–°è®¡ç®—å­—å·å¹¶æ¸²æŸ“...");try{const{apiClient:te}=await lt(async()=>{const{apiClient:ve}=await import("./client.Bht704G-.js");return{apiClient:ve}},__vite__mapDeps([4,5]));let ee="";if(J.cleanImageData){const ve=J.cleanImageData;ee=ve.includes("base64,")?ve.split("base64,")[1]||"":ve}else J.originalDataURL&&(ee=J.originalDataURL.includes("base64,")?J.originalDataURL.split("base64,")[1]||"":J.originalDataURL);if(!ee){console.log("æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const ce=z.map(ve=>({translatedText:ve.translatedText||"",coords:ve.coords,fontSize:ve.fontSize||o.settings.textStyle.fontSize,fontFamily:ve.fontFamily||o.settings.textStyle.fontFamily,textDirection:kt(ve),textColor:ve.textColor||o.settings.textStyle.textColor,rotationAngle:ve.rotationAngle||0,position:ve.position||{x:0,y:0},strokeEnabled:ve.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:ve.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:ve.strokeWidth??o.settings.textStyle.strokeWidth})),me=ce.map(ve=>ve.translatedText),ye=ce.map(ve=>ve.coords),he=await te.post("/api/re_render_image",{clean_image:ee,bubble_texts:me,bubble_coords:ye,fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:o.settings.textStyle.layoutDirection==="auto"?"vertical":o.settings.textStyle.layoutDirection,textColor:o.settings.textStyle.textColor,bubble_states:ce,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,autoFontSize:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});if(he.rendered_image){if(he.bubble_states&&Array.isArray(he.bubble_states)){const ve=z.map((Ie,we)=>({...Ie,fontSize:he.bubble_states[we]?.fontSize??Ie.fontSize}));n.updateCurrentImage({translatedDataURL:`data:image/png;base64,${he.rendered_image}`,bubbleStates:ve,hasUnsavedChanges:!0}),i.setBubbles(ve)}else n.updateCurrentImage({translatedDataURL:`data:image/png;base64,${he.rendered_image}`,hasUnsavedChanges:!0});console.log("è‡ªåŠ¨å­—å·æ¸²æŸ“æˆåŠŸ")}else he.error&&(console.error("è‡ªåŠ¨å­—å·æ¸²æŸ“å¤±è´¥:",he.error),be("é‡æ–°æ¸²æŸ“å¤±è´¥: "+he.error,"error"))}catch(te){console.error("è‡ªåŠ¨å­—å·æ¸²æŸ“å‡ºé”™:",te)}}else{const te=o.settings.textStyle.fontSize;console.log(`è‡ªåŠ¨å­—å·å·²å…³é—­ï¼Œä½¿ç”¨å›ºå®šå­—å· ${te} æ¸²æŸ“...`);const ee=z.map(ce=>({...ce,fontSize:te}));n.updateCurrentImage({bubbleStates:ee}),i.setBubbles(ee),await Ee("fontSize",te)}}async function Ee(se,J){const z=W.value;if(!z||!z.translatedDataURL||!z.bubbleStates||z.bubbleStates.length===0||!["fontSize","fontFamily","layoutDirection","textColor","strokeEnabled","strokeColor","strokeWidth","fillColor"].includes(se))return;console.log(`å…¨å±€è®¾ç½®å˜æ›´ (${se}=${J})ï¼Œå‡†å¤‡é‡æ¸²æŸ“...`);const ce={fontSize:"fontSize",fontFamily:"fontFamily",layoutDirection:"textDirection",textColor:"textColor",strokeEnabled:"strokeEnabled",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fillColor:"fillColor"}[se];if(ce&&z.bubbleStates)if(se==="layoutDirection")if(J==="auto"){console.log("æ’ç‰ˆæ–¹å‘è®¾ç½®ä¸º 'auto'ï¼Œä» autoTextDirection æ¢å¤æ¯ä¸ªæ°”æ³¡çš„æ’ç‰ˆæ–¹å‘");const me=z.bubbleStates.map(ye=>({...ye,textDirection:ye.autoTextDirection==="vertical"||ye.autoTextDirection==="horizontal"?ye.autoTextDirection:"vertical"}));n.updateCurrentImage({bubbleStates:me}),i.setBubbles(me)}else{console.log(`æ’ç‰ˆæ–¹å‘è®¾ç½®ä¸º '${J}'ï¼Œåº”ç”¨åˆ°æ‰€æœ‰æ°”æ³¡`);const me=z.bubbleStates.map(ye=>({...ye,textDirection:J}));n.updateCurrentImage({bubbleStates:me}),i.setBubbles(me)}else{const me=z.bubbleStates.map(ye=>({...ye,[ce]:J}));n.updateCurrentImage({bubbleStates:me}),i.setBubbles(me)}try{const ye=n.currentImage?.bubbleStates||z.bubbleStates||[];if(ye.length===0||!ye[0]?.coords){console.log("æ²¡æœ‰æœ‰æ•ˆçš„æ°”æ³¡åæ ‡ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const he=o.settings.textStyle.layoutDirection,ve=ye.map(Re=>({translatedText:Re.translatedText||"",coords:Re.coords,fontSize:Re.fontSize||o.settings.textStyle.fontSize,fontFamily:Re.fontFamily||o.settings.textStyle.fontFamily,textDirection:kt(Re),textColor:Re.textColor||o.settings.textStyle.textColor,rotationAngle:Re.rotationAngle||0,position:Re.position||{x:0,y:0},strokeEnabled:Re.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:Re.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:Re.strokeWidth??o.settings.textStyle.strokeWidth})),Ie=ve.map(Re=>Re.translatedText),we=ve.map(Re=>Re.coords);let Ve="";if(z.cleanImageData){const Re=z.cleanImageData;Ve=Re.includes("base64,")?Re.split("base64,")[1]||"":Re}else z.originalDataURL&&(Ve=z.originalDataURL.includes("base64,")?z.originalDataURL.split("base64,")[1]||"":z.originalDataURL,console.log("handleTextStyleChanged: ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰"));if(!Ve){console.log("æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const{apiClient:Oe}=await lt(async()=>{const{apiClient:Re}=await import("./client.Bht704G-.js");return{apiClient:Re}},__vite__mapDeps([4,5])),De=await Oe.post("/api/re_render_image",{clean_image:Ve,bubble_texts:Ie,bubble_coords:we,fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:he==="auto"?"vertical":he,textColor:o.settings.textStyle.textColor,bubble_states:ve,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});De.rendered_image?(n.updateCurrentImage({translatedDataURL:`data:image/png;base64,${De.rendered_image}`,hasUnsavedChanges:!0}),console.log("è®¾ç½®å˜æ›´åé‡æ–°æ¸²æŸ“æˆåŠŸ")):De.error&&console.error("é‡æ–°æ¸²æŸ“å¤±è´¥:",De.error)}catch(me){console.error("è®¾ç½®å˜æ›´åé‡æ–°æ¸²æŸ“å¤±è´¥:",me)}}function Me(se){T.switchImage(se)}return(se,J)=>{const z=os("router-link");return P(),A("div",{class:Te(["translate-page",{"edit-mode-active":D.value}])},[e("header",ch,[e("div",dh,[e("div",gh,[xe(z,{to:"/",title:"è¿”å›ä¹¦æ¶"},{default:yt(()=>[...J[3]||(J[3]=[e("img",{src:"/pic/logo.png",alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",ph,[xe(z,{to:"/",class:"back-to-shelf",title:"è¿”å›ä¹¦æ¶"},{default:yt(()=>[...J[4]||(J[4]=[pe("ğŸ“š",-1)])]),_:1}),c.value?(P(),A("button",{key:0,class:"save-header-btn",title:"ä¿å­˜è¿›åº¦",onClick:u}," ğŸ’¾ ")):ge("",!0),e("button",{id:"openSettingsBtn",class:"settings-header-btn",title:"æ‰“å¼€è®¾ç½®",onClick:J[0]||(J[0]=te=>y())},[...J[5]||(J[5]=[e("span",{class:"icon"},"âš™ï¸",-1),e("span",null,"è®¾ç½®",-1)])]),J[8]||(J[8]=e("a",{href:"http://www.mashirosaber.top",target:"_blank",class:"tutorial-link"},"ä½¿ç”¨æ•™ç¨‹",-1)),e("a",{href:"javascript:void(0)",class:"donate-link",onClick:j},[...J[6]||(J[6]=[e("span",null,"â¤ï¸ è¯·ä½œè€…å–å¥¶èŒ¶",-1)])]),J[9]||(J[9]=e("a",{href:"https://github.com/MashiroSaber03",target:"_blank",class:"github-link"},[e("img",{src:"/pic/github.jpg",alt:"GitHub",class:"github-icon"})],-1)),e("button",{class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:le},[...J[7]||(J[7]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("div",mh,[xe(Za,{onTranslateCurrent:d,onTranslateAll:m,onHqTranslate:x,onProofread:b,onRemoveText:p,onRemoveAllText:g,onRetryFailed:B,onDeleteCurrent:E,onClearAll:H,onCleanTemp:I,onOpenPlugins:ue,onOpenSettings:y,onPrevious:$,onNext:R,onApplyToAll:Z,onTextStyleChanged:Ee,onAutoFontSizeChanged:$e}),e("main",vh,[e("section",fh,[e("div",bh,[xe(Ys,{ref_key:"imageUploadRef",ref:U,onUploadComplete:ae},null,512)]),V(l).loadingProgress.total>0?(P(),st(mo,{key:0,visible:!0,percentage:V(l).loadingProgress.current/V(l).loadingProgress.total*100,label:V(l).loadingProgress.message},null,8,["percentage","label"])):ge("",!0),xe(_i,{progress:V(h).progress.value},null,8,["progress"]),O.value&&c.value?(P(),A("div",hh,[...J[10]||(J[10]=[e("span",{style:{color:"#888","font-size":"0.85em"}}," ï¼ˆä¹¦æ¶æ¨¡å¼ä¸‹é€€å‡ºå‰è¯·ç‚¹å‡»é¡¶éƒ¨ä¿å­˜æŒ‰é’®ï¼‰ ",-1)])])):ge("",!0)]),xe(_l,{ref_key:"imageResultRef",ref:w,"is-edit-mode":D.value,onToggleEditMode:v,onRetryFailed:B},null,8,["is-edit-mode"])]),q.value&&!D.value?(P(),st(ji,{key:0,onSelect:Me})):ge("",!0)]),W.value&&D.value?(P(),st(Sv,{key:0,"is-edit-mode-active":D.value,onExit:v},null,8,["is-edit-mode-active"])):ge("",!0),xe($l,{onOpenSettings:y}),xe(fp,{modelValue:S.value,"onUpdate:modelValue":J[1]||(J[1]=te=>S.value=te),"initial-tab":M.value,onSave:F},null,8,["modelValue","initial-tab"]),L.value?(P(),st(ki,{key:1,onClose:J[2]||(J[2]=te=>L.value=!1)})):ge("",!0),xe(uh),xe(eh)],2)}}}),Rh=qe(yh,[["__scopeId","data-v-00bc0059"]]);export{Rh as default};
