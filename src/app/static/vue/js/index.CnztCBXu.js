const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/config.CwRcCkM9.js","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js","js/BookshelfView.BneeUztZ.js","js/bookshelfStore.C4wffgOP.js","js/vue-vendor.BU3zOQRA.js","js/bookshelf.BX1u67VK.js","js/system.CmjDD-4C.js","js/BaseModal.BUrp_eXe.js","assets/BaseModal.CgStYIKv.css","assets/BookshelfView.Cv--zNqe.css","js/TranslateView.DPKnSjrC.js","js/CustomSelect.vue_vue_type_style_index_0_lang.qSOIWfjV.js","assets/CustomSelect.CoWnC2Ju.css","assets/TranslateView.DnlXEhOF.css","js/ReaderView.BPp5Dtcj.js","assets/ReaderView.B9ZPq8ld.css","js/InsightView.Bu9YHaHm.js","assets/InsightView.BCkQ1hAa.css"])))=>i.map(i=>d[i]);
import{d as eo,r as S,c as _,a as ae,o as oo,b as to,e as k,f as G,T as ao,w as io,g as ro,h as y,i as N,F as ie,j as so,u as re,n as no,t as lo,k as uo,l as co,R as mo,m as po,p as fo,q as vo,s as ho}from"./vue-vendor.BU3zOQRA.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const m of c)if(m.type==="childList")for(const p of m.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&l(p)}).observe(document,{childList:!0,subtree:!0});function r(c){const m={};return c.integrity&&(m.integrity=c.integrity),c.referrerPolicy&&(m.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?m.credentials="include":c.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(c){if(c.ep)return;c.ep=!0;const m=r(c);fetch(c.href,m)}})();const go="modulepreload",To=function(o){return"/"+o},ee={},q=function(i,r,l){let c=Promise.resolve();if(r&&r.length>0){let P=function(h){return Promise.all(h.map(O=>Promise.resolve(O).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),d=p?.nonce||p?.getAttribute("nonce");c=P(r.map(h=>{if(h=To(h),h in ee)return;ee[h]=!0;const O=h.endsWith(".css"),x=O?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${x}`))return;const g=document.createElement("link");if(g.rel=O?"stylesheet":go,O||(g.as="script"),g.crossOrigin="",g.href=h,d&&g.setAttribute("nonce",d),document.head.appendChild(g),O)return new Promise((w,C)=>{g.addEventListener("load",w),g.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${h}`)))})}))}function m(p){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=p,window.dispatchEvent(d),!d.defaultPrevented)throw p}return c.then(p=>{for(const d of p||[])d.status==="rejected"&&m(d.reason);return i().catch(m)})},Oo="#FFFFFF",se=`你是一个ocr助手，你需要将我发送给你的图片中的文字提取出来并返回给我，要求：
1、完整识别：我发送给你的图片中的文字都是需要识别的内容
2、非贪婪输出：不要返回任何其他解释和说明。`,xo=`你是一个专业的翻译引擎。请将用户提供的文本翻译成简体中文。
要求：
1. 保留原文的表达意图和情感
2. 使用地道、流畅的表达方式
3. 不要添加任何额外的解释或对话
4. 直接返回翻译结果`,Ro=`你是一个专业的翻译引擎。请将用户提供的文本翻译成简体中文。
当文本中包含特殊字符（如大括号{}、引号""、反斜杠\\等）时，请在输出中保留它们但不要将它们视为JSON语法的一部分。
请严格按照以下 JSON 格式返回结果，不要添加任何额外的解释或对话:
{
  "translated_text": "[翻译后的文本放在这里]"
}`,_o=`你是一个OCR助手。请将我发送给你的图片中的所有文字提取出来。
当文本中包含特殊字符（如大括号{}、引号""、反斜杠\\等）时，请在输出中保留它们但不要将它们视为JSON语法的一部分。如果需要，你可以使用转义字符\\来表示这些特殊字符。
请严格按照以下 JSON 格式返回结果，不要添加任何额外的解释或对话:
{
  "extracted_text": "[这里放入所有识别到的文字，可以包含换行符以大致保留原始分段，但不要包含任何其他非文本内容]"
}`,yo=`你是一个漫画翻译助手，我会提供原始漫画图片和导出的只含原文不含译文JSON翻译文件，帮我将原文翻译成中文
翻译要求：
1.仅修改JSON中的"translated"译文，保持其他所有结构和字段不变。
2.json中的"imagelndex"序号是每张图片的页码，在翻译前先根据json文件中每页图片的原文内容和所有漫画图片对我给你的所有图片进行排序，在进行上下文对比时要严格按照"imagelndex"序号进行对比，你在翻译时要按照"imagelndex"的顺序进行顺序翻译，从而使得每句翻译足够连贯，上下文不会突兀
3.通过json中每页图片的"original"原文内容和所有的漫画图片明确每句话在那页图的哪个位置，并结合漫画图像和上下文语境，让翻译更加连贯自然，符合角色语气和场景
4.json中的"bubblelndex"标号可能不正确，你需要根据图片自行判断每句话的正确顺序，从而输出符合上下文连贯的翻译，但在输出翻译时不要修改原本的"bubblelndex"标号
5.保留原文的表达意图和情感，但使用更地道、流畅的表达方式
6.注意专有名词和术语的一致性翻译
7.如遇幽默、双关语或文化特定内容，请尽量找到目标语言中恰当的表达
8.不要添加原文中不存在的信息或解释
9.保持简洁明了，符合气泡空间限制
10.译文字数尽量不要超过原文
11.你需要直接返回修改后的完整JSON文件，无需解释每处修改原因。`,et=`你是一个专业的漫画校对助手，请帮我校对漫画翻译结果。我会给你漫画未经翻译的原图、由漫画原文和已有的翻译文本组成的JSON文件，请根据图片内容和上下文关系，检查并改进翻译质量。
校对要点：
1. json中的"imagelndex"序号是每张图片的页码，在翻译前先根据json文件中每页图片的原文内容和所有漫画图片对我给你的所有图片进行排序，在进行上下文对比时要严格按照"imagelndex"序号进行对比，你在翻译时要按照"imagelndex"的顺序进行顺序翻译，从而使得每句翻译足够连贯，上下文不会突兀
2. 通过json中每页图片的"original"原文内容和所有的漫画图片明确每句话在那页图的哪个位置，并结合漫画图像和上下文语境，让翻译更加连贯自然，符合角色语气和场景
3. json中的"bubblelndex"标号可能不正确，你需要根据图片自行判断每句话的正确顺序，从而输出符合上下文连贯的翻译，但在输出翻译时不要修改原本的"bubblelndex"标号
4. 针对特殊术语或专有名词的翻译进行统一
5. 重点关注易错点的人称和语气词
6. 修正任何语法或表达错误
请直接返回修改后的JSON数据，保持原有格式，只需更新"translated"字段的内容。`,U=0,B=0,qo=!0,Eo="#FFFFFF",Po=3,ot=[16,20,24,28,32,36,40,48,56,64],tt=2,at=10,it=100,I=3,D=2,M=2,rt=5,st=200,nt=30,lt="edit_mode_layout",$="translationSettings",oe="providerConfigs",te="modelHistory",So={fontSize:25,autoFontSize:!0,fontFamily:"fonts/STSONG.TTF",layoutDirection:"auto",textColor:"#000000",fillColor:Oo,strokeEnabled:qo,strokeColor:Eo,strokeWidth:Po,inpaintMethod:"solid"},No={apiKey:"",secretKey:"",version:"standard",sourceLanguage:"JAP"},Mo={provider:"gemini",apiKey:"",modelName:"",prompt:se,rpmLimit:B,customBaseUrl:"",isJsonMode:!1},Lo={provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",rpmLimit:U,maxRetries:I,isJsonMode:!1},Ao={provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",batchSize:3,sessionReset:20,rpmLimit:7,maxRetries:D,lowReasoning:!1,noThinkingMethod:"gemini",forceJsonOutput:!0,useStream:!1,prompt:yo},bo={enabled:!1,rounds:[],maxRetries:M},Vo={ratio:0,top:0,bottom:0,left:0,right:0},Uo={enabled:!0,dilateSize:10,boxExpandRatio:20};function H(){return{textStyle:{...So},ocrEngine:"manga_ocr",sourceLanguage:"japanese",textDetector:"default",baiduOcr:{...No},aiVisionOcr:{...Mo},translation:{...Lo},targetLanguage:"zh",translatePrompt:"",useTextboxPrompt:!1,textboxPrompt:"",hqTranslation:{...Ao},proofreading:{...bo},boxExpand:{...Vo},preciseMask:{...Uo},pdfProcessingMethod:"backend",showDetectionDebug:!1}}const ne=eo("settings",()=>{const o=S(H()),i=S({translation:{},hqTranslation:{},aiVisionOcr:{}}),r=S({}),l=S([]),c=_(()=>o.value.textStyle),m=_(()=>o.value.ocrEngine),p=_(()=>o.value.sourceLanguage),d=_(()=>o.value.translation.provider),P=_(()=>o.value.hqTranslation.provider),h=_(()=>o.value.proofreading.enabled);function O(e){Object.assign(o.value,e),u()}function x(e){Object.assign(o.value.textStyle,e),u()}function g(e){o.value.ocrEngine=e,u(),console.log(`OCR引擎已设置为: ${e}`)}function w(e){o.value.textDetector=e,u(),console.log(`文本检测器已设置为: ${e}`)}function C(e){o.value.sourceLanguage=e,u(),console.log(`源语言已设置为: ${e}`)}function ce(e){Object.assign(o.value.baiduOcr,e),u()}function me(e){Object.assign(o.value.aiVisionOcr,e),u()}function pe(e){const t=o.value.aiVisionOcr.provider;t!==e&&(b(t),o.value.aiVisionOcr.provider=e,z(e),u(),console.log(`AI视觉OCR服务商已切换为: ${e}`))}function de(e){const t=o.value.translation.provider;t!==e&&(L(t),o.value.translation.provider=e,J(e),u())}function fe(e){Object.assign(o.value.translation,e),u()}function ve(e){o.value.translatePrompt=e,u()}function he(e){o.value.textboxPrompt=e,u()}function ge(e){o.value.useTextboxPrompt=e,u()}function Te(e){o.value.translation.isJsonMode=e;const t=e?Ro:xo;o.value.translatePrompt=t,u(),console.log(`翻译提示词模式已切换为: ${e?"JSON格式":"普通模式"}`)}function Oe(e){o.value.aiVisionOcr.isJsonMode=e;const t=e?_o:se;o.value.aiVisionOcr.prompt=t,u(),console.log(`AI视觉OCR提示词模式已切换为: ${e?"JSON格式":"普通模式"}`)}function xe(e){const t=o.value.hqTranslation.provider;t!==e&&(A(t),o.value.hqTranslation.provider=e,j(e),u(),console.log(`高质量翻译服务商已切换为: ${e}`))}function Re(e){Object.assign(o.value.hqTranslation,e),u()}function _e(e){o.value.hqTranslation.useStream=e,u()}function ye(e){o.value.hqTranslation.noThinkingMethod=e,u()}function qe(e){o.value.hqTranslation.forceJsonOutput=e,u()}function Ee(e){o.value.proofreading.enabled=e,u(),console.log(`AI校对已${e?"启用":"禁用"}`)}function Pe(e){o.value.proofreading.rounds.push(e),u(),console.log(`已添加校对轮次: ${e.name}`)}function Se(e,t){if(e>=0&&e<o.value.proofreading.rounds.length){const n=o.value.proofreading.rounds[e];n&&(Object.assign(n,t),u())}}function Ne(e){if(e>=0&&e<o.value.proofreading.rounds.length){const t=o.value.proofreading.rounds.splice(e,1);u(),console.log(`已删除校对轮次: ${t[0]?.name}`)}}function Me(e){o.value.proofreading.maxRetries=e,u()}function Le(e){Object.assign(o.value.boxExpand,e),u()}function Ae(e){Object.assign(o.value.preciseMask,e),u()}function be(e){o.value.pdfProcessingMethod=e,u(),console.log(`PDF处理方式已设置为: ${e}`)}function Ve(e){o.value.showDetectionDebug=e,u()}function L(e){if(!e)return;const t={apiKey:o.value.translation.apiKey,modelName:o.value.translation.modelName,customBaseUrl:o.value.translation.customBaseUrl,rpmLimit:o.value.translation.rpmLimit,maxRetries:o.value.translation.maxRetries,isJsonMode:o.value.translation.isJsonMode};i.value.translation[e]=t,V(),console.log(`[Settings] 保存翻译服务商配置: ${e}`,t)}function J(e){if(!e)return;const t=i.value.translation[e];t?(t.apiKey!==void 0&&(o.value.translation.apiKey=t.apiKey),t.modelName!==void 0&&(o.value.translation.modelName=t.modelName),t.customBaseUrl!==void 0&&(o.value.translation.customBaseUrl=t.customBaseUrl),t.rpmLimit!==void 0&&(o.value.translation.rpmLimit=t.rpmLimit),t.maxRetries!==void 0&&(o.value.translation.maxRetries=t.maxRetries),t.isJsonMode!==void 0&&(o.value.translation.isJsonMode=t.isJsonMode),console.log(`[Settings] 恢复翻译服务商配置: ${e}`,t)):(o.value.translation.apiKey="",o.value.translation.modelName="",o.value.translation.customBaseUrl="",console.log(`[Settings] ${e} 无缓存配置，使用默认值`))}function A(e){if(!e)return;const t={apiKey:o.value.hqTranslation.apiKey,modelName:o.value.hqTranslation.modelName,customBaseUrl:o.value.hqTranslation.customBaseUrl,batchSize:o.value.hqTranslation.batchSize,sessionReset:o.value.hqTranslation.sessionReset,rpmLimit:o.value.hqTranslation.rpmLimit,maxRetries:o.value.hqTranslation.maxRetries,lowReasoning:o.value.hqTranslation.lowReasoning,noThinkingMethod:o.value.hqTranslation.noThinkingMethod,forceJsonOutput:o.value.hqTranslation.forceJsonOutput,useStream:o.value.hqTranslation.useStream,prompt:o.value.hqTranslation.prompt};i.value.hqTranslation[e]=t,V(),console.log(`[Settings] 保存高质量翻译服务商配置: ${e}`,t)}function j(e){if(!e)return;const t=i.value.hqTranslation[e];t?(t.apiKey!==void 0&&(o.value.hqTranslation.apiKey=t.apiKey),t.modelName!==void 0&&(o.value.hqTranslation.modelName=t.modelName),t.customBaseUrl!==void 0&&(o.value.hqTranslation.customBaseUrl=t.customBaseUrl),t.batchSize!==void 0&&(o.value.hqTranslation.batchSize=t.batchSize),t.sessionReset!==void 0&&(o.value.hqTranslation.sessionReset=t.sessionReset),t.rpmLimit!==void 0&&(o.value.hqTranslation.rpmLimit=t.rpmLimit),t.maxRetries!==void 0&&(o.value.hqTranslation.maxRetries=t.maxRetries),t.lowReasoning!==void 0&&(o.value.hqTranslation.lowReasoning=t.lowReasoning),t.noThinkingMethod!==void 0&&(o.value.hqTranslation.noThinkingMethod=t.noThinkingMethod),t.forceJsonOutput!==void 0&&(o.value.hqTranslation.forceJsonOutput=t.forceJsonOutput),t.useStream!==void 0&&(o.value.hqTranslation.useStream=t.useStream),t.prompt!==void 0&&(o.value.hqTranslation.prompt=t.prompt),console.log(`[Settings] 恢复高质量翻译服务商配置: ${e}`,t)):(o.value.hqTranslation.apiKey="",o.value.hqTranslation.modelName="",o.value.hqTranslation.customBaseUrl="",console.log(`[Settings] ${e} 无缓存配置，使用默认值`))}function b(e){if(!e)return;const t={apiKey:o.value.aiVisionOcr.apiKey,modelName:o.value.aiVisionOcr.modelName,customBaseUrl:o.value.aiVisionOcr.customBaseUrl,prompt:o.value.aiVisionOcr.prompt,rpmLimit:o.value.aiVisionOcr.rpmLimit,isJsonMode:o.value.aiVisionOcr.isJsonMode};i.value.aiVisionOcr[e]=t,V(),console.log(`[Settings] 保存AI视觉OCR服务商配置: ${e}`,t)}function z(e){if(!e)return;const t=i.value.aiVisionOcr[e];t?(t.apiKey!==void 0&&(o.value.aiVisionOcr.apiKey=t.apiKey),t.modelName!==void 0&&(o.value.aiVisionOcr.modelName=t.modelName),t.customBaseUrl!==void 0&&(o.value.aiVisionOcr.customBaseUrl=t.customBaseUrl),t.prompt!==void 0&&(o.value.aiVisionOcr.prompt=t.prompt),t.rpmLimit!==void 0&&(o.value.aiVisionOcr.rpmLimit=t.rpmLimit),t.isJsonMode!==void 0&&(o.value.aiVisionOcr.isJsonMode=t.isJsonMode),console.log(`[Settings] 恢复AI视觉OCR服务商配置: ${e}`,t)):(o.value.aiVisionOcr.apiKey="",o.value.aiVisionOcr.modelName="",o.value.aiVisionOcr.customBaseUrl="",console.log(`[Settings] ${e} 无缓存配置，使用默认值`))}function Ue(e,t){e==="translation"?L(t):e==="hqTranslation"?A(t):e==="aiVisionOcr"&&b(t)}function Be(e,t){e==="translation"?J(t):e==="hqTranslation"?j(t):e==="aiVisionOcr"&&z(t)}function Ie(e,t){if(!e||!t)return;r.value[e]||(r.value[e]=[]);const n=r.value[e].indexOf(t);n!==-1&&r.value[e].splice(n,1),r.value[e].unshift(t),r.value[e].length>20&&(r.value[e]=r.value[e].slice(0,20)),Q(),console.log(`[Settings] 添加模型到历史: ${e} -> ${t}`)}function De(e){return r.value[e]||[]}function Ke(e){r.value[e]&&(delete r.value[e],Q(),console.log(`[Settings] 清除模型历史: ${e}`))}function Fe(e){l.value.includes(e)||(l.value.push(e),l.value.sort((t,n)=>t-n),W(),console.log(`已添加自定义字号预设: ${e}`))}function we(e){const t=l.value.indexOf(e);t!==-1&&(l.value.splice(t,1),W(),console.log(`已删除自定义字号预设: ${e}`))}function u(){try{const e=JSON.stringify(o.value);localStorage.setItem($,e)}catch(e){console.error("保存设置到 localStorage 失败:",e)}}const Ce="saber_translator_settings";function Z(){try{let e=localStorage.getItem($);if(!e){const t=localStorage.getItem(Ce);t&&(console.log("[Settings] 检测到原版设置，正在迁移..."),e=t,localStorage.setItem($,t),console.log("[Settings] 原版设置已迁移到新存储键"))}if(e){const t=JSON.parse(e);o.value=ke(H(),t),Je(),console.log("已从 localStorage 加载设置")}}catch(e){console.error("从 localStorage 加载设置失败:",e)}}function Je(){const e=o.value.textStyle;e.fontSize=Number(e.fontSize)||25,e.strokeWidth=Number(e.strokeWidth)||3;const t=o.value.boxExpand;t.ratio=Number(t.ratio)||1,t.top=Number(t.top)||0,t.bottom=Number(t.bottom)||0,t.left=Number(t.left)||0,t.right=Number(t.right)||0;const n=o.value.preciseMask;n.dilateSize=Number(n.dilateSize)||5,n.boxExpandRatio=Number(n.boxExpandRatio)||1;const s=o.value.translation;s.rpmLimit=Number(s.rpmLimit)||U,s.maxRetries=Number(s.maxRetries)||I;const a=o.value.hqTranslation;a.batchSize=Number(a.batchSize)||10,a.sessionReset=Number(a.sessionReset)||50,a.rpmLimit=Number(a.rpmLimit)||60,a.maxRetries=Number(a.maxRetries)||D;const T=o.value.aiVisionOcr;T.rpmLimit=Number(T.rpmLimit)||B;const R=o.value.proofreading;R.maxRetries=Number(R.maxRetries)||M,s.provider==="baidu"&&(s.provider="baidu_translate"),s.provider==="youdao"&&(s.provider="youdao_translate"),i.value.translation.baidu&&(i.value.translation.baidu_translate={...i.value.translation.baidu},delete i.value.translation.baidu),i.value.translation.youdao&&(i.value.translation.youdao_translate={...i.value.translation.youdao},delete i.value.translation.youdao)}function W(){try{const e=JSON.stringify(l.value);localStorage.setItem("customFontSizePresets",e)}catch(e){console.error("保存自定义字号预设失败:",e)}}function V(){try{const e=JSON.stringify(i.value);localStorage.setItem(oe,e)}catch(e){console.error("保存服务商配置缓存失败:",e)}}function je(){try{const e=localStorage.getItem(oe);if(e){const t=JSON.parse(e);i.value={translation:t.translation||{},hqTranslation:t.hqTranslation||{},aiVisionOcr:t.aiVisionOcr||{}},console.log("已从 localStorage 加载服务商配置缓存")}}catch(e){console.error("加载服务商配置缓存失败:",e)}}function Q(){try{const e=JSON.stringify(r.value);localStorage.setItem(te,e)}catch(e){console.error("保存模型历史记录失败:",e)}}function ze(){try{const e=localStorage.getItem(te);e&&(r.value=JSON.parse(e),console.log("已从 localStorage 加载模型历史记录"))}catch(e){console.error("加载模型历史记录失败:",e)}}function $e(){try{const e=localStorage.getItem("customFontSizePresets");e&&(l.value=JSON.parse(e))}catch(e){console.error("加载自定义字号预设失败:",e)}}function He(){Ge(),Z(),$e(),je(),ze()}function Ge(){try{localStorage.removeItem("theme"),typeof document<"u"&&(document.documentElement.setAttribute("data-theme","light"),document.body.setAttribute("data-theme","light"))}catch(e){console.warn("清理旧版主题设置失败:",e)}}async function Ye(){try{console.log("[Settings] 开始从后端加载设置...");const{getUserSettings:e}=await q(async()=>{const{getUserSettings:n}=await import("./config.CwRcCkM9.js");return{getUserSettings:n}},__vite__mapDeps([0,1,2])),t=await e();if(console.log("[Settings] API 响应:",t),t.success&&t.settings){const n=t.settings;return console.log("[Settings] 从后端加载设置:",n),console.log("[Settings] 设置字段数量:",Object.keys(n).length),Xe(n),u(),V(),console.log("[Settings] 后端设置已应用，当前翻译服务商:",o.value.translation.provider),console.log("[Settings] 当前翻译 API Key:",o.value.translation.apiKey?"已设置":"未设置"),!0}else return console.warn("[Settings] 后端无设置数据，使用 localStorage 或默认值",t),!1}catch(e){return console.error("[Settings] 从后端加载设置失败:",e),!1}}function Xe(e){const t=(n,s)=>{if(n==null||n==="")return s;const a=typeof n=="string"?parseFloat(n):Number(n);return isNaN(a)?s:a};if(e.ocrEngine&&(o.value.ocrEngine=e.ocrEngine),e.sourceLanguage&&(o.value.sourceLanguage=e.sourceLanguage),e.textDetector&&(o.value.textDetector=e.textDetector),e.baiduApiKey&&(o.value.baiduOcr.apiKey=e.baiduApiKey),e.baiduSecretKey&&(o.value.baiduOcr.secretKey=e.baiduSecretKey),e.baiduVersion&&(o.value.baiduOcr.version=e.baiduVersion),e.baiduSourceLanguage&&(o.value.baiduOcr.sourceLanguage=e.baiduSourceLanguage),e.aiVisionProvider&&(o.value.aiVisionOcr.provider=e.aiVisionProvider),e.aiVisionApiKey&&(o.value.aiVisionOcr.apiKey=e.aiVisionApiKey),e.aiVisionModelName&&(o.value.aiVisionOcr.modelName=e.aiVisionModelName),e.aiVisionOcrPrompt&&(o.value.aiVisionOcr.prompt=e.aiVisionOcrPrompt),e.customAiVisionBaseUrl&&(o.value.aiVisionOcr.customBaseUrl=e.customAiVisionBaseUrl),e.rpmAiVisionOcr!==void 0&&(o.value.aiVisionOcr.rpmLimit=t(e.rpmAiVisionOcr,B)),e.aiVisionPromptModeSelect==="json"&&(o.value.aiVisionOcr.isJsonMode=!0),e.modelProvider&&(o.value.translation.provider=e.modelProvider),e.apiKey&&(o.value.translation.apiKey=e.apiKey),e.modelName&&(o.value.translation.modelName=e.modelName),e.customBaseUrl&&(o.value.translation.customBaseUrl=e.customBaseUrl),e.rpmTranslation!==void 0&&(o.value.translation.rpmLimit=t(e.rpmTranslation,U)),e.translationMaxRetries!==void 0&&(o.value.translation.maxRetries=t(e.translationMaxRetries,I)),e.translatePromptModeSelect==="json"&&(o.value.translation.isJsonMode=!0),e.promptContent&&(o.value.translatePrompt=e.promptContent),e.enableTextboxPrompt!==void 0&&(o.value.useTextboxPrompt=e.enableTextboxPrompt),e.textboxPromptContent&&(o.value.textboxPrompt=e.textboxPromptContent),e.hqTranslateProvider&&(o.value.hqTranslation.provider=e.hqTranslateProvider),e.hqApiKey&&(o.value.hqTranslation.apiKey=e.hqApiKey),e.hqModelName&&(o.value.hqTranslation.modelName=e.hqModelName),e.hqCustomBaseUrl&&(o.value.hqTranslation.customBaseUrl=e.hqCustomBaseUrl),e.hqBatchSize!==void 0&&(o.value.hqTranslation.batchSize=t(e.hqBatchSize,3)),e.hqSessionReset!==void 0&&(o.value.hqTranslation.sessionReset=t(e.hqSessionReset,20)),e.hqRpmLimit!==void 0&&(o.value.hqTranslation.rpmLimit=t(e.hqRpmLimit,7)),e.hqMaxRetries!==void 0&&(o.value.hqTranslation.maxRetries=t(e.hqMaxRetries,D)),e.hqPrompt&&(o.value.hqTranslation.prompt=e.hqPrompt),e.hqLowReasoning!==void 0&&(o.value.hqTranslation.lowReasoning=e.hqLowReasoning),e.hqNoThinkingMethod&&(o.value.hqTranslation.noThinkingMethod=e.hqNoThinkingMethod),e.hqForceJsonOutput!==void 0&&(o.value.hqTranslation.forceJsonOutput=e.hqForceJsonOutput),e.hqUseStream!==void 0&&(o.value.hqTranslation.useStream=e.hqUseStream),e.proofreadingEnabled!==void 0&&(o.value.proofreading.enabled=e.proofreadingEnabled),e.proofreadingMaxRetries!==void 0&&(o.value.proofreading.maxRetries=t(e.proofreadingMaxRetries,M)),e.proofreading&&typeof e.proofreading=="object"){const n=e.proofreading;n.enabled!==void 0&&(o.value.proofreading.enabled=n.enabled),n.maxRetries!==void 0&&(o.value.proofreading.maxRetries=t(n.maxRetries,M)),Array.isArray(n.rounds)&&(o.value.proofreading.rounds=n.rounds.map(s=>({name:s.name||"轮次",provider:s.provider||"siliconflow",apiKey:s.apiKey||"",modelName:s.modelName||"",customBaseUrl:s.customBaseUrl||"",prompt:s.prompt||"",batchSize:t(s.batchSize,3),sessionReset:t(s.sessionReset,20),rpmLimit:t(s.rpmLimit,7),maxRetries:t(s.maxRetries,M),lowReasoning:s.lowReasoning||!1,noThinkingMethod:s.noThinkingMethod||"gemini",forceJsonOutput:s.forceJsonOutput||!1})))}if(e.boxExpandRatio!==void 0&&(o.value.boxExpand.ratio=t(e.boxExpandRatio,0)),e.boxExpandTop!==void 0&&(o.value.boxExpand.top=t(e.boxExpandTop,0)),e.boxExpandBottom!==void 0&&(o.value.boxExpand.bottom=t(e.boxExpandBottom,0)),e.boxExpandLeft!==void 0&&(o.value.boxExpand.left=t(e.boxExpandLeft,0)),e.boxExpandRight!==void 0&&(o.value.boxExpand.right=t(e.boxExpandRight,0)),e.usePreciseMask!==void 0&&(o.value.preciseMask.enabled=e.usePreciseMask),e.maskDilateSize!==void 0&&(o.value.preciseMask.dilateSize=t(e.maskDilateSize,5)),e.maskBoxExpandRatio!==void 0&&(o.value.preciseMask.boxExpandRatio=t(e.maskBoxExpandRatio,0)),e.pdfProcessingMethod&&(o.value.pdfProcessingMethod=e.pdfProcessingMethod),e.showDetectionDebug!==void 0&&(o.value.showDetectionDebug=e.showDetectionDebug),e.providerSettings&&typeof e.providerSettings=="object"){const n=e.providerSettings;if(n.modelProvider)for(const[s,a]of Object.entries(n.modelProvider))i.value.translation[s]={apiKey:a.apiKey,modelName:a.modelName,customBaseUrl:a.customBaseUrl,rpmLimit:t(a.rpmTranslation,U),maxRetries:t(a.translationMaxRetries,I)};if(n.hqTranslateProvider)for(const[s,a]of Object.entries(n.hqTranslateProvider))i.value.hqTranslation[s]={apiKey:a.hqApiKey,modelName:a.hqModelName,customBaseUrl:a.hqCustomBaseUrl,batchSize:t(a.hqBatchSize,3),sessionReset:t(a.hqSessionReset,20),rpmLimit:t(a.hqRpmLimit,7),maxRetries:t(a.hqMaxRetries,D),lowReasoning:a.hqLowReasoning,noThinkingMethod:a.hqNoThinkingMethod||"gemini",forceJsonOutput:a.hqForceJsonOutput,useStream:a.hqUseStream,prompt:a.hqPrompt};if(n.aiVisionProvider)for(const[s,a]of Object.entries(n.aiVisionProvider))i.value.aiVisionOcr[s]={apiKey:a.aiVisionApiKey,modelName:a.aiVisionModelName,customBaseUrl:a.customAiVisionBaseUrl,prompt:a.aiVisionOcrPrompt,rpmLimit:t(a.rpmAiVisionOcr,B),isJsonMode:a.aiVisionPromptModeSelect==="json"}}console.log("[Settings] 后端设置映射完成")}function Ze(){const e={},t={},n={};for(const[s,a]of Object.entries(i.value.translation))e[s]={apiKey:a.apiKey||"",modelName:a.modelName||"",customBaseUrl:a.customBaseUrl||"",rpmTranslation:String(a.rpmLimit||0),translationMaxRetries:String(a.maxRetries||3)};for(const[s,a]of Object.entries(i.value.hqTranslation))t[s]={hqApiKey:a.apiKey||"",hqModelName:a.modelName||"",hqCustomBaseUrl:a.customBaseUrl||"",hqBatchSize:String(a.batchSize||3),hqSessionReset:String(a.sessionReset||20),hqRpmLimit:String(a.rpmLimit||7),hqMaxRetries:String(a.maxRetries||2),hqLowReasoning:a.lowReasoning||!1,hqNoThinkingMethod:a.noThinkingMethod||"gemini",hqForceJsonOutput:a.forceJsonOutput??!0,hqUseStream:a.useStream||!1,hqPrompt:a.prompt||""};for(const[s,a]of Object.entries(i.value.aiVisionOcr))n[s]={aiVisionApiKey:a.apiKey||"",aiVisionModelName:a.modelName||"",customAiVisionBaseUrl:a.customBaseUrl||"",aiVisionOcrPrompt:a.prompt||"",rpmAiVisionOcr:String(a.rpmLimit||0),aiVisionPromptModeSelect:a.isJsonMode?"json":"normal"};return{ocrEngine:{},aiVisionProvider:n,modelProvider:e,hqTranslateProvider:t}}async function We(){try{const{saveUserSettings:e}=await q(async()=>{const{saveUserSettings:s}=await import("./config.CwRcCkM9.js");return{saveUserSettings:s}},__vite__mapDeps([0,1,2]));L(o.value.translation.provider),A(o.value.hqTranslation.provider),b(o.value.aiVisionOcr.provider);const t={ocrEngine:o.value.ocrEngine,sourceLanguage:o.value.sourceLanguage,textDetector:o.value.textDetector,baiduApiKey:o.value.baiduOcr.apiKey,baiduSecretKey:o.value.baiduOcr.secretKey,baiduVersion:o.value.baiduOcr.version,baiduSourceLanguage:o.value.baiduOcr.sourceLanguage,aiVisionProvider:o.value.aiVisionOcr.provider,aiVisionApiKey:o.value.aiVisionOcr.apiKey,aiVisionModelName:o.value.aiVisionOcr.modelName,aiVisionOcrPrompt:o.value.aiVisionOcr.prompt,customAiVisionBaseUrl:o.value.aiVisionOcr.customBaseUrl,rpmAiVisionOcr:String(o.value.aiVisionOcr.rpmLimit),aiVisionPromptModeSelect:o.value.aiVisionOcr.isJsonMode?"json":"normal",modelProvider:o.value.translation.provider,apiKey:o.value.translation.apiKey,modelName:o.value.translation.modelName,customBaseUrl:o.value.translation.customBaseUrl,rpmTranslation:String(o.value.translation.rpmLimit),translationMaxRetries:String(o.value.translation.maxRetries),translatePromptModeSelect:o.value.translation.isJsonMode?"json":"normal",promptContent:o.value.translatePrompt,enableTextboxPrompt:o.value.useTextboxPrompt,textboxPromptContent:o.value.textboxPrompt,hqTranslateProvider:o.value.hqTranslation.provider,hqApiKey:o.value.hqTranslation.apiKey,hqModelName:o.value.hqTranslation.modelName,hqCustomBaseUrl:o.value.hqTranslation.customBaseUrl,hqBatchSize:String(o.value.hqTranslation.batchSize),hqSessionReset:String(o.value.hqTranslation.sessionReset),hqRpmLimit:String(o.value.hqTranslation.rpmLimit),hqMaxRetries:String(o.value.hqTranslation.maxRetries),hqPrompt:o.value.hqTranslation.prompt,hqLowReasoning:o.value.hqTranslation.lowReasoning,hqNoThinkingMethod:o.value.hqTranslation.noThinkingMethod,hqForceJsonOutput:o.value.hqTranslation.forceJsonOutput,hqUseStream:o.value.hqTranslation.useStream,proofreadingEnabled:o.value.proofreading.enabled,proofreadingMaxRetries:String(o.value.proofreading.maxRetries),proofreading:{enabled:o.value.proofreading.enabled,maxRetries:String(o.value.proofreading.maxRetries),rounds:o.value.proofreading.rounds.map(s=>({name:s.name,provider:s.provider,apiKey:s.apiKey,modelName:s.modelName,customBaseUrl:s.customBaseUrl,prompt:s.prompt,batchSize:s.batchSize,sessionReset:s.sessionReset,rpmLimit:s.rpmLimit,lowReasoning:s.lowReasoning,forceJsonOutput:s.forceJsonOutput}))},boxExpandRatio:String(o.value.boxExpand.ratio),boxExpandTop:String(o.value.boxExpand.top),boxExpandBottom:String(o.value.boxExpand.bottom),boxExpandLeft:String(o.value.boxExpand.left),boxExpandRight:String(o.value.boxExpand.right),usePreciseMask:o.value.preciseMask.enabled,maskDilateSize:String(o.value.preciseMask.dilateSize),maskBoxExpandRatio:String(o.value.preciseMask.boxExpandRatio||0),pdfProcessingMethod:o.value.pdfProcessingMethod,showDetectionDebug:o.value.showDetectionDebug,providerSettings:Ze()},n=await e(t);return n.success?(console.log("[Settings] 设置已保存到后端"),!0):(console.error("[Settings] 保存设置到后端失败:",n),!1)}catch(e){return console.error("[Settings] 保存设置到后端出错:",e),!1}}function Qe(){o.value=H(),u(),console.log("设置已重置为默认值")}function ke(e,t){const n={...e};for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const a=s,T=t[a],R=n[a];T!=null&&typeof T=="object"&&!Array.isArray(T)&&R!==null&&typeof R=="object"&&!Array.isArray(R)?n[a]={...R,...T}:T!==void 0&&(n[a]=T)}return n}return{settings:o,providerConfigs:i,customFontPresets:l,textStyle:c,ocrEngine:m,sourceLanguage:p,translationProvider:d,hqProvider:P,isProofreadingEnabled:h,updateSettings:O,updateTextStyle:x,setOcrEngine:g,setTextDetector:w,setSourceLanguage:C,updateBaiduOcr:ce,updateAiVisionOcr:me,setTranslationProvider:de,updateTranslationService:fe,setTranslatePrompt:ve,setTextboxPrompt:he,setUseTextboxPrompt:ge,setTranslatePromptMode:Te,setAiVisionOcrPromptMode:Oe,setHqProvider:xe,updateHqTranslation:Re,setHqUseStream:_e,setHqNoThinkingMethod:ye,setHqForceJsonOutput:qe,setProofreadingEnabled:Ee,addProofreadingRound:Pe,updateProofreadingRound:Se,removeProofreadingRound:Ne,setProofreadingMaxRetries:Me,updateBoxExpand:Le,updatePreciseMask:Ae,setPdfProcessingMethod:be,setShowDetectionDebug:Ve,saveProviderConfig:Ue,restoreProviderConfig:Be,saveTranslationProviderConfig:L,restoreTranslationProviderConfig:J,saveHqProviderConfig:A,restoreHqProviderConfig:j,saveAiVisionOcrProviderConfig:b,restoreAiVisionOcrProviderConfig:z,setAiVisionOcrProvider:pe,modelHistory:r,addModelToHistory:Ie,getModelHistory:De,clearModelHistory:Ke,addCustomFontPreset:Fe,removeCustomFontPreset:we,saveToStorage:u,loadFromStorage:Z,initSettings:He,resetToDefaults:Qe,loadFromBackend:Ye,saveToBackend:We}}),ut=Object.freeze(Object.defineProperty({__proto__:null,useSettingsStore:ne},Symbol.toStringTag,{value:"Module"})),v=S([]);let le=0;const Bo=3e4,K=o=>{o.timer&&(clearTimeout(o.timer),o.timer=void 0)},E=(o,i="info",r=3e3)=>{const l=++le,c=`msg_${Date.now()}_${Math.floor(Math.random()*1e3)}`,m={id:l,messageId:c,message:o,type:i,isHTML:!1};return r>0&&(m.timer=setTimeout(()=>{Y(l)},r)),v.value.push(m),l},Y=o=>{const i=v.value.findIndex(r=>r.id===o);if(i!==-1){const r=v.value[i];r&&K(r),v.value.splice(i,1)}},X=()=>{v.value.forEach(o=>{K(o)}),v.value=[]},Io=(o,i)=>E(o,"success",i),Do=(o,i)=>E(o,"error",i),Ko=(o,i)=>E(o,"info",i),Fo=(o,i)=>E(o,"warning",i),wo=(o,i="info",r=!1,l=5e3,c="")=>{const m=c||`msg_${Date.now()}_${Math.floor(Math.random()*1e3)}`;X();const p=++le,d={id:p,messageId:m,message:o,type:i,isHTML:r},P=Math.max(l,Bo);return d.timer=setTimeout(()=>{Y(p)},l>0?l:P),v.value.push(d),m},Co=o=>{if(!o)return;const i=v.value.findIndex(r=>r.messageId===o);if(i!==-1){const r=v.value[i];r&&K(r),v.value.splice(i,1)}},Jo=(o="")=>{if(o==="")X();else{const i=[];v.value.forEach((r,l)=>{r.type===o&&(K(r),i.push(l))});for(let r=i.length-1;r>=0;r--){const l=i[r];l!==void 0&&v.value.splice(l,1)}}},f={toasts:v,addToast:E,removeToast:Y,clearAll:X,success:Io,error:Do,info:Ko,warning:Fo,showGeneralMessage:wo,clearGeneralMessageById:Co,clearAllGeneralMessages:Jo};function ct(){return f}function mt(o,i="info",r=3e3){return E(o,i,r)}const jo={class:"vue-toast-container"},zo=["innerHTML"],$o={key:1},Ho=["onClick"],Go=ae({__name:"ToastNotification",setup(o,{expose:i}){const r=f.toasts,l=c=>{f.removeToast(c)};return oo(()=>{f.clearAll()}),i({toasts:r,addToast:f.addToast,removeToast:f.removeToast,clearAll:f.clearAll,success:f.success,error:f.error,info:f.info,warning:f.warning,showGeneralMessage:f.showGeneralMessage,clearGeneralMessageById:f.clearGeneralMessageById,clearAllGeneralMessages:f.clearAllGeneralMessages}),(c,m)=>(y(),to(ro,{to:"body"},[k("div",jo,[G(ao,{name:"toast-slide"},{default:io(()=>[(y(!0),N(ie,null,so(re(r),p=>(y(),N("div",{key:p.id,class:no(["vue-toast-message","vue-toast-"+p.type])},[p.isHTML?(y(),N("span",{key:0,innerHTML:p.message},null,8,zo)):(y(),N("span",$o,lo(p.message),1)),k("button",{class:"vue-toast-close",onClick:uo(d=>l(p.id),["stop"])},"×",8,Ho)],2))),128))]),_:1})])]))}}),Yo=(o,i)=>{const r=o.__vccOpts||o;for(const[l,c]of i)r[l]=c;return r},Xo=Yo(Go,[["__scopeId","data-v-28b4c9eb"]]),Zo=ae({__name:"App",setup(o){const i=ne();return co(()=>{i.initSettings()}),(r,l)=>(y(),N(ie,null,[G(re(mo)),G(Xo)],64))}}),Wo=[{path:"/",name:"bookshelf",component:()=>q(()=>import("./BookshelfView.BneeUztZ.js"),__vite__mapDeps([3,4,5,6,1,2,7,8,9,10])),meta:{title:"书架"}},{path:"/translate",name:"translate",component:()=>q(()=>import("./TranslateView.DPKnSjrC.js"),__vite__mapDeps([11,5,7,1,2,0,12,13,8,9,6,14])),meta:{title:"翻译"},props:o=>({bookId:o.query.book,chapterId:o.query.chapter})},{path:"/reader",name:"reader",component:()=>q(()=>import("./ReaderView.BPp5Dtcj.js"),__vite__mapDeps([15,5,6,1,2,16])),meta:{title:"阅读器"},props:o=>({bookId:o.query.book,chapterId:o.query.chapter}),beforeEnter:(o,i,r)=>{!o.query.book||!o.query.chapter?r({name:"bookshelf"}):r()}},{path:"/insight",name:"insight",component:()=>q(()=>import("./InsightView.Bu9YHaHm.js"),__vite__mapDeps([17,5,4,6,1,2,12,13,8,9,0,18])),meta:{title:"漫画分析"},props:o=>({bookId:o.query.book})},{path:"/:pathMatch(.*)*",redirect:{name:"bookshelf"}}],ue=po({history:fo("/"),routes:Wo});ue.beforeEach((o,i,r)=>{const l=o.meta.title;document.title=l?`${l} - Saber Translator`:"Saber Translator",r()});const F=vo(Zo),Qo=ho();F.use(Qo);F.use(ue);F.config.errorHandler=(o,i,r)=>{console.error("Vue 错误:",o,r)};F.mount("#app");export{st as B,Po as D,tt as F,lt as L,Yo as _,q as a,Eo as b,qo as c,Oo as d,ct as e,_o as f,se as g,Ro as h,xo as i,yo as j,et as k,rt as l,nt as m,it as n,at as o,ot as p,ut as q,mt as s,ne as u};
