const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/bookshelf.C_zUWUVG.js","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js"])))=>i.map(i=>d[i]);
import{_ as N,s as u,a as ge,u as $e}from"./index.D0MSxQDE.js";import{u as se,_ as Te}from"./bookshelfStore.DRMKtdSW.js";import{a as j,c as A,i as r,h as a,n as ee,v as D,e,k as J,t as w,F as z,j as P,x as X,r as g,y as te,z as oe,A as ie,l as re,b as U,w as ae,B as Z,g as le,C as ye,o as Ce,f as he,D as we,u as ne}from"./vue-vendor.BToK7iAN.js";import"./client.Bht704G-.js";import{g as Be}from"./system.DQNodmdY.js";import{B as _e}from"./BaseModal.Chcbe_b7.js";import"./bookshelf.C_zUWUVG.js";import"./utils-vendor.B9ygI19o.js";const Me="/static/vue/pic/github.jpg",xe=["checked"],De={class:"book-cover"},Ie=["src","alt"],Se={key:1,class:"book-cover-placeholder"},Ae={class:"book-info"},Ee=["title"],Re={class:"book-chapter-count"},Le={key:0,class:"book-tags"},Ve=j({__name:"BookCard",props:{book:{},selected:{type:Boolean,default:!1},batchMode:{type:Boolean,default:!1}},emits:["click","edit","select","contextMenu"],setup(_,{emit:S}){const c=_,h=S,v=se(),f=A(()=>v.tags);function b(){c.batchMode?h("select"):h("click")}function k(n){n.preventDefault(),h("contextMenu",n)}function l(n){return f.value.find(B=>B.name===n)?.color||"#667eea"}function $(){return!!c.book.cover&&c.book.cover.length>0}function T(n){const y=n.target;if(y.parentElement){y.style.display="none";const B=document.createElement("div");B.className="book-cover-placeholder",B.textContent="ğŸ“–",y.parentElement.appendChild(B)}}return(n,y)=>(a(),r("div",{class:ee(["book-card",{selected:_.selected,"batch-mode":_.batchMode}]),onClick:b,onContextmenu:k},[_.batchMode?(a(),r("div",{key:0,class:"book-checkbox",onClick:y[2]||(y[2]=J(B=>h("select"),["stop"]))},[e("input",{type:"checkbox",checked:_.selected,onClick:y[0]||(y[0]=J(()=>{},["stop"])),onChange:y[1]||(y[1]=B=>h("select"))},null,40,xe)])):D("",!0),e("div",De,[$()?(a(),r("img",{key:0,src:_.book.cover,alt:_.book.title,onError:T},null,40,Ie)):(a(),r("div",Se,"ğŸ“–"))]),e("div",Ae,[e("h3",{class:"book-title",title:_.book.title},w(_.book.title),9,Ee),e("p",Re,w(_.book.chapter_count||_.book.chapters?.length||0)+" ç« èŠ‚",1),_.book.tags&&_.book.tags.length>0?(a(),r("div",Le,[(a(!0),r(z,null,P(_.book.tags,B=>(a(),r("span",{key:B,class:"book-tag",style:X({background:l(B)})},w(B),5))),128))])):D("",!0)])],34))}}),Fe=N(Ve,[["__scopeId","data-v-a50985d9"]]),Ue={class:"filter-bar"},Oe={class:"search-box"},ze={key:0,class:"tag-filter"},Pe={class:"tag-chips"},qe=["onClick"],Ke=j({__name:"BookSearch",props:{tags:{}},emits:["search","filterTag"],setup(_,{emit:S}){const c=S,h=se(),v=g(""),f=A(()=>v.value.length>0);function b(){c("search",v.value)}function k(){v.value="",c("search","")}let l;function $(){clearTimeout(l),l=setTimeout(()=>{b()},300)}function T(y){c("filterTag",y)}function n(y){return h.selectedTagIds.includes(y)}return(y,B)=>(a(),r("div",Ue,[e("div",Oe,[te(e("input",{"onUpdate:modelValue":B[0]||(B[0]=I=>v.value=I),type:"text",placeholder:"æœç´¢ä¹¦ç±åç§°æˆ–æ ‡ç­¾...",autocomplete:"off",onInput:$,onKeypress:ie(b,["enter"])},null,544),[[oe,v.value]]),e("button",{class:"search-btn",onClick:b},"ğŸ”"),f.value?(a(),r("button",{key:0,class:"clear-search-btn",onClick:k}," âœ• ")):D("",!0)]),_.tags.length>0?(a(),r("div",ze,[B[1]||(B[1]=e("span",{class:"filter-label"},"æ ‡ç­¾ç­›é€‰:",-1)),e("div",Pe,[(a(!0),r(z,null,P(_.tags,I=>(a(),r("span",{key:I.id,class:ee(["tag-chip",{active:n(I.name)}]),style:X(I.color?{"--tag-color":I.color,backgroundColor:n(I.name)?I.color:""}:{}),onClick:q=>T(I.name)},w(I.name),15,qe))),128))])])):D("",!0)]))}}),Ne=N(Ke,[["__scopeId","data-v-dd828b80"]]),je={class:"form-group"},Ge={class:"form-group"},Qe={class:"cover-preview"},We=["src"],Xe={key:1,class:"cover-placeholder"},Ye={class:"form-group"},He={class:"tag-input-container"},Je={class:"selected-tags"},Ze=["onClick"],et={class:"tag-dropdown"},tt=["onKeypress"],ot={key:0,class:"tag-suggestions"},st=["onClick"],nt=j({__name:"BookModal",props:{bookId:{default:null}},emits:["close","saved"],setup(_,{emit:S}){const c=_,h=S,v=se(),f=g(""),b=g(null),k=g([]),l=g(""),$=g(!1),T=A(()=>!!c.bookId),n=A(()=>T.value?"ç¼–è¾‘ä¹¦ç±":"æ–°å»ºä¹¦ç±"),y=A(()=>v.tags),B=A(()=>{if(!l.value)return y.value;const p=l.value.toLowerCase();return y.value.filter(i=>i.name.toLowerCase().includes(p)&&!k.value.includes(i.id))});re(()=>{if(c.bookId){const p=v.books.find(i=>i.id===c.bookId);p&&(f.value=p.title,b.value=p.cover||null,p.tags&&p.tags.length>0&&(k.value=p.tags.map(i=>y.value.find(L=>L.name===i)?.id).filter(i=>!!i)))}});function I(p){const m=p.target.files?.[0];if(!m)return;if(!m.type.startsWith("image/")){u("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶","error");return}const L=new FileReader;L.onload=H=>{b.value=H.target?.result},L.readAsDataURL(m)}function q(p){p.preventDefault();const i=p.dataTransfer?.files[0];if(!i||!i.type.startsWith("image/"))return;const m=new FileReader;m.onload=L=>{b.value=L.target?.result},m.readAsDataURL(i)}function R(p){k.value.includes(p)||k.value.push(p),l.value="",$.value=!1}async function G(){const p=l.value.trim();if(!p)return;const i=y.value.find(m=>m.name===p);if(i){R(i.id);return}try{const m=await v.createTag(p);m&&R(m.id)}catch{u("åˆ›å»ºæ ‡ç­¾å¤±è´¥","error")}}function E(p){k.value=k.value.filter(i=>i!==p)}function Q(p){return y.value.find(m=>m.id===p)?.name||p}async function Y(){if(!f.value.trim()){u("è¯·è¾“å…¥ä¹¦ç±åç§°","warning");return}const p=k.value.map(i=>Q(i));try{T.value&&c.bookId?await v.updateBookApi(c.bookId,{title:f.value.trim(),cover:b.value||void 0})?(v.updateBook(c.bookId,{tags:p}),u("ä¹¦ç±æ›´æ–°æˆåŠŸ","success"),h("saved")):u("æ›´æ–°å¤±è´¥","error"):await v.createBook(f.value.trim(),void 0,b.value||void 0,p.length>0?p:void 0)?(u("ä¹¦ç±åˆ›å»ºæˆåŠŸ","success"),h("saved")):u("åˆ›å»ºå¤±è´¥","error")}catch{u(T.value?"æ›´æ–°å¤±è´¥":"åˆ›å»ºå¤±è´¥","error")}}return(p,i)=>(a(),U(_e,{title:n.value,onClose:i[6]||(i[6]=m=>h("close"))},{footer:ae(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:i[5]||(i[5]=m=>h("close"))},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-primary",onClick:Y},"ä¿å­˜")]),default:ae(()=>[e("form",{onSubmit:J(Y,["prevent"])},[e("div",je,[i[7]||(i[7]=e("label",{for:"bookTitle"},[Z("ä¹¦ç±åç§° "),e("span",{class:"required"},"*")],-1)),te(e("input",{id:"bookTitle","onUpdate:modelValue":i[0]||(i[0]=m=>f.value=m),type:"text",placeholder:"è¯·è¾“å…¥ä¹¦ç±åç§°",required:""},null,512),[[oe,f.value]])]),e("div",Ge,[i[9]||(i[9]=e("label",null,"å°é¢å›¾ç‰‡",-1)),e("div",{class:"cover-upload-area",onDragover:i[1]||(i[1]=J(()=>{},["prevent"])),onDrop:q,onClick:i[2]||(i[2]=m=>p.$refs.coverInput.click())},[e("input",{ref:"coverInput",type:"file",accept:"image/*",hidden:"",onChange:I},null,544),e("div",Qe,[b.value?(a(),r("img",{key:0,src:b.value,alt:"å°é¢é¢„è§ˆ"},null,8,We)):(a(),r("div",Xe,[...i[8]||(i[8]=[e("span",{class:"upload-icon"},"ğŸ“·",-1),e("span",null,"ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å°é¢",-1)])]))])],32),i[10]||(i[10]=e("p",{class:"form-hint"},"æ”¯æŒ JPGã€PNGã€WebP æ ¼å¼ï¼Œå»ºè®®æ¯”ä¾‹ 3:4",-1))]),e("div",Ye,[i[11]||(i[11]=e("label",null,"æ ‡ç­¾",-1)),e("div",He,[e("div",Je,[(a(!0),r(z,null,P(k.value,m=>(a(),r("span",{key:m,class:"selected-tag"},[Z(w(Q(m))+" ",1),e("button",{type:"button",class:"remove-tag",onClick:L=>E(m)},"Ã—",8,Ze)]))),128))]),e("div",et,[te(e("input",{"onUpdate:modelValue":i[3]||(i[3]=m=>l.value=m),type:"text",placeholder:"è¾“å…¥æ ‡ç­¾åç§°...",autocomplete:"off",onFocus:i[4]||(i[4]=m=>$.value=!0),onKeypress:ie(J(G,["prevent"]),["enter"])},null,40,tt),[[oe,l.value]]),$.value&&B.value.length>0?(a(),r("div",ot,[(a(!0),r(z,null,P(B.value,m=>(a(),r("button",{key:m.id,type:"button",class:"tag-suggestion",onClick:L=>R(m.id)},w(m.name),9,st))),128))])):D("",!0)])]),i[12]||(i[12]=e("p",{class:"form-hint"},"è¾“å…¥åæŒ‰å›è½¦æ·»åŠ æ–°æ ‡ç­¾ï¼Œæˆ–ä»å·²æœ‰æ ‡ç­¾ä¸­é€‰æ‹©",-1))])],32)]),_:1},8,["title"]))}}),at=N(nt,[["__scopeId","data-v-087929e9"]]),lt={class:"modal active"},it={class:"modal-content modal-large"},rt={class:"modal-header"},ct={class:"modal-body"},ut={key:0,class:"book-detail-container"},dt={class:"book-info-section"},vt={class:"book-cover-large"},mt=["src"],ft={key:1,class:"book-cover-placeholder"},pt={class:"book-meta"},bt={class:"meta-item"},kt={key:0,class:"detail-tags"},gt=["onClick"],ht={key:1,class:"no-tags-hint"},yt={class:"meta-item"},Ct={class:"meta-item"},_t={class:"meta-item"},$t={class:"chapters-section"},Tt={key:0,class:"chapters-list"},wt=["onDragstart","onDragover","onDrop"],Bt={class:"chapter-info"},Mt={class:"chapter-order"},xt={class:"chapter-title"},Dt={class:"chapter-meta"},It={class:"chapter-actions"},St=["onClick"],At=["disabled","onClick"],Et=["onClick"],Rt=["onClick"],Lt={key:1,class:"empty-state-small"},Vt={key:0,class:"modal active"},Ft={class:"modal-content modal-small"},Ut={class:"modal-header"},Ot={class:"modal-body"},zt={class:"form-group"},Pt={class:"modal-footer"},qt={key:0,class:"modal active"},Kt={class:"modal-content modal-small"},Nt={class:"modal-header"},jt={class:"modal-body"},Gt={key:0,class:"tag-select-list"},Qt=["onClick"],Wt={class:"tag-name"},Xt={key:0,class:"tag-check"},Yt={key:1,class:"empty-state-small"},Ht={class:"modal-footer"},Jt={key:0,class:"modal active"},Zt={class:"modal-content modal-small"},eo={class:"modal-header"},to={class:"modal-body"},oo={class:"modal-footer"},so=j({__name:"BookDetailModal",emits:["close","edit"],setup(_,{emit:S}){const c=S,h=ye(),v=se(),f=g(!1),b=g(null),k=g(""),l=g(!1),$=g("book"),T=g(null),n=A(()=>v.currentBook),y=A(()=>n.value?.chapters||[]),B=A(()=>v.tags);function I(d){return d?new Date(d).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function q(d){return B.value.find(t=>t.name===d)?.color||"#667eea"}function R(){n.value&&(c("edit",n.value.id),c("close"))}function G(){$.value="book",l.value=!0}async function E(){try{$.value==="book"&&n.value?await v.deleteBookApi(n.value.id)?(u("ä¹¦ç±å·²åˆ é™¤","success"),c("close")):u("åˆ é™¤å¤±è´¥","error"):$.value==="chapter"&&T.value&&n.value&&(await v.deleteChapterApi(n.value.id,T.value)?u("ç« èŠ‚å·²åˆ é™¤","success"):u("åˆ é™¤å¤±è´¥","error"))}catch{u("åˆ é™¤å¤±è´¥","error")}l.value=!1,T.value=null}function Q(){b.value=null,k.value="",f.value=!0}function Y(d){const s=y.value.find(t=>t.id===d);s&&(b.value=d,k.value=s.title,f.value=!0)}async function p(){if(!k.value.trim()||!n.value){u("è¯·è¾“å…¥ç« èŠ‚åç§°","warning");return}try{b.value?await v.updateChapterApi(n.value.id,b.value,k.value.trim())?(u("ç« èŠ‚æ›´æ–°æˆåŠŸ","success"),f.value=!1):u("æ›´æ–°å¤±è´¥","error"):await v.createChapterApi(n.value.id,k.value.trim())?(u("ç« èŠ‚åˆ›å»ºæˆåŠŸ","success"),f.value=!1):u("åˆ›å»ºå¤±è´¥","error")}catch{u("ä¿å­˜å¤±è´¥","error")}}function i(d){$.value="chapter",T.value=d,l.value=!0}function m(d){n.value&&h.push({path:"/translate",query:{book:n.value.id,chapter:d}})}function L(d){n.value&&h.push({path:"/reader",query:{book:n.value.id,chapter:d}})}function H(){n.value&&h.push({path:"/insight",query:{book:n.value.id}})}async function ce(d){if(n.value)try{await v.reorderChaptersApi(n.value.id,d)?u("ç« èŠ‚æ’åºå·²æ›´æ–°","success"):u("æ’åºå¤±è´¥","error")}catch{u("æ’åºå¤±è´¥","error")}}const V=g(null),K=g(null);function ue(d,s){V.value=s,d.dataTransfer&&(d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("text/plain",s.toString()))}function de(d,s){d.preventDefault(),d.dataTransfer&&(d.dataTransfer.dropEffect="move"),K.value=s}function ve(){K.value=null}async function me(d,s){if(d.preventDefault(),V.value===null||V.value===s||!n.value){V.value=null,K.value=null;return}const t=[...y.value],[o]=t.splice(V.value,1);t.splice(s,0,o);const M=t.map(C=>C.id);await ce(M),V.value=null,K.value=null}function fe(){V.value=null,K.value=null}const F=g(!1);function W(){F.value=!0}const x=g(!1);async function pe(d){if(!(!n.value||x.value)){x.value=!0;try{const{batchRemoveTags:s}=await ge(async()=>{const{batchRemoveTags:o}=await import("./bookshelf.C_zUWUVG.js");return{batchRemoveTags:o}},__vite__mapDeps([0,1,2]));(await s([n.value.id],[d])).success?(v.removeTagFromBook(n.value.id,d),u("æ ‡ç­¾å·²ç§»é™¤","success")):u("ç§»é™¤æ ‡ç­¾å¤±è´¥","error")}catch(s){u("æ“ä½œå¤±è´¥","error"),console.error("ç§»é™¤æ ‡ç­¾å¤±è´¥:",s)}finally{x.value=!1}}}async function be(d){if(!n.value||x.value)return;const s=n.value.tags?.includes(d);x.value=!0;try{const{batchAddTags:t,batchRemoveTags:o}=await ge(async()=>{const{batchAddTags:M,batchRemoveTags:C}=await import("./bookshelf.C_zUWUVG.js");return{batchAddTags:M,batchRemoveTags:C}},__vite__mapDeps([0,1,2]));s?(await o([n.value.id],[d])).success?(v.removeTagFromBook(n.value.id,d),u("æ ‡ç­¾å·²ç§»é™¤","success")):u("ç§»é™¤æ ‡ç­¾å¤±è´¥","error"):(await t([n.value.id],[d])).success?(v.addTagToBook(n.value.id,d),u("æ ‡ç­¾å·²æ·»åŠ ","success")):u("æ·»åŠ æ ‡ç­¾å¤±è´¥","error")}catch(t){u("æ“ä½œå¤±è´¥","error"),console.error("æ ‡ç­¾æ“ä½œå¤±è´¥:",t)}finally{x.value=!1}}return(d,s)=>(a(),r(z,null,[e("div",lt,[e("div",{class:"modal-overlay",onClick:s[0]||(s[0]=t=>c("close"))}),e("div",it,[e("div",rt,[s[12]||(s[12]=e("h2",null,"ä¹¦ç±è¯¦æƒ…",-1)),e("button",{class:"modal-close",onClick:s[1]||(s[1]=t=>c("close"))},"Ã—")]),e("div",ct,[n.value?(a(),r("div",ut,[e("div",dt,[e("div",vt,[n.value.cover?(a(),r("img",{key:0,src:n.value.cover,alt:"å°é¢"},null,8,mt)):(a(),r("div",ft,"ğŸ“–"))]),e("div",pt,[e("h3",null,w(n.value.title),1),e("p",bt,[s[13]||(s[13]=e("span",null,"æ ‡ç­¾ï¼š",-1)),n.value.tags&&n.value.tags.length>0?(a(),r("span",kt,[(a(!0),r(z,null,P(n.value.tags,t=>(a(),r("span",{key:t,class:"detail-tag",style:X({background:q(t)})},[Z(w(t)+" ",1),e("span",{class:"remove-detail-tag",onClick:J(o=>pe(t),["stop"])},"Ã—",8,gt)],4))),128))])):(a(),r("span",ht,"æš‚æ— æ ‡ç­¾")),e("button",{class:"btn-add-tag",title:"æ·»åŠ æ ‡ç­¾",onClick:W},"+")]),e("p",yt,[s[14]||(s[14]=e("span",null,"ç« èŠ‚æ•°ï¼š",-1)),e("span",null,w(y.value.length),1)]),e("p",Ct,[s[15]||(s[15]=e("span",null,"åˆ›å»ºæ—¶é—´ï¼š",-1)),e("span",null,w(I(n.value.created_at||n.value.createdAt)),1)]),e("p",_t,[s[16]||(s[16]=e("span",null,"æœ€åæ›´æ–°ï¼š",-1)),e("span",null,w(I(n.value.updated_at||n.value.updatedAt)),1)]),e("div",{class:"book-actions"},[e("button",{class:"btn btn-sm btn-primary",onClick:H},"â— æ¼«ç”»åˆ†æ"),e("button",{class:"btn btn-sm btn-secondary",onClick:R},"ç¼–è¾‘ä¹¦ç±"),e("button",{class:"btn btn-sm btn-danger",onClick:G},"åˆ é™¤ä¹¦ç±")])])]),e("div",$t,[e("div",{class:"section-header"},[s[18]||(s[18]=e("h3",null,"ç« èŠ‚åˆ—è¡¨",-1)),e("button",{class:"btn btn-sm btn-primary",onClick:Q},[...s[17]||(s[17]=[e("span",{class:"btn-icon"},"+",-1),Z(" æ–°å»ºç« èŠ‚ ",-1)])])]),y.value.length>0?(a(),r("div",Tt,[(a(!0),r(z,null,P(y.value,(t,o)=>(a(),r("div",{key:t.id,class:ee(["chapter-item",{dragging:V.value===o,"drag-over":K.value===o&&V.value!==o}]),draggable:"true",onDragstart:M=>ue(M,o),onDragover:M=>de(M,o),onDragleave:ve,onDrop:M=>me(M,o),onDragend:fe},[s[19]||(s[19]=e("div",{class:"chapter-drag-handle",title:"æ‹–æ‹½æ’åº"},"â‹®â‹®",-1)),e("div",Bt,[e("span",Mt,"#"+w(o+1),1),e("span",xt,w(t.title),1),e("span",Dt,w(t.image_count||t.imageCount||0)+" å¼ å›¾ç‰‡",1)]),e("div",It,[e("button",{class:"chapter-action-btn chapter-enter-btn",onClick:M=>m(t.id)}," è¿›å…¥ç¿»è¯‘ ",8,St),e("button",{class:"chapter-action-btn chapter-read-btn",disabled:(t.image_count||t.imageCount||0)===0,onClick:M=>L(t.id)}," è¿›å…¥é˜…è¯» ",8,At),e("button",{class:"chapter-action-btn",onClick:M=>Y(t.id)}," ç¼–è¾‘ ",8,Et),e("button",{class:"chapter-action-btn danger",onClick:M=>i(t.id)}," åˆ é™¤ ",8,Rt)])],42,wt))),128))])):(a(),r("div",Lt,[...s[20]||(s[20]=[e("p",null,"æš‚æ— ç« èŠ‚ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»º",-1)])]))])])):D("",!0)])])]),(a(),U(le,{to:"body"},[f.value?(a(),r("div",Vt,[e("div",{class:"modal-overlay",onClick:s[2]||(s[2]=t=>f.value=!1)}),e("div",Ft,[e("div",Ut,[e("h2",null,w(b.value?"ç¼–è¾‘ç« èŠ‚":"æ–°å»ºç« èŠ‚"),1),e("button",{class:"modal-close",onClick:s[3]||(s[3]=t=>f.value=!1)},"Ã—")]),e("div",Ot,[e("div",zt,[s[21]||(s[21]=e("label",{for:"chapterTitleInput"},[Z("ç« èŠ‚åç§° "),e("span",{class:"required"},"*")],-1)),te(e("input",{id:"chapterTitleInput","onUpdate:modelValue":s[4]||(s[4]=t=>k.value=t),type:"text",placeholder:"ä¾‹å¦‚ï¼šç¬¬1è¯ã€åºç« ",onKeypress:ie(p,["enter"])},null,544),[[oe,k.value]])])]),e("div",Pt,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[5]||(s[5]=t=>f.value=!1)},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-primary",onClick:p},"ä¿å­˜")])])])):D("",!0)])),(a(),U(le,{to:"body"},[F.value?(a(),r("div",qt,[e("div",{class:"modal-overlay",onClick:s[6]||(s[6]=t=>F.value=!1)}),e("div",Kt,[e("div",Nt,[s[22]||(s[22]=e("h2",null,"æ·»åŠ æ ‡ç­¾",-1)),e("button",{class:"modal-close",onClick:s[7]||(s[7]=t=>F.value=!1)},"Ã—")]),e("div",jt,[B.value.length>0?(a(),r("div",Gt,[(a(!0),r(z,null,P(B.value,t=>(a(),r("div",{key:t.id,class:ee(["tag-select-item",{selected:n.value?.tags?.includes(t.name)}]),onClick:o=>be(t.name)},[e("span",{class:"tag-color",style:X({background:t.color||"#667eea"})},null,4),e("span",Wt,w(t.name),1),n.value?.tags?.includes(t.name)?(a(),r("span",Xt,"âœ“")):D("",!0)],10,Qt))),128))])):(a(),r("div",Yt,[...s[23]||(s[23]=[e("p",null,'æš‚æ— æ ‡ç­¾ï¼Œè¯·å…ˆåœ¨"ç®¡ç†æ ‡ç­¾"ä¸­åˆ›å»º',-1)])]))]),e("div",Ht,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[8]||(s[8]=t=>F.value=!1)},"å…³é—­")])])])):D("",!0)])),(a(),U(le,{to:"body"},[l.value?(a(),r("div",Jt,[e("div",{class:"modal-overlay",onClick:s[9]||(s[9]=t=>l.value=!1)}),e("div",Zt,[e("div",eo,[s[24]||(s[24]=e("h2",null,"ç¡®è®¤åˆ é™¤",-1)),e("button",{class:"modal-close",onClick:s[10]||(s[10]=t=>l.value=!1)},"Ã—")]),e("div",to,[e("p",null,w($.value==="book"?"ç¡®å®šè¦åˆ é™¤è¿™æœ¬ä¹¦ç±å—ï¼Ÿæ‰€æœ‰ç« èŠ‚æ•°æ®å°†ä¸€å¹¶åˆ é™¤ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚":"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç« èŠ‚å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"),1)]),e("div",oo,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[11]||(s[11]=t=>l.value=!1)},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-danger",onClick:E},"åˆ é™¤")])])])):D("",!0)]))],64))}}),no=N(so,[["__scopeId","data-v-ee7c0782"]]),ao={class:"tag-manage-form"},lo={class:"form-row"},io={class:"tag-list"},ro={key:0,class:"empty-hint"},co={class:"tag-name"},uo=["onClick"],vo=j({__name:"TagManageModal",emits:["close"],setup(_,{emit:S}){const c=S,h=se(),v=g(""),f=g("#667eea"),b=A(()=>h.tags);async function k(){const $=v.value.trim();if(!$){u("è¯·è¾“å…¥æ ‡ç­¾åç§°","warning");return}if(b.value.some(T=>T.name===$)){u("æ ‡ç­¾å·²å­˜åœ¨","warning");return}try{await h.createTag($,f.value),u("æ ‡ç­¾åˆ›å»ºæˆåŠŸ","success"),v.value="",f.value="#667eea"}catch{u("åˆ›å»ºå¤±è´¥","error")}}async function l($){try{await h.deleteTagApi($)?u("æ ‡ç­¾å·²åˆ é™¤","success"):u("åˆ é™¤å¤±è´¥","error")}catch{u("åˆ é™¤å¤±è´¥","error")}}return($,T)=>(a(),U(_e,{title:"æ ‡ç­¾ç®¡ç†",onClose:T[3]||(T[3]=n=>c("close"))},{footer:ae(()=>[e("button",{class:"btn btn-secondary",onClick:T[2]||(T[2]=n=>c("close"))},"å…³é—­")]),default:ae(()=>[e("div",ao,[e("div",lo,[te(e("input",{"onUpdate:modelValue":T[0]||(T[0]=n=>v.value=n),type:"text",placeholder:"è¾“å…¥æ–°æ ‡ç­¾åç§°...",onKeypress:ie(k,["enter"])},null,544),[[oe,v.value]]),te(e("input",{"onUpdate:modelValue":T[1]||(T[1]=n=>f.value=n),type:"color",title:"é€‰æ‹©é¢œè‰²"},null,512),[[oe,f.value]]),e("button",{class:"btn btn-primary btn-sm",onClick:k},"æ·»åŠ ")])]),e("div",io,[b.value.length===0?(a(),r("div",ro," æš‚æ— æ ‡ç­¾ï¼Œè¯·æ·»åŠ æ–°æ ‡ç­¾ ")):D("",!0),(a(!0),r(z,null,P(b.value,n=>(a(),r("div",{key:n.id,class:"tag-item"},[e("span",{class:"tag-color",style:X({backgroundColor:n.color||"#667eea"})},null,4),e("span",co,w(n.name),1),e("button",{class:"btn-delete",title:"åˆ é™¤æ ‡ç­¾",onClick:y=>l(n.id)}," Ã— ",8,uo)]))),128))])]),_:1}))}}),mo=N(vo,[["__scopeId","data-v-6d57c976"]]),fo=j({__name:"BookContextMenu",props:{x:{},y:{},bookId:{}},emits:["close","openDetail","edit","delete","manageTags","enterBatchMode"],setup(_,{emit:S}){const c=_,h=S,v=g(null);function f(k){v.value&&!v.value.contains(k.target)&&h("close")}function b(k){switch(k){case"detail":h("openDetail",c.bookId);break;case"edit":h("edit",c.bookId);break;case"delete":h("delete",c.bookId);break;case"tags":h("manageTags",c.bookId);break;case"batch":h("enterBatchMode");break}h("close")}return re(()=>{setTimeout(()=>{document.addEventListener("click",f)},0)}),Ce(()=>{document.removeEventListener("click",f)}),(k,l)=>(a(),r("div",{ref_key:"menuRef",ref:v,class:"context-menu",style:X({left:`${_.x}px`,top:`${_.y}px`})},[e("button",{class:"menu-item",onClick:l[0]||(l[0]=$=>b("detail"))},[...l[5]||(l[5]=[e("span",{class:"menu-icon"},"ğŸ“–",-1),e("span",null,"æ‰“å¼€è¯¦æƒ…",-1)])]),e("button",{class:"menu-item",onClick:l[1]||(l[1]=$=>b("edit"))},[...l[6]||(l[6]=[e("span",{class:"menu-icon"},"âœï¸",-1),e("span",null,"ç¼–è¾‘ä¹¦ç±",-1)])]),e("button",{class:"menu-item",onClick:l[2]||(l[2]=$=>b("tags"))},[...l[7]||(l[7]=[e("span",{class:"menu-icon"},"ğŸ·ï¸",-1),e("span",null,"ç®¡ç†æ ‡ç­¾",-1)])]),l[10]||(l[10]=e("div",{class:"menu-divider"},null,-1)),e("button",{class:"menu-item",onClick:l[3]||(l[3]=$=>b("batch"))},[...l[8]||(l[8]=[e("span",{class:"menu-icon"},"â˜‘ï¸",-1),e("span",null,"æ‰¹é‡æ“ä½œ",-1)])]),l[11]||(l[11]=e("div",{class:"menu-divider"},null,-1)),e("button",{class:"menu-item menu-item-danger",onClick:l[4]||(l[4]=$=>b("delete"))},[...l[9]||(l[9]=[e("span",{class:"menu-icon"},"ğŸ—‘ï¸",-1),e("span",null,"åˆ é™¤ä¹¦ç±",-1)])])],4))}}),po=N(fo,[["__scopeId","data-v-fe06f690"]]),bo={class:"modal-content confirm-modal-content"},ko={class:"modal-header"},go={class:"modal-title"},ho={class:"modal-body confirm-modal-body"},yo={class:"confirm-message"},Co={class:"modal-footer confirm-modal-footer"},_o=j({__name:"ConfirmModal",props:{message:{},title:{default:"ç¡®è®¤æ“ä½œ"},confirmText:{default:"ç¡®å®š"},cancelText:{default:"å–æ¶ˆ"},confirmType:{default:"primary"}},emits:["confirm","cancel"],setup(_,{emit:S}){const c=S,h=g(null);function v(){c("confirm")}function f(){c("cancel")}function b(l){l.target===l.currentTarget&&c("cancel")}function k(l){l.key==="Escape"?c("cancel"):l.key==="Enter"&&c("confirm")}return re(()=>{document.addEventListener("keydown",k),h.value?.focus()}),Ce(()=>{document.removeEventListener("keydown",k)}),(l,$)=>(a(),r("div",{ref_key:"modalRef",ref:h,class:"modal-overlay confirm-modal-overlay",tabindex:"-1",onClick:b},[e("div",bo,[e("div",ko,[e("h3",go,w(_.title),1),e("button",{class:"modal-close-btn",onClick:f,title:"å…³é—­"},"Ã—")]),e("div",ho,[e("p",yo,w(_.message),1)]),e("div",Co,[e("button",{class:"btn btn-secondary",onClick:f},w(_.cancelText),1),e("button",{class:ee(["btn",_.confirmType==="danger"?"btn-danger":"btn-primary"]),onClick:v},w(_.confirmText),3)])])],512))}}),$o=N(_o,[["__scopeId","data-v-f6f7303a"]]),To={class:"bookshelf-page"},wo={class:"app-header"},Bo={class:"header-content"},Mo={class:"logo-container"},xo={class:"header-links"},Do={class:"lan-access-info",title:"å…¶ä»–è®¾å¤‡å¯é€šè¿‡æ­¤åœ°å€è®¿é—®"},Io={id:"lanUrl"},So={class:"bookshelf-main"},Ao={key:0,class:"batch-toolbar"},Eo={class:"batch-info"},Ro=["checked"],Lo={class:"books-container"},Vo={key:0,class:"books-grid"},Fo={key:1,class:"empty-state"},Uo={key:2,class:"empty-state"},Oo={key:0,class:"modal active"},zo={class:"modal-content modal-small"},Po={class:"modal-header"},qo={class:"modal-body"},Ko={class:"batch-tag-hint"},No={key:0,class:"tag-select-list"},jo=["onClick"],Go={class:"tag-name"},Qo={key:0,class:"tag-check"},Wo={key:1,class:"empty-state-small"},Xo={class:"modal-footer"},Yo=["disabled"],Ho=j({__name:"BookshelfView",setup(_){const S=ye(),c=se(),h=$e(),v=g("è·å–ä¸­..."),f=g(!1),b=g(!1),k=g(!1),l=g(!1),$=g(null),T=g(""),n=g(null),y=g(!1),B=g(0),I=g(0),q=g(null),R=A(()=>c.filteredBooks),G=A(()=>c.tags),E=A(()=>c.selectedBooks),Q=A(()=>c.batchMode),Y=A(()=>R.value.length===0&&!c.searchQuery);re(async()=>{await Promise.all([c.loadBooks(),c.loadTags()]);try{const t=await Be();t.success&&t.lan_address&&(v.value=t.lan_address)}catch(t){console.error("è·å–æœåŠ¡å™¨ä¿¡æ¯å¤±è´¥:",t),v.value="è·å–å¤±è´¥"}});async function p(){try{await navigator.clipboard.writeText(v.value),u("å±€åŸŸç½‘åœ°å€å·²å¤åˆ¶ï¼","success")}catch{const t=document.createElement("textarea");t.value=v.value,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),u("å±€åŸŸç½‘åœ°å€å·²å¤åˆ¶ï¼","success")}}function i(){$.value=null,f.value=!0}function m(t){$.value=t,f.value=!0}async function L(t){try{const M=await(await fetch(`/api/bookshelf/books/${t}`)).json();M.success&&M.book&&c.updateBook(t,M.book)}catch(o){console.error("åŠ è½½ä¹¦ç±è¯¦æƒ…å¤±è´¥:",o)}c.setCurrentBook(t),b.value=!0}function H(){k.value=!0}function ce(){c.enterBatchMode()}function V(){c.exitBatchMode()}function K(){E.value.size===R.value.length?c.clearSelection():R.value.forEach(t=>{c.selectBook(t.id)})}function ue(){if(E.value.size===0){u("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„ä¹¦ç±","warning");return}T.value=`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${E.value.size} æœ¬ä¹¦ç±å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,n.value=async()=>{try{await c.batchDeleteBooks(Array.from(E.value)),u("æ‰¹é‡åˆ é™¤æˆåŠŸ","success"),V()}catch{u("æ‰¹é‡åˆ é™¤å¤±è´¥","error")}},l.value=!0}function de(){S.push("/translate")}function ve(t,o){t.preventDefault(),B.value=t.clientX,I.value=t.clientY,q.value=o,y.value=!0}function me(){y.value=!1,q.value=null}function fe(t){T.value="ç¡®å®šè¦åˆ é™¤è¿™æœ¬ä¹¦ç±å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚",n.value=async()=>{try{await c.deleteBookApi(t),u("åˆ é™¤æˆåŠŸ","success")}catch{u("åˆ é™¤å¤±è´¥","error")}},l.value=!0}const F=g(!1),W=g("add"),x=g([]);function pe(){if(E.value.size===0){u("è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„ä¹¦ç±","warning");return}W.value="add",x.value=[],F.value=!0}function be(){if(E.value.size===0){u("è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„ä¹¦ç±","warning");return}W.value="remove",x.value=[],F.value=!0}function d(t){const o=x.value.indexOf(t);o>=0?x.value.splice(o,1):x.value.push(t)}async function s(){if(x.value.length===0){u("è¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªæ ‡ç­¾","warning");return}const t=Array.from(E.value);try{const{batchAddTags:o,batchRemoveTags:M}=await ge(async()=>{const{batchAddTags:C,batchRemoveTags:O}=await import("./bookshelf.C_zUWUVG.js");return{batchAddTags:C,batchRemoveTags:O}},__vite__mapDeps([0,1,2]));if(W.value==="add")if((await o(t,x.value)).success){for(const O of t)for(const ke of x.value)c.addTagToBook(O,ke);u(`å·²ä¸º ${t.length} æœ¬ä¹¦æ·»åŠ æ ‡ç­¾`,"success")}else u("æ·»åŠ æ ‡ç­¾å¤±è´¥","error");else if((await M(t,x.value)).success){for(const O of t)for(const ke of x.value)c.removeTagFromBook(O,ke);u(`å·²ä» ${t.length} æœ¬ä¹¦ç§»é™¤æ ‡ç­¾`,"success")}else u("ç§»é™¤æ ‡ç­¾å¤±è´¥","error");F.value=!1,V()}catch(o){u("æ“ä½œå¤±è´¥","error"),console.error("æ‰¹é‡æ ‡ç­¾æ“ä½œå¤±è´¥:",o)}}return(t,o)=>{const M=we("router-link");return a(),r("div",To,[e("header",wo,[e("div",Bo,[e("div",Mo,[he(M,{to:"/",title:"ä¹¦æ¶é¦–é¡µ"},{default:ae(()=>[...o[10]||(o[10]=[e("img",{src:Te,alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",xo,[e("span",Do,[o[11]||(o[11]=e("span",{class:"lan-icon"},"ğŸŒå±€åŸŸç½‘è®¾å¤‡å¯é€šè¿‡è¯¥ç½‘å€è®¿é—®",-1)),e("span",Io,w(v.value),1),e("button",{class:"copy-btn",title:"å¤åˆ¶åœ°å€",onClick:p},"ğŸ“‹")]),o[13]||(o[13]=e("a",{href:"http://www.mashirosaber.top",target:"_blank",class:"tutorial-link"},"ä½¿ç”¨æ•™ç¨‹",-1)),o[14]||(o[14]=e("a",{href:"https://github.com/MashiroSaber03/Saber-Translator",target:"_blank",class:"github-link"},[e("img",{src:Me,alt:"GitHub",class:"github-icon"})],-1)),e("button",{class:"theme-toggle",title:"åˆ‡æ¢äº®æš—æ¨¡å¼",onClick:o[0]||(o[0]=(...C)=>ne(h).toggleTheme&&ne(h).toggleTheme(...C))},[...o[12]||(o[12]=[e("span",{class:"theme-icon light-icon"},"â˜€ï¸",-1),e("span",{class:"theme-icon dark-icon"},"ğŸŒ™",-1)])])])])]),e("main",So,[e("div",{class:"bookshelf-toolbar"},[o[18]||(o[18]=e("h1",{class:"page-title"},"æˆ‘çš„ä¹¦æ¶",-1)),e("div",{class:"toolbar-actions"},[e("button",{class:"btn btn-primary",onClick:i},[...o[15]||(o[15]=[e("span",{class:"btn-icon"},"+",-1),e("span",null,"æ–°å»ºä¹¦ç±",-1)])]),e("button",{class:"btn btn-secondary",onClick:H},[...o[16]||(o[16]=[e("span",null,"ğŸ·ï¸ ç®¡ç†æ ‡ç­¾",-1)])]),e("button",{class:"btn btn-secondary",onClick:de},[...o[17]||(o[17]=[e("span",null,"å¿«é€Ÿç¿»è¯‘",-1)])])])]),he(Ne,{tags:G.value,onSearch:ne(c).setSearchQuery,onFilterTag:ne(c).toggleTagFilter},null,8,["tags","onSearch","onFilterTag"]),Q.value?(a(),r("div",Ao,[e("div",Eo,[e("input",{type:"checkbox",checked:E.value.size===R.value.length&&R.value.length>0,onChange:K},null,40,Ro),e("span",null,w(E.value.size),1),o[19]||(o[19]=Z(" æœ¬å·²é€‰ä¸­ ",-1))]),e("div",{class:"batch-actions"},[e("button",{class:"btn btn-sm btn-secondary",onClick:pe},"ğŸ·ï¸ æ·»åŠ æ ‡ç­¾"),e("button",{class:"btn btn-sm btn-secondary",onClick:be},"â– ç§»é™¤æ ‡ç­¾"),e("button",{class:"btn btn-sm btn-danger",onClick:ue},"ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤"),e("button",{class:"btn btn-sm btn-secondary",onClick:V},"å–æ¶ˆ")])])):D("",!0),e("div",Lo,[R.value.length>0?(a(),r("div",Vo,[(a(!0),r(z,null,P(R.value,C=>(a(),U(Fe,{key:C.id,book:C,selected:E.value.has(C.id),"batch-mode":Q.value,onClick:O=>L(C.id),onEdit:O=>m(C.id),onSelect:O=>ne(c).toggleBookSelection(C.id),onContextmenu:O=>ve(O,C.id)},null,8,["book","selected","batch-mode","onClick","onEdit","onSelect","onContextmenu"]))),128))])):Y.value?(a(),r("div",Fo,[o[21]||(o[21]=e("div",{class:"empty-icon"},"ğŸ“š",-1)),o[22]||(o[22]=e("h2",null,"ä¹¦æ¶ç©ºç©ºå¦‚ä¹Ÿ",-1)),o[23]||(o[23]=e("p",null,'ç‚¹å‡»"æ–°å»ºä¹¦ç±"å¼€å§‹ä½ çš„ç¿»è¯‘ä¹‹æ—…',-1)),e("button",{class:"btn btn-primary",onClick:i},[...o[20]||(o[20]=[e("span",{class:"btn-icon"},"+",-1),e("span",null,"æ–°å»ºç¬¬ä¸€æœ¬ä¹¦",-1)])])])):(a(),r("div",Uo,[...o[24]||(o[24]=[e("div",{class:"empty-icon"},"ğŸ”",-1),e("h2",null,"æœªæ‰¾åˆ°åŒ¹é…çš„ä¹¦ç±",-1),e("p",null,"å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–æ ‡ç­¾ç­›é€‰",-1)])]))])]),f.value?(a(),U(at,{key:0,"book-id":$.value,onClose:o[1]||(o[1]=C=>f.value=!1),onSaved:o[2]||(o[2]=C=>f.value=!1)},null,8,["book-id"])):D("",!0),b.value?(a(),U(no,{key:1,onClose:o[3]||(o[3]=C=>b.value=!1),onEdit:m})):D("",!0),k.value?(a(),U(mo,{key:2,onClose:o[4]||(o[4]=C=>k.value=!1)})):D("",!0),l.value?(a(),U($o,{key:3,message:T.value,onConfirm:o[5]||(o[5]=C=>{n.value?.(),l.value=!1}),onCancel:o[6]||(o[6]=C=>l.value=!1)},null,8,["message"])):D("",!0),y.value&&q.value?(a(),U(po,{key:4,x:B.value,y:I.value,"book-id":q.value,onClose:me,onOpenDetail:L,onEdit:m,onDelete:fe,onManageTags:H,onEnterBatchMode:ce},null,8,["x","y","book-id"])):D("",!0),(a(),U(le,{to:"body"},[F.value?(a(),r("div",Oo,[e("div",{class:"modal-overlay",onClick:o[7]||(o[7]=C=>F.value=!1)}),e("div",zo,[e("div",Po,[e("h2",null,w(W.value==="add"?"æ‰¹é‡æ·»åŠ æ ‡ç­¾":"æ‰¹é‡ç§»é™¤æ ‡ç­¾"),1),e("button",{class:"modal-close",onClick:o[8]||(o[8]=C=>F.value=!1)},"Ã—")]),e("div",qo,[e("p",Ko,w(W.value==="add"?"é€‰æ‹©è¦æ·»åŠ åˆ°é€‰ä¸­ä¹¦ç±çš„æ ‡ç­¾ï¼š":"é€‰æ‹©è¦ä»é€‰ä¸­ä¹¦ç±ç§»é™¤çš„æ ‡ç­¾ï¼š"),1),G.value.length>0?(a(),r("div",No,[(a(!0),r(z,null,P(G.value,C=>(a(),r("div",{key:C.id,class:ee(["tag-select-item",{selected:x.value.includes(C.name)}]),onClick:O=>d(C.name)},[e("span",{class:"tag-color",style:X({background:C.color||"#667eea"})},null,4),e("span",Go,w(C.name),1),x.value.includes(C.name)?(a(),r("span",Qo,"âœ“")):D("",!0)],10,jo))),128))])):(a(),r("div",Wo,[...o[25]||(o[25]=[e("p",null,'æš‚æ— æ ‡ç­¾ï¼Œè¯·å…ˆåœ¨"ç®¡ç†æ ‡ç­¾"ä¸­åˆ›å»º',-1)])]))]),e("div",Xo,[e("button",{type:"button",class:"btn btn-secondary",onClick:o[9]||(o[9]=C=>F.value=!1)},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-primary",disabled:x.value.length===0,onClick:s}," ç¡®å®š ",8,Yo)])])])):D("",!0)]))])}}}),ls=N(Ho,[["__scopeId","data-v-6b8aaa48"]]);export{ls as default};
