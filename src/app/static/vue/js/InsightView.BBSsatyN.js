import{d as Ss,r as k,c as E,a as ne,e as m,l as Y,k as v,w as ke,f as e,h as L,g as Se,n as D,t as $,i as Cs,D as se,v as q,z as Q,o as we,F as N,j as W,u as te,p as ce,K as Ce,B as vt,m as Ee,x as be,L as Ps,b as Ts,C as Is,y as As}from"./vue-vendor.DIYfje1l.js";import{u as $t,_ as Ms}from"./bookshelfStore.Cp4MihB-.js";import{_ as de}from"./CustomSelect.vue_vue_type_style_index_0_lang.BbTiIb--.js";import{_ as ge,s as Rs}from"./index.BfDW3pgM.js";import{apiClient as J}from"./client.Bht704G-.js";import{B as Ls}from"./BaseModal.CMY-O8WE.js";import{fetchModels as Oe}from"./config.CwRcCkM9.js";import"./bookshelf.B4ums9uK.js";import"./utils-vendor.B9ygI19o.js";async function Bs(o,t){return J.post(`/api/manga-insight/${o}/analyze/start`,t)}async function zs(o,t){return J.post(`/api/manga-insight/${o}/analyze/pause`,{task_id:t})}async function Us(o,t){return J.post(`/api/manga-insight/${o}/analyze/resume`,{task_id:t})}async function Es(o,t){return J.post(`/api/manga-insight/${o}/analyze/cancel`,{task_id:t})}async function wt(o){return J.get(`/api/manga-insight/${o}/analyze/status`)}async function Ks(o,t){return J.post(`/api/manga-insight/${o}/reanalyze/page/${t}`)}async function Vs(o,t){return J.get(`/api/manga-insight/${o}/pages/${t}`)}function qs(o,t){return`/api/manga-insight/${o}/page-image/${t}`}function xt(o,t){return`/api/manga-insight/${o}/thumbnail/${t}`}async function Os(o){return J.get(`/api/manga-insight/${o}/chapters`)}async function Ds(o,t){return t?J.get(`/api/manga-insight/${o}/overview/${t}`):J.get(`/api/manga-insight/${o}/overview`)}async function Ns(o,t,l=!1){return J.post(`/api/manga-insight/${o}/overview/generate`,{template:t,force:l})}async function Fs(o){return J.get(`/api/manga-insight/${o}/overview/templates`)}async function js(o){return J.get(`/api/manga-insight/${o}/timeline`)}async function Qs(o){return J.post(`/api/manga-insight/${o}/regenerate/timeline`,{})}async function Hs(o,t,l){return J.post(`/api/manga-insight/${o}/chat`,{question:t,...l})}async function Gs(o){return J.post(`/api/manga-insight/${o}/rebuild-embeddings`,{})}async function Js(){return J.get("/api/manga-insight/config")}async function Zs(o){return J.post("/api/manga-insight/config",o)}async function Ws(o){return J.post("/api/manga-insight/config/test/vlm",o)}async function Xs(o){return J.post("/api/manga-insight/config/test/embedding",o)}async function Ys(o){return J.post("/api/manga-insight/config/test/reranker",o)}async function en(o){return J.post("/api/manga-insight/config/test/llm",o)}const gt={batch_analysis:{label:"ðŸ“„ æ‰¹é‡åˆ†æžæç¤ºè¯",hint:"ç”¨äºŽæ‰¹é‡åˆ†æžå¤šä¸ªé¡µé¢ã€‚æ”¯æŒå˜é‡ï¼š{page_count}, {start_page}, {end_page}"},segment_summary:{label:"ðŸ“‘ æ®µè½æ€»ç»“æç¤ºè¯",hint:"ç”¨äºŽæ±‡æ€»å¤šä¸ªæ‰¹æ¬¡çš„åˆ†æžç»“æžœç”Ÿæˆæ®µè½æ€»ç»“ã€‚"},chapter_summary:{label:"ðŸ“– ç« èŠ‚æ€»ç»“æç¤ºè¯",hint:"ç”¨äºŽç”Ÿæˆç« èŠ‚çº§åˆ«çš„å®Œæ•´æ€»ç»“ã€‚"},qa_response:{label:"ðŸ’¬ é—®ç­”å“åº”æç¤ºè¯",hint:"ç”¨äºŽå›žç­”ç”¨æˆ·å…³äºŽæ¼«ç”»å†…å®¹çš„é—®é¢˜ã€‚"}};async function tn(){return J.get("/api/manga-insight/prompts/defaults")}async function sn(){return J.get("/api/manga-insight/prompts/library")}async function nn(o){return J.post("/api/manga-insight/prompts/library",o)}async function ln(o){return J.delete(`/api/manga-insight/prompts/library/${o}`)}async function an(o){return J.post("/api/manga-insight/prompts/library/import",{library:o})}async function St(o){return J.get(`/api/manga-insight/${o}/export`)}const mt="insight_provider_configs",oe=Ss("insight",()=>{const o=k(null),t=k(null),l=k("idle"),n=k({current:0,total:0,status:"idle"}),s=k(0),r=k(0),u=k("full"),g=k(!0),d=k([]),p=k(new Map),f=k(null),C=k([]),T=k([]),I=k([]),A=k([]),z=k(null),U=k("all"),K=k(!1),O=k(!1),R=k(null),P=k(0),i=k({vlm:{provider:"gemini",apiKey:"",model:"gemini-2.0-flash",baseUrl:"",rpmLimit:10,temperature:.3,forceJson:!1,useStream:!0,imageMaxSize:0},llm:{useSameAsVlm:!0,provider:"gemini",apiKey:"",model:"gemini-2.0-flash",baseUrl:"",useStream:!0},embedding:{provider:"openai",apiKey:"",model:"text-embedding-3-small",baseUrl:"",rpmLimit:0},reranker:{provider:"jina",apiKey:"",model:"jina-reranker-v2-base-multilingual",baseUrl:"",topK:5},batch:{pagesPerBatch:5,contextBatchCount:1,architecturePreset:"standard",customLayers:[]},prompts:{}}),a=k({vlm:{},llm:{},embedding:{},reranker:{}}),c=E(()=>n.value.total===0?0:Math.round(n.value.current/n.value.total*100)),_=E(()=>l.value==="running"),x=E(()=>l.value==="completed"),y=E(()=>{if(r.value>0)return r.value;let h=0;return p.value.forEach(S=>{S.analyzed&&h++}),h}),B=E(()=>s.value||p.value.size),G=E(()=>U.value==="all"?A.value:A.value.filter(h=>h.type===U.value)),V=E(()=>z.value===null?null:p.value.get(z.value)||null);function w(h){o.value=h,h?(console.log(`å½“å‰åˆ†æžä¹¦ç±: ${h}`),console.log("å‡†å¤‡åŠ è½½ç¬”è®°..."),dt()):A.value=[]}function b(h){l.value=h,n.value.status=h,console.log(`åˆ†æžçŠ¶æ€: ${h}`)}function M(h){t.value=h}function X(h,S,F){n.value={current:h,total:S,status:l.value,message:F}}function le(h){u.value=h}function ye(h){g.value=h}function _e(h){s.value=h,console.log(`ä¹¦ç±æ€»é¡µæ•°: ${h}`)}function Be(h){r.value=h,console.log(`å·²åˆ†æžé¡µæ•°: ${h}`)}function je(h){d.value=h,console.log(`ç« èŠ‚åˆ—è¡¨å·²è®¾ç½®ï¼Œå…± ${h.length} ç« `)}function Qe(h,S){p.value.set(h,S)}function He(h){p.value.clear();for(const S of h)p.value.set(S.pageNum,S);console.log(`é¡µé¢æ•°æ®å·²è®¾ç½®ï¼Œå…± ${h.length} é¡µ`)}function ze(h){z.value=h}function Kt(h){f.value=h,h&&!C.value.includes(h.type)&&C.value.push(h.type)}function Vt(h){C.value=h}function qt(h){T.value=h,console.log(`æ—¶é—´çº¿å·²è®¾ç½®ï¼Œå…± ${h.length} ä¸ªäº‹ä»¶`)}function Ot(h){I.value.push(h)}function Dt(h){const S=I.value[I.value.length-1];S&&S.role==="assistant"&&(S.content=h)}function Nt(){I.value=[]}function Ft(){I.value=I.value.filter(h=>!h.isLoading)}function jt(h){O.value=h}function Qt(h){z.value=h}async function Ht(h){if(await Wt(h))A.value.unshift(h),console.log(`å·²æ·»åŠ ç¬”è®°: ${h.id}`);else throw new Error("ä¿å­˜ç¬”è®°åˆ°åŽç«¯å¤±è´¥")}async function Gt(h,S){const F=A.value.find(ue=>ue.id===h);F&&(Object.assign(F,S,{updatedAt:new Date().toISOString()}),await Xt(h,S),console.log(`å·²æ›´æ–°ç¬”è®°: ${h}`))}async function Jt(h){const S=A.value.findIndex(F=>F.id===h);S>=0&&(await Yt(h)?(A.value.splice(S,1),console.log(`å·²åˆ é™¤ç¬”è®°: ${h}`)):console.error(`åˆ é™¤ç¬”è®°å¤±è´¥: ${h}`))}function Zt(h){U.value=h}async function dt(){if(console.log("loadNotesFromAPI è¢«è°ƒç”¨, bookId:",o.value),!!o.value)try{const S=await(await fetch(`/api/manga-insight/${o.value}/notes`)).json();console.log("ç¬”è®°APIå“åº”:",S),S.success&&S.notes?(A.value=S.notes,console.log(`å·²ä»ŽAPIåŠ è½½ ${A.value.length} æ¡ç¬”è®°`)):(console.log("APIè¿”å›žæ— ç¬”è®°æ•°æ®"),A.value=[])}catch(h){console.error("ä»ŽAPIåŠ è½½ç¬”è®°å¤±è´¥:",h),A.value=[]}}async function Wt(h){if(!o.value)return!1;try{return(await(await fetch(`/api/manga-insight/${o.value}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)})).json()).success}catch(S){return console.error("ä¿å­˜ç¬”è®°åˆ°APIå¤±è´¥:",S),!1}}async function Xt(h,S){if(!o.value)return!1;try{return(await(await fetch(`/api/manga-insight/${o.value}/notes/${h}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)})).json()).success}catch(F){return console.error("æ›´æ–°ç¬”è®°åˆ°APIå¤±è´¥:",F),!1}}async function Yt(h){if(!o.value)return!1;try{return(await(await fetch(`/api/manga-insight/${o.value}/notes/${h}`,{method:"DELETE"})).json()).success}catch(S){return console.error("ä»ŽAPIåˆ é™¤ç¬”è®°å¤±è´¥:",S),!1}}function es(){P.value=Date.now(),console.log("è§¦å‘æ•°æ®åˆ·æ–°ï¼Œkey:",P.value)}function ts(h){K.value=h}function ss(h){R.value=h}function ns(h){i.value.vlm={...i.value.vlm,...h},Ge(i.value.vlm.provider),re()}function ls(h){i.value.llm={...i.value.llm,...h},Je(i.value.llm.provider),re()}function as(h){i.value.embedding={...i.value.embedding,...h},Ze(i.value.embedding.provider),re()}function os(h){i.value.reranker={...i.value.reranker,...h},We(i.value.reranker.provider),re()}function is(h){i.value.batch={...i.value.batch,...h},re()}function rs(h){i.value.prompts={...i.value.prompts,...h},re()}function us(h){const S=i.value.vlm.provider;S!==h&&(Ge(S),i.value.vlm.provider=h,gs(h),re(),console.log(`[Insight] VLM æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${h}`))}function cs(h){const S=i.value.llm.provider;S!==h&&(Je(S),i.value.llm.provider=h,ms(h),re(),console.log(`[Insight] LLM æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${h}`))}function ds(h){const S=i.value.embedding.provider;S!==h&&(Ze(S),i.value.embedding.provider=h,hs(h),re(),console.log(`[Insight] Embedding æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${h}`))}function ps(h){const S=i.value.reranker.provider;S!==h&&(We(S),i.value.reranker.provider=h,fs(h),re(),console.log(`[Insight] Reranker æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${h}`))}function Pe(){localStorage.setItem(mt,JSON.stringify(a.value))}function vs(){const h=localStorage.getItem(mt);if(h)try{const S=JSON.parse(h);a.value={vlm:S.vlm||{},llm:S.llm||{},embedding:S.embedding||{},reranker:S.reranker||{}},console.log("[Insight] å·²åŠ è½½æœåŠ¡å•†é…ç½®ç¼“å­˜")}catch(S){console.error("[Insight] åŠ è½½æœåŠ¡å•†é…ç½®ç¼“å­˜å¤±è´¥:",S)}}function Ge(h){h&&(a.value.vlm[h]={apiKey:i.value.vlm.apiKey,model:i.value.vlm.model,baseUrl:i.value.vlm.baseUrl,rpmLimit:i.value.vlm.rpmLimit,temperature:i.value.vlm.temperature,forceJson:i.value.vlm.forceJson,useStream:i.value.vlm.useStream,imageMaxSize:i.value.vlm.imageMaxSize},Pe(),console.log(`[Insight] ä¿å­˜ VLM æœåŠ¡å•†é…ç½®: ${h}`))}function gs(h){if(!h)return;const S=a.value.vlm[h];S?(S.apiKey!==void 0&&(i.value.vlm.apiKey=S.apiKey),S.model!==void 0&&(i.value.vlm.model=S.model),S.baseUrl!==void 0&&(i.value.vlm.baseUrl=S.baseUrl),S.rpmLimit!==void 0&&(i.value.vlm.rpmLimit=S.rpmLimit),S.temperature!==void 0&&(i.value.vlm.temperature=S.temperature),S.forceJson!==void 0&&(i.value.vlm.forceJson=S.forceJson),S.useStream!==void 0&&(i.value.vlm.useStream=S.useStream),S.imageMaxSize!==void 0&&(i.value.vlm.imageMaxSize=S.imageMaxSize),console.log(`[Insight] æ¢å¤ VLM æœåŠ¡å•†é…ç½®: ${h}`)):(i.value.vlm.apiKey="",i.value.vlm.model="",i.value.vlm.baseUrl="",console.log(`[Insight] ${h} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function Je(h){h&&(a.value.llm[h]={apiKey:i.value.llm.apiKey,model:i.value.llm.model,baseUrl:i.value.llm.baseUrl,useStream:i.value.llm.useStream},Pe(),console.log(`[Insight] ä¿å­˜ LLM æœåŠ¡å•†é…ç½®: ${h}`))}function ms(h){if(!h)return;const S=a.value.llm[h];S?(S.apiKey!==void 0&&(i.value.llm.apiKey=S.apiKey),S.model!==void 0&&(i.value.llm.model=S.model),S.baseUrl!==void 0&&(i.value.llm.baseUrl=S.baseUrl),S.useStream!==void 0&&(i.value.llm.useStream=S.useStream),console.log(`[Insight] æ¢å¤ LLM æœåŠ¡å•†é…ç½®: ${h}`)):(i.value.llm.apiKey="",i.value.llm.model="",i.value.llm.baseUrl="",console.log(`[Insight] ${h} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function Ze(h){h&&(a.value.embedding[h]={apiKey:i.value.embedding.apiKey,model:i.value.embedding.model,baseUrl:i.value.embedding.baseUrl,rpmLimit:i.value.embedding.rpmLimit},Pe(),console.log(`[Insight] ä¿å­˜ Embedding æœåŠ¡å•†é…ç½®: ${h}`))}function hs(h){if(!h)return;const S=a.value.embedding[h];S?(S.apiKey!==void 0&&(i.value.embedding.apiKey=S.apiKey),S.model!==void 0&&(i.value.embedding.model=S.model),S.baseUrl!==void 0&&(i.value.embedding.baseUrl=S.baseUrl),S.rpmLimit!==void 0&&(i.value.embedding.rpmLimit=S.rpmLimit),console.log(`[Insight] æ¢å¤ Embedding æœåŠ¡å•†é…ç½®: ${h}`)):(i.value.embedding.apiKey="",i.value.embedding.model="",i.value.embedding.baseUrl="",console.log(`[Insight] ${h} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function We(h){h&&(a.value.reranker[h]={apiKey:i.value.reranker.apiKey,model:i.value.reranker.model,baseUrl:i.value.reranker.baseUrl,topK:i.value.reranker.topK},Pe(),console.log(`[Insight] ä¿å­˜ Reranker æœåŠ¡å•†é…ç½®: ${h}`))}function fs(h){if(!h)return;const S=a.value.reranker[h];S?(S.apiKey!==void 0&&(i.value.reranker.apiKey=S.apiKey),S.model!==void 0&&(i.value.reranker.model=S.model),S.baseUrl!==void 0&&(i.value.reranker.baseUrl=S.baseUrl),S.topK!==void 0&&(i.value.reranker.topK=S.topK),console.log(`[Insight] æ¢å¤ Reranker æœåŠ¡å•†é…ç½®: ${h}`)):(i.value.reranker.apiKey="",i.value.reranker.model="",i.value.reranker.baseUrl="",console.log(`[Insight] ${h} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function bs(h){i.value=h,re()}function re(){localStorage.setItem("manga_insight_config",JSON.stringify(i.value))}function ks(){vs();const S=localStorage.getItem("manga_insight_config");if(S)try{const F=JSON.parse(S);i.value={vlm:{...i.value.vlm,...F.vlm},llm:{...i.value.llm,...F.llm},embedding:{...i.value.embedding,...F.embedding},reranker:{...i.value.reranker,...F.reranker},batch:{...i.value.batch,...F.batch},prompts:F.prompts||{}},console.log("å·²åŠ è½½æ¼«ç”»åˆ†æžé…ç½®")}catch(F){console.error("åŠ è½½æ¼«ç”»åˆ†æžé…ç½®å¤±è´¥:",F)}}function ys(){return{vlm:{provider:i.value.vlm.provider,api_key:i.value.vlm.apiKey,model:i.value.vlm.model,base_url:i.value.vlm.baseUrl||null,rpm_limit:i.value.vlm.rpmLimit,temperature:i.value.vlm.temperature,force_json:i.value.vlm.forceJson,use_stream:i.value.vlm.useStream,image_max_size:i.value.vlm.imageMaxSize},chat_llm:{use_same_as_vlm:i.value.llm.useSameAsVlm,provider:i.value.llm.provider,api_key:i.value.llm.apiKey,model:i.value.llm.model,base_url:i.value.llm.baseUrl||null,use_stream:i.value.llm.useStream},embedding:{provider:i.value.embedding.provider,api_key:i.value.embedding.apiKey,model:i.value.embedding.model,base_url:i.value.embedding.baseUrl||null,rpm_limit:i.value.embedding.rpmLimit},reranker:{provider:i.value.reranker.provider,api_key:i.value.reranker.apiKey,model:i.value.reranker.model,base_url:i.value.reranker.baseUrl||null,top_k:i.value.reranker.topK},analysis:{batch:{pages_per_batch:i.value.batch.pagesPerBatch,context_batch_count:i.value.batch.contextBatchCount,architecture_preset:i.value.batch.architecturePreset,custom_layers:i.value.batch.customLayers.map(h=>({name:h.name,units_per_group:h.units,align_to_chapter:h.align}))}},prompts:i.value.prompts,providerSettings:_s()}}function _s(){const h={},S={},F={},ue={};for(const[ie,ee]of Object.entries(a.value.vlm))h[ie]={api_key:ee.apiKey||"",model:ee.model||"",base_url:ee.baseUrl||"",rpm_limit:ee.rpmLimit??10,temperature:ee.temperature??.3,force_json:ee.forceJson??!1,use_stream:ee.useStream??!0,image_max_size:ee.imageMaxSize??0};for(const[ie,ee]of Object.entries(a.value.llm))S[ie]={api_key:ee.apiKey||"",model:ee.model||"",base_url:ee.baseUrl||"",use_stream:ee.useStream??!0};for(const[ie,ee]of Object.entries(a.value.embedding))F[ie]={api_key:ee.apiKey||"",model:ee.model||"",base_url:ee.baseUrl||"",rpm_limit:ee.rpmLimit??0};for(const[ie,ee]of Object.entries(a.value.reranker))ue[ie]={api_key:ee.apiKey||"",model:ee.model||"",base_url:ee.baseUrl||"",top_k:ee.topK??5};return{vlmProvider:h,llmProvider:S,embeddingProvider:F,rerankerProvider:ue}}function $s(h){const S=h.vlm,F=h.chat_llm,ue=h.embedding,ie=h.reranker,Te=h.analysis?.batch;if(S&&(i.value.vlm={provider:S.provider||"gemini",apiKey:S.api_key||"",model:S.model||"",baseUrl:S.base_url||"",rpmLimit:S.rpm_limit||10,temperature:S.temperature||.3,forceJson:S.force_json||!1,useStream:S.use_stream!==!1,imageMaxSize:S.image_max_size||0}),F&&(i.value.llm={useSameAsVlm:F.use_same_as_vlm!==!1,provider:F.provider||i.value.vlm.provider,apiKey:F.api_key||i.value.vlm.apiKey,model:F.model||i.value.vlm.model,baseUrl:F.base_url||i.value.vlm.baseUrl,useStream:F.use_stream!==!1}),ue&&(i.value.embedding={provider:ue.provider||"openai",apiKey:ue.api_key||"",model:ue.model||"",baseUrl:ue.base_url||"",rpmLimit:ue.rpm_limit??0}),ie&&(i.value.reranker={provider:ie.provider||"jina",apiKey:ie.api_key||"",model:ie.model||"",baseUrl:ie.base_url||"",topK:ie.top_k||5}),Te){const he=Te.custom_layers;i.value.batch={pagesPerBatch:Te.pages_per_batch||5,contextBatchCount:Te.context_batch_count??1,architecturePreset:Te.architecture_preset||"standard",customLayers:he?.map(Z=>({name:Z.name||"",units:Z.units_per_group||1,align:Z.align_to_chapter||!1}))||[]}}const me=h.providerSettings;if(me){if(me.vlmProvider)for(const[he,Z]of Object.entries(me.vlmProvider))a.value.vlm[he]={apiKey:Z.api_key||"",model:Z.model||"",baseUrl:Z.base_url||"",rpmLimit:Z.rpm_limit??10,temperature:Z.temperature??.3,forceJson:Z.force_json??!1,useStream:Z.use_stream??!0,imageMaxSize:Z.image_max_size??0};if(me.llmProvider)for(const[he,Z]of Object.entries(me.llmProvider))a.value.llm[he]={apiKey:Z.api_key||"",model:Z.model||"",baseUrl:Z.base_url||"",useStream:Z.use_stream??!0};if(me.embeddingProvider)for(const[he,Z]of Object.entries(me.embeddingProvider))a.value.embedding[he]={apiKey:Z.api_key||"",model:Z.model||"",baseUrl:Z.base_url||"",rpmLimit:Z.rpm_limit??0};if(me.rerankerProvider)for(const[he,Z]of Object.entries(me.rerankerProvider))a.value.reranker[he]={apiKey:Z.api_key||"",model:Z.model||"",baseUrl:Z.base_url||"",topK:Z.top_k??5};console.log("[Insight] å·²ä»ŽåŽç«¯æ¢å¤æœåŠ¡å•†é…ç½®ç¼“å­˜"),Pe()}const pt=h.prompts;pt&&(i.value.prompts=pt),re(),Ge(i.value.vlm.provider),Je(i.value.llm.provider),Ze(i.value.embedding.provider),We(i.value.reranker.provider),console.log("[Insight] å·²ä»Ž API åŠ è½½é…ç½®")}function ws(){l.value="idle",n.value={current:0,total:0,status:"idle"},p.value.clear(),f.value=null,T.value=[],console.log("åˆ†æžçŠ¶æ€å·²é‡ç½®")}function xs(){o.value=null,l.value="idle",n.value={current:0,total:0,status:"idle"},u.value="full",g.value=!0,d.value=[],p.value.clear(),f.value=null,C.value=[],T.value=[],I.value=[],A.value=[],z.value=null,U.value="all",K.value=!1,O.value=!1,R.value=null,console.log("æ¼«ç”»åˆ†æžçŠ¶æ€å·²é‡ç½®")}return{currentBookId:o,currentTaskId:t,analysisStatus:l,progress:n,analysisMode:u,incrementalAnalysis:g,chapters:d,pages:p,overview:f,generatedTemplates:C,timeline:T,qaHistory:I,notes:A,selectedPageNum:z,noteTypeFilter:U,isLoading:K,isStreaming:O,error:R,config:i,progressPercent:c,isAnalyzing:_,isAnalysisCompleted:x,analyzedPageCount:y,totalPageCount:B,filteredNotes:G,selectedPage:V,setCurrentBook:w,setCurrentTaskId:M,setAnalysisStatus:b,updateProgress:X,setAnalysisMode:le,setIncrementalAnalysis:ye,setBookTotalPages:_e,setAnalyzedPagesCount:Be,setChapters:je,setPageData:Qe,setPages:He,selectPage:ze,setOverview:Kt,setGeneratedTemplates:Vt,setTimeline:qt,dataRefreshKey:P,triggerDataRefresh:es,addQAMessage:Ot,updateLastAssistantMessage:Dt,clearQAHistory:Nt,removeLoadingMessages:Ft,setStreaming:jt,setCurrentPage:Qt,addNote:Ht,updateNote:Gt,deleteNote:Jt,setNoteTypeFilter:Zt,loadNotesFromAPI:dt,setLoading:ts,setError:ss,updateVlmConfig:ns,updateLlmConfig:ls,updateEmbeddingConfig:as,updateRerankerConfig:os,updateBatchConfig:is,updatePrompts:rs,setConfig:bs,saveConfigToStorage:re,loadConfigFromStorage:ks,getConfigForApi:ys,setConfigFromApi:$s,setVlmProvider:us,setLlmProvider:cs,setEmbeddingProvider:ds,setRerankerProvider:ps,resetAnalysis:ws,reset:xs}}),on={class:"book-selector"},rn=ne({__name:"BookSelector",emits:["select"],setup(o,{emit:t}){const l=t,n=$t(),s=E(()=>n.books),r=E(()=>{const d=[{label:"-- é€‰æ‹©ä¹¦ç± --",value:""}];return s.value.forEach(p=>{d.push({label:p.title||p.id,value:p.id})}),d}),u=k("");function g(d){const p=String(d);u.value=p,p&&l("select",p)}return(d,p)=>(v(),m("div",on,[Y(de,{modelValue:u.value,"onUpdate:modelValue":p[0]||(p[0]=f=>u.value=f),options:r.value,onChange:g},null,8,["modelValue","options"])]))}}),un=ge(rn,[["__scopeId","data-v-d6052909"]]),cn={class:"sidebar-section analysis-control-compact"},dn={class:"analysis-status-bar"},pn={class:"status-left"},vn={class:"status-label"},gn={class:"status-right"},mn={class:"status-progress"},hn={key:1,class:"progress-message"},fn={class:"analysis-btn-group"},bn={key:0,class:"btn-group-idle"},kn=["disabled"],yn={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},_n={key:1,class:"loading-spinner"},$n={key:1,class:"btn-group-running"},wn={key:2,class:"btn-group-paused"},xn={key:4,class:"page-input-wrapper"},Sn=["max"],Cn={class:"page-hint"},Pn={key:5,class:"mode-description"},Tn={key:6,class:"estimated-time"},In={class:"analysis-options-row"},An={class:"checkbox-compact",title:"ä»…åˆ†æžæœªåˆ†æžçš„é¡µé¢ï¼Œè·³è¿‡å·²åˆ†æžçš„é¡µé¢"},Mn=["checked"],Rn=["disabled"],Ln=ne({__name:"AnalysisProgress",emits:["start-polling","stop-polling"],setup(o,{emit:t}){const l=[{label:"å…¨ä¹¦",value:"full"},{label:"ç« èŠ‚",value:"chapter"},{label:"å•é¡µ",value:"page"}],n=E(()=>{const w=[{label:"é€‰æ‹©ç« èŠ‚...",value:""}];return r.chapters.forEach(b=>{w.push({label:`${b.title} (${b.startPage}-${b.endPage}é¡µ)`,value:b.id})}),w}),s=t,r=oe(),u=k("full"),g=k(""),d=k(null),p=k(!1),f=k(""),C=E(()=>{const w=r.analysisStatus;return{"status-dot":!0,running:w==="running",paused:w==="paused",completed:w==="completed",failed:w==="failed"}}),T=E(()=>{switch(r.analysisStatus){case"running":return"åˆ†æžä¸­";case"paused":return"å·²æš‚åœ";case"completed":return"å·²å®Œæˆ";case"failed":return"åˆ†æžå¤±è´¥";default:return"æœªåˆ†æž"}}),I=E(()=>{const{current:w,total:b}=r.progress;return b===0?"":`${w}/${b}`}),A=E(()=>r.analysisStatus==="idle"||r.analysisStatus==="completed"),z=E(()=>r.analysisStatus==="running"),U=E(()=>r.analysisStatus==="paused"),K=E(()=>r.analysisStatus==="completed"?"é‡æ–°åˆ†æž":"å¼€å§‹åˆ†æž"),O=E(()=>u.value==="chapter"),R=E(()=>u.value==="page"),P=E(()=>!(p.value||r.isAnalyzing||u.value==="chapter"&&!g.value||u.value==="page"&&!d.value)),i=E(()=>{switch(u.value){case"full":return"åˆ†æžæ•´æœ¬ä¹¦çš„æ‰€æœ‰é¡µé¢";case"chapter":return"ä»…åˆ†æžé€‰ä¸­ç« èŠ‚çš„é¡µé¢";case"page":return"ä»…åˆ†æžæŒ‡å®šçš„å•ä¸ªé¡µé¢";default:return""}}),a=E(()=>{const w=r.totalPageCount;if(w===0)return"";const b=r.config.batch.pagesPerBatch||5,X=Math.ceil(w/b)*10;return X<60?`çº¦ ${X} ç§’`:`çº¦ ${Math.ceil(X/60)} åˆ†é’Ÿ`});function c(){r.setAnalysisMode(u.value)}async function _(){if(r.currentBookId){if(r.isAnalyzing||p.value){console.warn("åˆ†æžæ­£åœ¨è¿›è¡Œä¸­æˆ–æ­£åœ¨å¯åŠ¨");return}if(u.value==="chapter"&&!g.value){f.value="è¯·é€‰æ‹©è¦åˆ†æžçš„ç« èŠ‚";return}if(u.value==="page"&&!d.value){f.value="è¯·è¾“å…¥è¦åˆ†æžçš„é¡µç ";return}p.value=!0,f.value="";try{const w={};u.value==="chapter"&&g.value?(w.mode="chapters",w.chapters=[g.value]):u.value==="page"&&d.value?(w.mode="pages",w.pages=[d.value]):w.mode=r.incrementalAnalysis?"incremental":"full";const b=await Bs(r.currentBookId,w);b.success?(b.task_id&&r.setCurrentTaskId(b.task_id),r.setAnalysisStatus("running"),s("start-polling")):(f.value=b.error||"å¯åŠ¨åˆ†æžå¤±è´¥",console.error("å¯åŠ¨åˆ†æžå¤±è´¥:",b.error))}catch(w){f.value=w instanceof Error?w.message:"å¯åŠ¨åˆ†æžå¤±è´¥",console.error("å¯åŠ¨åˆ†æžå¤±è´¥:",w)}finally{p.value=!1}}}async function x(){if(r.currentBookId)try{(await zs(r.currentBookId,r.currentTaskId||void 0)).success&&r.setAnalysisStatus("paused")}catch(w){console.error("æš‚åœåˆ†æžå¤±è´¥:",w)}}async function y(){if(r.currentBookId)try{(await Us(r.currentBookId,r.currentTaskId||void 0)).success&&(r.setAnalysisStatus("running"),s("start-polling"))}catch(w){console.error("ç»§ç»­åˆ†æžå¤±è´¥:",w)}}async function B(){if(r.currentBookId&&confirm("ç¡®å®šè¦å–æ¶ˆåˆ†æžå—ï¼Ÿ"))try{(await Es(r.currentBookId,r.currentTaskId||void 0)).success&&(r.setAnalysisStatus("idle"),r.setCurrentTaskId(null),s("stop-polling"))}catch(w){console.error("å–æ¶ˆåˆ†æžå¤±è´¥:",w)}}async function G(){if(!r.currentBookId){f.value="è¯·å…ˆé€‰æ‹©ä¹¦ç±";return}try{const w=await St(r.currentBookId);if(w.success&&w.markdown){const b=new Blob([w.markdown],{type:"text/markdown"}),M=URL.createObjectURL(b),X=document.createElement("a");X.href=M,X.download=`${r.currentBookId}_analysis.md`,X.click(),URL.revokeObjectURL(M)}else f.value=w.error||"å¯¼å‡ºå¤±è´¥"}catch(w){f.value=w instanceof Error?w.message:"å¯¼å‡ºå¤±è´¥",console.error("å¯¼å‡ºå¤±è´¥:",w)}}function V(){f.value=""}return ke(u,()=>{V()}),(w,b)=>(v(),m("div",cn,[e("div",dn,[e("div",pn,[e("span",{class:D(C.value)},null,2),e("span",vn,$(T.value),1)]),e("div",gn,[e("span",mn,$(I.value),1)])]),z.value||U.value?(v(),m("div",{key:0,class:D(["progress-bar-slim",{paused:U.value}])},[e("div",{class:"progress-fill-slim",style:Cs({width:se(r).progressPercent+"%"})},null,4)],2)):L("",!0),se(r).progress.message&&(z.value||U.value)?(v(),m("div",hn,$(se(r).progress.message),1)):L("",!0),f.value?(v(),m("div",{key:2,class:"error-message",onClick:V}," âš ï¸ "+$(f.value),1)):L("",!0),e("div",fn,[A.value?(v(),m("div",bn,[Y(de,{modelValue:u.value,"onUpdate:modelValue":b[0]||(b[0]=M=>u.value=M),options:l,onChange:c},null,8,["modelValue"]),e("button",{class:D(["btn-analysis-start",{loading:p.value}]),disabled:!P.value,onClick:_},[p.value?L("",!0):(v(),m("svg",yn,[...b[4]||(b[4]=[e("path",{d:"M8 5v14l11-7z"},null,-1)])])),p.value?(v(),m("span",_n)):L("",!0),e("span",null,$(p.value?"å¯åŠ¨ä¸­...":K.value),1)],10,kn)])):L("",!0),z.value?(v(),m("div",$n,[e("button",{class:"btn-control btn-pause",title:"æš‚åœåˆ†æž",onClick:x},[...b[5]||(b[5]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})],-1),e("span",{class:"btn-label"},"æš‚åœ",-1)])]),e("button",{class:"btn-control btn-cancel",title:"å–æ¶ˆåˆ†æž",onClick:B},[...b[6]||(b[6]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 6h12v12H6z"})],-1),e("span",{class:"btn-label"},"å–æ¶ˆ",-1)])])])):L("",!0),U.value?(v(),m("div",wn,[e("button",{class:"btn-control btn-resume",title:"ç»§ç»­åˆ†æž",onClick:y},[...b[7]||(b[7]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8 5v14l11-7z"})],-1),e("span",{class:"btn-label"},"ç»§ç»­",-1)])]),e("button",{class:"btn-control btn-cancel",title:"å–æ¶ˆåˆ†æž",onClick:B},[...b[8]||(b[8]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 6h12v12H6z"})],-1),e("span",{class:"btn-label"},"å–æ¶ˆ",-1)])])])):L("",!0)]),O.value?(v(),Se(de,{key:3,modelValue:g.value,"onUpdate:modelValue":b[1]||(b[1]=M=>g.value=M),options:n.value},null,8,["modelValue","options"])):L("",!0),R.value?(v(),m("div",xn,[q(e("input",{"onUpdate:modelValue":b[2]||(b[2]=M=>d.value=M),type:"number",class:"form-input-compact",placeholder:"è¾“å…¥é¡µç ",min:"1",max:se(r).totalPageCount||void 0},null,8,Sn),[[Q,d.value,void 0,{number:!0}]]),e("span",Cn,"/ "+$(se(r).totalPageCount||"?"),1)])):L("",!0),A.value&&i.value?(v(),m("div",Pn,$(i.value),1)):L("",!0),A.value&&u.value==="full"&&a.value?(v(),m("div",Tn," â±ï¸ "+$(a.value),1)):L("",!0),e("div",In,[e("label",An,[e("input",{type:"checkbox",checked:se(r).incrementalAnalysis,onChange:b[3]||(b[3]=M=>se(r).setIncrementalAnalysis(M.target.checked))},null,40,Mn),b[9]||(b[9]=e("span",null,"å¢žé‡æ¨¡å¼",-1))]),e("button",{class:"btn-icon-sm",title:"å¯¼å‡ºåˆ†æžæŠ¥å‘Š",disabled:se(r).analyzedPageCount===0,onClick:G},[...b[10]||(b[10]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,Rn)])]))}}),Bn=ge(Ln,[["__scopeId","data-v-1421f4fe"]]);function st(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var xe=st();function Ct(o){xe=o}var Re={exec:()=>null};function j(o,t=""){let l=typeof o=="string"?o:o.source,n={replace:(s,r)=>{let u=typeof r=="string"?r:r.source;return u=u.replace(ae.caret,"$1"),l=l.replace(s,u),n},getRegex:()=>new RegExp(l,t)};return n}var zn=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),ae={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:o=>new RegExp(`^( {0,3}${o})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}#`),htmlBeginRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}<(?:[a-z].*>|!--)`,"i")},Un=/^(?:[ \t]*(?:\n|$))+/,En=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Kn=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Le=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Vn=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,nt=/(?:[*+-]|\d{1,9}[.)])/,Pt=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Tt=j(Pt).replace(/bull/g,nt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),qn=j(Pt).replace(/bull/g,nt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),lt=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,On=/^[^\n]+/,at=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Dn=j(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",at).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Nn=j(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,nt).getRegex(),De="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",ot=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Fn=j("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",ot).replace("tag",De).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),It=j(lt).replace("hr",Le).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",De).getRegex(),jn=j(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",It).getRegex(),it={blockquote:jn,code:En,def:Dn,fences:Kn,heading:Vn,hr:Le,html:Fn,lheading:Tt,list:Nn,newline:Un,paragraph:It,table:Re,text:On},ht=j("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Le).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",De).getRegex(),Qn={...it,lheading:qn,table:ht,paragraph:j(lt).replace("hr",Le).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ht).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",De).getRegex()},Hn={...it,html:j(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",ot).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Re,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:j(lt).replace("hr",Le).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Tt).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Gn=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Jn=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,At=/^( {2,}|\\)\n(?!\s*$)/,Zn=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ne=/[\p{P}\p{S}]/u,rt=/[\s\p{P}\p{S}]/u,Mt=/[^\s\p{P}\p{S}]/u,Wn=j(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,rt).getRegex(),Rt=/(?!~)[\p{P}\p{S}]/u,Xn=/(?!~)[\s\p{P}\p{S}]/u,Yn=/(?:[^\s\p{P}\p{S}]|~)/u,el=j(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",zn?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Lt=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,tl=j(Lt,"u").replace(/punct/g,Ne).getRegex(),sl=j(Lt,"u").replace(/punct/g,Rt).getRegex(),Bt="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",nl=j(Bt,"gu").replace(/notPunctSpace/g,Mt).replace(/punctSpace/g,rt).replace(/punct/g,Ne).getRegex(),ll=j(Bt,"gu").replace(/notPunctSpace/g,Yn).replace(/punctSpace/g,Xn).replace(/punct/g,Rt).getRegex(),al=j("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Mt).replace(/punctSpace/g,rt).replace(/punct/g,Ne).getRegex(),ol=j(/\\(punct)/,"gu").replace(/punct/g,Ne).getRegex(),il=j(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),rl=j(ot).replace("(?:-->|$)","-->").getRegex(),ul=j("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",rl).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ke=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,cl=j(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Ke).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),zt=j(/^!?\[(label)\]\[(ref)\]/).replace("label",Ke).replace("ref",at).getRegex(),Ut=j(/^!?\[(ref)\](?:\[\])?/).replace("ref",at).getRegex(),dl=j("reflink|nolink(?!\\()","g").replace("reflink",zt).replace("nolink",Ut).getRegex(),ft=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,ut={_backpedal:Re,anyPunctuation:ol,autolink:il,blockSkip:el,br:At,code:Jn,del:Re,emStrongLDelim:tl,emStrongRDelimAst:nl,emStrongRDelimUnd:al,escape:Gn,link:cl,nolink:Ut,punctuation:Wn,reflink:zt,reflinkSearch:dl,tag:ul,text:Zn,url:Re},pl={...ut,link:j(/^!?\[(label)\]\((.*?)\)/).replace("label",Ke).getRegex(),reflink:j(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ke).getRegex()},Ye={...ut,emStrongRDelimAst:ll,emStrongLDelim:sl,url:j(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",ft).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:j(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",ft).getRegex()},vl={...Ye,br:j(At).replace("{2,}","*").getRegex(),text:j(Ye.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ue={normal:it,gfm:Qn,pedantic:Hn},Ie={normal:ut,gfm:Ye,breaks:vl,pedantic:pl},gl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bt=o=>gl[o];function fe(o,t){if(t){if(ae.escapeTest.test(o))return o.replace(ae.escapeReplace,bt)}else if(ae.escapeTestNoEncode.test(o))return o.replace(ae.escapeReplaceNoEncode,bt);return o}function kt(o){try{o=encodeURI(o).replace(ae.percentDecode,"%")}catch{return null}return o}function yt(o,t){let l=o.replace(ae.findPipe,(r,u,g)=>{let d=!1,p=u;for(;--p>=0&&g[p]==="\\";)d=!d;return d?"|":" |"}),n=l.split(ae.splitPipe),s=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(ae.slashPipe,"|");return n}function Ae(o,t,l){let n=o.length;if(n===0)return"";let s=0;for(;s<n&&o.charAt(n-s-1)===t;)s++;return o.slice(0,n-s)}function ml(o,t){if(o.indexOf(t[1])===-1)return-1;let l=0;for(let n=0;n<o.length;n++)if(o[n]==="\\")n++;else if(o[n]===t[0])l++;else if(o[n]===t[1]&&(l--,l<0))return n;return l>0?-2:-1}function _t(o,t,l,n,s){let r=t.href,u=t.title||null,g=o[1].replace(s.other.outputLinkReplace,"$1");n.state.inLink=!0;let d={type:o[0].charAt(0)==="!"?"image":"link",raw:l,href:r,title:u,text:g,tokens:n.inlineTokens(g)};return n.state.inLink=!1,d}function hl(o,t,l){let n=o.match(l.other.indentCodeCompensation);if(n===null)return t;let s=n[1];return t.split(`
`).map(r=>{let u=r.match(l.other.beginningSpace);if(u===null)return r;let[g]=u;return g.length>=s.length?r.slice(s.length):r}).join(`
`)}var Ve=class{options;rules;lexer;constructor(o){this.options=o||xe}space(o){let t=this.rules.block.newline.exec(o);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(o){let t=this.rules.block.code.exec(o);if(t){let l=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?l:Ae(l,`
`)}}}fences(o){let t=this.rules.block.fences.exec(o);if(t){let l=t[0],n=hl(l,t[3]||"",this.rules);return{type:"code",raw:l,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(o){let t=this.rules.block.heading.exec(o);if(t){let l=t[2].trim();if(this.rules.other.endingHash.test(l)){let n=Ae(l,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(l=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:l,tokens:this.lexer.inline(l)}}}hr(o){let t=this.rules.block.hr.exec(o);if(t)return{type:"hr",raw:Ae(t[0],`
`)}}blockquote(o){let t=this.rules.block.blockquote.exec(o);if(t){let l=Ae(t[0],`
`).split(`
`),n="",s="",r=[];for(;l.length>0;){let u=!1,g=[],d;for(d=0;d<l.length;d++)if(this.rules.other.blockquoteStart.test(l[d]))g.push(l[d]),u=!0;else if(!u)g.push(l[d]);else break;l=l.slice(d);let p=g.join(`
`),f=p.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${p}`:p,s=s?`${s}
${f}`:f;let C=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(f,r,!0),this.lexer.state.top=C,l.length===0)break;let T=r.at(-1);if(T?.type==="code")break;if(T?.type==="blockquote"){let I=T,A=I.raw+`
`+l.join(`
`),z=this.blockquote(A);r[r.length-1]=z,n=n.substring(0,n.length-I.raw.length)+z.raw,s=s.substring(0,s.length-I.text.length)+z.text;break}else if(T?.type==="list"){let I=T,A=I.raw+`
`+l.join(`
`),z=this.list(A);r[r.length-1]=z,n=n.substring(0,n.length-T.raw.length)+z.raw,s=s.substring(0,s.length-I.raw.length)+z.raw,l=A.substring(r.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:r,text:s}}}list(o){let t=this.rules.block.list.exec(o);if(t){let l=t[1].trim(),n=l.length>1,s={type:"list",raw:"",ordered:n,start:n?+l.slice(0,-1):"",loose:!1,items:[]};l=n?`\\d{1,9}\\${l.slice(-1)}`:`\\${l}`,this.options.pedantic&&(l=n?l:"[*+-]");let r=this.rules.other.listItemRegex(l),u=!1;for(;o;){let d=!1,p="",f="";if(!(t=r.exec(o))||this.rules.block.hr.test(o))break;p=t[0],o=o.substring(p.length);let C=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,z=>" ".repeat(3*z.length)),T=o.split(`
`,1)[0],I=!C.trim(),A=0;if(this.options.pedantic?(A=2,f=C.trimStart()):I?A=t[1].length+1:(A=t[2].search(this.rules.other.nonSpaceChar),A=A>4?1:A,f=C.slice(A),A+=t[1].length),I&&this.rules.other.blankLine.test(T)&&(p+=T+`
`,o=o.substring(T.length+1),d=!0),!d){let z=this.rules.other.nextBulletRegex(A),U=this.rules.other.hrRegex(A),K=this.rules.other.fencesBeginRegex(A),O=this.rules.other.headingBeginRegex(A),R=this.rules.other.htmlBeginRegex(A);for(;o;){let P=o.split(`
`,1)[0],i;if(T=P,this.options.pedantic?(T=T.replace(this.rules.other.listReplaceNesting,"  "),i=T):i=T.replace(this.rules.other.tabCharGlobal,"    "),K.test(T)||O.test(T)||R.test(T)||z.test(T)||U.test(T))break;if(i.search(this.rules.other.nonSpaceChar)>=A||!T.trim())f+=`
`+i.slice(A);else{if(I||C.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||K.test(C)||O.test(C)||U.test(C))break;f+=`
`+T}!I&&!T.trim()&&(I=!0),p+=P+`
`,o=o.substring(P.length+1),C=i.slice(A)}}s.loose||(u?s.loose=!0:this.rules.other.doubleBlankLine.test(p)&&(u=!0)),s.items.push({type:"list_item",raw:p,task:!!this.options.gfm&&this.rules.other.listIsTask.test(f),loose:!1,text:f,tokens:[]}),s.raw+=p}let g=s.items.at(-1);if(g)g.raw=g.raw.trimEnd(),g.text=g.text.trimEnd();else return;s.raw=s.raw.trimEnd();for(let d of s.items){if(this.lexer.state.top=!1,d.tokens=this.lexer.blockTokens(d.text,[]),d.task){if(d.text=d.text.replace(this.rules.other.listReplaceTask,""),d.tokens[0]?.type==="text"||d.tokens[0]?.type==="paragraph"){d.tokens[0].raw=d.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),d.tokens[0].text=d.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let f=this.lexer.inlineQueue.length-1;f>=0;f--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[f].src)){this.lexer.inlineQueue[f].src=this.lexer.inlineQueue[f].src.replace(this.rules.other.listReplaceTask,"");break}}let p=this.rules.other.listTaskCheckbox.exec(d.raw);if(p){let f={type:"checkbox",raw:p[0]+" ",checked:p[0]!=="[ ]"};d.checked=f.checked,s.loose?d.tokens[0]&&["paragraph","text"].includes(d.tokens[0].type)&&"tokens"in d.tokens[0]&&d.tokens[0].tokens?(d.tokens[0].raw=f.raw+d.tokens[0].raw,d.tokens[0].text=f.raw+d.tokens[0].text,d.tokens[0].tokens.unshift(f)):d.tokens.unshift({type:"paragraph",raw:f.raw,text:f.raw,tokens:[f]}):d.tokens.unshift(f)}}if(!s.loose){let p=d.tokens.filter(C=>C.type==="space"),f=p.length>0&&p.some(C=>this.rules.other.anyLine.test(C.raw));s.loose=f}}if(s.loose)for(let d of s.items){d.loose=!0;for(let p of d.tokens)p.type==="text"&&(p.type="paragraph")}return s}}html(o){let t=this.rules.block.html.exec(o);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(o){let t=this.rules.block.def.exec(o);if(t){let l=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:l,raw:t[0],href:n,title:s}}}table(o){let t=this.rules.block.table.exec(o);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let l=yt(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],r={type:"table",raw:t[0],header:[],align:[],rows:[]};if(l.length===n.length){for(let u of n)this.rules.other.tableAlignRight.test(u)?r.align.push("right"):this.rules.other.tableAlignCenter.test(u)?r.align.push("center"):this.rules.other.tableAlignLeft.test(u)?r.align.push("left"):r.align.push(null);for(let u=0;u<l.length;u++)r.header.push({text:l[u],tokens:this.lexer.inline(l[u]),header:!0,align:r.align[u]});for(let u of s)r.rows.push(yt(u,r.header.length).map((g,d)=>({text:g,tokens:this.lexer.inline(g),header:!1,align:r.align[d]})));return r}}lheading(o){let t=this.rules.block.lheading.exec(o);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(o){let t=this.rules.block.paragraph.exec(o);if(t){let l=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:l,tokens:this.lexer.inline(l)}}}text(o){let t=this.rules.block.text.exec(o);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(o){let t=this.rules.inline.escape.exec(o);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(o){let t=this.rules.inline.tag.exec(o);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(o){let t=this.rules.inline.link.exec(o);if(t){let l=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(l)){if(!this.rules.other.endAngleBracket.test(l))return;let r=Ae(l.slice(0,-1),"\\");if((l.length-r.length)%2===0)return}else{let r=ml(t[2],"()");if(r===-2)return;if(r>-1){let u=(t[0].indexOf("!")===0?5:4)+t[1].length+r;t[2]=t[2].substring(0,r),t[0]=t[0].substring(0,u).trim(),t[3]=""}}let n=t[2],s="";if(this.options.pedantic){let r=this.rules.other.pedanticHrefTitle.exec(n);r&&(n=r[1],s=r[3])}else s=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(l)?n=n.slice(1):n=n.slice(1,-1)),_t(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(o,t){let l;if((l=this.rules.inline.reflink.exec(o))||(l=this.rules.inline.nolink.exec(o))){let n=(l[2]||l[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=t[n.toLowerCase()];if(!s){let r=l[0].charAt(0);return{type:"text",raw:r,text:r}}return _t(l,s,l[0],this.lexer,this.rules)}}emStrong(o,t,l=""){let n=this.rules.inline.emStrongLDelim.exec(o);if(!(!n||n[3]&&l.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!l||this.rules.inline.punctuation.exec(l))){let s=[...n[0]].length-1,r,u,g=s,d=0,p=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,t=t.slice(-1*o.length+s);(n=p.exec(t))!=null;){if(r=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!r)continue;if(u=[...r].length,n[3]||n[4]){g+=u;continue}else if((n[5]||n[6])&&s%3&&!((s+u)%3)){d+=u;continue}if(g-=u,g>0)continue;u=Math.min(u,u+g+d);let f=[...n[0]][0].length,C=o.slice(0,s+n.index+f+u);if(Math.min(s,u)%2){let I=C.slice(1,-1);return{type:"em",raw:C,text:I,tokens:this.lexer.inlineTokens(I)}}let T=C.slice(2,-2);return{type:"strong",raw:C,text:T,tokens:this.lexer.inlineTokens(T)}}}}codespan(o){let t=this.rules.inline.code.exec(o);if(t){let l=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(l),s=this.rules.other.startingSpaceChar.test(l)&&this.rules.other.endingSpaceChar.test(l);return n&&s&&(l=l.substring(1,l.length-1)),{type:"codespan",raw:t[0],text:l}}}br(o){let t=this.rules.inline.br.exec(o);if(t)return{type:"br",raw:t[0]}}del(o){let t=this.rules.inline.del.exec(o);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(o){let t=this.rules.inline.autolink.exec(o);if(t){let l,n;return t[2]==="@"?(l=t[1],n="mailto:"+l):(l=t[1],n=l),{type:"link",raw:t[0],text:l,href:n,tokens:[{type:"text",raw:l,text:l}]}}}url(o){let t;if(t=this.rules.inline.url.exec(o)){let l,n;if(t[2]==="@")l=t[0],n="mailto:"+l;else{let s;do s=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(s!==t[0]);l=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:l,href:n,tokens:[{type:"text",raw:l,text:l}]}}}inlineText(o){let t=this.rules.inline.text.exec(o);if(t){let l=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:l}}}},pe=class et{tokens;options;state;inlineQueue;tokenizer;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||xe,this.options.tokenizer=this.options.tokenizer||new Ve,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let l={other:ae,block:Ue.normal,inline:Ie.normal};this.options.pedantic?(l.block=Ue.pedantic,l.inline=Ie.pedantic):this.options.gfm&&(l.block=Ue.gfm,this.options.breaks?l.inline=Ie.breaks:l.inline=Ie.gfm),this.tokenizer.rules=l}static get rules(){return{block:Ue,inline:Ie}}static lex(t,l){return new et(l).lex(t)}static lexInline(t,l){return new et(l).inlineTokens(t)}lex(t){t=t.replace(ae.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let l=0;l<this.inlineQueue.length;l++){let n=this.inlineQueue[l];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,l=[],n=!1){for(this.options.pedantic&&(t=t.replace(ae.tabCharGlobal,"    ").replace(ae.spaceLine,""));t;){let s;if(this.options.extensions?.block?.some(u=>(s=u.call({lexer:this},t,l))?(t=t.substring(s.raw.length),l.push(s),!0):!1))continue;if(s=this.tokenizer.space(t)){t=t.substring(s.raw.length);let u=l.at(-1);s.raw.length===1&&u!==void 0?u.raw+=`
`:l.push(s);continue}if(s=this.tokenizer.code(t)){t=t.substring(s.raw.length);let u=l.at(-1);u?.type==="paragraph"||u?.type==="text"?(u.raw+=(u.raw.endsWith(`
`)?"":`
`)+s.raw,u.text+=`
`+s.text,this.inlineQueue.at(-1).src=u.text):l.push(s);continue}if(s=this.tokenizer.fences(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.heading(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.hr(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.blockquote(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.list(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.html(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.def(t)){t=t.substring(s.raw.length);let u=l.at(-1);u?.type==="paragraph"||u?.type==="text"?(u.raw+=(u.raw.endsWith(`
`)?"":`
`)+s.raw,u.text+=`
`+s.raw,this.inlineQueue.at(-1).src=u.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title},l.push(s));continue}if(s=this.tokenizer.table(t)){t=t.substring(s.raw.length),l.push(s);continue}if(s=this.tokenizer.lheading(t)){t=t.substring(s.raw.length),l.push(s);continue}let r=t;if(this.options.extensions?.startBlock){let u=1/0,g=t.slice(1),d;this.options.extensions.startBlock.forEach(p=>{d=p.call({lexer:this},g),typeof d=="number"&&d>=0&&(u=Math.min(u,d))}),u<1/0&&u>=0&&(r=t.substring(0,u+1))}if(this.state.top&&(s=this.tokenizer.paragraph(r))){let u=l.at(-1);n&&u?.type==="paragraph"?(u.raw+=(u.raw.endsWith(`
`)?"":`
`)+s.raw,u.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=u.text):l.push(s),n=r.length!==t.length,t=t.substring(s.raw.length);continue}if(s=this.tokenizer.text(t)){t=t.substring(s.raw.length);let u=l.at(-1);u?.type==="text"?(u.raw+=(u.raw.endsWith(`
`)?"":`
`)+s.raw,u.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=u.text):l.push(s);continue}if(t){let u="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return this.state.top=!0,l}inline(t,l=[]){return this.inlineQueue.push({src:t,tokens:l}),l}inlineTokens(t,l=[]){let n=t,s=null;if(this.tokens.links){let d=Object.keys(this.tokens.links);if(d.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)d.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,s.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let r;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)r=s[2]?s[2].length:0,n=n.slice(0,s.index+r)+"["+"a".repeat(s[0].length-r-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=this.options.hooks?.emStrongMask?.call({lexer:this},n)??n;let u=!1,g="";for(;t;){u||(g=""),u=!1;let d;if(this.options.extensions?.inline?.some(f=>(d=f.call({lexer:this},t,l))?(t=t.substring(d.raw.length),l.push(d),!0):!1))continue;if(d=this.tokenizer.escape(t)){t=t.substring(d.raw.length),l.push(d);continue}if(d=this.tokenizer.tag(t)){t=t.substring(d.raw.length),l.push(d);continue}if(d=this.tokenizer.link(t)){t=t.substring(d.raw.length),l.push(d);continue}if(d=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(d.raw.length);let f=l.at(-1);d.type==="text"&&f?.type==="text"?(f.raw+=d.raw,f.text+=d.text):l.push(d);continue}if(d=this.tokenizer.emStrong(t,n,g)){t=t.substring(d.raw.length),l.push(d);continue}if(d=this.tokenizer.codespan(t)){t=t.substring(d.raw.length),l.push(d);continue}if(d=this.tokenizer.br(t)){t=t.substring(d.raw.length),l.push(d);continue}if(d=this.tokenizer.del(t)){t=t.substring(d.raw.length),l.push(d);continue}if(d=this.tokenizer.autolink(t)){t=t.substring(d.raw.length),l.push(d);continue}if(!this.state.inLink&&(d=this.tokenizer.url(t))){t=t.substring(d.raw.length),l.push(d);continue}let p=t;if(this.options.extensions?.startInline){let f=1/0,C=t.slice(1),T;this.options.extensions.startInline.forEach(I=>{T=I.call({lexer:this},C),typeof T=="number"&&T>=0&&(f=Math.min(f,T))}),f<1/0&&f>=0&&(p=t.substring(0,f+1))}if(d=this.tokenizer.inlineText(p)){t=t.substring(d.raw.length),d.raw.slice(-1)!=="_"&&(g=d.raw.slice(-1)),u=!0;let f=l.at(-1);f?.type==="text"?(f.raw+=d.raw,f.text+=d.text):l.push(d);continue}if(t){let f="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return l}},qe=class{options;parser;constructor(o){this.options=o||xe}space(o){return""}code({text:o,lang:t,escaped:l}){let n=(t||"").match(ae.notSpaceStart)?.[0],s=o.replace(ae.endingNewline,"")+`
`;return n?'<pre><code class="language-'+fe(n)+'">'+(l?s:fe(s,!0))+`</code></pre>
`:"<pre><code>"+(l?s:fe(s,!0))+`</code></pre>
`}blockquote({tokens:o}){return`<blockquote>
${this.parser.parse(o)}</blockquote>
`}html({text:o}){return o}def(o){return""}heading({tokens:o,depth:t}){return`<h${t}>${this.parser.parseInline(o)}</h${t}>
`}hr(o){return`<hr>
`}list(o){let t=o.ordered,l=o.start,n="";for(let u=0;u<o.items.length;u++){let g=o.items[u];n+=this.listitem(g)}let s=t?"ol":"ul",r=t&&l!==1?' start="'+l+'"':"";return"<"+s+r+`>
`+n+"</"+s+`>
`}listitem(o){return`<li>${this.parser.parse(o.tokens)}</li>
`}checkbox({checked:o}){return"<input "+(o?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:o}){return`<p>${this.parser.parseInline(o)}</p>
`}table(o){let t="",l="";for(let s=0;s<o.header.length;s++)l+=this.tablecell(o.header[s]);t+=this.tablerow({text:l});let n="";for(let s=0;s<o.rows.length;s++){let r=o.rows[s];l="";for(let u=0;u<r.length;u++)l+=this.tablecell(r[u]);n+=this.tablerow({text:l})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:o}){return`<tr>
${o}</tr>
`}tablecell(o){let t=this.parser.parseInline(o.tokens),l=o.header?"th":"td";return(o.align?`<${l} align="${o.align}">`:`<${l}>`)+t+`</${l}>
`}strong({tokens:o}){return`<strong>${this.parser.parseInline(o)}</strong>`}em({tokens:o}){return`<em>${this.parser.parseInline(o)}</em>`}codespan({text:o}){return`<code>${fe(o,!0)}</code>`}br(o){return"<br>"}del({tokens:o}){return`<del>${this.parser.parseInline(o)}</del>`}link({href:o,title:t,tokens:l}){let n=this.parser.parseInline(l),s=kt(o);if(s===null)return n;o=s;let r='<a href="'+o+'"';return t&&(r+=' title="'+fe(t)+'"'),r+=">"+n+"</a>",r}image({href:o,title:t,text:l,tokens:n}){n&&(l=this.parser.parseInline(n,this.parser.textRenderer));let s=kt(o);if(s===null)return fe(l);o=s;let r=`<img src="${o}" alt="${l}"`;return t&&(r+=` title="${fe(t)}"`),r+=">",r}text(o){return"tokens"in o&&o.tokens?this.parser.parseInline(o.tokens):"escaped"in o&&o.escaped?o.text:fe(o.text)}},ct=class{strong({text:o}){return o}em({text:o}){return o}codespan({text:o}){return o}del({text:o}){return o}html({text:o}){return o}text({text:o}){return o}link({text:o}){return""+o}image({text:o}){return""+o}br(){return""}checkbox({raw:o}){return o}},ve=class tt{options;renderer;textRenderer;constructor(t){this.options=t||xe,this.options.renderer=this.options.renderer||new qe,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ct}static parse(t,l){return new tt(l).parse(t)}static parseInline(t,l){return new tt(l).parseInline(t)}parse(t){let l="";for(let n=0;n<t.length;n++){let s=t[n];if(this.options.extensions?.renderers?.[s.type]){let u=s,g=this.options.extensions.renderers[u.type].call({parser:this},u);if(g!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(u.type)){l+=g||"";continue}}let r=s;switch(r.type){case"space":{l+=this.renderer.space(r);break}case"hr":{l+=this.renderer.hr(r);break}case"heading":{l+=this.renderer.heading(r);break}case"code":{l+=this.renderer.code(r);break}case"table":{l+=this.renderer.table(r);break}case"blockquote":{l+=this.renderer.blockquote(r);break}case"list":{l+=this.renderer.list(r);break}case"checkbox":{l+=this.renderer.checkbox(r);break}case"html":{l+=this.renderer.html(r);break}case"def":{l+=this.renderer.def(r);break}case"paragraph":{l+=this.renderer.paragraph(r);break}case"text":{l+=this.renderer.text(r);break}default:{let u='Token with "'+r.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return l}parseInline(t,l=this.renderer){let n="";for(let s=0;s<t.length;s++){let r=t[s];if(this.options.extensions?.renderers?.[r.type]){let g=this.options.extensions.renderers[r.type].call({parser:this},r);if(g!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(r.type)){n+=g||"";continue}}let u=r;switch(u.type){case"escape":{n+=l.text(u);break}case"html":{n+=l.html(u);break}case"link":{n+=l.link(u);break}case"image":{n+=l.image(u);break}case"checkbox":{n+=l.checkbox(u);break}case"strong":{n+=l.strong(u);break}case"em":{n+=l.em(u);break}case"codespan":{n+=l.codespan(u);break}case"br":{n+=l.br(u);break}case"del":{n+=l.del(u);break}case"text":{n+=l.text(u);break}default:{let g='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(g),"";throw new Error(g)}}}return n}},Me=class{options;block;constructor(o){this.options=o||xe}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(o){return o}postprocess(o){return o}processAllTokens(o){return o}emStrongMask(o){return o}provideLexer(){return this.block?pe.lex:pe.lexInline}provideParser(){return this.block?ve.parse:ve.parseInline}},fl=class{defaults=st();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=ve;Renderer=qe;TextRenderer=ct;Lexer=pe;Tokenizer=Ve;Hooks=Me;constructor(...o){this.use(...o)}walkTokens(o,t){let l=[];for(let n of o)switch(l=l.concat(t.call(this,n)),n.type){case"table":{let s=n;for(let r of s.header)l=l.concat(this.walkTokens(r.tokens,t));for(let r of s.rows)for(let u of r)l=l.concat(this.walkTokens(u.tokens,t));break}case"list":{let s=n;l=l.concat(this.walkTokens(s.items,t));break}default:{let s=n;this.defaults.extensions?.childTokens?.[s.type]?this.defaults.extensions.childTokens[s.type].forEach(r=>{let u=s[r].flat(1/0);l=l.concat(this.walkTokens(u,t))}):s.tokens&&(l=l.concat(this.walkTokens(s.tokens,t)))}}return l}use(...o){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return o.forEach(l=>{let n={...l};if(n.async=this.defaults.async||n.async||!1,l.extensions&&(l.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let r=t.renderers[s.name];r?t.renderers[s.name]=function(...u){let g=s.renderer.apply(this,u);return g===!1&&(g=r.apply(this,u)),g}:t.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let r=t[s.level];r?r.unshift(s.tokenizer):t[s.level]=[s.tokenizer],s.start&&(s.level==="block"?t.startBlock?t.startBlock.push(s.start):t.startBlock=[s.start]:s.level==="inline"&&(t.startInline?t.startInline.push(s.start):t.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(t.childTokens[s.name]=s.childTokens)}),n.extensions=t),l.renderer){let s=this.defaults.renderer||new qe(this.defaults);for(let r in l.renderer){if(!(r in s))throw new Error(`renderer '${r}' does not exist`);if(["options","parser"].includes(r))continue;let u=r,g=l.renderer[u],d=s[u];s[u]=(...p)=>{let f=g.apply(s,p);return f===!1&&(f=d.apply(s,p)),f||""}}n.renderer=s}if(l.tokenizer){let s=this.defaults.tokenizer||new Ve(this.defaults);for(let r in l.tokenizer){if(!(r in s))throw new Error(`tokenizer '${r}' does not exist`);if(["options","rules","lexer"].includes(r))continue;let u=r,g=l.tokenizer[u],d=s[u];s[u]=(...p)=>{let f=g.apply(s,p);return f===!1&&(f=d.apply(s,p)),f}}n.tokenizer=s}if(l.hooks){let s=this.defaults.hooks||new Me;for(let r in l.hooks){if(!(r in s))throw new Error(`hook '${r}' does not exist`);if(["options","block"].includes(r))continue;let u=r,g=l.hooks[u],d=s[u];Me.passThroughHooks.has(r)?s[u]=p=>{if(this.defaults.async&&Me.passThroughHooksRespectAsync.has(r))return(async()=>{let C=await g.call(s,p);return d.call(s,C)})();let f=g.call(s,p);return d.call(s,f)}:s[u]=(...p)=>{if(this.defaults.async)return(async()=>{let C=await g.apply(s,p);return C===!1&&(C=await d.apply(s,p)),C})();let f=g.apply(s,p);return f===!1&&(f=d.apply(s,p)),f}}n.hooks=s}if(l.walkTokens){let s=this.defaults.walkTokens,r=l.walkTokens;n.walkTokens=function(u){let g=[];return g.push(r.call(this,u)),s&&(g=g.concat(s.call(this,u))),g}}this.defaults={...this.defaults,...n}}),this}setOptions(o){return this.defaults={...this.defaults,...o},this}lexer(o,t){return pe.lex(o,t??this.defaults)}parser(o,t){return ve.parse(o,t??this.defaults)}parseMarkdown(o){return(t,l)=>{let n={...l},s={...this.defaults,...n},r=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&n.async===!1)return r(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return r(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return r(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=o),s.async)return(async()=>{let u=s.hooks?await s.hooks.preprocess(t):t,g=await(s.hooks?await s.hooks.provideLexer():o?pe.lex:pe.lexInline)(u,s),d=s.hooks?await s.hooks.processAllTokens(g):g;s.walkTokens&&await Promise.all(this.walkTokens(d,s.walkTokens));let p=await(s.hooks?await s.hooks.provideParser():o?ve.parse:ve.parseInline)(d,s);return s.hooks?await s.hooks.postprocess(p):p})().catch(r);try{s.hooks&&(t=s.hooks.preprocess(t));let u=(s.hooks?s.hooks.provideLexer():o?pe.lex:pe.lexInline)(t,s);s.hooks&&(u=s.hooks.processAllTokens(u)),s.walkTokens&&this.walkTokens(u,s.walkTokens);let g=(s.hooks?s.hooks.provideParser():o?ve.parse:ve.parseInline)(u,s);return s.hooks&&(g=s.hooks.postprocess(g)),g}catch(u){return r(u)}}}onError(o,t){return l=>{if(l.message+=`
Please report this to https://github.com/markedjs/marked.`,o){let n="<p>An error occurred:</p><pre>"+fe(l.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(l);throw l}}},$e=new fl;function H(o,t){return $e.parse(o,t)}H.options=H.setOptions=function(o){return $e.setOptions(o),H.defaults=$e.defaults,Ct(H.defaults),H};H.getDefaults=st;H.defaults=xe;H.use=function(...o){return $e.use(...o),H.defaults=$e.defaults,Ct(H.defaults),H};H.walkTokens=function(o,t){return $e.walkTokens(o,t)};H.parseInline=$e.parseInline;H.Parser=ve;H.parser=ve.parse;H.Renderer=qe;H.TextRenderer=ct;H.Lexer=pe;H.lexer=pe.lex;H.Tokenizer=Ve;H.Hooks=Me;H.parse=H;H.options;H.setOptions;H.use;H.walkTokens;H.parseInline;ve.parse;pe.lex;const bl={class:"overview-grid"},kl={class:"overview-card summary-card"},yl={class:"card-header"},_l={class:"card-title-with-selector"},$l={class:"card-title-icon"},wl={class:"card-header-actions"},xl={class:"template-status"},Sl={class:"template-description"},Cl={class:"card-content markdown-content"},Pl={key:0,class:"loading-text"},Tl=["innerHTML"],Il={key:2,class:"placeholder-text"},Al={class:"overview-card stats-card"},Ml={class:"stats-grid"},Rl={class:"stat-item"},Ll={class:"stat-value"},Bl={class:"stat-item"},zl={class:"stat-value"},Ul={class:"export-actions"},El=["disabled"],Kl=["disabled"],Vl={class:"overview-card recent-card"},ql={class:"recent-pages"},Ol={key:0,class:"placeholder-text"},Dl=["onClick"],Nl={class:"page-number"},Fl={key:0,class:"page-summary"},jl=ne({__name:"OverviewPanel",setup(o){const t=oe(),l=k("no_spoiler"),n=k(""),s=k(!1),r=k([]),u=k([]),g=[{value:"no_spoiler",label:"æ— å‰§é€ç®€ä»‹",icon:"ðŸŽ",description:"ä¸å«å‰§é€çš„ç®€çŸ­ä»‹ç»ï¼Œé€‚åˆæŽ¨èç»™ä»–äºº"},{value:"story_summary",label:"æ•…äº‹æ¦‚è¦",icon:"ðŸ“–",description:"å®Œæ•´çš„å‰§æƒ…å›žé¡¾ï¼ŒåŒ…å«æ‰€æœ‰å‰§é€"},{value:"recap",label:"å‰æƒ…å›žé¡¾",icon:"âª",description:"ä¹‹å‰å‘ç”Ÿçš„é‡è¦äº‹ä»¶å›žé¡¾"},{value:"character_guide",label:"è§’è‰²å›¾é‰´",icon:"ðŸ‘¥",description:"ä¸»è¦è§’è‰²ä»‹ç»å’Œå…³ç³»"},{value:"world_setting",label:"ä¸–ç•Œè§‚è®¾å®š",icon:"ðŸŒ",description:"æ•…äº‹èƒŒæ™¯å’Œä¸–ç•Œè§‚è®¾å®š"},{value:"highlights",label:"ååœºé¢ç›˜ç‚¹",icon:"âœ¨",description:"ç²¾å½©ç‰‡æ®µå’Œç»å…¸åœºæ™¯å›žé¡¾"},{value:"reading_notes",label:"é˜…è¯»ç¬”è®°",icon:"ðŸ“",description:"é˜…è¯»è¿‡ç¨‹ä¸­çš„é‡ç‚¹ç¬”è®°"}],d=g.map(a=>({label:`${a.icon} ${a.label}`,value:a.value})),p=E(()=>g.find(c=>c.value===l.value)?.icon||"ðŸ“Š"),f=E(()=>g.find(c=>c.value===l.value)?.description||""),C=E(()=>r.value.includes(l.value)?"å·²ç”Ÿæˆ":""),T=E(()=>n.value?H.parse(n.value):"");async function I(){await A()}async function A(){if(t.currentBookId){s.value=!0,n.value="";try{const a=await Ds(t.currentBookId,l.value);a.success&&a.content?(n.value=a.content,r.value.includes(l.value)||r.value.push(l.value)):n.value=""}catch(a){console.error("åŠ è½½æ¦‚è§ˆå¤±è´¥:",a),n.value="åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"}finally{s.value=!1}}}async function z(a){if(t.currentBookId){s.value=!0,n.value="";try{const c=await Ns(t.currentBookId,l.value,a);c.success?c.content&&(n.value=c.content,r.value.includes(l.value)||r.value.push(l.value)):n.value=`ç”Ÿæˆå¤±è´¥: ${c.error||"æœªçŸ¥é”™è¯¯"}`}catch(c){console.error("ç”Ÿæˆæ¦‚è§ˆå¤±è´¥:",c),n.value="ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•"}finally{s.value=!1}}}async function U(){if(t.currentBookId)try{const a=await Fs(t.currentBookId);if(a.success){let c=[];a.generated?c=a.generated:a.templates&&Array.isArray(a.templates)&&(c=a.templates),r.value=c}}catch(a){console.error("åŠ è½½æ¨¡æ¿åˆ—è¡¨å¤±è´¥:",a)}}const K=k(!1);async function O(){if(!t.currentBookId){alert("è¯·å…ˆé€‰æ‹©ä¹¦ç±");return}K.value=!0;try{const a=await St(t.currentBookId);if(a.success&&a.markdown){const c=new Blob([a.markdown],{type:"text/markdown"}),_=URL.createObjectURL(c),x=document.createElement("a");x.href=_,x.download=`${t.currentBookId}_analysis.md`,x.click(),URL.revokeObjectURL(_),alert("å¯¼å‡ºæˆåŠŸ")}else alert("å¯¼å‡ºå¤±è´¥: "+(a.error||"æœªçŸ¥é”™è¯¯"))}catch(a){console.error("å¯¼å‡ºå¤±è´¥:",a),alert("å¯¼å‡ºå¤±è´¥")}finally{K.value=!1}}function R(){if(!n.value){alert("æš‚æ— å†…å®¹å¯å¯¼å‡º");return}const a=g.find(G=>G.value===l.value),c=`${t.currentBookId}_${l.value}.md`,_=`# ${a?.label||l.value}

${n.value}`,x=new Blob([_],{type:"text/markdown"}),y=URL.createObjectURL(x),B=document.createElement("a");B.href=y,B.download=c,B.click(),URL.revokeObjectURL(y)}async function P(){if(t.currentBookId)try{if((await wt(t.currentBookId)).success&&t.analyzedPageCount>0){const c=t.totalPageCount,_=t.analyzedPageCount,x=[],y=Math.max(1,_-4);for(let B=0;B<Math.min(5,_);B++){const G=y+B;G<=c&&x.push({page_num:G,summary:`ç¬¬ ${G} é¡µ`})}u.value=x.reverse()}}catch(a){console.error("åŠ è½½æœ€è¿‘åˆ†æžé¡µé¢å¤±è´¥:",a)}}function i(a){t.selectPage(a)}return we(async()=>{await U(),await P(),r.value.includes(l.value)&&await A()}),ke(()=>t.currentBookId,async a=>{a&&(n.value="",r.value=[],u.value=[],await U(),await P(),r.value.includes(l.value)&&await A())}),ke(()=>t.dataRefreshKey,async a=>{a>0&&t.currentBookId&&(console.log("OverviewPanel: æ”¶åˆ°åˆ·æ–°ä¿¡å·ï¼Œé‡æ–°åŠ è½½æ•°æ®"),await U(),await P(),r.value.includes(l.value)&&await A())}),(a,c)=>(v(),m("div",bl,[e("div",kl,[e("div",yl,[e("div",_l,[e("span",$l,$(p.value),1),Y(de,{modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=_=>l.value=_),options:se(d),onChange:I},null,8,["modelValue","options"])]),e("div",wl,[e("span",xl,$(C.value),1),e("button",{class:"btn-icon",title:"ç”Ÿæˆ/åŠ è½½",onClick:c[1]||(c[1]=_=>z(!1))}," ðŸ“„ "),e("button",{class:"btn-icon",title:"é‡æ–°ç”Ÿæˆ",onClick:c[2]||(c[2]=_=>z(!0))}," ðŸ”„ ")])]),e("p",Sl,$(f.value),1),e("div",Cl,[s.value?(v(),m("div",Pl,"åŠ è½½ä¸­...")):n.value?(v(),m("div",{key:1,innerHTML:T.value},null,8,Tl)):(v(),m("div",Il,"é€‰æ‹©æ¨¡æ¿ç±»åž‹ï¼Œç‚¹å‡»ç”ŸæˆæŒ‰é’®"))])]),e("div",Al,[c[5]||(c[5]=e("h3",{class:"card-title"},"ðŸ“Š åˆ†æžç»Ÿè®¡",-1)),e("div",Ml,[e("div",Rl,[e("span",Ll,$(se(t).analyzedPageCount),1),c[3]||(c[3]=e("span",{class:"stat-label"},"å·²åˆ†æžé¡µé¢",-1))]),e("div",Bl,[e("span",zl,$(se(t).chapters.length),1),c[4]||(c[4]=e("span",{class:"stat-label"},"ç« èŠ‚æ•°",-1))])]),e("div",Ul,[e("button",{class:"btn btn-secondary btn-sm",disabled:K.value||!n.value,title:"å¯¼å‡ºå½“å‰æ¦‚è§ˆ",onClick:R}," ðŸ“„ å¯¼å‡ºå½“å‰ ",8,El),e("button",{class:"btn btn-primary btn-sm",disabled:K.value,title:"å¯¼å‡ºå®Œæ•´åˆ†æžæ•°æ®",onClick:O},$(K.value?"å¯¼å‡ºä¸­...":"ðŸ“¤ å¯¼å‡ºå…¨éƒ¨"),9,Kl)])]),e("div",Vl,[c[6]||(c[6]=e("h3",{class:"card-title"},"ðŸ• æœ€è¿‘åˆ†æž",-1)),e("div",ql,[u.value.length===0?(v(),m("div",Ol,"æš‚æ— åˆ†æžè®°å½•")):L("",!0),(v(!0),m(N,null,W(u.value,_=>(v(),m("div",{key:_.page_num,class:"recent-page-item",onClick:x=>i(_.page_num)},[e("span",Nl,"ç¬¬ "+$(_.page_num)+" é¡µ",1),_.summary?(v(),m("span",Fl,$(_.summary),1)):L("",!0)],8,Dl))),128))])])]))}}),Ql=ge(jl,[["__scopeId","data-v-ab7103d7"]]),Hl={class:"timeline-tab"},Gl={class:"timeline-header"},Jl=["disabled"],Zl={key:0,class:"btn-spinner"},Wl={key:0,class:"error-message"},Xl={class:"timeline-container"},Yl={key:0,class:"loading-state"},ea={key:1,class:"timeline-empty-state"},ta=["disabled"],sa={class:"timeline-stats"},na={key:0,class:"stat-badge"},la={class:"stat-badge"},aa={key:1,class:"stat-badge"},oa={key:2,class:"stat-badge"},ia={class:"stat-badge"},ra={key:0,class:"timeline-summary-card"},ua={class:"one-sentence"},ca={key:0,class:"themes"},da={key:1,class:"characters-section"},pa={class:"characters-grid"},va=["onClick"],ga={class:"character-name"},ma={class:"character-desc"},ha={class:"character-page"},fa={key:2,class:"timeline-section"},ba={key:3,class:"timeline-track"},ka={class:"timeline-node"},ya=["onClick"],_a={class:"timeline-card"},$a=["onClick"],wa=["src","alt","onClick"],xa={class:"timeline-card-title"},Sa={class:"timeline-page-range"},Ca={class:"timeline-event-count"},Pa={class:"expand-icon"},Ta={key:0,class:"timeline-summary"},Ia={key:1,class:"timeline-mood"},Aa={key:4,class:"timeline-track"},Ma={class:"timeline-node"},Ra=["onClick"],La={class:"timeline-card"},Ba=["onClick"],za=["src","alt","onClick"],Ua={class:"timeline-card-title"},Ea={class:"timeline-page-range"},Ka={class:"timeline-event-count"},Va={class:"expand-icon"},qa={key:0,class:"timeline-summary"},Oa={key:1,class:"timeline-events-list"},Da={key:5,class:"timeline-section"},Na={class:"plot-threads-list"},Fa={class:"thread-header"},ja={class:"thread-name"},Qa={key:0,class:"thread-desc"},Ha={key:1,class:"thread-intro"},Ga={key:6,class:"placeholder-text"},Ja=ne({__name:"TimelinePanel",setup(o){const t=oe(),l=k(!1),n=k(!1),s=k(null);k("simple");const r=k(new Set),u=k(""),g=E(()=>{if(!s.value)return!1;const P=s.value.groups&&s.value.groups.length>0,i=s.value.plot_arcs&&s.value.plot_arcs.length>0;return P||i}),d=E(()=>s.value?.stats?.total_events||0),p=E(()=>s.value?.stats?.total_pages||0),f=E(()=>s.value?.mode==="enhanced"||!!s.value?.story_summary||!!s.value?.plot_arcs?.length),C=E(()=>s.value?.main_characters||[]),T=E(()=>s.value?.plot_arcs||[]),I=E(()=>s.value?.story_summary||"");async function A(){if(t.currentBookId){l.value=!0,u.value="";try{const P=await js(t.currentBookId);console.log("Timeline API response:",P),P.success?(s.value={mode:P.mode||"simple",groups:P.groups||[],stats:P.stats,story_summary:P.summary?.one_sentence||"",main_characters:P.characters||[],plot_arcs:P.story_arcs||[],plot_threads:P.plot_threads||[],events:P.events||[],cached:P.cached},console.log("Parsed timelineData:",s.value)):u.value=P.error||"åŠ è½½æ—¶é—´çº¿å¤±è´¥"}catch(P){console.error("åŠ è½½æ—¶é—´çº¿å¤±è´¥:",P),u.value=P instanceof Error?P.message:"åŠ è½½å¤±è´¥"}finally{l.value=!1}}}async function z(){if(t.currentBookId){n.value=!0,u.value="";try{const P=await Qs(t.currentBookId);P.success?s.value=P:u.value="é‡æ–°ç”Ÿæˆå¤±è´¥"}catch(P){console.error("é‡æ–°ç”Ÿæˆæ—¶é—´çº¿å¤±è´¥:",P),u.value=P instanceof Error?P.message:"é‡æ–°ç”Ÿæˆå¤±è´¥"}finally{n.value=!1}}}function U(P){return t.currentBookId?xt(t.currentBookId,P):""}function K(P){t.selectPage(P)}function O(P){r.value.has(P)?r.value.delete(P):r.value.add(P)}function R(P){return r.value.has(P)}return we(()=>{t.currentBookId&&A()}),ke(()=>t.currentBookId,P=>{P&&(s.value=null,A())}),ke(()=>t.dataRefreshKey,P=>{P>0&&t.currentBookId&&(console.log("TimelinePanel: æ”¶åˆ°åˆ·æ–°ä¿¡å·ï¼Œé‡æ–°åŠ è½½æ•°æ®"),A())}),(P,i)=>(v(),m("div",Hl,[e("div",Gl,[i[2]||(i[2]=e("h3",null,"ðŸ“ˆ å‰§æƒ…æ—¶é—´çº¿",-1)),e("button",{class:D(["btn btn-secondary btn-sm",{loading:n.value}]),disabled:l.value||n.value,onClick:z},[n.value?(v(),m("span",Zl)):L("",!0),te(" "+$(n.value?"ç”Ÿæˆä¸­...":"ðŸ”„ é‡æ–°ç”Ÿæˆ"),1)],10,Jl)]),u.value?(v(),m("div",Wl," âš ï¸ "+$(u.value),1)):L("",!0),e("div",Xl,[l.value?(v(),m("div",Yl,[...i[3]||(i[3]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"åŠ è½½æ—¶é—´çº¿...",-1)])])):g.value?(v(),m(N,{key:2},[e("div",sa,[s.value?.stats?.total_arcs?(v(),m("span",na,"ðŸŽ­ "+$(s.value.stats.total_arcs)+" ä¸ªå‰§æƒ…å¼§",1)):L("",!0),e("span",la,"ðŸ“Š "+$(d.value)+" ä¸ªäº‹ä»¶",1),s.value?.stats?.total_characters?(v(),m("span",aa,"ðŸ‘¥ "+$(s.value.stats.total_characters)+" ä¸ªè§’è‰²",1)):L("",!0),s.value?.stats?.total_threads?(v(),m("span",oa,"ðŸ”— "+$(s.value.stats.total_threads)+" æ¡çº¿ç´¢",1)):L("",!0),e("span",ia,"ðŸ“„ "+$(p.value)+" é¡µ",1)]),I.value?(v(),m("div",ra,[i[8]||(i[8]=e("h4",null,"ðŸ“– æ•…äº‹æ¦‚è¦",-1)),e("p",ua,$(I.value),1),s.value?.plot_threads?.length?(v(),m("div",ca,[i[7]||(i[7]=e("span",null,"ä¸»é¢˜ï¼š",-1)),(v(!0),m(N,null,W(s.value.plot_threads.slice(0,5),a=>(v(),m("span",{key:a.id,class:"theme-tag"},$(a.name),1))),128))])):L("",!0)])):L("",!0),C.value.length>0?(v(),m("div",da,[i[9]||(i[9]=e("h4",null,"ðŸ‘¥ ä¸»è¦è§’è‰²",-1)),e("div",pa,[(v(!0),m(N,null,W(C.value,a=>(v(),m("div",{key:a.name,class:"character-card",onClick:c=>K(a.first_appearance)},[e("div",ga,$(a.name),1),e("div",ma,$(a.description),1),e("div",ha,"é¦–æ¬¡å‡ºçŽ°ï¼šç¬¬ "+$(a.first_appearance)+" é¡µ",1)],8,va))),128))])])):L("",!0),f.value&&T.value.length>0?(v(),m("div",fa,[...i[10]||(i[10]=[e("h4",null,"ðŸŽ­ å‰§æƒ…å‘å±•",-1)])])):L("",!0),f.value&&T.value.length>0?(v(),m("div",ba,[(v(!0),m(N,null,W(T.value,(a,c)=>(v(),m("div",{key:a.id||a.name,class:D(["timeline-group",{expanded:R(a.id||`arc-${c}`)}])},[e("div",ka,[e("div",{class:"timeline-node-dot",onClick:_=>O(a.id||`arc-${c}`)},null,8,ya),i[11]||(i[11]=e("div",{class:"timeline-node-line"},null,-1))]),e("div",_a,[e("div",{class:"timeline-card-header",onClick:_=>O(a.id||`arc-${c}`)},[e("img",{class:"timeline-thumbnail",src:U(a.page_range?.start||1),alt:`ç¬¬${a.page_range?.start||1}é¡µ`,loading:"lazy",onError:i[0]||(i[0]=_=>_.target.style.display="none"),onClick:ce(_=>K(a.page_range?.start||1),["stop"])},null,40,wa),e("div",xa,[e("span",Sa," ç¬¬ "+$(a.page_range?.start||a.start_page||"?")+"-"+$(a.page_range?.end||a.end_page||"?")+" é¡µ ",1),e("span",Ca,$(a.name),1)]),e("span",Pa,$(R(a.id||`arc-${c}`)?"â–¼":"â–¶"),1)],8,$a),a.description?(v(),m("div",Ta,$(a.description),1)):L("",!0),a.mood?(v(),m("div",Ia,[i[12]||(i[12]=e("span",{class:"label"},"ðŸŽ¨ æ°›å›´ï¼š",-1)),te($(a.mood),1)])):L("",!0)])],2))),128))])):s.value?.groups&&s.value.groups.length>0?(v(),m("div",Aa,[(v(!0),m(N,null,W(s.value.groups,a=>(v(),m("div",{key:a.id,class:D(["timeline-group",{expanded:R(a.id)}])},[e("div",Ma,[e("div",{class:"timeline-node-dot",onClick:c=>O(a.id)},null,8,Ra),i[13]||(i[13]=e("div",{class:"timeline-node-line"},null,-1))]),e("div",La,[e("div",{class:"timeline-card-header",onClick:c=>O(a.id)},[e("img",{class:"timeline-thumbnail",src:U(a.thumbnail_page||a.page_range.start),alt:`ç¬¬${a.page_range.start}é¡µ`,loading:"lazy",onError:i[1]||(i[1]=c=>c.target.style.display="none"),onClick:ce(c=>K(a.page_range.start),["stop"])},null,40,za),e("div",Ua,[e("span",Ea," ç¬¬ "+$(a.page_range.start)+"-"+$(a.page_range.end)+" é¡µ ",1),e("span",Ka,$(a.events.length)+" ä¸ªäº‹ä»¶",1)]),e("span",Va,$(R(a.id)?"â–¼":"â–¶"),1)],8,Ba),a.summary?(v(),m("div",qa,$(a.summary),1)):L("",!0),R(a.id)&&a.events.length>0?(v(),m("ul",Oa,[(v(!0),m(N,null,W(a.events,(c,_)=>(v(),m("li",{key:_,class:"timeline-event-item"},$(c),1))),128))])):L("",!0)])],2))),128))])):L("",!0),s.value?.plot_threads&&s.value.plot_threads.length>0?(v(),m("div",Da,[i[14]||(i[14]=e("h4",null,"ðŸ”— ä¼ç¬”ä¸Žçº¿ç´¢",-1)),e("div",Na,[(v(!0),m(N,null,W(s.value.plot_threads,a=>(v(),m("div",{key:a.id,class:D(["plot-thread-item",{resolved:a.status==="å·²è§£å†³"}])},[e("div",Fa,[e("span",ja,$(a.name||"æœªå‘½åçº¿ç´¢"),1),e("span",{class:D(["thread-status",{resolved:a.status==="å·²è§£å†³"}])},$(a.status||"è¿›è¡Œä¸­"),3)]),a.description?(v(),m("p",Qa,$(a.description),1)):L("",!0),a.introduced_at?(v(),m("span",Ha,"ç¬¬ "+$(a.introduced_at)+" é¡µå¼•å…¥",1)):L("",!0)],2))),128))])])):L("",!0),g.value?L("",!0):(v(),m("div",Ga,' æš‚æ— è¯¦ç»†æ—¶é—´çº¿æ•°æ®ï¼Œç‚¹å‡»"é‡æ–°ç”Ÿæˆ"æŒ‰é’®ç”Ÿæˆ '))],64)):(v(),m("div",ea,[i[4]||(i[4]=e("div",{class:"empty-icon"},"ðŸ“ˆ",-1)),i[5]||(i[5]=e("h4",null,"æ—¶é—´çº¿å°šæœªç”Ÿæˆ",-1)),i[6]||(i[6]=e("p",null,"å®Œæˆæ¼«ç”»åˆ†æžåŽä¼šè‡ªåŠ¨ç”Ÿæˆæ—¶é—´çº¿ï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰‹åŠ¨ç”Ÿæˆ",-1)),e("button",{class:"btn btn-primary btn-sm",disabled:n.value,onClick:z},$(n.value?"ç”Ÿæˆä¸­...":"ç”Ÿæˆæ—¶é—´çº¿"),9,ta)]))])]))}}),Za=ge(Ja,[["__scopeId","data-v-42a23730"]]),Wa={class:"qa-container"},Xa={key:0,class:"welcome-message"},Ya={class:"message-avatar"},eo={key:0,src:Ms,alt:"ç”¨æˆ·",class:"avatar-img"},to={key:0,class:"message-content"},so={key:1,class:"message-content markdown-content"},no={key:0,class:"loading-dots"},lo={key:0,class:"answer-mode-badge"},ao=["innerHTML"],oo={key:1,class:"message-citations"},io=["onClick"],ro=["disabled","onClick"],uo={class:"chat-input-container"},co={class:"chat-options"},po={class:"qa-mode-toggle",title:"ç²¾ç¡®æ¨¡å¼ï¼šä½¿ç”¨RAGæ£€ç´¢ç›¸å…³ç‰‡æ®µï¼›å…¨å±€æ¨¡å¼ï¼šä½¿ç”¨å…¨æ–‡æ‘˜è¦"},vo={key:0,class:"precise-mode-options"},go={class:"checkbox-label compact",title:"å¯ç”¨çˆ¶å­å—æ¨¡å¼"},mo={class:"checkbox-label compact",title:"å¯ç”¨æŽ¨ç†æ£€ç´¢"},ho={class:"checkbox-label compact",title:"å¯ç”¨é‡æŽ’åº"},fo={class:"input-label compact",title:"è¿”å›žçš„æœ€å¤§ç»“æžœæ•°"},bo={class:"input-label compact",title:"ç›¸å…³æ€§é˜ˆå€¼"},ko={key:1,class:"global-mode-hint"},yo={class:"welcome-examples"},_o=["onClick"],$o={class:"chat-input-wrapper"},wo=["disabled"],xo=["disabled"],So={key:0,class:"modal note-modal show"},Co={class:"modal-content note-modal-content"},Po={class:"modal-body"},To={key:0,class:"qa-preview"},Io={class:"qa-preview-section"},Ao={class:"qa-preview-content"},Mo={class:"qa-preview-section"},Ro=["innerHTML"],Lo={key:0,class:"qa-preview-section"},Bo={class:"qa-preview-citations"},zo={class:"note-form"},Uo={class:"form-group"},Eo={class:"form-group"},Ko=ne({__name:"QAPanel",setup(o){const t=oe(),l=k(""),n=k("precise"),s=k(!0),r=k(!0),u=k(!0),g=k(5),d=k(0),p=k(null),f=E(()=>t.qaHistory),C=E(()=>t.isStreaming),T=E(()=>n.value==="precise");function I(V){n.value=V}async function A(){const V=l.value.trim();if(!V||!t.currentBookId||C.value)return;l.value="",t.clearQAHistory(),t.addQAMessage({id:Date.now().toString(),role:"user",content:V,timestamp:new Date().toISOString()}),await vt(),U();const w=n.value==="global"?"æ­£åœ¨åˆ†æžå…¨æ–‡...":"æ€è€ƒä¸­...";t.addQAMessage({id:(Date.now()+1).toString(),role:"assistant",content:w,timestamp:new Date().toISOString(),isLoading:!0}),t.setStreaming(!0);try{const b=await Hs(t.currentBookId,V,{use_parent_child:s.value,use_reasoning:r.value,use_reranker:u.value,top_k:g.value,threshold:d.value,use_global_context:n.value==="global"});if(t.removeLoadingMessages(),b.success){const M=b.mode==="global"?"ðŸŒ å…¨å±€æ¨¡å¼":"ðŸŽ¯ ç²¾ç¡®æ¨¡å¼";t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:b.answer||"",timestamp:new Date().toISOString(),mode:M,citations:b.citations||[]})}else t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:"æŠ±æ­‰ï¼Œå¤„ç†é—®é¢˜æ—¶å‡ºé”™: "+(b.error||"æœªçŸ¥é”™è¯¯"),timestamp:new Date().toISOString()})}catch(b){console.error("é—®ç­”è¯·æ±‚å¤±è´¥:",b),t.removeLoadingMessages(),t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:"æŠ±æ­‰ï¼Œç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•ã€‚",timestamp:new Date().toISOString()})}finally{t.setStreaming(!1),await vt(),U()}}function z(V){V.key==="Enter"&&!V.shiftKey&&(V.preventDefault(),A())}function U(){p.value&&(p.value.scrollTop=p.value.scrollHeight)}async function K(){if(t.currentBookId&&confirm(`ç¡®å®šè¦é‡å»ºå‘é‡ç´¢å¼•å—ï¼Ÿ

è¿™å°†åˆ é™¤çŽ°æœ‰çš„å‘é‡æ•°æ®å¹¶é‡æ–°æž„å»ºï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚`)){t.setLoading(!0);try{const V=await Gs(t.currentBookId);if(V.success){let w="å‘é‡ç´¢å¼•é‡å»ºå®Œæˆ";V.stats&&(w+=`
é¡µé¢å‘é‡: ${V.stats.pages_count||0} æ¡`,V.stats.dialogues_count&&(w+=`
å¯¹è¯å‘é‡: ${V.stats.dialogues_count} æ¡`)),alert(w)}else alert("é‡å»ºå¤±è´¥: "+(V.error||"æœªçŸ¥é”™è¯¯"))}catch(V){console.error("é‡å»ºå‘é‡ç´¢å¼•å¤±è´¥:",V),alert("é‡å»ºå‘é‡ç´¢å¼•å¤±è´¥")}finally{t.setLoading(!1)}}}function O(V){return V?H.parse(V):""}function R(V){t.setCurrentPage(V)}const P=["æ•…äº‹çš„ä¸»é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ","ä¸»è§’çš„æ€§æ ¼æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ","ç»“å±€æ˜¯æ€Žæ ·çš„ï¼Ÿ"];function i(V){l.value=V,A()}const a=k(!1),c=k(null),_=k(""),x=k("");function y(V){if(!t.currentBookId)return;const b=t.qaHistory.find(M=>M.role==="user")?.content||"";c.value={messageId:V.id,question:b,answer:V.content,citations:V.citations||[]},_.value="",x.value="",a.value=!0}function B(){a.value=!1,c.value=null}async function G(){if(!t.currentBookId||!c.value)return;const V=new Date().toISOString(),w={id:Date.now().toString(),type:"qa",title:_.value||c.value.question.substring(0,30),content:c.value.answer,question:c.value.question,answer:c.value.answer,citations:c.value.citations,comment:x.value||void 0,createdAt:V,updatedAt:V};try{await t.addNote(w);const b=t.qaHistory.find(M=>M.id===c.value?.messageId);b&&(b.saved=!0),B()}catch(b){console.error("ä¿å­˜ç¬”è®°å¤±è´¥:",b),alert("ä¿å­˜ç¬”è®°å¤±è´¥")}}return we(()=>{U()}),(V,w)=>(v(),m("div",Wa,[e("div",{ref_key:"messagesContainer",ref:p,class:"chat-messages"},[f.value.length===0?(v(),m("div",Xa,[...w[10]||(w[10]=[e("div",{class:"welcome-icon"},"ðŸ’¬",-1),e("h3",null,"æ™ºèƒ½é—®ç­”",-1),e("p",null,"é’ˆå¯¹å·²åˆ†æžçš„æ¼«ç”»å†…å®¹æé—®ï¼ŒèŽ·å–ç²¾å‡†å›žç­”",-1)])])):L("",!0),(v(!0),m(N,null,W(f.value,b=>(v(),m("div",{key:b.id,class:D(["chat-message",b.role])},[e("div",Ya,[b.role==="user"?(v(),m("img",eo)):(v(),m(N,{key:1},[te(" ðŸ¤– ")],64))]),b.role==="user"?(v(),m("div",to,$(b.content),1)):(v(),m("div",so,[b.isLoading?(v(),m("div",no,$(b.content),1)):(v(),m(N,{key:1},[b.mode?(v(),m("div",lo,$(b.mode),1)):L("",!0),e("div",{class:"answer-text",innerHTML:O(b.content)},null,8,ao),b.citations&&b.citations.length>0?(v(),m("div",oo,[w[11]||(w[11]=e("span",null,"ðŸ“– å¼•ç”¨: ",-1)),(v(!0),m(N,null,W(b.citations,M=>(v(),m("span",{key:M.page,class:"citation-item",onClick:X=>R(M.page)}," ç¬¬"+$(M.page)+"é¡µ ",9,io))),128))])):L("",!0),b.content&&!b.isLoading?(v(),m("button",{key:2,class:D(["message-save-btn",{saved:b.saved}]),disabled:b.saved,onClick:M=>y(b)},$(b.saved?"âœ… å·²ä¿å­˜":"ðŸ“ ä¿å­˜ä¸ºç¬”è®°"),11,ro)):L("",!0)],64))]))],2))),128))],512),e("div",uo,[e("div",co,[e("div",po,[e("button",{type:"button",class:D(["qa-mode-btn",{active:n.value==="precise"}]),onClick:w[0]||(w[0]=b=>I("precise"))}," ðŸŽ¯ ç²¾ç¡®æ¨¡å¼ ",2),e("button",{type:"button",class:D(["qa-mode-btn",{active:n.value==="global"}]),onClick:w[1]||(w[1]=b=>I("global"))}," ðŸŒ å…¨å±€æ¨¡å¼ ",2)]),w[20]||(w[20]=e("span",{class:"chat-option-divider"},"|",-1)),T.value?(v(),m("div",vo,[e("label",go,[q(e("input",{"onUpdate:modelValue":w[2]||(w[2]=b=>s.value=b),type:"checkbox"},null,512),[[Ce,s.value]]),w[12]||(w[12]=e("span",null,"çˆ¶å­å—æ¨¡å¼",-1))]),e("label",mo,[q(e("input",{"onUpdate:modelValue":w[3]||(w[3]=b=>r.value=b),type:"checkbox"},null,512),[[Ce,r.value]]),w[13]||(w[13]=e("span",null,"æŽ¨ç†æ£€ç´¢",-1))]),e("label",ho,[q(e("input",{"onUpdate:modelValue":w[4]||(w[4]=b=>u.value=b),type:"checkbox"},null,512),[[Ce,u.value]]),w[14]||(w[14]=e("span",null,"é‡æŽ’åº",-1))]),w[17]||(w[17]=e("span",{class:"chat-option-divider"},"|",-1)),e("label",fo,[w[15]||(w[15]=e("span",null,"Top K:",-1)),q(e("input",{"onUpdate:modelValue":w[5]||(w[5]=b=>g.value=b),type:"number",min:"1",max:"20",class:"input-small"},null,512),[[Q,g.value,void 0,{number:!0}]])]),e("label",bo,[w[16]||(w[16]=e("span",null,"é˜ˆå€¼:",-1)),q(e("input",{"onUpdate:modelValue":w[6]||(w[6]=b=>d.value=b),type:"number",min:"0",max:"1",step:"0.1",class:"input-small"},null,512),[[Q,d.value,void 0,{number:!0}]])]),w[18]||(w[18]=e("span",{class:"chat-option-divider"},"|",-1)),e("button",{type:"button",class:"btn btn-sm btn-secondary",title:"é‡å»ºå‘é‡ç´¢å¼•",onClick:K}," ðŸ”„ é‡å»ºå‘é‡ ")])):(v(),m("div",ko,[w[19]||(w[19]=e("span",{class:"hint-text"},"ðŸ’¡ å…¨å±€æ¨¡å¼ä½¿ç”¨å…¨æ–‡æ‘˜è¦å›žç­”ï¼Œé€‚åˆæ€»ç»“æ€§é—®é¢˜",-1)),e("div",yo,[(v(),m(N,null,W(P,(b,M)=>e("span",{key:M,class:"example-tag",onClick:X=>i(b)},$(b),9,_o)),64))])]))]),e("div",$o,[q(e("textarea",{"onUpdate:modelValue":w[7]||(w[7]=b=>l.value=b),placeholder:"è¾“å…¥ä½ çš„é—®é¢˜...",rows:"1",disabled:C.value,onKeydown:z},null,40,wo),[[Q,l.value]]),e("button",{class:"send-btn",disabled:C.value||!l.value.trim(),onClick:A},[...w[21]||(w[21]=[e("span",null,"å‘é€",-1)])],8,xo)])]),a.value?(v(),m("div",So,[e("div",{class:"modal-overlay",onClick:B}),e("div",Co,[e("div",{class:"modal-header"},[w[22]||(w[22]=e("h2",null,"ðŸ“ æ·»åŠ ç¬”è®°",-1)),e("button",{class:"modal-close",onClick:B},"Ã—")]),e("div",Po,[c.value?(v(),m("div",To,[e("div",Io,[w[23]||(w[23]=e("label",null,"é—®é¢˜",-1)),e("div",Ao,$(c.value.question),1)]),e("div",Mo,[w[24]||(w[24]=e("label",null,"å›žç­”",-1)),e("div",{class:"qa-preview-content",innerHTML:O(c.value.answer)},null,8,Ro)]),c.value.citations.length>0?(v(),m("div",Lo,[w[25]||(w[25]=e("label",null,"å¼•ç”¨é¡µç ",-1)),e("div",Bo,[(v(!0),m(N,null,W(c.value.citations,b=>(v(),m("span",{key:b.page,class:"qa-citation-badge"}," ç¬¬"+$(b.page)+"é¡µ ",1))),128))])])):L("",!0)])):L("",!0),e("div",zo,[e("div",Uo,[w[26]||(w[26]=e("label",{for:"qaNoteTitle"},[te("ç¬”è®°æ ‡é¢˜ "),e("span",{class:"optional"},"(å¯é€‰)")],-1)),q(e("input",{"onUpdate:modelValue":w[8]||(w[8]=b=>_.value=b),type:"text",id:"qaNoteTitle",class:"form-input",placeholder:"é»˜è®¤ä½¿ç”¨é—®é¢˜ä½œä¸ºæ ‡é¢˜..."},null,512),[[Q,_.value]])]),e("div",Eo,[w[27]||(w[27]=e("label",{for:"qaNoteComment"},[te("è¡¥å……è¯´æ˜Ž "),e("span",{class:"optional"},"(å¯é€‰)")],-1)),q(e("textarea",{"onUpdate:modelValue":w[9]||(w[9]=b=>x.value=b),id:"qaNoteComment",class:"form-textarea",rows:"3",placeholder:"æ·»åŠ ä½ çš„è¯„è®ºæˆ–è¡¥å……..."},null,512),[[Q,x.value]])])])]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-secondary",onClick:B},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:G},"ä¿å­˜ç¬”è®°")])])])):L("",!0)]))}}),Vo=ge(Ko,[["__scopeId","data-v-0019a5fe"]]),qo={class:"workspace-section notes-section"},Oo={class:"section-header-with-actions"},Do={class:"notes-filter"},No={class:"notes-list"},Fo={key:0,class:"placeholder-text"},jo=["onClick"],Qo={class:"note-header"},Ho={class:"note-type-icon"},Go={class:"note-date"},Jo={class:"note-actions"},Zo=["onClick"],Wo=["onClick"],Xo={key:0,class:"note-title"},Yo={key:1,class:"note-content"},ei={class:"qa-preview-text"},ti={key:2,class:"note-content"},si={key:3,class:"note-tags"},ni={key:4,class:"note-citations"},li=["onClick"],ai={key:0,class:"citation-badge"},oi={key:5,class:"note-page-link"},ii=["onClick"],ri={class:"modal-content modal-sm"},ui={class:"modal-header"},ci={class:"modal-body"},di={class:"qa-note-view"},pi={class:"qa-section"},vi={class:"qa-content"},gi={class:"qa-section"},mi={class:"qa-content qa-answer"},hi={key:0,class:"qa-section"},fi={class:"qa-citations"},bi=["onClick"],ki={key:1,class:"qa-section"},yi={class:"qa-content"},_i={class:"form-group"},$i={class:"form-group"},wi={class:"form-group"},xi={class:"form-group"},Si={class:"form-group"},Ci={class:"form-group"},Pi={class:"modal-footer"},Ti=["disabled"],Ii=ne({__name:"NotesPanel",setup(o){const t=[{label:"å…¨éƒ¨",value:"all"},{label:"æ–‡æœ¬ç¬”è®°",value:"text"},{label:"é—®ç­”ç¬”è®°",value:"qa"}],l=[{label:"æ–‡æœ¬ç¬”è®°",value:"text"},{label:"é—®ç­”ç¬”è®°",value:"qa"}],n=oe(),s=k(!1),r=k(null),u=k(""),g=k(""),d=k("text"),p=k(null),f=k(""),C=E(()=>n.filteredNotes),T=E({get:()=>n.noteTypeFilter,set:a=>n.setNoteTypeFilter(a)});function I(){r.value=null,u.value="",g.value="",d.value="text",p.value=n.selectedPageNum,f.value="",s.value=!0}function A(a){r.value=a,u.value=a.title||"",g.value=a.content,d.value=a.type,p.value=a.pageNum||null,f.value=(a.tags||[]).join(", "),s.value=!0}function z(){s.value=!1,r.value=null,u.value="",g.value="",f.value=""}function U(a){return a.trim()?a.split(/[,ï¼Œ]/).map(c=>c.trim()).filter(c=>c):[]}async function K(){if(!g.value.trim())return;const a=U(f.value);if(r.value)await n.updateNote(r.value.id,{title:u.value||void 0,content:g.value,type:d.value,pageNum:p.value||void 0,tags:a.length>0?a:void 0});else{const c={id:Date.now().toString(),type:d.value,title:u.value||void 0,content:g.value,pageNum:p.value||void 0,tags:a.length>0?a:void 0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await n.addNote(c)}z()}async function O(a){confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¬”è®°å—ï¼Ÿ")&&await n.deleteNote(a)}function R(a){n.selectPage(a)}function P(a){return new Date(a).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function i(a){return a==="qa"?"ðŸ’¬":"ðŸ“"}return(a,c)=>(v(),m("div",qo,[e("div",Oo,[c[7]||(c[7]=e("h3",{class:"section-title"},"ðŸ“ ç¬”è®°",-1)),e("div",Do,[Y(de,{modelValue:T.value,"onUpdate:modelValue":c[0]||(c[0]=_=>T.value=_),options:t},null,8,["modelValue"])])]),e("div",No,[C.value.length===0?(v(),m("div",Fo," æš‚æ— ç¬”è®° ")):L("",!0),(v(!0),m(N,null,W(C.value,_=>(v(),m("div",{key:_.id,class:D(["note-item",{"qa-note":_.type==="qa"}]),onClick:x=>A(_)},[e("div",Qo,[e("span",Ho,$(i(_.type)),1),e("span",Go,$(P(_.createdAt)),1),e("div",Jo,[e("button",{class:"btn-icon-sm",title:"ç¼–è¾‘",onClick:ce(x=>A(_),["stop"])}," âœï¸ ",8,Zo),e("button",{class:"btn-icon-sm",title:"åˆ é™¤",onClick:ce(x=>O(_.id),["stop"])}," ðŸ—‘ï¸ ",8,Wo)])]),_.title?(v(),m("div",Xo,$(_.title),1)):L("",!0),_.type==="qa"?(v(),m("div",Yo,[e("div",ei,"Q: "+$(_.question?.substring(0,60))+"...",1)])):(v(),m("div",ti,$(_.content),1)),_.tags&&_.tags.length>0?(v(),m("div",si,[(v(!0),m(N,null,W(_.tags,x=>(v(),m("span",{key:x,class:"note-tag"},$(x),1))),128))])):L("",!0),_.type==="qa"&&_.citations&&_.citations.length>0?(v(),m("div",ni,[(v(!0),m(N,null,W(_.citations.slice(0,3),x=>(v(),m("span",{key:x.page,class:"citation-badge",onClick:ce(y=>R(x.page),["stop"])}," ç¬¬"+$(x.page)+"é¡µ ",9,li))),128)),_.citations.length>3?(v(),m("span",ai,"+"+$(_.citations.length-3),1)):L("",!0)])):L("",!0),_.pageNum?(v(),m("div",oi,[e("button",{class:"btn-link",onClick:ce(x=>R(_.pageNum),["stop"])}," ðŸ“„ ç¬¬ "+$(_.pageNum)+" é¡µ ",9,ii)])):L("",!0)],10,jo))),128))]),e("button",{class:"btn btn-secondary btn-block btn-sm",onClick:I}," + æ·»åŠ ç¬”è®° "),s.value?(v(),m("div",{key:0,class:"modal show",onClick:ce(z,["self"])},[e("div",ri,[e("div",ui,[e("h3",null,$(r.value?"ç¼–è¾‘ç¬”è®°":"æ·»åŠ ç¬”è®°"),1),e("button",{class:"modal-close",onClick:z},"Ã—")]),e("div",ci,[r.value&&r.value.type==="qa"?(v(),m(N,{key:0},[e("div",di,[e("div",pi,[c[8]||(c[8]=e("label",{class:"qa-label"},"é—®é¢˜",-1)),e("div",vi,$(r.value.question),1)]),e("div",gi,[c[9]||(c[9]=e("label",{class:"qa-label"},"å›žç­”",-1)),e("div",mi,$(r.value.answer),1)]),r.value.citations&&r.value.citations.length>0?(v(),m("div",hi,[c[10]||(c[10]=e("label",{class:"qa-label"},"å¼•ç”¨é¡µç ",-1)),e("div",fi,[(v(!0),m(N,null,W(r.value.citations,_=>(v(),m("span",{key:_.page,class:"qa-citation-badge",onClick:x=>R(_.page)}," ç¬¬"+$(_.page)+"é¡µ ",9,bi))),128))])])):L("",!0),r.value.comment?(v(),m("div",ki,[c[11]||(c[11]=e("label",{class:"qa-label"},"è¡¥å……è¯´æ˜Ž",-1)),e("div",yi,$(r.value.comment),1)])):L("",!0)]),e("div",_i,[c[12]||(c[12]=e("label",null,[te("ç¬”è®°æ ‡é¢˜ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),q(e("input",{"onUpdate:modelValue":c[1]||(c[1]=_=>u.value=_),type:"text",class:"form-input",placeholder:"ä¿®æ”¹æ ‡é¢˜..."},null,512),[[Q,u.value]])])],64)):(v(),m(N,{key:1},[e("div",$i,[c[13]||(c[13]=e("label",null,"ç¬”è®°ç±»åž‹",-1)),Y(de,{modelValue:d.value,"onUpdate:modelValue":c[2]||(c[2]=_=>d.value=_),options:l},null,8,["modelValue"])]),e("div",wi,[c[14]||(c[14]=e("label",null,[te("æ ‡é¢˜ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),q(e("input",{"onUpdate:modelValue":c[3]||(c[3]=_=>u.value=_),type:"text",class:"form-input",placeholder:"ç»™ç¬”è®°èµ·ä¸ªæ ‡é¢˜..."},null,512),[[Q,u.value]])]),e("div",xi,[c[15]||(c[15]=e("label",null,[te("å†…å®¹ "),e("span",{class:"label-required"},"*")],-1)),q(e("textarea",{"onUpdate:modelValue":c[4]||(c[4]=_=>g.value=_),class:"form-textarea",rows:"5",placeholder:"å†™ä¸‹ä½ çš„æƒ³æ³•..."},null,512),[[Q,g.value]])]),e("div",Si,[c[16]||(c[16]=e("label",null,[te("å…³è”é¡µç  "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),q(e("input",{"onUpdate:modelValue":c[5]||(c[5]=_=>p.value=_),type:"number",class:"form-input",placeholder:"è¾“å…¥é¡µç ",min:"1"},null,512),[[Q,p.value,void 0,{number:!0}]])]),e("div",Ci,[c[17]||(c[17]=e("label",null,[te("æ ‡ç­¾ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),q(e("input",{"onUpdate:modelValue":c[6]||(c[6]=_=>f.value=_),type:"text",class:"form-input",placeholder:"å¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”ï¼Œå¦‚: è§’è‰²,å‰§æƒ…"},null,512),[[Q,f.value]])])],64))]),e("div",Pi,[e("button",{class:"btn btn-secondary",onClick:z},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:r.value?.type!=="qa"&&!g.value.trim(),onClick:K}," ä¿å­˜ ",8,Ti)])])])):L("",!0)]))}}),Ai=ge(Ii,[["__scopeId","data-v-45521d3c"]]),Mi={class:"workspace-section page-detail-section"},Ri={class:"page-detail"},Li={key:0,class:"placeholder-text"},Bi={key:1,class:"loading-state"},zi={key:2,class:"page-detail-content"},Ui={class:"page-detail-header"},Ei={class:"page-nav-buttons"},Ki=["disabled"],Vi={class:"page-indicator"},qi=["disabled"],Oi={key:0,class:"error-message"},Di=["src","alt"],Ni={key:1,class:"page-summary"},Fi={key:2,class:"page-summary empty"},ji={key:3,class:"scene-mood-info"},Qi={key:0,class:"info-item"},Hi={class:"info-value"},Gi={key:1,class:"info-item"},Ji={class:"info-value"},Zi={key:4,class:"dialogues-section"},Wi={class:"dialogue-speaker"},Xi={class:"dialogue-text"},Yi={key:0,class:"dialogue-original"},er={key:5,class:"dialogues-section empty"},tr={class:"page-detail-actions"},sr=["disabled"],nr={key:0,class:"btn-spinner"},lr=["disabled"],ar=["src","alt"],or={class:"preview-nav"},ir=["disabled"],rr={class:"preview-page-info"},ur=["disabled"],cr=ne({__name:"PageDetail",setup(o){const t=oe(),l=k(null),n=k(!1),s=k(!1),r=k(!1),u=k(""),g=E(()=>t.selectedPageNum),d=E(()=>t.totalPageCount),p=E(()=>g.value!==null&&g.value>1),f=E(()=>g.value!==null&&g.value<d.value),C=E(()=>!t.currentBookId||!g.value?"":qs(t.currentBookId,g.value)),T=E(()=>{if(!l.value?.panels)return[];const x=[];for(const y of l.value.panels)if(y.dialogues)for(const B of y.dialogues){const G=B.translated_text||B.text;G&&x.push({speaker:B.speaker_name||B.character||"æœªçŸ¥",text:G,originalText:B.text!==B.translated_text?B.text:void 0})}return x}),I=E(()=>l.value?.analyzed===!0||!!l.value?.page_summary),A=E(()=>l.value?.scene||""),z=E(()=>l.value?.mood||"");async function U(){if(!t.currentBookId||!g.value){l.value=null;return}n.value=!0,u.value="";try{const x=await Vs(t.currentBookId,g.value);x.success?x.analysis?l.value=x.analysis:x.page?l.value=x.page:l.value=null:(l.value=null,x.error&&(u.value=x.error))}catch(x){console.error("åŠ è½½é¡µé¢è¯¦æƒ…å¤±è´¥:",x),l.value=null,u.value=x instanceof Error?x.message:"åŠ è½½å¤±è´¥"}finally{n.value=!1}}function K(){p.value&&g.value&&t.selectPage(g.value-1)}function O(){f.value&&g.value&&t.selectPage(g.value+1)}async function R(){if(!(!t.currentBookId||!g.value)){s.value=!0,u.value="";try{const x=await Ks(t.currentBookId,g.value);x.success?await U():u.value=x.error||"é‡æ–°åˆ†æžå¤±è´¥"}catch(x){console.error("é‡æ–°åˆ†æžå¤±è´¥:",x),u.value=x instanceof Error?x.message:"é‡æ–°åˆ†æžå¤±è´¥"}finally{s.value=!1}}}function P(){r.value=!0}function i(){r.value=!1}function a(x){if(r.value)switch(x.key){case"Escape":i();break;case"ArrowLeft":p.value&&K();break;case"ArrowRight":f.value&&O();break}}const c=k(!1);async function _(){if(!(!t.currentBookId||!g.value||!l.value)){c.value=!0;try{let x=`# ç¬¬ ${g.value} é¡µåˆ†æžæ•°æ®

`;if(l.value.page_summary&&(x+=`## ðŸ“ é¡µé¢æ‘˜è¦

${l.value.page_summary}

`),l.value.scene&&(x+=`## ðŸŽ¬ åœºæ™¯

${l.value.scene}

`),l.value.mood&&(x+=`## ðŸŽ­ æ°›å›´

${l.value.mood}

`),T.value.length>0){x+=`## ðŸ’¬ å¯¹è¯å†…å®¹

`;for(const V of T.value)x+=`**${V.speaker}**: ${V.text}

`,V.originalText&&(x+=`> åŽŸæ–‡: ${V.originalText}

`)}const y=new Blob([x],{type:"text/markdown"}),B=URL.createObjectURL(y),G=document.createElement("a");G.href=B,G.download=`${t.currentBookId}_page_${g.value}.md`,G.click(),URL.revokeObjectURL(B)}catch(x){console.error("å¯¼å‡ºé¡µé¢æ•°æ®å¤±è´¥:",x),u.value="å¯¼å‡ºå¤±è´¥"}finally{c.value=!1}}}return ke(g,()=>{U()},{immediate:!0}),(x,y)=>(v(),m("div",Mi,[y[12]||(y[12]=e("h3",{class:"section-title"},"ðŸ“„ é¡µé¢è¯¦æƒ…",-1)),e("div",Ri,[g.value?n.value?(v(),m("div",Bi,[...y[3]||(y[3]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"åŠ è½½ä¸­...",-1)])])):(v(),m("div",zi,[e("div",Ui,[e("h4",null,"ðŸ“„ ç¬¬ "+$(g.value)+" é¡µ",1),e("div",Ei,[e("button",{class:D(["btn-page-nav",{disabled:!p.value}]),disabled:!p.value,title:"ä¸Šä¸€é¡µ (â†)",onClick:K}," â—€ ä¸Šä¸€å¼  ",10,Ki),e("span",Vi,$(g.value)+" / "+$(d.value),1),e("button",{class:D(["btn-page-nav",{disabled:!f.value}]),disabled:!f.value,title:"ä¸‹ä¸€é¡µ (â†’)",onClick:O}," ä¸‹ä¸€å¼  â–¶ ",10,qi)])]),u.value?(v(),m("div",Oi," âš ï¸ "+$(u.value),1)):L("",!0),e("div",{class:"page-detail-image",onClick:P},[e("img",{src:C.value,alt:`ç¬¬${g.value}é¡µ`,onError:y[0]||(y[0]=B=>B.target.style.display="none")},null,40,Di),y[4]||(y[4]=e("div",{class:"image-overlay"},[e("span",{class:"zoom-hint"},"ðŸ” ç‚¹å‡»æ”¾å¤§")],-1))]),e("div",{class:D(["analysis-status-tag",{analyzed:I.value}])},$(I.value?"âœ“ å·²åˆ†æž":"â—‹ æœªåˆ†æž"),3),l.value?.page_summary?(v(),m("div",Ni,[y[5]||(y[5]=e("h5",null,"ðŸ“ é¡µé¢æ‘˜è¦",-1)),e("p",null,$(l.value.page_summary),1)])):(v(),m("div",Fi,[...y[6]||(y[6]=[e("p",null,"æ­¤é¡µå°šæœªåˆ†æžï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹åˆ†æž",-1)])])),A.value||z.value?(v(),m("div",ji,[A.value?(v(),m("div",Qi,[y[7]||(y[7]=e("span",{class:"info-label"},"ðŸŽ¬ åœºæ™¯ï¼š",-1)),e("span",Hi,$(A.value),1)])):L("",!0),z.value?(v(),m("div",Gi,[y[8]||(y[8]=e("span",{class:"info-label"},"ðŸŽ­ æ°›å›´ï¼š",-1)),e("span",Ji,$(z.value),1)])):L("",!0)])):L("",!0),T.value.length>0?(v(),m("div",Zi,[e("h5",null,"ðŸ’¬ å¯¹è¯å†…å®¹ ("+$(T.value.length)+")",1),(v(!0),m(N,null,W(T.value,(B,G)=>(v(),m("div",{key:G,class:"dialogue-item"},[e("div",Wi,[y[9]||(y[9]=e("span",{class:"speaker-icon"},"ðŸ‘¤",-1)),te(" "+$(B.speaker),1)]),e("div",Xi,$(B.text),1),B.originalText?(v(),m("div",Yi,[y[10]||(y[10]=e("span",{class:"original-label"},"åŽŸæ–‡ï¼š",-1)),te($(B.originalText),1)])):L("",!0)]))),128))])):I.value?(v(),m("div",er,[...y[11]||(y[11]=[e("p",null,"æ­¤é¡µæ²¡æœ‰æ£€æµ‹åˆ°å¯¹è¯å†…å®¹",-1)])])):L("",!0),e("div",tr,[e("button",{class:D(["btn btn-secondary btn-sm",{loading:s.value}]),disabled:s.value,onClick:R},[s.value?(v(),m("span",nr)):L("",!0),te(" "+$(s.value?"åˆ†æžä¸­...":"ðŸ”„ é‡æ–°åˆ†æž"),1)],10,sr),I.value?(v(),m("button",{key:0,class:"btn btn-secondary btn-sm",disabled:c.value,onClick:_},$(c.value?"å¯¼å‡ºä¸­...":"ðŸ“„ å¯¼å‡ºæ­¤é¡µ"),9,lr)):L("",!0)])])):(v(),m("div",Li,[...y[2]||(y[2]=[e("div",{class:"empty-icon"},"ðŸ“„",-1),e("p",null,"ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ‘ä¸­çš„é¡µé¢æŸ¥çœ‹è¯¦æƒ…",-1)])]))]),r.value?(v(),m("div",{key:0,class:"image-preview-modal",tabindex:"0",onClick:i,onKeydown:a},[e("div",{class:"image-preview-content",onClick:y[1]||(y[1]=ce(()=>{},["stop"]))},[e("button",{class:"preview-close",title:"å…³é—­ (Esc)",onClick:i},"Ã—"),e("img",{src:C.value,alt:`ç¬¬${g.value}é¡µ`},null,8,ar),e("div",or,[e("button",{class:"preview-nav-btn prev",disabled:!p.value,title:"ä¸Šä¸€é¡µ (â†)",onClick:ce(K,["stop"])}," â—€ ",8,ir),e("span",rr,$(g.value)+" / "+$(d.value),1),e("button",{class:"preview-nav-btn next",disabled:!f.value,title:"ä¸‹ä¸€é¡µ (â†’)",onClick:ce(O,["stop"])}," â–¶ ",8,ur)])])],32)):L("",!0)]))}}),dr=ge(cr,[["__scopeId","data-v-25a66086"]]),pr={class:"sidebar-section pages-tree-section"},vr={class:"section-header"},gr={class:"page-count-badge"},mr={class:"pages-tree"},hr={key:0,class:"empty-hint"},fr={key:1,class:"tree-all-pages"},br=["data-page","onClick"],kr=["src","alt"],yr={class:"tree-page-num"},_r={key:2,class:"tree-load-more"},$r=["onClick"],wr={class:"tree-chapter-info"},xr={class:"tree-chapter-title"},Sr={class:"tree-chapter-meta"},Cr=["onClick"],Pr={class:"tree-pages-grid"},Tr=["data-page","onClick"],Ir=["src","alt"],Ar={class:"tree-page-num"},Mr=ne({__name:"PagesTree",setup(o){const t=oe(),l=k(new Set),n=k(new Map),s=k(100),r=E(()=>t.chapters),u=E(()=>t.totalPageCount);function g(R){l.value.has(R)?l.value.delete(R):l.value.add(R)}function d(R){return l.value.has(R)}function p(R){t.selectPage(R)}function f(R){return n.value.get(R)||!1}function C(R){return t.selectedPageNum===R}function T(R,P){const i=[];for(let a=R;a<=P;a++)i.push(a);return i}function I(R){return t.currentBookId?xt(t.currentBookId,R):""}function A(){s.value=Math.min(s.value+100,u.value)}function z(R){const P=R.target;P.style.opacity="0"}function U(R){const P=R.endPage-R.startPage+1;let i=0;for(let a=R.startPage;a<=R.endPage;a++)n.value.get(a)&&i++;return i===P}async function K(R){if(confirm("ç¡®å®šè¦é‡æ–°åˆ†æžæ­¤ç« èŠ‚å—ï¼Ÿ"))try{const i=await(await fetch(`/api/manga-insight/${t.currentBookId}/reanalyze/chapter/${R}`,{method:"POST"})).json();i.success?alert("ç« èŠ‚åˆ†æžå·²å¯åŠ¨"):alert("å¯åŠ¨å¤±è´¥: "+(i.error||"æœªçŸ¥é”™è¯¯"))}catch(P){console.error("é‡æ–°åˆ†æžç« èŠ‚å¤±è´¥:",P),alert("é‡æ–°åˆ†æžå¤±è´¥")}}async function O(){if(t.currentBookId)try{const P=await(await fetch(`/api/manga-insight/${t.currentBookId}/pages`)).json();P.success&&P.pages&&P.pages.forEach(a=>{n.value.set(a,!0)})}catch(R){console.error("åŠ è½½å·²åˆ†æžé¡µé¢å¤±è´¥:",R)}}return we(async()=>{await O(),r.value.length>0&&r.value[0]&&l.value.add(r.value[0].id)}),ke(()=>t.analyzedPageCount,async(R,P)=>{R!==P&&R>0&&(console.log(`å·²åˆ†æžé¡µæ•°å˜åŒ–: ${P} -> ${R}ï¼Œåˆ·æ–°é¡µé¢æ ‡è®°`),n.value.clear(),await O())}),(R,P)=>(v(),m("div",pr,[e("div",vr,[P[2]||(P[2]=e("h3",{class:"section-title"},"å†…å®¹å¯¼èˆª",-1)),e("span",gr,$(u.value)+"é¡µ",1)]),e("div",mr,[r.value.length===0?(v(),m(N,{key:0},[u.value===0?(v(),m("div",hr," æš‚æ— é¡µé¢ ")):(v(),m("div",fr,[(v(!0),m(N,null,W(T(1,Math.min(u.value,s.value)),i=>(v(),m("div",{key:i,class:D(["tree-page-item",{selected:C(i),analyzed:f(i)}]),"data-page":i,onClick:a=>p(i)},[e("img",{src:I(i),alt:`ç¬¬${i}é¡µ`,class:"tree-page-thumb",loading:"lazy",onError:P[0]||(P[0]=a=>z(a))},null,40,kr),e("span",yr,$(i),1)],10,br))),128))])),u.value>s.value?(v(),m("div",_r,[e("button",{class:"btn-load-more",onClick:A}," åŠ è½½æ›´å¤š (è¿˜æœ‰ "+$(u.value-s.value)+" é¡µ) ",1)])):L("",!0)],64)):(v(!0),m(N,{key:1},W(r.value,i=>(v(),m("div",{key:i.id,class:D(["tree-chapter",{expanded:d(i.id)}])},[e("div",{class:"tree-chapter-header",onClick:a=>g(i.id)},[P[3]||(P[3]=e("span",{class:"tree-expand-icon"},[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8 5l8 7-8 7z"})])],-1)),e("div",wr,[e("span",xr,$(i.title),1),e("span",Sr,$(i.endPage-i.startPage+1)+"é¡µ",1)]),e("span",{class:D(["tree-chapter-status",{analyzed:U(i)}])},null,2),e("button",{class:"btn-reanalyze-chapter",title:"é‡æ–°åˆ†æžæ­¤ç« èŠ‚",onClick:ce(a=>K(i.id),["stop"])}," ðŸ”„ ",8,Cr)],8,$r),e("div",Pr,[(v(!0),m(N,null,W(T(i.startPage,i.endPage),a=>(v(),m("div",{key:a,class:D(["tree-page-item",{selected:C(a),analyzed:f(a)}]),"data-page":a,onClick:c=>p(a)},[e("img",{src:I(a),alt:`ç¬¬${a}é¡µ`,class:"tree-page-thumb",loading:"lazy",onError:P[1]||(P[1]=c=>z(c))},null,40,Ir),e("span",Ar,$(a),1)],10,Tr))),128))])],2))),128))])]))}}),Rr=ge(Mr,[["__scopeId","data-v-3a1c7721"]]),Et=[{value:"gemini",label:"Google Gemini"},{value:"openai",label:"OpenAI"},{value:"qwen",label:"é˜¿é‡Œé€šä¹‰åƒé—®"},{value:"siliconflow",label:"SiliconFlow"},{value:"deepseek",label:"DeepSeek"},{value:"volcano",label:"ç«å±±å¼•æ“Ž"},{value:"custom",label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹"}],Lr=[{value:"openai",label:"OpenAI"},{value:"siliconflow",label:"SiliconFlow"},{value:"custom",label:"è‡ªå®šä¹‰"}],Br=[{value:"jina",label:"Jina AI"},{value:"cohere",label:"Cohere"},{value:"siliconflow",label:"SiliconFlow"},{value:"custom",label:"è‡ªå®šä¹‰"}],zr=[{value:"simple",label:"ç®€æ´æ¨¡å¼ - æ‰¹é‡åˆ†æž â†’ å…¨ä¹¦æ€»ç»“ï¼ˆçŸ­ç¯‡ï¼‰"},{value:"standard",label:"æ ‡å‡†æ¨¡å¼ - æ‰¹é‡åˆ†æž â†’ æ®µè½æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"chapter_based",label:"ç« èŠ‚æ¨¡å¼ - æ‰¹é‡åˆ†æž â†’ ç« èŠ‚æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"full",label:"å®Œæ•´æ¨¡å¼ - æ‰¹é‡åˆ†æž â†’ å°æ€»ç»“ â†’ ç« èŠ‚æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"custom",label:"è‡ªå®šä¹‰æ¨¡å¼ - å®Œå…¨è‡ªå®šä¹‰å±‚çº§æž¶æž„"}],Ur=[{value:"batch_analysis",label:"ðŸ“„ æ‰¹é‡åˆ†æžæç¤ºè¯"},{value:"segment_summary",label:"ðŸ“‘ æ®µè½æ€»ç»“æç¤ºè¯"},{value:"chapter_summary",label:"ðŸ“– ç« èŠ‚æ€»ç»“æç¤ºè¯"},{value:"qa_response",label:"ðŸ’¬ é—®ç­”å“åº”æç¤ºè¯"}],Er={gemini:"gemini-2.0-flash",openai:"gpt-4o",qwen:"qwen-vl-max",deepseek:"deepseek-chat",siliconflow:"Qwen/Qwen2.5-VL-72B-Instruct",volcano:"doubao-1.5-vision-pro-32k"},Kr={gemini:"gemini-2.0-flash",openai:"gpt-4o-mini",qwen:"qwen-turbo",deepseek:"deepseek-chat",siliconflow:"Qwen/Qwen2.5-72B-Instruct",volcano:"doubao-1.5-pro-32k"},Vr={openai:"text-embedding-3-small",siliconflow:"BAAI/bge-m3"},qr={jina:"jina-reranker-v2-base-multilingual",cohere:"rerank-multilingual-v3.0",siliconflow:"BAAI/bge-reranker-v2-m3"},Xe={simple:{name:"ç®€æ´æ¨¡å¼",description:"é€‚åˆ100é¡µä»¥å†…çš„çŸ­ç¯‡æ¼«ç”»",layers:[{name:"æ‰¹é‡åˆ†æž",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},standard:{name:"æ ‡å‡†æ¨¡å¼",description:"é€‚åˆå¤§å¤šæ•°æ¼«ç”»ï¼Œå¹³è¡¡æ•ˆæžœä¸Žé€Ÿåº¦",layers:[{name:"æ‰¹é‡åˆ†æž",units:5,align:!1},{name:"æ®µè½æ€»ç»“",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},chapter_based:{name:"ç« èŠ‚æ¨¡å¼",description:"é€‚åˆæœ‰æ˜Žç¡®ç« èŠ‚åˆ’åˆ†çš„æ¼«ç”»ï¼Œä¼šåœ¨ç« èŠ‚è¾¹ç•Œå¤„åˆ‡åˆ†",layers:[{name:"æ‰¹é‡åˆ†æž",units:5,align:!0},{name:"ç« èŠ‚æ€»ç»“",units:0,align:!0},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},full:{name:"å®Œæ•´æ¨¡å¼",description:"é€‚åˆé•¿ç¯‡è¿žè½½ï¼Œæä¾›æœ€è¯¦ç»†çš„åˆ†å±‚æ€»ç»“",layers:[{name:"æ‰¹é‡åˆ†æž",units:5,align:!1},{name:"å°æ€»ç»“",units:5,align:!1},{name:"ç« èŠ‚æ€»ç»“",units:0,align:!0},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]}},Fe=["siliconflow","deepseek","volcano","gemini","qwen","openai","custom"],Or={class:"insight-settings-content"},Dr={class:"form-group"},Nr={class:"form-group"},Fr={class:"form-group"},jr={class:"model-input-row"},Qr=["disabled"],Hr={key:0,class:"model-select-container"},Gr=["value"],Jr=["value"],Zr={class:"model-count"},Wr={key:0,class:"form-group"},Xr={class:"form-row"},Yr={class:"form-group"},eu={class:"form-group"},tu={class:"form-group"},su={class:"checkbox-label"},nu={class:"form-group"},lu={class:"checkbox-label"},au={class:"form-group"},ou=["disabled"],iu=ne({__name:"VlmSettingsTab",emits:["showMessage"],setup(o,{expose:t,emit:l}){const n=l,s=oe(),r=k(!1),u=k(!1),g=k([]),d=k(!1),p=k(s.config.vlm.provider),f=k(s.config.vlm.apiKey),C=k(s.config.vlm.model),T=k(s.config.vlm.baseUrl),I=k(s.config.vlm.rpmLimit),A=k(s.config.vlm.temperature),z=k(s.config.vlm.forceJson),U=k(s.config.vlm.useStream),K=k(s.config.vlm.imageMaxSize),O=E(()=>p.value==="custom");function R(){const x=p.value;if(s.config.vlm.provider!==x&&(s.config.vlm.apiKey=f.value,s.config.vlm.model=C.value,s.config.vlm.baseUrl=T.value,s.config.vlm.rpmLimit=I.value,s.config.vlm.temperature=A.value,s.config.vlm.forceJson=z.value,s.config.vlm.useStream=U.value,s.config.vlm.imageMaxSize=K.value),s.setVlmProvider(x),f.value=s.config.vlm.apiKey,C.value=s.config.vlm.model,T.value=s.config.vlm.baseUrl,I.value=s.config.vlm.rpmLimit,A.value=s.config.vlm.temperature,z.value=s.config.vlm.forceJson,U.value=s.config.vlm.useStream,K.value=s.config.vlm.imageMaxSize,!C.value){const B=Er[x];B&&(C.value=B)}}async function P(){if(!f.value){n("showMessage","è¯·å…ˆå¡«å†™ API Key","error");return}if(!Fe.includes(p.value)){n("showMessage",`${p.value} ä¸æ”¯æŒè‡ªåŠ¨èŽ·å–æ¨¡åž‹åˆ—è¡¨`,"error");return}if(p.value==="custom"&&!T.value){n("showMessage","è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL","error");return}const x=p.value==="custom"?"custom_openai":p.value;u.value=!0;try{const y=await Oe(x,f.value,T.value||void 0);y.success&&y.models&&y.models.length>0?(g.value=y.models,d.value=!0,n("showMessage",`èŽ·å–åˆ° ${y.models.length} ä¸ªæ¨¡åž‹`,"success")):(n("showMessage",y.message||"æœªèŽ·å–åˆ°æ¨¡åž‹åˆ—è¡¨","error"),d.value=!1)}catch(y){n("showMessage","èŽ·å–æ¨¡åž‹åˆ—è¡¨å¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error"),d.value=!1}finally{u.value=!1}}function i(x){x&&(C.value=x)}async function a(){if(!r.value){r.value=!0;try{const x=await Ws({provider:p.value,api_key:f.value,model:C.value,base_url:T.value||void 0});x.success?n("showMessage","VLM è¿žæŽ¥æˆåŠŸ","success"):n("showMessage","è¿žæŽ¥å¤±è´¥: "+(x.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(x){n("showMessage","æµ‹è¯•å¤±è´¥: "+(x instanceof Error?x.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{r.value=!1}}}function c(){return{provider:p.value,apiKey:f.value,model:C.value,baseUrl:p.value==="custom"?T.value:"",rpmLimit:I.value,temperature:A.value,forceJson:z.value,useStream:U.value,imageMaxSize:K.value}}function _(){p.value=s.config.vlm.provider,f.value=s.config.vlm.apiKey,C.value=s.config.vlm.model,T.value=s.config.vlm.baseUrl,I.value=s.config.vlm.rpmLimit,A.value=s.config.vlm.temperature,z.value=s.config.vlm.forceJson,U.value=s.config.vlm.useStream,K.value=s.config.vlm.imageMaxSize}return t({getConfig:c,syncFromStore:_}),(x,y)=>(v(),m("div",Or,[y[25]||(y[25]=e("p",{class:"settings-hint"},"VLMï¼ˆè§†è§‰è¯­è¨€æ¨¡åž‹ï¼‰ç”¨äºŽåˆ†æžæ¼«ç”»å›¾ç‰‡å†…å®¹ï¼Œæå–å¯¹è¯å’Œåœºæ™¯ä¿¡æ¯ã€‚",-1)),e("div",Dr,[y[10]||(y[10]=e("label",null,"æœåŠ¡å•†",-1)),Y(de,{modelValue:p.value,"onUpdate:modelValue":y[0]||(y[0]=B=>p.value=B),options:se(Et),onChange:R},null,8,["modelValue","options"])]),e("div",Nr,[y[11]||(y[11]=e("label",null,"API Key",-1)),q(e("input",{"onUpdate:modelValue":y[1]||(y[1]=B=>f.value=B),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[Q,f.value]])]),e("div",Fr,[y[13]||(y[13]=e("label",null,"æ¨¡åž‹",-1)),e("div",jr,[q(e("input",{"onUpdate:modelValue":y[2]||(y[2]=B=>C.value=B),type:"text",placeholder:"ä¾‹å¦‚: gemini-2.0-flash"},null,512),[[Q,C.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:u.value,onClick:P},$(u.value?"èŽ·å–ä¸­...":"ðŸ” èŽ·å–æ¨¡åž‹"),9,Qr)]),d.value&&g.value.length>0?(v(),m("div",Hr,[e("select",{class:"model-select",value:C.value,onChange:y[3]||(y[3]=B=>i(B.target.value))},[y[12]||(y[12]=e("option",{value:""},"-- é€‰æ‹©æ¨¡åž‹ --",-1)),(v(!0),m(N,null,W(g.value,B=>(v(),m("option",{key:B.id,value:B.id},$(B.name||B.id),9,Jr))),128))],40,Gr),e("span",Zr,"å…± "+$(g.value.length)+" ä¸ªæ¨¡åž‹",1)])):L("",!0)]),O.value?(v(),m("div",Wr,[y[14]||(y[14]=e("label",null,"Base URL",-1)),q(e("input",{"onUpdate:modelValue":y[4]||(y[4]=B=>T.value=B),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[Q,T.value]])])):L("",!0),e("div",Xr,[e("div",Yr,[y[15]||(y[15]=e("label",null,"RPM é™åˆ¶",-1)),q(e("input",{"onUpdate:modelValue":y[5]||(y[5]=B=>I.value=B),type:"number",min:"1",max:"100"},null,512),[[Q,I.value,void 0,{number:!0}]]),y[16]||(y[16]=e("p",{class:"form-hint"},"æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°",-1))]),e("div",eu,[y[17]||(y[17]=e("label",null,"æ¸©åº¦",-1)),q(e("input",{"onUpdate:modelValue":y[6]||(y[6]=B=>A.value=B),type:"number",min:"0",max:"1",step:"0.1"},null,512),[[Q,A.value,void 0,{number:!0}]]),y[18]||(y[18]=e("p",{class:"form-hint"},"0-1ï¼Œè¶Šä½Žè¶Šç¡®å®š",-1))])]),e("div",tu,[e("label",su,[q(e("input",{"onUpdate:modelValue":y[7]||(y[7]=B=>z.value=B),type:"checkbox"},null,512),[[Ce,z.value]]),y[19]||(y[19]=e("span",null,"å¼ºåˆ¶ JSON è¾“å‡º",-1))]),y[20]||(y[20]=e("p",{class:"form-hint"},"å¯¹ OpenAI å…¼å®¹ API å¯ç”¨ response_format: json_object",-1))]),e("div",nu,[e("label",lu,[q(e("input",{"onUpdate:modelValue":y[8]||(y[8]=B=>U.value=B),type:"checkbox"},null,512),[[Ce,U.value]]),y[21]||(y[21]=e("span",null,"ä½¿ç”¨æµå¼è¯·æ±‚",-1))]),y[22]||(y[22]=e("p",{class:"form-hint"},"æµå¼è¯·æ±‚å¯é¿å…é•¿æ—¶é—´ç­‰å¾…å¯¼è‡´çš„è¶…æ—¶é—®é¢˜",-1))]),e("div",au,[y[23]||(y[23]=e("label",null,"å›¾ç‰‡åŽ‹ç¼©ï¼ˆæœ€å¤§è¾¹é•¿ï¼‰",-1)),q(e("input",{"onUpdate:modelValue":y[9]||(y[9]=B=>K.value=B),type:"number",min:"0",max:"4096",step:"128",placeholder:"0 è¡¨ç¤ºä¸åŽ‹ç¼©"},null,512),[[Q,K.value,void 0,{number:!0}]]),y[24]||(y[24]=e("p",{class:"form-hint"},"å‘é€å‰å°†å›¾ç‰‡ç­‰æ¯”ä¾‹ç¼©æ”¾åˆ°æŒ‡å®šæœ€å¤§è¾¹é•¿ï¼ˆåƒç´ ï¼‰ï¼Œ0 è¡¨ç¤ºä¸åŽ‹ç¼©",-1))]),e("button",{class:"btn btn-secondary",disabled:r.value,onClick:a},$(r.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿žæŽ¥"),9,ou)]))}}),ru={class:"insight-settings-content"},uu={class:"form-group"},cu={class:"form-group"},du={class:"form-group"},pu={class:"model-input-row"},vu=["disabled"],gu={key:0,class:"model-select-container"},mu=["value"],hu=["value"],fu={class:"model-count"},bu={key:0,class:"form-group"},ku={class:"form-group"},yu={class:"checkbox-label"},_u=["disabled"],$u=ne({__name:"LlmSettingsTab",emits:["showMessage"],setup(o,{expose:t,emit:l}){const n=l,s=oe(),r=k(!1),u=k(!1),g=k([]),d=k(!1),p=k(s.config.llm.provider),f=k(s.config.llm.apiKey),C=k(s.config.llm.model),T=k(s.config.llm.baseUrl),I=k(s.config.llm.useStream),A=E(()=>p.value==="custom");function z(){const i=p.value;if(s.config.llm.provider!==i&&(s.config.llm.apiKey=f.value,s.config.llm.model=C.value,s.config.llm.baseUrl=T.value,s.config.llm.useStream=I.value),s.setLlmProvider(i),f.value=s.config.llm.apiKey,C.value=s.config.llm.model,T.value=s.config.llm.baseUrl,I.value=s.config.llm.useStream,!C.value){const c=Kr[i];c&&(C.value=c)}}async function U(){if(!f.value){n("showMessage","è¯·å…ˆå¡«å†™ API Key","error");return}if(!Fe.includes(p.value)){n("showMessage",`${p.value} ä¸æ”¯æŒè‡ªåŠ¨èŽ·å–æ¨¡åž‹åˆ—è¡¨`,"error");return}if(p.value==="custom"&&!T.value){n("showMessage","è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL","error");return}const i=p.value==="custom"?"custom_openai":p.value;u.value=!0;try{const a=await Oe(i,f.value,T.value||void 0);a.success&&a.models&&a.models.length>0?(g.value=a.models,d.value=!0,n("showMessage",`èŽ·å–åˆ° ${a.models.length} ä¸ªæ¨¡åž‹`,"success")):(n("showMessage",a.message||"æœªèŽ·å–åˆ°æ¨¡åž‹åˆ—è¡¨","error"),d.value=!1)}catch{n("showMessage","èŽ·å–æ¨¡åž‹åˆ—è¡¨å¤±è´¥","error"),d.value=!1}finally{u.value=!1}}function K(i){i&&(C.value=i)}async function O(){if(!r.value){r.value=!0;try{const i=await en({provider:p.value,api_key:f.value,model:C.value,base_url:T.value||void 0});i.success?n("showMessage","LLM è¿žæŽ¥æˆåŠŸ","success"):n("showMessage","è¿žæŽ¥å¤±è´¥: "+(i.error||"æœªçŸ¥é”™è¯¯"),"error")}catch{n("showMessage","æµ‹è¯•å¤±è´¥","error")}finally{r.value=!1}}}function R(){return{useSameAsVlm:!1,provider:p.value,apiKey:f.value,model:C.value,baseUrl:p.value==="custom"?T.value:"",useStream:I.value}}function P(){p.value=s.config.llm.provider,f.value=s.config.llm.apiKey,C.value=s.config.llm.model,T.value=s.config.llm.baseUrl,I.value=s.config.llm.useStream}return t({getConfig:R,syncFromStore:P}),(i,a)=>(v(),m("div",ru,[a[12]||(a[12]=e("p",{class:"settings-hint"},"LLMï¼ˆå¯¹è¯æ¨¡åž‹ï¼‰ç”¨äºŽç”Ÿæˆæ•…äº‹æ¦‚è¦ã€æ™ºèƒ½é—®ç­”ç­‰æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ã€‚",-1)),e("div",uu,[a[6]||(a[6]=e("label",null,"æœåŠ¡å•†",-1)),Y(de,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=c=>p.value=c),options:se(Et),onChange:z},null,8,["modelValue","options"])]),e("div",cu,[a[7]||(a[7]=e("label",null,"API Key",-1)),q(e("input",{"onUpdate:modelValue":a[1]||(a[1]=c=>f.value=c),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[Q,f.value]])]),e("div",du,[a[9]||(a[9]=e("label",null,"æ¨¡åž‹",-1)),e("div",pu,[q(e("input",{"onUpdate:modelValue":a[2]||(a[2]=c=>C.value=c),type:"text",placeholder:"ä¾‹å¦‚: gpt-4o-mini"},null,512),[[Q,C.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:u.value,onClick:U},$(u.value?"èŽ·å–ä¸­...":"ðŸ” èŽ·å–æ¨¡åž‹"),9,vu)]),d.value&&g.value.length>0?(v(),m("div",gu,[e("select",{class:"model-select",value:C.value,onChange:a[3]||(a[3]=c=>K(c.target.value))},[a[8]||(a[8]=e("option",{value:""},"-- é€‰æ‹©æ¨¡åž‹ --",-1)),(v(!0),m(N,null,W(g.value,c=>(v(),m("option",{key:c.id,value:c.id},$(c.name||c.id),9,hu))),128))],40,mu),e("span",fu,"å…± "+$(g.value.length)+" ä¸ªæ¨¡åž‹",1)])):L("",!0)]),A.value?(v(),m("div",bu,[a[10]||(a[10]=e("label",null,"Base URL",-1)),q(e("input",{"onUpdate:modelValue":a[4]||(a[4]=c=>T.value=c),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[Q,T.value]])])):L("",!0),e("div",ku,[e("label",yu,[q(e("input",{"onUpdate:modelValue":a[5]||(a[5]=c=>I.value=c),type:"checkbox"},null,512),[[Ce,I.value]]),a[11]||(a[11]=e("span",null,"ä½¿ç”¨æµå¼è¯·æ±‚",-1))])]),e("button",{class:"btn btn-secondary",disabled:r.value,onClick:O},$(r.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿žæŽ¥"),9,_u)]))}}),wu={class:"insight-settings-content"},xu={class:"form-group"},Su={class:"form-hint"},Cu={class:"form-group"},Pu={class:"form-group"},Tu={class:"form-hint"},Iu={key:0,style:{"margin-top":"16px"}},Au={style:{"margin-bottom":"8px"}},Mu={style:{"min-width":"50px",color:"#666","font-size":"13px"}},Ru=["value","disabled","onChange"],Lu=["value","disabled","title","onChange"],Bu={style:{display:"flex","flex-direction":"column","align-items":"center",gap:"2px","font-size":"11px",cursor:"pointer","min-width":"40px","text-align":"center"}},zu=["checked","onChange"],Uu=["onClick"],Eu={class:"batch-info-box"},Ku={class:"layers-preview-list"},Vu={key:0,class:"align-badge"},qu={class:"batch-estimate-box"},Ou=ne({__name:"BatchSettingsTab",setup(o,{expose:t}){const l=oe(),n=k(l.config.batch.pagesPerBatch),s=k(l.config.batch.contextBatchCount),r=k(l.config.batch.architecturePreset),u=k(l.config.batch.customLayers?.length>0?l.config.batch.customLayers.map(i=>({name:i.name,units:i.units_per_group??i.units??5,align:i.align_to_chapter??i.align??!1})):[{name:"æ‰¹é‡åˆ†æž",units:5,align:!1},{name:"æ®µè½æ€»ç»“",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]),g=E(()=>`æ¯æ‰¹æ¬¡åˆ†æž ${n.value||5} é¡µ`),d=E(()=>r.value==="custom"),p=E(()=>r.value==="custom"?"å®Œå…¨è‡ªå®šä¹‰å±‚çº§æž¶æž„ï¼Œçµæ´»é…ç½®åˆ†æžæµç¨‹":Xe[r.value]?.description||"æ ¹æ®æ¼«ç”»ç±»åž‹é€‰æ‹©åˆé€‚çš„åˆ†æžæž¶æž„"),f=E(()=>r.value==="custom"?u.value:Xe[r.value]?.layers||Xe.standard.layers);function C(){const i=u.value.length-1;u.value.splice(i,0,{name:`æ±‡æ€»å±‚${i}`,units:5,align:!1})}function T(i){i>0&&i<u.value.length-1&&u.value.splice(i,1)}function I(i,a,c){u.value[i]&&(u.value[i][a]=c,i===0&&a==="units"&&(n.value=c))}function A(){u.value.length>0&&u.value[0]&&(u.value[0].units=n.value)}function z(i){return i>0&&i<u.value.length-1&&u.value.length>2}function U(i){return i>0&&i<u.value.length-1}function K(i){return i<u.value.length-1}function O(i){return i===0?"æ¯æ‰¹åˆ†æžçš„é¡µæ•°":"æ¯ç»„åŒ…å«å•å…ƒæ•°ï¼ˆ0=å…¨éƒ¨æ±‡æ€»ï¼‰"}function R(){return{pagesPerBatch:n.value,contextBatchCount:s.value,architecturePreset:r.value}}function P(){n.value=l.config.batch.pagesPerBatch,s.value=l.config.batch.contextBatchCount,r.value=l.config.batch.architecturePreset}return t({getConfig:R,syncFromStore:P}),(i,a)=>(v(),m("div",wu,[a[13]||(a[13]=e("p",{class:"settings-hint"},"é…ç½®æ‰¹é‡åˆ†æžçš„å‚æ•°ï¼Œå½±å“åˆ†æžé€Ÿåº¦å’Œè´¨é‡ã€‚",-1)),e("div",xu,[a[3]||(a[3]=e("label",null,"æ¯æ‰¹æ¬¡åˆ†æžé¡µæ•°",-1)),q(e("input",{"onUpdate:modelValue":a[0]||(a[0]=c=>n.value=c),type:"number",min:"1",max:"10",onChange:A},null,544),[[Q,n.value,void 0,{number:!0}]]),e("p",Su,"æ¯æ¬¡å‘é€ç»™ VLM çš„å›¾ç‰‡æ•°é‡ï¼Œå»ºè®® 3-5 å¼ ã€‚"+$(g.value),1)]),e("div",Cu,[a[4]||(a[4]=e("label",null,"ä¸Šæ–‡å‚è€ƒæ‰¹æ¬¡æ•°",-1)),q(e("input",{"onUpdate:modelValue":a[1]||(a[1]=c=>s.value=c),type:"number",min:"0",max:"5"},null,512),[[Q,s.value,void 0,{number:!0}]]),a[5]||(a[5]=e("p",{class:"form-hint"},"æ¯æ‰¹åˆ†æžæ—¶å‚è€ƒå‰å‡ æ‰¹çš„ç»“æžœä½œä¸ºä¸Šä¸‹æ–‡ï¼Œ0 è¡¨ç¤ºä¸å‚è€ƒ",-1))]),e("div",Pu,[a[6]||(a[6]=e("label",null,"åˆ†æžæž¶æž„",-1)),Y(de,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=c=>r.value=c),options:se(zr)},null,8,["modelValue","options"]),e("p",Tu,$(p.value),1)]),d.value?(v(),m("div",Iu,[a[8]||(a[8]=e("label",{style:{display:"block","margin-bottom":"8px","font-weight":"500","font-size":"14px"}},"è‡ªå®šä¹‰å±‚çº§",-1)),e("div",Au,[(v(!0),m(N,null,W(u.value,(c,_)=>(v(),m("div",{key:_,style:{display:"flex","flex-direction":"row",gap:"8px","align-items":"center","margin-bottom":"8px",padding:"12px",background:"#f5f5f5","border-radius":"8px",border:"1px solid #e0e0e0"}},[e("span",Mu,"ç¬¬"+$(_+1)+"å±‚",1),e("input",{type:"text",value:c.name,disabled:!U(_),placeholder:"å±‚çº§åç§°",style:{flex:"1",padding:"8px 12px",border:"1px solid #e0e0e0","border-radius":"6px","font-size":"14px"},onChange:x=>I(_,"name",x.target.value)},null,40,Ru),e("input",{type:"number",value:c.units,disabled:!K(_),title:O(_),min:"0",max:"20",style:{width:"70px",padding:"8px 12px",border:"1px solid #e0e0e0","border-radius":"6px","font-size":"14px"},onChange:x=>I(_,"units",parseInt(x.target.value)||0)},null,40,Lu),e("label",Bu,[e("input",{type:"checkbox",checked:c.align,style:{width:"16px",height:"16px"},onChange:x=>I(_,"align",x.target.checked)},null,40,zu),a[7]||(a[7]=e("span",{style:{"line-height":"1.2"}},[te("ç« èŠ‚"),e("br"),te("å¯¹é½")],-1))]),z(_)?(v(),m("button",{key:0,type:"button",style:{padding:"6px 12px",background:"#ef4444",color:"white",border:"none","border-radius":"6px",cursor:"pointer","font-size":"13px","font-weight":"500"},onClick:x=>T(_)},"åˆ é™¤",8,Uu)):L("",!0)]))),128))]),e("button",{type:"button",class:"btn btn-sm",style:{"margin-top":"4px",border:"1px solid #e0e0e0"},onClick:C},"+ æ·»åŠ å±‚çº§"),a[9]||(a[9]=e("p",{class:"form-hint"},"ç¬¬ä¸€å±‚å›ºå®šä¸ºæ‰¹é‡åˆ†æžï¼Œæœ€åŽä¸€å±‚å›ºå®šä¸ºå…¨ä¹¦æ€»ç»“ã€‚ä¸­é—´å¯æ·»åŠ ä»»æ„æ±‡æ€»å±‚çº§ã€‚",-1))])):L("",!0),e("div",Eu,[a[10]||(a[10]=e("h4",null,"å½“å‰æž¶æž„é¢„è§ˆ",-1)),e("ul",Ku,[(v(!0),m(N,null,W(f.value,(c,_)=>(v(),m("li",{key:_},[e("strong",null,"ç¬¬"+$(_+1)+"å±‚ - "+$(c.name),1),te(" "+$(c.units>0?` - æ¯${c.units}ä¸ªå•å…ƒæ±‡æ€»`:" - æ±‡æ€»å…¨éƒ¨")+" ",1),c.align?(v(),m("span",Vu,"(æŒ‰ç« èŠ‚å¯¹é½)")):L("",!0)]))),128))])]),e("div",qu,[e("p",null,[a[11]||(a[11]=te("å½“å‰é…ç½®ï¼šæ¯ ",-1)),e("strong",null,$(n.value),1),a[12]||(a[12]=te(" é¡µä¸€æ‰¹",-1))])])]))}}),Du={class:"insight-settings-content"},Nu={class:"form-group"},Fu={class:"form-group"},ju={class:"form-group"},Qu={class:"model-input-row"},Hu=["disabled"],Gu={key:0,class:"model-select-container"},Ju=["value"],Zu=["value"],Wu={class:"model-count"},Xu={key:0,class:"form-group"},Yu={class:"form-group"},ec=["disabled"],tc=ne({__name:"EmbeddingSettingsTab",emits:["showMessage"],setup(o,{expose:t,emit:l}){const n=l,s=oe(),r=k(!1),u=k(!1),g=k([]),d=k(!1),p=k(s.config.embedding.provider),f=k(s.config.embedding.apiKey),C=k(s.config.embedding.model),T=k(s.config.embedding.baseUrl),I=k(s.config.embedding.rpmLimit),A=E(()=>p.value==="custom");function z(){const i=p.value;if(s.config.embedding.provider!==i&&(s.config.embedding.apiKey=f.value,s.config.embedding.model=C.value,s.config.embedding.baseUrl=T.value,s.config.embedding.rpmLimit=I.value),s.setEmbeddingProvider(i),f.value=s.config.embedding.apiKey,C.value=s.config.embedding.model,T.value=s.config.embedding.baseUrl,I.value=s.config.embedding.rpmLimit,!C.value){const c=Vr[i];c&&(C.value=c)}}async function U(){if(!f.value){n("showMessage","è¯·å…ˆå¡«å†™ API Key","error");return}if(!Fe.includes(p.value)){n("showMessage",`${p.value} ä¸æ”¯æŒè‡ªåŠ¨èŽ·å–æ¨¡åž‹åˆ—è¡¨`,"error");return}if(p.value==="custom"&&!T.value){n("showMessage","è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL","error");return}const i=p.value==="custom"?"custom_openai":p.value;u.value=!0;try{const a=await Oe(i,f.value,T.value||void 0);a.success&&a.models?.length?(g.value=a.models,d.value=!0,n("showMessage",`èŽ·å–åˆ° ${a.models.length} ä¸ªæ¨¡åž‹`,"success")):(n("showMessage",a.message||"æœªèŽ·å–åˆ°æ¨¡åž‹åˆ—è¡¨","error"),d.value=!1)}catch{n("showMessage","èŽ·å–æ¨¡åž‹åˆ—è¡¨å¤±è´¥","error"),d.value=!1}finally{u.value=!1}}function K(i){i&&(C.value=i)}async function O(){if(!r.value){r.value=!0;try{const i=await Xs({provider:p.value,api_key:f.value,model:C.value,base_url:T.value||void 0});n("showMessage",i.success?"Embedding è¿žæŽ¥æˆåŠŸ":"è¿žæŽ¥å¤±è´¥: "+(i.error||"æœªçŸ¥é”™è¯¯"),i.success?"success":"error")}catch{n("showMessage","æµ‹è¯•å¤±è´¥","error")}finally{r.value=!1}}}function R(){return{provider:p.value,apiKey:f.value,model:C.value,baseUrl:p.value==="custom"?T.value:"",rpmLimit:I.value}}function P(){p.value=s.config.embedding.provider,f.value=s.config.embedding.apiKey,C.value=s.config.embedding.model,T.value=s.config.embedding.baseUrl,I.value=s.config.embedding.rpmLimit}return t({getConfig:R,syncFromStore:P}),(i,a)=>(v(),m("div",Du,[a[13]||(a[13]=e("p",{class:"settings-hint"},"Embeddingï¼ˆå‘é‡åŒ–æ¨¡åž‹ï¼‰ç”¨äºŽå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢å’Œé—®ç­”åŠŸèƒ½ã€‚",-1)),e("div",Nu,[a[6]||(a[6]=e("label",null,"æœåŠ¡å•†",-1)),Y(de,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=c=>p.value=c),options:se(Lr),onChange:z},null,8,["modelValue","options"])]),e("div",Fu,[a[7]||(a[7]=e("label",null,"API Key",-1)),q(e("input",{"onUpdate:modelValue":a[1]||(a[1]=c=>f.value=c),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[Q,f.value]])]),e("div",ju,[a[9]||(a[9]=e("label",null,"æ¨¡åž‹",-1)),e("div",Qu,[q(e("input",{"onUpdate:modelValue":a[2]||(a[2]=c=>C.value=c),type:"text",placeholder:"ä¾‹å¦‚: text-embedding-3-small"},null,512),[[Q,C.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:u.value,onClick:U},$(u.value?"èŽ·å–ä¸­...":"ðŸ” èŽ·å–æ¨¡åž‹"),9,Hu)]),d.value&&g.value.length>0?(v(),m("div",Gu,[e("select",{class:"model-select",value:C.value,onChange:a[3]||(a[3]=c=>K(c.target.value))},[a[8]||(a[8]=e("option",{value:""},"-- é€‰æ‹©æ¨¡åž‹ --",-1)),(v(!0),m(N,null,W(g.value,c=>(v(),m("option",{key:c.id,value:c.id},$(c.name||c.id),9,Zu))),128))],40,Ju),e("span",Wu,"å…± "+$(g.value.length)+" ä¸ªæ¨¡åž‹",1)])):L("",!0)]),A.value?(v(),m("div",Xu,[a[10]||(a[10]=e("label",null,"Base URL",-1)),q(e("input",{"onUpdate:modelValue":a[4]||(a[4]=c=>T.value=c),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[Q,T.value]])])):L("",!0),e("div",Yu,[a[11]||(a[11]=e("label",null,"RPM é™åˆ¶",-1)),q(e("input",{"onUpdate:modelValue":a[5]||(a[5]=c=>I.value=c),type:"number",min:"0",max:"1000"},null,512),[[Q,I.value,void 0,{number:!0}]]),a[12]||(a[12]=e("p",{class:"form-hint"},"æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°ï¼Œ0 è¡¨ç¤ºä¸é™åˆ¶",-1))]),e("button",{class:"btn btn-secondary",disabled:r.value,onClick:O},$(r.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿žæŽ¥"),9,ec)]))}}),sc={class:"insight-settings-content"},nc={class:"form-group"},lc={class:"form-group"},ac={class:"form-group"},oc={class:"model-input-row"},ic=["disabled"],rc={key:0,class:"model-select-container"},uc=["value"],cc=["value"],dc={class:"model-count"},pc={key:0,class:"form-group"},vc={class:"form-group"},gc=["disabled"],mc=ne({__name:"RerankerSettingsTab",emits:["showMessage"],setup(o,{expose:t,emit:l}){const n=l,s=oe(),r=k(!1),u=k(!1),g=k([]),d=k(!1),p=k(s.config.reranker.provider),f=k(s.config.reranker.apiKey),C=k(s.config.reranker.model),T=k(s.config.reranker.baseUrl),I=k(s.config.reranker.topK),A=E(()=>p.value==="custom");function z(){const i=p.value;if(s.config.reranker.provider!==i&&(s.config.reranker.apiKey=f.value,s.config.reranker.model=C.value,s.config.reranker.baseUrl=T.value,s.config.reranker.topK=I.value),s.setRerankerProvider(i),f.value=s.config.reranker.apiKey,C.value=s.config.reranker.model,T.value=s.config.reranker.baseUrl,I.value=s.config.reranker.topK,!C.value){const c=qr[i];c&&(C.value=c)}}async function U(){if(!f.value){n("showMessage","è¯·å…ˆå¡«å†™ API Key","error");return}if(!Fe.includes(p.value)){n("showMessage",`${p.value} ä¸æ”¯æŒè‡ªåŠ¨èŽ·å–æ¨¡åž‹åˆ—è¡¨`,"error");return}if(p.value==="custom"&&!T.value){n("showMessage","è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL","error");return}const i=p.value==="custom"?"custom_openai":p.value;u.value=!0;try{const a=await Oe(i,f.value,T.value||void 0);a.success&&a.models?.length?(g.value=a.models,d.value=!0,n("showMessage",`èŽ·å–åˆ° ${a.models.length} ä¸ªæ¨¡åž‹`,"success")):(n("showMessage",a.message||"æœªèŽ·å–åˆ°æ¨¡åž‹åˆ—è¡¨","error"),d.value=!1)}catch{n("showMessage","èŽ·å–æ¨¡åž‹åˆ—è¡¨å¤±è´¥","error"),d.value=!1}finally{u.value=!1}}function K(i){i&&(C.value=i)}async function O(){if(!r.value){r.value=!0;try{const i=await Ys({provider:p.value,api_key:f.value,model:C.value,base_url:T.value||void 0});n("showMessage",i.success?"Reranker è¿žæŽ¥æˆåŠŸ":"è¿žæŽ¥å¤±è´¥: "+(i.error||"æœªçŸ¥é”™è¯¯"),i.success?"success":"error")}catch{n("showMessage","æµ‹è¯•å¤±è´¥","error")}finally{r.value=!1}}}function R(){return{provider:p.value,apiKey:f.value,model:C.value,baseUrl:p.value==="custom"?T.value:"",topK:I.value}}function P(){p.value=s.config.reranker.provider,f.value=s.config.reranker.apiKey,C.value=s.config.reranker.model,T.value=s.config.reranker.baseUrl,I.value=s.config.reranker.topK}return t({getConfig:R,syncFromStore:P}),(i,a)=>(v(),m("div",sc,[a[13]||(a[13]=e("p",{class:"settings-hint"},"Rerankerï¼ˆé‡æŽ’åºæ¨¡åž‹ï¼‰ç”¨äºŽå¯¹æœç´¢ç»“æžœè¿›è¡Œé‡æ–°æŽ’åºï¼Œæé«˜é—®ç­”å‡†ç¡®æ€§ã€‚",-1)),e("div",nc,[a[6]||(a[6]=e("label",null,"æœåŠ¡å•†",-1)),Y(de,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=c=>p.value=c),options:se(Br),onChange:z},null,8,["modelValue","options"])]),e("div",lc,[a[7]||(a[7]=e("label",null,"API Key",-1)),q(e("input",{"onUpdate:modelValue":a[1]||(a[1]=c=>f.value=c),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[Q,f.value]])]),e("div",ac,[a[9]||(a[9]=e("label",null,"æ¨¡åž‹",-1)),e("div",oc,[q(e("input",{"onUpdate:modelValue":a[2]||(a[2]=c=>C.value=c),type:"text",placeholder:"ä¾‹å¦‚: jina-reranker-v2-base-multilingual"},null,512),[[Q,C.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:u.value,onClick:U},$(u.value?"èŽ·å–ä¸­...":"ðŸ” èŽ·å–æ¨¡åž‹"),9,ic)]),d.value&&g.value.length>0?(v(),m("div",rc,[e("select",{class:"model-select",value:C.value,onChange:a[3]||(a[3]=c=>K(c.target.value))},[a[8]||(a[8]=e("option",{value:""},"-- é€‰æ‹©æ¨¡åž‹ --",-1)),(v(!0),m(N,null,W(g.value,c=>(v(),m("option",{key:c.id,value:c.id},$(c.name||c.id),9,cc))),128))],40,uc),e("span",dc,"å…± "+$(g.value.length)+" ä¸ªæ¨¡åž‹",1)])):L("",!0)]),A.value?(v(),m("div",pc,[a[10]||(a[10]=e("label",null,"Base URL",-1)),q(e("input",{"onUpdate:modelValue":a[4]||(a[4]=c=>T.value=c),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[Q,T.value]])])):L("",!0),e("div",vc,[a[11]||(a[11]=e("label",null,"Top K",-1)),q(e("input",{"onUpdate:modelValue":a[5]||(a[5]=c=>I.value=c),type:"number",min:"1",max:"20"},null,512),[[Q,I.value,void 0,{number:!0}]]),a[12]||(a[12]=e("p",{class:"form-hint"},"é‡æŽ’åºåŽè¿”å›žçš„ç»“æžœæ•°é‡",-1))]),e("button",{class:"btn btn-secondary",disabled:r.value,onClick:O},$(r.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿žæŽ¥"),9,gc)]))}}),hc={class:"insight-settings-content prompts-settings"},fc={class:"form-group"},bc={class:"form-hint"},kc={class:"form-group"},yc={class:"prompts-library-section"},_c={class:"library-header"},$c={class:"library-actions"},wc={class:"saved-prompts-list"},xc={key:0,class:"loading-text"},Sc={key:1,class:"placeholder-text"},Cc=["onClick"],Pc={class:"prompt-name"},Tc={class:"prompt-type-badge"},Ic=["onClick"],Ac=ne({__name:"PromptsSettingsTab",emits:["showMessage"],setup(o,{expose:t,emit:l}){const n=l,s=oe(),r=k("batch_analysis"),u=k(""),g=k({}),d=k([]),p=k(!1),f=k({batch_analysis:"",segment_summary:"",chapter_summary:"",qa_response:""});async function C(){try{const _=await tn();_.success&&_.prompts&&(f.value=_.prompts)}catch(_){console.error("åŠ è½½é»˜è®¤æç¤ºè¯å¤±è´¥:",_)}}async function T(){p.value=!0;try{const _=await sn();_.success&&_.library&&(d.value=_.library)}catch{d.value=[]}finally{p.value=!1}}function I(){confirm("ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯å—ï¼Ÿå½“å‰ç¼–è¾‘çš„å†…å®¹å°†ä¸¢å¤±ã€‚")&&(u.value=f.value[r.value]||"",delete g.value[r.value],n("showMessage","å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯","success"))}async function A(){try{await navigator.clipboard.writeText(u.value),n("showMessage","å·²å¤åˆ¶åˆ°å‰ªè´´æ¿","success")}catch{n("showMessage","å¤åˆ¶å¤±è´¥","error")}}async function z(){const _=u.value.trim();if(!_){n("showMessage","æç¤ºè¯å†…å®¹ä¸èƒ½ä¸ºç©º","error");return}const x=prompt("è¯·è¾“å…¥æç¤ºè¯åç§°ï¼š");if(!x?.trim())return;const y={id:Date.now().toString(),name:x.trim(),type:r.value,content:_,created_at:new Date().toISOString()};try{(await nn(y)).success?(d.value.push(y),n("showMessage","æç¤ºè¯å·²ä¿å­˜åˆ°åº“","success")):n("showMessage","ä¿å­˜å¤±è´¥","error")}catch{n("showMessage","ä¿å­˜å¤±è´¥","error")}}function U(_){r.value=_.type,u.value=_.content,g.value[_.type]=_.content,n("showMessage",`å·²åŠ è½½æç¤ºè¯: ${_.name}`,"success")}async function K(_){if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæç¤ºè¯å—ï¼Ÿ"))try{(await ln(_)).success?(d.value=d.value.filter(y=>y.id!==_),n("showMessage","æç¤ºè¯å·²åˆ é™¤","success")):n("showMessage","åˆ é™¤å¤±è´¥","error")}catch{n("showMessage","åˆ é™¤å¤±è´¥","error")}}function O(){u.value&&(g.value[r.value]=u.value);const _={version:"1.0",exported_at:new Date().toISOString(),prompts:g.value,library:d.value},x=new Blob([JSON.stringify(_,null,2)],{type:"application/json"}),y=URL.createObjectURL(x),B=document.createElement("a");B.href=y,B.download=`manga-insight-prompts-${new Date().toISOString().slice(0,10)}.json`,B.click(),URL.revokeObjectURL(y),n("showMessage","æç¤ºè¯å·²å¯¼å‡º","success")}function R(){document.getElementById("promptsFileInput")?.click()}async function P(_){const x=_.target,y=x.files?.[0];if(y){try{const B=await y.text(),G=JSON.parse(B);if(G.prompts&&(g.value={...g.value,...G.prompts}),G.library&&Array.isArray(G.library)){const V=new Set(d.value.map(w=>w.id));for(const w of G.library)V.has(w.id)||d.value.push(w);await an(d.value)}n("showMessage","æç¤ºè¯å¯¼å…¥æˆåŠŸ","success")}catch{n("showMessage","å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼","error")}x.value=""}}ke(r,(_,x)=>{x&&u.value&&(g.value[x]=u.value),_&&(u.value=g.value[_]||f.value[_]||"")});function i(){return u.value&&(g.value[r.value]=u.value),g.value}function a(){s.config.prompts?g.value={...s.config.prompts}:g.value={},u.value=g.value[r.value]||f.value[r.value]||""}async function c(){await C(),await T()}return we(c),t({getCustomPrompts:i,syncFromStore:a,initialize:c}),(_,x)=>(v(),m("div",hc,[x[5]||(x[5]=e("p",{class:"settings-hint"},"è‡ªå®šä¹‰åˆ†æžè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æç¤ºè¯æ¨¡æ¿ã€‚",-1)),e("div",fc,[x[2]||(x[2]=e("label",null,"æç¤ºè¯ç±»åž‹",-1)),Y(de,{modelValue:r.value,"onUpdate:modelValue":x[0]||(x[0]=y=>r.value=y),options:se(Ur)},null,8,["modelValue","options"]),e("p",bc,$(gt[r.value]?.hint),1)]),e("div",kc,[x[3]||(x[3]=e("label",null,"æç¤ºè¯å†…å®¹",-1)),q(e("textarea",{"onUpdate:modelValue":x[1]||(x[1]=y=>u.value=y),class:"prompt-editor",rows:"12",placeholder:"è¾“å…¥æç¤ºè¯å†…å®¹..."},null,512),[[Q,u.value]])]),e("div",{class:"prompt-actions-bar"},[e("button",{class:"btn btn-secondary btn-sm",onClick:I,title:"é‡ç½®ä¸ºé»˜è®¤"},"ðŸ”„ é‡ç½®"),e("button",{class:"btn btn-secondary btn-sm",onClick:A,title:"å¤åˆ¶åˆ°å‰ªè´´æ¿"},"ðŸ“‹ å¤åˆ¶"),e("button",{class:"btn btn-primary btn-sm",onClick:z,title:"ä¿å­˜åˆ°åº“"},"ðŸ’¾ ä¿å­˜åˆ°åº“")]),x[6]||(x[6]=e("hr",{class:"section-divider"},null,-1)),e("div",yc,[e("div",_c,[x[4]||(x[4]=e("h4",null,"ðŸ“š æç¤ºè¯åº“",-1)),e("div",$c,[e("button",{class:"btn btn-secondary btn-sm",onClick:O,title:"å¯¼å‡ºæ‰€æœ‰æç¤ºè¯"},"ðŸ“¤ å¯¼å‡º"),e("button",{class:"btn btn-secondary btn-sm",onClick:R,title:"å¯¼å…¥æç¤ºè¯"},"ðŸ“¥ å¯¼å…¥"),e("input",{id:"promptsFileInput",type:"file",accept:".json",style:{display:"none"},onChange:P},null,32)])]),e("div",wc,[p.value?(v(),m("div",xc,"åŠ è½½ä¸­...")):d.value.length===0?(v(),m("div",Sc,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(v(!0),m(N,{key:2},W(d.value,y=>(v(),m("div",{key:y.id,class:"saved-prompt-item",onClick:B=>U(y)},[e("span",Pc,$(y.name),1),e("span",Tc,$(gt[y.type]?.label||y.type),1),e("button",{class:"btn-icon-sm",onClick:ce(B=>K(y.id),["stop"]),title:"åˆ é™¤"},"ðŸ—‘ï¸",8,Ic)],8,Cc))),128))])])]))}}),Mc={class:"settings-tabs"},Rc=["disabled"],Lc=ne({__name:"InsightSettingsModal",emits:["close"],setup(o,{emit:t}){const l=t,n=oe(),s=k("vlm"),r=k(!1),u=k(""),g=k(""),d=k(null),p=k(null),f=k(null),C=k(null),T=k(null),I=k(null);function A(P){s.value=P,u.value="",g.value=""}function z(){l("close")}function U(P,i){u.value=P,g.value=i,setTimeout(()=>{u.value="",g.value=""},3e3)}async function K(){if(!r.value){r.value=!0;try{d.value&&n.updateVlmConfig(d.value.getConfig()),p.value&&n.updateLlmConfig(p.value.getConfig()),f.value&&n.updateBatchConfig(f.value.getConfig()),C.value&&n.updateEmbeddingConfig(C.value.getConfig()),T.value&&n.updateRerankerConfig(T.value.getConfig()),I.value&&n.updatePrompts(I.value.getCustomPrompts());const P=n.getConfigForApi(),i=await Zs(P);i.success?(U("è®¾ç½®å·²ä¿å­˜","success"),setTimeout(()=>{z()},500)):U("ä¿å­˜å¤±è´¥: "+(i.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(P){U("ä¿å­˜å¤±è´¥: "+(P instanceof Error?P.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{r.value=!1}}}async function O(){try{n.loadConfigFromStorage();const P=await Js();P.success&&P.config&&n.setConfigFromApi(P.config),R()}catch(P){console.error("åŠ è½½é…ç½®å¤±è´¥:",P),R()}}function R(){d.value?.syncFromStore(),p.value?.syncFromStore(),f.value?.syncFromStore(),C.value?.syncFromStore(),T.value?.syncFromStore(),I.value?.syncFromStore()}return we(async()=>{await O()}),(P,i)=>(v(),Se(Ls,{title:"æ¼«ç”»åˆ†æžè®¾ç½®",size:"large","custom-class":"insight-settings-modal",onClose:z},{footer:Ee(()=>[e("button",{class:"btn btn-secondary",onClick:z},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:r.value,onClick:K},$(r.value?"ä¿å­˜ä¸­...":"ä¿å­˜"),9,Rc)]),default:Ee(()=>[e("div",Mc,[e("button",{class:D(["settings-tab",{active:s.value==="vlm"}]),onClick:i[0]||(i[0]=a=>A("vlm"))}," ðŸ–¼ï¸ VLM å¤šæ¨¡æ€ ",2),e("button",{class:D(["settings-tab",{active:s.value==="llm"}]),onClick:i[1]||(i[1]=a=>A("llm"))}," ðŸ’¬ LLM å¯¹è¯ ",2),e("button",{class:D(["settings-tab",{active:s.value==="batch"}]),onClick:i[2]||(i[2]=a=>A("batch"))}," ðŸ“Š æ‰¹é‡åˆ†æž ",2),e("button",{class:D(["settings-tab",{active:s.value==="embedding"}]),onClick:i[3]||(i[3]=a=>A("embedding"))}," ðŸ”¢ å‘é‡æ¨¡åž‹ ",2),e("button",{class:D(["settings-tab",{active:s.value==="reranker"}]),onClick:i[4]||(i[4]=a=>A("reranker"))}," ðŸ”„ é‡æŽ’åº ",2),e("button",{class:D(["settings-tab",{active:s.value==="prompts"}]),onClick:i[5]||(i[5]=a=>A("prompts"))}," ðŸ“ æç¤ºè¯ ",2)]),u.value?(v(),m("div",{key:0,class:D(["test-message",g.value])},$(u.value),3)):L("",!0),q(Y(iu,{ref_key:"vlmTabRef",ref:d,onShowMessage:U},null,512),[[be,s.value==="vlm"]]),q(Y($u,{ref_key:"llmTabRef",ref:p,onShowMessage:U},null,512),[[be,s.value==="llm"]]),q(Y(Ou,{ref_key:"batchTabRef",ref:f},null,512),[[be,s.value==="batch"]]),q(Y(tc,{ref_key:"embeddingTabRef",ref:C,onShowMessage:U},null,512),[[be,s.value==="embedding"]]),q(Y(mc,{ref_key:"rerankerTabRef",ref:T,onShowMessage:U},null,512),[[be,s.value==="reranker"]]),q(Y(Ac,{ref_key:"promptsTabRef",ref:I,onShowMessage:U},null,512),[[be,s.value==="prompts"]])]),_:1}))}}),Bc={class:"modal chapter-select-modal show"},zc={class:"modal-content"},Uc={class:"modal-body"},Ec={class:"chapters-list"},Kc=["onClick"],Vc={class:"chapter-info"},qc={class:"chapter-title"},Oc={key:0,class:"chapter-pages"},Dc={key:0,class:"check-icon"},Nc={class:"modal-footer"},Fc=["disabled"],jc=ne({__name:"ChapterSelectModal",props:{chapters:{}},emits:["close","select"],setup(o,{emit:t}){const l=t,n=k("");function s(g){n.value=g}function r(){n.value&&l("select",n.value)}function u(){l("close")}return(g,d)=>(v(),m("div",Bc,[e("div",{class:"modal-overlay",onClick:u}),e("div",zc,[e("div",{class:"modal-header"},[d[0]||(d[0]=e("h2",null,"ðŸ“– é€‰æ‹©ç« èŠ‚",-1)),e("button",{class:"modal-close",onClick:u},"Ã—")]),e("div",Uc,[d[1]||(d[1]=e("p",{class:"hint-text"},"è¯·é€‰æ‹©è¦ç¿»è¯‘çš„ç« èŠ‚ï¼š",-1)),e("div",Ec,[(v(!0),m(N,null,W(o.chapters,p=>(v(),m("div",{key:p.id,class:D(["chapter-item",{selected:n.value===p.id}]),onClick:f=>s(p.id)},[e("div",Vc,[e("span",qc,$(p.title),1),p.startPage&&p.endPage?(v(),m("span",Oc," ç¬¬ "+$(p.startPage)+"-"+$(p.endPage)+" é¡µ ",1)):L("",!0)]),n.value===p.id?(v(),m("span",Dc,"âœ“")):L("",!0)],10,Kc))),128))])]),e("div",Nc,[e("button",{class:"btn btn-secondary",onClick:u},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:!n.value,onClick:r}," ç¡®å®š ",8,Fc)])])]))}}),Qc=ge(jc,[["__scopeId","data-v-5f4c62c9"]]),Hc={class:"insight-page"},Gc={class:"app-header"},Jc={class:"header-content"},Zc={class:"logo-container"},Wc={class:"header-links"},Xc={class:"insight-main"},Yc={class:"sidebar-section book-info-section"},ed={class:"book-cover-wrapper"},td=["src"],sd={key:1,class:"book-cover-placeholder"},nd=["title"],ld={class:"book-meta"},ad={class:"meta-item"},od={id:"totalPages"},id={class:"meta-item"},rd={id:"analyzedPages"},ud={class:"insight-content"},cd={key:0,class:"select-book-prompt"},dd={key:1,class:"content-tabs"},pd={class:"tabs-wrapper"},vd={class:"tab-content"},gd={class:"tab-content"},md={class:"tab-content"},hd=ne({__name:"InsightView",setup(o){const t=Ps(),l=As(),n=oe(),s=$t(),r=k("overview"),u=k(!1),g=k(!1),d=k(!1);let p=null;const f=k(null),C=k(!1),T=E(()=>f.value?f.value:n.currentBookId?s.books.find(b=>b.id===n.currentBookId):null),I=E(()=>!!n.currentBookId),A=E(()=>T.value?.cover?T.value.cover:"");function z(b){r.value=b}async function U(b){if(b){n.setCurrentBook(b),n.setLoading(!0);try{const X=await(await fetch(`/api/bookshelf/books/${b}`)).json();if(!X.success)throw new Error(X.error||"èŽ·å–ä¹¦ç±ä¿¡æ¯å¤±è´¥");if(X.book&&(f.value={id:X.book.id,title:X.book.title,cover:X.book.cover,total_pages:X.book.total_pages||0},n.setBookTotalPages(X.book.total_pages||0),X.book.chapters&&X.book.chapters.length>0)){let le=0;const ye=X.book.chapters.map((_e,Be)=>{const je=_e.id||_e.chapter_id||`ch_${Be+1}`,Qe=_e.page_count||_e.pages?.length||0,He=le+1,ze=le+Qe;return le=ze,{id:je,title:_e.title||`ç¬¬ ${Be+1} ç« `,startPage:He,endPage:ze}});n.setChapters(ye)}if(await K(),n.chapters.length===0)try{const le=await Os(b);le.success&&le.chapters&&le.chapters.length>0&&n.setChapters(le.chapters.map(ye=>({id:ye.id,title:ye.title,startPage:ye.start_page,endPage:ye.end_page})))}catch(le){console.warn("èŽ·å–ç« èŠ‚åˆ—è¡¨å¤±è´¥:",le)}await n.loadNotesFromAPI(),l.replace({query:{book:b}}),n.isAnalyzing&&O()}catch(M){console.error("åŠ è½½ä¹¦ç±å¤±è´¥:",M),n.setError(M instanceof Error?M.message:"åŠ è½½ä¹¦ç±å¤±è´¥")}finally{n.setLoading(!1)}}}async function K(){if(n.currentBookId)try{const b=await wt(n.currentBookId);if(b.success)if(b.analyzed_pages_count!==void 0&&n.setAnalyzedPagesCount(b.analyzed_pages_count),b.current_task){const M=b.current_task.status;M==="running"?(n.setAnalysisStatus("running"),b.current_task.progress&&n.updateProgress(b.current_task.progress.analyzed_pages||0,b.current_task.progress.total_pages||0)):M==="paused"?n.setAnalysisStatus("paused"):M==="completed"?n.setAnalysisStatus("completed"):M==="failed"?n.setAnalysisStatus("failed"):n.setAnalysisStatus("idle")}else b.analyzed?n.setAnalysisStatus("completed"):n.setAnalysisStatus("idle")}catch(b){console.error("èŽ·å–åˆ†æžçŠ¶æ€å¤±è´¥:",b)}}function O(){R(),p=setInterval(async()=>{await K();const b=n.analysisStatus;(b==="completed"||b==="failed"||b==="idle")&&(R(),b==="completed"&&(console.log("åˆ†æžå®Œæˆï¼Œç­‰å¾…1ç§’åŽåˆ·æ–°æ•°æ®..."),setTimeout(async()=>{console.log("å¼€å§‹åˆ·æ–°æ¦‚è§ˆå’Œæ—¶é—´çº¿æ•°æ®"),await K(),n.triggerDataRefresh()},1e3)))},3e3)}function R(){p&&(clearInterval(p),p=null)}function P(){u.value=!0}function i(){Rs("ðŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}function a(){u.value=!1}function c(){g.value=!g.value,g.value&&(d.value=!1)}function _(){d.value=!d.value,d.value&&(g.value=!1)}function x(){if(!n.currentBookId){l.push("/translate");return}const b=n.chapters;!b||b.length===0?l.push({path:"/translate",query:{book:n.currentBookId}}):b.length===1?l.push({path:"/translate",query:{book:n.currentBookId,chapter:b[0].id}}):C.value=!0}function y(b){C.value=!1,l.push({path:"/translate",query:{book:n.currentBookId,chapter:b}})}function B(){C.value=!1}let G="",V="",w="";return we(async()=>{const b=document.body.style;G=b.padding,V=b.margin,w=b.overflow,b.padding="0",b.margin="0",b.overflow="hidden",await s.fetchBooks();const M=t.query.book;M&&await U(M)}),Ts(()=>{R();const b=document.body.style;b.padding=G,b.margin=V,b.overflow=w}),ke(()=>n.isAnalyzing,b=>{b?O():R()}),(b,M)=>{const X=Is("router-link");return v(),m("div",Hc,[e("header",Gc,[e("div",Jc,[e("div",Zc,[Y(X,{to:"/",title:"ä¹¦æž¶é¦–é¡µ"},{default:Ee(()=>[...M[3]||(M[3]=[e("img",{src:"/pic/logo.png",alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",Wc,[Y(X,{to:"/",class:"nav-link"},{default:Ee(()=>[...M[4]||(M[4]=[te("ðŸ“š ä¹¦æž¶",-1)])]),_:1}),e("a",{href:"javascript:void(0)",class:"nav-link",onClick:x},"ðŸŒ ç¿»è¯‘"),M[6]||(M[6]=e("span",{class:"nav-link active"},"ðŸ” åˆ†æž",-1)),M[7]||(M[7]=e("a",{href:"https://www.mashirosaber.top/use/manga-insight.html",target:"_blank",class:"nav-link",title:"ä½¿ç”¨æ•™ç¨‹"},"ðŸ“– æ•™ç¨‹",-1)),e("button",{id:"settingsBtn",class:"btn btn-icon",title:"è®¾ç½®",onClick:P},"âš™ï¸"),e("button",{id:"themeToggle",class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:i},[...M[5]||(M[5]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("main",Xc,[e("aside",{class:D(["insight-sidebar",{"mobile-visible":g.value}])},[e("div",Yc,[e("div",ed,[A.value?(v(),m("img",{key:0,src:A.value,alt:"å°é¢",class:"book-cover"},null,8,td)):(v(),m("div",sd,[...M[8]||(M[8]=[e("span",null,"ðŸ“–",-1)])]))]),e("h2",{class:"book-title",title:T.value?.title},$(T.value?.title||"é€‰æ‹©ä¹¦ç±"),9,nd),e("div",ld,[e("span",ad,[M[9]||(M[9]=e("span",{class:"meta-icon"},"ðŸ“„",-1)),e("span",od,$(T.value?.total_pages||0),1),M[10]||(M[10]=te(" é¡µ ",-1))]),e("span",id,[M[11]||(M[11]=e("span",{class:"meta-icon"},"ðŸ“Š",-1)),e("span",rd,$(se(n).analyzedPageCount),1),M[12]||(M[12]=te(" å·²åˆ†æž ",-1))])])]),I.value?(v(),Se(Bn,{key:0,onStartPolling:O,onStopPolling:R})):L("",!0),I.value?(v(),Se(Rr,{key:1})):L("",!0)],2),e("div",ud,[I.value?(v(),m("div",dd,[e("button",{class:"mobile-nav-btn",onClick:c,"aria-label":"æ‰“å¼€å¯¼èˆª"}," ðŸ“š "),e("div",pd,[e("button",{class:D(["tab-btn",{active:r.value==="overview"}]),onClick:M[0]||(M[0]=le=>z("overview"))},[...M[16]||(M[16]=[e("span",{class:"tab-icon"},"ðŸ“Š",-1),te(" æ¦‚è§ˆ ",-1)])],2),e("button",{class:D(["tab-btn",{active:r.value==="qa"}]),onClick:M[1]||(M[1]=le=>z("qa"))},[...M[17]||(M[17]=[e("span",{class:"tab-icon"},"ðŸ’¬",-1),te(" æ™ºèƒ½é—®ç­” ",-1)])],2),e("button",{class:D(["tab-btn",{active:r.value==="timeline"}]),onClick:M[2]||(M[2]=le=>z("timeline"))},[...M[18]||(M[18]=[e("span",{class:"tab-icon"},"ðŸ“ˆ",-1),te(" æ—¶é—´çº¿ ",-1)])],2)]),e("button",{class:"mobile-nav-btn",onClick:_,"aria-label":"æ‰“å¼€ç¬”è®°"}," ðŸ“ ")])):(v(),m("div",cd,[M[13]||(M[13]=e("div",{class:"prompt-icon"},"ðŸ“š",-1)),M[14]||(M[14]=e("h2",null,"é€‰æ‹©è¦åˆ†æžçš„ä¹¦ç±",-1)),M[15]||(M[15]=e("p",null,"ä»Žä¸‹æ–¹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€æœ¬ä¹¦ç±å¼€å§‹æ™ºèƒ½åˆ†æž",-1)),Y(un,{onSelect:U})])),q(e("div",vd,[Y(Ql)],512),[[be,r.value==="overview"&&I.value]]),q(e("div",gd,[Y(Vo)],512),[[be,r.value==="qa"&&I.value]]),q(e("div",md,[Y(Za)],512),[[be,r.value==="timeline"&&I.value]])]),I.value?(v(),m("aside",{key:0,class:D(["insight-workspace",{"mobile-visible":d.value}])},[Y(dr),Y(Ai)],2)):L("",!0)]),u.value?(v(),Se(Lc,{key:0,onClose:a})):L("",!0),C.value&&se(n).currentBookId?(v(),Se(Qc,{key:1,chapters:se(n).chapters,onSelect:y,onClose:B},null,8,["chapters"])):L("",!0)])}}}),Cd=ge(hd,[["__scopeId","data-v-28133ba3"]]);export{Cd as default};
