const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/system.XPcAFQMv.js","js/index.DB7Qpyya.js","js/vue-vendor.DIYfje1l.js","assets/index.BYanE9pL.css","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js","js/session.C_VZSWrV.js"])))=>i.map(i=>d[i]);
import{D as pn,b as po,c as mo,d as vo,e as mn,f as ht,a as lt,S as Wo,_ as He,g as ze,s as xe,u as rt,h as ds,i as gs,j as ps,k as Ko,l as qo,m as Ho,n as jo,B as Jo,o as Yo,p as ms,F as io,q as Xo,r as Go,t as vs,L as Zo,W as fs}from"./index.DB7Qpyya.js";import{d as Ht,r as C,c as j,a as je,e as L,h as de,f as e,t as ne,i as ot,k as E,g as it,n as Ie,u as pe,o as ut,v as ae,x as Ue,l as Ce,s as Qo,m as _t,K as et,D as q,F as Oe,j as Ye,M as fo,N as bs,L as vn,w as Se,B as dt,O as kt,z as $e,p as nt,P as co,b as Ft,Q as Ct,S as en,A as fn,U as hs,T as bn,C as ys}from"./vue-vendor.DIYfje1l.js";import{p as xs,a as _s,b as Cs,c as Ss,d as ks,e as ws,f as $s,h as Ts,i as Is,j as Ps,k as bo,l as hn}from"./system.XPcAFQMv.js";import{getFontList as yn,uploadFont as Rs,getTextboxPrompts as Ds,getPrompts as Ms,configApi as qe,getFontListApi as Es}from"./config.CwRcCkM9.js";import{_ as Ke}from"./CustomSelect.vue_vue_type_style_index_0_lang.BbTiIb--.js";import{apiClient as Xe}from"./client.Bht704G-.js";import{B as xn}from"./BaseModal.TJ09oGkk.js";import{getBookDetail as Bs}from"./bookshelf.B4ums9uK.js";import"./utils-vendor.B9ygI19o.js";function tn(){return{firecrawl:{apiKey:""},agent:{provider:"openai",apiKey:"",customBaseUrl:"",modelName:"gpt-4o-mini",useStream:!1,forceJsonOutput:!0,maxRetries:3,timeout:120},extraction:{prompt:pn,maxIterations:10},download:{concurrency:3,timeout:30,retries:3,delay:100,useReferer:!0},imagePreprocess:{enabled:!1,autoRotate:!0,compression:{enabled:!1,quality:85,maxWidth:0,maxHeight:0},formatConvert:{enabled:!1,targetFormat:"original"}},advanced:{customCookie:"",customHeaders:"",bypassProxy:!1},ui:{showAgentLogs:!0,autoImport:!1}}}function As(n,t){function s(y){n.value.firecrawl.apiKey=y,t()}function o(y){n.value.agent.provider=y,t()}function i(y){n.value.agent.apiKey=y,t()}function r(y){n.value.agent.customBaseUrl=y,t()}function a(y){n.value.agent.modelName=y,t()}function u(y){n.value.agent.useStream=y,t()}function p(y){n.value.agent.forceJsonOutput=y,t()}function k(y){n.value.agent.timeout=y,t()}function f(y){n.value.extraction.prompt=y,t()}function P(y){n.value.extraction.maxIterations=y,t()}function A(){n.value.extraction.prompt=pn,t()}function M(y){n.value.download.concurrency=y,t()}function B(y){n.value.download.timeout=y,t()}function $(y){n.value.download.retries=y,t()}function W(y){n.value.download.delay=y,t()}function O(y){n.value.download.useReferer=y,t()}function U(y){n.value.imagePreprocess.enabled=y,t()}function g(y){n.value.imagePreprocess.autoRotate=y,t()}function d(y){n.value.imagePreprocess.compression.enabled=y,t()}function x(y){n.value.imagePreprocess.compression.quality=y,t()}function _(y){n.value.imagePreprocess.compression.maxWidth=y,t()}function K(y){n.value.imagePreprocess.compression.maxHeight=y,t()}function V(y){n.value.imagePreprocess.formatConvert.enabled=y,t()}function se(y){n.value.imagePreprocess.formatConvert.targetFormat=y,t()}function X(y){n.value.advanced.customCookie=y,t()}function ie(y){n.value.advanced.customHeaders=y,t()}function z(y){n.value.advanced.bypassProxy=y,t()}function R(y){n.value.ui.showAgentLogs=y,t()}function T(y){n.value.ui.autoImport=y,t()}function F(y){n.value={...n.value,...y},t()}return{setFirecrawlApiKey:s,setAgentProvider:o,setAgentApiKey:i,setAgentBaseUrl:r,setAgentModelName:a,setAgentUseStream:u,setAgentForceJson:p,setAgentTimeout:k,setExtractionPrompt:f,setExtractionMaxIterations:P,resetExtractionPrompt:A,setDownloadConcurrency:M,setDownloadTimeout:B,setDownloadRetries:$,setDownloadDelay:W,setDownloadUseReferer:O,setImagePreprocessEnabled:U,setImageAutoRotate:g,setImageCompressionEnabled:d,setImageCompressionQuality:x,setImageMaxWidth:_,setImageMaxHeight:K,setImageFormatConvertEnabled:V,setImageTargetFormat:se,setCustomCookie:X,setCustomHeaders:ie,setBypassProxy:z,setShowAgentLogs:R,setAutoImport:T,updateWebImportSettings:F}}async function ho(n){return Xe.post("/api/re_render_image",n)}async function Ls(n){try{return{success:!0,data:await Xe.post("/api/translate_single_text",n)}}catch(t){return{success:!1,error:t instanceof Error?t.message:"ç¿»è¯‘å¤±è´¥"}}}async function Bt(n){return Xe.post("/api/hq_translate_batch",n)}async function go(n,t,s){return Xe.post("/api/detect_boxes",{image:n,detector_type:t,...s})}async function _n(n,t,s,o){return Xe.post("/api/ocr_single_bubble",{image_data:n,bubble_coords:t,ocr_engine:s,...o})}async function yo(n,t,s){return Xe.post("/api/inpaint_single_bubble",{image_data:n,bubble_coords:t,bubble_angle:s?.bubbleAngle??0,method:s?.method??"lama",lama_model:s?.lamaModel??"lama_mpe",...s?.maskData&&{mask_data:s.maskData}})}const Fs=Object.freeze(Object.defineProperty({__proto__:null,detectBoxes:go,hqTranslateBatch:Bt,inpaintSingleBubble:yo,ocrSingleBubble:_n,reRenderImage:ho,translateSingleText:Ls},Symbol.toStringTag,{value:"Module"}));async function Cn(n,t){return Xe.post(`/api/sessions/meta/${n}`,t)}async function Kt(n,t,s,o){return Xe.post(`/api/sessions/page/${n}/${t}/${s}`,{data:o})}async function Sn(n,t,s){return Xe.post(`/api/sessions/page/${n}/${t}/meta`,s)}async function kn(n,t,s){return Xe.post(`/api/sessions/save_translated/${n}/${t}`,s)}function qt(n){if(!n||typeof n!="string"||n.startsWith("/api/"))return null;if(n.startsWith("data:")){const t=n.split(",");return t.length>1?t[1]??null:null}return n}async function Us(n,t,s){const o=t.length;let i=0;for(let r=0;r<o;r++){const a=t[r];if(a){s?.onProgress?.(r+1,o);try{const u=qt(a.originalDataURL);u&&await Kt(n,r,"original",u);const p=qt(a.translatedDataURL);p&&await Kt(n,r,"translated",p);const k=qt(a.cleanImageData);k&&await Kt(n,r,"clean",k);const f={fileName:a.fileName,translationStatus:a.translationStatus,translationFailed:a.translationFailed,bubbleStates:a.bubbleStates,isManuallyAnnotated:a.isManuallyAnnotated,relativePath:a.relativePath,folderPath:a.folderPath,fontSize:a.fontSize,autoFontSize:a.autoFontSize,fontFamily:a.fontFamily,layoutDirection:a.layoutDirection,useAutoTextColor:a.useAutoTextColor,textColor:a.textColor,fillColor:a.fillColor,inpaintMethod:a.inpaintMethod,strokeEnabled:a.strokeEnabled,strokeColor:a.strokeColor,strokeWidth:a.strokeWidth};await Sn(n,r,f),i++}catch(u){console.error(`ä¿å­˜ç¬¬ ${r+1} é¡µå¤±è´¥:`,u)}}}return i}const wn=Object.freeze(Object.defineProperty({__proto__:null,extractBase64:qt,saveAllPagesSequentially:Us,savePageImage:Kt,savePageMeta:Sn,saveSessionMeta:Cn,saveTranslatedPage:kn},Symbol.toStringTag,{value:"Module"}));async function Os(){return Xe.get("/api/plugins")}async function zs(n){const t=encodeURIComponent(n);return Xe.post(`/api/plugins/${t}/enable`)}async function Ns(n){const t=encodeURIComponent(n);return Xe.post(`/api/plugins/${t}/disable`)}async function Vs(n){const t=encodeURIComponent(n);return Xe.delete(`/api/plugins/${t}`)}async function Ws(n){const t=encodeURIComponent(n);return Xe.get(`/api/plugins/${t}/config_schema`)}async function Ks(n){const t=encodeURIComponent(n);return Xe.get(`/api/plugins/${t}/config`)}async function qs(n,t){const s=encodeURIComponent(n);return Xe.post(`/api/plugins/${s}/config`,t)}async function Hs(){return Xe.get("/api/plugins/default_states")}async function js(n,t){const s=encodeURIComponent(n);return Xe.post(`/api/plugins/${s}/set_default_state`,{enabled:t})}async function Js(){return{states:(await Hs()).default_states}}const Ys=js,Xs=Ws,Gs=Ks,Zs=qs;function Qs(){return`img_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function on(n,t,s){return{id:Qs(),fileName:n,originalDataURL:t,translatedDataURL:null,cleanImageData:null,bubbleStates:null,translationStatus:"pending",translationFailed:!1,fontSize:25,autoFontSize:!1,fontFamily:ht,layoutDirection:"auto",textColor:"#000000",fillColor:mn,inpaintMethod:"solid",strokeEnabled:vo,strokeColor:mo,strokeWidth:po,hasUnsavedChanges:!1,...s}}const Ze=Ht("image",()=>{const n=C([]),t=C(-1),s=C(!1),o=j(()=>t.value>=0&&t.value<n.value.length?n.value[t.value]??null:null),i=j(()=>n.value.length),r=j(()=>n.value.length>0),a=j(()=>t.value>0),u=j(()=>t.value<n.value.length-1),p=j(()=>n.value.filter(y=>y.translationFailed).length),k=j(()=>n.value.filter(y=>y.translationStatus==="completed").length),f=j(()=>n.value.filter(y=>y.translationStatus==="pending").length);function P(y,m,l){const v=on(y,m,l);return n.value.push(v),n.value.length===1&&(t.value=0),console.log(`å›¾ç‰‡å·²æ·»åŠ : ${y}ï¼Œå½“å‰å…± ${n.value.length} å¼ å›¾ç‰‡`),v}function A(y){const m=y.map(({fileName:v,originalDataURL:D,overrides:S})=>on(v,D,S)),l=n.value.length===0;return n.value.push(...m),l&&n.value.length>0&&(t.value=0),console.log(`æ‰¹é‡æ·»åŠ äº† ${m.length} å¼ å›¾ç‰‡ï¼Œå½“å‰å…± ${n.value.length} å¼ `),m}function M(y){n.value=y.map(m=>({...m,strokeEnabled:m.strokeEnabled??vo,strokeColor:m.strokeColor||mo,strokeWidth:m.strokeWidth??po,hasUnsavedChanges:m.hasUnsavedChanges||!1})),n.value.length>0?t.value=Math.min(Math.max(0,t.value),n.value.length-1):t.value=-1,console.log(`å›¾ç‰‡æ•°ç»„å·²è®¾ç½®ï¼Œå…± ${n.value.length} å¼ å›¾ç‰‡`)}function B(y){return y<0||y>=n.value.length?(console.warn(`åˆ é™¤å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${y}`),!1):(n.value.splice(y,1),t.value===y?(t.value=Math.min(y,n.value.length-1),n.value.length===0&&(t.value=-1)):t.value>y&&t.value--,console.log(`å›¾ç‰‡å·²åˆ é™¤ï¼Œå½“å‰å…± ${n.value.length} å¼ å›¾ç‰‡`),!0)}function $(){return B(t.value)}function W(){n.value=[],t.value=-1,s.value=!1,console.log("æ‰€æœ‰å›¾ç‰‡å·²æ¸…é™¤")}function O(){const y=o.value?.id||null;if(n.value.sort((m,l)=>m.fileName.localeCompare(l.fileName,void 0,{numeric:!0,sensitivity:"base"})),y){const m=n.value.findIndex(l=>l.id===y);m>=0&&m!==t.value&&(console.log(`å›¾ç‰‡æ’åº: currentImageIndex ä» ${t.value} æ›´æ–°ä¸º ${m}`),t.value=m)}console.log("å›¾ç‰‡å·²æŒ‰æ–‡ä»¶åæ’åº")}function U(y){y>=-1&&y<n.value.length?(t.value=y,console.log(`å½“å‰å›¾ç‰‡ç´¢å¼•å·²è®¾ç½®ä¸º ${y}`)):console.warn(`è®¾ç½®ç´¢å¼•å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${y}`)}function g(){return a.value?(t.value--,!0):!1}function d(){return u.value?(t.value++,!0):!1}function x(y){o.value?(Object.assign(o.value,y),console.log("å½“å‰å›¾ç‰‡å±æ€§å·²æ›´æ–°:",Object.keys(y))):console.warn("æ›´æ–°å¤±è´¥: å½“å‰æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡")}function _(y,m){if(y>=0&&y<n.value.length){const l=n.value[y];l&&(Object.assign(l,m),console.log(`å›¾ç‰‡ ${y} å±æ€§å·²æ›´æ–°:`,Object.keys(m)))}else console.warn(`æ›´æ–°å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${y}`)}function K(y){o.value&&(o.value.bubbleStates=y,o.value.hasUnsavedChanges=!0,console.log(`å½“å‰å›¾ç‰‡æ°”æ³¡çŠ¶æ€å·²æ›´æ–°ï¼Œå…± ${y?.length??0} ä¸ªæ°”æ³¡`))}function V(y){o.value&&(o.value.isManuallyAnnotated=y,o.value.hasUnsavedChanges=!0,console.log(`æ‰‹åŠ¨æ ‡æ³¨æ ‡è®°å·²è®¾ç½®ä¸º: ${y}`))}function se(y,m){o.value?(o.value[y]=m,o.value.hasUnsavedChanges=!0,console.log(`å½“å‰å›¾ç‰‡å±æ€§ ${String(y)} å·²æ›´æ–°`)):console.warn("æ›´æ–°å¤±è´¥: å½“å‰æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡")}function X(y,m){o.value&&(o.value.translatedDataURL=y,m&&(o.value.cleanImageData=m),o.value.translationStatus="completed",o.value.translationFailed=!1,o.value.hasUnsavedChanges=!0,console.log("å½“å‰å›¾ç‰‡ç¿»è¯‘ç»“æœå·²æ›´æ–°"))}function ie(y,m,l){if(y>=0&&y<n.value.length){const v=n.value[y];v&&(v.translationStatus=m,v.translationFailed=m==="failed",l&&(v.errorMessage=l),console.log(`å›¾ç‰‡ ${y} ç¿»è¯‘çŠ¶æ€: ${m}`))}}function z(y){o.value&&(o.value.translationStatus="failed",o.value.translationFailed=!0,o.value.errorMessage=y,console.log(`å½“å‰å›¾ç‰‡ç¿»è¯‘å¤±è´¥: ${y}`))}function R(){n.value.forEach(y=>{y.translationStatus="pending",y.translationFailed=!1,y.errorMessage=void 0}),console.log("æ‰€æœ‰å›¾ç‰‡ç¿»è¯‘çŠ¶æ€å·²é‡ç½®")}function T(y){s.value=y,console.log(`æ‰¹é‡ç¿»è¯‘çŠ¶æ€: ${y?"è¿›è¡Œä¸­":"å·²å®Œæˆ"}`)}function F(){return n.value.map((y,m)=>y.translationFailed?m:-1).filter(y=>y!==-1)}return{images:n,currentImageIndex:t,isBatchTranslationInProgress:s,currentImage:o,imageCount:i,hasImages:r,canGoPrevious:a,canGoNext:u,failedImageCount:p,completedImageCount:k,pendingImageCount:f,addImage:P,addImages:A,setImages:M,deleteImage:B,deleteCurrentImage:$,clearImages:W,sortImagesByFileName:O,setCurrentImageIndex:U,goToPrevious:g,goToNext:d,updateCurrentImage:x,updateImageByIndex:_,updateCurrentBubbleStates:K,setManuallyAnnotated:V,updateCurrentImageProperty:se,updateCurrentTranslationResult:X,setTranslationStatus:ie,markCurrentAsFailed:z,resetAllTranslationStatus:R,setBatchTranslationInProgress:T,getFailedImageIndices:F}}),nn=Object.freeze(Object.defineProperty({__proto__:null,useImageStore:Ze},Symbol.toStringTag,{value:"Module"})),Tt=Ht("session",()=>{const n=C(null),t=C({bookId:null,chapterId:null,bookTitle:null,chapterTitle:null}),s=C([]),o=C(!1),i=C({current:0,total:0,message:""}),r=C(null),a=C(!1),u=j(()=>t.value.bookId!==null&&t.value.chapterId!==null),p=j(()=>t.value.bookId),k=j(()=>t.value.chapterId);function f(z,R,T=null,F=null){t.value={bookId:z,chapterId:R,bookTitle:T,chapterTitle:F},console.log(`ä¼šè¯ä¸Šä¸‹æ–‡å·²è®¾ç½®: ä¹¦ç±=${z}, ç« èŠ‚=${R}`)}function P(z,R,T,F){f(z,R,T,F)}function A(){t.value={bookId:null,chapterId:null,bookTitle:null,chapterTitle:null},console.log("ä¼šè¯ä¸Šä¸‹æ–‡å·²æ¸…é™¤")}function M(z){const R=z.get("book"),T=z.get("chapter");R&&T&&f(R,T)}function B(z){n.value=z,console.log(`å½“å‰ä¼šè¯åç§°: ${z}`)}function $(){n.value=null}function W(z){s.value=z,console.log(`ä¼šè¯åˆ—è¡¨å·²æ›´æ–°ï¼Œå…± ${z.length} ä¸ªä¼šè¯`)}function O(z){const R=s.value.findIndex(T=>T.name===z.name);R>=0?s.value[R]=z:s.value.unshift(z)}function U(z){const R=s.value.findIndex(T=>T.name===z);R>=0&&s.value.splice(R,1)}function g(z,R){const T=s.value.find(F=>F.name===z);T&&(T.name=R)}function d(z){o.value=z}function x(z){a.value=z}function _(z){r.value=z}function K(){n.value=null,t.value={bookId:null,chapterId:null,bookTitle:null,chapterTitle:null},s.value=[],o.value=!1,a.value=!1,r.value=null,console.log("ä¼šè¯çŠ¶æ€å·²é‡ç½®")}async function V(z){if(!z||typeof z!="string")return null;if(z.startsWith("data:"))return z;if(!z.startsWith("/api/"))return null;try{const R=await fetch(z);if(!R.ok)return null;const T=await R.blob();return new Promise(F=>{const y=new FileReader;y.onloadend=()=>F(y.result),y.onerror=()=>F(null),y.readAsDataURL(T)})}catch(R){return console.error(`è½¬æ¢å›¾ç‰‡ URL å¤±è´¥: ${z}`,R),null}}async function se(z,R){const T=z.length;for(let F=0;F<T;F++){const y=z[F];if(y){if(R&&R(F+1,T),y.originalDataURL&&y.originalDataURL.startsWith("/api/")){const m=await V(y.originalDataURL);m&&(y.originalDataURL=m)}if(y.translatedDataURL&&y.translatedDataURL.startsWith("/api/")){const m=await V(y.translatedDataURL);m&&(y.translatedDataURL=m)}if(y.cleanImageData&&y.cleanImageData.startsWith("/api/")){const m=await V(y.cleanImageData);m&&(y.cleanImageData=m.replace(/^data:image\/\w+;base64,/,""))}}}}async function X(z){d(!0),_(null),i.value={current:0,total:0,message:"æ­£åœ¨åŠ è½½..."};try{const{useImageStore:R}=await lt(async()=>{const{useImageStore:N}=await Promise.resolve().then(()=>nn);return{useImageStore:N}},void 0),{useSettingsStore:T}=await lt(async()=>{const{useSettingsStore:N}=await import("./system.XPcAFQMv.js").then(Z=>Z.s);return{useSettingsStore:N}},__vite__mapDeps([0,1,2,3,4,5])),{useBubbleStore:F}=await lt(async()=>{const{useBubbleStore:N}=await Promise.resolve().then(()=>di);return{useBubbleStore:N}},void 0),y=R(),m=T(),l=F(),{loadSessionByPathApi:v}=await lt(async()=>{const{loadSessionByPathApi:N}=await import("./session.C_VZSWrV.js");return{loadSessionByPathApi:N}},__vite__mapDeps([6,4,5])),D=await v(z);if(!D.success||!D.session)throw new Error(D.error||"åŠ è½½ä¼šè¯å¤±è´¥");const S=D.session;if(S.images&&S.images.length>0){const N=S.images.map((c,h)=>({id:`session-${h}-${Date.now()}`,originalDataURL:c.originalDataURL,translatedDataURL:c.translatedDataURL||null,cleanImageData:c.cleanImageData||null,bubbleStates:c.bubbleStates!==void 0&&c.bubbleStates!==null?c.bubbleStates:null,isManuallyAnnotated:!!c.isManuallyAnnotated,relativePath:c.relativePath||void 0,folderPath:c.folderPath||void 0,fileName:c.fileName||`image-${h+1}.png`,translationStatus:c.translationStatus||"pending",translationFailed:!!c.translationFailed,hasUnsavedChanges:!1,fontSize:c.fontSize||24,autoFontSize:c.autoFontSize??!1,fontFamily:c.fontFamily||"Microsoft YaHei",layoutDirection:c.layoutDirection||"auto",useAutoTextColor:c.useAutoTextColor??void 0,textColor:c.textColor||"#000000",fillColor:c.fillColor||"#FFFFFF",inpaintMethod:c.inpaintMethod||"litelama",strokeEnabled:c.strokeEnabled??!1,strokeColor:c.strokeColor||"#FFFFFF",strokeWidth:c.strokeWidth||2}));N.length>0&&(console.log("æ­£åœ¨åŠ è½½å›¾ç‰‡..."),i.value={current:0,total:N.length,message:"æ­£åœ¨åŠ è½½å›¾ç‰‡..."},await se(N,(c,h)=>{const le=c/h*100;i.value={current:c,total:h,message:`åŠ è½½å›¾ç‰‡ ${c}/${h}...`},console.log(`åŠ è½½å›¾ç‰‡ ${c}/${h}... (${le.toFixed(0)}%)`)}),i.value={current:N.length,total:N.length,message:"åŠ è½½å®Œæˆ"},console.log("å›¾ç‰‡åŠ è½½å®Œæˆï¼Œå·²è½¬æ¢ä¸º Base64"),setTimeout(()=>{i.value={current:0,total:0,message:""}},500)),y.setImages(N);let Z=0;typeof S.currentImageIndex=="number"&&(Z=S.currentImageIndex,(Z>=N.length||Z<0)&&(Z=N.length>0?0:-1)),y.setCurrentImageIndex(Z);const Y=N[Z];Y&&Y.bubbleStates&&Y.bubbleStates.length>0?l.setBubbles(Y.bubbleStates,!0):l.clearBubblesLocal(),console.log(`æŒ‰è·¯å¾„åŠ è½½ä¼šè¯æˆåŠŸ: ${z}, å…± ${N.length} å¼ å›¾ç‰‡`)}const w=S.ui_settings;if(w){(w.targetLanguage||w.sourceLanguage)&&m.updateSettings({targetLanguage:w.targetLanguage||void 0,sourceLanguage:w.sourceLanguage||void 0});const N=w.useInpaintingMethod,Y=["solid","lama_mpe","litelama"].includes(N)?N:m.settings.textStyle.inpaintMethod;m.updateTextStyle({fontSize:w.fontSize||m.settings.textStyle.fontSize,autoFontSize:w.autoFontSize??m.settings.textStyle.autoFontSize,fontFamily:w.fontFamily||m.settings.textStyle.fontFamily,layoutDirection:w.layoutDirection||m.settings.textStyle.layoutDirection,textColor:w.textColor||m.settings.textStyle.textColor,fillColor:w.fillColor||m.settings.textStyle.fillColor,inpaintMethod:Y,strokeEnabled:w.strokeEnabled??m.settings.textStyle.strokeEnabled,strokeColor:w.strokeColor||m.settings.textStyle.strokeColor,strokeWidth:w.strokeWidth||m.settings.textStyle.strokeWidth,useAutoTextColor:w.useAutoTextColor??m.settings.textStyle.useAutoTextColor}),console.log("UI è®¾ç½®å·²æ¢å¤")}return B(z),!0}catch(R){const T=R instanceof Error?R.message:"åŠ è½½ä¼šè¯å¤±è´¥";throw _(T),console.error(`æŒ‰è·¯å¾„åŠ è½½ä¼šè¯å¤±è´¥: ${z}`,R),R}finally{d(!1)}}async function ie(z,R){if(!z||!R)return console.log("æœªåœ¨ä¹¦ç±/ç« èŠ‚æ¨¡å¼ï¼Œä¸æ”¯æŒä¿å­˜"),!1;console.log(`ä¿å­˜ç« èŠ‚ä¼šè¯: book=${z}, chapter=${R}`);const{useImageStore:T}=await lt(async()=>{const{useImageStore:S}=await Promise.resolve().then(()=>nn);return{useImageStore:S}},void 0),{useSettingsStore:F}=await lt(async()=>{const{useSettingsStore:S}=await import("./system.XPcAFQMv.js").then(w=>w.s);return{useSettingsStore:S}},__vite__mapDeps([0,1,2,3,4,5])),y=T(),m=F(),l=Array.isArray(y.images)?y.images:[];if(!l||l.length===0)return console.log("æ²¡æœ‰å›¾ç‰‡æ•°æ®å¯ä¿å­˜"),!1;const v=`bookshelf/${z}/${R}`;x(!0),_(null);const D=l.length;i.value={current:0,total:D,message:`å‡†å¤‡ä¿å­˜ ${D} å¼ å›¾ç‰‡...`};try{l.some(h=>h.originalDataURL&&h.originalDataURL.startsWith("/api/")||h.translatedDataURL&&h.translatedDataURL.startsWith("/api/")||h.cleanImageData&&h.cleanImageData.startsWith("/api/"))&&(console.log("[saveChapterSession] æ£€æµ‹åˆ° /api/ URL æ ¼å¼å›¾ç‰‡ï¼Œå¼€å§‹è½¬æ¢ä¸º Base64..."),i.value={current:0,total:D,message:"è½¬æ¢å›¾ç‰‡æ ¼å¼..."},await se(l,(h,le)=>{i.value={current:0,total:D,message:`è½¬æ¢å›¾ç‰‡ ${h}/${le}...`}}),console.log("[saveChapterSession] å›¾ç‰‡æ ¼å¼è½¬æ¢å®Œæˆ"));const{textStyle:w}=m.settings,N={fontSize:w.fontSize,autoFontSize:w.autoFontSize,fontFamily:w.fontFamily,layoutDirection:w.layoutDirection,textColor:w.textColor,useInpaintingMethod:w.inpaintMethod,fillColor:w.fillColor,strokeEnabled:w.strokeEnabled,strokeColor:w.strokeColor,strokeWidth:w.strokeWidth,useAutoTextColor:w.useAutoTextColor},{saveAllPagesSequentially:Z,saveSessionMeta:Y}=await lt(async()=>{const{saveAllPagesSequentially:h,saveSessionMeta:le}=await Promise.resolve().then(()=>wn);return{saveAllPagesSequentially:h,saveSessionMeta:le}},void 0),c=await Z(v,l,{onProgress:(h,le)=>{i.value={current:h,total:le,message:`ä¿å­˜å›¾ç‰‡ ${h}/${le}...`}}});i.value={current:D,total:D,message:"å®Œæˆä¿å­˜..."},await Y(v,{ui_settings:N,total_pages:D,currentImageIndex:y.currentImageIndex}),console.log(`ç« èŠ‚ä¿å­˜å®Œæˆ: ${c}/${D} å¼ å›¾ç‰‡`);try{const{apiClient:h}=await lt(async()=>{const{apiClient:le}=await import("./client.Bht704G-.js");return{apiClient:le}},__vite__mapDeps([4,5]));await h.put(`/api/bookshelf/books/${z}/chapters/${R}/image-count`,{count:D})}catch(h){console.warn("æ›´æ–°ç« èŠ‚å›¾ç‰‡æ•°é‡å¤±è´¥ï¼ˆéè‡´å‘½ï¼‰:",h)}return i.value={current:D,total:D,message:"ä¿å­˜å®Œæˆ"},setTimeout(()=>{i.value={current:0,total:0,message:""}},1e3),!0}catch(S){const w=S instanceof Error?S.message:"ä¿å­˜ç« èŠ‚ä¼šè¯å¤±è´¥";return _(w),console.error("ä¿å­˜å¤±è´¥:",S),i.value={current:0,total:0,message:""},!1}finally{x(!1)}}return{currentSessionName:n,context:t,sessionList:s,isLoading:o,isSaving:a,error:r,loadingProgress:i,isBookshelfMode:u,currentBookId:p,currentChapterId:k,setContext:f,clearContext:A,parseContextFromUrl:M,setSessionName:B,clearSessionName:$,setSessionList:W,addToSessionList:O,removeFromSessionList:U,renameInSessionList:g,setLoading:d,setSaving:x,setError:_,imageUrlToBase64:V,saveChapterSession:ie,loadSessionByPath:X,setBookChapterContext:P,reset:K}}),Ut={originalText:"",translatedText:"",textboxText:"",coords:[0,0,100,100],polygon:[],fontSize:25,fontFamily:ht,textDirection:"vertical",autoTextDirection:"vertical",textColor:"#000000",fillColor:mn,rotationAngle:0,position:{x:0,y:0},strokeEnabled:vo,strokeColor:mo,strokeWidth:po,inpaintMethod:"solid",autoFgColor:null,autoBgColor:null,colorConfidence:0};function ea(n){return{...{...Ut,...n},coords:n?.coords?[...n.coords]:[...Ut.coords],polygon:n?.polygon?n.polygon.map(s=>[...s]):[],position:n?.position?{...Ut.position,...n.position}:{...Ut.position}}}function ta(n){const[t,s,o,i]=n,r=Math.abs(o-t);return Math.abs(i-s)>r?"vertical":"horizontal"}function Ot(n){return n.map(t=>({...t,coords:[...t.coords],polygon:t.polygon?t.polygon.map(s=>[...s]):[],position:{...t.position},autoFgColor:t.autoFgColor?[...t.autoFgColor]:null,autoBgColor:t.autoBgColor?[...t.autoBgColor]:null}))}function oa(n){if(!n||typeof n!="object")return!1;const t=n;if(!Array.isArray(t.coords)||t.coords.length!==4||!t.coords.every(i=>typeof i=="number"&&!isNaN(i))||typeof t.fontSize!="number"||t.fontSize<=0)return!1;const s=["vertical","horizontal","auto"];if(typeof t.textDirection!="string"||!s.includes(t.textDirection))return!1;const o=["solid","lama_mpe","litelama"];return!(typeof t.inpaintMethod!="string"||!o.includes(t.inpaintMethod))}function na(n){let t=n,s=0,o=0,i=Date.now();const r=()=>t<=0?0:Math.ceil(6e4/t);return{async acquire(){if(t<=0)return;const a=Date.now(),u=r();if(a-i>=6e4&&(i=a,o=0),o>=t){const k=6e4-(a-i);k>0&&await sn(k),i=Date.now(),o=0}const p=a-s;p<u&&await sn(u-p),s=Date.now(),o++},reset(){s=0,o=0,i=Date.now()},getRpm(){return t},setRpm(a){t=a,this.reset()}}}function sn(n){return new Promise(t=>setTimeout(t,n))}function an(n){const t=n.replace(/\\/g,"/"),s=[],o=/(\d+)/g;let i=0,r;for(;(r=o.exec(t))!==null;){if(r.index>i){const a=t.slice(i,r.index);a&&s.push([!0,a.toLowerCase()])}s.push([!1,parseInt(r[0],10)]),i=o.lastIndex}if(i<t.length){const a=t.slice(i);a&&s.push([!0,a.toLowerCase()])}return s}function sa(n,t){const s=an(n),o=an(t),i=Math.min(s.length,o.length);for(let r=0;r<i;r++){const[a,u]=s[r],[p,k]=o[r];if(a!==p)return a?1:-1;if(u<k)return-1;if(u>k)return 1}return s.length-o.length}function aa(n,t=s=>String(s)){return[...n].sort((s,o)=>sa(t(s),t(o)))}const ln="webImportDisclaimerAccepted",xo=Ht("webImport",()=>{const n=C(tn()),t=C("idle"),s=C(""),o=C([]),i=C(null),r=C(new Set),a=C({current:0,total:0}),u=C([]),p=C(null),k=C(!1),f=C(!1),P=C(!1),A=j(()=>t.value==="extracting"),M=j(()=>t.value==="downloading"),B=j(()=>A.value||M.value),$=j(()=>r.value.size),W=j(()=>a.value.total===0?0:Math.round(a.value.current/a.value.total*100));function O(){try{localStorage.setItem(Wo,JSON.stringify(n.value))}catch(w){console.error("ä¿å­˜ç½‘é¡µå¯¼å…¥è®¾ç½®å¤±è´¥:",w)}}function U(){try{const w=localStorage.getItem(Wo);if(w){const N=JSON.parse(w);n.value=g(tn(),N)}}catch(w){console.error("åŠ è½½ç½‘é¡µå¯¼å…¥è®¾ç½®å¤±è´¥:",w)}}function g(w,N){const Z={...w};for(const Y in N)if(Object.prototype.hasOwnProperty.call(N,Y)){const c=N[Y],h=w[Y];c!==null&&typeof c=="object"&&!Array.isArray(c)&&h!==null&&typeof h=="object"&&!Array.isArray(h)?Z[Y]=g(h,c):c!==void 0&&(Z[Y]=c)}return Z}function d(){f.value?k.value=!0:P.value=!0}function x(){f.value=!0,P.value=!1,k.value=!0;try{localStorage.setItem(ln,"true")}catch(w){console.error("ä¿å­˜å…è´£å£°æ˜çŠ¶æ€å¤±è´¥:",w)}}function _(){P.value=!1}function K(){try{const w=localStorage.getItem(ln);f.value=w==="true"}catch(w){console.error("åŠ è½½å…è´£å£°æ˜çŠ¶æ€å¤±è´¥:",w)}}function V(){k.value=!1}function se(){t.value="idle",s.value="",o.value=[],i.value=null,r.value=new Set,a.value={current:0,total:0},u.value=[],p.value=null}function X(w){s.value=w}function ie(w){o.value.push(w)}function z(){o.value=[]}function R(w){i.value&&i.value.pages.length>0?(i.value.comicTitle=w.comicTitle,i.value.chapterTitle=w.chapterTitle,i.value.totalPages=w.totalPages,i.value.sourceUrl=w.sourceUrl,i.value.referer=w.referer,i.value.engine=w.engine,i.value.success=w.success,i.value.error=w.error):(i.value=w,w.success&&w.pages&&(r.value=new Set(w.pages.map(N=>N.pageNumber))))}function T(w){r.value.has(w)?r.value.delete(w):r.value.add(w),r.value=new Set(r.value)}function F(){i.value?.pages&&(r.value.size===i.value.pages.length?r.value=new Set:r.value=new Set(i.value.pages.map(w=>w.pageNumber)))}function y(w){t.value=w}function m(w){p.value=w,w&&(t.value="error")}function l(w,N){a.value={current:w,total:N}}function v(w){u.value=w}function D(w){i.value||(i.value={success:!0,comicTitle:"",chapterTitle:"",pages:[],totalPages:0,sourceUrl:s.value,referer:"",engine:"gallery-dl"}),i.value.pages.push(w),i.value.totalPages=i.value.pages.length,r.value.add(w.pageNumber),r.value=new Set(r.value)}const S=As(n,O);return U(),K(),{settings:n,status:t,url:s,logs:o,extractResult:i,selectedPages:r,downloadProgress:a,downloadedImages:u,error:p,modalVisible:k,disclaimerAccepted:f,disclaimerVisible:P,isExtracting:A,isDownloading:M,isProcessing:B,selectedCount:$,downloadProgressPercent:W,saveToStorage:O,loadFromStorage:U,openModal:d,closeModal:V,resetState:se,setUrl:X,addLog:ie,clearLogs:z,setExtractResult:R,togglePageSelection:T,toggleSelectAll:F,setStatus:y,setError:m,updateDownloadProgress:l,setDownloadedImages:v,addPageIncremental:D,acceptDisclaimer:x,rejectDisclaimer:_,...S}}),la={key:0,class:"translation-progress-bar"},ia={class:"progress-bar-label"},ra={class:"progress-bar"},ua=je({__name:"ProgressBar",props:{visible:{type:Boolean,default:!0},percentage:{},label:{default:"è¿›åº¦"}},setup(n){return(t,s)=>n.visible?(E(),L("div",la,[e("div",ia,ne(n.label),1),e("div",ra,[e("div",{class:"progress",style:ot({width:`${n.percentage}%`})},null,4)])])):de("",!0)}}),_o=He(ua,[["__scopeId","data-v-f915cadf"]]),ca={class:"image-upload"},da={class:"error-text"},ga={key:2,class:"loading-overlay"},pa=je({__name:"ImageUpload",emits:["uploadComplete"],setup(n,{expose:t,emit:s}){const o=s,i=Ze(),r=ze(),a=xo(),u=C(null),p=C(null),k=C(!1),f=C(!1),P=C(""),A=C(0),M=C(""),B=C(!1),$=j(()=>r.settings.pdfProcessingMethod);function W(){u.value?.click()}function O(){a.openModal()}function U(){p.value?.click()}async function g(m){const l=m.target;if(!l.files||l.files.length===0)return;const D=Array.from(l.files).filter(w=>w.type.startsWith("image/"));if(D.length===0){xe("æ‰€é€‰æ–‡ä»¶å¤¹ä¸­æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶","warning"),l.value="";return}const S=aa(D,w=>w.webkitRelativePath);console.log(`ä»æ–‡ä»¶å¤¹å¯¼å…¥ ${S.length} å¼ å›¾ç‰‡`),await d(S),l.value=""}async function d(m){if(m.length!==0){k.value=!0,B.value=!0,A.value=0;try{let l=0;const v=m.length;for(let D=0;D<m.length;D++){const S=m[D];if(!S||!S.type.startsWith("image/"))continue;M.value=S.name;const w=S.webkitRelativePath||"",N=w.includes("/")?w.substring(0,w.lastIndexOf("/")):"";await new Promise((Z,Y)=>{const c=new FileReader;c.onload=h=>{const le=h.target?.result;i.addImage(S.name,le,{relativePath:w,folderPath:N}),Z()},c.onerror=()=>Y(new Error(`è¯»å–å›¾ç‰‡å¤±è´¥: ${S.name}`)),c.readAsDataURL(S)}),l++,A.value=Math.round((D+1)/v*100)}l>0&&(xe(`å·²æ·»åŠ  ${l} å¼ å›¾ç‰‡`,"success"),o("uploadComplete",l))}catch(l){console.error("å¤„ç†æ–‡ä»¶å¤±è´¥:",l);const v=l instanceof Error?l.message:"å¤„ç†æ–‡ä»¶å¤±è´¥";xe(v,"error")}finally{k.value=!1,B.value=!1}}}async function x(m){const l=m.target;!l.files||l.files.length===0||(await se(Array.from(l.files)),l.value="")}async function _(m){m.preventDefault(),f.value=!1,!(!m.dataTransfer?.files||m.dataTransfer.files.length===0)&&await se(Array.from(m.dataTransfer.files))}function K(m){m.preventDefault(),f.value=!0}function V(m){const l=m.currentTarget.getBoundingClientRect(),v=m.clientX,D=m.clientY;(v<l.left||v>l.right||D<l.top||D>l.bottom)&&(f.value=!1)}async function se(m){if(m.length!==0){k.value=!0,P.value="",B.value=!0,A.value=0;try{let l=0;const v=m.length;for(let D=0;D<m.length;D++){const S=m[D];if(!S)continue;M.value=S.name;const w=S.type,N=S.name.toLowerCase();if(w.startsWith("image/"))await X(S),l++;else if(w==="application/pdf"||N.endsWith(".pdf")){const Z=await ie(S);l+=Z}else if(N.endsWith(".mobi")||N.endsWith(".azw")||N.endsWith(".azw3")){const Z=await F(S);l+=Z}else console.warn(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${S.name}`),xe(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${S.name}`,"warning");A.value=Math.round((D+1)/v*100)}l>0&&(xe(`å·²æ·»åŠ  ${l} å¼ å›¾ç‰‡`,"success"),o("uploadComplete",l))}catch(l){console.error("å¤„ç†æ–‡ä»¶å¤±è´¥:",l);const v=l instanceof Error?l.message:"å¤„ç†æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•";P.value=v,xe(v,"error")}finally{k.value=!1,B.value=!1,M.value=""}}}async function X(m){return new Promise((l,v)=>{const D=new FileReader;D.onload=S=>{const w=S.target?.result;i.addImage(m.name,w),l()},D.onerror=()=>v(new Error(`è¯»å–å›¾ç‰‡æ–‡ä»¶å¤±è´¥: ${m.name}`)),D.readAsDataURL(m)})}async function ie(m){return $.value==="frontend"?await R(m):await T(m)}function z(m){return new Promise((l,v)=>{const D=new FileReader;D.onload=()=>l(D.result),D.onerror=v,D.readAsDataURL(m)})}async function R(m){try{const l=await lt(()=>import("./pdf.U7tdldy2.js").then(Z=>Z.p),[]);l.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${l.version}/pdf.worker.min.js`;const v=await m.arrayBuffer(),D=await l.getDocument({data:v}).promise,S=D.numPages;console.log(`PDF ${m.name} å…± ${S} é¡µï¼Œå¼€å§‹æœ¬åœ°æ¸²æŸ“...`),xe(`æ­£åœ¨è§£æ PDFï¼Œå…± ${S} é¡µ...`,"info");const w=typeof OffscreenCanvas<"u";w&&console.log("ä½¿ç”¨ OffscreenCanvas åå°æ¸²æŸ“æ¨¡å¼");let N=0;for(let Z=1;Z<=S;Z++){M.value=`${m.name} - ç¬¬ ${Z}/${S} é¡µ`,A.value=Math.round(Z/S*100);try{const Y=await D.getPage(Z),h=Y.getViewport({scale:2});let le;if(w){const G=new OffscreenCanvas(h.width,h.height),re=G.getContext("2d");await Y.render({canvasContext:re,viewport:h}).promise;const ke=await G.convertToBlob({type:"image/jpeg",quality:1});le=await z(ke)}else{const G=document.createElement("canvas"),re=G.getContext("2d");G.width=h.width,G.height=h.height,await Y.render({canvasContext:re,viewport:h}).promise,le=G.toDataURL("image/jpeg",1)}const I=`${m.name}_é¡µé¢${Z}`;i.addImage(I,le),N++,console.log(`  é¡µé¢ ${Z}/${S} å¤„ç†å®Œæˆ`)}catch(Y){console.warn(`PDF ${m.name} ç¬¬ ${Z} é¡µæ¸²æŸ“å¤±è´¥:`,Y)}}return console.log(`PDF ${m.name} å…¨éƒ¨ ${S} é¡µå¤„ç†å®Œæˆ`),N}catch(l){return console.error("å‰ç«¯ PDF è§£æå¤±è´¥:",l),xe("å‰ç«¯ PDF è§£æå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨åç«¯è§£æ...","warning"),await T(m)}}async function T(m){let v=null;try{xe("æ­£åœ¨ä¸Šä¼  PDF æ–‡ä»¶...","info");const D=await xs(m,5);if(!D.success||!D.session_id)throw new Error(D.error||"PDF è§£æå¯åŠ¨å¤±è´¥");v=D.session_id;const S=D.total_pages||0;console.log(`PDF ${m.name} å…± ${S} é¡µï¼Œå¼€å§‹åç«¯åˆ†æ‰¹è§£æ...`),xe(`æ­£åœ¨è§£æ PDFï¼Œå…± ${S} é¡µ...`,"info");let w=0;for(let N=0;N<S;N+=5){M.value=`${m.name} - å¤„ç†ä¸­ ${Math.min(N+5,S)}/${S} é¡µ`,A.value=S>0?Math.round(N/S*100):0;const Z=await _s(v,N,5);if(!Z.success){console.warn(`æ‰¹æ¬¡ ${N} è·å–å¤±è´¥:`,Z.error);continue}if(Z.images&&Z.images.length>0)for(const Y of Z.images){if(!Y||!Y.data_url)continue;const c=`${m.name}_é¡µé¢${String(Y.page_index+1).padStart(4,"0")}`;i.addImage(c,Y.data_url),w++}console.log(`  å·²åŠ è½½ ${w}/${S} é¡µ`)}return console.log(`PDF ${m.name} å…¨éƒ¨ ${w} é¡µå¤„ç†å®Œæˆ`),w}catch(D){throw console.error("åç«¯ PDF è§£æå¤±è´¥:",D),D}finally{if(v)try{await Cs(v)}catch(D){console.warn("PDF ä¼šè¯æ¸…ç†å¤±è´¥:",D)}}}async function F(m){let l=null;try{xe("æ­£åœ¨ä¸Šä¼ ç”µå­ä¹¦æ–‡ä»¶...","info");const v=await Ss(m,5);if(!v.success||!v.session_id)throw new Error(v.error||"MOBI/AZW è§£æå¯åŠ¨å¤±è´¥");l=v.session_id;const D=v.total_images||0;xe(`æ­£åœ¨è§£æç”µå­ä¹¦ï¼Œå…± ${D} å¼ å›¾ç‰‡...`,"info");let S=0,w=!0;for(;w;){M.value=`${m.name} - å·²å¤„ç† ${S}/${D} å¼ `,A.value=D>0?Math.round(S/D*100):0;const N=await ks(l);if(!N.success)throw new Error(N.error||"MOBI/AZW æ‰¹æ¬¡è§£æå¤±è´¥");if(N.images&&N.images.length>0){for(let Z=0;Z<N.images.length;Z++){const Y=N.images[Z];if(!Y)continue;const c=S+Z+1,h=`${m.name.replace(/\.(mobi|azw|azw3)$/i,"")}_image_${String(c).padStart(3,"0")}.png`,le=Y.startsWith("data:")?Y:`data:image/png;base64,${Y}`;i.addImage(h,le)}S+=N.images.length}w=N.has_more??!1}return S}catch(v){throw console.error("MOBI/AZW è§£æå¤±è´¥:",v),v}finally{if(l)try{await ws(l)}catch(v){console.warn("MOBI/AZW ä¼šè¯æ¸…ç†å¤±è´¥:",v)}}}function y(){P.value=""}return t({triggerFileSelect:W,triggerFolderSelect:U,processFiles:se,clearError:y}),(m,l)=>(E(),L("div",ca,[e("div",{id:"drop-area",class:Ie(["drop-area",{"drag-over":f.value,loading:k.value}]),onDragover:K,onDragleave:V,onDrop:_},[e("div",{class:"drop-content"},[e("p",{class:"drop-text"},[l[0]||(l[0]=pe(" æ‹–æ‹½å›¾ç‰‡ã€PDFæˆ–MOBIæ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ– ",-1)),e("span",{class:"select-link",onClick:W}," é€‰æ‹©æ–‡ä»¶ "),l[1]||(l[1]=e("span",{class:"separator"}," | ",-1)),e("span",{class:"select-link folder-link",onClick:U}," ğŸ“ é€‰æ‹©æ–‡ä»¶å¤¹ "),l[2]||(l[2]=e("span",{class:"separator"}," | ",-1)),e("span",{class:"select-link web-import-link",onClick:O}," ğŸŒ ä»ç½‘é¡µå¯¼å…¥ ")])]),e("input",{ref_key:"fileInputRef",ref:u,type:"file",id:"imageUpload",accept:"image/*,application/pdf,.mobi,.azw,.azw3",multiple:"",class:"file-input",onChange:x},null,544),e("input",{ref_key:"folderInputRef",ref:p,type:"file",webkitdirectory:"",class:"file-input",onChange:g},null,544)],34),B.value?(E(),it(_o,{key:0,visible:!0,percentage:A.value,label:M.value||"å¤„ç†ä¸­..."},null,8,["percentage","label"])):de("",!0),P.value?(E(),L("div",{key:1,class:"error-message",onClick:y},[l[3]||(l[3]=e("span",{class:"error-icon"},"âš ï¸",-1)),e("span",da,ne(P.value),1),l[4]||(l[4]=e("span",{class:"error-close"},"Ã—",-1))])):de("",!0),k.value&&!B.value?(E(),L("div",ga,[...l[5]||(l[5]=[e("div",{class:"spinner"},null,-1),e("span",{class:"loading-text"},"å¤„ç†ä¸­...",-1)])])):de("",!0)]))}}),ma=He(pa,[["__scopeId","data-v-5ff3dc04"]]),va={id:"settings-sidebar",class:"settings-sidebar"},fa={class:"card settings-card"},ba={id:"font-settings",class:"settings-card collapsible-panel"},ha={class:"toggle-icon"},ya={class:"collapsible-content"},xa={class:"settings-form"},_a={class:"form-group"},Ca=["value","disabled","title"],Sa={class:"auto-fontSize-option",title:"å‹¾é€‰åï¼Œé¦–æ¬¡ç¿»è¯‘æ—¶è‡ªåŠ¨ä¸ºæ¯ä¸ªæ°”æ³¡è®¡ç®—åˆé€‚çš„å­—å·"},ka=["checked"],wa={class:"form-group"},$a={class:"form-group"},Ta={class:"form-group"},Ia={class:"color-with-auto"},Pa={class:"auto-color-toggle",title:"ç¿»è¯‘æ—¶è‡ªåŠ¨ä½¿ç”¨è¯†åˆ«åˆ°çš„æ–‡å­—é¢œè‰²"},Ra=["checked"],Da=["value","disabled"],Ma={key:0,class:"auto-color-hint"},Ea={class:"form-group"},Ba={class:"checkbox-label"},Aa=["checked"],La={key:0,id:"strokeOptions",class:"stroke-options"},Fa={class:"form-group"},Ua=["value"],Oa={class:"form-group"},za=["value"],Na={class:"form-group"},Va={key:0,id:"solidColorOptions",class:"form-group"},Wa=["value"],Ka={class:"apply-settings-group"},qa=["disabled"],Ha={key:0,class:"apply-options-dropdown"},ja={class:"apply-option"},Ja=["checked"],Ya={class:"apply-option"},Xa={class:"apply-option"},Ga={class:"apply-option"},Za={class:"apply-option"},Qa={class:"apply-option"},el={class:"apply-option"},tl={class:"apply-option"},ol={class:"apply-option"},nl={id:"page-range-settings",class:"settings-card collapsible-panel page-range-panel"},sl={key:0,class:"range-badge"},al={class:"toggle-icon"},ll={class:"collapsible-content"},il={class:"settings-form page-range-form"},rl={class:"range-header-row"},ul={class:"range-toggle-compact"},cl=["disabled"],dl={class:"total-count"},gl={class:"page-range-inputs-compact"},pl=["value","max"],ml=["value","max"],vl={class:"range-count"},fl={key:0,class:"range-error-compact"},bl={class:"action-buttons"},hl=["disabled"],yl=["disabled","title"],xl=["disabled","title"],_l=["disabled","title"],Cl=["disabled"],Sl=["disabled","title"],kl=["disabled"],wl=["disabled"],$l={class:"navigation-buttons"},Tl=["disabled"],Il=["disabled"],Pl=je({__name:"SettingsSidebar",emits:["translateCurrent","translateAll","translateRange","hqTranslate","hqTranslateRange","proofread","proofreadRange","removeText","removeAllText","removeTextRange","deleteCurrent","clearAll","cleanTemp","openPlugins","openSettings","previous","next","applyToAll","textStyleChanged","autoFontSizeChanged"],setup(n,{emit:t}){const s=t,o=Ze(),i=ze(),r=C(!0),a=C(!1),u=C({fontSize:!0,fontFamily:!0,layoutDirection:!0,textColor:!0,fillColor:!0,strokeEnabled:!0,strokeColor:!0,strokeWidth:!0}),p=C(!1),k=C(!1),f=C(1),P=C(1),A=[{label:"è‡ªåŠ¨ (æ ¹æ®æ£€æµ‹)",value:"auto"},{label:"ç«–å‘æ’ç‰ˆ",value:"vertical"},{label:"æ¨ªå‘æ’ç‰ˆ",value:"horizontal"}],M=[{label:"çº¯è‰²å¡«å……",value:"solid"},{label:"LAMAä¿®å¤ (é€Ÿåº¦ä¼˜åŒ–)",value:"lama_mpe"},{label:"LAMAä¿®å¤ (é€šç”¨)",value:"litelama"}],B=j(()=>o.currentImage),$=j(()=>o.hasImages),W=j(()=>o.images.length),O=j(()=>f.value>=1&&P.value<=W.value&&f.value<=P.value),U=j(()=>$.value&&!o.isBatchTranslationInProgress),g=j(()=>o.canGoPrevious),d=j(()=>o.canGoNext),x=j(()=>i.textStyle),_=C([]),K=[ht,"fonts/msyh.ttc","fonts/simhei.ttf","fonts/simsun.ttc"],V=C(null),se=j(()=>{const ee=_.value.map(b=>({label:F(b),value:b}));return ee.push({label:"è‡ªå®šä¹‰å­—ä½“...",value:"custom-font"}),ee});ut(async()=>{await X();const ee=x.value.fontFamily;ee&&!_.value.includes(ee)&&(_.value=[ee,..._.value])});async function X(){try{const ee=await yn();if(ee.fonts&&Array.isArray(ee.fonts)&&ee.fonts.length>0){const b=ee.fonts[0];if(typeof b=="object"&&"path"in b){const J=ee.fonts.map(me=>typeof me=="object"?me.path:me);_.value=J}else _.value=ee.fonts}else _.value=[...K]}catch(ee){console.error("åŠ è½½å­—ä½“åˆ—è¡¨å¤±è´¥:",ee),_.value=[...K]}}function ie(){r.value=!r.value}function z(ee){const b=parseInt(ee.target.value);isNaN(b)||(i.updateTextStyle({fontSize:b}),s("textStyleChanged","fontSize",b))}function R(ee){const b=ee.target.checked;i.updateTextStyle({autoFontSize:b}),console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${b}`),s("autoFontSizeChanged",b)}async function T(ee){const b=ee.target,J=b.files?.[0];if(!J)return;const me=[".ttf",".ttc",".otf"],H=J.name.toLowerCase();if(!me.some(ue=>H.endsWith(ue))){xe("è¯·é€‰æ‹© .ttfã€.ttc æˆ– .otf æ ¼å¼çš„å­—ä½“æ–‡ä»¶","error"),b.value="";return}try{const ue=await Rs(J);ue.success&&ue.fontPath?(await X(),i.updateTextStyle({fontFamily:ue.fontPath}),xe("å­—ä½“ä¸Šä¼ æˆåŠŸ","success")):xe(ue.error||"å­—ä½“ä¸Šä¼ å¤±è´¥","error")}catch(ue){console.error("å­—ä½“ä¸Šä¼ å¤±è´¥:",ue),xe("å­—ä½“ä¸Šä¼ å¤±è´¥","error")}finally{b.value=""}}function F(ee){const b={"fonts/STXINGKA.TTF":"åæ–‡è¡Œæ¥·","fonts/STXINWEI.TTF":"åæ–‡æ–°é­","fonts/STZHONGS.TTF":"åæ–‡ä¸­å®‹","fonts/STKAITI.TTF":"æ¥·ä½“","fonts/STLITI.TTF":"éš¶ä¹¦","fonts/æ€æºé»‘ä½“SourceHanSansK-Bold.TTF":"æ€æºé»‘ä½“","fonts/STSONG.TTF":"åæ–‡å®‹ä½“","fonts/msyh.ttc":"å¾®è½¯é›…é»‘","fonts/msyhbd.ttc":"å¾®è½¯é›…é»‘ç²—ä½“","fonts/SIMYOU.TTF":"å¹¼åœ†","fonts/STFANGSO.TTF":"ä»¿å®‹","fonts/STHUPO.TTF":"åæ–‡ç¥ç€","fonts/STXIHEI.TTF":"åæ–‡ç»†é»‘","fonts/simkai.ttf":"ä¸­æ˜“æ¥·ä½“","fonts/simfang.ttf":"ä¸­æ˜“ä»¿å®‹","fonts/simhei.ttf":"ä¸­æ˜“é»‘ä½“","fonts/SIMLI.TTF":"ä¸­æ˜“éš¶ä¹¦","fonts/simsun.ttc":"å®‹ä½“"};if(b[ee])return b[ee];const J=ee.split("/").pop()||ee;for(const[me,H]of Object.entries(b))if((me.split("/").pop()||"").toLowerCase()===J.toLowerCase())return H;return J.replace(/\.(ttf|ttc|otf)$/i,"")}function y(ee){const b=String(ee);if(b==="custom-font"){V.value?.click();return}i.updateTextStyle({fontFamily:b}),s("textStyleChanged","fontFamily",b)}function m(ee){const b=String(ee);i.updateTextStyle({layoutDirection:b}),s("textStyleChanged","layoutDirection",b)}function l(ee){const b=String(ee);i.updateTextStyle({inpaintMethod:b})}function v(ee){const b=ee.target.value;i.updateTextStyle({textColor:b}),s("textStyleChanged","textColor",b)}function D(ee){const b=ee.target.checked;i.updateTextStyle({useAutoTextColor:b})}function S(ee){const b=ee.target.checked;i.updateTextStyle({strokeEnabled:b}),s("textStyleChanged","strokeEnabled",b)}function w(ee){const b=ee.target.value;i.updateTextStyle({strokeColor:b}),s("textStyleChanged","strokeColor",b)}function N(ee){const b=parseInt(ee.target.value);isNaN(b)||(i.updateTextStyle({strokeWidth:b}),s("textStyleChanged","strokeWidth",b))}function Z(ee){const b=ee.target.value;i.updateTextStyle({fillColor:b}),s("textStyleChanged","fillColor",b)}function Y(){a.value=!a.value}function c(){const b=!Object.values(u.value).every(J=>J);u.value={fontSize:b,fontFamily:b,layoutDirection:b,textColor:b,fillColor:b,strokeEnabled:b,strokeColor:b,strokeWidth:b}}function h(){s("applyToAll",{...u.value}),a.value=!1}function le(ee){ee.target.closest(".apply-settings-group")||(a.value=!1)}function I(){p.value=!p.value,p.value&&W.value>0&&(f.value=1,P.value=W.value)}function G(ee){const b=parseInt(ee.target.value);isNaN(b)||(f.value=Math.max(1,Math.min(b,W.value)),f.value>P.value&&(P.value=f.value))}function re(ee){const b=parseInt(ee.target.value);isNaN(b)||(P.value=Math.max(1,Math.min(b,W.value)),P.value<f.value&&(f.value=P.value))}function ke(){k.value&&O.value?s("translateRange",f.value,P.value):s("translateAll")}function De(){k.value&&O.value?s("hqTranslateRange",f.value,P.value):s("hqTranslate")}function Te(){k.value&&O.value?s("proofreadRange",f.value,P.value):s("proofread")}function he(){k.value&&O.value?s("removeTextRange",f.value,P.value):s("removeAllText")}return typeof window<"u"&&window.addEventListener("click",le),(ee,b)=>(E(),L("aside",va,[e("div",fa,[b[43]||(b[43]=e("h2",null,"ç¿»è¯‘è®¾ç½®",-1)),e("div",ba,[e("h3",{class:"collapsible-header",onClick:ie},[b[17]||(b[17]=pe(" æ–‡å­—è®¾ç½® ",-1)),e("span",ha,ne(r.value?"â–¼":"â–¶"),1)]),ae(e("div",ya,[e("div",xa,[e("div",_a,[b[19]||(b[19]=e("label",{for:"fontSize"},"å­—å·å¤§å°:",-1)),e("input",{type:"number",id:"fontSize",value:x.value.fontSize,min:"10",max:"100",disabled:x.value.autoFontSize,class:Ie({"disabled-input":x.value.autoFontSize}),title:x.value.autoFontSize?"å·²å¯ç”¨è‡ªåŠ¨å­—å·ï¼Œé¦–æ¬¡ç¿»è¯‘æ—¶å°†è‡ªåŠ¨è®¡ç®—":"",onInput:z},null,42,Ca),e("span",Sa,[e("input",{type:"checkbox",id:"autoFontSize",checked:x.value.autoFontSize,onChange:R},null,40,ka),b[18]||(b[18]=e("label",{for:"autoFontSize"},"è‡ªåŠ¨è®¡ç®—åˆå§‹å­—å·",-1))])]),e("div",wa,[b[20]||(b[20]=e("label",{for:"fontFamily"},"æ–‡æœ¬å­—ä½“:",-1)),Ce(Ke,{"model-value":x.value.fontFamily,options:se.value,onChange:y},null,8,["model-value","options"]),e("input",{ref_key:"fontUploadInput",ref:V,type:"file",id:"fontUpload",accept:".ttf,.ttc,.otf",style:{display:"none"},onChange:T},null,544)]),e("div",$a,[b[21]||(b[21]=e("label",{for:"layoutDirection"},"æ’ç‰ˆè®¾ç½®:",-1)),Ce(Ke,{"model-value":x.value.layoutDirection,options:A,onChange:m},null,8,["model-value"])]),e("div",Ta,[b[23]||(b[23]=e("label",{for:"textColor"},"æ–‡å­—é¢œè‰²:",-1)),e("div",Ia,[e("label",Pa,[e("input",{type:"checkbox",checked:x.value.useAutoTextColor,onChange:D},null,40,Ra),b[22]||(b[22]=e("span",null,"è‡ªåŠ¨",-1))]),e("input",{type:"color",id:"textColor",value:x.value.textColor,disabled:x.value.useAutoTextColor,onInput:v},null,40,Da)]),x.value.useAutoTextColor?(E(),L("div",Ma," ğŸ’¡ ç¿»è¯‘æ—¶å°†è‡ªåŠ¨ä½¿ç”¨è¯†åˆ«åˆ°çš„æ–‡å­—é¢œè‰² ")):de("",!0)]),e("div",Ea,[e("span",Ba,[e("input",{type:"checkbox",id:"strokeEnabled",checked:x.value.strokeEnabled,onChange:S},null,40,Aa),b[24]||(b[24]=e("label",{for:"strokeEnabled"},"å¯ç”¨æ–‡æœ¬æè¾¹:",-1))])]),Ce(Qo,{name:"stroke-slide"},{default:_t(()=>[x.value.strokeEnabled?(E(),L("div",La,[e("div",Fa,[b[25]||(b[25]=e("label",{for:"strokeColor"},"æè¾¹é¢œè‰²:",-1)),e("input",{type:"color",id:"strokeColor",value:x.value.strokeColor,onInput:w},null,40,Ua)]),e("div",Oa,[b[26]||(b[26]=e("label",{for:"strokeWidth"},"æè¾¹å®½åº¦ (px):",-1)),e("input",{type:"number",id:"strokeWidth",value:x.value.strokeWidth,min:"0",max:"10",style:{width:"60px",padding:"5px"},onInput:N},null,40,za),b[27]||(b[27]=e("div",{class:"input-hint"},"0 è¡¨ç¤ºæ— æè¾¹ã€‚",-1))])])):de("",!0)]),_:1}),e("div",Na,[b[28]||(b[28]=e("label",{for:"useInpainting"},"æ°”æ³¡å¡«å……æ–¹å¼:",-1)),Ce(Ke,{"model-value":x.value.inpaintMethod,options:M,onChange:l},null,8,["model-value"])]),Ce(Qo,{name:"slide-fade"},{default:_t(()=>[x.value.inpaintMethod==="solid"?(E(),L("div",Va,[b[29]||(b[29]=e("label",{for:"fillColor"},"å¡«å……é¢œè‰²:",-1)),e("input",{type:"color",id:"fillColor",value:x.value.fillColor,onInput:Z},null,40,Wa)])):de("",!0)]),_:1})]),e("div",Ka,[e("button",{type:"button",class:"settings-button",disabled:!$.value,onClick:h}," åº”ç”¨åˆ°å…¨éƒ¨ ",8,qa),e("button",{type:"button",class:"settings-gear-btn",title:"é€‰æ‹©è¦åº”ç”¨çš„å‚æ•°",onClick:Y}," âš™ï¸ "),a.value?(E(),L("div",Ha,[e("div",ja,[e("input",{type:"checkbox",id:"apply_selectAll",checked:Object.values(u.value).every(J=>J),onChange:c},null,40,Ja),b[30]||(b[30]=e("label",{for:"apply_selectAll"},"å…¨é€‰",-1))]),b[39]||(b[39]=e("hr",null,null,-1)),e("div",Ya,[ae(e("input",{type:"checkbox",id:"apply_fontSize","onUpdate:modelValue":b[0]||(b[0]=J=>u.value.fontSize=J)},null,512),[[et,u.value.fontSize]]),b[31]||(b[31]=e("label",{for:"apply_fontSize"},"å­—å·",-1))]),e("div",Xa,[ae(e("input",{type:"checkbox",id:"apply_fontFamily","onUpdate:modelValue":b[1]||(b[1]=J=>u.value.fontFamily=J)},null,512),[[et,u.value.fontFamily]]),b[32]||(b[32]=e("label",{for:"apply_fontFamily"},"å­—ä½“",-1))]),e("div",Ga,[ae(e("input",{type:"checkbox",id:"apply_layoutDirection","onUpdate:modelValue":b[2]||(b[2]=J=>u.value.layoutDirection=J)},null,512),[[et,u.value.layoutDirection]]),b[33]||(b[33]=e("label",{for:"apply_layoutDirection"},"æ’ç‰ˆæ–¹å‘",-1))]),e("div",Za,[ae(e("input",{type:"checkbox",id:"apply_textColor","onUpdate:modelValue":b[3]||(b[3]=J=>u.value.textColor=J)},null,512),[[et,u.value.textColor]]),b[34]||(b[34]=e("label",{for:"apply_textColor"},"æ–‡å­—é¢œè‰²",-1))]),e("div",Qa,[ae(e("input",{type:"checkbox",id:"apply_fillColor","onUpdate:modelValue":b[4]||(b[4]=J=>u.value.fillColor=J)},null,512),[[et,u.value.fillColor]]),b[35]||(b[35]=e("label",{for:"apply_fillColor"},"å¡«å……é¢œè‰²",-1))]),e("div",el,[ae(e("input",{type:"checkbox",id:"apply_strokeEnabled","onUpdate:modelValue":b[5]||(b[5]=J=>u.value.strokeEnabled=J)},null,512),[[et,u.value.strokeEnabled]]),b[36]||(b[36]=e("label",{for:"apply_strokeEnabled"},"æè¾¹å¼€å…³",-1))]),e("div",tl,[ae(e("input",{type:"checkbox",id:"apply_strokeColor","onUpdate:modelValue":b[6]||(b[6]=J=>u.value.strokeColor=J)},null,512),[[et,u.value.strokeColor]]),b[37]||(b[37]=e("label",{for:"apply_strokeColor"},"æè¾¹é¢œè‰²",-1))]),e("div",ol,[ae(e("input",{type:"checkbox",id:"apply_strokeWidth","onUpdate:modelValue":b[7]||(b[7]=J=>u.value.strokeWidth=J)},null,512),[[et,u.value.strokeWidth]]),b[38]||(b[38]=e("label",{for:"apply_strokeWidth"},"æè¾¹å®½åº¦",-1))])])):de("",!0)])],512),[[Ue,r.value]])]),e("div",nl,[e("h3",{class:"collapsible-header",onClick:I},[b[40]||(b[40]=pe(" æŒ‡å®šèŒƒå›´ ",-1)),k.value?(E(),L("span",sl,ne(f.value)+"-"+ne(P.value),1)):de("",!0),e("span",al,ne(p.value?"â–¼":"â–¶"),1)]),ae(e("div",ll,[e("div",il,[e("div",rl,[e("label",ul,[ae(e("input",{type:"checkbox","onUpdate:modelValue":b[8]||(b[8]=J=>k.value=J),disabled:W.value===0},null,8,cl),[[et,k.value]]),b[41]||(b[41]=e("span",null,"å¯ç”¨",-1))]),e("span",dl,"å…± "+ne(W.value)+" å¼ ",1)]),ae(e("div",gl,[e("input",{type:"number",id:"pageRangeStart",value:f.value,min:"1",max:W.value,onInput:G,placeholder:"èµ·å§‹"},null,40,pl),b[42]||(b[42]=e("span",{class:"range-sep"},"~",-1)),e("input",{type:"number",id:"pageRangeEnd",value:P.value,min:"1",max:W.value,onInput:re,placeholder:"ç»“æŸ"},null,40,ml),e("span",vl,"("+ne(P.value-f.value+1)+"å¼ )",1)],512),[[Ue,k.value]]),k.value&&!O.value&&W.value>0?(E(),L("div",fl," èŒƒå›´æ— æ•ˆ ")):de("",!0)])],512),[[Ue,p.value]])]),e("div",bl,[e("button",{id:"translateButton",disabled:!U.value,onClick:b[9]||(b[9]=J=>s("translateCurrent"))}," ç¿»è¯‘å½“å‰å›¾ç‰‡ ",8,hl),e("button",{id:"translateAllButton",disabled:!U.value||k.value&&!O.value,title:k.value?`ç¿»è¯‘ç¬¬ ${f.value}-${P.value} é¡µ`:"ç¿»è¯‘æ‰€æœ‰å›¾ç‰‡",onClick:ke},ne(k.value?`ç¿»è¯‘ ${f.value}-${P.value} é¡µ`:"ç¿»è¯‘æ‰€æœ‰å›¾ç‰‡"),9,yl),e("button",{id:"startHqTranslationBtn",class:"settings-button purple-button",disabled:!U.value||k.value&&!O.value,title:k.value?`é«˜è´¨é‡ç¿»è¯‘ç¬¬ ${f.value}-${P.value} é¡µ`:"ä½¿ç”¨é«˜è´¨é‡ç¿»è¯‘æ¨¡å¼ï¼ˆéœ€åœ¨è®¾ç½®ä¸­é…ç½®ï¼‰",onClick:De},ne(k.value?`é«˜è´¨é‡ç¿»è¯‘ ${f.value}-${P.value}`:"é«˜è´¨é‡ç¿»è¯‘"),9,xl),e("button",{id:"proofreadButton",disabled:!U.value||k.value&&!O.value,title:k.value?`AIæ ¡å¯¹ç¬¬ ${f.value}-${P.value} é¡µ`:"AIæ ¡å¯¹",onClick:Te},ne(k.value?`AIæ ¡å¯¹ ${f.value}-${P.value}`:"AIæ ¡å¯¹"),9,_l),e("button",{id:"removeTextOnlyButton",disabled:!B.value,title:"æ¶ˆé™¤å›¾ç‰‡ä¸­çš„æ°”æ³¡æ–‡å­—ï¼Œæ— éœ€å¡«å†™ç¿»è¯‘æœåŠ¡å•†å’ŒAPI Key",onClick:b[10]||(b[10]=J=>s("removeText"))}," ä»…æ¶ˆé™¤æ–‡å­— ",8,Cl),e("button",{id:"removeAllTextButton",disabled:!$.value||k.value&&!O.value,title:k.value?`æ¶ˆé™¤ç¬¬ ${f.value}-${P.value} é¡µçš„æ–‡å­—`:"æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡ä¸­çš„æ°”æ³¡æ–‡å­—",onClick:he},ne(k.value?`æ¶ˆé™¤ ${f.value}-${P.value} é¡µæ–‡å­—`:"æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡æ–‡å­—"),9,Sl),e("button",{id:"deleteCurrentImageButton",class:"settings-button red-button",disabled:!B.value,onClick:b[11]||(b[11]=J=>s("deleteCurrent"))}," åˆ é™¤å½“å‰å›¾ç‰‡ ",8,kl),e("button",{id:"clearAllImagesButton",class:"settings-button red-button",disabled:!$.value,onClick:b[12]||(b[12]=J=>s("clearAll"))}," æ¸…é™¤æ‰€æœ‰å›¾ç‰‡ ",8,wl),e("button",{id:"cleanDebugFilesButton",class:"settings-button orange-button",onClick:b[13]||(b[13]=J=>s("cleanTemp"))}," æ¸…ç†ä¸´æ—¶æ–‡ä»¶ "),e("button",{id:"managePluginsButton",class:"settings-button blue-button",onClick:b[14]||(b[14]=J=>s("openPlugins"))}," æ’ä»¶ç®¡ç† ")]),e("div",$l,[e("button",{id:"prevImageButton",disabled:!g.value,onClick:b[15]||(b[15]=J=>s("previous"))}," ä¸Šä¸€å¼  ",8,Tl),e("button",{id:"nextImageButton",disabled:!d.value,onClick:b[16]||(b[16]=J=>s("next"))}," ä¸‹ä¸€å¼  ",8,Il)])])]))}}),Rl=He(Pl,[["__scopeId","data-v-59264439"]]);function wt(n){if(n.textDirection==="vertical"||n.textDirection==="horizontal")return n.textDirection;if(n.autoTextDirection==="vertical"||n.autoTextDirection==="horizontal")return n.autoTextDirection;if(n.coords){const[t,s,o,i]=n.coords;return i-s>o-t?"vertical":"horizontal"}return"vertical"}function Dl(){const n=Ze(),t=ze(),s=rt(),o=C(!1),i=C(0),r=C(""),a=C(!1),u=C(0),p=C(""),k=j(()=>n.hasImages),f=j(()=>n.hasImages),P=j(()=>n.hasImages);function A(){const g=n.images;if(g.length===0){s.warning("æ²¡æœ‰å¯å¯¼å‡ºçš„å›¾ç‰‡æ–‡æœ¬");return}const d=[];for(let ie=0;ie<g.length;ie++){const z=g[ie];if(!z)continue;const R=z.bubbleStates||[],T={imageIndex:ie,bubbles:[]};for(let F=0;F<R.length;F++){const y=R[F];if(!y)continue;const m=y.originalText||"",l=y.translatedText||y.textboxText||"";let v="vertical";y.textDirection&&y.textDirection!=="auto"?v=y.textDirection:y.autoTextDirection&&(v=y.autoTextDirection),T.bubbles.push({bubbleIndex:F,original:m,translated:l,textDirection:v})}d.push(T)}const x=JSON.stringify(d,null,2),_=new Blob([x],{type:"application/json"}),K=URL.createObjectURL(_),V=document.createElement("a");V.href=K;const X=new Date().toISOString().replace(/[-:T]/g,"").slice(0,15);V.download=`translations_${X}.json`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(K),s.success("æ–‡æœ¬å¯¼å‡ºæˆåŠŸï¼")}function M(){const g=n.images;if(g.length===0)return null;const d=[];for(let x=0;x<g.length;x++){const _=g[x];if(!_)continue;const K=_.bubbleStates||[],V={imageIndex:x,bubbles:[]};for(let se=0;se<K.length;se++){const X=K[se];if(!X)continue;const ie=X.originalText||"",z=X.translatedText||X.textboxText||"";let R="vertical";X.textDirection&&X.textDirection!=="auto"?R=X.textDirection:X.autoTextDirection&&(R=X.autoTextDirection),V.bubbles.push({bubbleIndex:se,original:ie,translated:z,textDirection:R})}d.push(V)}return d}async function B(g){if(!g){s.warning("æœªé€‰æ‹©æ–‡ä»¶");return}a.value=!0,u.value=0,p.value="å‡†å¤‡å¯¼å…¥æ–‡æœ¬...",s.info("æ­£åœ¨å¯¼å…¥æ–‡æœ¬...",0);try{const d=await $(g);u.value=10,p.value="è§£æ JSON æ•°æ®...";const x=JSON.parse(d);if(!Array.isArray(x))throw new Error("å¯¼å…¥çš„ JSON æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸ºæ•°ç»„");let _=0,K=0;const V=t.settings.textStyle,se=V.autoFontSize?"auto":V.fontSize,X=V.fontFamily,ie=V.textColor,z=V.fillColor;u.value=20,p.value="å¼€å§‹æ›´æ–°å›¾ç‰‡...";const R=x.length;let T=0;const F=[];for(const l of x){T++;const v=20+T/R*60;u.value=v,p.value=`å¤„ç†å›¾ç‰‡ ${T}/${R}`;const D=l.imageIndex;if(D<0||D>=n.images.length){console.warn(`è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${D}`);continue}const S=n.images[D];if(!S)continue;let w=!1;S.bubbleStates||(S.bubbleStates=[]),S.bubbleTexts||(S.bubbleTexts=[]),S.originalTexts||(S.originalTexts=[]);for(const N of l.bubbles){const Z=N.bubbleIndex,Y=N.original,c=N.translated,h=N.textDirection,le=h==="vertical"||h==="horizontal"?h:"vertical";for(;S.bubbleTexts.length<=Z;)S.bubbleTexts.push("");for(;S.originalTexts.length<=Z;)S.originalTexts.push("");for(Y&&(S.originalTexts[Z]=Y),c&&(S.bubbleTexts[Z]=c);S.bubbleStates.length<=Z;)S.bubbleStates.push(W(se,X,ie,z));const I=S.bubbleStates[Z];I&&(Y&&(I.originalText=Y),c&&(I.translatedText=c,I.textboxText=c),I.textDirection=le,w=!0,K++)}w&&S.bubbleStates&&(S.bubbleTexts=S.bubbleStates.map(N=>N.translatedText||"")),w&&(_++,S.hasUnsavedChanges=!0,S.translatedDataURL&&S.bubbleStates&&S.bubbleStates.length>0&&F.push(D))}if(F.length>0){u.value=80,p.value="å¼€å§‹æ¸²æŸ“å›¾ç‰‡...",s.info("æ­£åœ¨æ¸²æŸ“å›¾ç‰‡ï¼Œè¯·ç¨å€™...",0);const l=t.settings.textStyle,v=l.layoutDirection,D=v==="auto";for(let S=0;S<F.length;S++){const w=F[S];if(w===void 0)continue;const N=n.images[w];if(!(!N||!N.bubbleStates)){u.value=80+S/F.length*20,p.value=`æ¸²æŸ“å›¾ç‰‡ ${S+1}/${F.length}`;try{let Z="";if(N.cleanImageData?Z=N.cleanImageData.includes("base64,")?N.cleanImageData.split("base64,")[1]||"":N.cleanImageData:N.originalDataURL&&(Z=N.originalDataURL.includes("base64,")?N.originalDataURL.split("base64,")[1]||"":N.originalDataURL,console.log(`importText: å›¾ç‰‡ ${w} ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰`)),!Z){console.log(`importText: å›¾ç‰‡ ${w} æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡`);continue}const Y=N.bubbleStates.map(h=>({translatedText:h.translatedText||"",coords:h.coords,fontSize:h.fontSize||l.fontSize,fontFamily:h.fontFamily||l.fontFamily,textDirection:wt(h),textColor:h.textColor||l.textColor,rotationAngle:h.rotationAngle||0,position:h.position||{x:0,y:0},strokeEnabled:h.strokeEnabled??l.strokeEnabled,strokeColor:h.strokeColor||l.strokeColor,strokeWidth:h.strokeWidth??l.strokeWidth})),c=await ho({clean_image:Z,bubble_texts:Y.map(h=>h.translatedText),bubble_coords:Y.map(h=>h.coords),fontSize:l.fontSize,fontFamily:l.fontFamily,textDirection:D?"vertical":v,textColor:l.textColor,bubble_states:Y,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,is_font_style_change:!0,strokeEnabled:l.strokeEnabled,strokeColor:l.strokeColor,strokeWidth:l.strokeWidth});c.rendered_image&&(n.updateImageByIndex(w,{translatedDataURL:`data:image/png;base64,${c.rendered_image}`,hasUnsavedChanges:!0}),console.log(`importText: å›¾ç‰‡ ${w} æ¸²æŸ“æˆåŠŸ`))}catch(Z){console.error(`importText: é‡æ¸²æŸ“å›¾ç‰‡ ${w} å¤±è´¥:`,Z)}}}}u.value=100,p.value="å¯¼å…¥å®Œæˆ";const y=F.length,m=y>0?`å¯¼å…¥æˆåŠŸï¼æ›´æ–°äº† ${_} å¼ å›¾ç‰‡ä¸­çš„ ${K} ä¸ªæ°”æ³¡æ–‡æœ¬ï¼Œé‡æ¸²æŸ“äº† ${y} å¼ å›¾ç‰‡`:`å¯¼å…¥æˆåŠŸï¼æ›´æ–°äº† ${_} å¼ å›¾ç‰‡ä¸­çš„ ${K} ä¸ªæ°”æ³¡æ–‡æœ¬`;s.success(m)}catch(d){console.error("å¯¼å…¥æ–‡æœ¬å‡ºé”™:",d),s.error(`å¯¼å…¥å¤±è´¥: ${d instanceof Error?d.message:String(d)}`)}finally{a.value=!1,setTimeout(()=>{u.value=0,p.value=""},2e3)}}function $(g){return new Promise((d,x)=>{const _=new FileReader;_.onload=K=>{K.target?.result?d(K.target.result):x(new Error("è¯»å–æ–‡ä»¶å¤±è´¥"))},_.onerror=()=>x(new Error("è¯»å–æ–‡ä»¶æ—¶å‡ºé”™")),_.readAsText(g)})}function W(g,d,x,_){const K=t.settings.textStyle;return{coords:[0,0,100,100],polygon:[],originalText:"",translatedText:"",textboxText:"",fontSize:typeof g=="number"?g:25,fontFamily:d,textDirection:"vertical",autoTextDirection:"vertical",textColor:x,fillColor:_,rotationAngle:0,position:{x:0,y:0},strokeEnabled:K.strokeEnabled,strokeColor:K.strokeColor,strokeWidth:K.strokeWidth,inpaintMethod:K.inpaintMethod}}function O(){const g=n.currentImage;if(!g){s.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}const d=g.translatedDataURL||g.originalDataURL;if(!d){s.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}o.value=!0;try{const x=d.split(",")[1];if(!x)throw new Error("æ— æ•ˆçš„å›¾ç‰‡æ•°æ®");const _=atob(x),K=[];for(let R=0;R<_.length;R+=512){const T=_.slice(R,R+512),F=new Array(T.length);for(let m=0;m<T.length;m++)F[m]=T.charCodeAt(m);const y=new Uint8Array(F);K.push(y.buffer)}const V=new Blob(K,{type:"image/png"}),se=URL.createObjectURL(V),X=document.createElement("a");X.href=se;let ie=g.fileName||`image_${n.currentImageIndex}.png`;ie=`${g.translatedDataURL?"translated":"original"}_${ie.replace(/\.[^/.]+$/,"")}.png`,X.download=ie,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(se),s.success(`ä¸‹è½½æˆåŠŸ: ${ie}`)}catch(x){console.error("ä¸‹è½½å›¾ç‰‡æ—¶å‡ºé”™:",x),s.error("ä¸‹è½½å¤±è´¥")}finally{o.value=!1}}async function U(g="zip"){const d=n.images;if(d.length===0){s.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}o.value=!0,i.value=0,r.value="å‡†å¤‡ä¸‹è½½...",s.info("ä¸‹è½½ä¸­...å¤„ç†å¯èƒ½éœ€è¦ä¸€å®šæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…...",0);try{const x=[];let _=0,K=0;i.value=5,r.value="æ£€æŸ¥å›¾ç‰‡æ•°æ®...";for(let m=0;m<d.length;m++){const l=d[m];l&&(l.translatedDataURL?(x.push({index:m,type:"translated"}),_++):l.originalDataURL&&(x.push({index:m,type:"original"}),K++))}if(x.length===0){s.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}i.value=10,r.value="åˆ›å»ºä¸‹è½½ä¼šè¯...";const V=await $s(x.length);if(!V.success||!V.session_id)throw new Error(V.error||"åˆ›å»ºä¼šè¯å¤±è´¥");const se=V.session_id,X=x.length;let ie=0,z=0;for(let m=0;m<x.length;m++){const l=x[m];if(!l)continue;const v=d[l.index];if(!v)continue;const D=l.type==="translated"?v.translatedDataURL:v.originalDataURL;if(!D)continue;const S=10+m/X*70;i.value=S,r.value=`ä¸Šä¼ å›¾ç‰‡ ${m+1}/${X}...`;try{const w=await Ts(se,D,m);w.success?ie++:(console.error(`ä¸Šä¼ å›¾ç‰‡ ${m} å¤±è´¥:`,w.error),z++)}catch(w){console.error(`ä¸Šä¼ å›¾ç‰‡ ${m} å‡ºé”™:`,w),z++}}if(ie===0)throw new Error("æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ å¤±è´¥");i.value=85,r.value="æ‰“åŒ…æ–‡ä»¶...";const R=await Is(se,g);if(!R.success||!R.file_id)throw new Error(R.error||"æ‰“åŒ…å¤±è´¥");i.value=95,r.value="å‡†å¤‡ä¸‹è½½...";const T=Ps(R.file_id,g),F=document.createElement("a");F.href=T,document.body.appendChild(F),F.click(),document.body.removeChild(F),i.value=100,r.value="ä¸‹è½½å·²å¼€å§‹";let y=`å·²æˆåŠŸå¤„ç† ${ie} å¼ å›¾ç‰‡`;z>0&&(y+=`ï¼ˆ${z} å¼ å¤±è´¥ï¼‰`),_>0&&K>0?y+=`ï¼ˆ${_} å¼ ç¿»è¯‘å›¾ç‰‡å’Œ ${K} å¼ åŸå§‹å›¾ç‰‡ï¼‰`:_>0?y+="ï¼ˆå…¨éƒ¨ä¸ºç¿»è¯‘åå›¾ç‰‡ï¼‰":K>0&&(y+="ï¼ˆå…¨éƒ¨ä¸ºåŸå§‹å›¾ç‰‡ï¼‰"),y+="ï¼Œä¸‹è½½å³å°†å¼€å§‹",s.success(y),setTimeout(async()=>{try{const m=await bo();console.log("ä¸´æ—¶æ–‡ä»¶æ¸…ç†ç»“æœ:",m)}catch(m){console.error("æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥:",m)}},6e4)}catch(x){console.error("ä¸‹è½½æ‰€æœ‰å›¾ç‰‡æ—¶å‡ºé”™:",x),s.error(`ä¸‹è½½å¤±è´¥: ${x instanceof Error?x.message:String(x)}`)}finally{o.value=!1,setTimeout(()=>{i.value=0,r.value=""},2e3)}}return{isDownloading:o,downloadProgress:i,downloadProgressText:r,isImporting:a,importProgress:u,importProgressText:p,canExportText:k,canImportText:f,canDownload:P,exportText:A,exportTextToJson:M,importText:B,downloadCurrentImage:O,downloadAllImages:U}}const Ml={key:0,class:"result-section card result-card"},El={class:"image-controls"},Bl={class:"image-size-control"},Al=["value"],Ll={id:"imageSizeValue"},Fl={class:"content-container"},Ul={class:"image-container"},Ol=["src"],zl={id:"detectedTextInfo",class:"text-info"},Nl={id:"detectedTextList"},Vl={class:"original-text"},Wl={class:"download-section"},Kl={class:"download-buttons"},ql=["disabled"],Hl={class:"download-all-container"},jl=["disabled"],Jl={class:"download-format-selector"},Yl=["disabled"],Xl=["disabled"],Gl={key:1,class:"empty-state-section"},ro=60,Zl=je({__name:"ImageResultDisplay",props:{isEditMode:{type:Boolean,default:!1}},emits:["toggle-edit-mode","retry-failed"],setup(n,{emit:t}){const s=[{label:"ZIPå‹ç¼©åŒ…",value:"zip"},{label:"PDFæ–‡æ¡£",value:"pdf"},{label:"CBZæ¼«ç”»",value:"cbz"}],o=t,i=Ze(),r=ze(),a=Dl(),u=C(100),p=j({get:()=>$.value?.showOriginal??!1,set:S=>{$.value&&i.updateCurrentImage({showOriginal:S})}}),k=C("zip"),f=C(null),P=j(()=>a.isDownloading.value),A=j(()=>a.downloadProgressText.value),M=j(()=>a.downloadProgress.value),B=j(()=>i.hasImages),$=j(()=>i.currentImage),W=j(()=>!!$.value?.translatedDataURL),O=j(()=>!!($.value?.translatedDataURL||$.value?.originalDataURL)),U=j(()=>$.value?p.value||!$.value.translatedDataURL?$.value.originalDataURL:$.value.translatedDataURL:""),g=j(()=>i.failedImageCount>0),d=j(()=>({width:`${u.value}%`})),x=j(()=>r.settings.useTextboxPrompt),_=j(()=>{if(!$.value)return[];if($.value.bubbleStates&&$.value.bubbleStates.length>0)return $.value.bubbleStates.map(N=>({original:N.originalText||"",translated:x.value?N.textboxText||N.translatedText||"":N.translatedText||""}));const S=$.value.originalTexts||[],w=x.value?$.value.textboxTexts||$.value.bubbleTexts||[]:$.value.bubbleTexts||[];return S.length===0?[]:S.map((N,Z)=>({original:N||"",translated:w[Z]||""}))}),K=j(()=>_.value.length>0);function V(S){if(!S||S.length<=ro)return S;let w="",N="";for(let Z=0;Z<S.length;Z++)if(N+=S[Z],N.length>=ro){let Y=-1;for(let c=N.length-1;c>=0;c--){const h=N[c];if(h&&["ã€‚","ï¼","ï¼Ÿ",".","!","?","ï¼›",";","ï¼Œ",","].includes(h)){Y=c+1;break}}Y>ro*.6?(w+=N.substring(0,Y)+`
`,N=N.substring(Y)):(w+=N+`
`,N="")}return N&&(w+=N),w}function se(S){return V((S||"").trim())}function X(S){const w=(S||"").trim();return V(w)}function ie(S){return(S||"").includes("ç¿»è¯‘å¤±è´¥")}function z(){p.value=!p.value}function R(){o("toggle-edit-mode")}function T(S){const w=S.target;u.value=parseInt(w.value,10)}function F(){o("retry-failed")}function y(){a.downloadCurrentImage()}function m(){a.downloadAllImages(k.value)}function l(){a.exportText()}function v(){f.value?.click()}async function D(S){const w=S.target,N=w.files?.[0];N&&(await a.importText(N),w.value="")}return(S,w)=>$.value?(E(),L("section",Ml,[e("div",El,[W.value?(E(),L("button",{key:0,id:"toggleImageButton",class:"control-btn",onClick:z},ne(p.value?"æŸ¥çœ‹ç¿»è¯‘å›¾":"æŸ¥çœ‹åŸå›¾"),1)):de("",!0),e("button",{id:"toggleEditModeButton",class:Ie(["control-btn",{active:n.isEditMode}]),onClick:R},ne(n.isEditMode?"é€€å‡ºç¼–è¾‘":"åˆ‡æ¢ç¼–è¾‘æ¨¡å¼"),3),e("div",Bl,[w[1]||(w[1]=e("label",{for:"imageSize"},"å›¾ç‰‡å¤§å°:",-1)),e("input",{type:"range",id:"imageSize",min:"50",max:"200",value:u.value,class:"slider range-slider",onInput:T},null,40,Al),e("span",Ll,ne(u.value)+"%",1)]),g.value?(E(),L("button",{key:1,id:"retranslateFailedButton",class:"retry-failed-btn",onClick:F,title:"é‡æ–°ç¿»è¯‘æ‰€æœ‰å¤±è´¥çš„å›¾ç‰‡"}," é‡æ–°ç¿»è¯‘å¤±è´¥å›¾ç‰‡ ("+ne(q(i).failedImageCount)+") ",1)):de("",!0)]),e("div",Fl,[e("div",Ul,[e("img",{id:"translatedImageDisplay",src:U.value,alt:"ç¿»è¯‘åå›¾ç‰‡",style:ot(d.value)},null,12,Ol)])]),e("div",zl,[w[6]||(w[6]=e("h3",null,"æ£€æµ‹åˆ°çš„æ–‡æœ¬ï¼ˆåŸæ–‡ â†’ è¯‘æ–‡ï¼‰",-1)),e("pre",Nl,[K.value?(E(!0),L(Oe,{key:0},Ye(_.value,(N,Z)=>(E(),L("span",{key:Z,class:"text-item"},[e("span",Vl,ne(se(N.original)),1),w[2]||(w[2]=pe(`
`,-1)),e("span",{class:Ie(["translated-text",{"translation-error":ie(N.translated)}])},ne(X(N.translated)),3),w[3]||(w[3]=pe(`
`,-1)),w[4]||(w[4]=e("span",{class:"separator"},"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",-1)),w[5]||(w[5]=pe(`

`,-1))]))),128)):(E(),L(Oe,{key:1},[pe("æœªæ£€æµ‹åˆ°æ–‡æœ¬æˆ–å°šæœªç¿»è¯‘")],64))])]),e("div",Wl,[P.value?(E(),it(_o,{key:0,visible:!0,percentage:M.value,label:A.value||"ä¸‹è½½ä¸­ï¼Œè¯·ç¨å€™..."},null,8,["percentage","label"])):de("",!0),e("div",Kl,[e("button",{id:"downloadButton",class:"download-btn primary",disabled:!O.value,onClick:y}," ä¸‹è½½å½“å‰å›¾ç‰‡ ",8,ql),e("div",Hl,[e("button",{id:"downloadAllImagesButton",class:"download-btn primary",disabled:!B.value,onClick:m}," ä¸‹è½½æ‰€æœ‰å›¾ç‰‡ ",8,jl),e("div",Jl,[Ce(Ke,{modelValue:k.value,"onUpdate:modelValue":w[0]||(w[0]=N=>k.value=N),options:s},null,8,["modelValue"])])]),e("button",{id:"exportTextButton",class:"download-btn success",disabled:!B.value,onClick:l}," å¯¼å‡ºæ–‡æœ¬ ",8,Yl),e("button",{id:"importTextButton",class:"download-btn success",disabled:!B.value,onClick:v}," å¯¼å…¥æ–‡æœ¬ ",8,Xl),e("input",{type:"file",ref_key:"importFileInput",ref:f,id:"importTextFileInput",style:{display:"none"},accept:".json",onChange:D},null,544)])])])):(E(),L("section",Gl))}}),Ql=He(Zl,[["__scopeId","data-v-a26b9c58"]]),ei={class:"guide-content"},ti={class:"guide-footer"},oi={class:"dont-show-option"},zt="saber_translator_dismiss_setup_reminder",ni=je({__name:"FirstTimeGuide",emits:["openSettings"],setup(n,{expose:t,emit:s}){const o=s,i=C(!1),r=C(!1);ut(()=>{localStorage.getItem(zt)!=="true"&&(i.value=!0)});function a(){r.value&&localStorage.setItem(zt,"true"),i.value=!1}function u(){localStorage.setItem(zt,"true"),i.value=!1,o("openSettings")}function p(){localStorage.removeItem(zt)}return t({resetGuideState:p,showGuide:i}),(k,f)=>(E(),it(xn,{"model-value":i.value,title:"æ¬¢è¿ä½¿ç”¨ Saber-Translator",onClose:a},{default:_t(()=>[e("div",ei,[f[3]||(f[3]=e("div",{class:"guide-icon"},"ğŸ‰",-1)),f[4]||(f[4]=e("div",{class:"guide-message"},[e("p",{class:"guide-title"},"é¦–æ¬¡ä½¿ç”¨æé†’"),e("p",{class:"guide-text"}," åœ¨å¼€å§‹ç¿»è¯‘ä¹‹å‰ï¼Œè¯·å…ˆé…ç½®ç¿»è¯‘æœåŠ¡ã€‚ "),e("p",{class:"guide-text"},[pe(" ç‚¹å‡»å³ä¸Šè§’çš„ "),e("span",{class:"highlight"},"âš™ï¸ è®¾ç½®"),pe(" æŒ‰é’®ï¼Œé…ç½®ä»¥ä¸‹å†…å®¹ï¼š ")]),e("ul",{class:"guide-list"},[e("li",null,"é€‰æ‹© OCR å¼•æ“ï¼ˆæ–‡å­—è¯†åˆ«ï¼‰"),e("li",null,"é…ç½®ç¿»è¯‘æœåŠ¡å•†å’Œ API Key"),e("li",null,"ï¼ˆå¯é€‰ï¼‰é…ç½®é«˜è´¨é‡ç¿»è¯‘å’Œ AI æ ¡å¯¹")])],-1)),e("div",{class:"guide-actions"},[e("button",{class:"guide-btn primary",onClick:u},[...f[1]||(f[1]=[e("span",{class:"btn-icon"},"âš™ï¸",-1),pe(" ç«‹å³é…ç½® ",-1)])]),e("button",{class:"guide-btn secondary",onClick:a}," ç¨åé…ç½® ")]),e("div",ti,[e("label",oi,[ae(e("input",{type:"checkbox","onUpdate:modelValue":f[0]||(f[0]=P=>r.value=P)},null,512),[[et,r.value]]),f[2]||(f[2]=e("span",null,"ä¸å†æ˜¾ç¤ºæ­¤æé†’",-1))])])])]),_:1},8,["model-value"]))}}),si=He(ni,[["__scopeId","data-v-eda18e4a"]]),uo="saber_translator_dismiss_setup_reminder",ai=["siliconflow","deepseek","volcano","caiyun","baidu_translate","youdao_translate","gemini","custom_openai"],li={manga_ocr:"MangaOCR",paddle_ocr:"PaddleOCR",baidu_ocr:"ç™¾åº¦OCR",ai_vision:"AIè§†è§‰OCR"},ii=["ollama","sakura"],ri=["custom_openai"],ui=["custom_openai"],ci={siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",caiyun:"å½©äº‘å°è¯‘",baidu_translate:"ç™¾åº¦ç¿»è¯‘",youdao_translate:"æœ‰é“ç¿»è¯‘",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰ OpenAI",ollama:"Ollama",sakura:"Sakura"};function $n(){const n=ze(),t=rt(),s=C(!1),o=C(!1),i=j(()=>{try{return localStorage.getItem(uo)==="true"}catch{return!1}});function r(_){return ci[_]||_}function a(_){return ai.includes(_)}function u(_){return ii.includes(_)}function p(_){return ri.includes(_)}function k(_){return ui.includes(_)}function f(_){return li[_]||_}function P(){const _=n.settings,K=_.ocrEngine,V=_.baiduOcr,se=_.aiVisionOcr,X=[];return K?(K==="baidu_ocr"&&((!V?.apiKey||V.apiKey.trim()==="")&&X.push("ç™¾åº¦OCR çš„ API Key"),(!V?.secretKey||V.secretKey.trim()==="")&&X.push("ç™¾åº¦OCR çš„ Secret Key")),K==="ai_vision"&&(se?.provider||X.push("AIè§†è§‰OCR çš„æœåŠ¡å•†"),(!se?.apiKey||se.apiKey.trim()==="")&&X.push("AIè§†è§‰OCR çš„ API Key"),(!se?.modelName||se.modelName.trim()==="")&&X.push("AIè§†è§‰OCR çš„æ¨¡å‹åç§°"),se?.provider==="custom"&&(!se?.customBaseUrl||se.customBaseUrl.trim()==="")&&X.push("AIè§†è§‰OCR çš„è‡ªå®šä¹‰ Base URL")),X.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${X[0]}`,missingItems:X}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹© OCR å¼•æ“",missingItems:["OCR å¼•æ“"]}}function A(){const{translation:_}=n.settings,{provider:K,apiKey:V,modelName:se,customBaseUrl:X}=_,ie=[];return K?(a(K)&&(!V||V.trim()==="")&&ie.push(`${r(K)} çš„ API Key`),(!se||se.trim()==="")&&(u(K)||a(K))&&ie.push(`${r(K)} çš„æ¨¡å‹åç§°`),p(K)&&(!X||X.trim()==="")&&ie.push("è‡ªå®šä¹‰ OpenAI æœåŠ¡çš„ Base URL"),ie.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${ie[0]}`,missingItems:ie}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹©ç¿»è¯‘æœåŠ¡å•†",missingItems:["ç¿»è¯‘æœåŠ¡å•†"]}}function M(){const{hqTranslation:_}=n.settings,{provider:K,apiKey:V,modelName:se,customBaseUrl:X}=_,ie=[];return K?((!V||V.trim()==="")&&ie.push("é«˜è´¨é‡ç¿»è¯‘çš„ API Key"),(!se||se.trim()==="")&&ie.push("é«˜è´¨é‡ç¿»è¯‘çš„æ¨¡å‹åç§°"),k(K)&&(!X||X.trim()==="")&&ie.push("é«˜è´¨é‡ç¿»è¯‘çš„ Base URL"),ie.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${ie[0]}`,missingItems:ie}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹©é«˜è´¨é‡ç¿»è¯‘çš„æœåŠ¡å•†",missingItems:["é«˜è´¨é‡ç¿»è¯‘æœåŠ¡å•†"]}}function B(_){const K=_||n.settings.proofreading.rounds,V=[];if(!K||K.length===0)return{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­æ·»åŠ è‡³å°‘ä¸€ä¸ªæ ¡å¯¹è½®æ¬¡",missingItems:["æ ¡å¯¹è½®æ¬¡"]};for(let se=0;se<K.length;se++){const X=K[se];if(!X)continue;const ie=X.name||`è½®æ¬¡${se+1}`;if(X.provider||V.push(`æ ¡å¯¹ ${ie} çš„æœåŠ¡å•†`),(!X.apiKey||X.apiKey.trim()==="")&&V.push(`æ ¡å¯¹ ${ie} çš„ API Key`),(!X.modelName||X.modelName.trim()==="")&&V.push(`æ ¡å¯¹ ${ie} çš„æ¨¡å‹åç§°`),V.length>0)return{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­ä¸º ${V[0]}`,missingItems:V}}return{valid:!0,message:""}}function $(_="normal",K={}){let V;switch(_){case"normal":V=A();break;case"hq":V=M();break;case"proofread":V=B(K.proofreadingRounds);break;case"ocr":V=P();break;default:V=A()}return V.valid?!0:(t.error(V.message),O(),!1)}function W(){const _=P();if(!_.valid)return t.error(_.message),O(),!1;const K=A();return K.valid?!0:(t.error(K.message),O(),!1)}function O(){const _=document.getElementById("openSettingsBtn");_&&(o.value=!0,_.style.animation="settingsBtnPulse 0.5s ease-in-out 3",_.style.boxShadow="0 0 10px var(--primary-color, #4a90d9)",setTimeout(()=>{_.style.animation="",_.style.boxShadow="",o.value=!1},3e3))}function U(){if(i.value){console.log("ç”¨æˆ·å·²é€‰æ‹©ä¸å†æ˜¾ç¤ºè®¾ç½®æé†’");return}s.value=!0}function g(_=!1){if(_)try{localStorage.setItem(uo,"true"),console.log("ç”¨æˆ·é€‰æ‹©æ°¸ä¹…å…³é—­è®¾ç½®æé†’")}catch(K){console.error("ä¿å­˜è®¾ç½®æé†’çŠ¶æ€å¤±è´¥:",K)}s.value=!1}function d(){try{localStorage.removeItem(uo),console.log("è®¾ç½®æé†’çŠ¶æ€å·²é‡ç½®")}catch(_){console.error("é‡ç½®è®¾ç½®æé†’çŠ¶æ€å¤±è´¥:",_)}}function x(){setTimeout(()=>{U()},500)}return{showSetupReminder:s,isSettingsButtonHighlighted:o,isSetupReminderDismissed:i,validateOcrConfig:P,validateTranslationConfig:A,validateHqTranslationConfig:M,validateProofreadingConfig:B,validateBeforeTranslation:$,validateFullTranslationConfig:W,highlightSettingsButton:O,checkAndShowSetupReminder:U,closeSetupReminder:g,resetSetupReminderDismiss:d,initValidation:x,getProviderDisplayName:r,getOcrEngineDisplayName:f,requiresApiKey:a,isLocalProvider:u,requiresBaseUrl:p}}const ct=Ht("bubble",()=>{const n=C([]),t=C(-1),s=C([]),o=C([]),i=C(!1),r=C(-1),a=C(0),u=C(0),p=C(0),k=C(0),f=C(!1),P=C(-1),A=C(null),M=C(!1),B=C(-1),$=C(0),W=j(()=>t.value>=0&&t.value<n.value.length?n.value[t.value]??null:null),O=j(()=>n.value.length),U=j(()=>n.value.length>0),g=j(()=>t.value>=0),d=j(()=>s.value.length>1),x=j(()=>s.value.filter(I=>I>=0&&I<n.value.length).map(I=>n.value[I]).filter(I=>I!==void 0));function _(){const G=Ze().currentImage;G&&(G.bubbleStates=Ot(n.value),G.hasUnsavedChanges=!0,console.log("æ°”æ³¡çŠ¶æ€å·²åŒæ­¥åˆ°å½“å‰å›¾ç‰‡"))}function K(I,G=!1){n.value=I,o.value=Ot(I),F(),console.log(`æ°”æ³¡æ•°ç»„å·²è®¾ç½®ï¼Œå…± ${I.length} ä¸ªæ°”æ³¡`),G||_()}function V(I,G){const re=ta(I),De=ze().settings.textStyle,Te=De.layoutDirection,he=Te==="vertical"||Te==="horizontal"?Te:re==="vertical"||re==="horizontal"?re:"vertical",ee=ea({coords:I,translatedText:"",autoTextDirection:re,fontSize:De.fontSize,fontFamily:De.fontFamily,textDirection:he,textColor:De.textColor,fillColor:De.fillColor,inpaintMethod:De.inpaintMethod,strokeEnabled:De.strokeEnabled,strokeColor:De.strokeColor,strokeWidth:De.strokeWidth,rotationAngle:0,position:{x:0,y:0},...G});return n.value.push(ee),console.log(`å·²æ·»åŠ æ°”æ³¡ï¼Œå½“å‰å…± ${n.value.length} ä¸ª`),_(),ee}function se(I){return I<0||I>=n.value.length?(console.warn(`åˆ é™¤å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${I}`),!1):(n.value.splice(I,1),t.value===I?t.value=-1:t.value>I&&t.value--,s.value=s.value.filter(G=>G!==I).map(G=>G>I?G-1:G),console.log(`å·²åˆ é™¤æ°”æ³¡ï¼Œå½“å‰å…± ${n.value.length} ä¸ª`),_(),!0)}function X(){if(s.value.length===0&&t.value<0)return;const I=[...new Set([...s.value,t.value])].filter(G=>G>=0).sort((G,re)=>re-G);for(const G of I)n.value.splice(G,1);F(),console.log(`å·²åˆ é™¤ ${I.length} ä¸ªæ°”æ³¡`),_()}function ie(){n.value=[],o.value=[],F(),console.log("æ‰€æœ‰æ°”æ³¡å·²æ¸…é™¤"),_()}function z(){n.value=[],o.value=[],F(),console.log("æœ¬åœ°æ°”æ³¡çŠ¶æ€å·²æ¸…é™¤ï¼ˆä¸åŒæ­¥åˆ°imageStoreï¼‰")}function R(I){I>=-1&&I<n.value.length&&(t.value=I,s.value=I>=0?[I]:[],console.log(`å·²é€‰ä¸­æ°”æ³¡ ${I}`))}function T(I){if(I<0||I>=n.value.length)return;const G=s.value.indexOf(I);G>=0?(s.value.splice(G,1),t.value===I&&(t.value=s.value[0]??-1)):(s.value.push(I),t.value=I),console.log(`å¤šé€‰çŠ¶æ€: ${s.value.join(", ")}`)}function F(){t.value=-1,s.value=[]}function y(){t.value>=0?s.value=[t.value]:s.value=[]}function m(){if(n.value.length===0)return!1;const I=t.value<n.value.length-1?t.value+1:0;return R(I),!0}function l(){if(n.value.length===0)return!1;const I=t.value>0?t.value-1:n.value.length-1;return R(I),!0}function v(I,G){if(I<0||I>=n.value.length)return console.warn(`æ›´æ–°å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${I}`),!1;const re=n.value[I];return re?(Object.assign(re,G),console.log(`å·²æ›´æ–°æ°”æ³¡ ${I}`),_(),!0):!1}function D(I){return t.value<0?(console.warn("æ›´æ–°å¤±è´¥: æ²¡æœ‰é€‰ä¸­çš„æ°”æ³¡"),!1):v(t.value,I)}function S(I){const G=s.value.length>0?s.value:t.value>=0?[t.value]:[];for(const re of G){const ke=n.value[re];ke&&Object.assign(ke,I)}_(),console.log(`å·²æ‰¹é‡æ›´æ–° ${G.length} ä¸ªæ°”æ³¡`)}function w(I){for(let G=0;G<n.value.length;G++){const re=n.value[G];re&&Object.assign(re,I)}_(),console.log(`å·²æ›´æ–°æ‰€æœ‰ ${n.value.length} ä¸ªæ°”æ³¡`)}function N(){if(n.value.length!==o.value.length)return!0;for(let I=0;I<n.value.length;I++){const G=n.value[I],re=o.value[I];if(!(!G||!re)&&(G.translatedText!==re.translatedText||G.textboxText!==re.textboxText||G.fontSize!==re.fontSize||G.fontFamily!==re.fontFamily||G.textDirection!==re.textDirection||G.textColor!==re.textColor||G.fillColor!==re.fillColor||G.rotationAngle!==re.rotationAngle||G.strokeEnabled!==re.strokeEnabled||G.strokeColor!==re.strokeColor||G.strokeWidth!==re.strokeWidth||G.inpaintMethod!==re.inpaintMethod||JSON.stringify(G.coords)!==JSON.stringify(re.coords)))return!0}return!1}function Z(){n.value=Ot(o.value),F(),console.log("æ°”æ³¡çŠ¶æ€å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€")}function Y(){o.value=Ot(n.value),console.log("å½“å‰çŠ¶æ€å·²ä¿å­˜ä¸ºåˆå§‹çŠ¶æ€")}function c(){return{bubble_coords:n.value.map(I=>I.coords),bubble_texts:n.value.map(I=>I.translatedText),textbox_texts:n.value.map(I=>I.textboxText),font_sizes:n.value.map(I=>I.fontSize),font_families:n.value.map(I=>I.fontFamily),text_directions:n.value.map(I=>I.textDirection==="vertical"||I.textDirection==="horizontal"?I.textDirection==="vertical"?"v":"h":I.autoTextDirection==="vertical"||I.autoTextDirection==="horizontal"?I.autoTextDirection==="vertical"?"v":"h":"v"),text_colors:n.value.map(I=>I.textColor),fill_colors:n.value.map(I=>I.fillColor),rotation_angles:n.value.map(I=>I.rotationAngle),stroke_enabled:n.value.map(I=>I.strokeEnabled),stroke_colors:n.value.map(I=>I.strokeColor),stroke_widths:n.value.map(I=>I.strokeWidth),inpaint_methods:n.value.map(I=>I.inpaintMethod)}}function h(){return JSON.stringify(n.value)}function le(I){try{const G=JSON.parse(I);if(!Array.isArray(G))return console.error("ååºåˆ—åŒ–å¤±è´¥: æ•°æ®ä¸æ˜¯æ•°ç»„"),!1;const re=[];for(const ke of G)oa(ke)?re.push(ke):console.warn("è·³è¿‡æ— æ•ˆçš„æ°”æ³¡çŠ¶æ€:",ke);return K(re),!0}catch(G){return console.error("ååºåˆ—åŒ–å¤±è´¥:",G),!1}}return{bubbles:n,selectedIndex:t,selectedIndices:s,initialStates:o,isDragging:i,draggingIndex:r,dragOffsetX:a,dragOffsetY:u,dragInitialX:p,dragInitialY:k,isResizing:f,resizingIndex:P,resizeCurrentCoords:A,isRotating:M,rotatingIndex:B,rotateCurrentAngle:$,selectedBubble:W,bubbleCount:O,hasBubbles:U,hasSelection:g,isMultiSelect:d,selectedBubbles:x,setBubbles:K,addBubble:V,deleteBubble:se,deleteSelected:X,clearBubbles:ie,clearBubblesLocal:z,selectBubble:R,toggleMultiSelect:T,clearSelection:F,clearMultiSelect:y,selectNext:m,selectPrevious:l,updateBubble:v,updateSelectedBubble:D,updateAllSelected:S,updateAllBubbles:w,hasChanges:N,resetToInitial:Z,saveAsInitial:Y,toApiRequest:c,serialize:h,deserialize:le}}),di=Object.freeze(Object.defineProperty({__proto__:null,useBubbleStore:ct},Symbol.toStringTag,{value:"Module"}));function gi(){const n=C({current:0,total:0,completed:0,failed:0,isInProgress:!1,label:"",percentage:0});return{progress:n,reporter:{init(s,o){n.value={current:0,total:s,completed:0,failed:0,isInProgress:!0,label:o||"å‡†å¤‡ä¸­...",percentage:0}},update(s,o){n.value.current=s,o!==void 0&&(n.value.label=o),n.value.total>0&&(n.value.percentage=Math.round(s/n.value.total*100))},setPercentage(s,o){n.value.percentage=Math.min(100,Math.max(0,s)),o!==void 0&&(n.value.label=o)},incrementCompleted(){n.value.completed++},incrementFailed(){n.value.failed++},finish(){n.value.isInProgress=!1,n.value.percentage=100},getProgress(){return{...n.value}}}}}async function Tn(n){return Xe.post("/api/parallel/detect",n)}async function In(n){return Xe.post("/api/parallel/ocr",n)}async function Pn(n){return Xe.post("/api/parallel/color",n)}async function Rn(n){return Xe.post("/api/parallel/translate",n)}async function Dn(n){return Xe.post("/api/parallel/inpaint",n)}async function Mn(n){return Xe.post("/api/parallel/render",n)}let $t=null,At=!1;function It(){const n=Tt();return ze().settings.autoSaveInBookshelfMode&&n.isBookshelfMode}function Co(){const n=Tt(),t=n.currentBookId,s=n.currentChapterId;return!t||!s?null:`bookshelf/${t}/${s}`}function En(){const n=ze(),{textStyle:t}=n.settings;return{fontSize:t.fontSize,autoFontSize:t.autoFontSize,fontFamily:t.fontFamily,layoutDirection:t.layoutDirection,textColor:t.textColor,useInpaintingMethod:t.inpaintMethod,fillColor:t.fillColor,strokeEnabled:t.strokeEnabled,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,useAutoTextColor:t.useAutoTextColor}}async function Bn(n){const t=Ze();if(!It())return console.log("[AutoSave] è‡ªåŠ¨ä¿å­˜æœªå¯ç”¨æˆ–éä¹¦æ¶æ¨¡å¼ï¼Œè·³è¿‡é¢„ä¿å­˜"),!0;const s=Co();if(!s)return console.warn("[AutoSave] ç¼ºå°‘ä¹¦ç±/ç« èŠ‚IDï¼Œè·³è¿‡é¢„ä¿å­˜"),n?.onError?.("ç¼ºå°‘ä¹¦ç±/ç« èŠ‚ID"),!1;const o=t.images,i=o.length;if(i===0)return console.warn("[AutoSave] æ²¡æœ‰å›¾ç‰‡ï¼Œè·³è¿‡é¢„ä¿å­˜"),n?.onError?.("æ²¡æœ‰å›¾ç‰‡"),!1;console.log(`[AutoSave] é¢„ä¿å­˜å¼€å§‹ï¼š${i} é¡µï¼ˆé€é¡µä¿å­˜ï¼‰`),n?.onStart?.(i);try{const{saveAllPagesSequentially:r,saveSessionMeta:a}=await lt(async()=>{const{saveAllPagesSequentially:A,saveSessionMeta:M}=await Promise.resolve().then(()=>wn);return{saveAllPagesSequentially:A,saveSessionMeta:M}},void 0),u=En(),p=await r(s,o,{onProgress:(A,M)=>{n?.onProgress?.(A,M)}});await a(s,{ui_settings:u,total_pages:i,currentImageIndex:t.currentImageIndex});const k=Tt(),f=k.currentBookId,P=k.currentChapterId;if(f&&P)try{const{apiClient:A}=await lt(async()=>{const{apiClient:M}=await import("./client.Bht704G-.js");return{apiClient:M}},__vite__mapDeps([4,5]));await A.put(`/api/bookshelf/books/${f}/chapters/${P}/image-count`,{count:i}),console.log(`[AutoSave] å·²æ›´æ–°ç« èŠ‚å›¾ç‰‡æ•°é‡ä¸º ${i}`)}catch(A){console.warn("[AutoSave] æ›´æ–°ç« èŠ‚å›¾ç‰‡æ•°é‡å¤±è´¥ï¼ˆéè‡´å‘½ï¼‰:",A)}return $t=s,At=!0,console.log(`[AutoSave] é¢„ä¿å­˜å®Œæˆï¼Œå…±ä¿å­˜ ${p}/${i} é¡µ`),n?.onComplete?.(),!0}catch(r){console.error("[AutoSave] é¢„ä¿å­˜å¤±è´¥:",r);const a=r instanceof Error?r.message:"é¢„ä¿å­˜å¤±è´¥";return n?.onError?.(a),$t=null,At=!1,!1}}async function An(n){if(!It())return;const t=$t||Co();if(!t){console.warn("[AutoSave] ä¼šè¯è·¯å¾„ä¸å­˜åœ¨ï¼Œè·³è¿‡ä¿å­˜");return}const s=Ze(),o=s.images[n];if(!o){console.warn(`[AutoSave] é¡µé¢ ${n} ä¸å­˜åœ¨`);return}try{const i={};o.translatedDataURL?.startsWith("data:")&&(i.translated=o.translatedDataURL),o.cleanImageData&&typeof o.cleanImageData=="string"&&!o.cleanImageData.startsWith("/api/")&&(i.clean=o.cleanImageData.startsWith("data:")?o.cleanImageData:`data:image/png;base64,${o.cleanImageData}`);const r={};for(const u of Object.keys(o))["originalDataURL","translatedDataURL","cleanImageData"].includes(u)||(r[u]=o[u]);i.meta=r;const a=await kn(t,n,i);if(!a.success)throw new Error(a.error||"ä¿å­˜å¤±è´¥");s.updateImageByIndex(n,{hasUnsavedChanges:!1}),console.log(`[AutoSave] é¡µé¢ ${n+1} å·²ä¿å­˜`)}catch(i){throw console.error(`[AutoSave] ä¿å­˜é¡µé¢ ${n+1} å¤±è´¥:`,i),i}}async function Ln(){if(!It())return;const n=$t||Co();if(!n||!At){console.log("[AutoSave] æœªæ‰§è¡Œé¢„ä¿å­˜ï¼Œè·³è¿‡å®Œæˆä¿å­˜");return}console.log("[AutoSave] å®Œæˆä¿å­˜...");const t=Ze(),s=Tt(),o=t.images.length;try{await Cn(n,{ui_settings:En(),total_pages:o,currentImageIndex:t.currentImageIndex});const i=s.currentBookId,r=s.currentChapterId;if(i&&r)try{const{apiClient:a}=await lt(async()=>{const{apiClient:u}=await import("./client.Bht704G-.js");return{apiClient:u}},__vite__mapDeps([4,5]));await a.put(`/api/bookshelf/books/${i}/chapters/${r}/image-count`,{count:o}),console.log(`[AutoSave] å·²æ›´æ–°ç« èŠ‚å›¾ç‰‡æ•°é‡ä¸º ${o}`)}catch(a){console.warn("[AutoSave] æ›´æ–°ç« èŠ‚å›¾ç‰‡æ•°é‡å¤±è´¥ï¼ˆéè‡´å‘½ï¼‰:",a)}console.log("[AutoSave] ä¼šè¯ä¿å­˜å®Œæˆ")}catch(i){console.error("[AutoSave] å®Œæˆä¿å­˜å¤±è´¥:",i)}finally{$t=null,At=!1}}function Fn(){$t=null,At=!1,console.log("[AutoSave] ä¿å­˜çŠ¶æ€å·²é‡ç½®")}const rn={standard:["detection","ocr","color","translate","inpaint","render"],hq:["detection","ocr","color","aiTranslate","inpaint","render"],proofread:["aiTranslate","render"],removeText:["detection","inpaint","render"]},Nt={detection:"æ°”æ³¡æ£€æµ‹",ocr:"æ–‡å­—è¯†åˆ«",color:"é¢œè‰²æå–",translate:"ç¿»è¯‘",aiTranslate:"AIç¿»è¯‘",inpaint:"èƒŒæ™¯ä¿®å¤",render:"æ¸²æŸ“",save:"ä¿å­˜"};function pi(){const n=Ze(),t=ct(),s=ze(),o=$n(),i=rt(),{progress:r,reporter:a}=gi(),u=C(!1),p=C(null);let k=null,f="standard";const P=j(()=>u.value||n.isBatchTranslationInProgress),A=j(()=>r.value.percentage||0);function M(){const l=s.settings.translation.rpmLimit;p.value?p.value.setRpm(l):p.value=na(l)}function B(l){const v=l.mode==="hq"?"hq":l.mode==="proofread"?"proofread":l.mode==="removeText"?"ocr":"normal";return o.validateBeforeTranslation(v)}function $(){const{textStyle:l}=s.settings,v=l.layoutDirection;k={fontFamily:l.fontFamily,fontSize:l.fontSize,autoFontSize:l.autoFontSize,autoTextDirection:v==="auto",textDirection:v==="auto"?"vertical":v,layoutDirection:v,fillColor:l.fillColor,textColor:l.textColor,rotationAngle:0,strokeEnabled:l.strokeEnabled,strokeColor:l.strokeColor,strokeWidth:l.strokeWidth,useAutoTextColor:l.useAutoTextColor}}function W(l){return l.includes("base64,")?l.split("base64,")[1]||"":l}function O(l){const v=n.images;if(l.scope==="current"){const D=n.currentImage;return D?[{image:D,index:n.currentImageIndex}]:[]}if(l.scope==="failed")return n.getFailedImageIndices().map(D=>({image:v[D],index:D})).filter(D=>D.image!==void 0);if(l.scope==="range"&&l.pageRange){const D=Math.max(0,l.pageRange.startPage-1),S=Math.min(v.length-1,l.pageRange.endPage-1);return D>S||D>=v.length?[]:v.slice(D,S+1).map((w,N)=>({image:w,index:D+N}))}return v.map((D,S)=>({image:D,index:S}))}async function U(l){const v=s.settings,D=W(l.image.originalDataURL),S=await Tn({image:D,detector_type:v.textDetector,box_expand_ratio:v.boxExpand.ratio,box_expand_top:v.boxExpand.top,box_expand_bottom:v.boxExpand.bottom,box_expand_left:v.boxExpand.left,box_expand_right:v.boxExpand.right});if(!S.success)throw new Error(S.error||"æ£€æµ‹å¤±è´¥");l.bubbleCoords=S.bubble_coords||[],l.bubbleAngles=S.bubble_angles||[],l.bubblePolygons=S.bubble_polygons||[],l.autoDirections=S.auto_directions||[],l.rawMask=S.raw_mask,l.textlinesPerBubble=S.textlines_per_bubble||[]}async function g(l){if(l.bubbleCoords.length===0){l.originalTexts=[];return}const v=s.settings,D=W(l.image.originalDataURL),S=await In({image:D,bubble_coords:l.bubbleCoords,source_language:v.sourceLanguage,ocr_engine:v.ocrEngine,baidu_api_key:v.baiduOcr?.apiKey,baidu_secret_key:v.baiduOcr?.secretKey,baidu_version:v.baiduOcr?.version,baidu_ocr_language:v.baiduOcr?.sourceLanguage,ai_vision_provider:v.aiVisionOcr?.provider,ai_vision_api_key:v.aiVisionOcr?.apiKey,ai_vision_model_name:v.aiVisionOcr?.modelName,ai_vision_ocr_prompt:v.aiVisionOcr?.prompt,custom_ai_vision_base_url:v.aiVisionOcr?.customBaseUrl,textlines_per_bubble:l.textlinesPerBubble});if(!S.success)throw new Error(S.error||"OCRå¤±è´¥");l.originalTexts=S.original_texts||[]}async function d(l){if(l.bubbleCoords.length===0){l.colors=[];return}const v=W(l.image.originalDataURL),D=await Pn({image:v,bubble_coords:l.bubbleCoords,textlines_per_bubble:l.textlinesPerBubble});if(!D.success)throw new Error(D.error||"é¢œè‰²æå–å¤±è´¥");l.colors=D.colors||[]}async function x(l){if(l.originalTexts.length===0){l.translatedTexts=[],l.textboxTexts=[];return}const v=s.settings,D=await Rn({original_texts:l.originalTexts,target_language:v.targetLanguage,source_language:v.sourceLanguage,model_provider:v.translation.provider,model_name:v.translation.modelName,api_key:v.translation.apiKey,custom_base_url:v.translation.customBaseUrl,prompt_content:v.translatePrompt,textbox_prompt_content:v.textboxPrompt,use_textbox_prompt:v.useTextboxPrompt,rpm_limit:v.translation.rpmLimit,max_retries:v.translation.maxRetries,use_json_format:v.translation.isJsonMode});if(!D.success)throw new Error(D.error||"ç¿»è¯‘å¤±è´¥");l.translatedTexts=D.translated_texts||[],l.textboxTexts=D.textbox_texts||[]}async function _(l){const v=s.settings,D=f==="proofread",S=l.map(he=>D?{imageIndex:he.imageIndex,bubbles:(he.image.bubbleStates||[]).map((ee,b)=>({bubbleIndex:b,original:ee.originalText||"",translated:v.useTextboxPrompt?ee.textboxText||ee.translatedText||"":ee.translatedText||"",textDirection:ee.textDirection==="vertical"||ee.textDirection==="horizontal"?ee.textDirection:ee.autoTextDirection==="vertical"||ee.autoTextDirection==="horizontal"?ee.autoTextDirection:"vertical"}))}:{imageIndex:he.imageIndex,bubbles:he.originalTexts.map((ee,b)=>({bubbleIndex:b,original:ee,translated:"",textDirection:he.autoDirections[b]||"vertical"}))}),w=l.map(he=>{const ee=D&&he.image.translatedDataURL||he.image.originalDataURL;return W(ee)}),N=D?v.proofreading.rounds[0]:v.hqTranslation,Z=D?N?.prompt:v.hqTranslation.prompt,Y=D?"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘æ ¡å¯¹åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹æ£€æŸ¥å’Œä¿®æ­£ç¿»è¯‘ã€‚":"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹å’Œä¸Šä¸‹æ–‡æä¾›é«˜è´¨é‡çš„ç¿»è¯‘ã€‚",c=JSON.stringify(S,null,2),h=[{type:"text",text:(Z||"")+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®:
\`\`\`json
`+c+"\n```"}];for(const he of w)h.push({type:"image_url",image_url:{url:`data:image/png;base64,${he}`}});const le=[{role:"system",content:Y},{role:"user",content:h}],I=v.hqTranslation,G=D?N:null,re=await Bt({provider:(D?G?.provider:I.provider)||"openai",api_key:(D?G?.apiKey:I.apiKey)||"",model_name:(D?G?.modelName:I.modelName)||"",custom_base_url:D?G?.customBaseUrl:I.customBaseUrl,messages:le,low_reasoning:D?G?.lowReasoning:I.lowReasoning,force_json_output:D?G?.forceJsonOutput:I.forceJsonOutput,no_thinking_method:D?G?.noThinkingMethod:I.noThinkingMethod,use_stream:D?!1:I.useStream,max_retries:D?v.proofreading.maxRetries||2:I.maxRetries||2}),ke=D?G?.forceJsonOutput||!1:I.forceJsonOutput;let Te=X(re,ke)||S;if(D&&v.proofreading.rounds.length>1)for(let he=1;he<v.proofreading.rounds.length;he++){const ee=v.proofreading.rounds[he],b=JSON.stringify(Te,null,2),J=[{type:"text",text:ee.prompt+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®:
\`\`\`json
`+b+"\n```"}];for(const ue of w)J.push({type:"image_url",image_url:{url:`data:image/png;base64,${ue}`}});const me=[{role:"system",content:Y},{role:"user",content:J}],H=await Bt({provider:ee.provider,api_key:ee.apiKey,model_name:ee.modelName,custom_base_url:ee.customBaseUrl,messages:me,low_reasoning:ee.lowReasoning,force_json_output:ee.forceJsonOutput,no_thinking_method:ee.noThinkingMethod,use_stream:!1,max_retries:ee.maxRetries||v.proofreading.maxRetries||2}),te=X(H,ee.forceJsonOutput);te&&(Te=te)}for(const he of l){const ee=Te?.find(b=>b.imageIndex===he.imageIndex);ee?he.translatedTexts=ee.bubbles.map(b=>b.translated):he.translatedTexts=[],he.textboxTexts=[]}}async function K(l){if(l.bubbleCoords.length===0){l.cleanImage=W(l.image.originalDataURL);return}const v=s.settings,{textStyle:D,preciseMask:S}=v,w=W(l.image.originalDataURL),N=await Dn({image:w,bubble_coords:l.bubbleCoords,bubble_polygons:l.bubblePolygons,raw_mask:l.rawMask,method:D.inpaintMethod==="solid"?"solid":"lama",lama_model:D.inpaintMethod==="litelama"?"litelama":"lama_mpe",fill_color:D.fillColor,mask_dilate_size:S.dilateSize,mask_box_expand_ratio:S.boxExpandRatio});if(!N.success)throw new Error(N.error||"èƒŒæ™¯ä¿®å¤å¤±è´¥");l.cleanImage=N.clean_image}async function V(l){if(!l.cleanImage)throw f==="proofread"?new Error("æ­¤å›¾ç‰‡å°šæœªç¿»è¯‘ï¼Œè¯·å…ˆç¿»è¯‘åå†è¿›è¡Œæ ¡å¯¹"):new Error("ç¼ºå°‘å¹²å‡€èƒŒæ™¯å›¾ç‰‡");const{textStyle:v}=s.settings,D=k?.autoTextDirection?"auto":k?.textDirection||v.layoutDirection,S=l.bubbleCoords.map((N,Z)=>{const Y=l.autoDirections[Z]||"vertical",c=Y==="v"?"vertical":Y==="h"?"horizontal":Y==="vertical"||Y==="horizontal"?Y:"vertical",h=D==="vertical"||D==="horizontal"?D:c,le=k?.useAutoTextColor??v.useAutoTextColor;let I=k?.textColor||v.textColor,G=k?.fillColor||v.fillColor;const re=l.colors[Z];return le&&re&&(re.textColor&&(I=re.textColor),re.bgColor&&(G=re.bgColor)),{coords:N,polygon:[],position:{x:0,y:0},rotationAngle:l.bubbleAngles[Z]||0,originalText:l.originalTexts[Z]||"",translatedText:l.translatedTexts[Z]||"",textboxText:l.textboxTexts[Z]||"",textDirection:h,autoTextDirection:c,fontSize:k?.fontSize||v.fontSize,fontFamily:k?.fontFamily||v.fontFamily,autoFontSize:k?.autoFontSize??v.autoFontSize,textColor:I,fillColor:G,strokeEnabled:k?.strokeEnabled??v.strokeEnabled,strokeColor:k?.strokeColor||v.strokeColor,strokeWidth:k?.strokeWidth||v.strokeWidth,inpaintMethod:v.inpaintMethod,autoFgColor:l.colors[Z]?.autoFgColor||null,autoBgColor:l.colors[Z]?.autoBgColor||null}}),w=await Mn({clean_image:l.cleanImage,bubble_states:S,fontSize:k?.fontSize||v.fontSize,fontFamily:k?.fontFamily||v.fontFamily,textDirection:k?.textDirection||v.layoutDirection,textColor:k?.textColor||v.textColor,strokeEnabled:k?.strokeEnabled??v.strokeEnabled,strokeColor:k?.strokeColor||v.strokeColor,strokeWidth:k?.strokeWidth||v.strokeWidth,autoFontSize:k?.autoFontSize??v.autoFontSize,use_individual_styles:!0});if(!w.success)throw new Error(w.error||"æ¸²æŸ“å¤±è´¥");l.finalImage=w.final_image,l.bubbleStates=w.bubble_states||S}async function se(l,v){switch(l){case"detection":await U(v);break;case"ocr":await g(v);break;case"color":await d(v);break;case"translate":await x(v);break;case"inpaint":await K(v);break;case"render":await V(v);break;case"save":await An(v.imageIndex);break;case"aiTranslate":throw new Error("aiTranslate åº”é€šè¿‡æ‰¹é‡å¤„ç†é€»è¾‘è°ƒç”¨")}}function X(l,v){if(!l.success)return console.error("APIè°ƒç”¨å¤±è´¥:",l.error),null;if(l.results&&l.results.length>0){const S=l.results[0];if(S&&"imageIndex"in S&&"bubbles"in S)return l.results}const D=l.content;if(D)if(v)try{return JSON.parse(D)}catch{return null}else{const S=D.match(/```json\s*([\s\S]*?)\s*```/);if(S?.[1])try{return JSON.parse(S[1])}catch{return null}}return null}function ie(l){const v=l.finalImage?`data:image/png;base64,${l.finalImage}`:l.cleanImage?`data:image/png;base64,${l.cleanImage}`:null;n.updateImageByIndex(l.imageIndex,{translatedDataURL:v,cleanImageData:l.cleanImage||null,bubbleStates:l.bubbleStates,bubbleCoords:l.bubbleCoords,bubbleAngles:l.bubbleAngles,originalTexts:l.originalTexts,textboxTexts:l.textboxTexts,bubbleTexts:l.translatedTexts,translationStatus:"completed",translationFailed:!1,showOriginal:!1,hasUnsavedChanges:!0,layoutDirection:k?.layoutDirection,autoFontSize:k?.autoFontSize??!1,useAutoTextColor:k?.useAutoTextColor??!1}),l.imageIndex===n.currentImageIndex&&l.bubbleStates&&t.setBubbles(l.bubbleStates)}function z(l){return l==="standard"||l==="removeText"}function R(l){const v=s.settings;return l==="hq"?v.hqTranslation.batchSize||5:l==="proofread"?v.proofreading.rounds[0]?.batchSize||5:1}async function T(l,v,D,S){let w=0,N=0;for(let Z=0;Z<l.length;Z++){const Y=l[Z];if(D.scope==="all"&&!n.isBatchTranslationInProgress){console.log("â¹ï¸ æ‰¹é‡ç¿»è¯‘å·²å–æ¶ˆï¼Œåœæ­¢å¤„ç†");break}const c=Math.floor(Z/l.length*90);a.setPercentage(c,`å¤„ç†å›¾ç‰‡ ${Z+1}/${l.length}`),i.info(`å¤„ç†å›¾ç‰‡ ${Z+1}/${l.length}...`),n.setTranslationStatus(Y.imageIndex,"processing");let h=!1;for(let le=0;le<v.length;le++){const I=v[le];if(h)break;p.value&&await p.value.acquire();try{const G=c+Math.floor(le/v.length*(90/l.length));a.setPercentage(G,`å›¾ç‰‡ ${Z+1}: ${Nt[I]}`),await se(I,Y)}catch(G){const re=G instanceof Error?G.message:"æœªçŸ¥é”™è¯¯";S.push(`å›¾ç‰‡ ${Y.imageIndex+1}: ${I} - ${re}`),n.setTranslationStatus(Y.imageIndex,"failed",re),h=!0,N++}}h||(ie(Y),w++,console.log(`âœ… å›¾ç‰‡ ${Z+1}/${l.length} å¤„ç†å®Œæˆ`))}return{completed:w,failed:N}}async function F(l,v,D,S){let w=0,N=0;const Z=R(D.mode),Y=Math.ceil(l.length/Z),c=v.indexOf("aiTranslate"),h=c>=0?v.slice(0,c):v,le=c>=0?v.slice(c+1):[];console.log(`ğŸ“¦ æ‰¹æ¬¡å¤„ç†æ¨¡å¼ï¼šå…± ${l.length} å¼ å›¾ç‰‡ï¼Œæ¯æ‰¹ ${Z} å¼ ï¼Œå…± ${Y} æ‰¹`),console.log(`   AIç¿»è¯‘å‰æ­¥éª¤: [${h.join(" â†’ ")}]`),console.log(`   AIç¿»è¯‘åæ­¥éª¤: [${le.join(" â†’ ")}]`);for(let I=0;I<Y;I++){if(D.scope==="all"&&!n.isBatchTranslationInProgress){console.log("â¹ï¸ æ‰¹é‡ç¿»è¯‘å·²å–æ¶ˆï¼Œåœæ­¢å¤„ç†");break}const G=I*Z,re=Math.min(G+Z,l.length),ke=l.slice(G,re),De=Math.floor(I/Y*90);a.setPercentage(De,`å¤„ç†æ‰¹æ¬¡ ${I+1}/${Y}`),i.info(`å¤„ç†æ‰¹æ¬¡ ${I+1}/${Y}ï¼ˆå›¾ç‰‡ ${G+1}-${re}ï¼‰...`);for(const he of ke)n.setTranslationStatus(he.imageIndex,"processing");const Te=new Set;for(let he=0;he<ke.length;he++){const ee=ke[he];for(const b of h){if(Te.has(ee.imageIndex))break;p.value&&await p.value.acquire();try{const J=De+Math.floor(he/ke.length*30);a.setPercentage(J,`å›¾ç‰‡ ${G+he+1}: ${Nt[b]}`),await se(b,ee)}catch(J){const me=J instanceof Error?J.message:"æœªçŸ¥é”™è¯¯";S.push(`å›¾ç‰‡ ${ee.imageIndex+1}: ${b} - ${me}`),n.setTranslationStatus(ee.imageIndex,"failed",me),Te.add(ee.imageIndex)}}}if(c>=0){const he=De+40;a.setPercentage(he,`æ‰¹æ¬¡ ${I+1}: ${Nt.aiTranslate}`);try{const ee=ke.filter(b=>!Te.has(b.imageIndex));ee.length>0&&await _(ee)}catch(ee){const b=ee instanceof Error?ee.message:"æœªçŸ¥é”™è¯¯";S.push(`æ‰¹æ¬¡ ${I+1} AIç¿»è¯‘å¤±è´¥: ${b}`);for(const J of ke)Te.has(J.imageIndex)||(n.setTranslationStatus(J.imageIndex,"failed",b),Te.add(J.imageIndex))}}for(let he=0;he<ke.length;he++){const ee=ke[he];if(!Te.has(ee.imageIndex)){for(const b of le){if(Te.has(ee.imageIndex))break;p.value&&await p.value.acquire();try{const J=De+50+Math.floor(he/ke.length*40);a.setPercentage(J,`å›¾ç‰‡ ${G+he+1}: ${Nt[b]}`),await se(b,ee)}catch(J){const me=J instanceof Error?J.message:"æœªçŸ¥é”™è¯¯";S.push(`å›¾ç‰‡ ${ee.imageIndex+1}: ${b} - ${me}`),n.setTranslationStatus(ee.imageIndex,"failed",me),Te.add(ee.imageIndex)}}Te.has(ee.imageIndex)||(ie(ee),w++,console.log(`âœ… å›¾ç‰‡ ${G+he+1} å¤„ç†å®Œæˆ`))}}N+=Te.size,console.log(`âœ… æ‰¹æ¬¡ ${I+1}/${Y} å¤„ç†å®Œæˆ`)}return{completed:w,failed:N}}async function y(l){if(!B(l))return{success:!1,completed:0,failed:0,errors:["é…ç½®éªŒè¯å¤±è´¥"]};if(n.images.length===0)return i.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),{success:!1,completed:0,failed:0,errors:["æ²¡æœ‰å›¾ç‰‡"]};f=l.mode;const D=z(l.mode);u.value=!0,(l.scope==="all"||l.scope==="failed")&&n.setBatchTranslationInProgress(!0),M(),$();const S=O(l),w=[],N=It(),Z=[...rn[l.mode]];N&&Z.push("save"),console.log("ğŸš€ é¡ºåºç®¡çº¿å¯åŠ¨"),console.log(`   æ¨¡å¼: ${l.mode}`),console.log(`   å¤„ç†æ–¹å¼: ${D?"é€å¼ å¤„ç†":"æ‰¹æ¬¡å¤„ç†"}`),console.log(`   æ­¥éª¤é“¾: [${Z.join(" â†’ ")}]`),console.log(`   è‡ªåŠ¨ä¿å­˜: ${N?"å¯ç”¨":"ç¦ç”¨"}`);const Y=S.map(({image:c,index:h})=>{const le={imageIndex:h,image:c,bubbleCoords:[],bubbleAngles:[],bubblePolygons:[],autoDirections:[],textlinesPerBubble:[],originalTexts:[],colors:[],translatedTexts:[],textboxTexts:[]};return l.mode==="proofread"&&c.bubbleStates&&c.bubbleStates.length>0&&(le.bubbleCoords=c.bubbleStates.map(I=>I.coords),le.bubbleAngles=c.bubbleStates.map(I=>I.rotationAngle||0),le.autoDirections=c.bubbleStates.map(I=>I.autoTextDirection||I.textDirection||"vertical"),le.originalTexts=c.bubbleStates.map(I=>I.originalText||""),le.translatedTexts=c.bubbleStates.map(I=>I.translatedText||""),le.textboxTexts=c.bubbleStates.map(I=>I.textboxText||""),le.colors=c.bubbleStates.map(I=>({textColor:I.textColor||"",bgColor:I.fillColor||"",autoFgColor:I.autoFgColor||null,autoBgColor:I.autoBgColor||null})),c.cleanImageData&&(le.cleanImage=c.cleanImageData)),le});try{a.init(S.length,`${l.mode} æ¨¡å¼å¯åŠ¨...`),N&&(a.setPercentage(0,"é¢„ä¿å­˜åŸå§‹å›¾ç‰‡..."),await Bn({onStart:I=>{a.setPercentage(0,`é¢„ä¿å­˜åŸå§‹å›¾ç‰‡ 0/${I}...`)},onProgress:(I,G)=>{const re=Math.round(I/G*10);a.setPercentage(re,`é¢„ä¿å­˜åŸå§‹å›¾ç‰‡ ${I}/${G}...`)},onComplete:()=>{a.setPercentage(10,"é¢„ä¿å­˜å®Œæˆï¼Œå¼€å§‹ç¿»è¯‘...")},onError:I=>{a.setPercentage(0,`é¢„ä¿å­˜å¤±è´¥: ${I}`)}})||i.warning("é¢„ä¿å­˜å¤±è´¥ï¼Œç¿»è¯‘å®Œæˆåè¯·æ‰‹åŠ¨ä¿å­˜"));let c;D?c=await T(Y,Z,l,w):c=await F(Y,Z,l,w),a.setPercentage(100,"å®Œæˆï¼");const h={standard:"ç¿»è¯‘",hq:"é«˜è´¨é‡ç¿»è¯‘",proofread:"AIæ ¡å¯¹",removeText:"æ¶ˆé™¤æ–‡å­—"};return i.success(`${h[l.mode]}å®Œæˆï¼`),{success:c.failed===0,completed:c.completed,failed:c.failed,errors:w.length>0?w:void 0}}catch(c){const h=c instanceof Error?c.message:"æ‰§è¡Œå¤±è´¥";return i.error(h),w.push(h),{success:!1,completed:0,failed:S.length,errors:w}}finally{u.value=!1,n.setBatchTranslationInProgress(!1),N&&await Ln();const c=n.currentImageIndex,h=n.images[c];h?.bubbleStates&&h.bubbleStates.length>0&&t.setBubbles(h.bubbleStates),setTimeout(()=>a.finish(),1e3)}}function m(){n.isBatchTranslationInProgress&&(n.setBatchTranslationInProgress(!1),Fn(),i.info("æ“ä½œå·²å–æ¶ˆ"))}return{progress:r,isExecuting:u,isTranslating:P,progressPercent:A,execute:y,cancel:m,STEP_CHAIN_CONFIGS:rn}}class mi{currentCount=0;maxCount;waitQueue=[];holders=[];constructor(t=1){this.maxCount=Math.max(1,t)}setSize(t){this.maxCount=Math.max(1,t),this.tryWakeUp()}getSize(){return this.maxCount}async acquire(t){if(this.currentCount<this.maxCount){this.currentCount++,this.holders.push(t);return}return new Promise(s=>{this.waitQueue.push({resolve:s,poolName:t})})}release(t){const s=this.holders.indexOf(t);s>=0&&(this.holders.splice(s,1),this.currentCount--),this.tryWakeUp()}tryWakeUp(){for(;this.currentCount<this.maxCount&&this.waitQueue.length>0;){const t=this.waitQueue.shift();this.currentCount++,this.holders.push(t.poolName),t.resolve()}}async withLock(t,s){await this.acquire(t);try{return await s()}finally{this.release(t)}}getStatus(){return{isLocked:this.currentCount>=this.maxCount,currentCount:this.currentCount,maxCount:this.maxCount,holders:[...this.holders],waitingCount:this.waitQueue.length,waitingPools:this.waitQueue.map(t=>t.poolName)}}isWaiting(t){return this.waitQueue.some(s=>s.poolName===t)}isHolding(t){return this.holders.includes(t)}reset(){this.currentCount=0,this.holders=[];for(const t of this.waitQueue)t.resolve();this.waitQueue=[]}}class Pt{queue=[];currentTask=null;isRunning=!1;isCancelled=!1;completedCount=0;nextPool;name;icon;lock;progressTracker;onTaskComplete;constructor(t,s,o,i,r,a){this.name=t,this.icon=s,this.nextPool=o,this.lock=i,this.progressTracker=r,this.onTaskComplete=a}getName(){return this.name}getIcon(){return this.icon}setNextPool(t){this.nextPool=t}enqueue(t){this.isCancelled||(this.queue.push(t),this.progressTracker.updatePool(this.name,{waiting:this.queue.length}),this.tryProcessNext())}enqueueBatch(t){if(!this.isCancelled){for(const s of t)this.queue.push(s);this.progressTracker.updatePool(this.name,{waiting:this.queue.length}),this.tryProcessNext()}}async tryProcessNext(){if(!(this.isRunning||this.isCancelled||this.queue.length===0)){this.isRunning=!0,this.currentTask=this.queue.shift(),this.progressTracker.updatePool(this.name,{waiting:this.queue.length,isProcessing:!0,currentPage:this.currentTask.imageIndex+1,isWaitingLock:!1});try{let t;this.lock?(this.progressTracker.updatePool(this.name,{isWaitingLock:!0}),t=await this.lock.withLock(this.name,async()=>(this.progressTracker.updatePool(this.name,{isWaitingLock:!1}),await this.process(this.currentTask)))):t=await this.process(this.currentTask),this.completedCount++,this.progressTracker.updatePool(this.name,{completed:this.completedCount}),this.nextPool&&t.status!=="failed"&&t.status!=="buffered"&&this.nextPool.enqueue(t),this.onTaskComplete?.(t)}catch(t){this.currentTask.status="failed",this.currentTask.error=t.message,console.error(`[${this.name}] å¤„ç†ä»»åŠ¡å¤±è´¥:`,t),this.onTaskComplete?.(this.currentTask)}finally{this.currentTask=null,this.isRunning=!1,this.progressTracker.updatePool(this.name,{isProcessing:!1,currentPage:void 0}),this.tryProcessNext()}}}getStatus(){return{name:this.name,icon:this.icon,waiting:this.queue.length,processing:this.isRunning,currentPage:this.currentTask?.imageIndex,completed:this.completedCount,isWaitingLock:this.lock?.isWaiting(this.name)??!1}}cancel(){this.isCancelled=!0,this.queue=[]}reset(){this.isCancelled=!1,this.queue=[],this.currentTask=null,this.isRunning=!1,this.completedCount=0}getCompletedCount(){return this.completedCount}getWaitingCount(){return this.queue.length}isProcessing(){return this.isRunning}}const vi=[{name:"æ£€æµ‹",icon:"ğŸ“"},{name:"OCR",icon:"ğŸ“–"},{name:"é¢œè‰²",icon:"ğŸ¨"},{name:"ç¿»è¯‘",icon:"ğŸŒ"},{name:"ä¿®å¤",icon:"ğŸ–Œï¸"},{name:"æ¸²æŸ“",icon:"âœ¨"}];class fi{poolStatuses=new Map;totalPages=0;startTime=0;progress=fo({pools:[],totalCompleted:0,totalFailed:0,totalPages:0,estimatedTimeRemaining:0});constructor(){this.initPools()}initPools(){for(const t of vi){const s={name:t.name,icon:t.icon,waiting:0,processing:!1,completed:0,isWaitingLock:!1};this.poolStatuses.set(t.name,s)}this.syncToReactive()}init(t){this.totalPages=t,this.startTime=Date.now();for(const s of this.poolStatuses.values())s.waiting=0,s.processing=!1,s.currentPage=void 0,s.completed=0,s.isWaitingLock=!1;this.progress.totalCompleted=0,this.progress.totalFailed=0,this.progress.totalPages=t,this.progress.estimatedTimeRemaining=0,this.syncToReactive()}updatePool(t,s){const o=this.poolStatuses.get(t);o&&(s.waiting!==void 0&&(o.waiting=s.waiting),s.isProcessing!==void 0&&(o.processing=s.isProcessing),s.currentPage!==void 0&&(o.currentPage=s.currentPage),s.completed!==void 0&&(o.completed=s.completed),s.isWaitingLock!==void 0&&(o.isWaitingLock=s.isWaitingLock),this.syncToReactive(),this.updateEstimatedTime())}incrementCompleted(){this.progress.totalCompleted++,this.updateEstimatedTime()}incrementFailed(){this.progress.totalFailed++}updateEstimatedTime(){if(this.progress.totalCompleted===0){this.progress.estimatedTimeRemaining=0;return}const s=(Date.now()-this.startTime)/1e3/this.progress.totalCompleted,o=this.totalPages-this.progress.totalCompleted-this.progress.totalFailed;this.progress.estimatedTimeRemaining=Math.ceil(s*o)}syncToReactive(){this.progress.pools=Array.from(this.poolStatuses.values()).map(t=>({...t}))}getPoolStatus(t){return this.poolStatuses.get(t)}getAllPoolStatuses(){return Array.from(this.poolStatuses.values())}getProgress(){return{...this.progress}}reset(){this.totalPages=0,this.startTime=0,this.initPools()}formatRemainingTime(){const t=this.progress.estimatedTimeRemaining;if(t<=0)return"--";const s=Math.floor(t/60),o=t%60;return s>0?`${s}åˆ†${o}ç§’`:`${o}ç§’`}}class bi{results=new Map;totalExpected=0;completedCount=0;failedCount=0;resolveWaitAll=null;init(t){this.results.clear(),this.totalExpected=t,this.completedCount=0,this.failedCount=0,this.resolveWaitAll=null}add(t){this.results.set(t.imageIndex,t),t.status==="completed"?this.completedCount++:t.status==="failed"&&this.failedCount++,this.completedCount+this.failedCount>=this.totalExpected&&this.resolveWaitAll&&(this.resolveWaitAll({success:this.completedCount,failed:this.failedCount}),this.resolveWaitAll=null)}waitForAll(t){return this.totalExpected=t,this.completedCount+this.failedCount>=t?Promise.resolve({success:this.completedCount,failed:this.failedCount}):new Promise(s=>{this.resolveWaitAll=s})}get(t){return this.results.get(t)}getAll(){return Array.from(this.results.values()).sort((t,s)=>t.imageIndex-s.imageIndex)}getSuccessful(){return this.getAll().filter(t=>t.status==="completed")}getFailed(){return this.getAll().filter(t=>t.status==="failed")}getStats(){return{total:this.totalExpected,completed:this.completedCount,failed:this.failedCount,pending:this.totalExpected-this.completedCount-this.failedCount}}reset(){this.results.clear(),this.totalExpected=0,this.completedCount=0,this.failedCount=0,this.resolveWaitAll=null}}class hi extends Pt{constructor(t,s,o,i){super("æ£€æµ‹","ğŸ“",t,s,o,i)}async process(t){const{imageData:s}=t,i=ze().settings,r=this.extractBase64(s.originalDataURL),a=await Tn({image:r,detector_type:i.textDetector,box_expand_ratio:i.boxExpand.ratio,box_expand_top:i.boxExpand.top,box_expand_bottom:i.boxExpand.bottom,box_expand_left:i.boxExpand.left,box_expand_right:i.boxExpand.right});if(!a.success)throw new Error(a.error||"æ£€æµ‹å¤±è´¥");return t.detectionResult={bubbleCoords:a.bubble_coords||[],bubbleAngles:a.bubble_angles||[],bubblePolygons:a.bubble_polygons||[],autoDirections:a.auto_directions||[],rawMask:a.raw_mask,textlinesPerBubble:a.textlines_per_bubble||[]},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}class yi extends Pt{constructor(t,s,o,i){super("OCR","ğŸ“–",t,s,o,i)}async process(t){const{imageData:s,detectionResult:o}=t,r=ze().settings;if(!o||o.bubbleCoords.length===0)return t.ocrResult={originalTexts:[],textlinesPerBubble:[]},t.status="processing",t;const a=this.extractBase64(s.originalDataURL),u=await In({image:a,bubble_coords:o.bubbleCoords,source_language:r.sourceLanguage,ocr_engine:r.ocrEngine,baidu_api_key:r.baiduOcr?.apiKey,baidu_secret_key:r.baiduOcr?.secretKey,baidu_version:r.baiduOcr?.version,baidu_ocr_language:r.baiduOcr?.sourceLanguage,ai_vision_provider:r.aiVisionOcr?.provider,ai_vision_api_key:r.aiVisionOcr?.apiKey,ai_vision_model_name:r.aiVisionOcr?.modelName,ai_vision_ocr_prompt:r.aiVisionOcr?.prompt,custom_ai_vision_base_url:r.aiVisionOcr?.customBaseUrl,ai_vision_min_image_size:r.aiVisionOcr?.minImageSize??ds,textlines_per_bubble:o.textlinesPerBubble});if(!u.success)throw new Error(u.error||"OCRå¤±è´¥");return t.ocrResult={originalTexts:u.original_texts||[],textlinesPerBubble:u.textlines_per_bubble||[]},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}class xi extends Pt{constructor(t,s,o,i){super("é¢œè‰²","ğŸ¨",t,s,o,i)}async process(t){const{imageData:s,detectionResult:o,ocrResult:i}=t;if(!o||o.bubbleCoords.length===0)return t.colorResult={colors:[]},t.status="processing",t;const r=this.extractBase64(s.originalDataURL),a=await Pn({image:r,bubble_coords:o.bubbleCoords,textlines_per_bubble:i?.textlinesPerBubble||o.textlinesPerBubble});if(!a.success)throw new Error(a.error||"é¢œè‰²æå–å¤±è´¥");return t.colorResult={colors:a.colors||[]},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}class _i extends Pt{mode="standard";batchBuffer=[];totalTasks=0;processedCount=0;constructor(t,s,o){super("ç¿»è¯‘","ğŸŒ",t,null,s,o)}setMode(t,s,o){this.mode=t,this.totalTasks=s,this.batchBuffer=[],this.processedCount=0,this.nextPool=o}async process(t){switch(this.mode){case"standard":return this.handleStandardTranslate(t);case"hq":return this.handleHqTranslate(t);case"proofread":return this.handleProofread(t);case"removeText":return this.handleRemoveTextOnly(t);default:return t}}async handleStandardTranslate(t){const o=ze().settings;if(!t.ocrResult||t.ocrResult.originalTexts.length===0)return t.translateResult={translatedTexts:[],textboxTexts:[]},t.status="processing",t;const i=await Rn({original_texts:t.ocrResult.originalTexts,target_language:o.targetLanguage,source_language:o.sourceLanguage,model_provider:o.translation.provider,model_name:o.translation.modelName,api_key:o.translation.apiKey,custom_base_url:o.translation.customBaseUrl,prompt_content:o.translatePrompt,textbox_prompt_content:o.textboxPrompt,use_textbox_prompt:o.useTextboxPrompt,rpm_limit:o.translation.rpmLimit,max_retries:o.translation.maxRetries,use_json_format:o.translation.isJsonMode});if(!i.success)throw new Error(i.error||"ç¿»è¯‘å¤±è´¥");return t.translateResult={translatedTexts:i.translated_texts||[],textboxTexts:i.textbox_texts||[]},t.status="processing",t}async handleHqTranslate(t){this.batchBuffer.push(t),this.processedCount++;const s=ze(),{hqTranslation:o}=s.settings,i=o.batchSize||3,r=this.processedCount>=this.totalTasks;if(!(this.batchBuffer.length>=i||r))return t.status="buffered",t;const u=[...this.batchBuffer];this.batchBuffer=[];const p=u.map($=>({imageIndex:$.imageIndex,bubbles:($.ocrResult?.originalTexts||[]).map((W,O)=>({bubbleIndex:O,original:W,translated:"",textDirection:$.detectionResult?.autoDirections[O]||"vertical"}))})),k=u.map($=>this.extractBase64($.imageData.originalDataURL)),f=JSON.stringify(p,null,2),P=[{type:"text",text:o.prompt+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®:
\`\`\`json
`+f+"\n```"}];for(const $ of k)P.push({type:"image_url",image_url:{url:`data:image/png;base64,${$}`}});const A=[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹å’Œä¸Šä¸‹æ–‡æä¾›é«˜è´¨é‡çš„ç¿»è¯‘ã€‚"},{role:"user",content:P}],M=await Bt({provider:o.provider,api_key:o.apiKey,model_name:o.modelName,custom_base_url:o.customBaseUrl,messages:A,low_reasoning:o.lowReasoning,force_json_output:o.forceJsonOutput,no_thinking_method:o.noThinkingMethod,use_stream:o.useStream,max_retries:o.maxRetries||2}),B=this.parseHqResponse(M,o.forceJsonOutput);for(const $ of u){const W=B?.find(O=>O.imageIndex===$.imageIndex);W?$.translateResult={translatedTexts:W.bubbles.map(O=>O.translated),textboxTexts:[]}:$.translateResult={translatedTexts:[],textboxTexts:[]},$.status="processing",this.nextPool&&this.nextPool.enqueue($)}return t}async handleProofread(t){this.batchBuffer.push(t),this.processedCount++;const s=ze(),{proofreading:o,useTextboxPrompt:i}=s.settings,r=o.rounds[0]?.batchSize||3,a=this.processedCount>=this.totalTasks;if(!(this.batchBuffer.length>=r||a))return t.status="buffered",t;const p=[...this.batchBuffer];this.batchBuffer=[];const k=p.map(A=>({imageIndex:A.imageIndex,bubbles:(A.imageData.bubbleStates||[]).map((M,B)=>({bubbleIndex:B,original:M.originalText||"",translated:i?M.textboxText||M.translatedText||"":M.translatedText||"",textDirection:M.textDirection==="vertical"||M.textDirection==="horizontal"?M.textDirection:M.autoTextDirection==="vertical"||M.autoTextDirection==="horizontal"?M.autoTextDirection:"vertical"}))})),f=p.map(A=>{const M=A.imageData.translatedDataURL||A.imageData.originalDataURL;return this.extractBase64(M)});let P=k;for(const A of o.rounds){const M=JSON.stringify(P,null,2),B=[{type:"text",text:A.prompt+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®:
\`\`\`json
`+M+"\n```"}];for(const U of f)B.push({type:"image_url",image_url:{url:`data:image/png;base64,${U}`}});const $=[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘æ ¡å¯¹åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹æ£€æŸ¥å’Œä¿®æ­£ç¿»è¯‘ã€‚"},{role:"user",content:B}],W=await Bt({provider:A.provider,api_key:A.apiKey,model_name:A.modelName,custom_base_url:A.customBaseUrl,messages:$,low_reasoning:A.lowReasoning,force_json_output:A.forceJsonOutput,no_thinking_method:A.noThinkingMethod,use_stream:!1,max_retries:A.maxRetries||o.maxRetries||2}),O=this.parseHqResponse(W,A.forceJsonOutput);O&&(P=O)}for(const A of p){const M=P.find(B=>B.imageIndex===A.imageIndex);M?A.translateResult={translatedTexts:M.bubbles.map(B=>B.translated),textboxTexts:[]}:A.translateResult={translatedTexts:[],textboxTexts:[]},A.status="processing",this.nextPool&&this.nextPool.enqueue(A)}return t}async handleRemoveTextOnly(t){return t.translateResult={translatedTexts:[],textboxTexts:[]},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}parseHqResponse(t,s){if(!t.success)return console.error("APIè°ƒç”¨å¤±è´¥:",t.error),null;if(t.results&&t.results.length>0){const i=t.results[0];if(i&&"imageIndex"in i&&"bubbles"in i)return t.results}const o=t.content;if(o)if(s)try{return JSON.parse(o)}catch(i){return console.error("è§£æAIå¼ºåˆ¶JSONè¿”å›çš„å†…å®¹å¤±è´¥:",i),null}else{const i=o.match(/```json\s*([\s\S]*?)\s*```/);if(i?.[1])try{return JSON.parse(i[1])}catch(r){return console.error("è§£æAIè¿”å›çš„JSONå¤±è´¥:",r),null}}return null}}class Ci extends Pt{constructor(t,s,o,i){super("ä¿®å¤","ğŸ–Œï¸",t,s,o,i)}async process(t){const{imageData:s,detectionResult:o}=t,r=ze().settings;if(!o||o.bubbleCoords.length===0)return t.inpaintResult={cleanImage:this.extractBase64(s.originalDataURL)},t.status="processing",t;const a=this.extractBase64(s.originalDataURL),u=r.textStyle.inpaintMethod,p=u==="lama_mpe"||u==="litelama",k=await Dn({image:a,bubble_coords:o.bubbleCoords,bubble_polygons:o.bubblePolygons,raw_mask:o.rawMask,method:p?"lama":"solid",lama_model:p?u:void 0,fill_color:r.textStyle.fillColor,mask_dilate_size:r.preciseMask.dilateSize,mask_box_expand_ratio:r.preciseMask.boxExpandRatio});if(!k.success)throw new Error(k.error||"ä¿®å¤å¤±è´¥");return t.inpaintResult={cleanImage:k.clean_image||""},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}const mt=fo({pools:[{name:"æ£€æµ‹",icon:"ğŸ“",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"OCR",icon:"ğŸ“–",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"é¢œè‰²",icon:"ğŸ¨",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"ç¿»è¯‘",icon:"ğŸŒ",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"ä¿®å¤",icon:"ğŸ–Œï¸",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"æ¸²æŸ“",icon:"âœ¨",waiting:0,processing:!1,completed:0,isWaitingLock:!1}],totalCompleted:0,totalFailed:0,totalPages:0,estimatedTimeRemaining:0,preSave:void 0,save:void 0}),Si=C(!1);function So(){const n=Ze(),t=ze(),s=bs(null),o=j(()=>t.settings.parallel),i=j(()=>o.value?.enabled??!1),r=Si,a=j(()=>mt);function u(){const A=t.settings;return A.proofreading?.enabled&&A.proofreading.rounds.length>0?"proofread":["gemini","openai","claude","deepseek"].includes(A.hqTranslation?.provider||"")&&A.hqTranslation?.apiKey?"hq":"standard"}function p(){if(!s.value)return;const A=s.value.progress;A&&(mt.pools=A.pools.map(M=>({...M})),mt.totalCompleted=A.totalCompleted,mt.totalFailed=A.totalFailed,mt.totalPages=A.totalPages,mt.estimatedTimeRemaining=A.estimatedTimeRemaining)}async function k(A,M,B=0){if(r.value)return{success:0,failed:0,errors:["ç¿»è¯‘æ­£åœ¨è¿›è¡Œä¸­"]};const $=M??n.images;if($.length===0)return{success:0,failed:0,errors:["æ²¡æœ‰å›¾ç‰‡"]};r.value=!0,mt.totalPages=$.length,mt.totalCompleted=0,mt.totalFailed=0;const W=setInterval(p,200);try{s.value=$i({enabled:!0,deepLearningLockSize:o.value?.deepLearningLockSize??1});const O=A??u();console.log(`ğŸš€ å¼€å§‹å¹¶è¡Œç¿»è¯‘ï¼Œæ¨¡å¼: ${O}ï¼Œå›¾ç‰‡æ•°: ${$.length}ï¼Œèµ·å§‹ç´¢å¼•: ${B}`);const U=await s.value.execute($,O,B);return p(),console.log(`âœ… å¹¶è¡Œç¿»è¯‘å®Œæˆï¼ŒæˆåŠŸ: ${U.success}ï¼Œå¤±è´¥: ${U.failed}`),U}catch(O){return console.error("å¹¶è¡Œç¿»è¯‘å‡ºé”™:",O),{success:0,failed:$.length,errors:[O.message]}}finally{clearInterval(W),r.value=!1}}function f(){s.value&&s.value.cancel(),r.value=!1}function P(){s.value=null,r.value=!1}return{isEnabled:i,isRunning:r,progress:a,executeParallel:k,cancel:f,reset:P,determineMode:u}}class ki extends Pt{resultCollector;constructor(t,s,o){super("æ¸²æŸ“","âœ¨",null,null,t,o),this.resultCollector=s}async process(t){const s=Ze(),o=ct(),i=ze(),r=this.buildBubbleStates(t,i);if(r.length===0){const p=t.inpaintResult?.cleanImage||t.imageData.cleanImageData||this.extractBase64(t.imageData.originalDataURL);return t.renderResult={finalImage:p,bubbleStates:[]},t.status="completed",this.updateImageToUI(t,s,o,i),this.resultCollector.add(t),t}const a=t.inpaintResult?.cleanImage||t.imageData.cleanImageData||this.extractBase64(t.imageData.translatedDataURL||t.imageData.originalDataURL),u=await Mn({clean_image:a,bubble_states:r,fontSize:i.settings.textStyle.fontSize,fontFamily:i.settings.textStyle.fontFamily,textDirection:i.settings.textStyle.layoutDirection,textColor:i.settings.textStyle.textColor,strokeEnabled:i.settings.textStyle.strokeEnabled,strokeColor:i.settings.textStyle.strokeColor,strokeWidth:i.settings.textStyle.strokeWidth,autoFontSize:i.settings.textStyle.autoFontSize,use_individual_styles:!0});if(!u.success)throw new Error(u.error||"æ¸²æŸ“å¤±è´¥");return t.renderResult={finalImage:u.final_image||"",bubbleStates:u.bubble_states||r},t.status="completed",this.updateImageToUI(t,s,o,i),this.resultCollector.add(t),t}updateImageToUI(t,s,o,i){const r=t.imageIndex,a=(t.detectionResult?.bubbleCoords||[]).map(u=>u.length>=4?[u[0],u[1],u[2],u[3]]:[0,0,0,0]);s.updateImageByIndex(r,{translatedDataURL:`data:image/png;base64,${t.renderResult.finalImage}`,cleanImageData:t.inpaintResult?.cleanImage||null,bubbleStates:t.renderResult.bubbleStates,bubbleCoords:a,bubbleAngles:t.detectionResult?.bubbleAngles||[],originalTexts:t.ocrResult?.originalTexts||[],bubbleTexts:t.translateResult?.translatedTexts||[],textboxTexts:t.translateResult?.textboxTexts||[],translationStatus:"completed",translationFailed:!1,showOriginal:!1,hasUnsavedChanges:!0,layoutDirection:i.settings.textStyle.layoutDirection,autoFontSize:i.settings.textStyle.autoFontSize,useAutoTextColor:i.settings.textStyle.useAutoTextColor}),r===s.currentImageIndex&&t.renderResult?.bubbleStates&&o.setBubbles(t.renderResult.bubbleStates),this.progressTracker.incrementCompleted(),It()&&An(r).catch(u=>{console.error(`[RenderPool] è‡ªåŠ¨ä¿å­˜å›¾ç‰‡ ${r+1} å¤±è´¥:`,u)}).finally(()=>{const{progress:u}=So(),p=u.value;p.save&&(p.save.completed=(p.save.completed||0)+1)}),console.log(`âœ… å›¾ç‰‡ ${r+1} æ¸²æŸ“å®Œæˆ`)}buildBubbleStates(t,s){if(!t.detectionResult&&t.imageData.bubbleStates&&t.imageData.bubbleStates.length>0){const P=t.translateResult?.translatedTexts||[];return t.imageData.bubbleStates.map((A,M)=>({...A,translatedText:P[M]||A.translatedText||""}))}if(t.detectionResult&&!t.translateResult)return console.log(`[æ¸²æŸ“æ± ] å›¾ç‰‡ ${t.imageIndex+1}: æ£€æµ‹åˆ°æ¶ˆé™¤æ–‡å­—æ¨¡å¼ï¼ˆæ— ç¿»è¯‘ç»“æœï¼‰ï¼Œè·³è¿‡æ¸²æŸ“`),[];const o=t.detectionResult?.bubbleCoords||[],i=t.translateResult?.translatedTexts||[],r=t.ocrResult?.originalTexts||[],a=t.colorResult?.colors||[],u=t.detectionResult?.bubbleAngles||[],p=t.detectionResult?.autoDirections||[],k=t.detectionResult?.bubblePolygons||[],f=s.settings;return o.map((P,A)=>{const M=p[A],B=M==="v"?"vertical":M==="h"?"horizontal":"vertical",$=f.textStyle.layoutDirection,W=$==="vertical"||$==="horizontal"?$:B;let O=f.textStyle.textColor,U=f.textStyle.fillColor;const g=a[A];return f.textStyle.useAutoTextColor&&g&&(g.textColor&&(O=g.textColor),g.bgColor&&(U=g.bgColor)),{originalText:r[A]||"",translatedText:i[A]||"",textboxText:"",coords:P.length>=4?[P[0],P[1],P[2],P[3]]:[0,0,0,0],polygon:k[A]||[],fontSize:f.textStyle.fontSize,fontFamily:f.textStyle.fontFamily,textDirection:W,autoTextDirection:B,textColor:O,fillColor:U,rotationAngle:u[A]||0,position:{x:0,y:0},strokeEnabled:f.textStyle.strokeEnabled,strokeColor:f.textStyle.strokeColor,strokeWidth:f.textStyle.strokeWidth,inpaintMethod:f.textStyle.inpaintMethod,autoFgColor:g?.autoFgColor||null,autoBgColor:g?.autoBgColor||null}})}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}const un={standard:["detection","ocr","color","translate","inpaint","render"],hq:["detection","ocr","color","translate","inpaint","render"],proofread:["translate","render"],removeText:["detection","inpaint","render"]};class wi{lock;progressTracker;resultCollector;detectionPool;ocrPool;colorPool;translatePool;inpaintPool;renderPool;isCancelled=!1;config;constructor(t){this.config=t,this.lock=new mi(t.deepLearningLockSize),this.progressTracker=new fi,this.resultCollector=new bi,this.renderPool=new ki(this.progressTracker,this.resultCollector),this.inpaintPool=new Ci(this.renderPool,this.lock,this.progressTracker),this.translatePool=new _i(this.inpaintPool,this.progressTracker),this.colorPool=new xi(this.translatePool,this.lock,this.progressTracker),this.ocrPool=new yi(this.colorPool,this.lock,this.progressTracker),this.detectionPool=new hi(this.ocrPool,this.lock,this.progressTracker)}updateConfig(t){t.deepLearningLockSize!==void 0&&(this.lock.setSize(t.deepLearningLockSize),this.config.deepLearningLockSize=t.deepLearningLockSize),t.enabled!==void 0&&(this.config.enabled=t.enabled)}async execute(t,s,o=0){this.reset(),this.progressTracker.init(t.length),this.resultCollector.init(t.length),this.setupPoolChain(s,t.length);const i=t.map((u,p)=>({id:`task-${o+p}`,imageIndex:o+p,imageData:u,status:"pending"})),r=this.getEntryPool(s);for(const u of i)r.enqueue(u);const a=await this.resultCollector.waitForAll(t.length);return{success:a.success,failed:a.failed,errors:this.resultCollector.getFailed().map(u=>u.error||"æœªçŸ¥é”™è¯¯")}}setupPoolChain(t,s){const o=un[t],i=this.getPoolMap();for(let p=0;p<o.length-1;p++){const k=o[p],f=o[p+1],P=i[k],A=i[f];P&&A&&P.setNextPool(A)}const r=o[o.length-1],a=i[r];a&&a.setNextPool(null);const u=o.indexOf("translate");if(u>=0&&u<o.length-1){const p=o[u+1];this.translatePool.setMode(t,s,i[p]||null)}else u===o.length-1&&this.translatePool.setMode(t,s,null)}getPoolMap(){return{detection:this.detectionPool,ocr:this.ocrPool,color:this.colorPool,translate:this.translatePool,inpaint:this.inpaintPool,render:this.renderPool}}getEntryPool(t){const o=un[t][0];return this.getPoolMap()[o]||this.detectionPool}cancel(){this.isCancelled=!0,this.detectionPool.cancel(),this.ocrPool.cancel(),this.colorPool.cancel(),this.translatePool.cancel(),this.inpaintPool.cancel(),this.renderPool.cancel(),this.lock.reset()}reset(){this.isCancelled=!1,this.detectionPool.reset(),this.ocrPool.reset(),this.colorPool.reset(),this.translatePool.reset(),this.inpaintPool.reset(),this.renderPool.reset(),this.resultCollector.reset(),this.progressTracker.reset()}get progress(){return this.progressTracker.progress}getProgressTracker(){return this.progressTracker}getLockStatus(){return this.lock.getStatus()}get cancelled(){return this.isCancelled}}function $i(n){return new wi(n)}function Ti(){const n=Ze(),t=ze(),s=rt(),o=pi(),i=So(),r=j(()=>o.isTranslating.value||n.isBatchTranslationInProgress),a=j(()=>o.progressPercent.value);async function u(f){if(n.images.length===0)return s.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),{success:!1,completed:0,failed:0,errors:["æ²¡æœ‰å›¾ç‰‡"]};const P=t.settings.parallel,A=f.scope==="all"||f.scope==="range";return P?.enabled&&A?(console.log(`ğŸš€ ä½¿ç”¨å¹¶è¡Œç®¡çº¿ï¼Œæ¨¡å¼: ${f.mode}, èŒƒå›´: ${f.scope}`),p(f)):(console.log(`ğŸš€ ä½¿ç”¨é¡ºåºç®¡çº¿ï¼Œæ¨¡å¼: ${f.mode}`),o.execute(f))}async function p(f){let P=n.images,A=0;if(f.scope==="range"&&f.pageRange){A=Math.max(0,f.pageRange.startPage-1);const B=Math.min(n.images.length-1,f.pageRange.endPage-1);if(A<=B&&A<n.images.length)P=n.images.slice(A,B+1),console.log(`ğŸ¯ å¹¶è¡Œç¿»è¯‘èŒƒå›´: ç¬¬ ${f.pageRange.startPage} è‡³ ${f.pageRange.endPage} é¡µï¼Œå…± ${P.length} å¼ ï¼Œèµ·å§‹ç´¢å¼• ${A}`);else return s.error("æ— æ•ˆçš„é¡µé¢èŒƒå›´"),{success:!1,completed:0,failed:0,errors:["æ— æ•ˆçš„é¡µé¢èŒƒå›´"]}}const M=It();try{if(i.progress.value.totalPages=P.length,i.progress.value.totalCompleted=0,i.progress.value.totalFailed=0,M&&(console.log("[ParallelPipeline] æ‰§è¡Œé¢„ä¿å­˜..."),s.info("å¼€å§‹é¢„ä¿å­˜åŸå§‹å›¾ç‰‡..."),!await Bn({onStart:O=>{const U=i.progress.value;U.preSave={isRunning:!0,current:0,total:O}},onProgress:(O,U)=>{const g=i.progress.value;g.preSave&&(g.preSave.current=O,g.preSave.total=U)},onComplete:()=>{const O=i.progress.value;O.preSave&&(O.preSave.isRunning=!1),s.success("é¢„ä¿å­˜å®Œæˆï¼Œå¼€å§‹ç¿»è¯‘...")},onError:O=>{const U=i.progress.value;U.preSave=void 0,s.warning(`é¢„ä¿å­˜å¤±è´¥ï¼š${O}ï¼Œç¿»è¯‘å®Œæˆåè¯·æ‰‹åŠ¨ä¿å­˜`)}}))){const O=i.progress.value;O.preSave=void 0}const B=f.mode;if(console.log(`ğŸš€ å¯åŠ¨å¹¶è¡Œç¿»è¯‘æ¨¡å¼: ${B}`),console.log(`   å›¾ç‰‡æ•°é‡: ${P.length}`),console.log(`   èµ·å§‹ç´¢å¼•: ${A}`),console.log(`   è‡ªåŠ¨ä¿å­˜: ${M?"å¯ç”¨":"ç¦ç”¨"}`),M){const W=i.progress.value;W.save={completed:0,total:P.length}}const $=await i.executeParallel(B,P,A);return $.success>0&&$.failed===0?s.success(`å¹¶è¡Œç¿»è¯‘å®Œæˆï¼ŒæˆåŠŸå¤„ç† ${$.success} å¼ å›¾ç‰‡`):$.success>0&&$.failed>0?s.warning(`å¹¶è¡Œç¿»è¯‘å®Œæˆï¼ŒæˆåŠŸ ${$.success} å¼ ï¼Œå¤±è´¥ ${$.failed} å¼ `):s.error("å¹¶è¡Œç¿»è¯‘å¤±è´¥"),{success:$.failed===0,completed:$.success,failed:$.failed,errors:$.errors}}catch(B){const $=B instanceof Error?B.message:"å¹¶è¡Œç¿»è¯‘å‡ºé”™";return s.error($),{success:!1,completed:0,failed:P.length,errors:[$]}}finally{const B=i.progress.value;B.preSave=void 0,B.save=void 0,M&&(console.log("[ParallelPipeline] å®Œæˆä¿å­˜..."),await Ln())}}function k(){o.cancel(),i.cancel(),Fn()}return{progress:o.progress,isExecuting:o.isExecuting,isTranslating:r,progressPercent:a,execute:u,cancel:k,STEP_CHAIN_CONFIGS:o.STEP_CHAIN_CONFIGS}}function cn(n="current",t){return{mode:"standard",scope:n,pageRange:t?.pageRange}}function Ii(n="all",t){return{mode:"hq",scope:n,pageRange:t?.pageRange,batchOptions:{batchSize:t?.batchSize??3,maxRetries:t?.maxRetries??2,rpmLimit:t?.rpmLimit??10,sessionResetFrequency:t?.sessionResetFrequency??5}}}function Pi(n="all",t){return{mode:"proofread",scope:n,pageRange:t?.pageRange,batchOptions:{batchSize:t?.batchSize??3,maxRetries:t?.maxRetries??2,rpmLimit:t?.rpmLimit??10,sessionResetFrequency:t?.sessionResetFrequency??5}}}function Ri(n="current",t){return{mode:"removeText",scope:n,pageRange:t?.pageRange}}function Di(n){if(n.length===0)return{startPage:1,endPage:0};const t=[...n].sort((i,r)=>i-r),s=t[0],o=t[t.length-1];return{startPage:(s??0)+1,endPage:(o??0)+1}}function vt(n,t){const s=[];for(let o=n;o<t;o++)s.push(o);return s}function ko(){const n=Ze(),t=ct(),s=rt(),o=Ti(),i=o.progress,r=o.isExecuting,a=o.isTranslating,u=o.progressPercent,p=j(()=>o.isExecuting.value),k=j(()=>o.isExecuting.value);async function f(V,se){if(V.length===0)return s.error("æ²¡æœ‰æŒ‡å®šè¦ç¿»è¯‘çš„é¡µé¢"),{success:!1,completed:0,failed:0,errors:["æ²¡æœ‰æŒ‡å®šè¦ç¿»è¯‘çš„é¡µé¢"]};const X=n.images.length;if(X===0)return s.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),{success:!1,completed:0,failed:0,errors:["è¯·å…ˆä¸Šä¼ å›¾ç‰‡"]};for(const F of V)if(F<0||F>=X)return s.error(`æ— æ•ˆçš„é¡µé¢ç´¢å¼•: ${F}`),{success:!1,completed:0,failed:0,errors:[`æ— æ•ˆçš„é¡µé¢ç´¢å¼•: ${F}`]};const ie=V.length===1,z=V.length===X;let R;if(ie){const F=n.currentImageIndex,y=V[0];y!==void 0&&n.setCurrentImageIndex(y),R=P(se,"current");const m=await o.execute(R);return n.setCurrentImageIndex(F),{success:m.success,completed:m.completed,failed:m.failed,errors:m.errors??[]}}else if(z)R=P(se,"all");else{const F=Di(V);R=P(se,"range",F)}const T=await o.execute(R);return{success:T.success,completed:T.completed,failed:T.failed,errors:T.errors??[]}}function P(V,se,X){switch(V){case"standard":return cn(se,X?{pageRange:X}:void 0);case"hq":return Ii(se,X?{pageRange:X}:void 0);case"proofread":return Pi(se,X?{pageRange:X}:void 0);case"removeText":return Ri(se,X?{pageRange:X}:void 0);default:return cn(se,X?{pageRange:X}:void 0)}}async function A(){return(await f([n.currentImageIndex],"standard")).success}async function M(V){return(await f([V],"standard")).success}async function B(){return(await f(vt(0,n.images.length),"standard")).success}async function $(V){const se=vt(V.startPage-1,V.endPage);return(await f(se,"standard")).success}function W(){o.cancel()}async function O(){return(await f([n.currentImageIndex],"removeText")).success}async function U(){return(await f(vt(0,n.images.length),"removeText")).success}async function g(V){const se=vt(V.startPage-1,V.endPage);return(await f(se,"removeText")).success}async function d(){const V=n.getFailedImageIndices();return V.length===0?(s.info("æ²¡æœ‰å¤±è´¥çš„å›¾ç‰‡éœ€è¦é‡æ–°ç¿»è¯‘"),!0):(await f(V,"standard")).success}async function x(V){const se=V?vt(V.startPage-1,V.endPage):vt(0,n.images.length);return(await f(se,"hq")).success}async function _(V){const se=V?vt(V.startPage-1,V.endPage):vt(0,n.images.length);return(await f(se,"proofread")).success}async function K(){if(!n.currentImage)return s.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;const se=t.bubbles;return!se||se.length===0?(s.error("å½“å‰å›¾ç‰‡æ²¡æœ‰æ°”æ³¡æ¡†ï¼Œè¯·å…ˆæ£€æµ‹æˆ–æ‰‹åŠ¨æ·»åŠ "),!1):(n.setManuallyAnnotated(!0),A())}return{progress:i,isTranslatingSingle:r,isHqTranslating:p,isProofreading:k,isTranslating:a,progressPercent:u,translatePages:f,range:vt,translateCurrentImage:A,translateImageByIndex:M,translateAllImages:B,translateImageRange:$,cancelBatchTranslation:W,removeTextOnly:O,removeAllTexts:U,removeTextRange:g,retryFailedImages:d,executeHqTranslation:x,executeProofreading:_,translateWithCurrentBubbles:K}}function Mi(){const n=ct(),t=Ze(),s=C(!1);function o(){if(!s.value)return;const i=t.currentImage;n.bubbleCount>0?t.updateCurrentBubbleStates([...n.bubbles]):i&&Array.isArray(i.bubbleStates)&&i.bubbleStates.length>0&&(t.updateCurrentBubbleStates([]),console.log("é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼ˆæ— é‡æ¸²æŸ“ï¼‰ï¼Œç”¨æˆ·å·²åˆ é™¤æ‰€æœ‰æ°”æ³¡")),s.value=!1,n.clearSelection(),console.log("å·²é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼ˆæ— é‡æ¸²æŸ“ï¼‰")}return{isActive:s,exitEditModeWithoutRender:o}}function Ei(){const n=vn(),t=ze(),s=Ze(),o=Tt(),i=ct(),r=Mi(),a=C(!1),u=C(!1),p=C(null),k=C([]),f=C([]),P=C([]),A=C(null),M=C(null),B=C(null),$=C(null),W=C(!1);async function O(z=!1){if(!z&&(a.value||u.value)){console.log("[TranslateInit] å·²ç»åˆå§‹åŒ–ï¼Œä»…é‡æ–°åŠ è½½ä¸Šä¸‹æ–‡"),await _();return}console.log("[TranslateInit] å¼€å§‹åˆå§‹åŒ–åº”ç”¨..."),a.value=!0,p.value=null;try{await U(),await g(),await d(),await x(),await _(),console.log("[TranslateInit] åº”ç”¨åˆå§‹åŒ–å®Œæˆ"),u.value=!0}catch(R){console.error("[TranslateInit] åº”ç”¨åˆå§‹åŒ–å¤±è´¥:",R),p.value=R instanceof Error?R.message:"åˆå§‹åŒ–å¤±è´¥"}finally{a.value=!1}}async function U(){console.log("[TranslateInit] åˆå§‹åŒ–è®¾ç½®..."),t.initSettings();try{const z=await t.loadFromBackend();console.log(z?"[TranslateInit] å·²ä»åç«¯åŠ è½½è®¾ç½®":"[TranslateInit] åç«¯æ— è®¾ç½®ï¼Œä½¿ç”¨ localStorage æ•°æ®")}catch(z){console.warn("[TranslateInit] ä»åç«¯åŠ è½½è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨ localStorage æ•°æ®:",z)}console.log("[TranslateInit] è®¾ç½®åˆå§‹åŒ–å®Œæˆ")}async function g(){console.log("[TranslateInit] åˆå§‹åŒ–å­—ä½“åˆ—è¡¨...");try{const z=await yn();z.fonts&&z.fonts.length>0?(k.value=z.fonts,console.log(`[TranslateInit] å·²åŠ è½½ ${z.fonts.length} ä¸ªå­—ä½“`)):z.error?console.warn("[TranslateInit] è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:",z.error):console.warn("[TranslateInit] å­—ä½“åˆ—è¡¨ä¸ºç©º")}catch(z){console.error("[TranslateInit] è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:",z)}}async function d(){console.log("[TranslateInit] åˆå§‹åŒ–ç¿»è¯‘æç¤ºè¯è®¾ç½®...");try{const z=await Ms();z.prompt_names!==void 0?(f.value=z.prompt_names||[],!t.settings.translatePrompt&&z.default_prompt_content&&t.setTranslatePrompt(z.default_prompt_content),console.log(`[TranslateInit] å·²åŠ è½½ ${f.value.length} ä¸ªç¿»è¯‘æç¤ºè¯`)):z.error&&console.warn("[TranslateInit] è·å–ç¿»è¯‘æç¤ºè¯å¤±è´¥:",z.error)}catch(z){console.error("[TranslateInit] è·å–ç¿»è¯‘æç¤ºè¯å¤±è´¥:",z)}}async function x(){console.log("[TranslateInit] åˆå§‹åŒ–æ–‡æœ¬æ¡†æç¤ºè¯è®¾ç½®...");try{const z=await Ds();z.prompt_names!==void 0?(P.value=z.prompt_names||[],!t.settings.textboxPrompt&&z.default_prompt_content&&t.setTextboxPrompt(z.default_prompt_content),console.log(`[TranslateInit] å·²åŠ è½½ ${P.value.length} ä¸ªæ–‡æœ¬æ¡†æç¤ºè¯`)):z.error&&console.warn("[TranslateInit] è·å–æ–‡æœ¬æ¡†æç¤ºè¯å¤±è´¥:",z.error)}catch(z){console.error("[TranslateInit] è·å–æ–‡æœ¬æ¡†æç¤ºè¯å¤±è´¥:",z)}}async function _(){const z=n.query.book,R=n.query.chapter;if(!z||!R){console.log("[TranslateInit] æœªæŒ‡å®šä¹¦ç±/ç« èŠ‚å‚æ•°ï¼Œä½¿ç”¨ç‹¬ç«‹æ¨¡å¼"),W.value=!1,A.value=null,M.value=null,B.value=null,$.value=null,o.clearContext();return}console.log(`[TranslateInit] æ£€æµ‹åˆ°ä¹¦ç±/ç« èŠ‚å‚æ•°: book=${z}, chapter=${R}`),W.value=!0,A.value=z,M.value=R;try{const T=await Bs(z);if(!T.success||!T.book){console.warn("[TranslateInit] ä¹¦ç±ä¸å­˜åœ¨:",z),xe("ä¹¦ç±ä¸å­˜åœ¨","warning");return}const F=T.book,y=F.chapters?.find(m=>m.id===R);if(!y){console.warn("[TranslateInit] ç« èŠ‚ä¸å­˜åœ¨:",R),xe("ç« èŠ‚ä¸å­˜åœ¨","warning");return}if(B.value=F.title,$.value=y.title,o.setBookChapterContext(z,R,F.title,y.title),typeof document<"u"&&(document.title=`${y.title} - ${F.title} - Saber-Translator`),y.session_path){console.log(`[TranslateInit] å°è¯•åŠ è½½ç« èŠ‚ä¼šè¯: ${y.session_path}`);try{await o.loadSessionByPath(y.session_path),xe(`å·²åŠ è½½ç« èŠ‚: ${y.title}`,"success")}catch{console.log("[TranslateInit] ç« èŠ‚ä¼šè¯æ•°æ®ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥ï¼Œå°†åˆ›å»ºæ–°ä¼šè¯")}}}catch(T){console.error("[TranslateInit] åŠ è½½ä¹¦ç±/ç« èŠ‚ä¿¡æ¯å¤±è´¥:",T),xe("åŠ è½½ä¹¦ç±ä¿¡æ¯å¤±è´¥","error")}}function K(z){if(z<0||z>=s.imageCount){console.warn(`[TranslateInit] æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${z}`);return}window._isChangingFromSwitchImage=!0,r.isActive.value&&r.exitEditModeWithoutRender(),s.currentImage&&i.bubbles.length>0&&s.updateCurrentImageProperty("bubbleStates",i.bubbles),s.setCurrentImageIndex(z);const T=s.currentImage;if(!T){console.warn("[TranslateInit] åˆ‡æ¢åˆ°çš„å›¾ç‰‡ä¸å­˜åœ¨"),window._isChangingFromSwitchImage=!1;return}console.log(`[TranslateInit] åˆ‡æ¢åˆ°å›¾ç‰‡: ${z}, ${T.fileName}`),T.bubbleStates&&T.bubbleStates.length>0?i.setBubbles(T.bubbleStates,!0):i.clearBubblesLocal(),V(T),setTimeout(()=>{window._isChangingFromSwitchImage=!1,console.log("[TranslateInit] å·²é‡ç½®åˆ‡æ¢å›¾ç‰‡æ“ä½œæ ‡è®°")},100)}function V(z){if(!z)return;const R=z.bubbleStates?.[0];R&&t.updateTextStyle({fontSize:R.fontSize||t.settings.textStyle.fontSize,fontFamily:R.fontFamily||t.settings.textStyle.fontFamily,layoutDirection:z.layoutDirection||t.settings.textStyle.layoutDirection,textColor:R.textColor||t.settings.textStyle.textColor,fillColor:R.fillColor||t.settings.textStyle.fillColor,strokeEnabled:R.strokeEnabled??t.settings.textStyle.strokeEnabled,strokeColor:R.strokeColor||t.settings.textStyle.strokeColor,strokeWidth:R.strokeWidth||t.settings.textStyle.strokeWidth,inpaintMethod:R.inpaintMethod||t.settings.textStyle.inpaintMethod,autoFontSize:z.autoFontSize??t.settings.textStyle.autoFontSize,useAutoTextColor:z.useAutoTextColor??t.settings.textStyle.useAutoTextColor})}function se(){s.canGoPrevious&&K(s.currentImageIndex-1)}function X(){s.canGoNext&&K(s.currentImageIndex+1)}function ie(){ut(async()=>{await O()})}return{isInitializing:a,isInitialized:u,initError:p,fontList:k,promptNames:f,textboxPromptNames:P,currentBookId:A,currentChapterId:M,currentBookTitle:B,currentChapterTitle:$,isBookshelfMode:W,initializeApp:O,initializeSettings:U,initializeFontList:g,initializePromptSettings:d,initializeTextboxPromptSettings:x,initializeBookChapterContext:_,switchImage:K,goToPrevious:se,goToNext:X,loadImageSettingsToStore:V,editMode:r,setupAutoInit:ie}}const Bi={key:0,id:"translationProgressBar",class:"translation-progress-bar"},Ai={class:"parallel-header"},Li={class:"header-title"},Fi={key:0,class:"presave-section"},Ui={class:"presave-label"},Oi={class:"presave-progress-bar"},zi={class:"pools-list"},Ni={class:"pool-label"},Vi={class:"pool-icon"},Wi={class:"pool-name"},Ki={class:"pool-progress-bar"},qi={class:"pool-stats"},Hi={class:"completed-count"},ji={class:"total-count"},Ji={key:0,class:"waiting-badge"},Yi={key:1,class:"lock-indicator",title:"ç­‰å¾…æ·±åº¦å­¦ä¹ é”"},Xi={key:0,class:"pool-row save-row"},Gi={class:"pool-progress-bar"},Zi={class:"pool-stats"},Qi={class:"completed-count"},er={class:"total-count"},tr={class:"overall-section"},or={class:"overall-label"},nr={key:0,class:"failed-text"},sr={class:"overall-progress-bar"},ar={class:"progress-bar-label"},lr={key:0,class:"failed-count"},ir={class:"progress-bar"},rr=je({__name:"TranslationProgress",props:{progress:{}},setup(n){const t=n,s=Ze(),o=ze(),i=ko(),r=So(),a=j(()=>{const d=r.progress.value?.preSave?.isRunning;return o.settings.parallel?.enabled&&(r.isRunning.value||d)}),u=j(()=>r.progress.value),p=j(()=>{const d=u.value;return!d||d.totalPages===0?0:Math.round(d.totalCompleted/d.totalPages*100)});function k(d){const x=u.value?.totalPages||0;return x===0?0:Math.round(d.completed/x*100)}function f(){const d=u.value?.totalPages||0;return d===0?0:Math.max(3,Math.round(1/d*100))}function P(){const d=u.value?.preSave;return!d||d.total===0?0:Math.round(d.current/d.total*100)}function A(){const d=u.value?.save;return!d||d.total===0?0:Math.round(d.completed/d.total*100)}const M=j(()=>t.progress||i.progress.value),B=j(()=>M.value.isInProgress||s.isBatchTranslationInProgress||a.value),$=j(()=>M.value.current),W=j(()=>M.value.total),O=j(()=>M.value.failed),U=j(()=>M.value.percentage!==void 0?M.value.percentage:W.value===0?0:Math.round($.value/W.value*100)),g=j(()=>M.value.label?M.value.label:`ç¿»è¯‘ä¸­ï¼š${$.value} / ${W.value}`);return(d,x)=>B.value?(E(),L("div",Bi,[a.value&&u.value?(E(),L(Oe,{key:0},[e("div",Ai,[e("span",Li,"ğŸš€ å¹¶è¡Œç¿»è¯‘ä¸­ï¼š"+ne(u.value.totalCompleted)+"/"+ne(u.value.totalPages),1)]),u.value.preSave?.isRunning?(E(),L("div",Fi,[e("div",Ui," ğŸ“¥ é¢„ä¿å­˜åŸå§‹å›¾ç‰‡ï¼š"+ne(u.value.preSave.current)+"/"+ne(u.value.preSave.total),1),e("div",Oi,[e("div",{class:"presave-progress-fill",style:ot({width:P()+"%"})},null,4)])])):de("",!0),e("div",zi,[(E(!0),L(Oe,null,Ye(u.value.pools,_=>(E(),L("div",{key:_.name,class:Ie(["pool-row",{"pool-processing":_.processing,"pool-waiting-lock":_.isWaitingLock}])},[e("div",Ni,[e("span",Vi,ne(_.icon),1),e("span",Wi,ne(_.name),1)]),e("div",Ki,[e("div",{class:"progress-completed",style:ot({width:k(_)+"%"})},null,4),_.processing?(E(),L("div",{key:0,class:"progress-processing",style:ot({left:k(_)+"%",width:f()+"%"})},null,4)):de("",!0)]),e("div",qi,[e("span",Hi,ne(_.completed),1),e("span",ji,"/ "+ne(u.value.totalPages),1),_.waiting>0?(E(),L("span",Ji,"+"+ne(_.waiting),1)):de("",!0),_.isWaitingLock?(E(),L("span",Yi,"ğŸ”’")):de("",!0)])],2))),128)),u.value.save?(E(),L("div",Xi,[x[0]||(x[0]=e("div",{class:"pool-label"},[e("span",{class:"pool-icon"},"ğŸ’¾"),e("span",{class:"pool-name"},"ä¿å­˜")],-1)),e("div",Gi,[e("div",{class:"progress-completed save-progress",style:ot({width:A()+"%"})},null,4)]),e("div",Zi,[e("span",Qi,ne(u.value.save.completed),1),e("span",er,"/ "+ne(u.value.save.total),1)])])):de("",!0)]),x[1]||(x[1]=e("div",{class:"divider"},null,-1)),e("div",tr,[e("div",or,[pe(" æ€»è¿›åº¦ï¼š"+ne(p.value)+"% ",1),u.value.totalFailed>0?(E(),L("span",nr," ï¼ˆ"+ne(u.value.totalFailed)+" å¤±è´¥ï¼‰ ",1)):de("",!0)]),e("div",sr,[e("div",{class:"overall-progress-fill",style:ot({width:p.value+"%"})},null,4)])])],64)):(E(),L(Oe,{key:1},[e("div",ar,[pe(ne(g.value)+" ",1),O.value>0?(E(),L("span",lr,"ï¼ˆ"+ne(O.value)+" å¼ å¤±è´¥ï¼‰",1)):de("",!0)]),e("div",ir,[e("div",{class:"progress",style:ot({width:`${U.value}%`})},null,4)])],64))])):de("",!0)}}),ur=He(rr,[["__scopeId","data-v-0d67647b"]]),cr=je({__name:"SponsorModal",emits:["close"],setup(n,{emit:t}){const s=t;return(o,i)=>(E(),it(xn,{title:"æ”¯æŒä½œè€…",onClose:i[1]||(i[1]=r=>s("close"))},{footer:_t(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:i[0]||(i[0]=r=>s("close"))},"å…³é—­")]),default:_t(()=>[i[2]||(i[2]=e("div",{class:"sponsor-content"},[e("p",{class:"sponsor-message"}," å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯·ä½œè€…å–æ¯å’–å•¡ â˜• "),e("div",{class:"qr-codes"},[e("div",{class:"qr-item"},[e("div",{class:"qr-image"},[e("img",{src:"/pic/wechat_qrcode.png",alt:"å¾®ä¿¡æ”¯ä»˜"})]),e("span",{class:"qr-label"},"å¾®ä¿¡æ”¯ä»˜")]),e("div",{class:"qr-item"},[e("div",{class:"qr-image"},[e("img",{src:"/pic/alipay_qrcode.png",alt:"æ”¯ä»˜å®"})]),e("span",{class:"qr-label"},"æ”¯ä»˜å®")])]),e("p",{class:"sponsor-thanks"},"æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼ğŸ™")],-1))]),_:1}))}}),dr=He(cr,[["__scopeId","data-v-02b6948e"]]);function gr(n){const t=C(""),s=j(()=>n.value.some(M=>M.folderPath)),o=j(()=>{if(!s.value)return null;const M={name:"æ ¹ç›®å½•",path:"",images:[],subfolders:[]},B=new Map;B.set("",M);for(const $ of n.value){const W=$.folderPath||"";if(W&&!B.has(W)){const O=W.split("/");let U="";for(const g of O){const d=U;if(U=U?`${U}/${g}`:g,!B.has(U)){const x={name:g,path:U,images:[],subfolders:[]};B.set(U,x),B.has(d)&&B.get(d).subfolders.push(x)}}}B.has(W)&&B.get(W).images.push($)}return M}),i=j(()=>{if(!t.value)return[{name:"æ ¹ç›®å½•",path:""}];const M=t.value.split("/"),B=[{name:"æ ¹ç›®å½•",path:""}];let $="";for(const W of M)$=$?`${$}/${W}`:W,B.push({name:W,path:$});return B}),r=j(()=>{if(!o.value)return null;if(!t.value)return o.value;const M=(B,$)=>{if(B.path===$)return B;for(const W of B.subfolders){const O=M(W,$);if(O)return O}return null};return M(o.value,t.value)}),a=j(()=>r.value?.subfolders||[]),u=j(()=>r.value?.images||[]);function p(M){t.value=M}function k(){if(!t.value)return;const M=t.value.lastIndexOf("/");t.value=M>0?t.value.substring(0,M):""}function f(M){t.value=M}function P(M){let B=M.images.length;for(const $ of M.subfolders)B+=P($);return B}function A(){t.value=""}return{currentFolderPath:t,useTreeMode:s,folderTree:o,breadcrumbs:i,currentFolder:r,currentSubfolders:a,currentImages:u,enterFolder:p,goUp:k,navigateTo:f,getFolderImageCount:P,resetToRoot:A}}const pr={id:"thumbnail-sidebar",class:"thumbnail-sidebar"},mr={class:"card thumbnail-card"},vr={class:"breadcrumb-nav"},fr=["onClick"],br={key:0,class:"breadcrumb-sep"},hr=["onClick"],yr={class:"folder-info"},xr=["title"],_r={class:"folder-count"},Cr=["title","onClick"],Sr=["src","alt"],kr={key:1,class:"translation-failed-indicator"},wr={key:2,class:"labeled-indicator"},$r={key:3,class:"thumbnail-processing-indicator"},Tr={key:0,class:"empty-folder"},Ir=["title","data-index","onClick"],Pr=["src","alt"],Rr={key:1,class:"translation-failed-indicator"},Dr={key:2,class:"labeled-indicator"},Mr={key:3,class:"thumbnail-processing-indicator"},Er={key:2,class:"empty-state"},Br=je({__name:"ThumbnailSidebar",emits:["select"],setup(n,{emit:t}){const s=t,o=Ze(),i=C(null),r=C([]),a=j(()=>o.images),u=j(()=>o.currentImageIndex),p=j(()=>o.hasImages),{useTreeMode:k,breadcrumbs:f,currentSubfolders:P,currentImages:A,currentFolderPath:M,enterFolder:B,goUp:$,navigateTo:W,getFolderImageCount:O,folderTree:U,resetToRoot:g}=gr(a);Se(()=>a.value.length,(R,T)=>{(R===0||T===0&&R>0)&&g()});function d(R){return a.value.findIndex(T=>T.id===R.id)}function x(R){return R.translationFailed?"failed":R.isManuallyAnnotated?"labeled":R.translationStatus==="processing"?"processing":null}function _(R){s("select",R)}function K(R){B(R.path)}function V(R){W(R)}function se(){dt(()=>{const R=r.value[u.value];if(R&&i.value){const T=i.value,F=R.offsetTop-T.clientHeight/2+R.clientHeight/2;T.scrollTo({top:Math.max(0,F),behavior:"smooth"})}})}function X(R,T){r.value[T]=R}function ie(R){const T=[];return R.translationFailed&&T.push("translation-failed"),R.isManuallyAnnotated&&T.push("has-manual-labels"),T}function z(R){return R.translationFailed?"ç¿»è¯‘å¤±è´¥ï¼Œç‚¹å‡»å¯é‡è¯•":R.isManuallyAnnotated?"åŒ…å«æ‰‹åŠ¨æ ‡æ³¨":R.fileName||""}return Se(u,()=>{se()}),ut(()=>{p.value&&se()}),(R,T)=>(E(),L("aside",pr,[e("div",mr,[T[5]||(T[5]=e("h2",null,"å›¾ç‰‡æ¦‚è§ˆ",-1)),p.value&&q(k)&&q(U)?(E(),L(Oe,{key:0},[e("div",vr,[(E(!0),L(Oe,null,Ye(q(f),(F,y)=>(E(),L(Oe,{key:F.path},[e("span",{class:Ie(["breadcrumb-item",{active:y===q(f).length-1}]),onClick:m=>y<q(f).length-1&&V(F.path)},ne(y===0?"ğŸ“":"")+ne(F.name),11,fr),y<q(f).length-1?(E(),L("span",br,"/")):de("",!0)],64))),128))]),q(M)?(E(),L("div",{key:0,class:"folder-back-btn",onClick:T[0]||(T[0]=(...F)=>q($)&&q($)(...F))},[...T[1]||(T[1]=[e("span",{class:"back-icon"},"â¬…ï¸",-1),e("span",null,"è¿”å›ä¸Šçº§",-1)])])):de("",!0),e("div",{ref_key:"containerRef",ref:i,class:"folder-content-list"},[(E(!0),L(Oe,null,Ye(q(P),F=>(E(),L("div",{key:F.path,class:"folder-item",onClick:y=>K(F)},[T[2]||(T[2]=e("span",{class:"folder-icon"},"ğŸ“",-1)),e("div",yr,[e("span",{class:"folder-name",title:F.name},ne(F.name),9,xr),e("span",_r,"("+ne(q(O)(F))+")",1)])],8,hr))),128)),(E(!0),L(Oe,null,Ye(q(A),F=>(E(),L("div",{key:F.id,ref_for:!0,ref:y=>X(y,d(F)),class:Ie(["thumbnail-item",[{active:d(F)===u.value},...ie(F)]]),title:z(F),onClick:y=>_(d(F))},[F.originalDataURL?(E(),L("img",{key:0,src:F.originalDataURL,alt:F.fileName,class:"thumbnail-image"},null,8,Sr)):de("",!0),x(F)==="failed"?(E(),L("span",kr,"!")):x(F)==="labeled"?(E(),L("span",wr,"âœï¸")):de("",!0),x(F)==="processing"?(E(),L("div",$r,"âŸ³")):de("",!0)],10,Cr))),128)),q(P).length===0&&q(A).length===0?(E(),L("div",Tr,[...T[3]||(T[3]=[e("p",null,"æ­¤æ–‡ä»¶å¤¹ä¸ºç©º",-1)])])):de("",!0)],512)],64)):p.value?(E(),L("ul",{key:1,ref_key:"containerRef",ref:i,id:"thumbnailList",class:"thumbnail-list"},[(E(!0),L(Oe,null,Ye(a.value,(F,y)=>(E(),L("li",{key:F.id,ref_for:!0,ref:m=>X(m,y),class:Ie(["thumbnail-item",[{active:y===u.value},...ie(F)]]),title:z(F),"data-index":y,onClick:m=>_(y)},[F.originalDataURL?(E(),L("img",{key:0,src:F.originalDataURL,alt:F.fileName,class:"thumbnail-image"},null,8,Pr)):de("",!0),x(F)==="failed"?(E(),L("span",Rr,"!")):x(F)==="labeled"?(E(),L("span",Dr,"âœï¸")):de("",!0),x(F)==="processing"?(E(),L("div",Mr," âŸ³ ")):de("",!0)],10,Ir))),128))],512)):(E(),L("div",Er,[...T[4]||(T[4]=[e("p",null,"æš‚æ— å›¾ç‰‡",-1)])]))])]))}}),Ar=He(Br,[["__scopeId","data-v-6aa1c6be"]]),Lr={class:"saved-prompts-picker"},Fr={class:"prompts-chips-container"},Ur={key:0,class:"empty-hint"},Or={key:1,class:"empty-hint"},zr=["title","onClick"],Nr=je({__name:"SavedPromptsPicker",props:{promptType:{}},emits:["select"],setup(n,{expose:t,emit:s}){const o=n,i=s,r=C([]),a=C(!1);async function u(){a.value=!0;try{let k;o.promptType==="textbox"?k=await qe.getTextboxPrompts():k=await qe.getPrompts(o.promptType);const f=k.prompt_names||[];r.value=f.map(P=>({name:P}))}catch(k){console.error("åŠ è½½æç¤ºè¯åˆ—è¡¨å¤±è´¥:",k),r.value=[]}finally{a.value=!1}}async function p(k){try{let f;o.promptType==="textbox"?f=await qe.getTextboxPromptContent(k):f=await qe.getPromptContent(o.promptType,k),f.prompt_content&&i("select",f.prompt_content,k)}catch(f){console.error("åŠ è½½æç¤ºè¯å†…å®¹å¤±è´¥:",f)}}return Se(()=>o.promptType,()=>{u()}),ut(()=>{u()}),t({refresh:u}),(k,f)=>(E(),L("div",Lr,[f[1]||(f[1]=e("span",{class:"picker-label"},"ğŸ“‘ å¿«é€Ÿé€‰æ‹©:",-1)),e("div",Fr,[a.value?(E(),L("span",Ur,"åŠ è½½ä¸­...")):r.value.length===0?(E(),L("span",Or,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(E(!0),L(Oe,{key:2},Ye(r.value,P=>(E(),L("button",{key:P.name,type:"button",class:"prompt-chip",title:P.name,onClick:A=>p(P.name)},[f[0]||(f[0]=e("span",{class:"chip-icon"},"ğŸ“",-1)),pe(" "+ne(P.name),1)],8,zr))),128))])]))}}),Lt=He(Nr,[["__scopeId","data-v-2ebbb8b3"]]),Vr={class:"ocr-settings"},Wr={class:"settings-group"},Kr={class:"settings-item"},qr={class:"settings-item"},Hr={class:"input-hint"},jr={class:"settings-group"},Jr={class:"settings-row"},Yr={class:"settings-item"},Xr={class:"password-input-wrapper"},Gr=["type"],Zr={key:0,class:"eye-icon"},Qr={key:1,class:"eye-off-icon"},eu={class:"settings-item"},tu={class:"password-input-wrapper"},ou=["type"],nu={key:0,class:"eye-icon"},su={key:1,class:"eye-off-icon"},au={class:"settings-row"},lu={class:"settings-item"},iu={class:"settings-item"},ru=["disabled"],uu={class:"settings-group"},cu={class:"settings-row"},du={class:"settings-item"},gu={class:"settings-item"},pu={class:"password-input-wrapper"},mu=["type"],vu={key:0,class:"eye-icon"},fu={key:1,class:"eye-off-icon"},bu={class:"settings-item"},hu={class:"settings-item"},yu={class:"model-input-with-fetch"},xu=["disabled"],_u={class:"fetch-text"},Cu={key:0,class:"model-select-container"},Su={class:"model-count"},ku={class:"settings-item"},wu={class:"prompt-format-selector"},$u={class:"settings-item"},Tu={class:"settings-item"},Iu=["disabled"],Pu=je({__name:"OcrSettings",setup(n){const t=[{label:"MangaOCR (æ—¥è¯­ä¸“ç”¨)",value:"manga_ocr"},{label:"PaddleOCR (å¤šè¯­è¨€)",value:"paddle_ocr"},{label:"PaddleOCR-VL (æ—¥æ¼«ä¸“ç”¨)",value:"paddleocr_vl"},{label:"ç™¾åº¦OCR",value:"baidu_ocr"},{label:"48px OCR",value:"48px_ocr"},{label:"AIè§†è§‰OCR",value:"ai_vision"}],s=[{label:"æ ‡å‡†ç‰ˆ",value:"standard"},{label:"é«˜ç²¾åº¦ç‰ˆ",value:"high_precision"}],o=[{label:"è‡ªåŠ¨æ£€æµ‹",value:"auto_detect"},{label:"ä¸­è‹±æ–‡æ··åˆ",value:"CHN_ENG"},{label:"è‹±æ–‡",value:"ENG"},{label:"æ—¥è¯­",value:"JAP"},{label:"éŸ©è¯­",value:"KOR"},{label:"æ³•è¯­",value:"FRE"},{label:"å¾·è¯­",value:"GER"},{label:"ä¿„è¯­",value:"RUS"}],i=[{label:"SiliconFlow (ç¡…åŸºæµåŠ¨)",value:"siliconflow"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai_vision"}],r=[{label:"æ™®é€šæç¤ºè¯",value:"false"},{label:"JSONæç¤ºè¯",value:"true"}],a=[{label:"ğŸš€ å¸¸ç”¨è¯­è¨€",options:[{label:"æ—¥è¯­",value:"japanese"},{label:"è‹±è¯­",value:"en"},{label:"ç®€ä½“ä¸­æ–‡",value:"chinese"},{label:"ç¹ä½“ä¸­æ–‡",value:"chinese_cht"},{label:"éŸ©è¯­",value:"korean"}]},{label:"ğŸŒ æ‹‰ä¸è¯­ç³»",options:[{label:"æ³•è¯­",value:"french"},{label:"å¾·è¯­",value:"german"},{label:"è¥¿ç­ç‰™è¯­",value:"spanish"},{label:"æ„å¤§åˆ©è¯­",value:"italian"},{label:"è‘¡è„ç‰™è¯­",value:"portuguese"}]},{label:"ğŸŒ å…¶ä»–è¯­ç³»",options:[{label:"ä¿„è¯­",value:"russian"}]}],u=ze(),p=rt(),k=C({apiKey:u.settings.baiduOcr.apiKey,secretKey:u.settings.baiduOcr.secretKey,version:u.settings.baiduOcr.version,sourceLanguage:u.settings.baiduOcr.sourceLanguage}),f=C({apiKey:u.settings.aiVisionOcr.apiKey,modelName:u.settings.aiVisionOcr.modelName,customBaseUrl:u.settings.aiVisionOcr.customBaseUrl,prompt:u.settings.aiVisionOcr.prompt,rpmLimit:u.settings.aiVisionOcr.rpmLimit,minImageSize:u.settings.aiVisionOcr.minImageSize}),P=j(()=>u.settings);Se(()=>k.value.apiKey,R=>{u.updateBaiduOcr({apiKey:R})}),Se(()=>k.value.secretKey,R=>{u.updateBaiduOcr({secretKey:R})}),Se(()=>k.value.version,R=>{u.updateBaiduOcr({version:R})}),Se(()=>k.value.sourceLanguage,R=>{u.updateBaiduOcr({sourceLanguage:R})}),Se(()=>f.value.apiKey,R=>{u.updateAiVisionOcr({apiKey:R})}),Se(()=>f.value.modelName,R=>{u.updateAiVisionOcr({modelName:R})}),Se(()=>f.value.customBaseUrl,R=>{u.updateAiVisionOcr({customBaseUrl:R})}),Se(()=>f.value.prompt,R=>{u.updateAiVisionOcr({prompt:R})}),Se(()=>f.value.rpmLimit,R=>{u.updateAiVisionOcr({rpmLimit:R})}),Se(()=>f.value.minImageSize,R=>{u.updateAiVisionOcr({minImageSize:R})});const A=C(!1),M=C(!1),B=C(!1),$=C(!1),W=C(!1),O=C([]),U=j(()=>{const R=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return O.value.forEach(T=>{R.push({label:T,value:T})}),R});function g(){u.saveToStorage()}function d(){u.saveToStorage()}function x(){switch(u.settings.ocrEngine){case"manga_ocr":return"MangaOCR ä¸“ä¸ºæ—¥è¯­æ¼«ç”»ä¼˜åŒ–ï¼Œæºè¯­è¨€è®¾ç½®ä¸å½±å“è¯†åˆ«";case"paddle_ocr":return"PaddleOCR ä¼šæ ¹æ®æºè¯­è¨€åŠ è½½å¯¹åº”çš„è¯†åˆ«æ¨¡å‹";case"paddleocr_vl":return"PaddleOCR-VL åŸºäº VLM å¾®è°ƒï¼Œä¸“ä¸ºæ—¥è¯­æ¼«ç”»ä¼˜åŒ–ï¼Œå‡†ç¡®ç‡é«˜è¾¾ 70%";case"baidu_ocr":return"ç™¾åº¦OCR ä½¿ç”¨ç‹¬ç«‹çš„æºè¯­è¨€è®¾ç½®ï¼ˆè§ä¸‹æ–¹ï¼‰";case"ai_vision":return"AIè§†è§‰OCR é€šè¿‡æç¤ºè¯æŒ‡å®šè¯†åˆ«è¯­è¨€";case"48px_ocr":return"48px OCR æ”¯æŒæ—¥ä¸­è‹±éŸ©ç­‰å¤šè¯­è¨€ï¼Œæºè¯­è¨€è®¾ç½®ä¸å½±å“è¯†åˆ«";default:return"é€‰æ‹©è¦è¯†åˆ«çš„åŸæ–‡è¯­è¨€"}}function _(R){u.setAiVisionOcrProvider(R),O.value=[],K()}function K(){f.value.apiKey=u.settings.aiVisionOcr.apiKey,f.value.modelName=u.settings.aiVisionOcr.modelName,f.value.customBaseUrl=u.settings.aiVisionOcr.customBaseUrl,f.value.prompt=u.settings.aiVisionOcr.prompt,f.value.rpmLimit=u.settings.aiVisionOcr.rpmLimit,f.value.minImageSize=u.settings.aiVisionOcr.minImageSize}function V(){const R=u.settings.aiVisionOcr.isJsonMode?gs:ps;u.updateAiVisionOcr({prompt:R}),f.value.prompt=R}async function se(){const R=k.value.apiKey?.trim(),T=k.value.secretKey?.trim();if(!R||!T){p.warning("è¯·å¡«å†™ç™¾åº¦OCRçš„API Keyå’ŒSecret Key");return}$.value=!0,p.info("æ­£åœ¨æµ‹è¯•ç™¾åº¦OCRè¿æ¥...");try{const F=await qe.testBaiduOcrConnection(R,T);F.success?p.success(F.message||"ç™¾åº¦OCRè¿æ¥æˆåŠŸ!"):p.error(F.message||F.error||"ç™¾åº¦OCRè¿æ¥å¤±è´¥")}catch(F){const y=F instanceof Error?F.message:"è¿æ¥æµ‹è¯•å¤±è´¥";p.error(y)}finally{$.value=!1}}async function X(){$.value=!0;try{const R=await qe.testAiVisionOcrConnection({provider:u.settings.aiVisionOcr.provider,apiKey:f.value.apiKey,modelName:f.value.modelName,customBaseUrl:f.value.customBaseUrl,prompt:f.value.prompt});R.success?p.success("AIè§†è§‰OCRè¿æ¥æˆåŠŸ"):p.error(`AIè§†è§‰OCRè¿æ¥å¤±è´¥: ${R.error||"æœªçŸ¥é”™è¯¯"}`)}catch(R){const T=R instanceof Error?R.message:"è¿æ¥æµ‹è¯•å¤±è´¥";p.error(T)}finally{$.value=!1}}async function ie(){const R=u.settings.aiVisionOcr.provider,T=f.value.apiKey?.trim(),F=f.value.customBaseUrl?.trim();if(!T){p.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","volcano","gemini","custom_openai_vision"].includes(R)){p.warning("å½“å‰æœåŠ¡å•†ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨");return}if(R==="custom_openai_vision"&&!F){p.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}W.value=!0;try{const m=await qe.fetchModels(R,T,F);m.success&&m.models&&m.models.length>0?(O.value=m.models.map(l=>l.id),p.success(`è·å–åˆ° ${m.models.length} ä¸ªæ¨¡å‹`)):p.warning(m.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(m){const l=m instanceof Error?m.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";p.error(l)}finally{W.value=!1}}function z(R,T){u.updateAiVisionOcr({prompt:R}),f.value.prompt=R,p.success(`å·²åº”ç”¨æç¤ºè¯: ${T}`)}return(R,T)=>(E(),L("div",Vr,[e("div",Wr,[T[20]||(T[20]=e("div",{class:"settings-group-title"},"OCRå¼•æ“é€‰æ‹©",-1)),e("div",Kr,[T[18]||(T[18]=e("label",{for:"settingsOcrEngine"},"OCRå¼•æ“:",-1)),Ce(Ke,{"model-value":P.value.ocrEngine,options:t,onChange:T[0]||(T[0]=F=>{P.value.ocrEngine=F,g()})},null,8,["model-value"])]),ae(e("div",qr,[T[19]||(T[19]=e("label",{for:"settingsSourceLanguage"},"æºè¯­è¨€:",-1)),Ce(Ke,{"model-value":P.value.sourceLanguage,groups:a,onChange:T[1]||(T[1]=F=>{P.value.sourceLanguage=F,d()})},null,8,["model-value"]),e("div",Hr,ne(x()),1)],512),[[Ue,P.value.ocrEngine==="paddle_ocr"]])]),ae(e("div",jr,[T[25]||(T[25]=e("div",{class:"settings-group-title"},"ç™¾åº¦OCR è®¾ç½®",-1)),e("div",Jr,[e("div",Yr,[T[21]||(T[21]=e("label",{for:"settingsBaiduApiKey"},"API Key:",-1)),e("div",Xr,[ae(e("input",{type:A.value?"text":"password",id:"settingsBaiduApiKey","onUpdate:modelValue":T[2]||(T[2]=F=>k.value.apiKey=F),class:"secure-input",placeholder:"è¯·è¾“å…¥ç™¾åº¦OCR API Key",autocomplete:"off"},null,8,Gr),[[kt,k.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:T[3]||(T[3]=F=>A.value=!A.value)},[A.value?(E(),L("span",Qr,"ğŸ‘â€ğŸ—¨")):(E(),L("span",Zr,"ğŸ‘"))])])]),e("div",eu,[T[22]||(T[22]=e("label",{for:"settingsBaiduSecretKey"},"Secret Key:",-1)),e("div",tu,[ae(e("input",{type:M.value?"text":"password",id:"settingsBaiduSecretKey","onUpdate:modelValue":T[4]||(T[4]=F=>k.value.secretKey=F),class:"secure-input",placeholder:"è¯·è¾“å…¥Secret Key",autocomplete:"off"},null,8,ou),[[kt,k.value.secretKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:T[5]||(T[5]=F=>M.value=!M.value)},[M.value?(E(),L("span",su,"ğŸ‘â€ğŸ—¨")):(E(),L("span",nu,"ğŸ‘"))])])])]),e("div",au,[e("div",lu,[T[23]||(T[23]=e("label",{for:"settingsBaiduVersion"},"è¯†åˆ«ç‰ˆæœ¬:",-1)),Ce(Ke,{modelValue:k.value.version,"onUpdate:modelValue":T[6]||(T[6]=F=>k.value.version=F),options:s},null,8,["modelValue"])]),e("div",iu,[T[24]||(T[24]=e("label",{for:"settingsBaiduSourceLanguage"},"æºè¯­è¨€:",-1)),Ce(Ke,{modelValue:k.value.sourceLanguage,"onUpdate:modelValue":T[7]||(T[7]=F=>k.value.sourceLanguage=F),options:o},null,8,["modelValue"])])]),e("button",{class:"settings-test-btn",onClick:se,disabled:$.value},ne($.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,ru)],512),[[Ue,P.value.ocrEngine==="baidu_ocr"]]),ae(e("div",uu,[T[37]||(T[37]=e("div",{class:"settings-group-title"},"AIè§†è§‰OCR è®¾ç½®",-1)),e("div",cu,[e("div",du,[T[26]||(T[26]=e("label",{for:"settingsAiVisionProvider"},"æœåŠ¡å•†:",-1)),Ce(Ke,{"model-value":P.value.aiVisionOcr.provider,options:i,onChange:T[8]||(T[8]=F=>_(F))},null,8,["model-value"])]),e("div",gu,[T[27]||(T[27]=e("label",{for:"settingsAiVisionApiKey"},"API Key:",-1)),e("div",pu,[ae(e("input",{type:B.value?"text":"password",id:"settingsAiVisionApiKey","onUpdate:modelValue":T[9]||(T[9]=F=>f.value.apiKey=F),class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,mu),[[kt,f.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:T[10]||(T[10]=F=>B.value=!B.value)},[B.value?(E(),L("span",fu,"ğŸ‘â€ğŸ—¨")):(E(),L("span",vu,"ğŸ‘"))])])])]),ae(e("div",bu,[T[28]||(T[28]=e("label",{for:"settingsCustomAiVisionBaseUrl"},"Base URL:",-1)),ae(e("input",{type:"text",id:"settingsCustomAiVisionBaseUrl","onUpdate:modelValue":T[11]||(T[11]=F=>f.value.customBaseUrl=F),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[$e,f.value.customBaseUrl]])],512),[[Ue,P.value.aiVisionOcr.provider==="custom_openai_vision"]]),e("div",hu,[T[30]||(T[30]=e("label",{for:"settingsAiVisionModelName"},"æ¨¡å‹åç§°:",-1)),e("div",yu,[ae(e("input",{type:"text",id:"settingsAiVisionModelName","onUpdate:modelValue":T[12]||(T[12]=F=>f.value.modelName=F),placeholder:"å¦‚: silicon-llava2-34b"},null,512),[[$e,f.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:ie,disabled:W.value},[T[29]||(T[29]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",_u,ne(W.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,xu)]),O.value.length>0?(E(),L("div",Cu,[Ce(Ke,{modelValue:f.value.modelName,"onUpdate:modelValue":T[13]||(T[13]=F=>f.value.modelName=F),options:U.value},null,8,["modelValue","options"]),e("span",Su,"å…± "+ne(O.value.length)+" ä¸ªæ¨¡å‹",1)])):de("",!0)]),e("div",ku,[T[32]||(T[32]=e("label",{for:"settingsAiVisionOcrPrompt"},"OCRæç¤ºè¯:",-1)),ae(e("textarea",{id:"settingsAiVisionOcrPrompt","onUpdate:modelValue":T[14]||(T[14]=F=>f.value.prompt=F),rows:"3",placeholder:"AIè§†è§‰OCRæç¤ºè¯"},null,512),[[$e,f.value.prompt]]),Ce(Lt,{"prompt-type":"ai_vision_ocr",onSelect:z}),e("div",wu,[Ce(Ke,{"model-value":P.value.aiVisionOcr.isJsonMode?"true":"false",options:r,onChange:T[15]||(T[15]=F=>{P.value.aiVisionOcr.isJsonMode=F==="true",V()})},null,8,["model-value"]),T[31]||(T[31]=e("span",{class:"input-hint"},"JSONæ ¼å¼è¾“å‡ºæ›´ç»“æ„åŒ–",-1))])]),e("div",$u,[T[33]||(T[33]=e("label",{for:"settingsRpmAiVisionOcr"},"RPMé™åˆ¶ (æ¯åˆ†é’Ÿè¯·æ±‚æ•°):",-1)),ae(e("input",{type:"number",id:"settingsRpmAiVisionOcr","onUpdate:modelValue":T[16]||(T[16]=F=>f.value.rpmLimit=F),min:"0",step:"1"},null,512),[[$e,f.value.rpmLimit,void 0,{number:!0}]]),T[34]||(T[34]=e("div",{class:"input-hint"},"0 è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",Tu,[T[35]||(T[35]=e("label",{for:"settingsMinImageSize"},"æœ€å°å›¾ç‰‡å°ºå¯¸ (åƒç´ ):",-1)),ae(e("input",{type:"number",id:"settingsMinImageSize","onUpdate:modelValue":T[17]||(T[17]=F=>f.value.minImageSize=F),min:"0",step:"1"},null,512),[[$e,f.value.minImageSize,void 0,{number:!0}]]),T[36]||(T[36]=e("div",{class:"input-hint"},"VLMæ¨¡å‹é€šå¸¸è¦æ±‚å›¾ç‰‡å°ºå¯¸ â‰¥28pxï¼Œè®¾ä¸º0åˆ™ä¸è‡ªåŠ¨æ”¾å¤§å°å›¾",-1))]),e("button",{class:"settings-test-btn",onClick:X,disabled:$.value},ne($.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,Iu)],512),[[Ue,P.value.ocrEngine==="ai_vision"]])]))}}),Ru=He(Pu,[["__scopeId","data-v-7aa08d65"]]),Du={class:"translation-settings"},Mu={class:"settings-group"},Eu={class:"settings-row"},Bu={class:"settings-item"},Au={class:"settings-item"},Lu={for:"settingsApiKey"},Fu={class:"password-input-wrapper"},Uu=["type","placeholder"],Ou={key:0,class:"eye-icon"},zu={key:1,class:"eye-off-icon"},Nu={class:"settings-item"},Vu={class:"settings-item"},Wu={for:"settingsModelName"},Ku={class:"model-input-with-fetch"},qu=["placeholder"],Hu=["disabled"],ju={class:"fetch-text"},Ju={key:0,class:"model-select-container"},Yu={class:"model-count"},Xu={class:"settings-item"},Gu={class:"local-model-list"},Zu={key:0,class:"model-list-container"},Qu=["disabled"],ec={key:1,class:"model-hint"},tc={key:1,class:"model-list-container"},oc=["disabled"],nc={key:1,class:"model-hint"},sc={class:"settings-row"},ac={class:"settings-item"},lc={class:"settings-item"},ic={class:"settings-item"},rc=["disabled"],uc={class:"settings-item"},cc=["disabled"],dc={class:"settings-group"},gc={class:"settings-item"},pc={class:"prompt-format-selector"},mc={class:"settings-item"},vc={class:"checkbox-label"},fc={class:"settings-item"},bc=je({__name:"TranslationSettings",setup(n){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"å½©äº‘å°è¯‘",value:"caiyun"},{label:"ç™¾åº¦ç¿»è¯‘",value:"baidu_translate"},{label:"æœ‰é“ç¿»è¯‘",value:"youdao_translate"},{label:"Google Gemini",value:"gemini"},{label:"Ollama (æœ¬åœ°)",value:"ollama"},{label:"Sakura (æœ¬åœ°)",value:"sakura"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],s=[{label:"æ™®é€šæç¤ºè¯",value:"normal"},{label:"JSONæç¤ºè¯",value:"json"}],o=ze(),i=rt(),r=C({modelProvider:o.settings.translation.provider,apiKey:o.settings.translation.apiKey,modelName:o.settings.translation.modelName,customBaseUrl:o.settings.translation.customBaseUrl,rpmTranslation:o.settings.translation.rpmLimit,translationMaxRetries:o.settings.translation.maxRetries,promptContent:o.settings.translatePrompt,translatePromptMode:o.settings.translation.isJsonMode?"json":"normal",enableTextboxPrompt:o.settings.useTextboxPrompt,textboxPromptContent:o.settings.textboxPrompt}),a=C(!1),u=C(!1),p=C(!1),k=C([]),f=C([]),P=C([]),A=j(()=>{const m=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return k.value.forEach(l=>m.push({label:l,value:l})),m}),M=j(()=>{const m=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return f.value.forEach(l=>m.push({label:l,value:l})),m}),B=j(()=>{const m=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return P.value.forEach(l=>m.push({label:l,value:l})),m}),$=j(()=>["ollama","sakura"].includes(r.value.modelProvider)),W=j(()=>!["ollama","sakura","caiyun","baidu_translate","youdao_translate"].includes(r.value.modelProvider)),O=j(()=>["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(r.value.modelProvider)),U=j(()=>{switch(r.value.modelProvider){case"baidu_translate":return"App ID";case"youdao_translate":return"App Key";case"caiyun":return"API Token";default:return"API Key"}}),g=j(()=>{switch(r.value.modelProvider){case"baidu_translate":return"è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘App ID";case"youdao_translate":return"è¯·è¾“å…¥æœ‰é“ç¿»è¯‘åº”ç”¨ID";case"caiyun":return"è¯·è¾“å…¥å½©äº‘å°è¯‘Token";default:return"è¯·è¾“å…¥API Key"}}),d=j(()=>{switch(r.value.modelProvider){case"baidu_translate":return"App Key";case"youdao_translate":return"App Secret";case"caiyun":return"æºè¯­è¨€ (å¯é€‰)";default:return"æ¨¡å‹åç§°"}}),x=j(()=>{switch(r.value.modelProvider){case"baidu_translate":return"è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘App Key";case"youdao_translate":return"è¯·è¾“å…¥æœ‰é“ç¿»è¯‘åº”ç”¨å¯†é’¥";case"caiyun":return"å¯é€‰: auto/æ—¥è¯­/è‹±è¯­";default:return"è¯·è¾“å…¥æ¨¡å‹åç§°"}});function _(){const m=r.value.modelProvider;o.setTranslationProvider(m),r.value.apiKey=o.settings.translation.apiKey,r.value.modelName=o.settings.translation.modelName,r.value.customBaseUrl=o.settings.translation.customBaseUrl,r.value.rpmTranslation=o.settings.translation.rpmLimit,r.value.translationMaxRetries=o.settings.translation.maxRetries,k.value=[]}function K(){const m=r.value.translatePromptMode==="json";m?r.value.promptContent=Ko:r.value.promptContent=qo,o.updateTranslationService({isJsonMode:m}),o.setTranslatePrompt(r.value.promptContent)}Se(()=>r.value.apiKey,m=>{o.updateTranslationService({apiKey:m})}),Se(()=>r.value.modelName,m=>{o.updateTranslationService({modelName:m})}),Se(()=>r.value.customBaseUrl,m=>{o.updateTranslationService({customBaseUrl:m})}),Se(()=>r.value.rpmTranslation,m=>{o.updateTranslationService({rpmLimit:m})}),Se(()=>r.value.translationMaxRetries,m=>{o.updateTranslationService({maxRetries:m})}),Se(()=>r.value.promptContent,m=>{o.setTranslatePrompt(m)}),Se(()=>r.value.enableTextboxPrompt,m=>{o.setUseTextboxPrompt(m)}),Se(()=>r.value.textboxPromptContent,m=>{o.setTextboxPrompt(m)});async function V(){const m=r.value.modelProvider,l=r.value.apiKey?.trim(),v=r.value.customBaseUrl?.trim();if(!l){i.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(m)){i.warning(`${se(m)} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`);return}if(m==="custom_openai"&&!v){i.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}p.value=!0;try{const S=await qe.fetchModels(m,l,v);S.success&&S.models&&S.models.length>0?(k.value=S.models.map(w=>w.id),i.success(`è·å–åˆ° ${S.models.length} ä¸ªæ¨¡å‹`)):i.warning(S.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(S){const w=S instanceof Error?S.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";i.error(w)}finally{p.value=!1}}function se(m){return{siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰OpenAI",ollama:"Ollama",sakura:"Sakura",caiyun:"å½©äº‘å°è¯‘",baidu_translate:"ç™¾åº¦ç¿»è¯‘",youdao_translate:"æœ‰é“ç¿»è¯‘"}[m]||m}async function X(){p.value=!0;try{const m=await qe.testOllamaConnection();m.success&&m.models?(f.value=m.models,i.success(`è·å–åˆ° ${m.models.length} ä¸ªOllamaæ¨¡å‹`)):i.error(m.error||"Ollamaè¿æ¥å¤±è´¥")}catch(m){const l=m instanceof Error?m.message:"è·å–Ollamaæ¨¡å‹å¤±è´¥";i.error(l)}finally{p.value=!1}}async function ie(){p.value=!0;try{const m=await qe.testSakuraConnection();m.success&&m.models?(P.value=m.models,i.success(`è·å–åˆ° ${m.models.length} ä¸ªSakuraæ¨¡å‹`)):i.error(m.error||"Sakuraè¿æ¥å¤±è´¥")}catch(m){const l=m instanceof Error?m.message:"è·å–Sakuraæ¨¡å‹å¤±è´¥";i.error(l)}finally{p.value=!1}}async function z(){u.value=!0;try{let m;r.value.modelProvider==="ollama"?m=await qe.testOllamaConnection():m=await qe.testSakuraConnection(),m.success?i.success(`${r.value.modelProvider==="ollama"?"Ollama":"Sakura"} è¿æ¥æˆåŠŸ`):i.error(m.error||"è¿æ¥å¤±è´¥")}catch(m){const l=m instanceof Error?m.message:"è¿æ¥æµ‹è¯•å¤±è´¥";i.error(l)}finally{u.value=!1}}async function R(){const m=r.value.modelProvider,l=r.value.apiKey?.trim(),v=r.value.modelName?.trim(),D=r.value.customBaseUrl?.trim();if(!l){i.warning("è¯·å…ˆå¡«å†™ API Key");return}if(m!=="caiyun"&&!v){i.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}if(m==="custom_openai"&&!D){i.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å¡«å†™ Base URL");return}u.value=!0,i.info("æ­£åœ¨æµ‹è¯•è¿æ¥...");try{let S;switch(m){case"baidu_translate":S=await qe.testBaiduTranslateConnection(l,v);break;case"youdao_translate":S=await qe.testYoudaoTranslateConnection(l,v);break;default:S=await qe.testAiTranslateConnection({provider:m,apiKey:l,modelName:v,baseUrl:D})}S.success?i.success(S.message||`${se(m)} è¿æ¥æˆåŠŸ!`):i.error(S.message||S.error||"è¿æ¥å¤±è´¥")}catch(S){const w=S instanceof Error?S.message:"è¿æ¥æµ‹è¯•å¤±è´¥";i.error(w)}finally{u.value=!1}}function T(m,l){r.value.promptContent=m,i.success(`å·²åº”ç”¨æç¤ºè¯: ${l}`)}function F(m,l){r.value.textboxPromptContent=m,i.success(`å·²åº”ç”¨æç¤ºè¯: ${l}`)}function y(){r.value.translatePromptMode==="json"?r.value.promptContent=Ko:r.value.promptContent=qo,i.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}return(m,l)=>(E(),L("div",Du,[e("div",Mu,[l[21]||(l[21]=e("div",{class:"settings-group-title"},"ç¿»è¯‘æœåŠ¡é…ç½®",-1)),e("div",Eu,[e("div",Bu,[l[14]||(l[14]=e("label",{for:"settingsModelProvider"},"ç¿»è¯‘æœåŠ¡å•†:",-1)),Ce(Ke,{"model-value":r.value.modelProvider,options:t,onChange:l[0]||(l[0]=v=>{r.value.modelProvider=v,_()})},null,8,["model-value"])]),ae(e("div",Au,[e("label",Lu,ne(U.value)+":",1),e("div",Fu,[ae(e("input",{type:a.value?"text":"password",id:"settingsApiKey","onUpdate:modelValue":l[1]||(l[1]=v=>r.value.apiKey=v),class:"secure-input",placeholder:g.value,autocomplete:"off"},null,8,Uu),[[kt,r.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:l[2]||(l[2]=v=>a.value=!a.value)},[a.value?(E(),L("span",zu,"ğŸ‘â€ğŸ—¨")):(E(),L("span",Ou,"ğŸ‘"))])])],512),[[Ue,!$.value]])]),ae(e("div",Nu,[l[15]||(l[15]=e("label",{for:"settingsCustomBaseUrl"},"Base URL:",-1)),ae(e("input",{type:"text",id:"settingsCustomBaseUrl","onUpdate:modelValue":l[3]||(l[3]=v=>r.value.customBaseUrl=v),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[$e,r.value.customBaseUrl]])],512),[[Ue,r.value.modelProvider==="custom_openai"]]),ae(e("div",Vu,[e("label",Wu,ne(d.value)+":",1),e("div",Ku,[ae(e("input",{type:"text",id:"settingsModelName","onUpdate:modelValue":l[4]||(l[4]=v=>r.value.modelName=v),placeholder:x.value},null,8,qu),[[$e,r.value.modelName]]),ae(e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:V,disabled:p.value},[l[16]||(l[16]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",ju,ne(p.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,Hu),[[Ue,O.value]])]),k.value.length>0?(E(),L("div",Ju,[Ce(Ke,{"model-value":r.value.modelName,options:A.value,onChange:l[5]||(l[5]=v=>{r.value.modelName=v})},null,8,["model-value","options"]),e("span",Yu,"å…± "+ne(k.value.length)+" ä¸ªæ¨¡å‹",1)])):de("",!0)],512),[[Ue,!$.value]]),ae(e("div",Xu,[l[17]||(l[17]=e("label",null,"æœ¬åœ°æ¨¡å‹:",-1)),e("div",Gu,[r.value.modelProvider==="ollama"?(E(),L("div",Zu,[e("button",{class:"settings-test-btn",onClick:X,disabled:p.value},ne(p.value?"è·å–ä¸­...":"ğŸ”„ åˆ·æ–°æ¨¡å‹åˆ—è¡¨"),9,Qu),f.value.length>0?(E(),it(Ke,{key:0,"model-value":r.value.modelName,options:M.value,onChange:l[6]||(l[6]=v=>r.value.modelName=v)},null,8,["model-value","options"])):(E(),L("p",ec,"ç‚¹å‡»åˆ·æ–°è·å–å¯ç”¨æ¨¡å‹"))])):r.value.modelProvider==="sakura"?(E(),L("div",tc,[e("button",{class:"settings-test-btn",onClick:ie,disabled:p.value},ne(p.value?"è·å–ä¸­...":"ğŸ”„ åˆ·æ–°æ¨¡å‹åˆ—è¡¨"),9,oc),P.value.length>0?(E(),it(Ke,{key:0,"model-value":r.value.modelName,options:B.value,onChange:l[7]||(l[7]=v=>r.value.modelName=v)},null,8,["model-value","options"])):(E(),L("p",nc,"ç‚¹å‡»åˆ·æ–°è·å–å¯ç”¨æ¨¡å‹"))])):de("",!0)])],512),[[Ue,$.value]]),ae(e("div",sc,[e("div",ac,[l[18]||(l[18]=e("label",{for:"settingsRpmTranslation"},"RPMé™åˆ¶:",-1)),ae(e("input",{type:"number",id:"settingsRpmTranslation","onUpdate:modelValue":l[8]||(l[8]=v=>r.value.rpmTranslation=v),min:"0",step:"1"},null,512),[[$e,r.value.rpmTranslation,void 0,{number:!0}]]),l[19]||(l[19]=e("div",{class:"input-hint"},"æ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",lc,[l[20]||(l[20]=e("label",{for:"settingsTranslationMaxRetries"},"é‡è¯•æ¬¡æ•°:",-1)),ae(e("input",{type:"number",id:"settingsTranslationMaxRetries","onUpdate:modelValue":l[9]||(l[9]=v=>r.value.translationMaxRetries=v),min:"0",max:"10",step:"1"},null,512),[[$e,r.value.translationMaxRetries,void 0,{number:!0}]])])],512),[[Ue,W.value]]),ae(e("div",ic,[e("button",{class:"settings-test-btn",onClick:z,disabled:u.value},ne(u.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,rc)],512),[[Ue,$.value]]),ae(e("div",uc,[e("button",{class:"settings-test-btn",onClick:R,disabled:u.value},ne(u.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,cc)],512),[[Ue,!$.value]])]),e("div",dc,[l[26]||(l[26]=e("div",{class:"settings-group-title"},"æç¤ºè¯è®¾ç½®",-1)),e("div",gc,[l[23]||(l[23]=e("label",{for:"settingsPromptContent"},"ç¿»è¯‘æç¤ºè¯:",-1)),ae(e("textarea",{id:"settingsPromptContent","onUpdate:modelValue":l[10]||(l[10]=v=>r.value.promptContent=v),rows:"4",placeholder:"ç¿»è¯‘æç¤ºè¯"},null,512),[[$e,r.value.promptContent]]),e("div",pc,[Ce(Ke,{"model-value":r.value.translatePromptMode,options:s,onChange:l[11]||(l[11]=v=>{r.value.translatePromptMode=v,K()})},null,8,["model-value"]),l[22]||(l[22]=e("span",{class:"input-hint"},"JSONæ ¼å¼è¾“å‡ºæ›´ç»“æ„åŒ–",-1))]),Ce(Lt,{"prompt-type":"translate",onSelect:T}),e("button",{type:"button",class:"reset-btn",onClick:y}," é‡ç½®ä¸ºé»˜è®¤ ")]),e("div",mc,[e("label",vc,[ae(e("input",{type:"checkbox","onUpdate:modelValue":l[12]||(l[12]=v=>r.value.enableTextboxPrompt=v)},null,512),[[et,r.value.enableTextboxPrompt]]),l[24]||(l[24]=pe(" å¯ç”¨æ–‡æœ¬æ¡†æç¤ºè¯ ",-1))])]),ae(e("div",fc,[l[25]||(l[25]=e("label",{for:"settingsTextboxPromptContent"},"æ–‡æœ¬æ¡†æç¤ºè¯:",-1)),ae(e("textarea",{id:"settingsTextboxPromptContent","onUpdate:modelValue":l[13]||(l[13]=v=>r.value.textboxPromptContent=v),rows:"3",placeholder:"æ–‡æœ¬æ¡†æç¤ºè¯"},null,512),[[$e,r.value.textboxPromptContent]]),Ce(Lt,{"prompt-type":"textbox",onSelect:F})],512),[[Ue,r.value.enableTextboxPrompt]])])]))}}),hc=He(bc,[["__scopeId","data-v-1eaa2d97"]]),yc={class:"detection-settings"},xc={class:"settings-group"},_c={class:"settings-item"},Cc={class:"settings-group"},Sc={class:"settings-item"},kc={class:"settings-row"},wc={class:"settings-item"},$c={class:"settings-item"},Tc={class:"settings-row"},Ic={class:"settings-item"},Pc={class:"settings-item"},Rc={class:"settings-group"},Dc={class:"settings-item"},Mc={class:"checkbox-label"},Ec={class:"settings-row"},Bc={class:"settings-item"},Ac={class:"settings-item"},Lc={class:"settings-group"},Fc={class:"settings-item"},Uc={class:"checkbox-label"},Oc=je({__name:"DetectionSettings",setup(n){const t=[{label:"CTD (Comic Text Detector)",value:"ctd"},{label:"YOLO",value:"yolo"},{label:"YOLOv5",value:"yolov5"},{label:"Default (DBNet)",value:"default"}],s=ze(),o=fo({textDetector:s.settings.textDetector,boxExpandRatio:s.settings.boxExpand.ratio,boxExpandTop:s.settings.boxExpand.top,boxExpandBottom:s.settings.boxExpand.bottom,boxExpandLeft:s.settings.boxExpand.left,boxExpandRight:s.settings.boxExpand.right,usePreciseMask:s.settings.preciseMask.enabled,maskDilateSize:s.settings.preciseMask.dilateSize,maskBoxExpandRatio:s.settings.preciseMask.boxExpandRatio,showDetectionDebug:s.settings.showDetectionDebug}),i=j(()=>["ctd","default"].includes(o.textDetector));Se(()=>o.textDetector,a=>{s.setTextDetector(a)}),Se(()=>o.boxExpandRatio,a=>{s.updateBoxExpand({ratio:a})}),Se(()=>o.boxExpandTop,a=>{s.updateBoxExpand({top:a})}),Se(()=>o.boxExpandBottom,a=>{s.updateBoxExpand({bottom:a})}),Se(()=>o.boxExpandLeft,a=>{s.updateBoxExpand({left:a})}),Se(()=>o.boxExpandRight,a=>{s.updateBoxExpand({right:a})}),Se(()=>o.usePreciseMask,a=>{s.updatePreciseMask({enabled:a})}),Se(()=>o.maskDilateSize,a=>{s.updatePreciseMask({dilateSize:a})}),Se(()=>o.maskBoxExpandRatio,a=>{s.updatePreciseMask({boxExpandRatio:a})}),Se(()=>o.showDetectionDebug,a=>{s.setShowDetectionDebug(a)});function r(){i.value||(o.usePreciseMask=!1)}return(a,u)=>(E(),L("div",yc,[e("div",xc,[u[11]||(u[11]=e("div",{class:"settings-group-title"},"æ–‡å­—æ£€æµ‹å™¨",-1)),e("div",_c,[u[10]||(u[10]=e("label",{for:"settingsTextDetector"},"æ£€æµ‹å™¨ç±»å‹:",-1)),Ce(Ke,{modelValue:o.textDetector,"onUpdate:modelValue":u[0]||(u[0]=p=>o.textDetector=p),options:t,onChange:r},null,8,["modelValue"])])]),e("div",Cc,[u[18]||(u[18]=e("div",{class:"settings-group-title"},"æ–‡æœ¬æ¡†æ‰©å±•å‚æ•°",-1)),e("div",Sc,[u[12]||(u[12]=e("label",{for:"settingsBoxExpandRatio"},"æ•´ä½“æ‰©å±• (%):",-1)),ae(e("input",{type:"number",id:"settingsBoxExpandRatio","onUpdate:modelValue":u[1]||(u[1]=p=>o.boxExpandRatio=p),min:"0",max:"50",step:"1"},null,512),[[$e,o.boxExpandRatio,void 0,{number:!0}]]),u[13]||(u[13]=e("div",{class:"input-hint"},"å‘å››å‘¨å‡åŒ€æ‰©å±•çš„ç™¾åˆ†æ¯” (0-50%)",-1))]),e("div",kc,[e("div",wc,[u[14]||(u[14]=e("label",{for:"settingsBoxExpandTop"},"ä¸Šæ–¹æ‰©å±• (%):",-1)),ae(e("input",{type:"number",id:"settingsBoxExpandTop","onUpdate:modelValue":u[2]||(u[2]=p=>o.boxExpandTop=p),min:"0",max:"50",step:"1"},null,512),[[$e,o.boxExpandTop,void 0,{number:!0}]])]),e("div",$c,[u[15]||(u[15]=e("label",{for:"settingsBoxExpandBottom"},"ä¸‹æ–¹æ‰©å±• (%):",-1)),ae(e("input",{type:"number",id:"settingsBoxExpandBottom","onUpdate:modelValue":u[3]||(u[3]=p=>o.boxExpandBottom=p),min:"0",max:"50",step:"1"},null,512),[[$e,o.boxExpandBottom,void 0,{number:!0}]])])]),e("div",Tc,[e("div",Ic,[u[16]||(u[16]=e("label",{for:"settingsBoxExpandLeft"},"å·¦ä¾§æ‰©å±• (%):",-1)),ae(e("input",{type:"number",id:"settingsBoxExpandLeft","onUpdate:modelValue":u[4]||(u[4]=p=>o.boxExpandLeft=p),min:"0",max:"50",step:"1"},null,512),[[$e,o.boxExpandLeft,void 0,{number:!0}]])]),e("div",Pc,[u[17]||(u[17]=e("label",{for:"settingsBoxExpandRight"},"å³ä¾§æ‰©å±• (%):",-1)),ae(e("input",{type:"number",id:"settingsBoxExpandRight","onUpdate:modelValue":u[5]||(u[5]=p=>o.boxExpandRight=p),min:"0",max:"50",step:"1"},null,512),[[$e,o.boxExpandRight,void 0,{number:!0}]])])])]),ae(e("div",Rc,[u[25]||(u[25]=e("div",{class:"settings-group-title"},"ç²¾ç¡®æ–‡å­—æ©è†œ",-1)),e("div",Dc,[e("label",Mc,[ae(e("input",{type:"checkbox","onUpdate:modelValue":u[6]||(u[6]=p=>o.usePreciseMask=p)},null,512),[[et,o.usePreciseMask]]),u[19]||(u[19]=pe(" å¯ç”¨ç²¾ç¡®æ–‡å­—æ©è†œ ",-1))]),u[20]||(u[20]=e("div",{class:"input-hint"},"ä½¿ç”¨æ›´ç²¾ç¡®çš„æ–‡å­—åŒºåŸŸæ©è†œè¿›è¡Œä¿®å¤",-1))]),ae(e("div",Ec,[e("div",Bc,[u[21]||(u[21]=e("label",{for:"settingsMaskDilateSize"},"è†¨èƒ€å¤§å°:",-1)),ae(e("input",{type:"number",id:"settingsMaskDilateSize","onUpdate:modelValue":u[7]||(u[7]=p=>o.maskDilateSize=p),min:"0",step:"1"},null,512),[[$e,o.maskDilateSize,void 0,{number:!0}]]),u[22]||(u[22]=e("div",{class:"input-hint"},"æ©è†œè†¨èƒ€åƒç´ æ•°",-1))]),e("div",Ac,[u[23]||(u[23]=e("label",{for:"settingsMaskBoxExpandRatio"},"æ ‡æ³¨æ¡†æ‰©å¤§æ¯”ä¾‹ (%):",-1)),ae(e("input",{type:"number",id:"settingsMaskBoxExpandRatio","onUpdate:modelValue":u[8]||(u[8]=p=>o.maskBoxExpandRatio=p),min:"0",max:"100",step:"1"},null,512),[[$e,o.maskBoxExpandRatio,void 0,{number:!0}]]),u[24]||(u[24]=e("div",{class:"input-hint"},"æ ‡æ³¨æ¡†åŒºåŸŸæ‰©å¤§ç™¾åˆ†æ¯”",-1))])],512),[[Ue,o.usePreciseMask]])],512),[[Ue,i.value]]),e("div",Lc,[u[28]||(u[28]=e("div",{class:"settings-group-title"},"è°ƒè¯•é€‰é¡¹",-1)),e("div",Fc,[e("label",Uc,[ae(e("input",{type:"checkbox","onUpdate:modelValue":u[9]||(u[9]=p=>o.showDetectionDebug=p)},null,512),[[et,o.showDetectionDebug]]),u[26]||(u[26]=pe(" æ˜¾ç¤ºæ£€æµ‹æ¡†è°ƒè¯•ä¿¡æ¯ ",-1))]),u[27]||(u[27]=e("div",{class:"input-hint"},"åœ¨ç¿»è¯‘ç»“æœä¸­æ˜¾ç¤ºæ°”æ³¡æ£€æµ‹æ¡†ï¼Œç”¨äºè°ƒè¯•",-1))])])]))}}),zc=He(Oc,[["__scopeId","data-v-c12c43ee"]]),Nc={class:"hq-translation-settings"},Vc={class:"settings-group"},Wc={class:"settings-row"},Kc={class:"settings-item"},qc={class:"settings-item"},Hc={class:"password-input-wrapper"},jc=["type"],Jc={key:0,class:"eye-icon"},Yc={key:1,class:"eye-off-icon"},Xc={class:"settings-item"},Gc={class:"settings-item"},Zc={class:"model-input-with-fetch"},Qc=["disabled"],ed={class:"fetch-text"},td={key:0,class:"model-select-container"},od={class:"model-count"},nd={class:"settings-item"},sd=["disabled"],ad={class:"settings-group"},ld={class:"settings-row"},id={class:"settings-item"},rd={class:"settings-item"},ud={class:"settings-row"},cd={class:"settings-item"},dd={class:"settings-item"},gd={class:"settings-group"},pd={class:"settings-row"},md={class:"settings-item"},vd={class:"checkbox-label"},fd={class:"settings-item"},bd={class:"settings-row"},hd={class:"settings-item"},yd={class:"checkbox-label"},xd={class:"settings-item"},_d={class:"checkbox-label"},Cd={class:"settings-group"},Sd={class:"settings-item"},kd=je({__name:"HqTranslationSettings",setup(n){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],s=[{label:"Geminié£æ ¼ (reasoning_effort=low)",value:"gemini"},{label:"ç«å±±å¼•æ“é£æ ¼ (thinking=null)",value:"volcano"}],o=ze(),i=rt(),r=j(()=>o.settings.hqTranslation),a=C({apiKey:o.settings.hqTranslation.apiKey,modelName:o.settings.hqTranslation.modelName,customBaseUrl:o.settings.hqTranslation.customBaseUrl,batchSize:o.settings.hqTranslation.batchSize,sessionReset:o.settings.hqTranslation.sessionReset,rpmLimit:o.settings.hqTranslation.rpmLimit,maxRetries:o.settings.hqTranslation.maxRetries,lowReasoning:o.settings.hqTranslation.lowReasoning,noThinkingMethod:o.settings.hqTranslation.noThinkingMethod,forceJsonOutput:o.settings.hqTranslation.forceJsonOutput,useStream:o.settings.hqTranslation.useStream,prompt:o.settings.hqTranslation.prompt});Se(()=>a.value.apiKey,g=>{o.updateHqTranslation({apiKey:g})}),Se(()=>a.value.modelName,g=>{o.updateHqTranslation({modelName:g})}),Se(()=>a.value.customBaseUrl,g=>{o.updateHqTranslation({customBaseUrl:g})}),Se(()=>a.value.batchSize,g=>{o.updateHqTranslation({batchSize:g})}),Se(()=>a.value.sessionReset,g=>{o.updateHqTranslation({sessionReset:g})}),Se(()=>a.value.rpmLimit,g=>{o.updateHqTranslation({rpmLimit:g})}),Se(()=>a.value.maxRetries,g=>{o.updateHqTranslation({maxRetries:g})}),Se(()=>a.value.lowReasoning,g=>{o.updateHqTranslation({lowReasoning:g})}),Se(()=>a.value.noThinkingMethod,g=>{o.updateHqTranslation({noThinkingMethod:g})}),Se(()=>a.value.forceJsonOutput,g=>{o.updateHqTranslation({forceJsonOutput:g})}),Se(()=>a.value.useStream,g=>{o.updateHqTranslation({useStream:g})}),Se(()=>a.value.prompt,g=>{o.updateHqTranslation({prompt:g})});const u=C(!1),p=C(!1),k=C([]),f=C(!1),P=j(()=>{const g=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return k.value.forEach(d=>g.push({label:d,value:d})),g});function A(g){o.setHqProvider(g),k.value=[],M()}function M(){const g=o.settings.hqTranslation;a.value.apiKey=g.apiKey,a.value.modelName=g.modelName,a.value.customBaseUrl=g.customBaseUrl,a.value.batchSize=g.batchSize,a.value.sessionReset=g.sessionReset,a.value.rpmLimit=g.rpmLimit,a.value.maxRetries=g.maxRetries,a.value.lowReasoning=g.lowReasoning,a.value.noThinkingMethod=g.noThinkingMethod,a.value.forceJsonOutput=g.forceJsonOutput,a.value.useStream=g.useStream,a.value.prompt=g.prompt}function B(g){return{siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰OpenAI"}[g]||g}async function $(){const g=r.value.provider,d=a.value.apiKey?.trim(),x=a.value.customBaseUrl?.trim();if(!d){i.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(g)){i.warning(`${B(g)} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`);return}if(g==="custom_openai"&&!x){i.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}p.value=!0;try{const K=await qe.fetchModels(g,d,x);K.success&&K.models&&K.models.length>0?(k.value=K.models.map(V=>V.id),i.success(`è·å–åˆ° ${K.models.length} ä¸ªæ¨¡å‹`)):i.warning(K.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(K){const V=K instanceof Error?K.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";i.error(V)}finally{p.value=!1}}async function W(){const g=r.value.provider,d=a.value.apiKey?.trim(),x=a.value.modelName?.trim(),_=a.value.customBaseUrl?.trim();if(!d){i.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!x){i.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}if(g==="custom_openai"&&!_){i.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å¡«å†™ Base URL");return}f.value=!0,i.info("æ­£åœ¨æµ‹è¯•è¿æ¥...");try{const K=await qe.testAiTranslateConnection({provider:g,apiKey:d,modelName:x,baseUrl:_});K.success?i.success(K.message||`${B(g)} è¿æ¥æˆåŠŸ!`):i.error(K.message||K.error||"è¿æ¥å¤±è´¥")}catch(K){const V=K instanceof Error?K.message:"è¿æ¥æµ‹è¯•å¤±è´¥";i.error(V)}finally{f.value=!1}}function O(){o.updateHqTranslation({prompt:Ho}),a.value.prompt=Ho,i.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}function U(g,d){o.updateHqTranslation({prompt:g}),a.value.prompt=g,i.success(`å·²åº”ç”¨æç¤ºè¯: ${d}`)}return(g,d)=>(E(),L("div",Nc,[e("div",Vc,[d[20]||(d[20]=e("div",{class:"settings-group-title"},"é«˜è´¨é‡ç¿»è¯‘æœåŠ¡é…ç½®",-1)),e("div",Wc,[e("div",Kc,[d[15]||(d[15]=e("label",{for:"settingsHqTranslateProvider"},"æœåŠ¡å•†:",-1)),Ce(Ke,{"model-value":r.value.provider,options:t,onChange:d[0]||(d[0]=x=>A(x))},null,8,["model-value"])]),e("div",qc,[d[16]||(d[16]=e("label",{for:"settingsHqApiKey"},"API Key:",-1)),e("div",Hc,[ae(e("input",{type:u.value?"text":"password",id:"settingsHqApiKey","onUpdate:modelValue":d[1]||(d[1]=x=>a.value.apiKey=x),class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,jc),[[kt,a.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:d[2]||(d[2]=x=>u.value=!u.value)},[u.value?(E(),L("span",Yc,"ğŸ‘â€ğŸ—¨")):(E(),L("span",Jc,"ğŸ‘"))])])])]),ae(e("div",Xc,[d[17]||(d[17]=e("label",{for:"settingsHqCustomBaseUrl"},"Base URL:",-1)),ae(e("input",{type:"text",id:"settingsHqCustomBaseUrl","onUpdate:modelValue":d[3]||(d[3]=x=>a.value.customBaseUrl=x),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[$e,a.value.customBaseUrl]])],512),[[Ue,r.value.provider==="custom_openai"]]),e("div",Gc,[d[19]||(d[19]=e("label",{for:"settingsHqModelName"},"æ¨¡å‹åç§°:",-1)),e("div",Zc,[ae(e("input",{type:"text",id:"settingsHqModelName","onUpdate:modelValue":d[4]||(d[4]=x=>a.value.modelName=x),placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},null,512),[[$e,a.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:$,disabled:p.value},[d[18]||(d[18]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",ed,ne(p.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,Qc)]),k.value.length>0?(E(),L("div",td,[Ce(Ke,{modelValue:a.value.modelName,"onUpdate:modelValue":d[5]||(d[5]=x=>a.value.modelName=x),options:P.value},null,8,["modelValue","options"]),e("span",od,"å…± "+ne(k.value.length)+" ä¸ªæ¨¡å‹",1)])):de("",!0)]),e("div",nd,[e("button",{class:"settings-test-btn",onClick:W,disabled:f.value},ne(f.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,sd)])]),e("div",ad,[d[28]||(d[28]=e("div",{class:"settings-group-title"},"æ‰¹å¤„ç†è®¾ç½®",-1)),e("div",ld,[e("div",id,[d[21]||(d[21]=e("label",{for:"settingsHqBatchSize"},"æ‰¹æ¬¡å¤§å°:",-1)),ae(e("input",{type:"number",id:"settingsHqBatchSize","onUpdate:modelValue":d[6]||(d[6]=x=>a.value.batchSize=x),min:"1",max:"10",step:"1"},null,512),[[$e,a.value.batchSize,void 0,{number:!0}]]),d[22]||(d[22]=e("div",{class:"input-hint"},"æ¯æ‰¹å¤„ç†çš„å›¾ç‰‡æ•°é‡ (æ¨è3-5å¼ )",-1))]),e("div",rd,[d[23]||(d[23]=e("label",{for:"settingsHqSessionReset"},"ä¼šè¯é‡ç½®é¢‘ç‡:",-1)),ae(e("input",{type:"number",id:"settingsHqSessionReset","onUpdate:modelValue":d[7]||(d[7]=x=>a.value.sessionReset=x),min:"1",step:"1"},null,512),[[$e,a.value.sessionReset,void 0,{number:!0}]]),d[24]||(d[24]=e("div",{class:"input-hint"},"å¤šå°‘æ‰¹æ¬¡åé‡ç½®ä¸Šä¸‹æ–‡",-1))])]),e("div",ud,[e("div",cd,[d[25]||(d[25]=e("label",{for:"settingsHqRpmLimit"},"RPMé™åˆ¶:",-1)),ae(e("input",{type:"number",id:"settingsHqRpmLimit","onUpdate:modelValue":d[8]||(d[8]=x=>a.value.rpmLimit=x),min:"0",step:"1"},null,512),[[$e,a.value.rpmLimit,void 0,{number:!0}]]),d[26]||(d[26]=e("div",{class:"input-hint"},"æ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",dd,[d[27]||(d[27]=e("label",{for:"settingsHqMaxRetries"},"é‡è¯•æ¬¡æ•°:",-1)),ae(e("input",{type:"number",id:"settingsHqMaxRetries","onUpdate:modelValue":d[9]||(d[9]=x=>a.value.maxRetries=x),min:"0",max:"10",step:"1"},null,512),[[$e,a.value.maxRetries,void 0,{number:!0}]])])])]),e("div",gd,[d[36]||(d[36]=e("div",{class:"settings-group-title"},"é«˜çº§é€‰é¡¹",-1)),e("div",pd,[e("div",md,[e("label",vd,[ae(e("input",{type:"checkbox","onUpdate:modelValue":d[10]||(d[10]=x=>a.value.lowReasoning=x)},null,512),[[et,a.value.lowReasoning]]),d[29]||(d[29]=pe(" ä½æ¨ç†æ¨¡å¼ ",-1))]),d[30]||(d[30]=e("div",{class:"input-hint"},"å‡å°‘æ¨¡å‹æ¨ç†æ·±åº¦ï¼Œæé«˜é€Ÿåº¦",-1))]),e("div",fd,[d[31]||(d[31]=e("label",{for:"settingsHqNoThinkingMethod"},"å–æ¶ˆæ€è€ƒæ–¹æ³•:",-1)),Ce(Ke,{modelValue:a.value.noThinkingMethod,"onUpdate:modelValue":d[11]||(d[11]=x=>a.value.noThinkingMethod=x),options:s},null,8,["modelValue"])])]),e("div",bd,[e("div",hd,[e("label",yd,[ae(e("input",{type:"checkbox","onUpdate:modelValue":d[12]||(d[12]=x=>a.value.forceJsonOutput=x)},null,512),[[et,a.value.forceJsonOutput]]),d[32]||(d[32]=pe(" å¼ºåˆ¶JSONè¾“å‡º ",-1))]),d[33]||(d[33]=e("div",{class:"input-hint"},"ä½¿ç”¨ response_format: json_object",-1))]),e("div",xd,[e("label",_d,[ae(e("input",{type:"checkbox","onUpdate:modelValue":d[13]||(d[13]=x=>a.value.useStream=x)},null,512),[[et,a.value.useStream]]),d[34]||(d[34]=pe(" æµå¼è°ƒç”¨ ",-1))]),d[35]||(d[35]=e("div",{class:"input-hint"},"ä½¿ç”¨æµå¼APIè°ƒç”¨",-1))])])]),e("div",Cd,[d[37]||(d[37]=e("div",{class:"settings-group-title"},"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯",-1)),e("div",Sd,[ae(e("textarea",{id:"settingsHqPrompt","onUpdate:modelValue":d[14]||(d[14]=x=>a.value.prompt=x),rows:"6",placeholder:"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯"},null,512),[[$e,a.value.prompt]]),Ce(Lt,{"prompt-type":"hq_translate",onSelect:U}),e("button",{class:"btn btn-secondary btn-sm",onClick:O},"é‡ç½®ä¸ºé»˜è®¤")])])]))}}),wd=He(kd,[["__scopeId","data-v-23f4a3f7"]]),$d={class:"proofreading-settings"},Td={class:"settings-group"},Id={class:"settings-item"},Pd={class:"checkbox-label"},Rd={class:"settings-item"},Dd={class:"settings-group"},Md={class:"round-header"},Ed={class:"round-title"},Bd=["onClick","disabled"],Ad={class:"round-content"},Ld={class:"settings-item"},Fd=["onUpdate:modelValue"],Ud={class:"settings-row"},Od={class:"settings-item"},zd={class:"settings-item"},Nd={class:"password-input-wrapper"},Vd=["type","onUpdate:modelValue"],Wd=["onClick"],Kd={key:0,class:"eye-icon"},qd={key:1,class:"eye-off-icon"},Hd={class:"settings-item"},jd=["onUpdate:modelValue"],Jd={class:"settings-item"},Yd={class:"model-input-with-fetch"},Xd=["onUpdate:modelValue"],Gd=["onClick","disabled"],Zd={class:"fetch-text"},Qd={key:0,class:"model-select-container"},eg={class:"model-count"},tg={class:"settings-item"},og=["onClick","disabled"],ng={class:"settings-row"},sg={class:"settings-item"},ag=["onUpdate:modelValue"],lg={class:"settings-item"},ig=["onUpdate:modelValue"],rg={class:"settings-item"},ug=["onUpdate:modelValue"],cg={class:"settings-row"},dg={class:"settings-item"},gg={class:"checkbox-label"},pg=["onUpdate:modelValue"],mg={class:"settings-item"},vg={class:"settings-item"},fg={class:"checkbox-label"},bg=["onUpdate:modelValue"],hg={class:"settings-item"},yg=["onUpdate:modelValue"],xg=["onClick"],_g=je({__name:"ProofreadingSettings",setup(n){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],s=[{label:"Geminié£æ ¼",value:"gemini"},{label:"ç«å±±å¼•æ“é£æ ¼",value:"volcano"}],o=ze(),i=rt(),r=C({}),a=C({}),u=C({}),p=j(()=>o.settings.proofreading.rounds),k=j({get:()=>o.settings.proofreading.maxRetries,set:U=>o.setProofreadingMaxRetries(U)}),f=j({get:()=>o.settings.proofreading.enabled,set:U=>o.setProofreadingEnabled(U)});Se(()=>o.settings.proofreading.rounds,()=>{o.saveToStorage()},{deep:!0});function P(U){const g=u.value[U]||[],d=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return g.forEach(x=>d.push({label:x,value:x})),d}async function A(U){const g=p.value[U];if(!g)return;const d=g.provider,x=g.apiKey?.trim(),_=g.customBaseUrl?.trim();if(!x){i.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(d)){i.warning("å½“å‰æœåŠ¡å•†ä¸æ”¯æŒè·å–æ¨¡å‹åˆ—è¡¨");return}r.value[U]=!0;try{const V=await qe.fetchModels(d,x,_);V.success&&V.models&&V.models.length>0?(u.value[U]=V.models.map(se=>se.id),i.success(`è½®æ¬¡ ${U+1}: è·å–åˆ° ${V.models.length} ä¸ªæ¨¡å‹`)):i.warning(V.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(V){const se=V instanceof Error?V.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";i.error(se)}finally{r.value[U]=!1}}async function M(U){const g=p.value[U];if(!g)return;const d=g.provider,x=g.apiKey?.trim(),_=g.modelName?.trim(),K=g.customBaseUrl?.trim();if(!x){i.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!_){i.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}a.value[U]=!0,i.info(`æ­£åœ¨æµ‹è¯•è½®æ¬¡ ${U+1} çš„è¿æ¥...`);try{const V=await qe.testAiTranslateConnection({provider:d,apiKey:x,modelName:_,baseUrl:K});V.success?i.success(V.message||"è¿æ¥æˆåŠŸ!"):i.error(V.message||V.error||"è¿æ¥å¤±è´¥")}catch(V){const se=V instanceof Error?V.message:"è¿æ¥æµ‹è¯•å¤±è´¥";i.error(se)}finally{a.value[U]=!1}}function B(){const U={name:`ç¬¬${p.value.length+1}è½®æ ¡å¯¹`,provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",batchSize:3,sessionReset:20,rpmLimit:7,lowReasoning:!1,noThinkingMethod:"gemini",forceJsonOutput:!0,prompt:jo,showApiKey:!1};o.addProofreadingRound(U),i.success("å·²æ·»åŠ æ–°çš„æ ¡å¯¹è½®æ¬¡")}function $(U){if(p.value.length<=1){i.warning("è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªæ ¡å¯¹è½®æ¬¡");return}o.removeProofreadingRound(U),i.success("å·²åˆ é™¤æ ¡å¯¹è½®æ¬¡")}function W(U){o.updateProofreadingRound(U,{prompt:jo}),i.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}function O(U,g,d){o.updateProofreadingRound(U,{prompt:g}),i.success(`å·²åº”ç”¨æç¤ºè¯: ${d}`)}return(U,g)=>(E(),L("div",$d,[e("div",Td,[g[5]||(g[5]=e("div",{class:"settings-group-title"},"AIæ ¡å¯¹è®¾ç½®",-1)),e("div",Id,[e("label",Pd,[ae(e("input",{type:"checkbox","onUpdate:modelValue":g[0]||(g[0]=d=>f.value=d)},null,512),[[et,f.value]]),g[2]||(g[2]=pe(" å¯ç”¨AIæ ¡å¯¹ ",-1))]),g[3]||(g[3]=e("div",{class:"input-hint"},"ç¿»è¯‘å®Œæˆåè‡ªåŠ¨è¿›è¡ŒAIæ ¡å¯¹",-1))]),e("div",Rd,[g[4]||(g[4]=e("label",{for:"settingsProofreadingMaxRetries"},"å…¨å±€é‡è¯•æ¬¡æ•°:",-1)),ae(e("input",{type:"number",id:"settingsProofreadingMaxRetries","onUpdate:modelValue":g[1]||(g[1]=d=>k.value=d),min:"0",max:"10",step:"1"},null,512),[[$e,k.value,void 0,{number:!0}]])])]),ae(e("div",Dd,[e("div",{class:"settings-group-title"},[g[6]||(g[6]=pe(" æ ¡å¯¹è½®æ¬¡é…ç½® ",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:B},"+ æ·»åŠ è½®æ¬¡")]),(E(!0),L(Oe,null,Ye(p.value,(d,x)=>(E(),L("div",{key:x,class:"proofreading-round"},[e("div",Md,[e("span",Ed,"è½®æ¬¡ "+ne(x+1)+": "+ne(d.name||"æœªå‘½å"),1),e("button",{class:"btn btn-danger btn-sm",onClick:_=>$(x),disabled:p.value.length<=1}," åˆ é™¤ ",8,Bd)]),e("div",Ad,[e("div",Ld,[g[7]||(g[7]=e("label",null,"è½®æ¬¡åç§°:",-1)),ae(e("input",{type:"text","onUpdate:modelValue":_=>d.name=_,placeholder:"å¦‚: ç¬¬ä¸€è½®æ ¡å¯¹"},null,8,Fd),[[$e,d.name]])]),e("div",Ud,[e("div",Od,[g[8]||(g[8]=e("label",null,"æœåŠ¡å•†:",-1)),Ce(Ke,{modelValue:d.provider,"onUpdate:modelValue":_=>d.provider=_,options:t},null,8,["modelValue","onUpdate:modelValue"])]),e("div",zd,[g[9]||(g[9]=e("label",null,"API Key:",-1)),e("div",Nd,[ae(e("input",{type:d.showApiKey?"text":"password","onUpdate:modelValue":_=>d.apiKey=_,class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,Vd),[[kt,d.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:_=>d.showApiKey=!d.showApiKey},[d.showApiKey?(E(),L("span",qd,"ğŸ‘â€ğŸ—¨")):(E(),L("span",Kd,"ğŸ‘"))],8,Wd)])])]),ae(e("div",Hd,[g[10]||(g[10]=e("label",null,"Base URL:",-1)),ae(e("input",{type:"text","onUpdate:modelValue":_=>d.customBaseUrl=_,placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,8,jd),[[$e,d.customBaseUrl]])],512),[[Ue,d.provider==="custom_openai"]]),e("div",Jd,[g[12]||(g[12]=e("label",null,"æ¨¡å‹åç§°:",-1)),e("div",Yd,[ae(e("input",{type:"text","onUpdate:modelValue":_=>d.modelName=_,placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},null,8,Xd),[[$e,d.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:_=>A(x),disabled:r.value[x]},[g[11]||(g[11]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",Zd,ne(r.value[x]?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,Gd)]),u.value[x]&&u.value[x].length>0?(E(),L("div",Qd,[Ce(Ke,{modelValue:d.modelName,"onUpdate:modelValue":_=>d.modelName=_,options:P(x)},null,8,["modelValue","onUpdate:modelValue","options"]),e("span",eg,"å…± "+ne(u.value[x].length)+" ä¸ªæ¨¡å‹",1)])):de("",!0)]),e("div",tg,[e("button",{class:"settings-test-btn",onClick:_=>M(x),disabled:a.value[x]},ne(a.value[x]?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,og)]),e("div",ng,[e("div",sg,[g[13]||(g[13]=e("label",null,"æ‰¹æ¬¡å¤§å°:",-1)),ae(e("input",{type:"number","onUpdate:modelValue":_=>d.batchSize=_,min:"1",max:"10",step:"1"},null,8,ag),[[$e,d.batchSize,void 0,{number:!0}]])]),e("div",lg,[g[14]||(g[14]=e("label",null,"ä¼šè¯é‡ç½®é¢‘ç‡:",-1)),ae(e("input",{type:"number","onUpdate:modelValue":_=>d.sessionReset=_,min:"1",step:"1"},null,8,ig),[[$e,d.sessionReset,void 0,{number:!0}]])]),e("div",rg,[g[15]||(g[15]=e("label",null,"RPMé™åˆ¶:",-1)),ae(e("input",{type:"number","onUpdate:modelValue":_=>d.rpmLimit=_,min:"0",step:"1"},null,8,ug),[[$e,d.rpmLimit,void 0,{number:!0}]])])]),e("div",cg,[e("div",dg,[e("label",gg,[ae(e("input",{type:"checkbox","onUpdate:modelValue":_=>d.lowReasoning=_},null,8,pg),[[et,d.lowReasoning]]),g[16]||(g[16]=pe(" ä½æ¨ç†æ¨¡å¼ ",-1))])]),e("div",mg,[g[17]||(g[17]=e("label",null,"å–æ¶ˆæ€è€ƒæ–¹æ³•:",-1)),Ce(Ke,{modelValue:d.noThinkingMethod,"onUpdate:modelValue":_=>d.noThinkingMethod=_,options:s},null,8,["modelValue","onUpdate:modelValue"])]),e("div",vg,[e("label",fg,[ae(e("input",{type:"checkbox","onUpdate:modelValue":_=>d.forceJsonOutput=_},null,8,bg),[[et,d.forceJsonOutput]]),g[18]||(g[18]=pe(" å¼ºåˆ¶JSONè¾“å‡º ",-1))])])]),e("div",hg,[g[19]||(g[19]=e("label",null,"æ ¡å¯¹æç¤ºè¯:",-1)),ae(e("textarea",{"onUpdate:modelValue":_=>d.prompt=_,rows:"4",placeholder:"æ ¡å¯¹æç¤ºè¯"},null,8,yg),[[$e,d.prompt]]),Ce(Lt,{"prompt-type":"proofreading",onSelect:(_,K)=>O(x,_,K)},null,8,["onSelect"]),e("button",{class:"btn btn-secondary btn-sm",onClick:_=>W(x)},"é‡ç½®ä¸ºé»˜è®¤",8,xg)])])]))),128))],512),[[Ue,f.value]])]))}}),Cg=He(_g,[["__scopeId","data-v-663a7972"]]),Sg={class:"prompt-library"},kg={class:"settings-group"},wg={class:"settings-item"},$g={key:0,class:"settings-item"},Tg={class:"mode-hint"},Ig={class:"settings-group"},Pg={key:0,class:"loading-hint"},Rg={key:1,class:"empty-hint"},Dg={key:2,class:"prompt-list"},Mg=["onClick"],Eg={class:"prompt-name"},Bg={class:"prompt-actions"},Ag=["onClick"],Lg=["onClick","disabled"],Fg={class:"settings-group"},Ug={class:"settings-item"},Og={class:"settings-item"},zg={class:"prompt-editor-actions"},Ng=["disabled"],Vg=je({__name:"PromptLibrary",setup(n){const t=[{label:"ç¿»è¯‘æç¤ºè¯",value:"translate"},{label:"æ–‡æœ¬æ¡†æç¤ºè¯",value:"textbox"},{label:"AIè§†è§‰OCRæç¤ºè¯",value:"ai_vision_ocr"},{label:"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯",value:"hq_translate"},{label:"æ ¡å¯¹æç¤ºè¯",value:"proofreading"}],s=[{label:"æ™®é€šæ¨¡å¼",value:"false"},{label:"JSONæ ¼å¼æ¨¡å¼",value:"true"}],o=rt(),i=ze(),r=C("translate"),a=C([]),u=C(""),p=C(""),k=C(""),f=C(!1),P=C(!1),A=j(()=>r.value==="translate"||r.value==="ai_vision_ocr"),M=j(()=>P.value?"é€‚ç”¨äºéœ€è¦ç»“æ„åŒ–è¾“å‡ºçš„åœºæ™¯":"é€‚ç”¨äºæ™®é€šç¿»è¯‘åœºæ™¯");async function B(){f.value=!0;try{let x;r.value==="textbox"?x=await qe.getTextboxPrompts():x=await qe.getPrompts(r.value);const _=x.prompt_names||[];a.value=_.map(K=>({name:K}))}catch(x){const _=x instanceof Error?x.message:"åŠ è½½æç¤ºè¯åˆ—è¡¨å¤±è´¥";o.error(_)}finally{f.value=!1}}async function $(x){u.value=x,p.value=x,await W(x)}async function W(x){try{let _;r.value==="textbox"?_=await qe.getTextboxPromptContent(x):_=await qe.getPromptContent(r.value,x),p.value=x,k.value=_.prompt_content||"",u.value=x,o.success("å·²åŠ è½½æç¤ºè¯")}catch(_){const K=_ instanceof Error?_.message:"åŠ è½½æç¤ºè¯å†…å®¹å¤±è´¥";o.error(K)}}async function O(){if(!p.value||!k.value){o.warning("è¯·è¾“å…¥æç¤ºè¯åç§°å’Œå†…å®¹");return}try{r.value==="textbox"?await qe.saveTextboxPrompt(p.value,k.value):await qe.savePrompt(r.value,p.value,k.value),o.success("æç¤ºè¯ä¿å­˜æˆåŠŸ"),p.value="",k.value="",await B()}catch(x){const _=x instanceof Error?x.message:"ä¿å­˜æç¤ºè¯å¤±è´¥";o.error(_)}}async function U(x){if(x==="default"){o.warning("é»˜è®¤æç¤ºè¯ä¸èƒ½åˆ é™¤");return}try{r.value==="textbox"?await qe.deleteTextboxPrompt(x):await qe.deletePrompt(r.value,x),o.success("æç¤ºè¯åˆ é™¤æˆåŠŸ"),u.value===x&&(u.value="",p.value="",k.value=""),await B()}catch(_){const K=_ instanceof Error?_.message:"åˆ é™¤æç¤ºè¯å¤±è´¥";o.error(K)}}function g(){u.value="",p.value="",k.value="",r.value==="translate"?P.value=i.settings.translation.isJsonMode:r.value==="ai_vision_ocr"?P.value=i.settings.aiVisionOcr.isJsonMode:P.value=!1,B()}function d(){r.value==="translate"?i.updateTranslationService({isJsonMode:P.value}):r.value==="ai_vision_ocr"&&i.updateAiVisionOcr({isJsonMode:P.value}),o.info(`å·²åˆ‡æ¢åˆ°${P.value?"JSONæ ¼å¼":"æ™®é€š"}æ¨¡å¼`)}return ut(()=>{P.value=i.settings.translation.isJsonMode,B()}),(x,_)=>(E(),L("div",Sg,[e("div",kg,[_[6]||(_[6]=e("div",{class:"settings-group-title"},"æç¤ºè¯ç®¡ç†",-1)),e("div",wg,[_[4]||(_[4]=e("label",{for:"promptType"},"æç¤ºè¯ç±»å‹:",-1)),Ce(Ke,{modelValue:r.value,"onUpdate:modelValue":_[0]||(_[0]=K=>r.value=K),options:t,onChange:g},null,8,["modelValue"])]),A.value?(E(),L("div",$g,[_[5]||(_[5]=e("label",{for:"promptMode"},"æç¤ºè¯æ¨¡å¼:",-1)),Ce(Ke,{"model-value":P.value?"true":"false",options:s,onChange:_[1]||(_[1]=K=>{P.value=K==="true",d()})},null,8,["model-value"]),e("span",Tg,ne(M.value),1)])):de("",!0)]),e("div",Ig,[_[7]||(_[7]=e("div",{class:"settings-group-title"},"å·²ä¿å­˜çš„æç¤ºè¯",-1)),f.value?(E(),L("div",Pg,"åŠ è½½ä¸­...")):a.value.length===0?(E(),L("div",Rg,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(E(),L("div",Dg,[(E(!0),L(Oe,null,Ye(a.value,K=>(E(),L("div",{key:K.name,class:Ie(["prompt-item",{active:u.value===K.name}]),onClick:V=>$(K.name)},[e("span",Eg,ne(K.name),1),e("div",Bg,[e("button",{class:"btn btn-sm",onClick:nt(V=>W(K.name),["stop"]),title:"åŠ è½½åˆ°ç¼–è¾‘å™¨"},"ğŸ“¥",8,Ag),e("button",{class:"btn btn-sm btn-danger",onClick:nt(V=>U(K.name),["stop"]),title:"åˆ é™¤",disabled:K.name==="default"}," ğŸ—‘ï¸ ",8,Lg)])],10,Mg))),128))]))]),e("div",Fg,[_[10]||(_[10]=e("div",{class:"settings-group-title"},"æç¤ºè¯ç¼–è¾‘",-1)),e("div",Ug,[_[8]||(_[8]=e("label",{for:"promptName"},"æç¤ºè¯åç§°:",-1)),ae(e("input",{type:"text",id:"promptName","onUpdate:modelValue":_[2]||(_[2]=K=>p.value=K),placeholder:"è¯·è¾“å…¥æç¤ºè¯åç§°"},null,512),[[$e,p.value]])]),e("div",Og,[_[9]||(_[9]=e("label",{for:"promptContent"},"æç¤ºè¯å†…å®¹:",-1)),ae(e("textarea",{id:"promptContent","onUpdate:modelValue":_[3]||(_[3]=K=>k.value=K),rows:"8",placeholder:"è¯·è¾“å…¥æç¤ºè¯å†…å®¹"},null,512),[[$e,k.value]])]),e("div",zg,[e("button",{class:"btn btn-primary",onClick:O,disabled:!p.value||!k.value},"ä¿å­˜æç¤ºè¯",8,Ng)])])]))}}),Wg=He(Vg,[["__scopeId","data-v-70f0ec19"]]),Kg={class:"plugin-manager"},qg={class:"settings-group"},Hg={key:0,class:"loading-hint"},jg={key:1,class:"empty-hint"},Jg={key:2,class:"plugin-list"},Yg={class:"plugin-info"},Xg={class:"plugin-header"},Gg={class:"plugin-name"},Zg={class:"plugin-version"},Qg={class:"plugin-description"},ep={class:"plugin-controls"},tp={class:"switch"},op=["checked","onChange"],np=["onClick"],sp=["onClick"],ap={class:"settings-group"},lp={class:"plugin-name"},ip={class:"switch"},rp=["checked","onChange"],up={class:"plugin-config-content"},cp={class:"plugin-config-header"},dp={class:"plugin-config-body"},gp=["for"],pp=["id","onUpdate:modelValue"],mp=["id","onUpdate:modelValue","min","max"],vp=["id","onUpdate:modelValue","placeholder"],fp={key:4,class:"field-description"},bp=je({__name:"PluginManager",setup(n){const t=rt(),s=C([]),o=C({}),i=C(!1),r=C(!1),a=C(null),u=C({}),p=C({});async function k(){i.value=!0;try{const O=await Os();s.value=O.plugins||[]}catch(O){const U=O instanceof Error?O.message:"åŠ è½½æ’ä»¶åˆ—è¡¨å¤±è´¥";t.error(U)}finally{i.value=!1}}async function f(){try{const O=await Js();o.value=O.states||{}}catch(O){console.error("åŠ è½½é»˜è®¤çŠ¶æ€å¤±è´¥:",O)}}async function P(O){try{O.enabled?(await Ns(O.name),O.enabled=!1,t.success(`å·²ç¦ç”¨ ${O.display_name||O.name}`)):(await zs(O.name),O.enabled=!0,t.success(`å·²å¯ç”¨ ${O.display_name||O.name}`))}catch(U){const g=U instanceof Error?U.message:"æ“ä½œå¤±è´¥";t.error(g)}}async function A(O,U){const g=U.target,d=g.checked;try{await Ys(O,d),o.value[O]=d,t.success("é»˜è®¤çŠ¶æ€å·²æ›´æ–°")}catch(x){const _=x instanceof Error?x.message:"è®¾ç½®å¤±è´¥";t.error(_),g.checked=!d}}async function M(O){a.value=O;try{const U=await Xs(O.name);u.value=U.schema||{};const g=await Gs(O.name);p.value=g.config||{},r.value=!0}catch(U){const g=U instanceof Error?U.message:"åŠ è½½é…ç½®å¤±è´¥";t.error(g)}}function B(){r.value=!1,a.value=null,u.value={},p.value={}}async function $(){if(a.value)try{await Zs(a.value.name,p.value),t.success("é…ç½®ä¿å­˜æˆåŠŸ"),B()}catch(O){const U=O instanceof Error?O.message:"ä¿å­˜é…ç½®å¤±è´¥";t.error(U)}}async function W(O){if(confirm(`ç¡®å®šè¦åˆ é™¤æ’ä»¶ "${O.display_name||O.name}" å—ï¼Ÿ`))try{await Vs(O.name),t.success("æ’ä»¶åˆ é™¤æˆåŠŸ"),await k()}catch(U){const g=U instanceof Error?U.message:"åˆ é™¤æ’ä»¶å¤±è´¥";t.error(g)}}return ut(()=>{k(),f()}),(O,U)=>(E(),L("div",Kg,[e("div",qg,[U[1]||(U[1]=e("div",{class:"settings-group-title"},"å·²å®‰è£…æ’ä»¶",-1)),i.value?(E(),L("div",Hg,"åŠ è½½ä¸­...")):s.value.length===0?(E(),L("div",jg,"æš‚æ— å·²å®‰è£…çš„æ’ä»¶")):(E(),L("div",Jg,[(E(!0),L(Oe,null,Ye(s.value,g=>(E(),L("div",{key:g.name,class:"plugin-item"},[e("div",Yg,[e("div",Xg,[e("span",Gg,ne(g.display_name||g.name),1),e("span",Zg,"v"+ne(g.version||"1.0.0"),1)]),e("p",Qg,ne(g.description||"æš‚æ— æè¿°"),1)]),e("div",ep,[e("label",tp,[e("input",{type:"checkbox",checked:g.enabled,onChange:d=>P(g)},null,40,op),U[0]||(U[0]=e("span",{class:"slider"},null,-1))]),g.has_config?(E(),L("button",{key:0,class:"btn btn-sm",onClick:d=>M(g),title:"é…ç½®"},"âš™ï¸",8,np)):de("",!0),e("button",{class:"btn btn-sm btn-danger",onClick:d=>W(g),title:"åˆ é™¤"},"ğŸ—‘ï¸",8,sp)])]))),128))]))]),e("div",ap,[U[3]||(U[3]=e("div",{class:"settings-group-title"},"é»˜è®¤å¯ç”¨çŠ¶æ€",-1)),U[4]||(U[4]=e("p",{class:"settings-hint"},"è®¾ç½®æ’ä»¶åœ¨æ–°ä¼šè¯ä¸­çš„é»˜è®¤å¯ç”¨çŠ¶æ€",-1)),(E(!0),L(Oe,null,Ye(s.value,g=>(E(),L("div",{key:"default-"+g.name,class:"default-state-item"},[e("span",lp,ne(g.display_name||g.name),1),e("label",ip,[e("input",{type:"checkbox",checked:o.value[g.name],onChange:d=>A(g.name,d)},null,40,rp),U[2]||(U[2]=e("span",{class:"slider"},null,-1))])]))),128))]),r.value?(E(),L("div",{key:0,class:"plugin-config-modal",onClick:nt(B,["self"])},[e("div",up,[e("div",cp,[e("h4",null,ne(a.value?.display_name||a.value?.name)+" é…ç½®",1),e("span",{class:"close-btn",onClick:B},"Ã—")]),e("div",dp,[(E(!0),L(Oe,null,Ye(u.value,(g,d)=>(E(),L("div",{key:d,class:"config-field"},[e("label",{for:"config-"+d},ne(g.label||d)+":",9,gp),g.type==="boolean"?ae((E(),L("input",{key:0,type:"checkbox",id:"config-"+d,"onUpdate:modelValue":x=>p.value[d]=x},null,8,pp)),[[et,p.value[d]]]):g.type==="select"?(E(),it(Ke,{key:1,"model-value":String(p.value[d]??""),options:g.options||[],onChange:x=>{p.value[d]=x}},null,8,["model-value","options","onChange"])):g.type==="number"?ae((E(),L("input",{key:2,type:"number",id:"config-"+d,"onUpdate:modelValue":x=>p.value[d]=x,min:g.min,max:g.max},null,8,mp)),[[$e,p.value[d],void 0,{number:!0}]]):ae((E(),L("input",{key:3,type:"text",id:"config-"+d,"onUpdate:modelValue":x=>p.value[d]=x,placeholder:g.placeholder},null,8,vp)),[[$e,p.value[d]]]),g.description?(E(),L("p",fp,ne(g.description),1)):de("",!0)]))),128))]),e("div",{class:"plugin-config-footer"},[e("button",{class:"btn btn-secondary",onClick:B},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:$},"ä¿å­˜")])])])):de("",!0)]))}}),hp=He(bp,[["__scopeId","data-v-a62393a7"]]),yp={class:"parallel-settings"},xp={class:"settings-group"},_p={class:"settings-item"},Cp={class:"toggle-switch"},Sp={class:"number-control"},kp=["disabled"],wp=["disabled"],$p=["disabled"],Tp={key:0,class:"settings-note"},Ip=je({__name:"ParallelSettings",setup(n){const t=ze(),s=j({get:()=>t.settings.parallel.enabled,set:i=>{t.updateSettings({parallel:{...t.settings.parallel,enabled:i}})}}),o=j({get:()=>t.settings.parallel.deepLearningLockSize,set:i=>{t.updateSettings({parallel:{...t.settings.parallel,deepLearningLockSize:Math.max(1,Math.min(4,i))}})}});return(i,r)=>(E(),L("div",yp,[e("div",xp,[r[10]||(r[10]=e("div",{class:"settings-group-title"},"ğŸš€ å¹¶è¡Œç¿»è¯‘",-1)),e("div",_p,[r[5]||(r[5]=e("label",null,"å¯ç”¨å¹¶è¡Œæ¨¡å¼:",-1)),e("label",Cp,[ae(e("input",{type:"checkbox","onUpdate:modelValue":r[0]||(r[0]=a=>s.value=a)},null,512),[[et,s.value]]),r[4]||(r[4]=e("span",{class:"toggle-slider"},null,-1))]),r[6]||(r[6]=e("div",{class:"input-hint"},"ä½¿ç”¨æµæ°´çº¿å¹¶è¡Œå¤„ç†ï¼Œå¯èƒ½æå‡æ‰¹é‡ç¿»è¯‘é€Ÿåº¦",-1))]),e("div",{class:Ie(["settings-item",{"item-disabled":!s.value}])},[r[7]||(r[7]=e("label",null,"æ·±åº¦å­¦ä¹ å¹¶å‘æ•°:",-1)),e("div",Sp,[e("button",{class:"btn btn-sm",onClick:r[1]||(r[1]=a=>o.value=Math.max(1,o.value-1)),disabled:!s.value},"-",8,kp),ae(e("input",{type:"number","onUpdate:modelValue":r[2]||(r[2]=a=>o.value=a),min:"1",max:"4",disabled:!s.value,class:"number-input"},null,8,wp),[[$e,o.value,void 0,{number:!0}]]),e("button",{class:"btn btn-sm",onClick:r[3]||(r[3]=a=>o.value=Math.min(4,o.value+1)),disabled:!s.value},"+",8,$p)]),r[8]||(r[8]=e("div",{class:"input-hint"},"æ§åˆ¶æ£€æµ‹/OCR/é¢œè‰²/ä¿®å¤çš„æœ€å¤§å¹¶å‘æ•°ï¼ˆå»ºè®®1-2ï¼‰",-1))],2),s.value?(E(),L("div",Tp,[...r[9]||(r[9]=[e("div",{class:"note-title"},"âš ï¸ æ³¨æ„äº‹é¡¹ï¼š",-1),e("ul",null,[e("li",null,"å¹¶å‘æ•°è®¾ä¸º1æ—¶ä¸ºä¸²è¡Œæ‰§è¡Œï¼Œæœ€ç¨³å®š"),e("li",null,"å¢å¤§å¹¶å‘æ•°å¯èƒ½åŠ é€Ÿå¤„ç†ï¼Œä½†ä¼šå ç”¨æ›´å¤šGPU/CPUèµ„æº"),e("li",null,"å¦‚æœé‡åˆ°æ˜¾å­˜ä¸è¶³ï¼Œè¯·å°†å¹¶å‘æ•°è®¾ä¸º1")],-1)])])):de("",!0)])]))}}),Pp=He(Ip,[["__scopeId","data-v-4a6e42d5"]]),Rp={class:"more-settings"},Dp={class:"settings-group"},Mp={class:"settings-item checkbox-item"},Ep={class:"checkbox-label"},Bp={class:"settings-group"},Ap={class:"settings-item"},Lp={class:"settings-group"},Fp={class:"settings-item"},Up=["disabled"],Op={key:0,class:"font-count"},zp={class:"settings-item"},Np={class:"settings-group"},Vp={class:"settings-row"},Wp={class:"settings-item"},Kp=["disabled"],qp={class:"settings-item"},Hp=["disabled"],jp=je({__name:"MoreSettings",setup(n){const t=[{label:"å‰ç«¯ pdf.js (æ¨è)",value:"frontend"},{label:"åç«¯ PyMuPDF",value:"backend"}],s=ze(),o=rt(),i=C(!1),r=C([]),a=C(!1),u=C(null),p=C({pdfProcessingMethod:s.settings.pdfProcessingMethod||"frontend",autoSaveInBookshelfMode:s.settings.autoSaveInBookshelfMode||!1});Se(()=>p.value.pdfProcessingMethod,M=>{s.setPdfProcessingMethod(M)}),Se(()=>p.value.autoSaveInBookshelfMode,M=>{s.setAutoSaveInBookshelfMode(M)});async function k(){i.value=!0;try{const M=await qe.getFontList();r.value=M.fonts||[],o.success(`è·å–åˆ° ${r.value.length} ä¸ªå­—ä½“`)}catch(M){const B=M instanceof Error?M.message:"è·å–å­—ä½“åˆ—è¡¨å¤±è´¥";o.error(B)}finally{i.value=!1}}async function f(M){const $=M.target.files?.[0];if(!$)return;const W=[".ttf",".ttc",".otf"],O=$.name.toLowerCase().slice($.name.lastIndexOf("."));if(!W.includes(O)){o.error("ä¸æ”¯æŒçš„å­—ä½“æ ¼å¼ï¼Œè¯·ä¸Šä¼  .ttf, .ttc æˆ– .otf æ–‡ä»¶");return}try{const U=await qe.uploadFont($);U.success?(o.success(`å­—ä½“ "${U.fontPath||$.name}" ä¸Šä¼ æˆåŠŸ`),await k()):o.error(U.error||"å­—ä½“ä¸Šä¼ å¤±è´¥")}catch(U){const g=U instanceof Error?U.message:"å­—ä½“ä¸Šä¼ å¤±è´¥";o.error(g)}finally{u.value&&(u.value.value="")}}async function P(){a.value=!0;try{const M=await hn();M.success?o.success(`å·²æ¸…ç† ${M.deleted_count||0} ä¸ªè°ƒè¯•æ–‡ä»¶`):o.error(M.error||"æ¸…ç†å¤±è´¥")}catch(M){const B=M instanceof Error?M.message:"æ¸…ç†å¤±è´¥";o.error(B)}finally{a.value=!1}}async function A(){a.value=!0;try{const M=await bo();M.success?o.success(`å·²æ¸…ç† ${M.deleted_count||0} ä¸ªä¸´æ—¶æ–‡ä»¶`):o.error(M.error||"æ¸…ç†å¤±è´¥")}catch(M){const B=M instanceof Error?M.message:"æ¸…ç†å¤±è´¥";o.error(B)}finally{a.value=!1}}return(M,B)=>(E(),L("div",Rp,[Ce(Pp),e("div",Dp,[B[4]||(B[4]=e("div",{class:"settings-group-title"},"è‡ªåŠ¨ä¿å­˜è®¾ç½®",-1)),e("div",Mp,[e("label",Ep,[ae(e("input",{type:"checkbox","onUpdate:modelValue":B[0]||(B[0]=$=>p.value.autoSaveInBookshelfMode=$)},null,512),[[et,p.value.autoSaveInBookshelfMode]]),B[2]||(B[2]=e("span",{class:"checkbox-text"},"ä¹¦æ¶æ¨¡å¼è‡ªåŠ¨ä¿å­˜",-1))]),B[3]||(B[3]=e("div",{class:"input-hint"},[pe(" å¼€å¯åï¼Œåœ¨ä¹¦æ¶æ¨¡å¼ä¸‹ç¿»è¯‘æ—¶ä¼šè‡ªåŠ¨ä¿å­˜è¿›åº¦ï¼ˆç¿»è¯‘ä¸€å¼ ä¿å­˜ä¸€å¼ ï¼‰ï¼Œé˜²æ­¢æ„å¤–å…³é—­å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ "),e("br"),e("span",{class:"hint-note"},"æ³¨æ„ï¼šæ­¤åŠŸèƒ½ä»…åœ¨ä¹¦æ¶æ¨¡å¼ä¸‹ç”Ÿæ•ˆï¼Œå¿«é€Ÿç¿»è¯‘æ¨¡å¼ä¸æ”¯æŒã€‚")],-1))])]),e("div",Bp,[B[7]||(B[7]=e("div",{class:"settings-group-title"},"PDFå¤„ç†è®¾ç½®",-1)),e("div",Ap,[B[5]||(B[5]=e("label",{for:"settingsPdfProcessingMethod"},"PDFå¤„ç†æ–¹å¼:",-1)),Ce(Ke,{modelValue:p.value.pdfProcessingMethod,"onUpdate:modelValue":B[1]||(B[1]=$=>p.value.pdfProcessingMethod=$),options:t},null,8,["modelValue"]),B[6]||(B[6]=e("div",{class:"input-hint"},"å‰ç«¯å¤„ç†é€Ÿåº¦æ›´å¿«ï¼Œåç«¯å¤„ç†å…¼å®¹æ€§æ›´å¥½",-1))])]),e("div",Lp,[B[11]||(B[11]=e("div",{class:"settings-group-title"},"å­—ä½“è®¾ç½®",-1)),e("div",Fp,[B[8]||(B[8]=e("label",null,"ç³»ç»Ÿå­—ä½“åˆ—è¡¨:",-1)),e("button",{class:"btn btn-secondary",onClick:k,disabled:i.value},ne(i.value?"åŠ è½½ä¸­...":"ğŸ”„ åˆ·æ–°å­—ä½“åˆ—è¡¨"),9,Up),r.value.length>0?(E(),L("div",Op,"å…± "+ne(r.value.length)+" ä¸ªå­—ä½“",1)):de("",!0)]),e("div",zp,[B[9]||(B[9]=e("label",null,"ä¸Šä¼ è‡ªå®šä¹‰å­—ä½“:",-1)),e("input",{type:"file",accept:".ttf,.ttc,.otf",onChange:f,ref_key:"fontInput",ref:u},null,544),B[10]||(B[10]=e("div",{class:"input-hint"},"æ”¯æŒ .ttf, .ttc, .otf æ ¼å¼",-1))])]),e("div",Np,[B[14]||(B[14]=e("div",{class:"settings-group-title"},"ç¼“å­˜æ¸…ç†",-1)),e("div",Vp,[e("div",Wp,[e("button",{class:"btn btn-secondary",onClick:P,disabled:a.value},ne(a.value?"æ¸…ç†ä¸­...":"ğŸ—‘ï¸ æ¸…ç†è°ƒè¯•æ–‡ä»¶"),9,Kp),B[12]||(B[12]=e("div",{class:"input-hint"},"æ¸…ç†è°ƒè¯•è¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶",-1))]),e("div",qp,[e("button",{class:"btn btn-secondary",onClick:A,disabled:a.value},ne(a.value?"æ¸…ç†ä¸­...":"ğŸ—‘ï¸ æ¸…ç†ä¸´æ—¶æ–‡ä»¶"),9,Hp),B[13]||(B[13]=e("div",{class:"input-hint"},"æ¸…ç†ä¸‹è½½å’Œå¤„ç†è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶",-1))])])]),B[15]||(B[15]=co('<div class="settings-group" data-v-8667f80e><div class="settings-group-title" data-v-8667f80e>å…³äº</div><div class="about-info" data-v-8667f80e><p data-v-8667f80e><strong data-v-8667f80e>Saber-Translator</strong></p><p data-v-8667f80e>AIé©±åŠ¨çš„æ¼«ç”»ç¿»è¯‘å·¥å…·</p><p class="links" data-v-8667f80e><a href="http://www.mashirosaber.top" target="_blank" data-v-8667f80e>ğŸ“– ä½¿ç”¨æ•™ç¨‹</a><a href="https://github.com/MashiroSaber/saber-translator" target="_blank" data-v-8667f80e>ğŸ™ GitHub</a></p><p class="disclaimer" data-v-8667f80e>æœ¬é¡¹ç›®å®Œå…¨å¼€æºå…è´¹ï¼Œè¯·å‹¿ä¸Šå½“å—éª—</p></div></div>',1))]))}}),Jp=He(jp,[["__scopeId","data-v-8667f80e"]]),Yp={class:"settings-modal-content"},Xp={class:"settings-tabs"},Gp=["onClick"],Zp={class:"settings-tab-content"},Qp={class:"settings-tab-pane active"},em={class:"settings-tab-pane"},tm={class:"settings-tab-pane"},om={class:"settings-tab-pane"},nm={class:"settings-tab-pane"},sm={class:"settings-tab-pane"},am={class:"settings-tab-pane"},lm={class:"settings-tab-pane"},im=je({__name:"SettingsModal",props:{modelValue:{type:Boolean},initialTab:{}},emits:["update:modelValue","save"],setup(n,{emit:t}){const s=n,o=t,i=ze(),r=C(s.modelValue),a=C("ocr"),u=[{id:"ocr",label:"OCRè¯†åˆ«"},{id:"translate",label:"ç¿»è¯‘æœåŠ¡"},{id:"detection",label:"æ£€æµ‹è®¾ç½®"},{id:"hq",label:"é«˜è´¨é‡ç¿»è¯‘"},{id:"proofreading",label:"AIæ ¡å¯¹"},{id:"prompt-library",label:"æç¤ºè¯ç®¡ç†"},{id:"plugins",label:"æ’ä»¶ç®¡ç†"},{id:"more",label:"æ›´å¤š"}];Se(()=>s.modelValue,P=>{r.value=P,P?(document.body.style.overflow="hidden",s.initialTab&&u.some(A=>A.id===s.initialTab)&&(a.value=s.initialTab)):(document.body.style.overflow="",a.value="ocr")});function p(){r.value=!1,o("update:modelValue",!1),document.body.style.overflow=""}async function k(){i.saveToStorage();try{await i.saveToBackend(),console.log("[SettingsModal] è®¾ç½®å·²ä¿å­˜åˆ°åç«¯")}catch(P){console.warn("[SettingsModal] ä¿å­˜åˆ°åç«¯å¤±è´¥ï¼Œä»…ä¿å­˜åˆ° localStorage:",P)}o("save"),p()}function f(P){P.key==="Escape"&&r.value&&p()}return ut(()=>{document.addEventListener("keydown",f)}),Ft(()=>{document.removeEventListener("keydown",f),document.body.style.overflow=""}),(P,A)=>r.value?(E(),L("div",{key:0,class:"settings-modal",onClick:nt(p,["self"])},[e("div",Yp,[e("div",{class:"settings-modal-header"},[A[0]||(A[0]=e("h3",null,"âš™ï¸ è®¾ç½®",-1)),e("span",{class:"settings-modal-close",onClick:p},"Ã—")]),e("div",Xp,[(E(),L(Oe,null,Ye(u,M=>e("button",{key:M.id,class:Ie(["settings-tab",{active:a.value===M.id}]),onClick:B=>a.value=M.id},ne(M.label),11,Gp)),64))]),e("div",Zp,[ae(e("div",Qp,[Ce(Ru)],512),[[Ue,a.value==="ocr"]]),ae(e("div",em,[Ce(hc)],512),[[Ue,a.value==="translate"]]),ae(e("div",tm,[Ce(zc)],512),[[Ue,a.value==="detection"]]),ae(e("div",om,[Ce(wd)],512),[[Ue,a.value==="hq"]]),ae(e("div",nm,[Ce(Cg)],512),[[Ue,a.value==="proofreading"]]),ae(e("div",sm,[Ce(Wg)],512),[[Ue,a.value==="prompt-library"]]),ae(e("div",am,[Ce(hp)],512),[[Ue,a.value==="plugins"]]),ae(e("div",lm,[Ce(Jp)],512),[[Ue,a.value==="more"]])]),e("div",{class:"settings-modal-footer"},[e("button",{class:"btn btn-secondary",onClick:p},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:k},"ä¿å­˜è®¾ç½®")])])])):de("",!0)}}),rm=He(im,[["__scopeId","data-v-e1ec20ab"]]),um={minScale:.1,maxScale:5,zoomSpeed:.1};function dn(n={}){const t={...um,...n},s=C(1),o=C(0),i=C(0),r=C(!1),a=C(0),u=C(0),p=j(()=>({transform:`translate(${o.value}px, ${i.value}px) scale(${s.value})`}));function k(X,ie,z){const R=Math.min(Math.max(s.value*z,t.minScale),t.maxScale),T=R/s.value;o.value=X-(X-o.value)*T,i.value=ie-(ie-i.value)*T,s.value=R,n.onScaleChange?.(s.value),n.onTransformChange?.(_())}function f(X,ie=800,z=600){k(ie/2,z/2,X)}function P(){f(1.2)}function A(){f(.8)}function M(X,ie=800,z=600){const R=X/s.value;k(ie/2,z/2,R)}function B(X,ie){r.value=!0,a.value=X,u.value=ie}function $(X,ie){if(!r.value)return;const z=X-a.value,R=ie-u.value;o.value+=z,i.value+=R,a.value=X,u.value=ie,n.onTransformChange?.(_())}function W(){r.value=!1}function O(X,ie){o.value+=X,i.value+=ie,n.onTransformChange?.(_())}function U(){s.value=1,o.value=0,i.value=0,n.onScaleChange?.(s.value),n.onTransformChange?.(_())}function g(){U()}function d(){s.value=1,o.value=0,i.value=0}function x(X,ie,z,R){if(!X||!ie)return;const T=z/X,F=R/ie;s.value=Math.min(T,F)*.95,o.value=(z-X*s.value)/2,i.value=(R-ie*s.value)/2,n.onScaleChange?.(s.value),n.onTransformChange?.(_())}function _(){return{scale:s.value,translateX:o.value,translateY:i.value}}function K(X){X.scale!==void 0&&(s.value=X.scale),X.translateX!==void 0&&(o.value=X.translateX),X.translateY!==void 0&&(i.value=X.translateY),n.onTransformChange?.(_())}function V(X){s.value=X.scale,o.value=X.translateX,i.value=X.translateY}function se(X,ie,z){if(!X||X.length<4)return;const[R,T,F,y]=X,m=(R+F)/2,l=(T+y)/2,v=ie/2,D=z/2;o.value=v-m*s.value,i.value=D-l*s.value,n.onTransformChange?.(_())}return{scale:s,translateX:o,translateY:i,isDragging:r,transformStyle:p,zoomAt:k,zoom:f,zoomIn:P,zoomOut:A,setScale:M,startDrag:B,drag:$,endDrag:W,pan:O,reset:U,resetZoom:g,resetTransform:d,fitToScreen:x,getTransform:_,setTransform:K,syncWith:V,scrollToBubble:se}}function cm(n){const t=Ze(),s=ze(),o=C(null),i=C(ms),r=C(!1),a=C(!1),u=C([]),p=C(0),k=C(0);let f=null,P=null,A=null;const M=j(()=>o.value!==null),B=j(()=>o.value==="repair"?{fill:"rgba(76, 175, 80, 0.4)",border:"#4CAF50"}:o.value==="restore"?{fill:"rgba(33, 150, 243, 0.4)",border:"#2196F3"}:{fill:"transparent",border:"transparent"});function $(l){o.value!==l&&(o.value=l,r.value=!0,u.value=[],console.log(`è¿›å…¥${l==="repair"?"ä¿®å¤":"è¿˜åŸ"}ç¬”åˆ·æ¨¡å¼ï¼Œç¬”åˆ·å¤§å°: ${i.value}px`))}function W(){a.value&&K();const l=o.value!==null;o.value=null,r.value=!1,a.value=!1,u.value=[],ie(),l&&console.log("é€€å‡ºç¬”åˆ·æ¨¡å¼")}function O(l){o.value===l?W():$(l)}function U(l){i.value=Math.max(Yo,Math.min(Jo,l))}function g(l){U(i.value+l)}function d(l){if(!M.value)return;l.preventDefault(),l.stopPropagation();const v=l.deltaY>0?-5:5;g(v)}function x(l,v){if(!M.value||l.button!==0)return;l.preventDefault(),l.stopPropagation(),a.value=!0,f=v,u.value=[];const D=V(l,v);D&&(u.value.push(D),X(v),z(D)),console.log("å¼€å§‹ç¬”åˆ·æ¶‚æŠ¹")}function _(l){if(p.value=l.clientX,k.value=l.clientY,!a.value||!M.value)return;const v=V(l,f);v&&(u.value.push(v),z(v))}function K(){if(!a.value)return;a.value=!1;const l=t.currentImage;if(!l||u.value.length===0){ie(),u.value=[];return}const v=se();if(!v){ie(),u.value=[];return}const D=o.value;(async()=>{D==="restore"?await R(l,v):D==="repair"&&await T(l,v),n?.onBrushComplete?.()})(),ie(),u.value=[]}function V(l,v){if(!v)return null;const D=v.querySelector(".image-canvas-wrapper"),S=D?.querySelector("img");if(!S||!S.naturalWidth)return null;const w=D.getBoundingClientRect(),N=window.getComputedStyle(D).transform;let Z=1;N&&N!=="none"&&(Z=new DOMMatrix(N).a);const Y=(l.clientX-w.left)/Z,c=(l.clientY-w.top)/Z,h=S.naturalWidth,le=S.naturalHeight;return Y<0||c<0||Y>h||c>le?null:{x:Y,y:c,scale:Z}}function se(){if(u.value.length===0)return null;const v=u.value[0]?.scale||1,D=i.value/2/v;let S=1/0,w=1/0,N=-1/0,Z=-1/0;for(const Y of u.value)S=Math.min(S,Y.x-D),w=Math.min(w,Y.y-D),N=Math.max(N,Y.x+D),Z=Math.max(Z,Y.y+D);return{x1:Math.max(0,Math.floor(S)),y1:Math.max(0,Math.floor(w)),x2:Math.ceil(N),y2:Math.ceil(Z),path:[...u.value],radius:D}}function X(l){ie();const v=l.querySelector(".image-canvas-wrapper"),D=v?.querySelector("img");if(!D)return;const S=document.createElement("canvas");S.id="brushOverlayCanvas",S.width=D.naturalWidth,S.height=D.naturalHeight,S.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100;",v.appendChild(S),P=S,A=S.getContext("2d")}function ie(){P&&P.parentNode&&P.parentNode.removeChild(P),P=null,A=null}function z(l){if(!A||!l)return;const v=B.value.fill,D=i.value/2/(l.scale||1);A.beginPath(),A.arc(l.x,l.y,D,0,Math.PI*2),A.fillStyle=v,A.fill()}async function R(l,v){if(!l.originalDataURL)return;let D;return l.cleanImageData?D="data:image/png;base64,"+l.cleanImageData:D=l.originalDataURL,new Promise(S=>{const w=new Image,N=new Image;let Z=0;const Y=()=>{if(Z++,Z<2)return;const c=document.createElement("canvas");c.width=w.naturalWidth,c.height=w.naturalHeight;const h=c.getContext("2d");if(!h){S();return}h.drawImage(w,0,0);const le=document.createElement("canvas");le.width=c.width,le.height=c.height;const I=le.getContext("2d");if(!I){S();return}I.fillStyle="white";for(const re of v.path)I.beginPath(),I.arc(re.x,re.y,v.radius,0,Math.PI*2),I.fill();h.globalCompositeOperation="destination-out",h.drawImage(le,0,0),h.globalCompositeOperation="destination-over",h.drawImage(N,0,0),h.globalCompositeOperation="source-over";const G=c.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:G}),console.log("è¿˜åŸç¬”åˆ·åŒºåŸŸå®Œæˆ"),S()};w.onload=Y,w.onerror=()=>S(),N.onload=Y,N.onerror=()=>S(),w.src=D,N.src=l.originalDataURL})}async function T(l,v){const D=n?.getCurrentRepairSettings?.()||{inpaintMethod:"solid",fillColor:"#FFFFFF"},S=D.inpaintMethod;S==="lama_mpe"||S==="litelama"?await F(l,v,S):await y(l,v,D.fillColor)}async function F(l,v,D="lama_mpe"){let S,w;if(l.cleanImageData)S=l.cleanImageData,w="data:image/png;base64,"+l.cleanImageData;else if(l.originalDataURL)S=l.originalDataURL.split(",")[1],w=l.originalDataURL;else{console.error("æ— æ³•è·å–åŸºç¡€å›¾åƒç”¨äº LAMA ä¿®å¤");return}return new Promise(N=>{const Z=new Image;Z.onload=async()=>{const Y=Z.naturalWidth,c=Z.naturalHeight,h=document.createElement("canvas");h.width=Y,h.height=c;const le=h.getContext("2d");if(!le){console.error("æ— æ³•åˆ›å»ºæ©è†œç”»å¸ƒä¸Šä¸‹æ–‡"),N();return}le.fillStyle="black",le.fillRect(0,0,Y,c),le.fillStyle="white";for(const De of v.path)le.beginPath(),le.arc(De.x,De.y,v.radius,0,Math.PI*2),le.fill();const G=h.toDataURL("image/png").split(",")[1],re=[v.x1,v.y1,v.x2,v.y2],ke=D==="litelama"?"litelama":"lama_mpe";try{xe("LAMA ä¿®å¤ä¸­...","info");const De=await yo(S,re,{method:"lama",lamaModel:ke,maskData:G});if(De.success&&De.inpainted_image)t.updateCurrentImage({cleanImageData:De.inpainted_image}),console.log("ä¿®å¤ç¬”åˆ·åŒºåŸŸå®Œæˆï¼ˆLAMA ä¿®å¤ï¼Œç²¾ç¡®æ©è†œï¼‰"),xe("LAMA ä¿®å¤å®Œæˆ","success");else throw new Error(De.error||"LAMA ä¿®å¤è¿”å›æ— æ•ˆæ•°æ®")}catch(De){console.error("LAMA ä¿®å¤å¤±è´¥ï¼Œå›é€€åˆ°çº¯è‰²å¡«å……:",De),xe("LAMA ä¿®å¤å¤±è´¥ï¼Œä½¿ç”¨çº¯è‰²å¡«å……","warning");const Te=n?.getCurrentRepairSettings?.();await y(l,v,Te?.fillColor)}N()},Z.onerror=()=>{console.error("åŠ è½½å›¾åƒå¤±è´¥ï¼Œæ— æ³•è¿›è¡Œ LAMA ä¿®å¤"),N()},Z.src=w})}async function y(l,v,D){const S=D||s.settings.textStyle.fillColor||"#FFFFFF";let w;if(l.cleanImageData)w="data:image/png;base64,"+l.cleanImageData;else if(l.originalDataURL)w=l.originalDataURL;else return;return new Promise(N=>{const Z=new Image;Z.onload=()=>{const Y=document.createElement("canvas");Y.width=Z.naturalWidth,Y.height=Z.naturalHeight;const c=Y.getContext("2d");if(!c){N();return}c.drawImage(Z,0,0),c.fillStyle=S;for(const le of v.path)c.beginPath(),c.arc(le.x,le.y,v.radius,0,Math.PI*2),c.fill();const h=Y.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:h}),console.log("ä¿®å¤ç¬”åˆ·åŒºåŸŸå®Œæˆï¼ˆçº¯è‰²å¡«å……ï¼‰"),N()},Z.onerror=()=>N(),Z.src=w})}async function m(){const l=t.currentImage;if(!l)return console.warn("ensureCleanBackground: æ²¡æœ‰å½“å‰å›¾ç‰‡"),!1;if(l.cleanImageData)return console.log("ensureCleanBackground: å·²æœ‰å¹²å‡€èƒŒæ™¯"),!0;const v=n?.getCurrentRepairSettings?.();if((v?.inpaintMethod||s.settings.textStyle.inpaintMethod)!=="solid")return console.log("ensureCleanBackground: éçº¯è‰²å¡«å……æ¨¡å¼ï¼Œè·³è¿‡"),!1;if(!l.bubbleStates||l.bubbleStates.length===0)return console.warn("ensureCleanBackground: æ²¡æœ‰æ°”æ³¡æ•°æ®"),!1;if(!l.translatedDataURL&&!l.originalDataURL)return console.warn("ensureCleanBackground: æ²¡æœ‰å›¾ç‰‡æ•°æ®"),!1;console.log("ensureCleanBackground: å°è¯•ä¸ºçº¯è‰²å¡«å……æ¨¡å¼åˆ›å»ºä¸´æ—¶å¹²å‡€èƒŒæ™¯");const S=l.translatedDataURL||l.originalDataURL,w=v?.fillColor||s.settings.textStyle.fillColor||"#FFFFFF";return new Promise(N=>{const Z=new Image;Z.onload=()=>{try{const Y=document.createElement("canvas");Y.width=Z.naturalWidth,Y.height=Z.naturalHeight;const c=Y.getContext("2d");if(!c){console.error("ensureCleanBackground: æ— æ³•è·å– Canvas ä¸Šä¸‹æ–‡"),N(!1);return}c.drawImage(Z,0,0),c.fillStyle=w;for(const le of l.bubbleStates){const[I,G,re,ke]=le.coords;c.fillRect(I,G,re-I+1,ke-G+1)}const h=Y.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:h}),console.log("ensureCleanBackground: æˆåŠŸåˆ›å»ºä¸´æ—¶å¹²å‡€èƒŒæ™¯ï¼ˆçº¯è‰²å¡«å……ï¼‰"),N(!0)}catch(Y){console.error("ensureCleanBackground: Canvas æ“ä½œå¤±è´¥:",Y),N(!1)}},Z.onerror=()=>{console.error("ensureCleanBackground: åŠ è½½å›¾åƒå¤±è´¥"),N(!1)},Z.src=S})}return Ft(()=>{W()}),{brushMode:o,brushSize:i,isBrushKeyDown:r,isBrushPainting:a,mouseX:p,mouseY:k,isActive:M,brushColor:B,BRUSH_MIN_SIZE:Yo,BRUSH_MAX_SIZE:Jo,enterBrushMode:$,exitBrushMode:W,toggleBrushMode:O,setBrushSize:U,adjustBrushSize:g,handleBrushWheel:d,startBrushPainting:x,continueBrushPainting:_,finishBrushPainting:K,getBrushPositionInImage:V,getBrushPathBounds:se,ensureCleanBackground:m}}function dm(n){return[Math.round(n[0]),Math.round(n[1]),Math.round(n[2]),Math.round(n[3])]}function gm(n){const t=ct(),s=Ze(),o=ze(),{bubbles:i,selectedIndex:r,hasSelection:a}=Ct(t),{currentImage:u}=Ct(s),p=C(!1),k=C(!1),f=C(null),P=C(0),A=C(0),M=C(!1);function B(c){t.selectBubble(c)}function $(c){t.toggleMultiSelect(c)}function W(){t.clearMultiSelect()}function O(c,h){console.log(`å¼€å§‹æ‹–åŠ¨æ°”æ³¡ #${c+1}`)}function U(c,h){}function g(c,h){t.updateBubble(c,{coords:h}),console.log(`æ°”æ³¡ #${c+1} æ‹–åŠ¨å®Œæˆ:`,h),D()}function d(c,h,le){console.log(`å¼€å§‹è°ƒæ•´æ°”æ³¡ #${c+1} å¤§å°ï¼Œæ‰‹æŸ„: ${h}`)}function x(c){}function _(c,h){t.updateBubble(c,{coords:h}),console.log(`æ°”æ³¡ #${c+1} è°ƒæ•´å¤§å°å®Œæˆ:`,h),D()}function K(c,h){console.log(`å¼€å§‹æ—‹è½¬æ°”æ³¡ #${c+1}`)}function V(c){}function se(c,h){t.updateBubble(c,{rotationAngle:h}),console.log(`æ°”æ³¡ #${c+1} æ—‹è½¬å®Œæˆ: ${h}Â°`),D()}function X(){p.value=!p.value,p.value?console.log("è¿›å…¥ç»˜åˆ¶æ¨¡å¼"):console.log("é€€å‡ºç»˜åˆ¶æ¨¡å¼")}function ie(c){t.addBubble(c),t.selectBubble(t.bubbleCount-1),console.log("å·²æ·»åŠ æ–°æ°”æ³¡:",c),n?.onReRender?.()}function z(c,h){k.value=!0,P.value=c,A.value=h,f.value=[c,h,c,h]}function R(c,h){k.value&&(f.value=[P.value,A.value,c,h])}function T(){if(!k.value||!f.value)return k.value=!1,f.value=null,null;const[c,h,le,I]=f.value,G=10;if(Math.abs(le-c)<G||Math.abs(I-h)<G)return k.value=!1,f.value=null,null;const re=[Math.min(c,le),Math.min(h,I),Math.max(c,le),Math.max(h,I)];return k.value=!1,f.value=null,re}function F(){k.value=!1,f.value=null,p.value=!1}function y(){if(!f.value)return{};const[c,h,le,I]=f.value;return{position:"absolute",left:`${Math.min(c,le)}px`,top:`${Math.min(h,I)}px`,width:`${Math.abs(le-c)}px`,height:`${Math.abs(I-h)}px`,border:"2px dashed #00d4ff",background:"rgba(0, 212, 255, 0.1)",pointerEvents:"none",zIndex:"25",boxSizing:"border-box"}}let m=null,l=!1;const v=150;function D(){m&&clearTimeout(m),m=setTimeout(async()=>{if(l){console.log("è·³è¿‡æ¸²æŸ“ï¼Œä¸Šä¸€æ¬¡æ¸²æŸ“ä»åœ¨è¿›è¡Œä¸­");return}console.log("è§¦å‘å»¶è¿Ÿæ¸²æŸ“é¢„è§ˆ"),l=!0;try{n?.onDelayedPreview?await n.onDelayedPreview():n?.onReRender&&await n.onReRender()}catch(c){console.error("å»¶è¿Ÿæ¸²æŸ“é¢„è§ˆå¤±è´¥:",c)}finally{l=!1}},v)}function S(c){t.updateSelectedBubble(c),D()}function w(){a.value&&(t.deleteSelected(),console.log("å·²åˆ é™¤é€‰ä¸­çš„æ°”æ³¡"),n?.onReRender?.())}async function N(){const c=r.value;if(c<0){console.warn("è¯·å…ˆé€‰ä¸­è¦ä¿®å¤çš„æ°”æ³¡æ¡†");return}const h=i.value[c],le=u.value;if(!h||!le?.originalDataURL){console.warn("æ— æ³•ä¿®å¤èƒŒæ™¯ï¼šç¼ºå°‘æ°”æ³¡æˆ–å›¾ç‰‡æ•°æ®");return}const I=h.inpaintMethod||"solid",G=h.fillColor||"#FFFFFF",re=h.rotationAngle||0;try{console.log(`å¼€å§‹ä¿®å¤æ°”æ³¡ #${c+1} èƒŒæ™¯ï¼Œæ–¹æ³•: ${I}`);let ke;if(le.cleanImageData)ke=le.cleanImageData;else{const Te=le.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/);if(ke=Te&&Te[1]?Te[1]:"",!ke){console.error("æ— æ³•è§£æå›¾åƒæ•°æ®");return}}if(I==="lama_mpe"||I==="litelama"){const Te=I==="litelama"?"litelama":"lama_mpe",he=dm(h.coords),ee=await yo(ke,he,{bubbleAngle:re,method:"lama",lamaModel:Te});ee.success&&ee.inpainted_image?(s.updateCurrentImage({cleanImageData:ee.inpainted_image}),console.log(`æ°”æ³¡ #${c+1} LAMAèƒŒæ™¯ä¿®å¤æˆåŠŸ`),D()):(console.error("LAMAä¿®å¤å¤±è´¥:",ee.error||"æœªçŸ¥é”™è¯¯"),await Z(h.coords,G,re),D())}else await Z(h.coords,G,re),console.log(`æ°”æ³¡ #${c+1} çº¯è‰²å¡«å……ä¿®å¤æˆåŠŸ`),D()}catch(ke){console.error("èƒŒæ™¯ä¿®å¤å‡ºé”™:",ke)}}async function Z(c,h,le=0){const I=u.value;if(!I)return;const[G,re,ke,De]=c;let Te;if(I.cleanImageData)Te="data:image/png;base64,"+I.cleanImageData;else if(I.originalDataURL)Te=I.originalDataURL;else{console.error("æ— æ³•æ‰¾åˆ°åŸºç¡€å›¾åƒç”¨äºå¡«å……");return}return new Promise(he=>{const ee=new Image;ee.onload=()=>{const b=document.createElement("canvas");b.width=ee.naturalWidth,b.height=ee.naturalHeight;const J=b.getContext("2d");if(!J){he();return}if(J.drawImage(ee,0,0),J.fillStyle=h,Math.abs(le)<.1)J.fillRect(G,re,ke-G,De-re);else{const H=(G+ke)/2,te=(re+De)/2,ue=(ke-G)/2,ve=(De-re)/2,fe=le*Math.PI/180,Pe=Math.cos(fe),Ee=Math.sin(fe),Be=[[-ue,-ve],[ue,-ve],[ue,ve],[-ue,ve]].map(([_e,we])=>[H+_e*Pe-we*Ee,te+_e*Ee+we*Pe]);J.beginPath();const Re=Be[0];if(Re){J.moveTo(Re[0],Re[1]);for(let _e=1;_e<Be.length;_e++){const we=Be[_e];we&&J.lineTo(we[0],we[1])}}J.closePath(),J.fill()}const me=b.toDataURL("image/png").split(",")[1];s.updateCurrentImage({cleanImageData:me}),console.log("å·²å¯¹æ°”æ³¡åŒºåŸŸè¿›è¡Œçº¯è‰²å¡«å……:",c,h,"è§’åº¦:",le),he()},ee.onerror=()=>{console.error("åŠ è½½åŸºç¡€å›¾åƒå¤±è´¥"),he()},ee.src=Te})}async function Y(c){const h=i.value[c],le=u.value;if(!h||!le?.originalDataURL){console.warn("æ— æ³•è¿›è¡Œ OCR è¯†åˆ«ï¼šç¼ºå°‘æ°”æ³¡æˆ–å›¾ç‰‡æ•°æ®");return}try{console.log(`å¼€å§‹ OCR è¯†åˆ«æ°”æ³¡ #${c+1}`);const I=le.originalDataURL.split(",")[1]||"",G=o.settings,re=await _n(I,h.coords,G.ocrEngine||"manga_ocr",{source_language:G.sourceLanguage,baidu_ocr_api_key:G.baiduOcr.apiKey,baidu_ocr_secret_key:G.baiduOcr.secretKey,baidu_version:G.baiduOcr.version,baidu_source_language:G.baiduOcr.sourceLanguage,ai_vision_provider:G.aiVisionOcr.provider,ai_vision_api_key:G.aiVisionOcr.apiKey,ai_vision_model_name:G.aiVisionOcr.modelName,ai_vision_ocr_prompt:G.aiVisionOcr.prompt,custom_ai_vision_base_url:G.aiVisionOcr.customBaseUrl,ai_vision_min_image_size:G.aiVisionOcr.minImageSize});re.success&&re.text!==void 0?(t.updateBubble(c,{originalText:re.text}),console.log(`OCR è¯†åˆ«æˆåŠŸ: "${re.text}"`)):console.error("OCR è¯†åˆ«å¤±è´¥:",re.error||"æœªçŸ¥é”™è¯¯")}catch(I){console.error("OCR è¯†åˆ«å‡ºé”™:",I)}}return{isDrawingMode:p,isDrawingBox:k,currentDrawingRect:f,isMiddleButtonDown:M,handleBubbleSelect:B,handleBubbleMultiSelect:$,handleClearMultiSelect:W,handleBubbleDragStart:O,handleBubbleDragging:U,handleBubbleDragEnd:g,handleBubbleResizeStart:d,handleBubbleResizing:x,handleBubbleResizeEnd:_,handleBubbleRotateStart:K,handleBubbleRotating:V,handleBubbleRotateEnd:se,toggleDrawingMode:X,handleDrawBubble:ie,startDrawingBox:z,updateDrawingBox:R,finishDrawingBox:T,cancelDrawing:F,getDrawingRectStyle:y,handleBubbleUpdate:S,deleteSelectedBubbles:w,repairSelectedBubble:N,triggerDelayedPreview:D,handleOcrRecognize:Y}}function pm(n){const t=ct(),s=Ze(),{bubbles:o}=Ct(t),{currentImage:i}=Ct(s),r=C(!1),a=C("");let u=null;function p(){const P=i.value;if(!P)return null;if(P.cleanImageData)return P.cleanImageData;if(P.originalDataURL){const A=P.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/);if(A&&A[1])return A[1]}return null}async function k(P=!1){if(!i.value)return console.warn("reRenderFullImage: æ²¡æœ‰å½“å‰å›¾ç‰‡"),!1;if(o.value.length===0){console.log("reRenderFullImage: æ²¡æœ‰æ°”æ³¡ï¼Œè·³è¿‡åç«¯æ¸²æŸ“");const $=p();if($){const W=`data:image/png;base64,${$}`;s.updateCurrentImage({translatedDataURL:W}),P||n?.onRenderSuccess?.(W)}return!0}const M=p();if(!M)return console.error("reRenderFullImage: ç¼ºå°‘å›¾åƒæ•°æ®"),a.value="ç¼ºå°‘å›¾åƒæ•°æ®",P||n?.onRenderError?.("ç¼ºå°‘å›¾åƒæ•°æ®"),!1;const B=Symbol("render");u=B,r.value=!0,a.value="",P||n?.onRenderStart?.();try{console.log("reRenderFullImage: å¼€å§‹é‡æ–°æ¸²æŸ“ï¼Œæ°”æ³¡æ•°é‡:",o.value.length);const $=o.value,W=$.map(d=>d.translatedText||""),O=$.map(d=>d.coords.map(x=>Math.round(x))),U=$.map(d=>({translatedText:d.translatedText||"",coords:d.coords,fontSize:Number(d.fontSize)||24,fontFamily:d.fontFamily||ht,textDirection:wt(d),textColor:d.textColor||"#231816",rotationAngle:Math.round(Number(d.rotationAngle)||0),position:d.position?{x:Math.round(d.position.x||0),y:Math.round(d.position.y||0)}:{x:0,y:0},strokeEnabled:d.strokeEnabled!==void 0?d.strokeEnabled:!0,strokeColor:d.strokeColor||"#FFFFFF",strokeWidth:Number(d.strokeWidth)||3})),g=await ho({clean_image:M,bubble_texts:W,bubble_coords:O,bubble_states:U,fontSize:Number($[0]?.fontSize)||24,fontFamily:$[0]?.fontFamily||ht,textDirection:$[0]?wt($[0]):"vertical",textColor:$[0]?.textColor||"#231816",strokeEnabled:$[0]?.strokeEnabled!==void 0?$[0].strokeEnabled:!0,strokeColor:$[0]?.strokeColor||"#FFFFFF",strokeWidth:Number($[0]?.strokeWidth)||3,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,is_font_style_change:!0});if(u!==B)return console.log("reRenderFullImage: æ¸²æŸ“ç»“æœå·²è¿‡æœŸï¼Œå¿½ç•¥"),!1;if(g.rendered_image){const d=`data:image/png;base64,${g.rendered_image}`;return s.updateCurrentImage({translatedDataURL:d}),console.log("reRenderFullImage: æ¸²æŸ“æˆåŠŸ"),P||n?.onRenderSuccess?.(d),!0}else{const d=g.error||"æ¸²æŸ“å¤±è´¥";return console.error("reRenderFullImage: æ¸²æŸ“å¤±è´¥ -",d),a.value=d,P||n?.onRenderError?.(d),!1}}catch($){if(u!==B)return!1;const W=$ instanceof Error?$.message:"æ¸²æŸ“è¯·æ±‚å¤±è´¥";return console.error("reRenderFullImage: æ¸²æŸ“å‡ºé”™ -",$),a.value=W,P||n?.onRenderError?.(W),!1}finally{u===B&&(r.value=!1,P||n?.onRenderEnd?.())}}function f(){u=null,r.value=!1}return{isRendering:r,renderError:a,reRenderFullImage:k,cancelRender:f}}const mm=["data-index","data-coords","data-rotation","onClick","onMousedown"],vm={class:"bubble-index"},fm=["data-parent-index","onMousedown"],bm=["data-parent-index","onMousedown"],hm=["data-parent-index","onMousedown"],ym=["data-parent-index","onMousedown"],xm=["data-parent-index","onMousedown"],_m=["data-parent-index","onMousedown"],Cm=["data-parent-index","onMousedown"],Sm=["data-parent-index","onMousedown"],km=["data-parent-index","onMousedown"],wm=je({__name:"BubbleOverlay",props:{bubbles:{},selectedIndex:{},selectedIndices:{},scale:{},isDrawingMode:{type:Boolean},isBrushMode:{type:Boolean},imageWidth:{},imageHeight:{}},emits:["select","multiSelect","dragStart","dragging","dragEnd","resizeStart","resizing","resizeEnd","rotateStart","rotating","rotateEnd","drawBubble"],setup(n,{emit:t}){const s=ct(),{isDragging:o,draggingIndex:i,dragOffsetX:r,dragOffsetY:a,dragInitialX:u,dragInitialY:p,isResizing:k,resizingIndex:f,resizeCurrentCoords:P,isRotating:A,rotatingIndex:M,rotateCurrentAngle:B}=Ct(s),$=n,W=t,O=C(null),U=C(0),g=C(0),d=C(""),x=C(0),_=C(0),K=C(null),V=C(0),se=C(0),X=C(0),ie=C(0),z=C(!1),R=C(0),T=C(0),F=C(null),y=C(!1);function m(b,J){let me,H,te,ue,ve=b.rotationAngle||0;if(o.value&&i.value===J){const[Be,Re,_e,we]=b.coords;me=u.value+r.value,H=p.value+a.value,te=me+(_e-Be),ue=H+(we-Re)}else k.value&&f.value===J&&P.value?[me,H,te,ue]=P.value:A.value&&M.value===J?([me,H,te,ue]=b.coords,ve=B.value):[me,H,te,ue]=b.coords;const fe=te-me,Pe=ue-H,Ee={left:`${me}px`,top:`${H}px`,width:`${fe}px`,height:`${Pe}px`};return ve&&(Ee.transformOrigin="center center",Ee.transform=`rotate(${ve}deg)`),Ee}function l(){if(!F.value)return{};const[b,J,me,H]=F.value;return{left:`${Math.min(b,me)}px`,top:`${Math.min(J,H)}px`,width:`${Math.abs(me-b)}px`,height:`${Math.abs(H-J)}px`}}function v(b){if(!O.value)return null;const J=O.value.getBoundingClientRect(),me=$.scale||1,H=(b.clientX-J.left)/me,te=(b.clientY-J.top)/me;return{x:H,y:te}}function D(b,J){$.isBrushMode||J.shiftKey||W("select",b)}function S(b){if(!$.isBrushMode){if(b.button===1){b.preventDefault(),y.value=!0,document.body.classList.add("middle-button-drawing"),ke(b);return}b.button===0&&$.isDrawingMode&&ke(b)}}function w(b,J){if(!$.isBrushMode&&J.button===0){if(J.preventDefault(),J.stopPropagation(),J.shiftKey){W("multiSelect",b);return}if(b!==$.selectedIndex){W("select",b);return}N(b,J)}}function N(b,J){document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",ee),o.value=!0,i.value=b,U.value=J.clientX,g.value=J.clientY,r.value=0,a.value=0;const me=$.bubbles[b];me&&(u.value=me.coords[0],p.value=me.coords[1]),W("dragStart",b,J),document.addEventListener("mousemove",he),document.addEventListener("mouseup",ee)}function Z(b){const J=$.scale||1,me=(b.clientX-U.value)/J,H=(b.clientY-g.value)/J;r.value=me,a.value=H}function Y(b){const J=i.value;o.value=!1,i.value=-1,r.value=0,a.value=0;const me=$.scale||1,H=(b.clientX-U.value)/me,te=(b.clientY-g.value)/me,ue=$.bubbles[J];if(!ue)return;const[ve,fe,Pe,Ee]=ue.coords,Be=Pe-ve,Re=Ee-fe;let _e=Math.round(u.value+H),we=Math.round(p.value+te);const Le=$.imageWidth||2e3,Ge=$.imageHeight||2e3,st=Math.min(Be,Le),tt=Math.min(Re,Ge);_e=Math.max(0,Math.min(_e,Le-st)),we=Math.max(0,Math.min(we,Ge-tt));const ye=[_e,we,_e+st,we+tt];W("dragEnd",J,ye)}function c(b,J,me){if($.isBrushMode||me.button!==0)return;me.preventDefault(),me.stopPropagation(),document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",ee),k.value=!0,f.value=J,d.value=b,x.value=me.clientX,_.value=me.clientY;const H=$.bubbles[J];H&&(K.value=[...H.coords],P.value=[...H.coords]),W("resizeStart",J,b,me),document.addEventListener("mousemove",he),document.addEventListener("mouseup",ee)}function h(b){if(!K.value)return;const J=$.scale||1,me=(b.clientX-x.value)/J,H=(b.clientY-_.value)/J;let[te,ue,ve,fe]=K.value;const Pe=d.value;Pe.includes("w")&&(te+=me),Pe.includes("e")&&(ve+=me),Pe.includes("n")&&(ue+=H),Pe.includes("s")&&(fe+=H),te>ve&&([te,ve]=[ve,te]),ue>fe&&([ue,fe]=[fe,ue]);const Ee=10;ve-te<Ee||fe-ue<Ee||(P.value=[te,ue,ve,fe])}function le(b){if(!K.value)return;const J=$.scale||1,me=(b.clientX-x.value)/J,H=(b.clientY-_.value)/J;let[te,ue,ve,fe]=K.value;const Pe=d.value;Pe.includes("w")&&(te+=me),Pe.includes("e")&&(ve+=me),Pe.includes("n")&&(ue+=H),Pe.includes("s")&&(fe+=H),te>ve&&([te,ve]=[ve,te]),ue>fe&&([ue,fe]=[fe,ue]);const Ee=$.imageWidth||2e3,Be=$.imageHeight||2e3;te=Math.max(0,Math.round(te)),ue=Math.max(0,Math.round(ue)),ve=Math.min(Ee,Math.round(ve)),fe=Math.min(Be,Math.round(fe));const Re=10;if(ve-te<Re||fe-ue<Re){console.warn("è°ƒæ•´åå°ºå¯¸è¿‡å°ï¼Œå·²æ’¤é”€"),k.value=!1,f.value=-1,K.value=null;return}W("resizeEnd",f.value,[te,ue,ve,fe]),k.value=!1,f.value=-1,K.value=null,P.value=null}function I(b,J){if($.isBrushMode||J.button!==0)return;J.preventDefault(),J.stopPropagation(),document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",ee),A.value=!0,M.value=b;const me=$.bubbles[b];if(!me||!O.value)return;const[H,te,ue,ve]=me.coords,fe=$.scale||1,Pe=O.value.getBoundingClientRect();X.value=Pe.left+(H+ue)/2*fe,ie.value=Pe.top+(te+ve)/2*fe;const Ee=J.clientX-X.value,Be=J.clientY-ie.value;V.value=Math.atan2(Be,Ee)*180/Math.PI,se.value=me.rotationAngle||0,B.value=me.rotationAngle||0,W("rotateStart",b,J),document.body.classList.add("rotating-box"),document.addEventListener("mousemove",he),document.addEventListener("mouseup",ee),console.log(`å¼€å§‹æ—‹è½¬æ°”æ³¡ #${b+1}ï¼Œåˆå§‹è§’åº¦: ${se.value}Â°`)}function G(b){const J=b.clientX-X.value,me=b.clientY-ie.value,te=Math.atan2(me,J)*180/Math.PI-V.value;let ue=se.value+te;for(;ue>180;)ue-=360;for(;ue<-180;)ue+=360;b.shiftKey&&(ue=Math.round(ue/15)*15),B.value=ue}function re(b){document.body.classList.remove("rotating-box");const J=M.value,me=B.value;W("rotateEnd",J,me),A.value=!1,M.value=-1,console.log(`æ°”æ³¡ #${J+1} æ—‹è½¬å®Œæˆï¼Œè§’åº¦: ${me}Â°`)}function ke(b){const J=v(b);if(!J)return;const me=$.imageWidth||2e3,H=$.imageHeight||2e3;J.x<0||J.x>me||J.y<0||J.y>H||(z.value=!0,R.value=J.x,T.value=J.y,F.value=[J.x,J.y,J.x,J.y],document.addEventListener("mousemove",he),document.addEventListener("mouseup",ee),console.log("å¼€å§‹ç»˜åˆ¶æ–°æ¡†:",J.x.toFixed(1),J.y.toFixed(1)))}function De(b){const J=v(b);!J||!F.value||(F.value=[R.value,T.value,J.x,J.y])}function Te(b){const J=v(b);if(y.value&&(y.value=!1,document.body.classList.remove("middle-button-drawing")),!J||!F.value){z.value=!1,F.value=null;return}const me=$.imageWidth||2e3,H=$.imageHeight||2e3,te=Math.max(0,Math.round(Math.min(R.value,J.x))),ue=Math.max(0,Math.round(Math.min(T.value,J.y))),ve=Math.min(me,Math.round(Math.max(R.value,J.x))),fe=Math.min(H,Math.round(Math.max(T.value,J.y))),Pe=10;if(ve-te<Pe||fe-ue<Pe){console.log("ç»˜åˆ¶çš„æ¡†å¤ªå°ï¼Œå·²å¿½ç•¥"),z.value=!1,F.value=null;return}console.log("å®Œæˆç»˜åˆ¶æ–°æ¡†:",[te,ue,ve,fe]),W("drawBubble",[te,ue,ve,fe]),z.value=!1,F.value=null}function he(b){o.value?Z(b):k.value?h(b):A.value?G(b):z.value&&De(b)}function ee(b){document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",ee),(b.button===1||y.value)&&(y.value=!1,document.body.classList.remove("middle-button-drawing")),o.value?Y(b):k.value?le(b):A.value?re():z.value&&Te(b)}return ut(()=>{}),Ft(()=>{document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",ee),document.body.classList.remove("middle-button-drawing"),document.body.classList.remove("rotating-box")}),(b,J)=>(E(),L("div",{class:Ie(["bubble-overlay",{"brush-mode":n.isBrushMode}]),style:ot({"--scale":n.scale||1}),ref_key:"overlayRef",ref:O,onMousedown:S},[(E(!0),L(Oe,null,Ye(n.bubbles,(me,H)=>(E(),L("div",{key:H,class:Ie(["bubble-highlight-box",{selected:H===n.selectedIndex,"multi-selected":n.selectedIndices.length>1&&n.selectedIndices.includes(H)&&H!==n.selectedIndex}]),style:ot(m(me,H)),"data-index":H,"data-coords":JSON.stringify(me.coords),"data-rotation":me.rotationAngle||0,onClick:nt(te=>D(H,te),["stop"]),onMousedown:nt(te=>w(H,te),["stop"])},[e("span",vm,ne(H+1),1),H===n.selectedIndex?(E(),L(Oe,{key:0},[e("div",{class:"resize-handle nw","data-handle":"nw","data-parent-index":H,onMousedown:nt(te=>c("nw",H,te),["stop"])},null,40,fm),e("div",{class:"resize-handle n","data-handle":"n","data-parent-index":H,onMousedown:nt(te=>c("n",H,te),["stop"])},null,40,bm),e("div",{class:"resize-handle ne","data-handle":"ne","data-parent-index":H,onMousedown:nt(te=>c("ne",H,te),["stop"])},null,40,hm),e("div",{class:"resize-handle e","data-handle":"e","data-parent-index":H,onMousedown:nt(te=>c("e",H,te),["stop"])},null,40,ym),e("div",{class:"resize-handle se","data-handle":"se","data-parent-index":H,onMousedown:nt(te=>c("se",H,te),["stop"])},null,40,xm),e("div",{class:"resize-handle s","data-handle":"s","data-parent-index":H,onMousedown:nt(te=>c("s",H,te),["stop"])},null,40,_m),e("div",{class:"resize-handle sw","data-handle":"sw","data-parent-index":H,onMousedown:nt(te=>c("sw",H,te),["stop"])},null,40,Cm),e("div",{class:"resize-handle w","data-handle":"w","data-parent-index":H,onMousedown:nt(te=>c("w",H,te),["stop"])},null,40,Sm),J[0]||(J[0]=e("div",{class:"rotate-line"},null,-1)),e("div",{class:"rotate-handle",title:"æ‹–æ‹½æ—‹è½¬","data-parent-index":H,onMousedown:nt(te=>I(H,te),["stop"])},null,40,km)],64)):de("",!0)],46,mm))),128)),F.value?(E(),L("div",{key:0,class:"drawing-rect",style:ot(l())},null,4)):de("",!0)],38))}}),gn=He(wm,[["__scopeId","data-v-8d9cb1b9"]]),$m={key:0,class:"kana-keyboard"},Tm={class:"kana-keyboard-header"},Im={class:"kana-keyboard-tabs"},Pm=["onClick"],Rm={class:"kana-keyboard-options"},Dm={class:"kana-mode-select"},Mm={class:"kana-target-select"},Em={class:"kana-table"},Bm={class:"row-label"},Am=["onClick"],Lm={class:"kana-hiragana"},Fm={class:"kana-katakana"},Um={class:"kana-table"},Om={class:"row-label"},zm=["onClick"],Nm={class:"kana-hiragana"},Vm={class:"kana-katakana"},Wm={class:"kana-table combo-table"},Km={class:"row-label"},qm=["onClick"],Hm={class:"kana-hiragana"},jm={class:"kana-katakana"},Jm={class:"special-chars-grid"},Ym=["onClick"],Xm={key:0,class:"char-label"},Gm=je({__name:"JapaneseKeyboard",props:{visible:{type:Boolean,default:!1},defaultTarget:{default:"original"}},emits:["close","insert","delete"],setup(n,{emit:t}){const s=n,o=t,i=C("basic"),r=C("hiragana"),a=C(s.defaultTarget),u=C(null),p=[{label:"åŸæ–‡",value:"original"},{label:"è¯‘æ–‡",value:"translated"}],k=[{id:"basic",label:"åŸºæœ¬"},{id:"dakuten",label:"æµŠ/åŠæµŠéŸ³"},{id:"combo",label:"æ‹—éŸ³"},{id:"special",label:"ç‰¹æ®Š"}],f=[{label:"ã‚è¡Œ",chars:[{h:"ã‚",k:"ã‚¢"},{h:"ã„",k:"ã‚¤"},{h:"ã†",k:"ã‚¦"},{h:"ãˆ",k:"ã‚¨"},{h:"ãŠ",k:"ã‚ª"}]},{label:"ã‹è¡Œ",chars:[{h:"ã‹",k:"ã‚«"},{h:"ã",k:"ã‚­"},{h:"ã",k:"ã‚¯"},{h:"ã‘",k:"ã‚±"},{h:"ã“",k:"ã‚³"}]},{label:"ã•è¡Œ",chars:[{h:"ã•",k:"ã‚µ"},{h:"ã—",k:"ã‚·"},{h:"ã™",k:"ã‚¹"},{h:"ã›",k:"ã‚»"},{h:"ã",k:"ã‚½"}]},{label:"ãŸè¡Œ",chars:[{h:"ãŸ",k:"ã‚¿"},{h:"ã¡",k:"ãƒ"},{h:"ã¤",k:"ãƒ„"},{h:"ã¦",k:"ãƒ†"},{h:"ã¨",k:"ãƒˆ"}]},{label:"ãªè¡Œ",chars:[{h:"ãª",k:"ãƒŠ"},{h:"ã«",k:"ãƒ‹"},{h:"ã¬",k:"ãƒŒ"},{h:"ã­",k:"ãƒ"},{h:"ã®",k:"ãƒ"}]},{label:"ã¯è¡Œ",chars:[{h:"ã¯",k:"ãƒ"},{h:"ã²",k:"ãƒ’"},{h:"ãµ",k:"ãƒ•"},{h:"ã¸",k:"ãƒ˜"},{h:"ã»",k:"ãƒ›"}]},{label:"ã¾è¡Œ",chars:[{h:"ã¾",k:"ãƒ"},{h:"ã¿",k:"ãƒŸ"},{h:"ã‚€",k:"ãƒ "},{h:"ã‚",k:"ãƒ¡"},{h:"ã‚‚",k:"ãƒ¢"}]},{label:"ã‚„è¡Œ",chars:[{h:"ã‚„",k:"ãƒ¤"},null,{h:"ã‚†",k:"ãƒ¦"},null,{h:"ã‚ˆ",k:"ãƒ¨"}]},{label:"ã‚‰è¡Œ",chars:[{h:"ã‚‰",k:"ãƒ©"},{h:"ã‚Š",k:"ãƒª"},{h:"ã‚‹",k:"ãƒ«"},{h:"ã‚Œ",k:"ãƒ¬"},{h:"ã‚",k:"ãƒ­"}]},{label:"ã‚è¡Œ",chars:[{h:"ã‚",k:"ãƒ¯"},null,null,null,{h:"ã‚’",k:"ãƒ²"}]},{label:"ã‚“",chars:[{h:"ã‚“",k:"ãƒ³"},null,null,null,null]}],P=[{label:"ãŒè¡Œ",chars:[{h:"ãŒ",k:"ã‚¬"},{h:"ã",k:"ã‚®"},{h:"ã",k:"ã‚°"},{h:"ã’",k:"ã‚²"},{h:"ã”",k:"ã‚´"}]},{label:"ã–è¡Œ",chars:[{h:"ã–",k:"ã‚¶"},{h:"ã˜",k:"ã‚¸"},{h:"ãš",k:"ã‚º"},{h:"ãœ",k:"ã‚¼"},{h:"ã",k:"ã‚¾"}]},{label:"ã è¡Œ",chars:[{h:"ã ",k:"ãƒ€"},{h:"ã¢",k:"ãƒ‚"},{h:"ã¥",k:"ãƒ…"},{h:"ã§",k:"ãƒ‡"},{h:"ã©",k:"ãƒ‰"}]},{label:"ã°è¡Œ",chars:[{h:"ã°",k:"ãƒ"},{h:"ã³",k:"ãƒ“"},{h:"ã¶",k:"ãƒ–"},{h:"ã¹",k:"ãƒ™"},{h:"ã¼",k:"ãƒœ"}]},{label:"ã±è¡Œ",chars:[{h:"ã±",k:"ãƒ‘"},{h:"ã´",k:"ãƒ”"},{h:"ã·",k:"ãƒ—"},{h:"ãº",k:"ãƒš"},{h:"ã½",k:"ãƒ"}]}],A=[{label:"ãã‚ƒè¡Œ",chars:[{h:"ãã‚ƒ",k:"ã‚­ãƒ£"},{h:"ãã‚…",k:"ã‚­ãƒ¥"},{h:"ãã‚‡",k:"ã‚­ãƒ§"}]},{label:"ã—ã‚ƒè¡Œ",chars:[{h:"ã—ã‚ƒ",k:"ã‚·ãƒ£"},{h:"ã—ã‚…",k:"ã‚·ãƒ¥"},{h:"ã—ã‚‡",k:"ã‚·ãƒ§"}]},{label:"ã¡ã‚ƒè¡Œ",chars:[{h:"ã¡ã‚ƒ",k:"ãƒãƒ£"},{h:"ã¡ã‚…",k:"ãƒãƒ¥"},{h:"ã¡ã‚‡",k:"ãƒãƒ§"}]},{label:"ã«ã‚ƒè¡Œ",chars:[{h:"ã«ã‚ƒ",k:"ãƒ‹ãƒ£"},{h:"ã«ã‚…",k:"ãƒ‹ãƒ¥"},{h:"ã«ã‚‡",k:"ãƒ‹ãƒ§"}]},{label:"ã²ã‚ƒè¡Œ",chars:[{h:"ã²ã‚ƒ",k:"ãƒ’ãƒ£"},{h:"ã²ã‚…",k:"ãƒ’ãƒ¥"},{h:"ã²ã‚‡",k:"ãƒ’ãƒ§"}]},{label:"ã¿ã‚ƒè¡Œ",chars:[{h:"ã¿ã‚ƒ",k:"ãƒŸãƒ£"},{h:"ã¿ã‚…",k:"ãƒŸãƒ¥"},{h:"ã¿ã‚‡",k:"ãƒŸãƒ§"}]},{label:"ã‚Šã‚ƒè¡Œ",chars:[{h:"ã‚Šã‚ƒ",k:"ãƒªãƒ£"},{h:"ã‚Šã‚…",k:"ãƒªãƒ¥"},{h:"ã‚Šã‚‡",k:"ãƒªãƒ§"}]},{label:"ãã‚ƒè¡Œ",chars:[{h:"ãã‚ƒ",k:"ã‚®ãƒ£"},{h:"ãã‚…",k:"ã‚®ãƒ¥"},{h:"ãã‚‡",k:"ã‚®ãƒ§"}]},{label:"ã˜ã‚ƒè¡Œ",chars:[{h:"ã˜ã‚ƒ",k:"ã‚¸ãƒ£"},{h:"ã˜ã‚…",k:"ã‚¸ãƒ¥"},{h:"ã˜ã‚‡",k:"ã‚¸ãƒ§"}]},{label:"ã³ã‚ƒè¡Œ",chars:[{h:"ã³ã‚ƒ",k:"ãƒ“ãƒ£"},{h:"ã³ã‚…",k:"ãƒ“ãƒ¥"},{h:"ã³ã‚‡",k:"ãƒ“ãƒ§"}]},{label:"ã´ã‚ƒè¡Œ",chars:[{h:"ã´ã‚ƒ",k:"ãƒ”ãƒ£"},{h:"ã´ã‚…",k:"ãƒ”ãƒ¥"},{h:"ã´ã‚‡",k:"ãƒ”ãƒ§"}]}],M=[{char:"ã£",label:"ä¿ƒéŸ³"},{char:"ãƒƒ",label:"ä¿ƒéŸ³"},{char:"ãƒ¼",label:"é•¿éŸ³"},{char:"ã€œ",label:"æ³¢æµª"},{char:"ã€‚",label:"å¥å·"},{char:"ã€",label:"é¡¿å·"},{char:"ã€Œ",label:"å¼•å·"},{char:"ã€",label:"å¼•å·"},{char:"ã€",label:"åŒå¼•"},{char:"ã€",label:"åŒå¼•"},{char:"â€¦",label:"çœç•¥"},{char:"ãƒ»",label:"ä¸­ç‚¹"},{char:"ï¼",label:"æ„Ÿå¹"},{char:"ï¼Ÿ",label:"é—®å·"},{char:"â™ª",label:"éŸ³ç¬¦"},{char:"â™¡",label:"å¿ƒå½¢"},{char:"â˜…",label:"æ˜Ÿå½¢"},{char:"â˜†",label:"ç©ºæ˜Ÿ"},{char:"ã",label:"å°ã‚"},{char:"ãƒ",label:"å°ã„"},{char:"ã…",label:"å°ã†"},{char:"ã‡",label:"å°ãˆ"},{char:"ã‰",label:"å°ãŠ"},{char:"ã‚¡",label:"å°ã‚¢"},{char:"ã‚£",label:"å°ã‚¤"},{char:"ã‚¥",label:"å°ã‚¦"},{char:"ã‚§",label:"å°ã‚¨"},{char:"ã‚©",label:"å°ã‚ª"},{char:"ã‚ƒ",label:"å°ã‚„"},{char:"ã‚…",label:"å°ã‚†"},{char:"ã‚‡",label:"å°ã‚ˆ"},{char:"ãƒ£",label:"å°ãƒ¤"},{char:"ãƒ¥",label:"å°ãƒ¦"},{char:"ãƒ§",label:"å°ãƒ¨"}];function B(){o("close")}function $(U){const g=r.value==="hiragana"?U.h:U.k;u.value=U.h,setTimeout(()=>{u.value=null},100),o("insert",g,a.value)}function W(U){u.value=U,setTimeout(()=>{u.value=null},100),o("insert",U,a.value)}function O(){o("delete",a.value)}return(U,g)=>n.visible?(E(),L("div",$m,[e("div",Tm,[g[3]||(g[3]=e("span",{class:"kana-keyboard-title"},"50éŸ³é”®ç›˜",-1)),e("div",Im,[(E(),L(Oe,null,Ye(k,d=>e("button",{key:d.id,class:Ie(["kana-tab",{active:i.value===d.id}]),onClick:x=>i.value=d.id},ne(d.label),11,Pm)),64))]),e("button",{class:"kana-keyboard-close",onClick:B},"âœ•")]),e("div",Rm,[e("div",Dm,[e("label",null,[ae(e("input",{type:"radio",name:"kanaMode",value:"hiragana","onUpdate:modelValue":g[0]||(g[0]=d=>r.value=d)},null,512),[[en,r.value]]),g[4]||(g[4]=pe(" å¹³å‡å ",-1))]),e("label",null,[ae(e("input",{type:"radio",name:"kanaMode",value:"katakana","onUpdate:modelValue":g[1]||(g[1]=d=>r.value=d)},null,512),[[en,r.value]]),g[5]||(g[5]=pe(" ç‰‡å‡å ",-1))])]),e("div",Mm,[g[6]||(g[6]=e("label",null,"è¾“å…¥åˆ°ï¼š",-1)),Ce(Ke,{modelValue:a.value,"onUpdate:modelValue":g[2]||(g[2]=d=>a.value=d),options:p},null,8,["modelValue"])])]),e("div",{class:Ie(["kana-tab-content",{active:i.value==="basic"}])},[e("table",Em,[g[7]||(g[7]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚æ®µ"),e("th",null,"ã„æ®µ"),e("th",null,"ã†æ®µ"),e("th",null,"ãˆæ®µ"),e("th",null,"ãŠæ®µ")])],-1)),e("tbody",null,[(E(),L(Oe,null,Ye(f,d=>e("tr",{key:d.label},[e("td",Bm,ne(d.label),1),(E(!0),L(Oe,null,Ye(d.chars,(x,_)=>(E(),L("td",{key:_},[x?(E(),L("button",{key:0,class:Ie(["kana-key",{pressed:u.value===x.h}]),onClick:K=>$(x)},[e("span",Lm,ne(x.h),1),e("span",Fm,ne(x.k),1)],10,Am)):de("",!0)]))),128))])),64))])])],2),e("div",{class:Ie(["kana-tab-content",{active:i.value==="dakuten"}])},[e("table",Um,[g[8]||(g[8]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚æ®µ"),e("th",null,"ã„æ®µ"),e("th",null,"ã†æ®µ"),e("th",null,"ãˆæ®µ"),e("th",null,"ãŠæ®µ")])],-1)),e("tbody",null,[(E(),L(Oe,null,Ye(P,d=>e("tr",{key:d.label},[e("td",Om,ne(d.label),1),(E(!0),L(Oe,null,Ye(d.chars,(x,_)=>(E(),L("td",{key:_},[x?(E(),L("button",{key:0,class:Ie(["kana-key",{pressed:u.value===x.h}]),onClick:K=>$(x)},[e("span",Nm,ne(x.h),1),e("span",Vm,ne(x.k),1)],10,zm)):de("",!0)]))),128))])),64))])])],2),e("div",{class:Ie(["kana-tab-content",{active:i.value==="combo"}])},[e("table",Wm,[g[9]||(g[9]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚ƒ"),e("th",null,"ã‚…"),e("th",null,"ã‚‡")])],-1)),e("tbody",null,[(E(),L(Oe,null,Ye(A,d=>e("tr",{key:d.label},[e("td",Km,ne(d.label),1),(E(!0),L(Oe,null,Ye(d.chars,(x,_)=>(E(),L("td",{key:_},[x?(E(),L("button",{key:0,class:Ie(["kana-key",{pressed:u.value===x.h}]),onClick:K=>$(x)},[e("span",Hm,ne(x.h),1),e("span",jm,ne(x.k),1)],10,qm)):de("",!0)]))),128))])),64))])])],2),e("div",{class:Ie(["kana-tab-content",{active:i.value==="special"}])},[e("div",Jm,[(E(),L(Oe,null,Ye(M,d=>e("button",{key:d.char,class:Ie(["kana-key special-key",{pressed:u.value===d.char}]),onClick:x=>W(d.char)},[pe(ne(d.char)+" ",1),d.label?(E(),L("span",Xm,ne(d.label),1)):de("",!0)],10,Ym)),64))])],2),e("div",{class:"kana-keyboard-footer"},[e("button",{class:"kana-backspace",onClick:O},"âŒ« é€€æ ¼")])])):de("",!0)}}),Zm=He(Gm,[["__scopeId","data-v-ebfc2125"]]),Qm={class:"edit-panel-content"},ev={class:"text-column original-text-column text-block"},tv={class:"text-column translated-text-column text-block"},ov={class:"style-settings-section text-block"},nv={class:"office-toolbar"},sv={class:"toolbar-row toolbar-row-top"},av={class:"combo-control font-control"},lv={class:"combo-control size-control"},iv={class:"size-input-wrap"},rv=["min","max","step"],uv={class:"toolbar-row toolbar-row-actions"},cv={class:"toolbar-icon-group","aria-label":"æ’ç‰ˆæ–¹å‘"},dv=["data-active"],gv=["data-active"],pv={class:"toolbar-color-group"},mv={class:"toolbar-color-picker",title:"æ–‡å­—é¢œè‰²"},vv={class:"toolbar-inpaint-group",title:"èƒŒæ™¯ä¿®å¤æ–¹å¼"},fv={class:"toolbar-stroke-cluster"},bv=["data-active"],hv={class:"toolbar-row toolbar-row-bottom"},yv={class:"toolbar-rotation-group",title:"æ—‹è½¬è§’åº¦"},xv={class:"toolbar-position-group",title:"ä½ç½®è°ƒæ•´"},_v={class:"toolbar-position-value"},Cv={class:"fontsize-presets-panel"},Sv={class:"font-size-presets"},kv=["onClick"],Vt=2,wv=je({__name:"BubbleEditor",props:{bubble:{},bubbleIndex:{}},emits:["update","reRender","ocrRecognize","reTranslate","applyBubble","resetCurrent"],setup(n,{emit:t}){const s=n,o=t,i=ct(),r={originalText:"",translatedText:"",fontSize:24,fontFamily:ht,textDirection:"vertical",textColor:"#231816",fillColor:"#FFFFFF",strokeEnabled:!0,strokeColor:"#FFFFFF",strokeWidth:3,rotationAngle:0,inpaintMethod:"solid",position:{x:0,y:0}},a=C(""),u=C(""),p=C(24),k=C(ht),f=C("vertical"),P=C("#231816"),A=C("#FFFFFF"),M=C(!0),B=C("#FFFFFF"),$=C(3),W=C(0),O=C("solid"),U=C(0),g=C(0),d=C(null),x=C(null),_=C(null),K=C(null),V=C(null),se=C(!1),X=C("original"),ie=C([{name:"æ€æºé»‘ä½“",path:ht},{name:"åæ–‡æ¥·ä½“",path:"fonts/STKAITI.TTF"},{name:"åæ–‡ç»†é»‘",path:"fonts/STXIHEI.TTF"},{name:"é»‘ä½“",path:"fonts/SIMHEI.TTF"},{name:"å®‹ä½“",path:"fonts/SIMSUN.TTC"}]),z=C([]),R=j(()=>s.bubble?s.bubble.coords[0]+U.value:0),T=j(()=>s.bubble?s.bubble.coords[1]+g.value:0),F=j(()=>{const ye=[{label:"ç³»ç»Ÿå­—ä½“",options:ie.value.map(oe=>({label:oe.name,value:oe.path}))}];return z.value.length>0&&ye.push({label:"è‡ªå®šä¹‰å­—ä½“",options:z.value.map(oe=>({label:oe.name,value:oe.path}))}),ye}),y=[{label:"çº¯è‰²å¡«å……",value:"solid"},{label:"LAMAä¿®å¤(æ¼«ç”»)",value:"lama_mpe"},{label:"LAMAä¿®å¤(é€šç”¨)",value:"litelama"}];function m(ye){const oe=ye||r;a.value=oe.originalText,u.value=oe.translatedText,p.value=oe.fontSize,k.value=oe.fontFamily,f.value=oe.textDirection,P.value=oe.textColor,A.value=oe.fillColor,M.value=oe.strokeEnabled,B.value=oe.strokeColor,$.value=oe.strokeWidth,W.value=oe.rotationAngle,O.value=oe.inpaintMethod,U.value=oe.position?.x||0,g.value=oe.position?.y||0}Se(()=>s.bubble,ye=>{m(ye)},{deep:!0,immediate:!0});function l(){o("update",{originalText:a.value})}function v(){o("update",{translatedText:u.value})}function D(){navigator.clipboard.writeText(a.value)}function S(){navigator.clipboard.writeText(u.value)}function w(){o("update",{fontSize:p.value})}function N(ye){p.value=ye,o("update",{fontSize:ye})}function Z(){p.value=Math.min(Xo,p.value+io),o("update",{fontSize:p.value})}function Y(){p.value=Math.max(Go,p.value-io),o("update",{fontSize:p.value})}function c(){o("update",{fontFamily:k.value})}function h(ye){f.value=ye,o("update",{textDirection:ye})}function le(){_.value?.click()}function I(){o("update",{textColor:P.value})}function G(){K.value?.click()}function re(){o("update",{fillColor:A.value})}function ke(){V.value?.click()}function De(){o("update",{strokeColor:B.value})}function Te(){M.value=!M.value,o("update",{strokeEnabled:M.value})}function he(){o("update",{strokeWidth:$.value})}function ee(){o("update",{inpaintMethod:O.value})}function b(){o("update",{rotationAngle:W.value})}function J(){W.value=Math.max(-180,W.value-5),o("update",{rotationAngle:W.value})}function me(){W.value=Math.min(180,W.value+5),o("update",{rotationAngle:W.value})}function H(){W.value=0,o("update",{rotationAngle:0})}function te(){U.value-=Vt,o("update",{position:{x:U.value,y:g.value}})}function ue(){U.value+=Vt,o("update",{position:{x:U.value,y:g.value}})}function ve(){g.value-=Vt,o("update",{position:{x:U.value,y:g.value}})}function fe(){g.value+=Vt,o("update",{position:{x:U.value,y:g.value}})}function Pe(){U.value=0,g.value=0,o("update",{position:{x:0,y:0}})}function Ee(){o("applyBubble",s.bubbleIndex)}function Be(){i.updateAllBubbles({fontSize:p.value,fontFamily:k.value,textDirection:f.value,textColor:P.value,fillColor:A.value,strokeEnabled:M.value,strokeColor:B.value,strokeWidth:$.value,inpaintMethod:O.value}),console.log("æ ·å¼å·²åº”ç”¨åˆ°æ‰€æœ‰æ°”æ³¡"),o("reRender")}function Re(){o("resetCurrent",s.bubbleIndex)}function _e(){o("ocrRecognize",s.bubbleIndex)}function we(){o("reTranslate",s.bubbleIndex)}function Le(){se.value=!se.value}function Ge(ye,oe){if(oe==="original"){const be=d.value;if(be){const Ve=be.selectionStart||a.value.length,Ae=be.selectionEnd||a.value.length,ft=a.value;a.value=ft.slice(0,Ve)+ye+ft.slice(Ae),dt(()=>{be.selectionStart=be.selectionEnd=Ve+ye.length,be.focus()}),o("update",{originalText:a.value})}}else{const be=x.value;if(be){const Ve=be.selectionStart||u.value.length,Ae=be.selectionEnd||u.value.length,ft=u.value;u.value=ft.slice(0,Ve)+ye+ft.slice(Ae),dt(()=>{be.selectionStart=be.selectionEnd=Ve+ye.length,be.focus()}),o("update",{translatedText:u.value})}}}function st(ye){if(ye==="original"){const oe=d.value;if(oe&&a.value.length>0){const be=oe.selectionStart||a.value.length,Ve=oe.selectionEnd||a.value.length,Ae=a.value;be===Ve&&be>0?(a.value=Ae.slice(0,be-1)+Ae.slice(Ve),dt(()=>{oe.selectionStart=oe.selectionEnd=be-1,oe.focus()})):be!==Ve&&(a.value=Ae.slice(0,be)+Ae.slice(Ve),dt(()=>{oe.selectionStart=oe.selectionEnd=be,oe.focus()})),o("update",{originalText:a.value})}}else{const oe=x.value;if(oe&&u.value.length>0){const be=oe.selectionStart||u.value.length,Ve=oe.selectionEnd||u.value.length,Ae=u.value;be===Ve&&be>0?(u.value=Ae.slice(0,be-1)+Ae.slice(Ve),dt(()=>{oe.selectionStart=oe.selectionEnd=be-1,oe.focus()})):be!==Ve&&(u.value=Ae.slice(0,be)+Ae.slice(Ve),dt(()=>{oe.selectionStart=oe.selectionEnd=be,oe.focus()})),o("update",{translatedText:u.value})}}}async function tt(){try{const ye=await Es();if(ye.fonts){const oe=[],be=[];for(const Ve of ye.fonts){const Ae={name:typeof Ve=="string"?Ve:Ve.display_name||Ve.file_name||"",path:typeof Ve=="string"?Ve:Ve.path};Ae.path.startsWith("fonts/")?oe.push(Ae):be.push(Ae)}oe.length>0&&(ie.value=oe),z.value=be}}catch(ye){console.error("åŠ è½½å­—ä½“åˆ—è¡¨å¤±è´¥:",ye)}}return ut(()=>{tt()}),(ye,oe)=>(E(),L("div",Qm,[e("div",ev,[e("div",{class:"text-column-header"},[oe[13]||(oe[13]=e("span",{class:"column-title"},"ğŸ‡¯ğŸ‡µ æ—¥è¯­åŸæ–‡ (OCRç»“æœ)",-1)),e("button",{class:"re-ocr-btn",onClick:_e,title:"é‡æ–°OCRæ­¤æ°”æ³¡"},"ğŸ”„")]),ae(e("textarea",{ref_key:"originalTextInput",ref:d,"onUpdate:modelValue":oe[0]||(oe[0]=be=>a.value=be),class:"text-editor original-editor",placeholder:"OCRè¯†åˆ«çš„æ—¥è¯­åŸæ–‡...",spellcheck:"false",onInput:l},null,544),[[$e,a.value]]),e("div",{class:"text-actions"},[e("button",{class:"copy-btn",onClick:D},"ğŸ“‹ å¤åˆ¶"),e("button",{class:"keyboard-toggle-btn",onClick:Le,title:"æ˜¾ç¤º/éšè—50éŸ³é”®ç›˜"}," âŒ¨ï¸ 50éŸ³ ")]),Ce(Zm,{visible:se.value,"default-target":X.value,onClose:oe[1]||(oe[1]=be=>se.value=!1),onInsert:Ge,onDelete:st},null,8,["visible","default-target"])]),e("div",tv,[e("div",{class:"text-column-header"},[oe[14]||(oe[14]=e("span",{class:"column-title"},"ğŸ‡¨ğŸ‡³ ä¸­æ–‡è¯‘æ–‡",-1)),e("button",{class:"re-translate-btn",onClick:we,title:"é‡æ–°ç¿»è¯‘æ­¤æ°”æ³¡"}," ğŸ”„ ")]),ae(e("textarea",{ref_key:"translatedTextInput",ref:x,"onUpdate:modelValue":oe[2]||(oe[2]=be=>u.value=be),class:"text-editor translated-editor",placeholder:"ç¿»è¯‘åçš„ä¸­æ–‡...",spellcheck:"false",onInput:v},null,544),[[$e,u.value]]),e("div",{class:"text-actions"},[e("button",{class:"copy-btn",onClick:S},"ğŸ“‹ å¤åˆ¶"),e("button",{class:"apply-text-btn",onClick:Ee},"âœ“ åº”ç”¨æ–‡æœ¬")])]),e("div",ov,[e("div",nv,[e("div",sv,[e("div",av,[oe[15]||(oe[15]=e("label",null,"å­—ä½“",-1)),Ce(Ke,{modelValue:k.value,"onUpdate:modelValue":oe[3]||(oe[3]=be=>k.value=be),groups:F.value,title:"å­—ä½“",onChange:c},null,8,["modelValue","groups"])]),e("div",lv,[oe[16]||(oe[16]=e("label",null,"å­—å·",-1)),e("div",iv,[ae(e("input",{type:"number","onUpdate:modelValue":oe[4]||(oe[4]=be=>p.value=be),class:"toolbar-fontsize-input",min:q(Go),max:q(Xo),step:q(io),title:"å­—å·",onChange:w},null,40,rv),[[$e,p.value,void 0,{number:!0}]]),e("div",{class:"toolbar-fontsize-btns"},[e("button",{class:"toolbar-fontsize-btn",onClick:Z,title:"å¢å¤§å­—å·"}," A+ "),e("button",{class:"toolbar-fontsize-btn",onClick:Y,title:"å‡å°å­—å·"}," A- ")])])])]),e("div",uv,[e("div",cv,[e("button",{class:"toolbar-btn","data-active":f.value==="vertical",onClick:oe[5]||(oe[5]=be=>h("vertical")),title:"ç«–å‘æ’ç‰ˆ"},[...oe[17]||(oe[17]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M8 2v12M8 2L5 5M8 2l3 3",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])],8,dv),e("button",{class:"toolbar-btn","data-active":f.value==="horizontal",onClick:oe[6]||(oe[6]=be=>h("horizontal")),title:"æ¨ªå‘æ’ç‰ˆ"},[...oe[18]||(oe[18]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M2 8h12M14 8l-3-3M14 8l-3 3",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])],8,gv)]),oe[24]||(oe[24]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",pv,[e("div",mv,[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:le},[oe[19]||(oe[19]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("text",{x:"3",y:"11","font-size":"10","font-weight":"bold",fill:"currentColor"},"A")],-1)),e("span",{class:"color-indicator",style:ot({background:P.value})},null,4)]),ae(e("input",{ref_key:"textColorInput",ref:_,type:"color","onUpdate:modelValue":oe[7]||(oe[7]=be=>P.value=be),class:"hidden-color-input",onInput:I,onChange:I},null,544),[[$e,P.value]])])]),oe[25]||(oe[25]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",vv,[Ce(Ke,{modelValue:O.value,"onUpdate:modelValue":oe[8]||(oe[8]=be=>O.value=be),options:y,onChange:ee},null,8,["modelValue"]),e("div",{class:Ie(["toolbar-color-picker toolbar-solid-color-options",{hidden:O.value!=="solid"}])},[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:G},[oe[20]||(oe[20]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("rect",{x:"2",y:"2",width:"12",height:"12",rx:"2",fill:"none",stroke:"currentColor","stroke-width":"1.2"}),e("rect",{x:"4",y:"4",width:"8",height:"8",rx:"1",fill:"currentColor",opacity:"0.3"})],-1)),e("span",{class:"color-indicator",style:ot({background:A.value})},null,4)]),ae(e("input",{ref_key:"fillColorInput",ref:K,type:"color","onUpdate:modelValue":oe[9]||(oe[9]=be=>A.value=be),class:"hidden-color-input",onChange:re},null,544),[[$e,A.value]])],2)]),oe[26]||(oe[26]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",fv,[e("button",{class:"toolbar-btn","data-active":M.value,onClick:Te,title:"æ–‡å­—æè¾¹"},[...oe[21]||(oe[21]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("text",{x:"3",y:"12","font-size":"11","font-weight":"bold",stroke:"currentColor","stroke-width":"2",fill:"none"}," A "),e("text",{x:"3",y:"12","font-size":"11","font-weight":"bold",fill:"currentColor"},"A")],-1)])],8,bv),e("div",{class:Ie(["toolbar-color-picker toolbar-stroke-options",{hidden:!M.value}]),title:"æè¾¹é¢œè‰²"},[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:ke},[oe[22]||(oe[22]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"2"})],-1)),e("span",{class:"color-indicator",style:ot({background:B.value})},null,4)]),ae(e("input",{ref_key:"strokeColorInput",ref:V,type:"color","onUpdate:modelValue":oe[10]||(oe[10]=be=>B.value=be),class:"hidden-color-input",onChange:De},null,544),[[$e,B.value]])],2),e("div",{class:Ie(["toolbar-stroke-width toolbar-stroke-options",{hidden:!M.value}]),title:"æè¾¹å®½åº¦"},[ae(e("input",{type:"number","onUpdate:modelValue":oe[11]||(oe[11]=be=>$.value=be),class:"toolbar-mini-input",min:"0",max:"10",onChange:he},null,544),[[$e,$.value,void 0,{number:!0}]]),oe[23]||(oe[23]=e("span",{class:"toolbar-unit"},"px",-1))],2)])]),e("div",hv,[e("div",yv,[e("button",{class:"toolbar-btn",onClick:J,title:"é€†æ—¶é’ˆæ—‹è½¬"},[...oe[27]||(oe[27]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M2 8a6 6 0 1 1 1.5 4",stroke:"currentColor","stroke-width":"1.5",fill:"none"}),e("path",{d:"M2 5v3.5h3.5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),ae(e("input",{type:"number","onUpdate:modelValue":oe[12]||(oe[12]=be=>W.value=be),class:"toolbar-mini-input toolbar-rotation-input",min:"-180",max:"180",step:"5",onChange:b},null,544),[[$e,W.value,void 0,{number:!0}]]),oe[29]||(oe[29]=e("span",{class:"toolbar-unit"},"Â°",-1)),e("button",{class:"toolbar-btn",onClick:me,title:"é¡ºæ—¶é’ˆæ—‹è½¬"},[...oe[28]||(oe[28]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M14 8a6 6 0 1 0-1.5 4",stroke:"currentColor","stroke-width":"1.5",fill:"none"}),e("path",{d:"M14 5v3.5h-3.5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn toolbar-small-btn",onClick:H,title:"é‡ç½®æ—‹è½¬"}," 0 ")]),oe[35]||(oe[35]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",xv,[e("button",{class:"toolbar-btn",onClick:te,title:"å·¦ç§»"},[...oe[30]||(oe[30]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M10 3L5 8l5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:ue,title:"å³ç§»"},[...oe[31]||(oe[31]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M6 3l5 5-5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:ve,title:"ä¸Šç§»"},[...oe[32]||(oe[32]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M3 10l5-5 5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:fe,title:"ä¸‹ç§»"},[...oe[33]||(oe[33]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M3 6l5 5 5-5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("span",_v,[e("span",null,ne(R.value),1),oe[34]||(oe[34]=pe(",",-1)),e("span",null,ne(T.value),1)]),e("button",{class:"toolbar-btn toolbar-small-btn",onClick:Pe,title:"é‡ç½®ä½ç½®"}," âŒ‚ ")])])]),e("details",Cv,[oe[36]||(oe[36]=e("summary",null,"å­—å·é¢„è®¾",-1)),e("div",Sv,[(E(!0),L(Oe,null,Ye(q(vs),be=>(E(),L("button",{key:be,class:Ie(["preset-btn",{active:p.value===be}]),onClick:Ve=>N(be)},ne(be),11,kv))),128))])]),e("div",{class:"edit-action-buttons"},[e("button",{class:"btn-apply",onClick:Ee},"åº”ç”¨"),e("button",{class:"btn-apply-all",onClick:Be},"åº”ç”¨å…¨éƒ¨"),e("button",{class:"btn-reset",onClick:Re},"é‡ç½®")])])]))}}),$v=He(wv,[["__scopeId","data-v-edcb1ca9"]]),Tv={class:"edit-toolbar-wrapper"},Iv={class:"edit-toolbar toolbar-row-1"},Pv={class:"image-navigator"},Rv=["disabled"],Dv=["disabled"],Mv={class:"bubble-navigator"},Ev=["disabled"],Bv={class:"bubble-indicator"},Av={id:"currentBubbleNum"},Lv={id:"totalBubbleNum"},Fv=["disabled"],Uv={class:"view-controls"},Ov={key:0,viewBox:"0 0 20 20",width:"16",height:"16"},zv={key:1,viewBox:"0 0 20 20",width:"16",height:"16"},Nv={id:"zoomLevel"},Vv={class:"edit-toolbar toolbar-row-2"},Wv={class:"annotation-tools"},Kv=["disabled"],qv=["disabled"],Hv={key:0,class:"brush-size-indicator"},jv={key:1,class:"brush-mode-hint"},Jv={class:"edit-progress-info"},Yv={class:"edit-progress-text"},Xv={class:"edit-progress-count"},Gv={class:"edit-progress-bar"},Zv={class:"quick-actions"},Qv=je({__name:"EditToolbar",props:{currentImageIndex:{},imageCount:{},canGoPrevious:{type:Boolean},canGoNext:{type:Boolean},showThumbnails:{type:Boolean},hasBubbles:{type:Boolean},selectedBubbleIndex:{},bubbleCount:{},layoutMode:{},syncEnabled:{type:Boolean},scale:{},isDrawingMode:{type:Boolean},hasSelection:{type:Boolean},brushMode:{},brushSize:{},mouseX:{},mouseY:{},isProcessing:{type:Boolean},progressText:{},progressCurrent:{},progressTotal:{}},emits:["go-previous-image","go-next-image","toggle-thumbnails","select-previous-bubble","select-next-bubble","toggle-layout","toggle-view-mode","toggle-sync","fit-to-screen","zoom-in","zoom-out","reset-zoom","exit-edit-mode","auto-detect-bubbles","detect-all-images","translate-with-bubbles","toggle-drawing-mode","delete-selected-bubbles","repair-selected-bubble","activate-repair-brush","activate-restore-brush","apply-and-next"],setup(n){const t=n,s=j(()=>t.progressTotal===0?0:Math.round(t.progressCurrent/t.progressTotal*100)),o=j(()=>t.progressTotal>0&&t.progressCurrent>=t.progressTotal),i=j(()=>{const r=t.brushMode==="repair"?{fill:"rgba(76, 175, 80, 0.4)",border:"#4CAF50"}:{fill:"rgba(33, 150, 243, 0.4)",border:"#2196F3"};return{position:"fixed",left:`${t.mouseX}px`,top:`${t.mouseY}px`,width:`${t.brushSize}px`,height:`${t.brushSize}px`,borderRadius:"50%",border:`2px solid ${r.border}`,backgroundColor:r.fill,pointerEvents:"none",zIndex:99999,transform:"translate(-50%, -50%)",display:t.brushMode?"block":"none"}});return(r,a)=>(E(),L("div",Tv,[e("div",Iv,[e("div",Pv,[e("button",{class:"nav-btn",disabled:!n.canGoPrevious,onClick:a[0]||(a[0]=u=>r.$emit("go-previous-image")),title:"ä¸Šä¸€å¼ å›¾ç‰‡ (PageUp)"}," â—€â—€ ",8,Rv),e("span",{class:"image-indicator",onClick:a[1]||(a[1]=u=>r.$emit("toggle-thumbnails")),title:"ç‚¹å‡»å±•å¼€ç¼©ç•¥å›¾"},[a[23]||(a[23]=pe(" å›¾ ",-1)),e("span",null,ne(n.currentImageIndex+1),1),a[24]||(a[24]=pe(" / ",-1)),e("span",null,ne(n.imageCount),1)]),e("button",{class:"nav-btn",disabled:!n.canGoNext,onClick:a[2]||(a[2]=u=>r.$emit("go-next-image")),title:"ä¸‹ä¸€å¼ å›¾ç‰‡ (PageDown)"}," â–¶â–¶ ",8,Dv),e("button",{class:Ie(["thumb-toggle-btn",{active:n.showThumbnails}]),onClick:a[3]||(a[3]=u=>r.$emit("toggle-thumbnails")),title:"æ˜¾ç¤º/éšè—ç¼©ç•¥å›¾"}," â˜· ",2)]),a[30]||(a[30]=e("div",{class:"toolbar-divider"},null,-1)),e("div",Mv,[e("button",{id:"prevBubbleBtn",class:"nav-btn",disabled:!n.hasBubbles||n.selectedBubbleIndex<=0,onClick:a[4]||(a[4]=u=>r.$emit("select-previous-bubble")),title:"ä¸Šä¸€ä¸ªæ°”æ³¡ (â†)"}," â—€ ",8,Ev),e("span",Bv,[a[25]||(a[25]=pe(" æ°”æ³¡ ",-1)),e("span",Av,ne(n.selectedBubbleIndex>=0?n.selectedBubbleIndex+1:0),1),a[26]||(a[26]=pe(" / ",-1)),e("span",Lv,ne(n.bubbleCount),1)]),e("button",{id:"nextBubbleBtn",class:"nav-btn",disabled:!n.hasBubbles||n.selectedBubbleIndex>=n.bubbleCount-1,onClick:a[5]||(a[5]=u=>r.$emit("select-next-bubble")),title:"ä¸‹ä¸€ä¸ªæ°”æ³¡ (â†’)"}," â–¶ ",8,Fv)]),a[31]||(a[31]=e("div",{class:"toolbar-divider"},null,-1)),e("div",Uv,[e("button",{class:"layout-toggle-btn",onClick:a[6]||(a[6]=u=>r.$emit("toggle-layout")),title:"åˆ‡æ¢å¸ƒå±€ï¼šå·¦å³/ä¸Šä¸‹"},[n.layoutMode==="horizontal"?(E(),L("svg",Ov,[...a[27]||(a[27]=[e("rect",{x:"1",y:"2",width:"8",height:"16",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1),e("rect",{x:"11",y:"2",width:"8",height:"16",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1)])])):(E(),L("svg",zv,[...a[28]||(a[28]=[e("rect",{x:"2",y:"1",width:"16",height:"8",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1),e("rect",{x:"2",y:"11",width:"16",height:"8",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1)])]))]),e("button",{class:"view-mode-btn",onClick:a[7]||(a[7]=u=>r.$emit("toggle-view-mode")),title:"åˆ‡æ¢è§†å›¾æ¨¡å¼"},[...a[29]||(a[29]=[e("span",{class:"dual-icon"},"â§‰",-1)])]),e("button",{class:Ie({active:n.syncEnabled}),onClick:a[8]||(a[8]=u=>r.$emit("toggle-sync")),title:"åŒæ­¥ç¼©æ”¾/æ‹–åŠ¨",style:{"font-size":"12px"}}," ğŸ”— ",2),e("button",{onClick:a[9]||(a[9]=u=>r.$emit("fit-to-screen")),title:"é€‚åº”å±å¹• (åŒå‡»)"},"â›¶"),e("button",{onClick:a[10]||(a[10]=u=>r.$emit("zoom-in")),title:"æ”¾å¤§ (+)"},"+"),e("span",Nv,ne(Math.round(n.scale*100))+"%",1),e("button",{onClick:a[11]||(a[11]=u=>r.$emit("zoom-out")),title:"ç¼©å° (-)"},"âˆ’"),e("button",{onClick:a[12]||(a[12]=u=>r.$emit("reset-zoom")),title:"åŸå§‹å¤§å°"},"1:1")]),a[32]||(a[32]=e("div",{class:"toolbar-spacer"},null,-1)),e("button",{class:"secondary-btn",onClick:a[13]||(a[13]=u=>r.$emit("exit-edit-mode"))},"é€€å‡ºç¼–è¾‘")]),e("div",Vv,[e("div",Wv,[e("button",{class:"annotation-btn detect-btn",onClick:a[14]||(a[14]=u=>r.$emit("auto-detect-bubbles")),title:"è‡ªåŠ¨æ£€æµ‹å½“å‰å›¾ç‰‡çš„æ–‡æœ¬æ¡†"},[...a[33]||(a[33]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"6",cy:"6",r:"4",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M9 9l4 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1),e("span",null,"æ£€æµ‹",-1)])]),e("button",{class:"annotation-btn detect-btn",onClick:a[15]||(a[15]=u=>r.$emit("detect-all-images")),title:"æ‰¹é‡æ£€æµ‹æ‰€æœ‰å›¾ç‰‡"},[...a[34]||(a[34]=[co('<svg viewBox="0 0 16 16" width="14" height="14" data-v-b7164359><circle cx="5" cy="5" r="2.5" fill="none" stroke="currentColor" stroke-width="1" data-v-b7164359></circle><path d="M7 7l2 2" stroke="currentColor" stroke-width="1" stroke-linecap="round" data-v-b7164359></path><circle cx="10" cy="10" r="2.5" fill="none" stroke="currentColor" stroke-width="1" data-v-b7164359></circle><path d="M12 12l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-b7164359></path></svg><span data-v-b7164359>æ‰¹é‡æ£€æµ‹</span>',2)])]),e("button",{class:"annotation-btn primary-action-btn",onClick:a[16]||(a[16]=u=>r.$emit("translate-with-bubbles")),title:"ä½¿ç”¨å½“å‰æ–‡æœ¬æ¡†ç¿»è¯‘æ­¤å›¾ç‰‡"},[...a[35]||(a[35]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M2 3h5M4.5 3v7M2 6h5",stroke:"currentColor","stroke-width":"1.2",fill:"none"}),e("path",{d:"M9 13l2-7 2 7M9.5 11h3",stroke:"currentColor","stroke-width":"1.2",fill:"none"})],-1),e("span",null,"ç¿»è¯‘",-1)])]),a[41]||(a[41]=e("div",{class:"toolbar-divider"},null,-1)),e("button",{class:Ie(["annotation-btn",{active:n.isDrawingMode}]),onClick:a[17]||(a[17]=u=>r.$emit("toggle-drawing-mode")),title:"æ·»åŠ æ°”æ³¡æ¡†ï¼ˆæˆ–ä¸­é”®æ‹–æ‹½ç»˜åˆ¶ï¼‰"},[...a[36]||(a[36]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("rect",{x:"3",y:"3",width:"10",height:"10",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M8 5v6M5 8h6",stroke:"currentColor","stroke-width":"1.5"})],-1),e("span",null,"æ·»åŠ ",-1)])],2),e("button",{class:"annotation-btn",disabled:!n.hasSelection,onClick:a[18]||(a[18]=u=>r.$emit("delete-selected-bubbles")),title:"åˆ é™¤é€‰ä¸­æ°”æ³¡æ¡† (Delete)"},[...a[37]||(a[37]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("rect",{x:"3",y:"3",width:"10",height:"10",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M5 8h6",stroke:"currentColor","stroke-width":"1.5"})],-1),e("span",null,"åˆ é™¤",-1)])],8,Kv),e("button",{class:"annotation-btn",disabled:!n.hasSelection,onClick:a[19]||(a[19]=u=>r.$emit("repair-selected-bubble")),title:"ä¿®å¤é€‰ä¸­æ°”æ³¡èƒŒæ™¯ (R)"},[...a[38]||(a[38]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M2 14l3-3m0 0l6-6 3 3-6 6m-3 0l-1 1 1-1z",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M11 5l-1-1 2-2 2 2-2 2-1-1z",fill:"currentColor"})],-1),e("span",null,"ä¿®å¤",-1)])],8,qv),a[42]||(a[42]=e("div",{class:"toolbar-divider"},null,-1)),e("button",{class:Ie(["annotation-btn brush-btn",{active:n.brushMode==="repair"}]),onClick:a[20]||(a[20]=u=>r.$emit("activate-repair-brush")),title:"ä¿®å¤ç¬”åˆ· (æŒ‰ä½R+å·¦é”®æ‹–æ‹½)"},[...a[39]||(a[39]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("circle",{cx:"8",cy:"8",r:"2",fill:"currentColor"})],-1),e("span",null,"ä¿®å¤ç¬”åˆ·",-1)])],2),e("button",{class:Ie(["annotation-btn brush-btn",{active:n.brushMode==="restore"}]),onClick:a[21]||(a[21]=u=>r.$emit("activate-restore-brush")),title:"è¿˜åŸç¬”åˆ· (æŒ‰ä½U+å·¦é”®æ‹–æ‹½)"},[...a[40]||(a[40]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M5 8h6M8 5v6",stroke:"currentColor","stroke-width":"1",transform:"rotate(45 8 8)"})],-1),e("span",null,"è¿˜åŸç¬”åˆ·",-1)])],2),n.brushMode?(E(),L("span",Hv," ç¬”åˆ·: "+ne(n.brushSize)+"px ",1)):de("",!0),a[43]||(a[43]=co('<div class="help-tooltip-container" data-v-b7164359><button class="help-tooltip-btn" title="å¿«æ·é”®æ“ä½œå¸®åŠ©" data-v-b7164359><svg viewBox="0 0 16 16" width="14" height="14" data-v-b7164359><circle cx="8" cy="8" r="6.5" fill="none" stroke="currentColor" stroke-width="1.2" data-v-b7164359></circle><text x="8" y="11" text-anchor="middle" font-size="9" font-weight="bold" fill="currentColor" data-v-b7164359>?</text></svg><span class="help-btn-text" data-v-b7164359>å¿«æ·é”®</span></button><div class="help-tooltip-popup" data-v-b7164359><div class="help-section" data-v-b7164359><div class="help-title" data-v-b7164359>ğŸ–±ï¸ é¼ æ ‡æ“ä½œ</div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®ç‚¹å‡»æ°”æ³¡</span><span class="help-desc" data-v-b7164359>é€‰æ‹©æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Shift+å·¦é”®ç‚¹å‡»</span><span class="help-desc" data-v-b7164359>å¤šé€‰æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®æ‹–æ‹½å››è§’/è¾¹</span><span class="help-desc" data-v-b7164359>è°ƒæ•´å¤§å°</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®æ‹–æ‹½æ¡†å†…éƒ¨</span><span class="help-desc" data-v-b7164359>ç§»åŠ¨æ°”æ³¡æ¡†</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>ä¸­é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>ç»˜åˆ¶æ–°æ°”æ³¡æ¡†</span></div></div><div class="help-section" data-v-b7164359><div class="help-title" data-v-b7164359>âŒ¨ï¸ å¿«æ·é”®</div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>A / D</span><span class="help-desc" data-v-b7164359>åˆ‡æ¢ä¸Š/ä¸‹ä¸€å¼ å›¾ç‰‡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Ctrl+Enter</span><span class="help-desc" data-v-b7164359>åº”ç”¨å¹¶è·³è½¬ä¸‹ä¸€å¼ </span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Delete / Backspace</span><span class="help-desc" data-v-b7164359>åˆ é™¤é€‰ä¸­æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>æŒ‰ä½R+å·¦é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>ä¿®å¤ç¬”åˆ·</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>æŒ‰ä½U+å·¦é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>è¿˜åŸç¬”åˆ·</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>ç¬”åˆ·æ¨¡å¼ä¸‹æ»šè½®</span><span class="help-desc" data-v-b7164359>è°ƒæ•´ç¬”åˆ·å¤§å°</span></div></div></div></div>',1))]),n.brushMode?(E(),L("div",{key:0,class:"brush-cursor",style:ot(i.value)},null,4)):de("",!0),n.brushMode?(E(),L("div",jv,ne(n.brushMode==="repair"?"ä¿®å¤ç¬”åˆ· (R)":"è¿˜åŸç¬”åˆ· (U)")+" - æ»šè½®è°ƒæ•´å¤§å° ",1)):de("",!0),n.isProcessing?(E(),L("div",{key:2,class:Ie(["edit-progress-container",{completed:o.value}])},[e("div",Jv,[e("span",Yv,ne(n.progressText),1),e("span",Xv,ne(n.progressCurrent)+"/"+ne(n.progressTotal),1)]),e("div",Gv,[e("div",{class:Ie(["edit-progress-fill",{animating:!o.value}]),style:ot({width:s.value+"%"})},null,6)])],2)):de("",!0),a[44]||(a[44]=e("div",{class:"toolbar-spacer"},null,-1)),e("div",Zv,[e("button",{class:"primary-btn",onClick:a[22]||(a[22]=u=>r.$emit("apply-and-next")),title:"åº”ç”¨æ›´æ”¹å¹¶è·³è½¬ä¸‹ä¸€å¼  (Ctrl+Enter)"}," åº”ç”¨å¹¶ä¸‹ä¸€å¼  ")])])]))}}),ef=He(Qv,[["__scopeId","data-v-b7164359"]]),tf={key:0,class:"edit-thumbnails-panel"},of={class:"thumbnails-scroll"},nf=["onClick"],sf=["src","alt"],af={class:"thumb-index"},lf=je({__name:"EditThumbnailPanel",props:{visible:{type:Boolean},images:{},currentImageIndex:{}},emits:["switch-to-image"],setup(n){return(t,s)=>n.visible?(E(),L("div",tf,[e("div",of,[(E(!0),L(Oe,null,Ye(n.images,(o,i)=>(E(),L("div",{key:o.id,class:Ie(["edit-thumbnail-item",{active:i===n.currentImageIndex}]),onClick:r=>t.$emit("switch-to-image",i)},[e("img",{src:o.translatedDataURL||o.originalDataURL,alt:`å›¾ç‰‡ ${i+1}`},null,8,sf),e("span",af,ne(i+1),1)],10,nf))),128))])])):de("",!0)}}),rf=He(lf,[["__scopeId","data-v-9d2a43d9"]]),uf=["data-brush-mode"],cf={class:"edit-main-layout"},df={class:"image-comparison-container"},gf={class:"panel-header"},pf=["src"],mf={class:"panel-header"},vf=["src"],ff=je({__name:"EditWorkspace",props:{isEditModeActive:{type:Boolean}},emits:["exit"],setup(n,{emit:t}){const s=n,o=t,i=Ze(),r=ct(),{translateWithCurrentBubbles:a}=ko(),{reRenderFullImage:u}=pm({onRenderStart:()=>console.log("å¼€å§‹é‡æ–°æ¸²æŸ“..."),onRenderSuccess:Q=>console.log("æ¸²æŸ“æˆåŠŸ:",Q.substring(0,50)+"..."),onRenderError:Q=>console.error("æ¸²æŸ“å¤±è´¥:",Q)}),{isDrawingMode:p,isDrawingBox:k,currentDrawingRect:f,isMiddleButtonDown:P,handleBubbleSelect:A,handleBubbleMultiSelect:M,handleClearMultiSelect:B,handleBubbleDragStart:$,handleBubbleDragging:W,handleBubbleDragEnd:O,handleBubbleResizeStart:U,handleBubbleResizing:g,handleBubbleResizeEnd:d,handleBubbleRotateStart:x,handleBubbleRotating:_,handleBubbleRotateEnd:K,toggleDrawingMode:V,handleDrawBubble:se,getDrawingRectStyle:X,handleBubbleUpdate:ie,deleteSelectedBubbles:z,repairSelectedBubble:R,handleOcrRecognize:T}=gm({onReRender:()=>u(),onDelayedPreview:()=>u()}),F=C(0),y=C(0),{brushMode:m,brushSize:l,mouseX:v,mouseY:D,isBrushKeyDown:S,toggleBrushMode:w,exitBrushMode:N,startBrushPainting:Z,continueBrushPainting:Y,finishBrushPainting:c,adjustBrushSize:h}=cm({onBrushComplete:()=>u(),getCurrentRepairSettings:()=>({inpaintMethod:ye.value,fillColor:oe.value})}),{images:le,currentImageIndex:I,currentImage:G,imageCount:re,canGoPrevious:ke,canGoNext:De}=Ct(i),{bubbles:Te,selectedIndex:he,selectedIndices:ee,selectedBubble:b,bubbleCount:J,hasBubbles:me,hasSelection:H}=Ct(r),te=j(()=>Pe.value?.querySelector("img")?.naturalWidth||2e3),ue=j(()=>Pe.value?.querySelector("img")?.naturalHeight||2e3),ve=C(null),fe=C(null),Pe=C(null),Ee=C(null),Be=C(null),Re=C(null),_e=C("dual"),we=C("horizontal"),Le=C(!1),Ge=C(!0),st=C(!1),tt=C(!1),ye=C("solid"),oe=C("#FFFFFF"),be=C(!1),Ve=C("å¤„ç†ä¸­..."),Ae=C(0),ft=C(0),at=dn(),Qe=dn(),jt=j(()=>Qe.scale.value),Un=j(()=>Qe.translateX.value),On=j(()=>Qe.translateY.value),zn=j(()=>at.scale.value),yt=C(null),Nn=j(()=>({transform:`translate(${at.translateX.value}px, ${at.translateY.value}px) scale(${at.scale.value})`})),Vn=j(()=>({transform:`translate(${Qe.translateX.value}px, ${Qe.translateY.value}px) scale(${Qe.scale.value})`}));function wo(){Qe.zoomIn(),Ge.value&&at.setTransform(Qe.getTransform())}function $o(){Qe.zoomOut(),Ge.value&&at.setTransform(Qe.getTransform())}function To(){Qe.resetZoom(),Ge.value&&at.setTransform(Qe.getTransform())}const Jt=C(!1),Wn=C(0),Yt=C(!1),Dt=C({x:0,y:0,size:0});function Xt(){m.value&&N(),Qt()}function Gt(){r.bubbles.length>0&&r.selectBubble(0)}function Io(){ke.value&&(Xt(),i.goToPrevious())}function Zt(){De.value&&(Xt(),i.goToNext())}function Kn(Q){Q!==I.value&&Q>=0&&Q<re.value&&(Xt(),i.setCurrentImageIndex(Q))}function Qt(){if(!G.value)return;const Q=Array.isArray(G.value.bubbleStates);Te.value.length>0?(i.updateCurrentBubbleStates([...Te.value]),i.setManuallyAnnotated(!0),console.log("å·²ä¿å­˜æ°”æ³¡çŠ¶æ€åˆ°å½“å‰å›¾ç‰‡ï¼Œæ ‡è®°ä¸ºæ‰‹åŠ¨æ ‡æ³¨")):Q&&(i.updateCurrentBubbleStates([]),i.setManuallyAnnotated(!0),console.log("å·²ä¿å­˜ç©ºæ°”æ³¡çŠ¶æ€åˆ°å½“å‰å›¾ç‰‡ï¼ˆç”¨æˆ·ä¸»åŠ¨æ¸…ç©ºï¼Œæ ‡è®°ä¸ºæ‰‹åŠ¨æ ‡æ³¨ï¼‰"))}function Mt(){G.value?.bubbleStates?(r.setBubbles([...G.value.bubbleStates],!0),console.log(`å·²åŠ è½½ ${G.value.bubbleStates.length} ä¸ªæ°”æ³¡çŠ¶æ€`)):r.clearBubblesLocal(),Gt()}function qn(){r.selectPrevious()}function Hn(){r.selectNext()}function jn(){Le.value=!Le.value}function Jn(){we.value=we.value==="horizontal"?"vertical":"horizontal";try{localStorage.setItem(Zo,we.value)}catch(Q){console.warn("ä¿å­˜å¸ƒå±€æ¨¡å¼å¤±è´¥:",Q)}setTimeout(()=>{Et()},300)}function Yn(){const Q=["dual","original","translated"],ce=Q.indexOf(_e.value),ge=Q[(ce+1)%Q.length];ge&&(_e.value=ge)}function Xn(){Ge.value=!Ge.value,console.log("åŒå›¾åŒæ­¥:",Ge.value?"å¼€å¯":"å…³é—­"),Ge.value&&at.setTransform(Qe.getTransform())}function Et(){const Q=Ee.value||fe.value,ce=Be.value||Pe.value;if(!Q||!ce)return;const ge=ce.querySelector("img");if(!ge||!ge.naturalWidth)return;const Je=Q.getBoundingClientRect(),Ne=Je.width/ge.naturalWidth,Me=Je.height/ge.naturalHeight,We=Math.min(Ne,Me)*.95,Fe=(Je.width-ge.naturalWidth*We)/2,bt=(Je.height-ge.naturalHeight*We)/2,xt={scale:We,translateX:Fe,translateY:bt};Qe.setTransform(xt),at.setTransform(xt)}function Po(Q,ce){if(m.value){const Fe=Q.deltaY>0?-5:5;h(Fe);return}const ge=Q.currentTarget.getBoundingClientRect(),Je=Q.clientX-ge.left,Ne=Q.clientY-ge.top,Me=Q.deltaY>0?.9:1.1,We=ce==="original"?at:Qe;We.zoomAt(Je,Ne,Me),Ge.value&&(ce==="original"?Qe:at).setTransform(We.getTransform())}function Ro(Q,ce){if(m.value){const ge=ce==="original"?fe.value:Ee.value;ge&&Z(Q,ge);return}if(Q.button===1){P.value=!0,Eo(Q,ce),Q.preventDefault();return}if(p.value&&Q.button===0){Eo(Q,ce),Q.preventDefault();return}if(Q.button===0){if(Q.target.closest(".bubble-highlight-box"))return;Q.shiftKey||B(),yt.value=ce,(ce==="original"?at:Qe).startDrag(Q.clientX,Q.clientY),document.addEventListener("mousemove",Do),document.addEventListener("mouseup",Mo),Q.preventDefault()}}function Do(Q){if(!yt.value)return;const ce=yt.value==="original"?at:Qe;ce.drag(Q.clientX,Q.clientY),Ge.value&&(yt.value==="original"?Qe:at).setTransform(ce.getTransform())}function Mo(){yt.value&&(yt.value==="original"?at:Qe).endDrag(),yt.value=null,document.removeEventListener("mousemove",Do),document.removeEventListener("mouseup",Mo)}let eo="translated";function Eo(Q,ce="translated"){eo=ce;const ge=ce==="original"?Pe.value:Be.value,Je=ce==="original"?at:Qe;if(!ge)return;const Ne=ge.getBoundingClientRect(),Me=(Q.clientX-Ne.left)/Je.scale.value,We=(Q.clientY-Ne.top)/Je.scale.value;F.value=Me,y.value=We,k.value=!0,f.value=[Me,We,Me,We],document.addEventListener("mousemove",to),document.addEventListener("mouseup",oo)}function to(Q){if(!k.value)return;const ce=eo==="original"?Pe.value:Be.value,ge=eo==="original"?at:Qe;if(!ce)return;const Je=ce.getBoundingClientRect(),Ne=(Q.clientX-Je.left)/ge.scale.value,Me=(Q.clientY-Je.top)/ge.scale.value;f.value=[Math.min(F.value,Ne),Math.min(y.value,Me),Math.max(F.value,Ne),Math.max(y.value,Me)]}function oo(Q){document.removeEventListener("mousemove",to),document.removeEventListener("mouseup",oo);const ce=P.value;if(!k.value||!f.value){k.value=!1,f.value=null,P.value=!1;return}const[ge,Je,Ne,Me]=f.value,We=Ne-ge,Fe=Me-Je;We>10&&Fe>10&&(r.addBubble(f.value),r.selectBubble(r.bubbleCount-1),console.log("å·²æ·»åŠ æ–°æ°”æ³¡:",f.value)),k.value=!1,f.value=null,P.value=!1,!ce&&p.value&&(p.value=!1)}function Bo(Q){console.log(`${Q} å›¾ç‰‡åŠ è½½å®Œæˆ`),jt.value===1&&Un.value===0&&On.value===0&&dt(()=>{Et()})}function Gn(){u()}function Zn(Q){Q.inpaintMethod!==void 0&&(ye.value=Q.inpaintMethod),Q.fillColor!==void 0&&(oe.value=Q.fillColor),he.value>=0&&ie(Q)}function Qn(Q){xe("æ–‡æœ¬å·²åº”ç”¨","success"),u()}function es(Q){const ce=r.initialStates[Q];if(!ce){console.warn(`æ— æ³•é‡ç½®æ°”æ³¡ #${Q+1}ï¼šæ‰¾ä¸åˆ°åˆå§‹çŠ¶æ€`),xe("æ— æ³•é‡ç½®ï¼šæ‰¾ä¸åˆ°åˆå§‹çŠ¶æ€","warning");return}const ge=JSON.parse(JSON.stringify(ce));r.updateBubble(Q,ge),console.log(`æ°”æ³¡ #${Q+1} å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€`),xe("æ°”æ³¡å·²é‡ç½®","success"),u()}async function ts(Q){const ce=Te.value[Q];if(!ce?.originalText){console.warn("æ— æ³•é‡æ–°ç¿»è¯‘ï¼šç¼ºå°‘æ°”æ³¡æˆ–åŸæ–‡");return}try{console.log(`å¼€å§‹é‡æ–°ç¿»è¯‘æ°”æ³¡ #${Q+1}`);const{translateSingleText:ge}=await lt(async()=>{const{translateSingleText:We}=await Promise.resolve().then(()=>Fs);return{translateSingleText:We}},void 0),{useSettingsStore:Je}=await lt(async()=>{const{useSettingsStore:We}=await import("./system.XPcAFQMv.js").then(Fe=>Fe.s);return{useSettingsStore:We}},__vite__mapDeps([0,1,2,3,4,5])),Ne=Je().settings,Me=await ge({original_text:ce.originalText,model_provider:Ne.translation.provider,api_key:Ne.translation.apiKey,model_name:Ne.translation.modelName,custom_base_url:Ne.translation.customBaseUrl,target_language:Ne.targetLanguage,prompt_content:void 0});Me.success&&Me.data?.translated_text?(r.updateBubble(Q,{translatedText:Me.data.translated_text}),console.log(`ç¿»è¯‘æˆåŠŸ: "${Me.data.translated_text}"`),u()):console.error("ç¿»è¯‘å¤±è´¥:",Me.error||"æœªçŸ¥é”™è¯¯")}catch(ge){console.error("ç¿»è¯‘å‡ºé”™:",ge)}}function Ao(Q,ce){for(Q.bubbleTexts||(Q.bubbleTexts=[]),Q.originalTexts||(Q.originalTexts=[]);Q.bubbleTexts.length<ce;)Q.bubbleTexts.push("");for(;Q.originalTexts.length<ce;)Q.originalTexts.push("")}function Lo(Q,ce,ge){const Je=Q.auto_directions||[];return Q.bubble_coords.map((Ne,Me)=>{const We=Ne[0]??0,Fe=Ne[1]??0,bt=Ne[2]??0,xt=Ne[3]??0;let gt;return Je[Me]?gt=Je[Me]==="v"?"vertical":"horizontal":gt=xt-Fe>bt-We?"vertical":"horizontal",{coords:Ne,originalText:ce.originalTexts?.[Me]||"",translatedText:ce.bubbleTexts?.[Me]||"",textboxText:"",fontSize:ge.fontSize,fontFamily:ge.fontFamily,textDirection:gt,autoTextDirection:gt,textColor:ge.textColor,fillColor:ge.fillColor,strokeEnabled:ge.strokeEnabled,strokeColor:ge.strokeColor,strokeWidth:ge.strokeWidth,rotationAngle:Q.bubble_angles?.[Me]||0,inpaintMethod:ge.inpaintMethod,position:{x:0,y:0},polygon:[]}})}async function os(){const Q=G.value;if(!Q?.originalDataURL){xe("æ²¡æœ‰æœ‰æ•ˆçš„å›¾ç‰‡ç”¨äºæ£€æµ‹","warning");return}try{xe("æ­£åœ¨è‡ªåŠ¨æ£€æµ‹æ–‡æœ¬æ¡†...","info");const ge=Q.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/)?.[1]||"";if(!ge){xe("æ— æ³•è§£æå›¾ç‰‡æ•°æ®","error");return}const Je=ze(),{textDetector:Ne,boxExpand:Me,textStyle:We}=Je.settings,Fe=await go(ge,Ne,{box_expand_ratio:Me.ratio,box_expand_top:Me.top,box_expand_bottom:Me.bottom,box_expand_left:Me.left,box_expand_right:Me.right});if(Fe.success&&Fe.bubble_coords){i.updateCurrentImage({bubbleCoords:Fe.bubble_coords,bubbleAngles:Fe.bubble_angles||[]}),Ao(Q,Fe.bubble_coords.length);const bt={bubble_coords:Fe.bubble_coords.map(gt=>[...gt]),bubble_angles:Fe.bubble_angles,auto_directions:Fe.auto_directions},xt=Lo(bt,Q,We);r.setBubbles(xt),Gt(),xe(`è‡ªåŠ¨æ£€æµ‹åˆ° ${Fe.bubble_coords.length} ä¸ªæ–‡æœ¬æ¡†`,"success")}else xe(Fe.error||"æ£€æµ‹å¤±è´¥","error")}catch(ce){console.error("è‡ªåŠ¨æ£€æµ‹å¤±è´¥:",ce),xe("è‡ªåŠ¨æ£€æµ‹å¤±è´¥","error")}}async function ns(){if(le.value.length<=1){xe("è‡³å°‘éœ€è¦ä¸¤å¼ å›¾ç‰‡æ‰èƒ½æ‰§è¡Œæ‰¹é‡æ£€æµ‹","warning");return}if(!confirm("æ­¤æ“ä½œå°†å¯¹æ‰€æœ‰å›¾ç‰‡è¿›è¡Œæ–‡æœ¬æ¡†æ£€æµ‹ï¼Œå¯èƒ½ä¼šè¦†ç›–å·²æœ‰çš„æ£€æµ‹ç»“æœã€‚ç¡®å®šç»§ç»­å—ï¼Ÿ"))return;const Q=ze(),{textDetector:ce,boxExpand:ge,textStyle:Je}=Q.settings,Ne=I.value,Me=le.value.length;be.value=!0,Ve.value="æ‰¹é‡æ£€æµ‹ä¸­",ft.value=Me,Ae.value=0;try{let We=0;for(let Fe=0;Fe<Me;Fe++){const bt=le.value[Fe];if(!bt?.originalDataURL)continue;Ae.value=Fe+1;const gt=bt.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/)?.[1]||"";if(!gt)continue;const pt=await go(gt,ce,{box_expand_ratio:ge.ratio,box_expand_top:ge.top,box_expand_bottom:ge.bottom,box_expand_left:ge.left,box_expand_right:ge.right});if(pt.success&&pt.bubble_coords){const St=le.value[Fe];if(St){St.bubbleCoords=pt.bubble_coords,St.bubbleAngles=pt.bubble_angles||[],Ao(St,pt.bubble_coords.length);const us={bubble_coords:pt.bubble_coords.map(cs=>[...cs]),bubble_angles:pt.bubble_angles,auto_directions:pt.auto_directions};St.bubbleStates=Lo(us,St,Je),We+=pt.bubble_coords.length,Fe===I.value&&Mt()}}}Ve.value="æ£€æµ‹å®Œæˆ",Ae.value=Me,Ne!==I.value&&i.setCurrentImageIndex(Ne),Mt(),xe(`æ‰¹é‡æ£€æµ‹å®Œæˆï¼å…±å¤„ç† ${Me} å¼ å›¾ç‰‡ï¼Œæ£€æµ‹åˆ° ${We} ä¸ªæ–‡æœ¬æ¡†`,"success"),setTimeout(()=>{be.value=!1},2e3)}catch(We){console.error("æ‰¹é‡æ£€æµ‹å¤±è´¥:",We),xe("æ‰¹é‡æ£€æµ‹å¤±è´¥","error"),be.value=!1}}async function ss(){if(!G.value?.originalDataURL){xe("æ²¡æœ‰æœ‰æ•ˆçš„å›¾ç‰‡ç”¨äºç¿»è¯‘","warning");return}if(Te.value.length===0){xe("æ²¡æœ‰æ–‡æœ¬æ¡†å¯ç”¨äºç¿»è¯‘ï¼Œè¯·å…ˆæ£€æµ‹æˆ–æ·»åŠ æ–‡æœ¬æ¡†","warning");return}xe("æ­£åœ¨ä½¿ç”¨å½“å‰æ–‡æœ¬æ¡†ç¿»è¯‘...","info");try{await a()&&(xe("ç¿»è¯‘æˆåŠŸï¼","success"),Gt())}catch(ce){console.error("ç¿»è¯‘å¤±è´¥:",ce),xe(`ç¿»è¯‘å¤±è´¥: ${ce instanceof Error?ce.message:"æœªçŸ¥é”™è¯¯"}`,"error")}}function as(){w("repair")}function ls(){w("restore")}function Fo(Q){Y(Q)}function Uo(){c()}function is(Q){Jt.value=!0,Wn.value=we.value==="horizontal"?Q.clientX:Q.clientY,document.body.style.cursor=we.value==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",no),document.addEventListener("mouseup",so),Q.preventDefault()}function no(Q){if(!Jt.value)return;const ce=fe.value?.parentElement?.parentElement;if(!ce)return;const ge=ce.getBoundingClientRect();if(we.value==="horizontal"){const Je=Q.clientX-ge.left,Ne=ge.width,Me=Math.max(20,Math.min(80,Je/Ne*100)),We=ce.querySelector(".original-panel"),Fe=ce.querySelector(".translated-panel");We&&Fe&&(We.style.flex=`0 0 ${Me}%`,Fe.style.flex=`0 0 ${100-Me}%`)}else{const Je=Q.clientY-ge.top,Ne=ge.height,Me=Math.max(20,Math.min(80,Je/Ne*100)),We=ce.querySelector(".original-panel"),Fe=ce.querySelector(".translated-panel");We&&Fe&&(We.style.flex=`0 0 ${Me}%`,Fe.style.flex=`0 0 ${100-Me}%`)}}function so(){Jt.value=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",no),document.removeEventListener("mouseup",so)}function rs(Q){Yt.value=!0;const ce=Re.value;ce&&(Dt.value={x:Q.clientX,y:Q.clientY,size:we.value==="horizontal"?ce.offsetWidth:ce.offsetHeight},document.body.style.cursor=we.value==="horizontal"?"ew-resize":"ns-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",ao),document.addEventListener("mouseup",lo),Q.preventDefault())}function ao(Q){if(!(!Yt.value||!Re.value))if(we.value==="horizontal"){const ce=Dt.value.x-Q.clientX;let ge=Dt.value.size+ce;ge=Math.max(300,Math.min(window.innerWidth*.6,ge)),Re.value.style.flex=`0 0 ${ge}px`,Re.value.style.minWidth=`${ge}px`}else{const ce=Dt.value.y-Q.clientY;let ge=Dt.value.size+ce;ge=Math.max(200,Math.min(window.innerHeight*.5,ge)),Re.value.style.flex=`0 0 ${ge}px`,Re.value.style.height=`${ge}px`}}function lo(){Yt.value=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",ao),document.removeEventListener("mouseup",lo)}function Oo(Q){const ce=Q.target,ge=Q.key.toLowerCase();if(ge==="r"||ge==="u"||ge==="a"||ge==="d"){if(ce.tagName==="TEXTAREA")return;(ce.tagName==="INPUT"||ce.tagName==="SELECT"||ce.tagName==="BUTTON")&&ce.blur()}else if(ce.tagName==="INPUT"||ce.tagName==="TEXTAREA"||ce.tagName==="SELECT")return;switch(Q.key){case"Escape":Vo();break;case"Delete":case"Backspace":!m.value&&H.value&&(z(),Q.preventDefault());break;case"a":case"A":m.value||(Io(),Q.preventDefault());break;case"d":case"D":m.value||(Zt(),Q.preventDefault());break;case"Enter":Q.ctrlKey&&!m.value&&(No(),Q.preventDefault());break;case"r":case"R":S.value||(w("repair"),Q.preventDefault());break;case"u":case"U":S.value||(w("restore"),Q.preventDefault());break;case"+":case"=":wo(),Q.preventDefault();break;case"-":$o(),Q.preventDefault();break;case"0":To(),Q.preventDefault();break}}function zo(Q){(Q.key==="r"||Q.key==="R"||Q.key==="u"||Q.key==="U")&&(N(),Q.preventDefault())}async function No(){Qt(),await u(),De.value?Zt():xe("å·²æ˜¯æœ€åä¸€å¼ å›¾ç‰‡","info")}function Vo(){Qt(),o("exit")}return ut(()=>{try{const Q=localStorage.getItem(Zo);(Q==="horizontal"||Q==="vertical")&&(we.value=Q)}catch(Q){console.warn("åŠ è½½å¸ƒå±€æ¨¡å¼å¤±è´¥:",Q)}document.addEventListener("keydown",Oo),document.addEventListener("keyup",zo),document.addEventListener("mousemove",Fo),document.addEventListener("mouseup",Uo),s.isEditModeActive&&(Mt(),dt(()=>{ve.value?.focus()}))}),Ft(()=>{document.removeEventListener("keydown",Oo),document.removeEventListener("keyup",zo),document.removeEventListener("mousemove",Fo),document.removeEventListener("mouseup",Uo),document.removeEventListener("mousemove",to),document.removeEventListener("mouseup",oo),document.removeEventListener("mousemove",no),document.removeEventListener("mouseup",so),document.removeEventListener("mousemove",ao),document.removeEventListener("mouseup",lo)}),Se(()=>s.isEditModeActive,Q=>{Q&&(Mt(),dt(()=>{ve.value?.focus()}))}),Se(I,()=>{s.isEditModeActive&&Mt()}),Se(b,Q=>{Q&&(ye.value=Q.inpaintMethod||"solid",oe.value=Q.fillColor||"#FFFFFF")},{immediate:!0}),(Q,ce)=>n.isEditModeActive?(E(),L("div",{key:0,class:Ie(["edit-workspace",[`layout-${we.value}`,{"drawing-mode":q(p)},{"brush-mode-active":!!q(m)}]]),"data-brush-mode":q(m)||void 0,tabindex:"0",ref_key:"workspaceRef",ref:ve},[Ce(ef,{"current-image-index":q(I),"image-count":q(re),"can-go-previous":q(ke),"can-go-next":q(De),"show-thumbnails":Le.value,"has-bubbles":q(me),"selected-bubble-index":q(he),"bubble-count":q(J),"layout-mode":we.value,"sync-enabled":Ge.value,scale:jt.value,"is-drawing-mode":q(p),"has-selection":q(H),"brush-mode":q(m),"brush-size":q(l),"mouse-x":q(v),"mouse-y":q(D),"is-processing":be.value,"progress-text":Ve.value,"progress-current":Ae.value,"progress-total":ft.value,onGoPreviousImage:Io,onGoNextImage:Zt,onToggleThumbnails:jn,onSelectPreviousBubble:qn,onSelectNextBubble:Hn,onToggleLayout:Jn,onToggleViewMode:Yn,onToggleSync:Xn,onFitToScreen:Et,onZoomIn:wo,onZoomOut:$o,onResetZoom:To,onExitEditMode:Vo,onAutoDetectBubbles:os,onDetectAllImages:ns,onTranslateWithBubbles:ss,onToggleDrawingMode:q(V),onDeleteSelectedBubbles:q(z),onRepairSelectedBubble:q(R),onActivateRepairBrush:as,onActivateRestoreBrush:ls,onApplyAndNext:No},null,8,["current-image-index","image-count","can-go-previous","can-go-next","show-thumbnails","has-bubbles","selected-bubble-index","bubble-count","layout-mode","sync-enabled","scale","is-drawing-mode","has-selection","brush-mode","brush-size","mouse-x","mouse-y","is-processing","progress-text","progress-current","progress-total","onToggleDrawingMode","onDeleteSelectedBubbles","onRepairSelectedBubble"]),Ce(rf,{visible:Le.value,images:q(le),"current-image-index":q(I),onSwitchToImage:Kn},null,8,["visible","images","current-image-index"]),e("div",cf,[e("div",df,[ae(e("div",{class:Ie(["image-panel original-panel",{collapsed:_e.value==="translated"||st.value}])},[e("div",gf,[ce[8]||(ce[8]=e("span",{class:"panel-title"},"ğŸ“– åŸå›¾ (æ—¥æ–‡)",-1)),e("button",{class:"panel-toggle",onClick:ce[0]||(ce[0]=ge=>st.value=!st.value),title:"æŠ˜å /å±•å¼€"},ne(st.value?"+":"âˆ’"),1)]),e("div",{ref_key:"originalViewportRef",ref:fe,class:"image-viewport",onWheel:ce[2]||(ce[2]=nt(ge=>Po(ge,"original"),["prevent"])),onMousedown:ce[3]||(ce[3]=ge=>Ro(ge,"original")),onDblclick:Et},[e("div",{ref_key:"originalWrapperRef",ref:Pe,class:"image-canvas-wrapper",style:ot(Nn.value)},[q(G)?.originalDataURL?(E(),L("img",{key:0,src:q(G).originalDataURL,alt:"åŸå›¾",onLoad:ce[1]||(ce[1]=ge=>Bo("original"))},null,40,pf)):de("",!0),q(G)?.originalDataURL?(E(),it(gn,{key:1,bubbles:q(Te),"selected-index":q(he),"selected-indices":q(ee),scale:zn.value,"is-drawing-mode":q(p),"is-brush-mode":!!q(m),"image-width":te.value,"image-height":ue.value,onSelect:q(A),onMultiSelect:q(M),onDragStart:q($),onDragging:q(W),onDragEnd:q(O),onResizeStart:q(U),onResizing:q(g),onResizeEnd:q(d),onRotateStart:q(x),onRotating:q(_),onRotateEnd:q(K),onDrawBubble:q(se)},null,8,["bubbles","selected-index","selected-indices","scale","is-drawing-mode","is-brush-mode","image-width","image-height","onSelect","onMultiSelect","onDragStart","onDragging","onDragEnd","onResizeStart","onResizing","onResizeEnd","onRotateStart","onRotating","onRotateEnd","onDrawBubble"])):de("",!0),q(f)?(E(),L("div",{key:2,class:"drawing-rect-edit",style:ot(q(X)())},null,4)):de("",!0)],4)],544)],2),[[Ue,_e.value!=="translated"]]),_e.value==="dual"?(E(),L("div",{key:0,class:Ie(["panel-divider",{"vertical-divider":we.value==="vertical"}]),onMousedown:is},null,34)):de("",!0),ae(e("div",{class:Ie(["image-panel translated-panel",{collapsed:_e.value==="original"||tt.value}])},[e("div",mf,[ce[9]||(ce[9]=e("span",{class:"panel-title"},"ğŸ“ ç¿»è¯‘å›¾ (ä¸­æ–‡)",-1)),e("button",{class:"panel-toggle",onClick:ce[4]||(ce[4]=ge=>tt.value=!tt.value),title:"æŠ˜å /å±•å¼€"},ne(tt.value?"+":"âˆ’"),1)]),e("div",{ref_key:"translatedViewportRef",ref:Ee,class:"image-viewport",onWheel:ce[6]||(ce[6]=nt(ge=>Po(ge,"translated"),["prevent"])),onMousedown:ce[7]||(ce[7]=ge=>Ro(ge,"translated")),onDblclick:Et},[e("div",{ref_key:"translatedWrapperRef",ref:Be,class:"image-canvas-wrapper",style:ot(Vn.value)},[q(G)?.translatedDataURL||q(G)?.originalDataURL?(E(),L("img",{key:0,src:q(G)?.translatedDataURL||q(G)?.originalDataURL,alt:"ç¿»è¯‘å›¾",onLoad:ce[5]||(ce[5]=ge=>Bo("translated"))},null,40,vf)):de("",!0),q(G)?.translatedDataURL||q(G)?.originalDataURL?(E(),it(gn,{key:1,bubbles:q(Te),"selected-index":q(he),"selected-indices":q(ee),scale:jt.value,"is-drawing-mode":q(p),"is-brush-mode":!!q(m),"image-width":te.value,"image-height":ue.value,onSelect:q(A),onMultiSelect:q(M),onDragStart:q($),onDragging:q(W),onDragEnd:q(O),onResizeStart:q(U),onResizing:q(g),onResizeEnd:q(d),onRotateStart:q(x),onRotating:q(_),onRotateEnd:q(K),onDrawBubble:q(se)},null,8,["bubbles","selected-index","selected-indices","scale","is-drawing-mode","is-brush-mode","image-width","image-height","onSelect","onMultiSelect","onDragStart","onDragging","onDragEnd","onResizeStart","onResizing","onResizeEnd","onRotateStart","onRotating","onRotateEnd","onDrawBubble"])):de("",!0),q(f)?(E(),L("div",{key:2,class:"drawing-rect-edit translated-drawing-rect",style:ot(q(X)())},null,4)):de("",!0)],4)],544)],2),[[Ue,_e.value!=="original"]])]),e("div",{ref_key:"editPanelRef",ref:Re,class:"edit-panel-container"},[e("div",{class:"panel-resize-handle vertical",onMousedown:rs}," â‹®â‹®â‹® ",32),Ce($v,{bubble:q(b),"bubble-index":q(he),onUpdate:Zn,onReRender:Gn,onOcrRecognize:q(T),onReTranslate:ts,onApplyBubble:Qn,onResetCurrent:es},null,8,["bubble","bubble-index","onOcrRecognize"])],512)])],10,uf)):de("",!0)}}),bf=He(ff,[["__scopeId","data-v-7cf83f19"]]),Rt="/api/web-import";async function hf(n){return(await fetch(`${Rt}/check-support?url=${encodeURIComponent(n)}`)).json()}async function yf(){return(await fetch(`${Rt}/gallery-dl-images`)).json()}async function xf(n,t,s,o,i,r="auto",a){const u=await fetch(`${Rt}/extract`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:n,config:t,engine:r})});if(!u.ok){const P=await u.json().catch(()=>({error:"è¯·æ±‚å¤±è´¥"}));i(P.error||`HTTP ${u.status}`);return}const p=u.body?.getReader();if(!p){i("æ— æ³•è¯»å–å“åº”æµ");return}const k=new TextDecoder;let f="";try{for(;;){const{done:P,value:A}=await p.read();if(P)break;f+=k.decode(A,{stream:!0});const M=f.split(`
`);f=M.pop()||"";let B="",$="";for(const W of M)if(W.startsWith("event:"))B=W.slice(6).trim();else if(W.startsWith("data:"))$=W.slice(5).trim();else if(W===""&&B&&$){try{const O=JSON.parse($);B==="log"?s(O):B==="page"?a&&a(O):B==="result"?o(O):B==="error"&&i(O.error||"æœªçŸ¥é”™è¯¯")}catch(O){console.error("è§£æ SSE æ•°æ®å¤±è´¥:",O)}B="",$=""}}}finally{p.releaseLock()}}async function _f(n,t,s,o="ai-agent"){const i=await fetch(`${Rt}/download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pages:n,sourceUrl:t,config:s,engine:o})});if(!i.ok){const r=await i.json().catch(()=>({error:"è¯·æ±‚å¤±è´¥"}));throw new Error(r.error||`HTTP ${i.status}`)}return i.json()}async function Cf(n){return(await fetch(`${Rt}/test-firecrawl`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:n})})).json()}async function Sf(n,t,s,o){return(await fetch(`${Rt}/test-agent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:n,apiKey:t,customBaseUrl:s,modelName:o})})).json()}const kf={class:"modal-container"},wf={class:"modal-body"},$f={class:"url-section"},Tf=["disabled"],If=["disabled"],Pf=["disabled"],Rf={key:0,class:"loading-spinner"},Df={key:1},Mf={key:0,class:"engine-hint"},Ef={key:0,class:"hint-checking"},Bf={key:1,class:"hint-supported"},Af={key:2,class:"hint-unsupported"},Lf={class:"settings-section"},Ff={class:"settings-toggle"},Uf={key:0,class:"settings-content"},Of={class:"settings-tabs"},zf={class:"settings-tab-content"},Nf={class:"settings-group"},Vf={class:"form-row"},Wf={class:"input-group"},Kf=["type","value"],qf=["disabled"],Hf={class:"settings-group"},jf={class:"form-row"},Jf=["value"],Yf=["value"],Xf={class:"form-row"},Gf={class:"input-group"},Zf=["type","value"],Qf={key:0,class:"form-row"},eb=["value"],tb={class:"form-row"},ob=["value"],nb={class:"form-row inline"},sb={class:"checkbox-label"},ab=["checked"],lb={class:"checkbox-label"},ib=["checked"],rb={class:"form-row"},ub=["disabled"],cb={class:"settings-group"},db={class:"form-row"},gb=["value"],pb={class:"form-row"},mb=["value"],vb={class:"settings-group"},fb={class:"form-grid"},bb={class:"form-row"},hb=["value"],yb={class:"form-row"},xb=["value"],_b={class:"form-row"},Cb=["value"],Sb={class:"form-row"},kb=["value"],wb={class:"form-row"},$b={class:"checkbox-label"},Tb=["checked"],Ib={class:"settings-group"},Pb={class:"form-row inline"},Rb={class:"checkbox-label"},Db=["checked"],Mb={class:"checkbox-label"},Eb=["checked"],Bb={class:"settings-tab-content"},Ab={class:"settings-group"},Lb={class:"form-row"},Fb={class:"checkbox-label"},Ub=["checked"],Ob={class:"form-row"},zb={class:"checkbox-label"},Nb=["checked"],Vb={class:"form-row"},Wb={class:"checkbox-label"},Kb=["checked"],qb={key:0,class:"form-grid"},Hb={class:"form-row"},jb=["value"],Jb={class:"form-row"},Yb=["value"],Xb={class:"form-row"},Gb=["value"],Zb={class:"form-row"},Qb={class:"checkbox-label"},eh=["checked"],th={key:1,class:"form-row"},oh=["value"],nh={class:"settings-tab-content"},sh={class:"settings-group"},ah={class:"form-row"},lh=["value"],ih={class:"form-row"},rh=["value"],uh={class:"form-row"},ch={class:"checkbox-label"},dh=["checked"],gh={key:1,class:"logs-section"},ph={class:"logs-toggle"},mh={key:0,class:"extracting-hint"},vh={key:0,class:"logs-content"},fh={class:"log-time"},bh={class:"log-message"},hh={key:2,class:"error-section"},yh={class:"error-message"},xh={key:3,class:"result-section"},_h={class:"result-header"},Ch={class:"result-title"},Sh={class:"result-meta"},kh={class:"result-count"},wh={key:0,class:"result-engine"},$h={class:"select-control"},Th={class:"select-all"},Ih=["checked"],Ph={class:"selected-count"},Rh={class:"image-grid"},Dh=["onClick"],Mh={class:"image-checkbox"},Eh=["checked","onChange"],Bh={class:"image-preview"},Ah=["src","alt"],Lh={class:"image-label"},Fh={key:4,class:"progress-section"},Uh={class:"progress-label"},Oh={class:"progress-bar"},zh={class:"modal-footer"},Nh=["disabled"],Vh=["disabled"],Wh={key:0,class:"loading-spinner"},Kh={key:1},qh=je({__name:"WebImportModal",setup(n){const t=xo(),s=Ze(),o=C(""),i=C(!0),r=C("auto"),a=C(!1),u=C(!1),p=C(!1),k=C(!1),f=C("basic"),P=C(!1),A=C(!1),M=C(!1),B=C(!1),$=j(()=>t.modalVisible),W=j(()=>t.status),O=j(()=>t.logs),U=j(()=>t.extractResult),g=j(()=>t.selectedPages),d=j(()=>t.selectedCount),x=j(()=>t.downloadProgress),_=j(()=>t.downloadProgressPercent),K=j(()=>t.error),V=j(()=>t.isProcessing),se=j(()=>t.settings.ui.showAgentLogs),X=j(()=>U.value?.engine||null),ie=j(()=>{switch(X.value){case"gallery-dl":return"Gallery-DL";case"ai-agent":return"AI Agent";default:return""}}),z=j(()=>U.value?.pages?d.value===U.value.pages.length:!1);function R(Y){return X.value==="gallery-dl",Y}let T=null;async function F(Y){if(T&&clearTimeout(T),!Y.trim()){a.value=!1,u.value=!1;return}T=setTimeout(async()=>{p.value=!0;try{const c=await hf(Y);a.value=c.available,u.value=c.supported}catch{a.value=!1,u.value=!1}finally{p.value=!1}},500)}function y(){V.value&&!confirm("æ­£åœ¨å¤„ç†ä¸­ï¼Œç¡®å®šè¦å…³é—­å—ï¼Ÿ")||(t.closeModal(),t.resetState(),o.value="")}async function m(){const Y=o.value.trim();if(!Y){alert("è¯·è¾“å…¥ç½‘å€");return}try{new URL(Y)}catch{alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€");return}t.resetState(),t.setUrl(Y),t.setStatus("extracting");try{await xf(Y,t.settings,c=>{t.addLog(c)},c=>{t.setExtractResult(c),c.success?t.setStatus("extracted"):t.setError(c.error||"æå–å¤±è´¥")},c=>{t.setError(c)},r.value,c=>{t.addPageIncremental(c)})}catch(c){t.setError(c instanceof Error?c.message:"æå–å¤±è´¥")}}function l(Y){t.togglePageSelection(Y)}function v(){t.toggleSelectAll()}async function D(){if(!U.value?.pages||d.value===0){alert("è¯·é€‰æ‹©è¦å¯¼å…¥çš„å›¾ç‰‡");return}const Y=U.value.pages.filter(h=>g.value.has(h.pageNumber));t.setStatus("downloading"),t.updateDownloadProgress(0,Y.length);const c=X.value||"ai-agent";try{if(c==="gallery-dl"){const le=await yf();if(le.success&&le.images.length>0){let I=0;const G=Math.min(le.images.length,Y.length);for(let re=0;re<G;re++){const ke=le.images[re];ke&&ke.filename&&ke.data&&(s.addImage(ke.filename,ke.data),I++,t.updateDownloadProgress(I,G))}t.setStatus("completed"),alert(`æˆåŠŸå¯¼å…¥ ${I} å¼ å›¾ç‰‡`),y();return}else throw new Error(le.error||"è·å–å›¾ç‰‡å¤±è´¥")}const h=await _f(Y,U.value.sourceUrl,t.settings,c);if(h.success&&h.images.length>0){t.setDownloadedImages(h.images),t.updateDownloadProgress(h.images.length,Y.length);for(const I of h.images)s.addImage(I.filename,I.dataUrl);t.setStatus("completed");const le=h.failedCount>0?`ï¼Œ${h.failedCount} å¼ å¤±è´¥`:"";alert(`æˆåŠŸå¯¼å…¥ ${h.images.length} å¼ å›¾ç‰‡${le}`),y()}else t.setError(h.error||"ä¸‹è½½å¤±è´¥")}catch(h){t.setError(h instanceof Error?h.message:"ä¸‹è½½å¤±è´¥")}}Se($,Y=>{Y&&setTimeout(()=>{document.querySelector(".url-input")?.focus()},100)}),Se(o,Y=>{F(Y)});const S=j(()=>t.settings.agent.provider==="custom_openai");async function w(){if(!t.settings.firecrawl.apiKey){alert("è¯·è¾“å…¥ Firecrawl API Key");return}P.value=!0;try{const Y=await Cf(t.settings.firecrawl.apiKey);Y.success?alert("âœ… Firecrawl è¿æ¥æˆåŠŸ"):alert(`âŒ è¿æ¥å¤±è´¥: ${Y.error}`)}catch(Y){alert(`âŒ è¿æ¥å¤±è´¥: ${Y instanceof Error?Y.message:"æœªçŸ¥é”™è¯¯"}`)}finally{P.value=!1}}async function N(){if(!t.settings.agent.apiKey){alert("è¯·è¾“å…¥ AI Agent API Key");return}A.value=!0;try{const Y=await Sf(t.settings.agent.provider,t.settings.agent.apiKey,t.settings.agent.customBaseUrl,t.settings.agent.modelName);Y.success?alert("âœ… AI Agent è¿æ¥æˆåŠŸ"):alert(`âŒ è¿æ¥å¤±è´¥: ${Y.error}`)}catch(Y){alert(`âŒ è¿æ¥å¤±è´¥: ${Y instanceof Error?Y.message:"æœªçŸ¥é”™è¯¯"}`)}finally{A.value=!1}}function Z(){confirm("ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯å—ï¼Ÿ")&&t.resetExtractionPrompt()}return(Y,c)=>(E(),it(bn,{to:"body"},[$.value?(E(),L("div",{key:0,class:"modal-overlay",onClick:nt(y,["self"])},[e("div",kf,[e("div",{class:"modal-header"},[c[37]||(c[37]=e("h2",{class:"modal-title"},[e("span",{class:"title-icon"},"ğŸŒ"),pe(" ä»ç½‘é¡µå¯¼å…¥æ¼«ç”» ")],-1)),e("button",{class:"close-btn",onClick:y,title:"å…³é—­"},"Ã—")]),e("div",wf,[e("div",$f,[ae(e("input",{"onUpdate:modelValue":c[0]||(c[0]=h=>o.value=h),type:"url",class:"url-input",placeholder:"è¾“å…¥æ¼«ç”»ç½‘é¡µ URLï¼Œå¦‚ https://example.com/chapter-1",disabled:V.value,onKeyup:fn(m,["enter"])},null,40,Tf),[[$e,o.value]]),ae(e("select",{"onUpdate:modelValue":c[1]||(c[1]=h=>r.value=h),class:"engine-select",disabled:V.value},[...c[38]||(c[38]=[e("option",{value:"auto"},"è‡ªåŠ¨é€‰æ‹©",-1),e("option",{value:"gallery-dl"},"Gallery-DL",-1),e("option",{value:"ai-agent"},"AI Agent",-1)])],8,If),[[hs,r.value]]),e("button",{class:"extract-btn",disabled:V.value||!o.value.trim(),onClick:m},[W.value==="extracting"?(E(),L("span",Rf)):(E(),L("span",Df,"ğŸ”")),pe(" "+ne(W.value==="extracting"?"æå–ä¸­...":"å¼€å§‹æå–"),1)],8,Pf)]),o.value.trim()&&!V.value?(E(),L("div",Mf,[p.value?(E(),L("span",Ef,"æ£€æŸ¥ä¸­...")):u.value?(E(),L("span",Bf,"âœ“ è¯¥ç½‘ç«™æ”¯æŒ Gallery-DL é«˜é€Ÿä¸‹è½½")):a.value?(E(),L("span",Af,"è¯¥ç½‘ç«™å°†ä½¿ç”¨ AI Agent æ¨¡å¼")):de("",!0)])):de("",!0),c[80]||(c[80]=e("div",{class:"notice"}," âš ï¸ è¯·ä»…çˆ¬å–æ‚¨æœ‰æƒè®¿é—®çš„å†…å®¹ï¼Œå¹¶éµå®ˆç›®æ ‡ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾ã€‚ ",-1)),e("div",Lf,[e("div",{class:"settings-header",onClick:c[2]||(c[2]=h=>k.value=!k.value)},[e("span",Ff,ne(k.value?"â–¼":"â–¶"),1),c[39]||(c[39]=e("span",{class:"settings-title"},"âš™ï¸ è®¾ç½®",-1)),c[40]||(c[40]=e("span",{class:"settings-hint"},"ç‚¹å‡»å±•å¼€é…ç½®",-1))]),k.value?(E(),L("div",Uf,[e("div",Of,[e("button",{class:Ie(["settings-tab",{active:f.value==="basic"}]),onClick:c[3]||(c[3]=h=>f.value="basic")}," åŸºæœ¬è®¾ç½® ",2),e("button",{class:Ie(["settings-tab",{active:f.value==="preprocess"}]),onClick:c[4]||(c[4]=h=>f.value="preprocess")}," å›¾ç‰‡é¢„å¤„ç† ",2),e("button",{class:Ie(["settings-tab",{active:f.value==="advanced"}]),onClick:c[5]||(c[5]=h=>f.value="advanced")}," é«˜çº§è®¾ç½® ",2)]),ae(e("div",zf,[e("div",Nf,[c[42]||(c[42]=e("h4",{class:"group-title"},"Firecrawl é…ç½®",-1)),e("div",Vf,[c[41]||(c[41]=e("label",{class:"form-label"},"API Key",-1)),e("div",Wf,[e("input",{type:M.value?"text":"password",class:"form-input",value:q(t).settings.firecrawl.apiKey,onInput:c[6]||(c[6]=h=>q(t).setFirecrawlApiKey(h.target.value)),placeholder:"fc-xxxxxxxxxxxxxxxx"},null,40,Kf),e("button",{class:"toggle-btn",onClick:c[7]||(c[7]=h=>M.value=!M.value)},ne(M.value?"ğŸ‘":"ğŸ‘â€ğŸ—¨"),1),e("button",{class:"test-btn",disabled:P.value||!q(t).settings.firecrawl.apiKey,onClick:w},ne(P.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,qf)])])]),e("div",Hf,[c[49]||(c[49]=e("h4",{class:"group-title"},"AI Agent é…ç½®",-1)),e("div",jf,[c[43]||(c[43]=e("label",{class:"form-label"},"æœåŠ¡å•†",-1)),e("select",{class:"form-select",value:q(t).settings.agent.provider,onChange:c[8]||(c[8]=h=>q(t).setAgentProvider(h.target.value))},[(E(!0),L(Oe,null,Ye(q(fs),h=>(E(),L("option",{key:h.value,value:h.value},ne(h.label),9,Yf))),128))],40,Jf)]),e("div",Xf,[c[44]||(c[44]=e("label",{class:"form-label"},"API Key",-1)),e("div",Gf,[e("input",{type:B.value?"text":"password",class:"form-input",value:q(t).settings.agent.apiKey,onInput:c[9]||(c[9]=h=>q(t).setAgentApiKey(h.target.value)),placeholder:"sk-xxxxxxxxxxxxxxxx"},null,40,Zf),e("button",{class:"toggle-btn",onClick:c[10]||(c[10]=h=>B.value=!B.value)},ne(B.value?"ğŸ‘":"ğŸ‘â€ğŸ—¨"),1)])]),S.value?(E(),L("div",Qf,[c[45]||(c[45]=e("label",{class:"form-label"},"è‡ªå®šä¹‰ API åœ°å€",-1)),e("input",{type:"url",class:"form-input",value:q(t).settings.agent.customBaseUrl,onInput:c[11]||(c[11]=h=>q(t).setAgentBaseUrl(h.target.value)),placeholder:"https://api.example.com/v1"},null,40,eb)])):de("",!0),e("div",tb,[c[46]||(c[46]=e("label",{class:"form-label"},"æ¨¡å‹åç§°",-1)),e("input",{type:"text",class:"form-input",value:q(t).settings.agent.modelName,onInput:c[12]||(c[12]=h=>q(t).setAgentModelName(h.target.value)),placeholder:"gpt-4o-mini"},null,40,ob)]),e("div",nb,[e("label",sb,[e("input",{type:"checkbox",checked:q(t).settings.agent.forceJsonOutput,onChange:c[13]||(c[13]=h=>q(t).setAgentForceJson(h.target.checked))},null,40,ab),c[47]||(c[47]=pe(" å¼ºåˆ¶ JSON æ ¼å¼ ",-1))]),e("label",lb,[e("input",{type:"checkbox",checked:q(t).settings.agent.useStream,onChange:c[14]||(c[14]=h=>q(t).setAgentUseStream(h.target.checked))},null,40,ib),c[48]||(c[48]=pe(" æµå¼è°ƒç”¨ ",-1))])]),e("div",rb,[e("button",{class:"test-btn full",disabled:A.value||!q(t).settings.agent.apiKey,onClick:N},ne(A.value?"æµ‹è¯•ä¸­...":"æµ‹è¯• Agent è¿æ¥"),9,ub)])]),e("div",cb,[e("h4",{class:"group-title"},[c[50]||(c[50]=pe(" æå–è®¾ç½® ",-1)),e("button",{class:"reset-btn",onClick:Z},"é‡ç½®ä¸ºé»˜è®¤")]),e("div",db,[c[51]||(c[51]=e("label",{class:"form-label"},"æå–æç¤ºè¯",-1)),e("textarea",{class:"form-textarea",value:q(t).settings.extraction.prompt,onInput:c[15]||(c[15]=h=>q(t).setExtractionPrompt(h.target.value)),rows:"6",placeholder:"è¾“å…¥æå–æç¤ºè¯..."},null,40,gb)]),e("div",pb,[c[52]||(c[52]=e("label",{class:"form-label"},"æœ€å¤§è¿­ä»£æ¬¡æ•°",-1)),e("input",{type:"number",class:"form-input small",value:q(t).settings.extraction.maxIterations,onInput:c[16]||(c[16]=h=>q(t).setExtractionMaxIterations(Number(h.target.value))),min:"1",max:"20"},null,40,mb)])]),e("div",vb,[c[58]||(c[58]=e("h4",{class:"group-title"},"ä¸‹è½½è®¾ç½®",-1)),e("div",fb,[e("div",bb,[c[53]||(c[53]=e("label",{class:"form-label"},"å¹¶å‘æ•°",-1)),e("input",{type:"number",class:"form-input small",value:q(t).settings.download.concurrency,onInput:c[17]||(c[17]=h=>q(t).setDownloadConcurrency(Number(h.target.value))),min:"1",max:"10"},null,40,hb)]),e("div",yb,[c[54]||(c[54]=e("label",{class:"form-label"},"è¶…æ—¶ (ç§’)",-1)),e("input",{type:"number",class:"form-input small",value:q(t).settings.download.timeout,onInput:c[18]||(c[18]=h=>q(t).setDownloadTimeout(Number(h.target.value))),min:"5",max:"120"},null,40,xb)]),e("div",_b,[c[55]||(c[55]=e("label",{class:"form-label"},"é‡è¯•æ¬¡æ•°",-1)),e("input",{type:"number",class:"form-input small",value:q(t).settings.download.retries,onInput:c[19]||(c[19]=h=>q(t).setDownloadRetries(Number(h.target.value))),min:"0",max:"5"},null,40,Cb)]),e("div",Sb,[c[56]||(c[56]=e("label",{class:"form-label"},"ä¸‹è½½é—´éš” (ms)",-1)),e("input",{type:"number",class:"form-input small",value:q(t).settings.download.delay,onInput:c[20]||(c[20]=h=>q(t).setDownloadDelay(Number(h.target.value))),min:"0",max:"2000",step:"100"},null,40,kb)])]),e("div",wb,[e("label",$b,[e("input",{type:"checkbox",checked:q(t).settings.download.useReferer,onChange:c[21]||(c[21]=h=>q(t).setDownloadUseReferer(h.target.checked))},null,40,Tb),c[57]||(c[57]=pe(" è‡ªåŠ¨æ·»åŠ  Referer ",-1))])])]),e("div",Ib,[c[61]||(c[61]=e("h4",{class:"group-title"},"ç•Œé¢è®¾ç½®",-1)),e("div",Pb,[e("label",Rb,[e("input",{type:"checkbox",checked:q(t).settings.ui.showAgentLogs,onChange:c[22]||(c[22]=h=>q(t).setShowAgentLogs(h.target.checked))},null,40,Db),c[59]||(c[59]=pe(" æ˜¾ç¤º AI å·¥ä½œæ—¥å¿— ",-1))]),e("label",Mb,[e("input",{type:"checkbox",checked:q(t).settings.ui.autoImport,onChange:c[23]||(c[23]=h=>q(t).setAutoImport(h.target.checked))},null,40,Eb),c[60]||(c[60]=pe(" æå–åè‡ªåŠ¨å¯¼å…¥ ",-1))])])])],512),[[Ue,f.value==="basic"]]),ae(e("div",Bb,[e("div",Ab,[e("div",Lb,[e("label",Fb,[e("input",{type:"checkbox",checked:q(t).settings.imagePreprocess.enabled,onChange:c[24]||(c[24]=h=>q(t).setImagePreprocessEnabled(h.target.checked))},null,40,Ub),c[62]||(c[62]=pe(" å¯ç”¨å›¾ç‰‡é¢„å¤„ç† ",-1))])]),q(t).settings.imagePreprocess.enabled?(E(),L(Oe,{key:0},[e("div",Ob,[e("label",zb,[e("input",{type:"checkbox",checked:q(t).settings.imagePreprocess.autoRotate,onChange:c[25]||(c[25]=h=>q(t).setImageAutoRotate(h.target.checked))},null,40,Nb),c[63]||(c[63]=pe(" æ ¹æ® EXIF è‡ªåŠ¨æ—‹è½¬ ",-1))])]),c[71]||(c[71]=e("h5",{class:"subsection-title"},"å‹ç¼©è®¾ç½®",-1)),e("div",Vb,[e("label",Wb,[e("input",{type:"checkbox",checked:q(t).settings.imagePreprocess.compression.enabled,onChange:c[26]||(c[26]=h=>q(t).setImageCompressionEnabled(h.target.checked))},null,40,Kb),c[64]||(c[64]=pe(" å¯ç”¨å‹ç¼© ",-1))])]),q(t).settings.imagePreprocess.compression.enabled?(E(),L("div",qb,[e("div",Hb,[c[65]||(c[65]=e("label",{class:"form-label"},"è´¨é‡ (0-100)",-1)),e("input",{type:"number",class:"form-input small",value:q(t).settings.imagePreprocess.compression.quality,onInput:c[27]||(c[27]=h=>q(t).setImageCompressionQuality(Number(h.target.value))),min:"1",max:"100"},null,40,jb)]),e("div",Jb,[c[66]||(c[66]=e("label",{class:"form-label"},"æœ€å¤§å®½åº¦ (0=ä¸é™)",-1)),e("input",{type:"number",class:"form-input small",value:q(t).settings.imagePreprocess.compression.maxWidth,onInput:c[28]||(c[28]=h=>q(t).setImageMaxWidth(Number(h.target.value))),min:"0"},null,40,Yb)]),e("div",Xb,[c[67]||(c[67]=e("label",{class:"form-label"},"æœ€å¤§é«˜åº¦ (0=ä¸é™)",-1)),e("input",{type:"number",class:"form-input small",value:q(t).settings.imagePreprocess.compression.maxHeight,onInput:c[29]||(c[29]=h=>q(t).setImageMaxHeight(Number(h.target.value))),min:"0"},null,40,Gb)])])):de("",!0),c[72]||(c[72]=e("h5",{class:"subsection-title"},"æ ¼å¼è½¬æ¢",-1)),e("div",Zb,[e("label",Qb,[e("input",{type:"checkbox",checked:q(t).settings.imagePreprocess.formatConvert.enabled,onChange:c[30]||(c[30]=h=>q(t).setImageFormatConvertEnabled(h.target.checked))},null,40,eh),c[68]||(c[68]=pe(" å¯ç”¨æ ¼å¼è½¬æ¢ ",-1))])]),q(t).settings.imagePreprocess.formatConvert.enabled?(E(),L("div",th,[c[70]||(c[70]=e("label",{class:"form-label"},"ç›®æ ‡æ ¼å¼",-1)),e("select",{class:"form-select",value:q(t).settings.imagePreprocess.formatConvert.targetFormat,onChange:c[31]||(c[31]=h=>q(t).setImageTargetFormat(h.target.value))},[...c[69]||(c[69]=[e("option",{value:"original"},"ä¿æŒåŸæ ¼å¼",-1),e("option",{value:"jpeg"},"JPEG",-1),e("option",{value:"png"},"PNG",-1),e("option",{value:"webp"},"WebP",-1)])],40,oh)])):de("",!0)],64)):de("",!0)])],512),[[Ue,f.value==="preprocess"]]),ae(e("div",nh,[e("div",sh,[c[76]||(c[76]=e("h4",{class:"group-title"},"è‡ªå®šä¹‰è¯·æ±‚å¤´",-1)),e("div",ah,[c[73]||(c[73]=e("label",{class:"form-label"},"Cookie",-1)),e("input",{type:"text",class:"form-input",value:q(t).settings.advanced.customCookie,onInput:c[32]||(c[32]=h=>q(t).setCustomCookie(h.target.value)),placeholder:"name=value; name2=value2"},null,40,lh)]),e("div",ih,[c[74]||(c[74]=e("label",{class:"form-label"},"Headers (JSON)",-1)),e("textarea",{class:"form-textarea",value:q(t).settings.advanced.customHeaders,onInput:c[33]||(c[33]=h=>q(t).setCustomHeaders(h.target.value)),rows:"3",placeholder:'{"X-Custom-Header": "value"}'},null,40,rh)]),e("div",uh,[e("label",ch,[e("input",{type:"checkbox",checked:q(t).settings.advanced.bypassProxy,onChange:c[34]||(c[34]=h=>q(t).setBypassProxy(h.target.checked))},null,40,dh),c[75]||(c[75]=pe(" ç»•è¿‡ç³»ç»Ÿä»£ç† (è¿æ¥æœ¬åœ°æœåŠ¡æ—¶ä½¿ç”¨) ",-1))])])])],512),[[Ue,f.value==="advanced"]])])):de("",!0)]),se.value&&O.value.length>0?(E(),L("div",gh,[e("div",{class:"logs-header",onClick:c[35]||(c[35]=h=>i.value=!i.value)},[e("span",ph,ne(i.value?"â–¼":"â–¶"),1),c[77]||(c[77]=e("span",null,"AI å·¥ä½œæ—¥å¿—",-1)),W.value==="extracting"?(E(),L("span",mh,"(æå–ä¸­...)")):de("",!0)]),i.value?(E(),L("div",vh,[(E(!0),L(Oe,null,Ye(O.value,(h,le)=>(E(),L("div",{key:le,class:Ie(["log-item",`log-${h.type}`])},[e("span",fh,"["+ne(h.timestamp)+"]",1),e("span",bh,ne(h.message),1)],2))),128))])):de("",!0)])):de("",!0),K.value?(E(),L("div",hh,[c[78]||(c[78]=e("span",{class:"error-icon"},"âŒ",-1)),e("span",yh,ne(K.value),1)])):de("",!0),U.value?.success?(E(),L("div",xh,[e("div",_h,[e("span",Ch," ğŸ“– ã€Š"+ne(U.value.comicTitle)+"ã€‹- "+ne(U.value.chapterTitle),1),e("span",Sh,[e("span",kh,"å…± "+ne(U.value.totalPages)+" å¼ ",1),ie.value?(E(),L("span",wh,"| å¼•æ“: "+ne(ie.value),1)):de("",!0)])]),e("div",$h,[e("label",Th,[e("input",{type:"checkbox",checked:z.value,onChange:v},null,40,Ih),c[79]||(c[79]=pe(" å…¨é€‰ ",-1))]),e("span",Ph,"å·²é€‰: "+ne(d.value)+" å¼ ",1)]),e("div",Rh,[(E(!0),L(Oe,null,Ye(U.value.pages,h=>(E(),L("div",{key:h.pageNumber,class:Ie(["image-item",{selected:g.value.has(h.pageNumber)}]),onClick:le=>l(h.pageNumber)},[e("div",Mh,[e("input",{type:"checkbox",checked:g.value.has(h.pageNumber),onClick:c[36]||(c[36]=nt(()=>{},["stop"])),onChange:le=>l(h.pageNumber)},null,40,Eh)]),e("div",Bh,[e("img",{src:R(h.imageUrl),alt:`ç¬¬${h.pageNumber}é¡µ`,loading:"lazy"},null,8,Ah)]),e("div",Lh,"ç¬¬ "+ne(h.pageNumber)+" é¡µ",1)],10,Dh))),128))])])):de("",!0),W.value==="downloading"?(E(),L("div",Fh,[e("div",Uh," ä¸‹è½½è¿›åº¦: "+ne(x.value.current)+"/"+ne(x.value.total),1),e("div",Oh,[e("div",{class:"progress-fill",style:ot({width:`${_.value}%`})},null,4)])])):de("",!0)]),e("div",zh,[e("button",{class:"cancel-btn",onClick:y,disabled:W.value==="downloading"}," å–æ¶ˆ ",8,Nh),e("button",{class:"import-btn",disabled:!U.value?.success||d.value===0||V.value,onClick:D},[W.value==="downloading"?(E(),L("span",Wh)):(E(),L("span",Kh,"ğŸ“¥")),pe(" "+ne(W.value==="downloading"?"ä¸‹è½½ä¸­...":"å¯¼å…¥"),1)],8,Vh)])])])):de("",!0)]))}}),Hh=He(qh,[["__scopeId","data-v-78fc5cb0"]]),jh={class:"disclaimer-container"},Jh={class:"disclaimer-content"},Yh={class:"confirmation-area"},Xh=["placeholder"],Gh={key:0,class:"input-error"},Zh={class:"disclaimer-footer"},Qh=["disabled"],Wt="æˆ‘å·²é˜…è¯»å¹¶åŒæ„",ey=je({__name:"WebImportDisclaimer",setup(n){const t=xo(),s=C(""),o=j(()=>t.disclaimerVisible),i=j(()=>s.value.trim()===Wt);function r(){i.value&&(t.acceptDisclaimer(),s.value="")}function a(){t.rejectDisclaimer(),s.value=""}return(u,p)=>(E(),it(bn,{to:"body"},[o.value?(E(),L("div",{key:0,class:"disclaimer-overlay",onClick:nt(a,["self"])},[e("div",jh,[p[3]||(p[3]=e("div",{class:"disclaimer-header"},[e("span",{class:"warning-icon"},"âš ï¸"),e("h2",{class:"disclaimer-title"},"é‡è¦å…è´£å£°æ˜")],-1)),e("div",Jh,[p[2]||(p[2]=e("div",{class:"disclaimer-text"},[e("h3",null,"ğŸ“œ ä½¿ç”¨æ¡æ¬¾ä¸æ³•å¾‹å£°æ˜"),e("div",{class:"section"},[e("h4",null,"1. åŠŸèƒ½è¯´æ˜"),e("p",null,[pe(' "ä»ç½‘é¡µå¯¼å…¥"åŠŸèƒ½å…è®¸æ‚¨ä»äº’è”ç½‘ç½‘é¡µä¸­æå–å›¾ç‰‡ã€‚æ­¤åŠŸèƒ½ä»…ä¾›'),e("strong",null,"æŠ€æœ¯ç ”ç©¶ä¸ä¸ªäººå­¦ä¹ "),pe("ä¹‹ç›®çš„æä¾›ã€‚ ")])]),e("div",{class:"section"},[e("h4",null,"2. ç”¨æˆ·è´£ä»»"),e("ul",null,[e("li",null,[pe("æ‚¨åº”å½“ç¡®ä¿æ‹¥æœ‰"),e("strong",null,"åˆæ³•æƒåˆ©"),pe("è®¿é—®å’Œä¸‹è½½ç›®æ ‡å†…å®¹")]),e("li",null,[pe("æ‚¨åº”å½“éµå®ˆç›®æ ‡ç½‘ç«™çš„"),e("strong",null,"æœåŠ¡æ¡æ¬¾"),pe("å’Œ"),e("strong",null,"ä½¿ç”¨åè®®")]),e("li",null,[pe("æ‚¨åº”å½“å°Šé‡å†…å®¹åˆ›ä½œè€…çš„"),e("strong",null,"ç‰ˆæƒ"),pe("å’Œ"),e("strong",null,"çŸ¥è¯†äº§æƒ")]),e("li",null,[pe("æ‚¨"),e("strong",null,"ä¸å¾—"),pe("å°†ä¸‹è½½çš„å†…å®¹ç”¨äºå•†ä¸šç›®çš„æˆ–éæ³•ä¼ æ’­")]),e("li",null,[pe("æ‚¨"),e("strong",null,"ä¸å¾—"),pe("ä½¿ç”¨æœ¬åŠŸèƒ½ç»•è¿‡ä»˜è´¹å†…å®¹çš„è®¿é—®é™åˆ¶")])])]),e("div",{class:"section"},[e("h4",null,"3. ä½¿ç”¨é™åˆ¶"),e("p",null,[pe("æœ¬åŠŸèƒ½"),e("strong",null,"ä¸¥ç¦"),pe("ç”¨äºä»¥ä¸‹ç›®çš„ï¼š")]),e("ul",null,[e("li",null,[pe("ä¸‹è½½ã€å­˜å‚¨æˆ–ä¼ æ’­"),e("strong",null,"ä¾µæƒå†…å®¹")]),e("li",null,[pe("ç»•è¿‡ç½‘ç«™çš„"),e("strong",null,"ä»˜è´¹å¢™"),pe("æˆ–"),e("strong",null,"è®¿é—®æ§åˆ¶")]),e("li",null,[pe("è¿›è¡Œ"),e("strong",null,"å•†ä¸šç”¨é€”"),pe("æˆ–å¤§è§„æ¨¡"),e("strong",null,"æ‰¹é‡çˆ¬å–")]),e("li",null,[pe("ä»»ä½•è¿å"),e("strong",null,"å½“åœ°æ³•å¾‹æ³•è§„"),pe("çš„æ´»åŠ¨")]),e("li",null,[pe("å¯¹ç›®æ ‡ç½‘ç«™é€ æˆ"),e("strong",null,"æœåŠ¡å™¨è´Ÿæ‹…"),pe("æˆ–"),e("strong",null,"æ¶æ„æ”»å‡»")])])]),e("div",{class:"section"},[e("h4",null,"4. å…è´£æ¡æ¬¾"),e("p",null,[pe(" æœ¬è½¯ä»¶ä½œè€…åŠè´¡çŒ®è€…"),e("strong",null,"ä¸å¯¹æ‚¨ä½¿ç”¨æœ¬åŠŸèƒ½æ‰€å¯¼è‡´çš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥åæœæ‰¿æ‹…è´£ä»»"),pe("ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š ")]),e("ul",null,[e("li",null,"å› ä¾µçŠ¯ç‰ˆæƒè€Œäº§ç”Ÿçš„æ³•å¾‹è´£ä»»"),e("li",null,"å› è¿åæœåŠ¡æ¡æ¬¾è€Œå¯¼è‡´çš„è´¦å·å°ç¦"),e("li",null,"å› æ•°æ®ä¸¢å¤±æˆ–æŸåè€Œé€ æˆçš„æŸå¤±"),e("li",null,"ä»»ä½•å…¶ä»–å› ä½¿ç”¨æœ¬åŠŸèƒ½è€Œäº§ç”Ÿçš„ä¸åˆ©åæœ")])]),e("div",{class:"section warning-section"},[e("h4",null,"5. ç¡®è®¤å£°æ˜"),e("p",null,[pe(" ä½¿ç”¨æœ¬åŠŸèƒ½å³è¡¨ç¤ºæ‚¨"),e("strong",null,"å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„"),pe("ä¸Šè¿°æ‰€æœ‰æ¡æ¬¾ï¼Œå¹¶æ‰¿è¯ºï¼š ")]),e("ul",null,[e("li",null,[pe("ä»…å°†æœ¬åŠŸèƒ½ç”¨äº"),e("strong",null,"åˆæ³•ã€åˆè§„"),pe("çš„ç›®çš„")]),e("li",null,[e("strong",null,"è‡ªè¡Œæ‰¿æ‹…"),pe("ä½¿ç”¨æœ¬åŠŸèƒ½æ‰€å¸¦æ¥çš„ä¸€åˆ‡é£é™©å’Œè´£ä»»")]),e("li",null,[pe("å¦‚å› ä½¿ç”¨æœ¬åŠŸèƒ½å¯¼è‡´ä»»ä½•äº‰è®®ï¼Œ"),e("strong",null,"ä¸æœ¬è½¯ä»¶ä½œè€…æ— å…³")])])])],-1)),e("div",Yh,[p[1]||(p[1]=e("p",{class:"confirmation-prompt"}," å¦‚æœæ‚¨å·²å®Œæ•´é˜…è¯»å¹¶åŒæ„ä»¥ä¸Šæ¡æ¬¾ï¼Œè¯·åœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­å‡†ç¡®è¾“å…¥ï¼š ",-1)),e("p",{class:"required-text"},[e("code",null,ne(Wt))]),ae(e("input",{"onUpdate:modelValue":p[0]||(p[0]=k=>s.value=k),type:"text",class:"confirmation-input",placeholder:`è¯·è¾“å…¥: ${Wt}`,onKeyup:fn(r,["enter"])},null,40,Xh),[[$e,s.value]]),s.value&&!i.value?(E(),L("p",Gh," è¾“å…¥ä¸æ­£ç¡®ï¼Œè¯·å®Œæ•´è¾“å…¥ã€Œ"+ne(Wt)+"ã€ ")):de("",!0)])]),e("div",Zh,[e("button",{class:"btn-cancel",onClick:a}," æˆ‘ä¸åŒæ„ï¼Œè¿”å› "),e("button",{class:"btn-confirm",disabled:!i.value,onClick:r}," âœ“ ç¡®è®¤å¹¶ç»§ç»­ ",8,Qh)])])])):de("",!0)]))}}),ty=He(ey,[["__scopeId","data-v-3750d090"]]),oy={class:"app-header"},ny={class:"header-content"},sy={class:"logo-container"},ay={class:"header-links"},ly={class:"container"},iy={id:"image-display-area"},ry={id:"upload-section",class:"card upload-card"},uy={class:"upload-actions"},cy={key:1,class:"bookshelf-mode-hint"},dy=je({__name:"TranslateView",setup(n){const t=vn(),s=Ze(),o=ze(),i=Tt(),r=ct(),{validateBeforeTranslation:a,initValidation:u}=$n(),p=ko(),k=Ei(),f=C(!1),P=C(void 0),A=C(!1),M=C(!1),B=C(null),$=C(null),W=j(()=>s.currentImage),O=j(()=>s.hasImages);j(()=>s.imageCount),j(()=>s.currentImageIndex+1),j(()=>O.value&&!s.isBatchTranslationInProgress),j(()=>s.canGoPrevious),j(()=>s.canGoNext);const U=j(()=>s.isBatchTranslationInProgress);j(()=>{if(!U.value)return 0;const H=s.completedImageCount,te=s.imageCount;return te>0?Math.round(H/te*100):0}),j(()=>`${s.completedImageCount}/${s.imageCount}`);const g=j(()=>s.failedImageCount>0),d=j(()=>!!t.query.book&&!!t.query.chapter),x=j(()=>t.query.book),_=j(()=>t.query.chapter),K=j(()=>k.currentBookTitle.value),V=j(()=>k.currentChapterTitle.value),se=j(()=>d.value&&V.value&&K.value?`${V.value} - ${K.value}`:"Saber-Translator");ut(async()=>{s.clearImages(),r.clearBubbles(),await k.initializeApp(),u(),window.addEventListener("keydown",ee)}),Ft(()=>{window.removeEventListener("keydown",ee)}),Se(()=>[t.query.book,t.query.chapter],async([H,te],[ue,ve])=>{H&&te?(s.clearImages(),r.clearBubbles(),await X()):ue&&ve&&!H&&!te&&(s.clearImages(),r.clearBubbles(),await k.initializeBookChapterContext(),console.log("[TranslateView] ä»ä¹¦æ¶æ¨¡å¼åˆ‡æ¢åˆ°å¿«é€Ÿç¿»è¯‘æ¨¡å¼ï¼Œå·²æ¸…ç©ºæ•°æ®"))}),Se(se,H=>{typeof document<"u"&&(document.title=H)},{immediate:!0});async function X(){if(!(!x.value||!_.value))try{await k.initializeBookChapterContext()}catch(H){console.error("åŠ è½½ç« èŠ‚ä¼šè¯å¤±è´¥:",H),xe("åŠ è½½ç« èŠ‚ä¼šè¯å¤±è´¥","error")}}function ie(H){console.log(`ä¸Šä¼ å®Œæˆï¼Œå…± ${H} å¼ å›¾ç‰‡`),s.hasImages&&(s.sortImagesByFileName(),k.switchImage(0))}async function z(H){const te=W.value;if(!te||!te.bubbleStates||te.bubbleStates.length===0){xe("è¯·å…ˆé€‰æ‹©ä¸€å¼ å·²ç¿»è¯‘çš„å›¾ç‰‡","warning");return}if(s.images.length<=1){xe("åªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œæ— éœ€åº”ç”¨åˆ°å…¨éƒ¨","info");return}if(!Object.values(H).some(ve=>ve)){xe("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè¦åº”ç”¨çš„è®¾ç½®é¡¹","warning");return}try{const ve=te.bubbleStates[0],fe={};H.fontSize&&(fe.fontSize=ve.fontSize),H.fontFamily&&(fe.fontFamily=ve.fontFamily),H.layoutDirection&&(fe.textDirection=ve.textDirection==="auto"?"vertical":ve.textDirection),H.textColor&&(fe.textColor=ve.textColor),H.fillColor&&(fe.fillColor=ve.fillColor),H.strokeEnabled&&(fe.strokeEnabled=ve.strokeEnabled),H.strokeColor&&(fe.strokeColor=ve.strokeColor),H.strokeWidth&&(fe.strokeWidth=ve.strokeWidth);const Pe=we=>{const Le={...we};return H.fontSize&&fe.fontSize!==void 0&&(Le.fontSize=fe.fontSize),H.fontFamily&&fe.fontFamily!==void 0&&(Le.fontFamily=fe.fontFamily),H.layoutDirection&&fe.textDirection!==void 0&&(Le.textDirection=fe.textDirection),H.textColor&&fe.textColor!==void 0&&(Le.textColor=fe.textColor),H.fillColor&&fe.fillColor!==void 0&&(Le.fillColor=fe.fillColor),H.strokeEnabled&&fe.strokeEnabled!==void 0&&(Le.strokeEnabled=fe.strokeEnabled),H.strokeColor&&fe.strokeColor!==void 0&&(Le.strokeColor=fe.strokeColor),H.strokeWidth&&fe.strokeWidth!==void 0&&(Le.strokeWidth=fe.strokeWidth),Le};let Ee=0;const Be=s.images;for(let we=0;we<Be.length;we++){const Le=Be[we];if(Le&&Le.bubbleStates&&Le.bubbleStates.length>0){const Ge=Le.bubbleStates.map(Pe);s.updateImageByIndex(we,{bubbleStates:Ge}),Ee++}}if(r.bubbles.length>0){const we=r.bubbles.map(Pe);r.setBubbles(we)}const Re=[];H.fontSize&&Re.push("å­—å·"),H.fontFamily&&Re.push("å­—ä½“"),H.layoutDirection&&Re.push("æ’ç‰ˆæ–¹å‘"),H.textColor&&Re.push("æ–‡å­—é¢œè‰²"),H.fillColor&&Re.push("å¡«å……é¢œè‰²"),H.strokeEnabled&&Re.push("æè¾¹å¼€å…³"),H.strokeColor&&Re.push("æè¾¹é¢œè‰²"),H.strokeWidth&&Re.push("æè¾¹å®½åº¦");const _e=[];for(let we=0;we<Be.length;we++){const Le=Be[we];Le&&Le.translatedDataURL&&Le.bubbleStates&&Le.bubbleStates.length>0&&_e.push(we)}if(_e.length>0){const{apiClient:we}=await lt(async()=>{const{apiClient:st}=await import("./client.Bht704G-.js");return{apiClient:st}},__vite__mapDeps([4,5])),Le=o.settings.textStyle.layoutDirection,Ge=Le==="auto";for(let st=0;st<_e.length;st++){const tt=_e[st];if(tt===void 0)continue;const ye=s.images[tt];if(!(!ye||!ye.bubbleStates))try{let oe="";if(ye.cleanImageData?oe=ye.cleanImageData.includes("base64,")?ye.cleanImageData.split("base64,")[1]||"":ye.cleanImageData:ye.originalDataURL&&(oe=ye.originalDataURL.includes("base64,")?ye.originalDataURL.split("base64,")[1]||"":ye.originalDataURL,console.log(`handleApplyToAll: å›¾ç‰‡ ${tt} ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰`)),!oe){console.log(`handleApplyToAll: å›¾ç‰‡ ${tt} æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡`);continue}const be=ye.bubbleStates.map(Ae=>({translatedText:Ae.translatedText||"",coords:Ae.coords,fontSize:Ae.fontSize||o.settings.textStyle.fontSize,fontFamily:Ae.fontFamily||o.settings.textStyle.fontFamily,textDirection:wt(Ae),textColor:Ae.textColor||o.settings.textStyle.textColor,rotationAngle:Ae.rotationAngle||0,position:Ae.position||{x:0,y:0},strokeEnabled:Ae.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:Ae.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:Ae.strokeWidth??o.settings.textStyle.strokeWidth})),Ve=await we.post("/api/re_render_image",{clean_image:oe,bubble_texts:be.map(Ae=>Ae.translatedText),bubble_coords:be.map(Ae=>Ae.coords),fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:Ge?"vertical":Le,textColor:o.settings.textStyle.textColor,bubble_states:be,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});Ve.rendered_image&&s.updateImageByIndex(tt,{translatedDataURL:`data:image/png;base64,${Ve.rendered_image}`,hasUnsavedChanges:!0})}catch(oe){console.error(`é‡æ¸²æŸ“å›¾ç‰‡ ${tt} å¤±è´¥:`,oe)}}}xe(`å·²å°† ${Re.join("ã€")} åº”ç”¨åˆ° ${Ee} å¼ å›¾ç‰‡`,"success"),console.log(`[TranslateView] åº”ç”¨è®¾ç½®åˆ°å…¨éƒ¨å®Œæˆï¼Œæ›´æ–°äº† ${Ee} å¼ å›¾ç‰‡ï¼Œé‡æ¸²æŸ“äº† ${_e.length} å¼ `)}catch(ve){console.error("åº”ç”¨è®¾ç½®åˆ°å…¨éƒ¨å¤±è´¥:",ve),xe("åº”ç”¨è®¾ç½®å¤±è´¥","error")}}async function R(){W.value&&a("normal")&&await p.translateCurrentImage()}async function T(){O.value&&a("normal")&&await p.translateAllImages()}async function F(){O.value&&a("hq")&&await p.executeHqTranslation()}async function y(){O.value&&a("proofread")&&await p.executeProofreading()}async function m(){W.value&&await p.removeTextOnly()}async function l(){O.value&&await p.removeAllTexts()}async function v(H,te){O.value&&a("normal")&&await p.translateImageRange({startPage:H,endPage:te})}async function D(H,te){O.value&&a("hq")&&await p.executeHqTranslation({startPage:H,endPage:te})}async function S(H,te){O.value&&a("proofread")&&await p.executeProofreading({startPage:H,endPage:te})}async function w(H,te){O.value&&await p.removeTextRange({startPage:H,endPage:te})}function N(){if(!W.value)return;const H=W.value.fileName||`å›¾ç‰‡ ${s.currentImageIndex+1}`;confirm(`ç¡®å®šè¦åˆ é™¤å½“å‰å›¾ç‰‡ (${H}) å—ï¼Ÿ`)&&(s.deleteCurrentImage(),xe("å›¾ç‰‡å·²åˆ é™¤","success"))}function Z(){O.value&&confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å›¾ç‰‡å—ï¼Ÿè¿™å°†ä¸¢å¤±æ‰€æœ‰æœªä¿å­˜çš„è¿›åº¦ã€‚")&&(s.clearImages(),xe("æ‰€æœ‰å›¾ç‰‡å·²æ¸…é™¤","success"))}async function Y(){try{const H=await hn(),te=await bo();if(H.success&&te.success)xe("ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ","success");else{const ue=[];H.success||ue.push("è°ƒè¯•æ–‡ä»¶æ¸…ç†å¤±è´¥"),te.success||ue.push("ä¸´æ—¶æ–‡ä»¶æ¸…ç†å¤±è´¥"),xe(ue.join("ï¼Œ"),"warning")}}catch{xe("æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥","error")}}function c(){k.goToPrevious()}function h(){k.goToNext()}function le(){M.value=!M.value}async function I(){if(!g.value){xe("æ²¡æœ‰å¤±è´¥çš„å›¾ç‰‡éœ€è¦é‡æ–°ç¿»è¯‘","info");return}a("normal")&&await p.retryFailedImages()}async function G(){if(!O.value){xe("æ²¡æœ‰å¯ä¿å­˜çš„å†…å®¹","warning");return}if(!(!x.value||!_.value))try{await i.saveChapterSession(x.value,_.value)?xe("ç« èŠ‚è¿›åº¦å·²ä¿å­˜","success"):xe("ä¿å­˜å¤±è´¥","error")}catch(H){console.error("ä¿å­˜ä¼šè¯å¤±è´¥:",H),xe("ä¿å­˜å¤±è´¥: "+(H instanceof Error?H.message:"æœªçŸ¥é”™è¯¯"),"error")}}function re(H){P.value=H,f.value=!0}function ke(){re("plugins")}function De(){xe("è®¾ç½®å·²ä¿å­˜","success")}function Te(){A.value=!0}function he(){xe("ğŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}function ee(H){const te=H.target;if(!(te instanceof HTMLInputElement||te instanceof HTMLTextAreaElement||te.getAttribute("contenteditable")==="true"||te.id==="bubbleTextEditor")&&!M.value&&H.altKey)switch(H.key){case"ArrowLeft":H.preventDefault(),c();break;case"ArrowRight":H.preventDefault(),h();break;case"ArrowUp":if(H.preventDefault(),!o.settings.textStyle.autoFontSize){const ve=o.settings.textStyle.fontSize;o.updateTextStyle({fontSize:ve+1})}break;case"ArrowDown":if(H.preventDefault(),!o.settings.textStyle.autoFontSize){const ve=o.settings.textStyle.fontSize;o.updateTextStyle({fontSize:Math.max(10,ve-1)})}break}}async function b(H){const te=W.value;if(!te||!te.translatedDataURL){console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${H} (ä»…å½±å“ä¸‹æ¬¡ç¿»è¯‘)`);return}const ue=te.bubbleStates;if(!ue||!Array.isArray(ue)||ue.length===0){console.log("å½“å‰å›¾ç‰‡æ²¡æœ‰ bubbleStatesï¼Œè·³è¿‡é‡æ¸²æŸ“");return}if(console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${H}ï¼Œå°†é‡æ–°æ¸²æŸ“...`),H){console.log("è‡ªåŠ¨å­—å·å·²å¼€å¯ï¼Œé‡æ–°è®¡ç®—å­—å·å¹¶æ¸²æŸ“...");try{const{apiClient:ve}=await lt(async()=>{const{apiClient:_e}=await import("./client.Bht704G-.js");return{apiClient:_e}},__vite__mapDeps([4,5]));let fe="";if(te.cleanImageData){const _e=te.cleanImageData;fe=_e.includes("base64,")?_e.split("base64,")[1]||"":_e}else te.originalDataURL&&(fe=te.originalDataURL.includes("base64,")?te.originalDataURL.split("base64,")[1]||"":te.originalDataURL);if(!fe){console.log("æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const Pe=ue.map(_e=>({translatedText:_e.translatedText||"",coords:_e.coords,fontSize:_e.fontSize||o.settings.textStyle.fontSize,fontFamily:_e.fontFamily||o.settings.textStyle.fontFamily,textDirection:wt(_e),textColor:_e.textColor||o.settings.textStyle.textColor,rotationAngle:_e.rotationAngle||0,position:_e.position||{x:0,y:0},strokeEnabled:_e.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:_e.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:_e.strokeWidth??o.settings.textStyle.strokeWidth})),Ee=Pe.map(_e=>_e.translatedText),Be=Pe.map(_e=>_e.coords),Re=await ve.post("/api/re_render_image",{clean_image:fe,bubble_texts:Ee,bubble_coords:Be,fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:o.settings.textStyle.layoutDirection==="auto"?"vertical":o.settings.textStyle.layoutDirection,textColor:o.settings.textStyle.textColor,bubble_states:Pe,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,autoFontSize:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});if(Re.rendered_image){if(Re.bubble_states&&Array.isArray(Re.bubble_states)){const _e=ue.map((we,Le)=>({...we,fontSize:Re.bubble_states[Le]?.fontSize??we.fontSize}));s.updateCurrentImage({translatedDataURL:`data:image/png;base64,${Re.rendered_image}`,bubbleStates:_e,hasUnsavedChanges:!0}),r.setBubbles(_e)}else s.updateCurrentImage({translatedDataURL:`data:image/png;base64,${Re.rendered_image}`,hasUnsavedChanges:!0});console.log("è‡ªåŠ¨å­—å·æ¸²æŸ“æˆåŠŸ")}else Re.error&&(console.error("è‡ªåŠ¨å­—å·æ¸²æŸ“å¤±è´¥:",Re.error),xe("é‡æ–°æ¸²æŸ“å¤±è´¥: "+Re.error,"error"))}catch(ve){console.error("è‡ªåŠ¨å­—å·æ¸²æŸ“å‡ºé”™:",ve)}}else{const ve=o.settings.textStyle.fontSize;console.log(`è‡ªåŠ¨å­—å·å·²å…³é—­ï¼Œä½¿ç”¨å›ºå®šå­—å· ${ve} æ¸²æŸ“...`);const fe=ue.map(Pe=>({...Pe,fontSize:ve}));s.updateCurrentImage({bubbleStates:fe}),r.setBubbles(fe),await J("fontSize",ve)}}async function J(H,te){const ue=W.value;if(!ue||!ue.translatedDataURL||!ue.bubbleStates||ue.bubbleStates.length===0||!["fontSize","fontFamily","layoutDirection","textColor","strokeEnabled","strokeColor","strokeWidth","fillColor"].includes(H))return;console.log(`å…¨å±€è®¾ç½®å˜æ›´ (${H}=${te})ï¼Œå‡†å¤‡é‡æ¸²æŸ“...`);const Pe={fontSize:"fontSize",fontFamily:"fontFamily",layoutDirection:"textDirection",textColor:"textColor",strokeEnabled:"strokeEnabled",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fillColor:"fillColor"}[H];if(Pe&&ue.bubbleStates)if(H==="layoutDirection")if(te==="auto"){console.log("æ’ç‰ˆæ–¹å‘è®¾ç½®ä¸º 'auto'ï¼Œä» autoTextDirection æ¢å¤æ¯ä¸ªæ°”æ³¡çš„æ’ç‰ˆæ–¹å‘");const Ee=ue.bubbleStates.map(Be=>({...Be,textDirection:Be.autoTextDirection==="vertical"||Be.autoTextDirection==="horizontal"?Be.autoTextDirection:"vertical"}));s.updateCurrentImage({bubbleStates:Ee}),r.setBubbles(Ee)}else{console.log(`æ’ç‰ˆæ–¹å‘è®¾ç½®ä¸º '${te}'ï¼Œåº”ç”¨åˆ°æ‰€æœ‰æ°”æ³¡`);const Ee=ue.bubbleStates.map(Be=>({...Be,textDirection:te}));s.updateCurrentImage({bubbleStates:Ee}),r.setBubbles(Ee)}else{const Ee=ue.bubbleStates.map(Be=>({...Be,[Pe]:te}));s.updateCurrentImage({bubbleStates:Ee}),r.setBubbles(Ee)}try{const Be=s.currentImage?.bubbleStates||ue.bubbleStates||[];if(Be.length===0||!Be[0]?.coords){console.log("æ²¡æœ‰æœ‰æ•ˆçš„æ°”æ³¡åæ ‡ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const Re=o.settings.textStyle.layoutDirection,_e=Be.map(ye=>({translatedText:ye.translatedText||"",coords:ye.coords,fontSize:ye.fontSize||o.settings.textStyle.fontSize,fontFamily:ye.fontFamily||o.settings.textStyle.fontFamily,textDirection:wt(ye),textColor:ye.textColor||o.settings.textStyle.textColor,rotationAngle:ye.rotationAngle||0,position:ye.position||{x:0,y:0},strokeEnabled:ye.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:ye.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:ye.strokeWidth??o.settings.textStyle.strokeWidth})),we=_e.map(ye=>ye.translatedText),Le=_e.map(ye=>ye.coords);let Ge="";if(ue.cleanImageData){const ye=ue.cleanImageData;Ge=ye.includes("base64,")?ye.split("base64,")[1]||"":ye}else ue.originalDataURL&&(Ge=ue.originalDataURL.includes("base64,")?ue.originalDataURL.split("base64,")[1]||"":ue.originalDataURL,console.log("handleTextStyleChanged: ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰"));if(!Ge){console.log("æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const{apiClient:st}=await lt(async()=>{const{apiClient:ye}=await import("./client.Bht704G-.js");return{apiClient:ye}},__vite__mapDeps([4,5])),tt=await st.post("/api/re_render_image",{clean_image:Ge,bubble_texts:we,bubble_coords:Le,fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:Re==="auto"?"vertical":Re,textColor:o.settings.textStyle.textColor,bubble_states:_e,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});tt.rendered_image?(s.updateCurrentImage({translatedDataURL:`data:image/png;base64,${tt.rendered_image}`,hasUnsavedChanges:!0}),console.log("è®¾ç½®å˜æ›´åé‡æ–°æ¸²æŸ“æˆåŠŸ")):tt.error&&console.error("é‡æ–°æ¸²æŸ“å¤±è´¥:",tt.error)}catch(Ee){console.error("è®¾ç½®å˜æ›´åé‡æ–°æ¸²æŸ“å¤±è´¥:",Ee)}}function me(H){k.switchImage(H)}return(H,te)=>{const ue=ys("router-link");return E(),L("div",{class:Ie(["translate-page",{"edit-mode-active":M.value}])},[e("header",oy,[e("div",ny,[e("div",sy,[Ce(ue,{to:"/",title:"è¿”å›ä¹¦æ¶"},{default:_t(()=>[...te[3]||(te[3]=[e("img",{src:"/pic/logo.png",alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",ay,[Ce(ue,{to:"/",class:"back-to-shelf",title:"è¿”å›ä¹¦æ¶"},{default:_t(()=>[...te[4]||(te[4]=[pe("ğŸ“š",-1)])]),_:1}),d.value?(E(),L("button",{key:0,class:"save-header-btn",title:"ä¿å­˜è¿›åº¦",onClick:G}," ğŸ’¾ ")):de("",!0),e("button",{id:"openSettingsBtn",class:"settings-header-btn",title:"æ‰“å¼€è®¾ç½®",onClick:te[0]||(te[0]=ve=>re())},[...te[5]||(te[5]=[e("span",{class:"icon"},"âš™ï¸",-1),e("span",null,"è®¾ç½®",-1)])]),te[8]||(te[8]=e("a",{href:"http://www.mashirosaber.top",target:"_blank",class:"tutorial-link"},"ä½¿ç”¨æ•™ç¨‹",-1)),e("a",{href:"javascript:void(0)",class:"donate-link",onClick:Te},[...te[6]||(te[6]=[e("span",null,"â¤ï¸ è¯·ä½œè€…å–å¥¶èŒ¶",-1)])]),te[9]||(te[9]=e("a",{href:"https://github.com/MashiroSaber03",target:"_blank",class:"github-link"},[e("img",{src:"/pic/github.jpg",alt:"GitHub",class:"github-icon"})],-1)),e("button",{class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:he},[...te[7]||(te[7]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("div",ly,[Ce(Rl,{onTranslateCurrent:R,onTranslateAll:T,onTranslateRange:v,onHqTranslate:F,onHqTranslateRange:D,onProofread:y,onProofreadRange:S,onRemoveText:m,onRemoveAllText:l,onRemoveTextRange:w,onRetryFailed:I,onDeleteCurrent:N,onClearAll:Z,onCleanTemp:Y,onOpenPlugins:ke,onOpenSettings:re,onPrevious:c,onNext:h,onApplyToAll:z,onTextStyleChanged:J,onAutoFontSizeChanged:b}),e("main",iy,[e("section",ry,[e("div",uy,[Ce(ma,{ref_key:"imageUploadRef",ref:B,onUploadComplete:ie},null,512)]),q(i).loadingProgress.total>0?(E(),it(_o,{key:0,visible:!0,percentage:q(i).loadingProgress.current/q(i).loadingProgress.total*100,label:q(i).loadingProgress.message},null,8,["percentage","label"])):de("",!0),Ce(ur,{progress:q(p).progress.value},null,8,["progress"]),U.value&&d.value?(E(),L("div",cy,[...te[10]||(te[10]=[e("span",{style:{color:"#888","font-size":"0.85em"}}," ï¼ˆä¹¦æ¶æ¨¡å¼ä¸‹é€€å‡ºå‰è¯·ç‚¹å‡»é¡¶éƒ¨ä¿å­˜æŒ‰é’®ï¼‰ ",-1)])])):de("",!0)]),Ce(Ql,{ref_key:"imageResultRef",ref:$,"is-edit-mode":M.value,onToggleEditMode:le,onRetryFailed:I},null,8,["is-edit-mode"])]),O.value&&!M.value?(E(),it(Ar,{key:0,onSelect:me})):de("",!0)]),W.value&&M.value?(E(),it(bf,{key:0,"is-edit-mode-active":M.value,onExit:le},null,8,["is-edit-mode-active"])):de("",!0),Ce(si,{onOpenSettings:re}),Ce(rm,{modelValue:f.value,"onUpdate:modelValue":te[1]||(te[1]=ve=>f.value=ve),"initial-tab":P.value,onSave:De},null,8,["modelValue","initial-tab"]),A.value?(E(),it(dr,{key:1,onClose:te[2]||(te[2]=ve=>A.value=!1)})):de("",!0),Ce(ty),Ce(Hh)],2)}}}),_y=He(dy,[["__scopeId","data-v-7d808654"]]);export{_y as default};
