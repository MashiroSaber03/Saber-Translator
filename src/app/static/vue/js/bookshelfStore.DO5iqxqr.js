import{d as pe,r as u,c as d}from"./vue-vendor.BU3zOQRA.js";import{getBooks as ve,getTags as ge,createBook as he,updateBook as ye,deleteBook as Be,createTag as ke,deleteTag as Te,updateTag as $e,createChapter as me,updateChapter as we,deleteChapter as xe,reorderChapters as Ce,addTagsToBook as Ae,removeTagsFromBook as Fe}from"./bookshelf.BX1u67VK.js";const Ee="/static/vue/pic/logo.png",Ke=pe("bookshelf",()=>{const s=u([]),i=u([]),f=u(""),a=u([]),h=u("updatedAt"),y=u("desc"),c=u(null),v=u(null),B=u(!1),k=u(null),$=d(()=>s.value),q=d(()=>s.value.length),z=d(()=>$.value.length),D=d(()=>c.value&&s.value.find(e=>e.id===c.value)||null),G=d(()=>v.value&&s.value.find(e=>e.id===v.value)||null),H=d(()=>f.value);function m(e){s.value=e,console.log(`书籍列表已设置，共 ${e.length} 本书`)}function w(e){s.value.unshift(e),console.log(`已添加书籍: ${e.title}`)}function x(e,o){const n=s.value.findIndex(r=>r.id===e);if(n>=0){const r=s.value[n];r&&(s.value[n]={...r,...o},console.log(`已更新书籍: ${e}`))}}function C(e){const o=s.value.findIndex(n=>n.id===e);o>=0&&(s.value.splice(o,1),c.value===e&&(c.value=null),console.log(`已删除书籍: ${e}`))}function J(e){return s.value.find(o=>o.id===e)||null}function A(e,o){const n=s.value.find(r=>r.id===e);n&&(n.chapters||(n.chapters=[]),n.chapters.push(o),console.log(`已添加章节到书籍 ${e}: ${o.title}`))}function F(e,o,n){const r=s.value.find(t=>t.id===e);if(r&&r.chapters){const t=r.chapters.find(l=>l.id===o);t&&(Object.assign(t,n),console.log(`已更新章节: ${o}`))}}function S(e,o){const n=s.value.find(r=>r.id===e);if(n&&n.chapters){const r=n.chapters.findIndex(t=>t.id===o);r>=0&&(n.chapters.splice(r,1),console.log(`已删除章节: ${o}`))}}function O(e,o){const n=s.value.find(r=>r.id===e);if(n&&n.chapters){const r=[];for(let t=0;t<o.length;t++){const l=n.chapters.find(de=>de.id===o[t]);l&&(l.order=t,r.push(l))}n.chapters=r,console.log(`已重新排序章节: ${e}`)}}function E(e){i.value=e,console.log(`标签列表已设置，共 ${e.length} 个标签`)}function K(e){i.value.push(e),console.log(`已添加标签: ${e.name}`)}function _(e){const o=i.value.findIndex(n=>n.id===e);if(o>=0){i.value.splice(o,1);const n=a.value.indexOf(e);n>=0&&a.value.splice(n,1),console.log(`已删除标签: ${e}`)}}function Q(e,o){const n=s.value.find(r=>r.id===e);n&&(n.tags||(n.tags=[]),n.tags.includes(o)||(n.tags.push(o),console.log(`已为书籍 ${e} 添加标签 ${o}`)))}function j(e,o){const n=s.value.find(r=>r.id===e);if(n&&n.tags){const r=n.tags.indexOf(o);r>=0&&(n.tags.splice(r,1),console.log(`已从书籍 ${e} 移除标签 ${o}`))}}function L(e){f.value=e}function M(){f.value=""}function N(e){const o=a.value.indexOf(e);o>=0?a.value.splice(o,1):a.value.push(e),p()}function P(e){a.value=e}function R(){a.value=[]}function U(e,o="desc"){h.value=e,y.value=o}function V(e){c.value=e}function W(){c.value=null}function X(e){c.value===e?c.value=null:c.value=e}function T(e){B.value=e}function g(e){k.value=e}function Y(e){v.value=e}function Z(e){f.value=e,p()}async function p(){T(!0),g(null);try{const e={};f.value.trim()&&(e.search=f.value.trim()),a.value.length>0&&(e.tags=a.value);const o=await ve(e);o.success&&o.books?m(o.books):g(o.error||"加载书籍失败")}catch(e){g(e instanceof Error?e.message:"加载书籍失败"),console.error("加载书籍失败:",e)}finally{T(!1)}}async function b(){try{const e=await ge();e.success&&e.tags&&E(e.tags)}catch(e){console.error("加载标签失败:",e)}}async function I(e,o,n,r){try{const t=await he(e,o,n,r);return t.success&&t.book?(w(t.book),t.book):null}catch(t){return console.error("创建书籍失败:",t),null}}async function ee(e,o){try{const n=await ye(e,o);return n.success&&n.book?(x(e,n.book),!0):!1}catch(n){return console.error("更新书籍失败:",n),!1}}async function ne(e){try{return(await Be(e)).success?(C(e),!0):!1}catch(o){return console.error("删除书籍失败:",o),!1}}async function oe(e,o){try{const n=await ke(e,o);return n.success&&n.tag?(K(n.tag),n.tag):null}catch(n){return console.error("创建标签失败:",n),null}}async function re(e){try{return(await Te(e)).success?(_(e),!0):!1}catch(o){return console.error("删除标签失败:",o),!1}}async function te(e,o,n){try{return(await $e(e,o,n)).success?(await b(),await p(),!0):!1}catch(r){return console.error("更新标签失败:",r),!1}}async function se(e,o){try{const n=await me(e,o);return n.success&&n.chapter?(A(e,n.chapter),n.chapter):null}catch(n){return console.error("创建章节失败:",n),null}}async function ae(e,o,n){try{return(await we(e,o,n)).success?(F(e,o,{title:n}),!0):!1}catch(r){return console.error("更新章节失败:",r),!1}}async function ce(e,o){try{return(await xe(e,o)).success?(S(e,o),!0):!1}catch(n){return console.error("删除章节失败:",n),!1}}async function ue(e,o){try{return(await Ce(e,o)).success?(O(e,o),!0):!1}catch(n){return console.error("重新排序章节失败:",n),!1}}async function le(e,o){try{if((await Ae(e,o)).success){for(const r of o){const t=i.value.find(l=>l.id===r);t&&Q(e,t.name)}return!0}return!1}catch(n){return console.error("添加标签失败:",n),!1}}async function ie(e,o){try{if((await Fe(e,o)).success){for(const r of o){const t=i.value.find(l=>l.id===r);t&&j(e,t.name)}return!0}return!1}catch(n){return console.error("移除标签失败:",n),!1}}function fe(){s.value=[],i.value=[],f.value="",a.value=[],h.value="updatedAt",y.value="desc",c.value=null,B.value=!1,k.value=null,console.log("书架状态已重置")}return{books:s,tags:i,searchKeyword:f,selectedTagIds:a,sortBy:h,sortOrder:y,expandedBookId:c,currentBookId:v,isLoading:B,error:k,filteredBooks:$,bookCount:q,filteredBookCount:z,expandedBook:D,currentBook:G,searchQuery:H,setBooks:m,addBook:w,updateBook:x,deleteBook:C,getBookById:J,addChapter:A,updateChapter:F,deleteChapter:S,reorderChapters:O,setTags:E,addTag:K,deleteTag:_,addTagToBook:Q,removeTagFromBook:j,setSearchKeyword:L,clearSearchKeyword:M,setSearchQuery:Z,toggleTagFilter:N,setTagFilter:P,clearTagFilter:R,setSort:U,expandBook:V,collapseBook:W,toggleBookExpand:X,setCurrentBook:Y,setLoading:T,setError:g,loadBooks:p,fetchBooks:p,loadTags:b,createBook:I,updateBookApi:ee,deleteBookApi:ne,createTag:oe,deleteTagApi:re,updateTagApi:te,createChapterApi:se,updateChapterApi:ae,deleteChapterApi:ce,reorderChaptersApi:ue,addTagsToBookApi:le,removeTagsFromBookApi:ie,reset:fe}});export{Ee as _,Ke as u};
