const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/bookshelf.BX1u67VK.js","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js"])))=>i.map(i=>d[i]);
import{u as X,_ as Ee}from"./bookshelfStore.DO5iqxqr.js";import{a as z,c as A,i,h as n,e,v as M,t as _,F,j as O,x as Z,r as k,y as K,z as P,A as J,n as re,l as ie,b as R,w as ee,B as Y,k as te,g as le,C as ke,D as Ie,o as be,f as fe,E as Me,u as me}from"./vue-vendor.BU3zOQRA.js";import"./client.Bht704G-.js";import{g as Se}from"./system.CmjDD-4C.js";import{_ as Q,s as u,a as ge}from"./index.BLREvt_p.js";import{B as he}from"./BaseModal.Btvo1LPx.js";import{getBookDetail as xe}from"./bookshelf.BX1u67VK.js";import"./utils-vendor.B9ygI19o.js";const Ae="/static/vue/pic/github.jpg",Le={class:"book-cover"},Ve=["src","alt"],qe={key:1,class:"book-cover-placeholder"},Ue={class:"book-info"},Re=["title"],Fe={class:"book-chapter-count"},Ne={key:0,class:"book-tags"},Ke=z({__name:"BookCard",props:{book:{}},emits:["click"],setup(T,{emit:L}){const c=L,y=X(),d=A(()=>y.tags);function m(){c("click")}function g(h){return d.value.find(a=>a.name===h)?.color||"#667eea"}function f(h){return!!h.cover&&h.cover.length>0}function v(h){const w=h.target;if(w.parentElement){w.style.display="none";const a=document.createElement("div");a.className="book-cover-placeholder",a.textContent="ðŸ“–",w.parentElement.appendChild(a)}}return(h,w)=>(n(),i("div",{class:"book-card",onClick:m},[e("div",Le,[f(T.book)?(n(),i("img",{key:0,src:T.book.cover,alt:T.book.title,onError:v},null,40,Ve)):(n(),i("div",qe,"ðŸ“–"))]),e("div",Ue,[e("h3",{class:"book-title",title:T.book.title},_(T.book.title),9,Re),e("p",Fe,_(T.book.chapter_count||T.book.chapters?.length||0)+" ç« èŠ‚",1),T.book.tags&&T.book.tags.length>0?(n(),i("div",Ne,[(n(!0),i(F,null,O(T.book.tags,a=>(n(),i("span",{key:a,class:"book-tag",style:Z({background:g(a)})},_(a),5))),128))])):M("",!0)])]))}}),Pe=Q(Ke,[["__scopeId","data-v-231a1896"]]),Oe={class:"filter-bar"},ze={class:"search-box"},Qe={key:0,class:"tag-filter"},je={class:"tag-chips"},Ge=["onClick"],We=z({__name:"BookSearch",props:{tags:{}},emits:["search","filterTag"],setup(T,{emit:L}){const c=L,y=X(),d=k(""),m=A(()=>d.value.length>0);function g(){c("search",d.value)}function f(){d.value="",c("search","")}let v;function h(){clearTimeout(v),v=setTimeout(()=>{g()},300)}function w(B){c("filterTag",B)}function a(B){return y.selectedTagIds.includes(B)}return(B,I)=>(n(),i("div",Oe,[e("div",ze,[K(e("input",{"onUpdate:modelValue":I[0]||(I[0]=D=>d.value=D),type:"text",placeholder:"æœç´¢ä¹¦ç±åç§°æˆ–æ ‡ç­¾...",autocomplete:"off",onInput:h,onKeypress:J(g,["enter"])},null,544),[[P,d.value]]),e("button",{class:"search-btn",onClick:g},"ðŸ”"),m.value?(n(),i("button",{key:0,class:"clear-search-btn",onClick:f}," âœ• ")):M("",!0)]),T.tags.length>0?(n(),i("div",Qe,[I[1]||(I[1]=e("span",{class:"filter-label"},"æ ‡ç­¾ç­›é€‰:",-1)),e("div",je,[(n(!0),i(F,null,O(T.tags,D=>(n(),i("span",{key:D.id,class:re(["tag-chip",{active:a(D.name)}]),style:Z(D.color?{"--tag-color":D.color,backgroundColor:a(D.name)?D.color:""}:{}),onClick:$=>w(D.name)},_(D.name),15,Ge))),128))])])):M("",!0)]))}}),He=Q(We,[["__scopeId","data-v-dd828b80"]]),Je={class:"form-group"},Xe={class:"form-group"},Ye={class:"cover-preview"},Ze=["src"],et={key:1,class:"cover-placeholder"},tt={class:"form-group"},ot={class:"tag-input-container"},st={class:"selected-tags"},at=["onClick"],nt={class:"tag-dropdown"},lt=["onKeypress"],rt={key:0,class:"tag-suggestions"},it=["onClick"],ut=z({__name:"BookModal",props:{bookId:{default:null}},emits:["close","saved"],setup(T,{emit:L}){const c=T,y=L,d=X(),m=k(""),g=k(null),f=k([]),v=k(""),h=k(!1),w=A(()=>!!c.bookId),a=A(()=>w.value?"ç¼–è¾‘ä¹¦ç±":"æ–°å»ºä¹¦ç±"),B=A(()=>d.tags),I=A(()=>{if(!v.value)return B.value;const p=v.value.toLowerCase();return B.value.filter(s=>s.name.toLowerCase().includes(p)&&!f.value.includes(s.id))});ie(()=>{if(c.bookId){const p=d.books.find(s=>s.id===c.bookId);p&&(m.value=p.title,g.value=p.cover||null,p.tags&&p.tags.length>0&&(f.value=p.tags.map(s=>B.value.find(E=>E.name===s)?.id).filter(s=>!!s)))}});function D(p){const t=p.target.files?.[0];if(!t)return;if(!t.type.startsWith("image/")){u("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶","error");return}const E=new FileReader;E.onload=V=>{g.value=V.target?.result},E.readAsDataURL(t)}function $(p){p.preventDefault();const s=p.dataTransfer?.files[0];if(!s||!s.type.startsWith("image/"))return;const t=new FileReader;t.onload=E=>{g.value=E.target?.result},t.readAsDataURL(s)}function b(p){f.value.includes(p)||f.value.push(p),v.value="",h.value=!1}async function C(){const p=v.value.trim();if(!p)return;const s=B.value.find(t=>t.name===p);if(s){b(s.id);return}try{const t=await d.createTag(p);t&&b(t.id)}catch{u("åˆ›å»ºæ ‡ç­¾å¤±è´¥","error")}}function q(p){f.value=f.value.filter(s=>s!==p)}function j(p){return B.value.find(t=>t.id===p)?.name||p}async function G(){if(!m.value.trim()){u("è¯·è¾“å…¥ä¹¦ç±åç§°","warning");return}const p=f.value.map(s=>j(s));try{w.value&&c.bookId?await d.updateBookApi(c.bookId,{title:m.value.trim(),cover:g.value||void 0})?(d.updateBook(c.bookId,{tags:p}),u("ä¹¦ç±æ›´æ–°æˆåŠŸ","success"),y("saved")):u("æ›´æ–°å¤±è´¥","error"):await d.createBook(m.value.trim(),void 0,g.value||void 0,p.length>0?p:void 0)?(u("ä¹¦ç±åˆ›å»ºæˆåŠŸ","success"),y("saved")):u("åˆ›å»ºå¤±è´¥","error")}catch{u(w.value?"æ›´æ–°å¤±è´¥":"åˆ›å»ºå¤±è´¥","error")}}return(p,s)=>(n(),R(he,{title:a.value,onClose:s[6]||(s[6]=t=>y("close"))},{footer:ee(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:s[5]||(s[5]=t=>y("close"))},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-primary",onClick:G},"ä¿å­˜")]),default:ee(()=>[e("form",{onSubmit:te(G,["prevent"])},[e("div",Je,[s[7]||(s[7]=e("label",{for:"bookTitle"},[Y("ä¹¦ç±åç§° "),e("span",{class:"required"},"*")],-1)),K(e("input",{id:"bookTitle","onUpdate:modelValue":s[0]||(s[0]=t=>m.value=t),type:"text",placeholder:"è¯·è¾“å…¥ä¹¦ç±åç§°",required:""},null,512),[[P,m.value]])]),e("div",Xe,[s[9]||(s[9]=e("label",null,"å°é¢å›¾ç‰‡",-1)),e("div",{class:"cover-upload-area",onDragover:s[1]||(s[1]=te(()=>{},["prevent"])),onDrop:$,onClick:s[2]||(s[2]=t=>p.$refs.coverInput.click())},[e("input",{ref:"coverInput",type:"file",accept:"image/*",hidden:"",onChange:D},null,544),e("div",Ye,[g.value?(n(),i("img",{key:0,src:g.value,alt:"å°é¢é¢„è§ˆ"},null,8,Ze)):(n(),i("div",et,[...s[8]||(s[8]=[e("span",{class:"upload-icon"},"ðŸ“·",-1),e("span",null,"ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å°é¢",-1)])]))])],32),s[10]||(s[10]=e("p",{class:"form-hint"},"æ”¯æŒ JPGã€PNGã€WebP æ ¼å¼ï¼Œå»ºè®®æ¯”ä¾‹ 3:4",-1))]),e("div",tt,[s[11]||(s[11]=e("label",null,"æ ‡ç­¾",-1)),e("div",ot,[e("div",st,[(n(!0),i(F,null,O(f.value,t=>(n(),i("span",{key:t,class:"selected-tag"},[Y(_(j(t))+" ",1),e("button",{type:"button",class:"remove-tag",onClick:E=>q(t)},"Ã—",8,at)]))),128))]),e("div",nt,[K(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>v.value=t),type:"text",placeholder:"è¾“å…¥æ ‡ç­¾åç§°...",autocomplete:"off",onFocus:s[4]||(s[4]=t=>h.value=!0),onKeypress:J(te(C,["prevent"]),["enter"])},null,40,lt),[[P,v.value]]),h.value&&I.value.length>0?(n(),i("div",rt,[(n(!0),i(F,null,O(I.value,t=>(n(),i("button",{key:t.id,type:"button",class:"tag-suggestion",onClick:E=>b(t.id)},_(t.name),9,it))),128))])):M("",!0)])]),s[12]||(s[12]=e("p",{class:"form-hint"},"è¾“å…¥åŽæŒ‰å›žè½¦æ·»åŠ æ–°æ ‡ç­¾ï¼Œæˆ–ä»Žå·²æœ‰æ ‡ç­¾ä¸­é€‰æ‹©",-1))])],32)]),_:1},8,["title"]))}}),ct=Q(ut,[["__scopeId","data-v-087929e9"]]),dt={class:"modal active"},vt={class:"modal-content modal-large"},pt={class:"modal-header"},ft={class:"modal-body"},mt={key:0,class:"book-detail-container"},gt={class:"book-info-section"},kt={class:"book-cover-large"},bt=["src"],ht={key:1,class:"book-cover-placeholder"},yt={class:"book-meta"},_t={class:"meta-item"},Ct={key:0,class:"detail-tags"},Tt=["onClick"],$t={key:1,class:"no-tags-hint"},wt={class:"meta-item"},Bt={class:"meta-item"},Dt={class:"meta-item"},Et={class:"chapters-section"},It={key:0,class:"chapters-list"},Mt=["onDragstart","onDragover","onDrop"],St={class:"chapter-info"},xt={class:"chapter-order"},At={class:"chapter-title"},Lt={class:"chapter-meta"},Vt={class:"chapter-actions"},qt=["onClick"],Ut=["disabled","onClick"],Rt=["onClick"],Ft=["onClick"],Nt={key:1,class:"empty-state-small"},Kt={key:0,class:"modal active"},Pt={class:"modal-content modal-small"},Ot={class:"modal-header"},zt={class:"modal-body"},Qt={class:"form-group"},jt={class:"modal-footer"},Gt={key:0,class:"modal active"},Wt={class:"modal-content modal-small"},Ht={class:"modal-body"},Jt={class:"quick-tag-input-wrapper"},Xt={class:"quick-tag-list"},Yt=["onClick"],Zt={class:"quick-tag-name"},eo={key:1,class:"no-tags-hint"},to={key:0,class:"modal active"},oo={class:"modal-content modal-small"},so={class:"modal-header"},ao={class:"modal-body"},no={class:"modal-footer"},lo=z({__name:"BookDetailModal",emits:["close","edit"],setup(T,{emit:L}){const c=L,y=ke(),d=X(),m=k(!1),g=k(null),f=k(""),v=k(!1),h=k("book"),w=k(null),a=A(()=>d.currentBook),B=A(()=>a.value?.chapters||[]),I=A(()=>d.tags);function D(l){return l?new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function $(l){return I.value.find(r=>r.name===l)?.color||"#667eea"}function b(){a.value&&(c("edit",a.value.id),c("close"))}function C(){h.value="book",v.value=!0}async function q(){try{h.value==="book"&&a.value?await d.deleteBookApi(a.value.id)?(u("ä¹¦ç±å·²åˆ é™¤","success"),c("close")):u("åˆ é™¤å¤±è´¥","error"):h.value==="chapter"&&w.value&&a.value&&(await d.deleteChapterApi(a.value.id,w.value)?u("ç« èŠ‚å·²åˆ é™¤","success"):u("åˆ é™¤å¤±è´¥","error"))}catch{u("åˆ é™¤å¤±è´¥","error")}v.value=!1,w.value=null}function j(){g.value=null,f.value="",m.value=!0}function G(l){const o=B.value.find(r=>r.id===l);o&&(g.value=l,f.value=o.title,m.value=!0)}async function p(){if(!f.value.trim()||!a.value){u("è¯·è¾“å…¥ç« èŠ‚åç§°","warning");return}try{g.value?await d.updateChapterApi(a.value.id,g.value,f.value.trim())?(u("ç« èŠ‚æ›´æ–°æˆåŠŸ","success"),m.value=!1):u("æ›´æ–°å¤±è´¥","error"):await d.createChapterApi(a.value.id,f.value.trim())?(u("ç« èŠ‚åˆ›å»ºæˆåŠŸ","success"),m.value=!1):u("åˆ›å»ºå¤±è´¥","error")}catch{u("ä¿å­˜å¤±è´¥","error")}}function s(l){h.value="chapter",w.value=l,v.value=!0}function t(l){a.value&&y.push({path:"/translate",query:{book:a.value.id,chapter:l}})}function E(l){a.value&&y.push({path:"/reader",query:{book:a.value.id,chapter:l}})}function V(){a.value&&y.push({path:"/insight",query:{book:a.value.id}})}async function ue(l){if(!a.value)return!1;try{return await d.reorderChaptersApi(a.value.id,l)?(u("ç« èŠ‚æŽ’åºå·²æ›´æ–°","success"),!0):(u("æŽ’åºä¿å­˜å¤±è´¥","error"),await ce(),!1)}catch{return u("æŽ’åºä¿å­˜å¤±è´¥","error"),await ce(),!1}}async function ce(){if(a.value)try{const l=await xe(a.value.id);l.success&&l.book&&d.updateBook(a.value.id,l.book)}catch(l){console.error("åˆ·æ–°ä¹¦ç±è¯¦æƒ…å¤±è´¥:",l)}}const N=k(null),W=k(null);function ye(l,o){N.value=o,l.dataTransfer&&(l.dataTransfer.effectAllowed="move",l.dataTransfer.setData("text/plain",o.toString()))}function _e(l,o){l.preventDefault(),l.dataTransfer&&(l.dataTransfer.dropEffect="move"),W.value=o}function Ce(){W.value=null}async function Te(l,o){if(l.preventDefault(),N.value===null||N.value===o||!a.value){N.value=null,W.value=null;return}const r=[...B.value],[x]=r.splice(N.value,1);if(!x)return;r.splice(o,0,x);const S=r.map(ne=>ne.id);await ue(S),N.value=null,W.value=null}function $e(){N.value=null,W.value=null}const oe=k(!1),U=k(""),de=k(null),ve=A(()=>{const l=a.value?.tags||[],o=U.value.trim().toLowerCase();return I.value.filter(r=>!l.includes(r.name)&&(o===""||r.name.toLowerCase().includes(o)))}),pe=A(()=>{const l=U.value.trim();return l?!I.value.some(o=>o.name.toLowerCase()===l.toLowerCase()):!1});function we(){U.value="",oe.value=!0,Ie(()=>{de.value?.focus()})}function se(){oe.value=!1,U.value=""}async function Be(){const l=U.value.trim();l&&(await ae(l),U.value="")}const H=k(!1);async function De(l){if(!(!a.value||H.value)){H.value=!0;try{const{removeTagsFromBook:o}=await ge(async()=>{const{removeTagsFromBook:x}=await import("./bookshelf.BX1u67VK.js");return{removeTagsFromBook:x}},__vite__mapDeps([0,1,2]));(await o(a.value.id,[l])).success?(d.removeTagFromBook(a.value.id,l),u("æ ‡ç­¾å·²ç§»é™¤","success")):u("ç§»é™¤æ ‡ç­¾å¤±è´¥","error")}catch(o){u("æ“ä½œå¤±è´¥","error"),console.error("ç§»é™¤æ ‡ç­¾å¤±è´¥:",o)}finally{H.value=!1}}}async function ae(l){if(!(!a.value||!l||H.value)){if(a.value.tags?.includes(l)){u("è¯¥æ ‡ç­¾å·²å­˜åœ¨","info");return}H.value=!0;try{const{createTag:o,addTagsToBook:r}=await ge(async()=>{const{createTag:S,addTagsToBook:ne}=await import("./bookshelf.BX1u67VK.js");return{createTag:S,addTagsToBook:ne}},__vite__mapDeps([0,1,2]));if(!I.value.some(S=>S.name===l))if((await o(l)).success)await d.loadTags();else{u("åˆ›å»ºæ ‡ç­¾å¤±è´¥","error");return}(await r(a.value.id,[l])).success?(d.addTagToBook(a.value.id,l),u("æ ‡ç­¾å·²æ·»åŠ ","success"),await d.loadBooks()):u("æ·»åŠ æ ‡ç­¾å¤±è´¥","error")}catch(o){u("æ“ä½œå¤±è´¥","error"),console.error("å¿«é€Ÿæ·»åŠ æ ‡ç­¾å¤±è´¥:",o)}finally{H.value=!1}}}return(l,o)=>(n(),i(F,null,[e("div",dt,[e("div",{class:"modal-overlay",onClick:o[0]||(o[0]=r=>c("close"))}),e("div",vt,[e("div",pt,[o[11]||(o[11]=e("h2",null,"ä¹¦ç±è¯¦æƒ…",-1)),e("button",{class:"modal-close",onClick:o[1]||(o[1]=r=>c("close"))},"Ã—")]),e("div",ft,[a.value?(n(),i("div",mt,[e("div",gt,[e("div",kt,[a.value.cover?(n(),i("img",{key:0,src:a.value.cover,alt:"å°é¢"},null,8,bt)):(n(),i("div",ht,"ðŸ“–"))]),e("div",yt,[e("h3",null,_(a.value.title),1),e("p",_t,[o[12]||(o[12]=e("span",null,"æ ‡ç­¾ï¼š",-1)),a.value.tags&&a.value.tags.length>0?(n(),i("span",Ct,[(n(!0),i(F,null,O(a.value.tags,r=>(n(),i("span",{key:r,class:"detail-tag",style:Z({background:$(r)})},[Y(_(r)+" ",1),e("span",{class:"remove-detail-tag",onClick:te(x=>De(r),["stop"])},"Ã—",8,Tt)],4))),128))])):(n(),i("span",$t,"æš‚æ— æ ‡ç­¾")),e("button",{class:"btn-add-tag",title:"æ·»åŠ æ ‡ç­¾",onClick:we},"+")]),e("p",wt,[o[13]||(o[13]=e("span",null,"ç« èŠ‚æ•°ï¼š",-1)),e("span",null,_(B.value.length),1)]),e("p",Bt,[o[14]||(o[14]=e("span",null,"åˆ›å»ºæ—¶é—´ï¼š",-1)),e("span",null,_(D(a.value.created_at||a.value.createdAt)),1)]),e("p",Dt,[o[15]||(o[15]=e("span",null,"æœ€åŽæ›´æ–°ï¼š",-1)),e("span",null,_(D(a.value.updated_at||a.value.updatedAt)),1)]),e("div",{class:"book-actions"},[e("button",{class:"btn btn-sm btn-primary",onClick:V},"â— æ¼«ç”»åˆ†æž"),e("button",{class:"btn btn-sm btn-secondary",onClick:b},"ç¼–è¾‘ä¹¦ç±"),e("button",{class:"btn btn-sm btn-danger",onClick:C},"åˆ é™¤ä¹¦ç±")])])]),e("div",Et,[e("div",{class:"section-header"},[o[17]||(o[17]=e("h3",null,"ç« èŠ‚åˆ—è¡¨",-1)),e("button",{class:"btn btn-sm btn-primary",onClick:j},[...o[16]||(o[16]=[e("span",{class:"btn-icon"},"+",-1),Y(" æ–°å»ºç« èŠ‚ ",-1)])])]),B.value.length>0?(n(),i("div",It,[(n(!0),i(F,null,O(B.value,(r,x)=>(n(),i("div",{key:r.id,class:re(["chapter-item",{dragging:N.value===x,"drag-over":W.value===x&&N.value!==x}]),draggable:"true",onDragstart:S=>ye(S,x),onDragover:S=>_e(S,x),onDragleave:Ce,onDrop:S=>Te(S,x),onDragend:$e},[o[18]||(o[18]=e("div",{class:"chapter-drag-handle",title:"æ‹–æ‹½æŽ’åº"},"â‹®â‹®",-1)),e("div",St,[e("span",xt,"#"+_(x+1),1),e("span",At,_(r.title),1),e("span",Lt,_(r.image_count||r.imageCount||0)+" å¼ å›¾ç‰‡",1)]),e("div",Vt,[e("button",{class:"chapter-action-btn chapter-enter-btn",onClick:S=>t(r.id)}," è¿›å…¥ç¿»è¯‘ ",8,qt),e("button",{class:"chapter-action-btn chapter-read-btn",disabled:(r.image_count||r.imageCount||0)===0,onClick:S=>E(r.id)}," è¿›å…¥é˜…è¯» ",8,Ut),e("button",{class:"chapter-action-btn",onClick:S=>G(r.id)}," ç¼–è¾‘ ",8,Rt),e("button",{class:"chapter-action-btn danger",onClick:S=>s(r.id)}," åˆ é™¤ ",8,Ft)])],42,Mt))),128))])):(n(),i("div",Nt,[...o[19]||(o[19]=[e("p",null,"æš‚æ— ç« èŠ‚ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»º",-1)])]))])])):M("",!0)])])]),(n(),R(le,{to:"body"},[m.value?(n(),i("div",Kt,[e("div",{class:"modal-overlay",onClick:o[2]||(o[2]=r=>m.value=!1)}),e("div",Pt,[e("div",Ot,[e("h2",null,_(g.value?"ç¼–è¾‘ç« èŠ‚":"æ–°å»ºç« èŠ‚"),1),e("button",{class:"modal-close",onClick:o[3]||(o[3]=r=>m.value=!1)},"Ã—")]),e("div",zt,[e("div",Qt,[o[20]||(o[20]=e("label",{for:"chapterTitleInput"},[Y("ç« èŠ‚åç§° "),e("span",{class:"required"},"*")],-1)),K(e("input",{id:"chapterTitleInput","onUpdate:modelValue":o[4]||(o[4]=r=>f.value=r),type:"text",placeholder:"ä¾‹å¦‚ï¼šç¬¬1è¯ã€åºç« ",onKeypress:J(p,["enter"])},null,544),[[P,f.value]])])]),e("div",jt,[e("button",{type:"button",class:"btn btn-secondary",onClick:o[5]||(o[5]=r=>m.value=!1)},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-primary",onClick:p},"ä¿å­˜")])])])):M("",!0)])),(n(),R(le,{to:"body"},[oe.value?(n(),i("div",Gt,[e("div",{class:"modal-overlay",onClick:se}),e("div",Wt,[e("div",{class:"modal-header"},[o[21]||(o[21]=e("h2",null,"å¿«é€Ÿæ·»åŠ æ ‡ç­¾",-1)),e("button",{class:"modal-close",onClick:se},"Ã—")]),e("div",Ht,[e("div",Jt,[K(e("input",{ref_key:"quickTagInputRef",ref:de,"onUpdate:modelValue":o[6]||(o[6]=r=>U.value=r),type:"text",class:"quick-tag-input",placeholder:"è¾“å…¥æ ‡ç­¾åç§°è¿›è¡Œæœç´¢æˆ–åˆ›å»º...",onKeypress:J(Be,["enter"])},null,544),[[P,U.value]])]),e("div",Xt,[(n(!0),i(F,null,O(ve.value,r=>(n(),i("div",{key:r.id||r.name,class:"quick-tag-item",onClick:x=>ae(r.name)},[e("span",{class:"tag-color-dot",style:Z({background:r.color||"#667eea"})},null,4),e("span",Zt,_(r.name),1),o[22]||(o[22]=e("span",{class:"tag-add-icon"},"+",-1))],8,Yt))),128)),pe.value?(n(),i("div",{key:0,class:"quick-tag-item new-tag",onClick:o[7]||(o[7]=r=>ae(U.value.trim()))},[o[23]||(o[23]=e("span",{class:"tag-icon"},"+",-1)),e("span",null,'åˆ›å»ºå¹¶æ·»åŠ  "'+_(U.value.trim())+'"',1)])):M("",!0),ve.value.length===0&&!pe.value?(n(),i("p",eo,_(U.value?"æœªæ‰¾åˆ°åŒ¹é…çš„æ ‡ç­¾":"æ‰€æœ‰æ ‡ç­¾å·²æ·»åŠ æˆ–æš‚æ— æ ‡ç­¾"),1)):M("",!0)])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary",onClick:se},"å…³é—­")])])])):M("",!0)])),(n(),R(le,{to:"body"},[v.value?(n(),i("div",to,[e("div",{class:"modal-overlay",onClick:o[8]||(o[8]=r=>v.value=!1)}),e("div",oo,[e("div",so,[o[24]||(o[24]=e("h2",null,"ç¡®è®¤åˆ é™¤",-1)),e("button",{class:"modal-close",onClick:o[9]||(o[9]=r=>v.value=!1)},"Ã—")]),e("div",ao,[e("p",null,_(h.value==="book"?"ç¡®å®šè¦åˆ é™¤è¿™æœ¬ä¹¦ç±å—ï¼Ÿæ‰€æœ‰ç« èŠ‚æ•°æ®å°†ä¸€å¹¶åˆ é™¤ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚":"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç« èŠ‚å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"),1)]),e("div",no,[e("button",{type:"button",class:"btn btn-secondary",onClick:o[10]||(o[10]=r=>v.value=!1)},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-danger",onClick:q},"åˆ é™¤")])])])):M("",!0)]))],64))}}),ro=Q(lo,[["__scopeId","data-v-b051f60e"]]),io={class:"tag-manage-form"},uo={class:"form-row"},co={class:"tag-list"},vo={key:0,class:"empty-hint"},po={key:0,class:"tag-view-mode"},fo={class:"tag-name"},mo={class:"tag-book-count"},go=["onClick"],ko=["onClick"],bo={key:1,class:"tag-edit-mode"},ho=z({__name:"TagManageModal",emits:["close"],setup(T,{emit:L}){const c=L,y=X(),d=k(""),m=k("#667eea"),g=k(null),f=k(""),v=k(""),h=A(()=>y.tags);async function w(){const $=d.value.trim();if(!$){u("è¯·è¾“å…¥æ ‡ç­¾åç§°","warning");return}if(h.value.some(b=>b.name===$)){u("æ ‡ç­¾å·²å­˜åœ¨","warning");return}try{await y.createTag($,m.value),u("æ ‡ç­¾åˆ›å»ºæˆåŠŸ","success"),d.value="",m.value="#667eea"}catch{u("åˆ›å»ºå¤±è´¥","error")}}function a($){g.value=$.name,f.value=$.name,v.value=$.color||"#667eea"}function B(){g.value=null,f.value="",v.value=""}async function I(){if(!g.value)return;const $=f.value.trim();if(!$){u("æ ‡ç­¾åç§°ä¸èƒ½ä¸ºç©º","warning");return}const b=g.value;if($!==b&&h.value.some(C=>C.name===$)){u("æ ‡ç­¾åç§°å·²å­˜åœ¨","warning");return}try{await y.updateTagApi(b,$,v.value)?(u("æ ‡ç­¾æ›´æ–°æˆåŠŸ","success"),B()):u("æ›´æ–°å¤±è´¥","error")}catch(C){u("æ›´æ–°å¤±è´¥","error"),console.error("æ›´æ–°æ ‡ç­¾å¤±è´¥:",C)}}async function D($){try{await y.deleteTagApi($)?u("æ ‡ç­¾å·²åˆ é™¤","success"):u("åˆ é™¤å¤±è´¥","error")}catch{u("åˆ é™¤å¤±è´¥","error")}}return($,b)=>(n(),R(he,{title:"æ ‡ç­¾ç®¡ç†",onClose:b[5]||(b[5]=C=>c("close"))},{footer:ee(()=>[e("button",{class:"btn btn-secondary",onClick:b[4]||(b[4]=C=>c("close"))},"å…³é—­")]),default:ee(()=>[e("div",io,[e("div",uo,[K(e("input",{"onUpdate:modelValue":b[0]||(b[0]=C=>d.value=C),type:"text",placeholder:"è¾“å…¥æ–°æ ‡ç­¾åç§°...",onKeypress:J(w,["enter"])},null,544),[[P,d.value]]),K(e("input",{"onUpdate:modelValue":b[1]||(b[1]=C=>m.value=C),type:"color",title:"é€‰æ‹©é¢œè‰²"},null,512),[[P,m.value]]),e("button",{class:"btn btn-primary btn-sm",onClick:w},"æ·»åŠ ")])]),e("div",co,[h.value.length===0?(n(),i("div",vo," æš‚æ— æ ‡ç­¾ï¼Œè¯·åœ¨ä¸Šæ–¹æ·»åŠ  ")):M("",!0),(n(!0),i(F,null,O(h.value,C=>(n(),i("div",{key:C.name,class:"tag-manage-item"},[g.value!==C.name?(n(),i("div",po,[e("span",{class:"tag-color-dot",style:Z({backgroundColor:C.color||"#667eea"})},null,4),e("span",fo,_(C.name),1),e("span",mo,_(C.book_count||0)+" æœ¬",1),e("button",{class:"tag-edit-btn",onClick:q=>a(C)}," ç¼–è¾‘ ",8,go),e("button",{class:"tag-delete-btn",onClick:q=>D(C.name)}," åˆ é™¤ ",8,ko)])):M("",!0),g.value===C.name?(n(),i("div",bo,[K(e("input",{"onUpdate:modelValue":b[2]||(b[2]=q=>v.value=q),type:"color",class:"edit-color-input",title:"é€‰æ‹©é¢œè‰²"},null,512),[[P,v.value]]),K(e("input",{"onUpdate:modelValue":b[3]||(b[3]=q=>f.value=q),type:"text",class:"edit-name-input",placeholder:"æ ‡ç­¾åç§°",onKeypress:J(I,["enter"])},null,544),[[P,f.value]]),e("button",{class:"tag-save-btn",onClick:I}," ä¿å­˜ "),e("button",{class:"tag-cancel-btn",onClick:B}," å–æ¶ˆ ")])):M("",!0)]))),128))])]),_:1}))}}),yo=Q(ho,[["__scopeId","data-v-20ab6eb1"]]),_o={class:"modal-content confirm-modal-content"},Co={class:"modal-header"},To={class:"modal-title"},$o={class:"modal-body confirm-modal-body"},wo={class:"confirm-message"},Bo={class:"modal-footer confirm-modal-footer"},Do=z({__name:"ConfirmModal",props:{message:{},title:{default:"ç¡®è®¤æ“ä½œ"},confirmText:{default:"ç¡®å®š"},cancelText:{default:"å–æ¶ˆ"},confirmType:{default:"primary"}},emits:["confirm","cancel"],setup(T,{emit:L}){const c=L,y=k(null);function d(){c("confirm")}function m(){c("cancel")}function g(v){v.target===v.currentTarget&&c("cancel")}function f(v){v.key==="Escape"?c("cancel"):v.key==="Enter"&&c("confirm")}return ie(()=>{document.addEventListener("keydown",f),y.value?.focus()}),be(()=>{document.removeEventListener("keydown",f)}),(v,h)=>(n(),i("div",{ref_key:"modalRef",ref:y,class:"modal-overlay confirm-modal-overlay",tabindex:"-1",onClick:g},[e("div",_o,[e("div",Co,[e("h3",To,_(T.title),1),e("button",{class:"modal-close-btn",onClick:m,title:"å…³é—­"},"Ã—")]),e("div",$o,[e("p",wo,_(T.message),1)]),e("div",Bo,[e("button",{class:"btn btn-secondary",onClick:m},_(T.cancelText),1),e("button",{class:re(["btn",T.confirmType==="danger"?"btn-danger":"btn-primary"]),onClick:d},_(T.confirmText),3)])])],512))}}),Eo=Q(Do,[["__scopeId","data-v-f6f7303a"]]),Io={class:"bookshelf-page"},Mo={class:"app-header"},So={class:"header-content"},xo={class:"logo-container"},Ao={class:"header-links"},Lo={class:"lan-access-info",title:"å…¶ä»–è®¾å¤‡å¯é€šè¿‡æ­¤åœ°å€è®¿é—®"},Vo={id:"lanUrl"},qo={class:"bookshelf-main"},Uo={class:"books-container"},Ro={key:0,class:"books-grid"},Fo={key:1,class:"empty-state"},No={key:2,class:"empty-state"},Ko=z({__name:"BookshelfView",setup(T){const L=ke(),c=X(),y=k("èŽ·å–ä¸­..."),d=k(!1),m=k(!1),g=k(!1),f=k(!1),v=k(null),h=k(""),w=k(null),a=A(()=>c.filteredBooks),B=A(()=>c.tags),I=A(()=>a.value.length===0&&!c.searchQuery);function D(s){s.persisted&&(console.log("[BookshelfView] é¡µé¢ä»Ž BFCache æ¢å¤ï¼Œåˆ·æ–°æ•°æ®"),c.loadBooks(),c.loadTags(),m.value&&c.currentBook&&q(c.currentBook.id))}ie(async()=>{await Promise.all([c.loadBooks(),c.loadTags()]);try{const s=await Se();s.success&&s.lan_url&&(y.value=s.lan_url)}catch(s){console.error("èŽ·å–æœåŠ¡å™¨ä¿¡æ¯å¤±è´¥:",s),y.value="èŽ·å–å¤±è´¥"}window.addEventListener("pageshow",D)}),be(()=>{window.removeEventListener("pageshow",D)});async function $(){try{await navigator.clipboard.writeText(y.value),u("å±€åŸŸç½‘åœ°å€å·²å¤åˆ¶ï¼","success")}catch{const s=document.createElement("textarea");s.value=y.value,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),u("å±€åŸŸç½‘åœ°å€å·²å¤åˆ¶ï¼","success")}}function b(){v.value=null,d.value=!0}function C(s){v.value=s,d.value=!0}async function q(s){try{const t=await fetch(`/api/bookshelf/books/${s}`);if(!t.ok)throw new Error(`HTTP ${t.status}`);const E=await t.json();if(!E.success)throw new Error(E.error||"åŠ è½½å¤±è´¥");E.book&&c.updateBook(s,E.book),c.setCurrentBook(s),m.value=!0}catch(t){const E=t instanceof Error?t.message:"æœªçŸ¥é”™è¯¯";console.error("åŠ è½½ä¹¦ç±è¯¦æƒ…å¤±è´¥:",t),u(`åŠ è½½ä¹¦ç±è¯¦æƒ…å¤±è´¥: ${E}`,"error")}}function j(){g.value=!0}function G(){L.push("/translate")}function p(){u("ðŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}return(s,t)=>{const E=Me("router-link");return n(),i("div",Io,[e("header",Mo,[e("div",So,[e("div",xo,[fe(E,{to:"/",title:"ä¹¦æž¶é¦–é¡µ"},{default:ee(()=>[...t[6]||(t[6]=[e("img",{src:Ee,alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",Ao,[e("span",Lo,[t[7]||(t[7]=e("span",{class:"lan-icon"},"ðŸŒå±€åŸŸç½‘è®¾å¤‡å¯é€šè¿‡è¯¥ç½‘å€è®¿é—®",-1)),e("span",Vo,_(y.value),1),e("button",{class:"copy-btn",title:"å¤åˆ¶åœ°å€",onClick:$},"ðŸ“‹")]),t[9]||(t[9]=e("a",{href:"http://www.mashirosaber.top",target:"_blank",class:"tutorial-link"},"ä½¿ç”¨æ•™ç¨‹",-1)),t[10]||(t[10]=e("a",{href:"https://github.com/MashiroSaber03/Saber-Translator",target:"_blank",class:"github-link"},[e("img",{src:Ae,alt:"GitHub",class:"github-icon"})],-1)),e("button",{class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:p},[...t[8]||(t[8]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("main",qo,[e("div",{class:"bookshelf-toolbar"},[t[14]||(t[14]=e("h1",{class:"page-title"},"æˆ‘çš„ä¹¦æž¶",-1)),e("div",{class:"toolbar-actions"},[e("button",{class:"btn btn-primary",onClick:b},[...t[11]||(t[11]=[e("span",{class:"btn-icon"},"+",-1),e("span",null,"æ–°å»ºä¹¦ç±",-1)])]),e("button",{class:"btn btn-secondary",onClick:j},[...t[12]||(t[12]=[e("span",null,"ðŸ·ï¸ ç®¡ç†æ ‡ç­¾",-1)])]),e("button",{class:"btn btn-secondary",onClick:G},[...t[13]||(t[13]=[e("span",null,"å¿«é€Ÿç¿»è¯‘",-1)])])])]),fe(He,{tags:B.value,onSearch:me(c).setSearchQuery,onFilterTag:me(c).toggleTagFilter},null,8,["tags","onSearch","onFilterTag"]),e("div",Uo,[a.value.length>0?(n(),i("div",Ro,[(n(!0),i(F,null,O(a.value,V=>(n(),R(Pe,{key:V.id,book:V,onClick:ue=>q(V.id)},null,8,["book","onClick"]))),128))])):I.value?(n(),i("div",Fo,[t[16]||(t[16]=e("div",{class:"empty-icon"},"ðŸ“š",-1)),t[17]||(t[17]=e("h2",null,"ä¹¦æž¶ç©ºç©ºå¦‚ä¹Ÿ",-1)),t[18]||(t[18]=e("p",null,'ç‚¹å‡»"æ–°å»ºä¹¦ç±"å¼€å§‹ä½ çš„ç¿»è¯‘ä¹‹æ—…',-1)),e("button",{class:"btn btn-primary",onClick:b},[...t[15]||(t[15]=[e("span",{class:"btn-icon"},"+",-1),e("span",null,"æ–°å»ºç¬¬ä¸€æœ¬ä¹¦",-1)])])])):(n(),i("div",No,[...t[19]||(t[19]=[e("div",{class:"empty-icon"},"ðŸ”",-1),e("h2",null,"æœªæ‰¾åˆ°åŒ¹é…çš„ä¹¦ç±",-1),e("p",null,"å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–æ ‡ç­¾ç­›é€‰",-1)])]))])]),d.value?(n(),R(ct,{key:0,"book-id":v.value,onClose:t[0]||(t[0]=V=>d.value=!1),onSaved:t[1]||(t[1]=V=>d.value=!1)},null,8,["book-id"])):M("",!0),m.value?(n(),R(ro,{key:1,onClose:t[2]||(t[2]=V=>m.value=!1),onEdit:C})):M("",!0),g.value?(n(),R(yo,{key:2,onClose:t[3]||(t[3]=V=>g.value=!1)})):M("",!0),f.value?(n(),R(Eo,{key:3,message:h.value,onConfirm:t[4]||(t[4]=V=>{w.value?.(),f.value=!1}),onCancel:t[5]||(t[5]=V=>f.value=!1)},null,8,["message"])):M("",!0)])}}}),Jo=Q(Ko,[["__scopeId","data-v-e86261b3"]]);export{Jo as default};
