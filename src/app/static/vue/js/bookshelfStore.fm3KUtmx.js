import{d as _e,r as c,c as f}from"./vue-vendor.BU3zOQRA.js";import{getBooks as Ee,getTags as Ke,createBook as Me,updateBook as be,deleteBook as De,batchDeleteBooks as Qe,createTag as je,deleteTag as ze,updateTag as Re,createChapter as qe,updateChapter as Ge,deleteChapter as He,reorderChapters as Je,addTagsToBook as Le,removeTagsFromBook as Ne}from"./bookshelf.CDzdK045.js";const Ve="/static/vue/pic/logo.png",We=_e("bookshelf",()=>{const s=c([]),d=c([]),p=c(""),l=c([]),T=c("updatedAt"),$=c("desc"),h=c(!1),a=c(new Set),u=c(null),B=c(null),m=c(!1),w=c(null),v=f(()=>s.value),R=f(()=>s.value.length),q=f(()=>v.value.length),G=f(()=>a.value.size),S=f(()=>v.value.length===0?!1:v.value.every(e=>a.value.has(e.id))),H=f(()=>u.value&&s.value.find(e=>e.id===u.value)||null),J=f(()=>B.value&&s.value.find(e=>e.id===B.value)||null),L=f(()=>a.value),N=f(()=>p.value);function F(e){s.value=e,console.log(`书籍列表已设置，共 ${e.length} 本书`)}function O(e){s.value.unshift(e),console.log(`已添加书籍: ${e.title}`)}function _(e,n){const o=s.value.findIndex(t=>t.id===e);if(o>=0){const t=s.value[o];t&&(s.value[o]={...t,...n},console.log(`已更新书籍: ${e}`))}}function k(e){const n=s.value.findIndex(o=>o.id===e);n>=0&&(s.value.splice(n,1),a.value.delete(e),u.value===e&&(u.value=null),console.log(`已删除书籍: ${e}`))}function P(e){for(const n of e)k(n);console.log(`已批量删除 ${e.length} 本书`)}function U(e){return s.value.find(n=>n.id===e)||null}function E(e,n){const o=s.value.find(t=>t.id===e);o&&(o.chapters||(o.chapters=[]),o.chapters.push(n),console.log(`已添加章节到书籍 ${e}: ${n.title}`))}function K(e,n,o){const t=s.value.find(r=>r.id===e);if(t&&t.chapters){const r=t.chapters.find(i=>i.id===n);r&&(Object.assign(r,o),console.log(`已更新章节: ${n}`))}}function M(e,n){const o=s.value.find(t=>t.id===e);if(o&&o.chapters){const t=o.chapters.findIndex(r=>r.id===n);t>=0&&(o.chapters.splice(t,1),console.log(`已删除章节: ${n}`))}}function b(e,n){const o=s.value.find(t=>t.id===e);if(o&&o.chapters){const t=[];for(let r=0;r<n.length;r++){const i=o.chapters.find(Oe=>Oe.id===n[r]);i&&(i.order=r,t.push(i))}o.chapters=t,console.log(`已重新排序章节: ${e}`)}}function D(e){d.value=e,console.log(`标签列表已设置，共 ${e.length} 个标签`)}function Q(e){d.value.push(e),console.log(`已添加标签: ${e.name}`)}function j(e){const n=d.value.findIndex(o=>o.id===e);if(n>=0){d.value.splice(n,1);const o=l.value.indexOf(e);o>=0&&l.value.splice(o,1),console.log(`已删除标签: ${e}`)}}function x(e,n){const o=s.value.find(t=>t.id===e);o&&(o.tags||(o.tags=[]),o.tags.includes(n)||(o.tags.push(n),console.log(`已为书籍 ${e} 添加标签 ${n}`)))}function C(e,n){const o=s.value.find(t=>t.id===e);if(o&&o.tags){const t=o.tags.indexOf(n);t>=0&&(o.tags.splice(t,1),console.log(`已从书籍 ${e} 移除标签 ${n}`))}}function V(e,n){for(const o of e)for(const t of n)x(o,t);console.log(`已批量添加标签到 ${e.length} 本书`)}function W(e,n){for(const o of e)for(const t of n)C(o,t);console.log(`已批量从 ${e.length} 本书移除标签`)}function X(e){p.value=e}function Y(){p.value=""}function Z(e){const n=l.value.indexOf(e);n>=0?l.value.splice(n,1):l.value.push(e),g()}function I(e){l.value=e}function ee(){l.value=[]}function oe(e,n="desc"){T.value=e,$.value=n}function ne(){h.value=!0,a.value.clear(),console.log("已进入批量操作模式")}function te(){h.value=!1,a.value.clear(),console.log("已退出批量操作模式")}function re(e){a.value.has(e)?a.value.delete(e):a.value.add(e)}function se(){if(S.value)a.value.clear();else for(const e of v.value)a.value.add(e.id)}function ae(){return Array.from(a.value)}function ce(e){u.value=e}function le(){u.value=null}function ue(e){u.value===e?u.value=null:u.value=e}function A(e){m.value=e}function y(e){w.value=e}function ie(e){B.value=e}function fe(e){a.value.add(e)}function de(e){a.value.delete(e)}function pe(){a.value.clear()}function ve(e){p.value=e,g()}async function g(){A(!0),y(null);try{const e={};p.value.trim()&&(e.search=p.value.trim()),l.value.length>0&&(e.tags=l.value);const n=await Ee(e);n.success&&n.books?F(n.books):y(n.error||"加载书籍失败")}catch(e){y(e instanceof Error?e.message:"加载书籍失败"),console.error("加载书籍失败:",e)}finally{A(!1)}}async function z(){try{const e=await Ke();e.success&&e.tags&&D(e.tags)}catch(e){console.error("加载标签失败:",e)}}async function ge(e,n,o,t){try{const r=await Me(e,n,o,t);return r.success&&r.book?(O(r.book),r.book):null}catch(r){return console.error("创建书籍失败:",r),null}}async function he(e,n){try{const o=await be(e,n);return o.success&&o.book?(_(e,o.book),!0):!1}catch(o){return console.error("更新书籍失败:",o),!1}}async function Be(e){try{return(await De(e)).success?(k(e),!0):!1}catch(n){return console.error("删除书籍失败:",n),!1}}async function ke(e){try{const n=await Qe(e);if(n.success){for(const o of e)k(o);return n.success_count??e.length}return-1}catch(n){return console.error("批量删除书籍失败:",n),-1}}async function ye(e,n){try{const o=await je(e,n);return o.success&&o.tag?(Q(o.tag),o.tag):null}catch(o){return console.error("创建标签失败:",o),null}}async function Te(e){try{return(await ze(e)).success?(j(e),!0):!1}catch(n){return console.error("删除标签失败:",n),!1}}async function $e(e,n,o){try{return(await Re(e,n,o)).success?(await z(),await g(),!0):!1}catch(t){return console.error("更新标签失败:",t),!1}}async function me(e,n){try{const o=await qe(e,n);return o.success&&o.chapter?(E(e,o.chapter),o.chapter):null}catch(o){return console.error("创建章节失败:",o),null}}async function we(e,n,o){try{return(await Ge(e,n,o)).success?(K(e,n,{title:o}),!0):!1}catch(t){return console.error("更新章节失败:",t),!1}}async function xe(e,n){try{return(await He(e,n)).success?(M(e,n),!0):!1}catch(o){return console.error("删除章节失败:",o),!1}}async function Ce(e,n){try{return(await Je(e,n)).success?(b(e,n),!0):!1}catch(o){return console.error("重新排序章节失败:",o),!1}}async function Ae(e,n){try{if((await Le(e,n)).success){for(const t of n){const r=d.value.find(i=>i.id===t);r&&x(e,r.name)}return!0}return!1}catch(o){return console.error("添加标签失败:",o),!1}}async function Se(e,n){try{if((await Ne(e,n)).success){for(const t of n){const r=d.value.find(i=>i.id===t);r&&C(e,r.name)}return!0}return!1}catch(o){return console.error("移除标签失败:",o),!1}}function Fe(){s.value=[],d.value=[],p.value="",l.value=[],T.value="updatedAt",$.value="desc",h.value=!1,a.value.clear(),u.value=null,m.value=!1,w.value=null,console.log("书架状态已重置")}return{books:s,tags:d,searchKeyword:p,selectedTagIds:l,sortBy:T,sortOrder:$,batchMode:h,selectedBookIds:a,expandedBookId:u,currentBookId:B,isLoading:m,error:w,filteredBooks:v,bookCount:R,filteredBookCount:q,selectedBookCount:G,isAllSelected:S,expandedBook:H,currentBook:J,selectedBooks:L,searchQuery:N,setBooks:F,addBook:O,updateBook:_,deleteBook:k,deleteBooks:P,getBookById:U,addChapter:E,updateChapter:K,deleteChapter:M,reorderChapters:b,setTags:D,addTag:Q,deleteTag:j,addTagToBook:x,removeTagFromBook:C,batchAddTags:V,batchRemoveTags:W,setSearchKeyword:X,clearSearchKeyword:Y,setSearchQuery:ve,toggleTagFilter:Z,setTagFilter:I,clearTagFilter:ee,setSort:oe,enterBatchMode:ne,exitBatchMode:te,toggleBookSelection:re,toggleSelectAll:se,getSelectedBookIds:ae,selectBook:fe,deselectBook:de,clearSelection:pe,expandBook:ce,collapseBook:le,toggleBookExpand:ue,setCurrentBook:ie,setLoading:A,setError:y,loadBooks:g,fetchBooks:g,loadTags:z,createBook:ge,updateBookApi:he,deleteBookApi:Be,batchDeleteBooksApi:ke,createTag:ye,deleteTagApi:Te,updateTagApi:$e,createChapterApi:me,updateChapterApi:we,deleteChapterApi:xe,reorderChaptersApi:Ce,addTagsToBookApi:Ae,removeTagsFromBookApi:Se,reset:Fe}});export{Ve as _,We as u};
