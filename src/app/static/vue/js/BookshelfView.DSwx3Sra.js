const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/bookshelf.CDzdK045.js","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js"])))=>i.map(i=>d[i]);
import{_ as X,s as n,a as he}from"./index.3m4ltW8l.js";import{u as ne,_ as De}from"./bookshelfStore.fm3KUtmx.js";import{a as Y,c as R,i,h as a,n as ie,v as A,e,k as te,t as _,F as K,j,x as se,r as k,y as G,z as W,A as ae,l as ye,b as P,w as re,B as oe,g as ce,C as Ce,D as Ee,o as Te,f as _e,E as Ie,u as be}from"./vue-vendor.BU3zOQRA.js";import"./client.Bht704G-.js";import{g as xe}from"./system.CmjDD-4C.js";import{B as $e}from"./BaseModal.CnDw-5RG.js";import{getBookDetail as Ae}from"./bookshelf.CDzdK045.js";import"./utils-vendor.B9ygI19o.js";const Se="/static/vue/pic/github.jpg",Le=["checked"],Re={class:"book-cover"},Ve=["src","alt"],qe={key:1,class:"book-cover-placeholder"},Ue={class:"book-info"},Fe=["title"],ze={class:"book-chapter-count"},Ne={key:0,class:"book-tags"},Oe=Y({__name:"BookCard",props:{book:{},selected:{type:Boolean,default:!1},batchMode:{type:Boolean,default:!1}},emits:["click","edit","select"],setup(w,{emit:F}){const c=w,C=F,d=ne(),h=R(()=>d.tags);function y(){c.batchMode?C("select"):C("click")}function b(x){return h.value.find(p=>p.name===x)?.color||"#667eea"}function f(){return!!c.book.cover&&c.book.cover.length>0}function D(x){const s=x.target;if(s.parentElement){s.style.display="none";const p=document.createElement("div");p.className="book-cover-placeholder",p.textContent="ğŸ“–",s.parentElement.appendChild(p)}}return(x,s)=>(a(),i("div",{class:ie(["book-card",{selected:w.selected,"batch-mode":w.batchMode}]),onClick:y},[w.batchMode?(a(),i("div",{key:0,class:"book-checkbox",onClick:s[2]||(s[2]=te(p=>C("select"),["stop"]))},[e("input",{type:"checkbox",checked:w.selected,onClick:s[0]||(s[0]=te(()=>{},["stop"])),onChange:s[1]||(s[1]=p=>C("select"))},null,40,Le)])):A("",!0),e("div",Re,[f()?(a(),i("img",{key:0,src:w.book.cover,alt:w.book.title,onError:D},null,40,Ve)):(a(),i("div",qe,"ğŸ“–"))]),e("div",Ue,[e("h3",{class:"book-title",title:w.book.title},_(w.book.title),9,Fe),e("p",ze,_(w.book.chapter_count||w.book.chapters?.length||0)+" ç« èŠ‚",1),w.book.tags&&w.book.tags.length>0?(a(),i("div",Ne,[(a(!0),i(K,null,j(w.book.tags,p=>(a(),i("span",{key:p,class:"book-tag",style:se({background:b(p)})},_(p),5))),128))])):A("",!0)])],2))}}),Pe=X(Oe,[["__scopeId","data-v-ae36f84a"]]),Ke={class:"filter-bar"},Qe={class:"search-box"},je={key:0,class:"tag-filter"},Ge={class:"tag-chips"},We=["onClick"],He=Y({__name:"BookSearch",props:{tags:{}},emits:["search","filterTag"],setup(w,{emit:F}){const c=F,C=ne(),d=k(""),h=R(()=>d.value.length>0);function y(){c("search",d.value)}function b(){d.value="",c("search","")}let f;function D(){clearTimeout(f),f=setTimeout(()=>{y()},300)}function x(p){c("filterTag",p)}function s(p){return C.selectedTagIds.includes(p)}return(p,B)=>(a(),i("div",Ke,[e("div",Qe,[G(e("input",{"onUpdate:modelValue":B[0]||(B[0]=S=>d.value=S),type:"text",placeholder:"æœç´¢ä¹¦ç±åç§°æˆ–æ ‡ç­¾...",autocomplete:"off",onInput:D,onKeypress:ae(y,["enter"])},null,544),[[W,d.value]]),e("button",{class:"search-btn",onClick:y},"ğŸ”"),h.value?(a(),i("button",{key:0,class:"clear-search-btn",onClick:b}," âœ• ")):A("",!0)]),w.tags.length>0?(a(),i("div",je,[B[1]||(B[1]=e("span",{class:"filter-label"},"æ ‡ç­¾ç­›é€‰:",-1)),e("div",Ge,[(a(!0),i(K,null,j(w.tags,S=>(a(),i("span",{key:S.id,class:ie(["tag-chip",{active:s(S.name)}]),style:se(S.color?{"--tag-color":S.color,backgroundColor:s(S.name)?S.color:""}:{}),onClick:E=>x(S.name)},_(S.name),15,We))),128))])])):A("",!0)]))}}),Je=X(He,[["__scopeId","data-v-dd828b80"]]),Xe={class:"form-group"},Ye={class:"form-group"},Ze={class:"cover-preview"},et=["src"],tt={key:1,class:"cover-placeholder"},ot={class:"form-group"},st={class:"tag-input-container"},at={class:"selected-tags"},nt=["onClick"],lt={class:"tag-dropdown"},rt=["onKeypress"],it={key:0,class:"tag-suggestions"},ct=["onClick"],ut=Y({__name:"BookModal",props:{bookId:{default:null}},emits:["close","saved"],setup(w,{emit:F}){const c=w,C=F,d=ne(),h=k(""),y=k(null),b=k([]),f=k(""),D=k(!1),x=R(()=>!!c.bookId),s=R(()=>x.value?"ç¼–è¾‘ä¹¦ç±":"æ–°å»ºä¹¦ç±"),p=R(()=>d.tags),B=R(()=>{if(!f.value)return p.value;const m=f.value.toLowerCase();return p.value.filter(l=>l.name.toLowerCase().includes(m)&&!b.value.includes(l.id))});ye(()=>{if(c.bookId){const m=d.books.find(l=>l.id===c.bookId);m&&(h.value=m.title,y.value=m.cover||null,m.tags&&m.tags.length>0&&(b.value=m.tags.map(l=>p.value.find(N=>N.name===l)?.id).filter(l=>!!l)))}});function S(m){const g=m.target.files?.[0];if(!g)return;if(!g.type.startsWith("image/")){n("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶","error");return}const N=new FileReader;N.onload=le=>{y.value=le.target?.result},N.readAsDataURL(g)}function E(m){m.preventDefault();const l=m.dataTransfer?.files[0];if(!l||!l.type.startsWith("image/"))return;const g=new FileReader;g.onload=N=>{y.value=N.target?.result},g.readAsDataURL(l)}function T(m){b.value.includes(m)||b.value.push(m),f.value="",D.value=!1}async function M(){const m=f.value.trim();if(!m)return;const l=p.value.find(g=>g.name===m);if(l){T(l.id);return}try{const g=await d.createTag(m);g&&T(g.id)}catch{n("åˆ›å»ºæ ‡ç­¾å¤±è´¥","error")}}function z(m){b.value=b.value.filter(l=>l!==m)}function H(m){return p.value.find(g=>g.id===m)?.name||m}async function J(){if(!h.value.trim()){n("è¯·è¾“å…¥ä¹¦ç±åç§°","warning");return}const m=b.value.map(l=>H(l));try{x.value&&c.bookId?await d.updateBookApi(c.bookId,{title:h.value.trim(),cover:y.value||void 0})?(d.updateBook(c.bookId,{tags:m}),n("ä¹¦ç±æ›´æ–°æˆåŠŸ","success"),C("saved")):n("æ›´æ–°å¤±è´¥","error"):await d.createBook(h.value.trim(),void 0,y.value||void 0,m.length>0?m:void 0)?(n("ä¹¦ç±åˆ›å»ºæˆåŠŸ","success"),C("saved")):n("åˆ›å»ºå¤±è´¥","error")}catch{n(x.value?"æ›´æ–°å¤±è´¥":"åˆ›å»ºå¤±è´¥","error")}}return(m,l)=>(a(),P($e,{title:s.value,onClose:l[6]||(l[6]=g=>C("close"))},{footer:re(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:l[5]||(l[5]=g=>C("close"))},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-primary",onClick:J},"ä¿å­˜")]),default:re(()=>[e("form",{onSubmit:te(J,["prevent"])},[e("div",Xe,[l[7]||(l[7]=e("label",{for:"bookTitle"},[oe("ä¹¦ç±åç§° "),e("span",{class:"required"},"*")],-1)),G(e("input",{id:"bookTitle","onUpdate:modelValue":l[0]||(l[0]=g=>h.value=g),type:"text",placeholder:"è¯·è¾“å…¥ä¹¦ç±åç§°",required:""},null,512),[[W,h.value]])]),e("div",Ye,[l[9]||(l[9]=e("label",null,"å°é¢å›¾ç‰‡",-1)),e("div",{class:"cover-upload-area",onDragover:l[1]||(l[1]=te(()=>{},["prevent"])),onDrop:E,onClick:l[2]||(l[2]=g=>m.$refs.coverInput.click())},[e("input",{ref:"coverInput",type:"file",accept:"image/*",hidden:"",onChange:S},null,544),e("div",Ze,[y.value?(a(),i("img",{key:0,src:y.value,alt:"å°é¢é¢„è§ˆ"},null,8,et)):(a(),i("div",tt,[...l[8]||(l[8]=[e("span",{class:"upload-icon"},"ğŸ“·",-1),e("span",null,"ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å°é¢",-1)])]))])],32),l[10]||(l[10]=e("p",{class:"form-hint"},"æ”¯æŒ JPGã€PNGã€WebP æ ¼å¼ï¼Œå»ºè®®æ¯”ä¾‹ 3:4",-1))]),e("div",ot,[l[11]||(l[11]=e("label",null,"æ ‡ç­¾",-1)),e("div",st,[e("div",at,[(a(!0),i(K,null,j(b.value,g=>(a(),i("span",{key:g,class:"selected-tag"},[oe(_(H(g))+" ",1),e("button",{type:"button",class:"remove-tag",onClick:N=>z(g)},"Ã—",8,nt)]))),128))]),e("div",lt,[G(e("input",{"onUpdate:modelValue":l[3]||(l[3]=g=>f.value=g),type:"text",placeholder:"è¾“å…¥æ ‡ç­¾åç§°...",autocomplete:"off",onFocus:l[4]||(l[4]=g=>D.value=!0),onKeypress:ae(te(M,["prevent"]),["enter"])},null,40,rt),[[W,f.value]]),D.value&&B.value.length>0?(a(),i("div",it,[(a(!0),i(K,null,j(B.value,g=>(a(),i("button",{key:g.id,type:"button",class:"tag-suggestion",onClick:N=>T(g.id)},_(g.name),9,ct))),128))])):A("",!0)])]),l[12]||(l[12]=e("p",{class:"form-hint"},"è¾“å…¥åæŒ‰å›è½¦æ·»åŠ æ–°æ ‡ç­¾ï¼Œæˆ–ä»å·²æœ‰æ ‡ç­¾ä¸­é€‰æ‹©",-1))])],32)]),_:1},8,["title"]))}}),dt=X(ut,[["__scopeId","data-v-087929e9"]]),vt={class:"modal active"},ft={class:"modal-content modal-large"},mt={class:"modal-header"},pt={class:"modal-body"},gt={key:0,class:"book-detail-container"},kt={class:"book-info-section"},bt={class:"book-cover-large"},ht=["src"],yt={key:1,class:"book-cover-placeholder"},_t={class:"book-meta"},Ct={class:"meta-item"},Tt={key:0,class:"detail-tags"},$t=["onClick"],wt={key:1,class:"no-tags-hint"},Bt={class:"meta-item"},Mt={class:"meta-item"},Dt={class:"meta-item"},Et={class:"chapters-section"},It={key:0,class:"chapters-list"},xt=["onDragstart","onDragover","onDrop"],At={class:"chapter-info"},St={class:"chapter-order"},Lt={class:"chapter-title"},Rt={class:"chapter-meta"},Vt={class:"chapter-actions"},qt=["onClick"],Ut=["disabled","onClick"],Ft=["onClick"],zt=["onClick"],Nt={key:1,class:"empty-state-small"},Ot={key:0,class:"modal active"},Pt={class:"modal-content modal-small"},Kt={class:"modal-header"},Qt={class:"modal-body"},jt={class:"form-group"},Gt={class:"modal-footer"},Wt={key:0,class:"modal active"},Ht={class:"modal-content modal-small"},Jt={class:"modal-body"},Xt={class:"quick-tag-input-wrapper"},Yt={class:"quick-tag-list"},Zt=["onClick"],eo={class:"quick-tag-name"},to={key:1,class:"no-tags-hint"},oo={key:0,class:"modal active"},so={class:"modal-content modal-small"},ao={class:"modal-header"},no={class:"modal-body"},lo={class:"modal-footer"},ro=Y({__name:"BookDetailModal",emits:["close","edit"],setup(w,{emit:F}){const c=F,C=Ce(),d=ne(),h=k(!1),y=k(null),b=k(""),f=k(!1),D=k("book"),x=k(null),s=R(()=>d.currentBook),p=R(()=>s.value?.chapters||[]),B=R(()=>d.tags);function S(r){return r?new Date(r).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function E(r){return B.value.find(u=>u.name===r)?.color||"#667eea"}function T(){s.value&&(c("edit",s.value.id),c("close"))}function M(){D.value="book",f.value=!0}async function z(){try{D.value==="book"&&s.value?await d.deleteBookApi(s.value.id)?(n("ä¹¦ç±å·²åˆ é™¤","success"),c("close")):n("åˆ é™¤å¤±è´¥","error"):D.value==="chapter"&&x.value&&s.value&&(await d.deleteChapterApi(s.value.id,x.value)?n("ç« èŠ‚å·²åˆ é™¤","success"):n("åˆ é™¤å¤±è´¥","error"))}catch{n("åˆ é™¤å¤±è´¥","error")}f.value=!1,x.value=null}function H(){y.value=null,b.value="",h.value=!0}function J(r){const t=p.value.find(u=>u.id===r);t&&(y.value=r,b.value=t.title,h.value=!0)}async function m(){if(!b.value.trim()||!s.value){n("è¯·è¾“å…¥ç« èŠ‚åç§°","warning");return}try{y.value?await d.updateChapterApi(s.value.id,y.value,b.value.trim())?(n("ç« èŠ‚æ›´æ–°æˆåŠŸ","success"),h.value=!1):n("æ›´æ–°å¤±è´¥","error"):await d.createChapterApi(s.value.id,b.value.trim())?(n("ç« èŠ‚åˆ›å»ºæˆåŠŸ","success"),h.value=!1):n("åˆ›å»ºå¤±è´¥","error")}catch{n("ä¿å­˜å¤±è´¥","error")}}function l(r){D.value="chapter",x.value=r,f.value=!0}function g(r){s.value&&C.push({path:"/translate",query:{book:s.value.id,chapter:r}})}function N(r){s.value&&C.push({path:"/reader",query:{book:s.value.id,chapter:r}})}function le(){s.value&&C.push({path:"/insight",query:{book:s.value.id}})}async function ue(r){if(!s.value)return!1;try{return await d.reorderChaptersApi(s.value.id,r)?(n("ç« èŠ‚æ’åºå·²æ›´æ–°","success"),!0):(n("æ’åºä¿å­˜å¤±è´¥","error"),await Q(),!1)}catch{return n("æ’åºä¿å­˜å¤±è´¥","error"),await Q(),!1}}async function Q(){if(s.value)try{const r=await Ae(s.value.id);r.success&&r.book&&d.updateBook(s.value.id,r.book)}catch(r){console.error("åˆ·æ–°ä¹¦ç±è¯¦æƒ…å¤±è´¥:",r)}}const q=k(null),L=k(null);function de(r,t){q.value=t,r.dataTransfer&&(r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/plain",t.toString()))}function ve(r,t){r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="move"),L.value=t}function fe(){L.value=null}async function me(r,t){if(r.preventDefault(),q.value===null||q.value===t||!s.value){q.value=null,L.value=null;return}const u=[...p.value],[U]=u.splice(q.value,1);if(!U)return;u.splice(t,0,U);const V=u.map(ke=>ke.id);await ue(V),q.value=null,L.value=null}function v(){q.value=null,L.value=null}const o=k(!1),I=k(""),$=k(null),O=R(()=>{const r=s.value?.tags||[],t=I.value.trim().toLowerCase();return B.value.filter(u=>!r.includes(u.name)&&(t===""||u.name.toLowerCase().includes(t)))}),Z=R(()=>{const r=I.value.trim();return r?!B.value.some(t=>t.name.toLowerCase()===r.toLowerCase()):!1});function we(){I.value="",o.value=!0,Ee(()=>{$.value?.focus()})}function pe(){o.value=!1,I.value=""}async function Be(){const r=I.value.trim();r&&(await ge(r),I.value="")}const ee=k(!1);async function Me(r){if(!(!s.value||ee.value)){ee.value=!0;try{const{batchRemoveTags:t}=await he(async()=>{const{batchRemoveTags:U}=await import("./bookshelf.CDzdK045.js");return{batchRemoveTags:U}},__vite__mapDeps([0,1,2]));(await t([s.value.id],[r])).success?(d.removeTagFromBook(s.value.id,r),n("æ ‡ç­¾å·²ç§»é™¤","success")):n("ç§»é™¤æ ‡ç­¾å¤±è´¥","error")}catch(t){n("æ“ä½œå¤±è´¥","error"),console.error("ç§»é™¤æ ‡ç­¾å¤±è´¥:",t)}finally{ee.value=!1}}}async function ge(r){if(!(!s.value||!r||ee.value)){if(s.value.tags?.includes(r)){n("è¯¥æ ‡ç­¾å·²å­˜åœ¨","info");return}ee.value=!0;try{const{createTag:t,batchAddTags:u}=await he(async()=>{const{createTag:V,batchAddTags:ke}=await import("./bookshelf.CDzdK045.js");return{createTag:V,batchAddTags:ke}},__vite__mapDeps([0,1,2]));if(!B.value.some(V=>V.name===r))if((await t(r)).success)await d.loadTags();else{n("åˆ›å»ºæ ‡ç­¾å¤±è´¥","error");return}(await u([s.value.id],[r])).success?(d.addTagToBook(s.value.id,r),n("æ ‡ç­¾å·²æ·»åŠ ","success"),await d.loadBooks()):n("æ·»åŠ æ ‡ç­¾å¤±è´¥","error")}catch(t){n("æ“ä½œå¤±è´¥","error"),console.error("å¿«é€Ÿæ·»åŠ æ ‡ç­¾å¤±è´¥:",t)}finally{ee.value=!1}}}return(r,t)=>(a(),i(K,null,[e("div",vt,[e("div",{class:"modal-overlay",onClick:t[0]||(t[0]=u=>c("close"))}),e("div",ft,[e("div",mt,[t[11]||(t[11]=e("h2",null,"ä¹¦ç±è¯¦æƒ…",-1)),e("button",{class:"modal-close",onClick:t[1]||(t[1]=u=>c("close"))},"Ã—")]),e("div",pt,[s.value?(a(),i("div",gt,[e("div",kt,[e("div",bt,[s.value.cover?(a(),i("img",{key:0,src:s.value.cover,alt:"å°é¢"},null,8,ht)):(a(),i("div",yt,"ğŸ“–"))]),e("div",_t,[e("h3",null,_(s.value.title),1),e("p",Ct,[t[12]||(t[12]=e("span",null,"æ ‡ç­¾ï¼š",-1)),s.value.tags&&s.value.tags.length>0?(a(),i("span",Tt,[(a(!0),i(K,null,j(s.value.tags,u=>(a(),i("span",{key:u,class:"detail-tag",style:se({background:E(u)})},[oe(_(u)+" ",1),e("span",{class:"remove-detail-tag",onClick:te(U=>Me(u),["stop"])},"Ã—",8,$t)],4))),128))])):(a(),i("span",wt,"æš‚æ— æ ‡ç­¾")),e("button",{class:"btn-add-tag",title:"æ·»åŠ æ ‡ç­¾",onClick:we},"+")]),e("p",Bt,[t[13]||(t[13]=e("span",null,"ç« èŠ‚æ•°ï¼š",-1)),e("span",null,_(p.value.length),1)]),e("p",Mt,[t[14]||(t[14]=e("span",null,"åˆ›å»ºæ—¶é—´ï¼š",-1)),e("span",null,_(S(s.value.created_at||s.value.createdAt)),1)]),e("p",Dt,[t[15]||(t[15]=e("span",null,"æœ€åæ›´æ–°ï¼š",-1)),e("span",null,_(S(s.value.updated_at||s.value.updatedAt)),1)]),e("div",{class:"book-actions"},[e("button",{class:"btn btn-sm btn-primary",onClick:le},"â— æ¼«ç”»åˆ†æ"),e("button",{class:"btn btn-sm btn-secondary",onClick:T},"ç¼–è¾‘ä¹¦ç±"),e("button",{class:"btn btn-sm btn-danger",onClick:M},"åˆ é™¤ä¹¦ç±")])])]),e("div",Et,[e("div",{class:"section-header"},[t[17]||(t[17]=e("h3",null,"ç« èŠ‚åˆ—è¡¨",-1)),e("button",{class:"btn btn-sm btn-primary",onClick:H},[...t[16]||(t[16]=[e("span",{class:"btn-icon"},"+",-1),oe(" æ–°å»ºç« èŠ‚ ",-1)])])]),p.value.length>0?(a(),i("div",It,[(a(!0),i(K,null,j(p.value,(u,U)=>(a(),i("div",{key:u.id,class:ie(["chapter-item",{dragging:q.value===U,"drag-over":L.value===U&&q.value!==U}]),draggable:"true",onDragstart:V=>de(V,U),onDragover:V=>ve(V,U),onDragleave:fe,onDrop:V=>me(V,U),onDragend:v},[t[18]||(t[18]=e("div",{class:"chapter-drag-handle",title:"æ‹–æ‹½æ’åº"},"â‹®â‹®",-1)),e("div",At,[e("span",St,"#"+_(U+1),1),e("span",Lt,_(u.title),1),e("span",Rt,_(u.image_count||u.imageCount||0)+" å¼ å›¾ç‰‡",1)]),e("div",Vt,[e("button",{class:"chapter-action-btn chapter-enter-btn",onClick:V=>g(u.id)}," è¿›å…¥ç¿»è¯‘ ",8,qt),e("button",{class:"chapter-action-btn chapter-read-btn",disabled:(u.image_count||u.imageCount||0)===0,onClick:V=>N(u.id)}," è¿›å…¥é˜…è¯» ",8,Ut),e("button",{class:"chapter-action-btn",onClick:V=>J(u.id)}," ç¼–è¾‘ ",8,Ft),e("button",{class:"chapter-action-btn danger",onClick:V=>l(u.id)}," åˆ é™¤ ",8,zt)])],42,xt))),128))])):(a(),i("div",Nt,[...t[19]||(t[19]=[e("p",null,"æš‚æ— ç« èŠ‚ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»º",-1)])]))])])):A("",!0)])])]),(a(),P(ce,{to:"body"},[h.value?(a(),i("div",Ot,[e("div",{class:"modal-overlay",onClick:t[2]||(t[2]=u=>h.value=!1)}),e("div",Pt,[e("div",Kt,[e("h2",null,_(y.value?"ç¼–è¾‘ç« èŠ‚":"æ–°å»ºç« èŠ‚"),1),e("button",{class:"modal-close",onClick:t[3]||(t[3]=u=>h.value=!1)},"Ã—")]),e("div",Qt,[e("div",jt,[t[20]||(t[20]=e("label",{for:"chapterTitleInput"},[oe("ç« èŠ‚åç§° "),e("span",{class:"required"},"*")],-1)),G(e("input",{id:"chapterTitleInput","onUpdate:modelValue":t[4]||(t[4]=u=>b.value=u),type:"text",placeholder:"ä¾‹å¦‚ï¼šç¬¬1è¯ã€åºç« ",onKeypress:ae(m,["enter"])},null,544),[[W,b.value]])])]),e("div",Gt,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[5]||(t[5]=u=>h.value=!1)},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-primary",onClick:m},"ä¿å­˜")])])])):A("",!0)])),(a(),P(ce,{to:"body"},[o.value?(a(),i("div",Wt,[e("div",{class:"modal-overlay",onClick:pe}),e("div",Ht,[e("div",{class:"modal-header"},[t[21]||(t[21]=e("h2",null,"å¿«é€Ÿæ·»åŠ æ ‡ç­¾",-1)),e("button",{class:"modal-close",onClick:pe},"Ã—")]),e("div",Jt,[e("div",Xt,[G(e("input",{ref_key:"quickTagInputRef",ref:$,"onUpdate:modelValue":t[6]||(t[6]=u=>I.value=u),type:"text",class:"quick-tag-input",placeholder:"è¾“å…¥æ ‡ç­¾åç§°è¿›è¡Œæœç´¢æˆ–åˆ›å»º...",onKeypress:ae(Be,["enter"])},null,544),[[W,I.value]])]),e("div",Yt,[(a(!0),i(K,null,j(O.value,u=>(a(),i("div",{key:u.id||u.name,class:"quick-tag-item",onClick:U=>ge(u.name)},[e("span",{class:"tag-color-dot",style:se({background:u.color||"#667eea"})},null,4),e("span",eo,_(u.name),1),t[22]||(t[22]=e("span",{class:"tag-add-icon"},"+",-1))],8,Zt))),128)),Z.value?(a(),i("div",{key:0,class:"quick-tag-item new-tag",onClick:t[7]||(t[7]=u=>ge(I.value.trim()))},[t[23]||(t[23]=e("span",{class:"tag-icon"},"+",-1)),e("span",null,'åˆ›å»ºå¹¶æ·»åŠ  "'+_(I.value.trim())+'"',1)])):A("",!0),O.value.length===0&&!Z.value?(a(),i("p",to,_(I.value?"æœªæ‰¾åˆ°åŒ¹é…çš„æ ‡ç­¾":"æ‰€æœ‰æ ‡ç­¾å·²æ·»åŠ æˆ–æš‚æ— æ ‡ç­¾"),1)):A("",!0)])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary",onClick:pe},"å…³é—­")])])])):A("",!0)])),(a(),P(ce,{to:"body"},[f.value?(a(),i("div",oo,[e("div",{class:"modal-overlay",onClick:t[8]||(t[8]=u=>f.value=!1)}),e("div",so,[e("div",ao,[t[24]||(t[24]=e("h2",null,"ç¡®è®¤åˆ é™¤",-1)),e("button",{class:"modal-close",onClick:t[9]||(t[9]=u=>f.value=!1)},"Ã—")]),e("div",no,[e("p",null,_(D.value==="book"?"ç¡®å®šè¦åˆ é™¤è¿™æœ¬ä¹¦ç±å—ï¼Ÿæ‰€æœ‰ç« èŠ‚æ•°æ®å°†ä¸€å¹¶åˆ é™¤ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚":"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç« èŠ‚å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"),1)]),e("div",lo,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=u=>f.value=!1)},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-danger",onClick:z},"åˆ é™¤")])])])):A("",!0)]))],64))}}),io=X(ro,[["__scopeId","data-v-fad511a8"]]),co={class:"tag-manage-form"},uo={class:"form-row"},vo={class:"tag-list"},fo={key:0,class:"empty-hint"},mo={key:0,class:"tag-view-mode"},po={class:"tag-name"},go={class:"tag-book-count"},ko=["onClick"],bo=["onClick"],ho={key:1,class:"tag-edit-mode"},yo=Y({__name:"TagManageModal",emits:["close"],setup(w,{emit:F}){const c=F,C=ne(),d=k(""),h=k("#667eea"),y=k(null),b=k(""),f=k(""),D=R(()=>C.tags);async function x(){const E=d.value.trim();if(!E){n("è¯·è¾“å…¥æ ‡ç­¾åç§°","warning");return}if(D.value.some(T=>T.name===E)){n("æ ‡ç­¾å·²å­˜åœ¨","warning");return}try{await C.createTag(E,h.value),n("æ ‡ç­¾åˆ›å»ºæˆåŠŸ","success"),d.value="",h.value="#667eea"}catch{n("åˆ›å»ºå¤±è´¥","error")}}function s(E){y.value=E.name,b.value=E.name,f.value=E.color||"#667eea"}function p(){y.value=null,b.value="",f.value=""}async function B(){if(!y.value)return;const E=b.value.trim();if(!E){n("æ ‡ç­¾åç§°ä¸èƒ½ä¸ºç©º","warning");return}const T=y.value;if(E!==T&&D.value.some(M=>M.name===E)){n("æ ‡ç­¾åç§°å·²å­˜åœ¨","warning");return}try{await C.updateTagApi(T,E,f.value)?(n("æ ‡ç­¾æ›´æ–°æˆåŠŸ","success"),p()):n("æ›´æ–°å¤±è´¥","error")}catch(M){n("æ›´æ–°å¤±è´¥","error"),console.error("æ›´æ–°æ ‡ç­¾å¤±è´¥:",M)}}async function S(E){try{await C.deleteTagApi(E)?n("æ ‡ç­¾å·²åˆ é™¤","success"):n("åˆ é™¤å¤±è´¥","error")}catch{n("åˆ é™¤å¤±è´¥","error")}}return(E,T)=>(a(),P($e,{title:"æ ‡ç­¾ç®¡ç†",onClose:T[5]||(T[5]=M=>c("close"))},{footer:re(()=>[e("button",{class:"btn btn-secondary",onClick:T[4]||(T[4]=M=>c("close"))},"å…³é—­")]),default:re(()=>[e("div",co,[e("div",uo,[G(e("input",{"onUpdate:modelValue":T[0]||(T[0]=M=>d.value=M),type:"text",placeholder:"è¾“å…¥æ–°æ ‡ç­¾åç§°...",onKeypress:ae(x,["enter"])},null,544),[[W,d.value]]),G(e("input",{"onUpdate:modelValue":T[1]||(T[1]=M=>h.value=M),type:"color",title:"é€‰æ‹©é¢œè‰²"},null,512),[[W,h.value]]),e("button",{class:"btn btn-primary btn-sm",onClick:x},"æ·»åŠ ")])]),e("div",vo,[D.value.length===0?(a(),i("div",fo," æš‚æ— æ ‡ç­¾ï¼Œè¯·åœ¨ä¸Šæ–¹æ·»åŠ  ")):A("",!0),(a(!0),i(K,null,j(D.value,M=>(a(),i("div",{key:M.name,class:"tag-manage-item"},[y.value!==M.name?(a(),i("div",mo,[e("span",{class:"tag-color-dot",style:se({backgroundColor:M.color||"#667eea"})},null,4),e("span",po,_(M.name),1),e("span",go,_(M.book_count||0)+" æœ¬",1),e("button",{class:"tag-edit-btn",onClick:z=>s(M)}," ç¼–è¾‘ ",8,ko),e("button",{class:"tag-delete-btn",onClick:z=>S(M.name)}," åˆ é™¤ ",8,bo)])):A("",!0),y.value===M.name?(a(),i("div",ho,[G(e("input",{"onUpdate:modelValue":T[2]||(T[2]=z=>f.value=z),type:"color",class:"edit-color-input",title:"é€‰æ‹©é¢œè‰²"},null,512),[[W,f.value]]),G(e("input",{"onUpdate:modelValue":T[3]||(T[3]=z=>b.value=z),type:"text",class:"edit-name-input",placeholder:"æ ‡ç­¾åç§°",onKeypress:ae(B,["enter"])},null,544),[[W,b.value]]),e("button",{class:"tag-save-btn",onClick:B}," ä¿å­˜ "),e("button",{class:"tag-cancel-btn",onClick:p}," å–æ¶ˆ ")])):A("",!0)]))),128))])]),_:1}))}}),_o=X(yo,[["__scopeId","data-v-20ab6eb1"]]),Co={class:"modal-content confirm-modal-content"},To={class:"modal-header"},$o={class:"modal-title"},wo={class:"modal-body confirm-modal-body"},Bo={class:"confirm-message"},Mo={class:"modal-footer confirm-modal-footer"},Do=Y({__name:"ConfirmModal",props:{message:{},title:{default:"ç¡®è®¤æ“ä½œ"},confirmText:{default:"ç¡®å®š"},cancelText:{default:"å–æ¶ˆ"},confirmType:{default:"primary"}},emits:["confirm","cancel"],setup(w,{emit:F}){const c=F,C=k(null);function d(){c("confirm")}function h(){c("cancel")}function y(f){f.target===f.currentTarget&&c("cancel")}function b(f){f.key==="Escape"?c("cancel"):f.key==="Enter"&&c("confirm")}return ye(()=>{document.addEventListener("keydown",b),C.value?.focus()}),Te(()=>{document.removeEventListener("keydown",b)}),(f,D)=>(a(),i("div",{ref_key:"modalRef",ref:C,class:"modal-overlay confirm-modal-overlay",tabindex:"-1",onClick:y},[e("div",Co,[e("div",To,[e("h3",$o,_(w.title),1),e("button",{class:"modal-close-btn",onClick:h,title:"å…³é—­"},"Ã—")]),e("div",wo,[e("p",Bo,_(w.message),1)]),e("div",Mo,[e("button",{class:"btn btn-secondary",onClick:h},_(w.cancelText),1),e("button",{class:ie(["btn",w.confirmType==="danger"?"btn-danger":"btn-primary"]),onClick:d},_(w.confirmText),3)])])],512))}}),Eo=X(Do,[["__scopeId","data-v-f6f7303a"]]),Io={class:"bookshelf-page"},xo={class:"app-header"},Ao={class:"header-content"},So={class:"logo-container"},Lo={class:"header-links"},Ro={class:"lan-access-info",title:"å…¶ä»–è®¾å¤‡å¯é€šè¿‡æ­¤åœ°å€è®¿é—®"},Vo={id:"lanUrl"},qo={class:"bookshelf-main"},Uo={key:0,class:"batch-toolbar"},Fo={class:"batch-info"},zo=["checked"],No={class:"books-container"},Oo={key:0,class:"books-grid"},Po={key:1,class:"empty-state"},Ko={key:2,class:"empty-state"},Qo={key:0,class:"modal active"},jo={class:"modal-content modal-small"},Go={class:"modal-header"},Wo={class:"modal-body"},Ho={class:"batch-tag-hint"},Jo={key:0,class:"tag-select-list"},Xo=["onClick"],Yo={class:"tag-name"},Zo={key:0,class:"tag-check"},es={key:1,class:"empty-state-small"},ts={class:"modal-footer"},os=["disabled"],ss=Y({__name:"BookshelfView",setup(w){const F=Ce(),c=ne(),C=k("è·å–ä¸­..."),d=k(!1),h=k(!1),y=k(!1),b=k(!1),f=k(null),D=k(""),x=k(null),s=R(()=>c.filteredBooks),p=R(()=>c.tags),B=R(()=>c.selectedBooks),S=R(()=>c.batchMode),E=R(()=>s.value.length===0&&!c.searchQuery);function T(v){v.persisted&&(console.log("[BookshelfView] é¡µé¢ä» BFCache æ¢å¤ï¼Œåˆ·æ–°æ•°æ®"),c.loadBooks(),c.loadTags(),h.value&&c.currentBook&&J(c.currentBook.id))}ye(async()=>{await Promise.all([c.loadBooks(),c.loadTags()]);try{const v=await xe();v.success&&v.lan_url&&(C.value=v.lan_url)}catch(v){console.error("è·å–æœåŠ¡å™¨ä¿¡æ¯å¤±è´¥:",v),C.value="è·å–å¤±è´¥"}window.addEventListener("pageshow",T)}),Te(()=>{window.removeEventListener("pageshow",T)});async function M(){try{await navigator.clipboard.writeText(C.value),n("å±€åŸŸç½‘åœ°å€å·²å¤åˆ¶ï¼","success")}catch{const v=document.createElement("textarea");v.value=C.value,document.body.appendChild(v),v.select(),document.execCommand("copy"),document.body.removeChild(v),n("å±€åŸŸç½‘åœ°å€å·²å¤åˆ¶ï¼","success")}}function z(){f.value=null,d.value=!0}function H(v){f.value=v,d.value=!0}async function J(v){try{const o=await fetch(`/api/bookshelf/books/${v}`);if(!o.ok)throw new Error(`HTTP ${o.status}`);const I=await o.json();if(!I.success)throw new Error(I.error||"åŠ è½½å¤±è´¥");I.book&&c.updateBook(v,I.book),c.setCurrentBook(v),h.value=!0}catch(o){const I=o instanceof Error?o.message:"æœªçŸ¥é”™è¯¯";console.error("åŠ è½½ä¹¦ç±è¯¦æƒ…å¤±è´¥:",o),n(`åŠ è½½ä¹¦ç±è¯¦æƒ…å¤±è´¥: ${I}`,"error")}}function m(){y.value=!0}function l(){c.exitBatchMode()}function g(){B.value.size===s.value.length?c.clearSelection():s.value.forEach(v=>{c.selectBook(v.id)})}function N(){if(B.value.size===0){n("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„ä¹¦ç±","warning");return}D.value=`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${B.value.size} æœ¬ä¹¦ç±å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,x.value=async()=>{try{const v=await c.batchDeleteBooksApi(Array.from(B.value));v>=0?(n(`æˆåŠŸåˆ é™¤ ${v} æœ¬ä¹¦ç±`,"success"),l(),await c.loadBooks(),await c.loadTags()):n("åˆ é™¤å¤±è´¥","error")}catch{n("åˆ é™¤å¤±è´¥","error")}},b.value=!0}function le(){F.push("/translate")}function ue(){n("ğŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}const Q=k(!1),q=k("add"),L=k([]);function de(){if(B.value.size===0){n("è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„ä¹¦ç±","warning");return}q.value="add",L.value=[],Q.value=!0}function ve(){if(B.value.size===0){n("è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„ä¹¦ç±","warning");return}q.value="remove",L.value=[],Q.value=!0}function fe(v){const o=L.value.indexOf(v);o>=0?L.value.splice(o,1):L.value.push(v)}async function me(){if(L.value.length===0){n("è¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªæ ‡ç­¾","warning");return}const v=Array.from(B.value);try{const{batchAddTags:o,batchRemoveTags:I}=await he(async()=>{const{batchAddTags:$,batchRemoveTags:O}=await import("./bookshelf.CDzdK045.js");return{batchAddTags:$,batchRemoveTags:O}},__vite__mapDeps([0,1,2]));if(q.value==="add")if((await o(v,L.value)).success){for(const O of v)for(const Z of L.value)c.addTagToBook(O,Z);n(`å·²ä¸º ${v.length} æœ¬ä¹¦æ·»åŠ æ ‡ç­¾`,"success")}else n("æ·»åŠ æ ‡ç­¾å¤±è´¥","error");else if((await I(v,L.value)).success){for(const O of v)for(const Z of L.value)c.removeTagFromBook(O,Z);n(`å·²ä» ${v.length} æœ¬ä¹¦ç§»é™¤æ ‡ç­¾`,"success")}else n("ç§»é™¤æ ‡ç­¾å¤±è´¥","error");Q.value=!1,l()}catch(o){n("æ“ä½œå¤±è´¥","error"),console.error("æ‰¹é‡æ ‡ç­¾æ“ä½œå¤±è´¥:",o)}}return(v,o)=>{const I=Ie("router-link");return a(),i("div",Io,[e("header",xo,[e("div",Ao,[e("div",So,[_e(I,{to:"/",title:"ä¹¦æ¶é¦–é¡µ"},{default:re(()=>[...o[9]||(o[9]=[e("img",{src:De,alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",Lo,[e("span",Ro,[o[10]||(o[10]=e("span",{class:"lan-icon"},"ğŸŒå±€åŸŸç½‘è®¾å¤‡å¯é€šè¿‡è¯¥ç½‘å€è®¿é—®",-1)),e("span",Vo,_(C.value),1),e("button",{class:"copy-btn",title:"å¤åˆ¶åœ°å€",onClick:M},"ğŸ“‹")]),o[12]||(o[12]=e("a",{href:"http://www.mashirosaber.top",target:"_blank",class:"tutorial-link"},"ä½¿ç”¨æ•™ç¨‹",-1)),o[13]||(o[13]=e("a",{href:"https://github.com/MashiroSaber03/Saber-Translator",target:"_blank",class:"github-link"},[e("img",{src:Se,alt:"GitHub",class:"github-icon"})],-1)),e("button",{class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:ue},[...o[11]||(o[11]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("main",qo,[e("div",{class:"bookshelf-toolbar"},[o[17]||(o[17]=e("h1",{class:"page-title"},"æˆ‘çš„ä¹¦æ¶",-1)),e("div",{class:"toolbar-actions"},[e("button",{class:"btn btn-primary",onClick:z},[...o[14]||(o[14]=[e("span",{class:"btn-icon"},"+",-1),e("span",null,"æ–°å»ºä¹¦ç±",-1)])]),e("button",{class:"btn btn-secondary",onClick:m},[...o[15]||(o[15]=[e("span",null,"ğŸ·ï¸ ç®¡ç†æ ‡ç­¾",-1)])]),e("button",{class:"btn btn-secondary",onClick:le},[...o[16]||(o[16]=[e("span",null,"å¿«é€Ÿç¿»è¯‘",-1)])])])]),_e(Je,{tags:p.value,onSearch:be(c).setSearchQuery,onFilterTag:be(c).toggleTagFilter},null,8,["tags","onSearch","onFilterTag"]),S.value?(a(),i("div",Uo,[e("div",Fo,[e("input",{type:"checkbox",checked:B.value.size===s.value.length&&s.value.length>0,onChange:g},null,40,zo),e("span",null,_(B.value.size),1),o[18]||(o[18]=oe(" æœ¬å·²é€‰ä¸­ ",-1))]),e("div",{class:"batch-actions"},[e("button",{class:"btn btn-sm btn-secondary",onClick:de},"ğŸ·ï¸ æ·»åŠ æ ‡ç­¾"),e("button",{class:"btn btn-sm btn-secondary",onClick:ve},"â– ç§»é™¤æ ‡ç­¾"),e("button",{class:"btn btn-sm btn-danger",onClick:N},"ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤"),e("button",{class:"btn btn-sm btn-secondary",onClick:l},"å–æ¶ˆ")])])):A("",!0),e("div",No,[s.value.length>0?(a(),i("div",Oo,[(a(!0),i(K,null,j(s.value,$=>(a(),P(Pe,{key:$.id,book:$,selected:B.value.has($.id),"batch-mode":S.value,onClick:O=>J($.id),onEdit:O=>H($.id),onSelect:O=>be(c).toggleBookSelection($.id)},null,8,["book","selected","batch-mode","onClick","onEdit","onSelect"]))),128))])):E.value?(a(),i("div",Po,[o[20]||(o[20]=e("div",{class:"empty-icon"},"ğŸ“š",-1)),o[21]||(o[21]=e("h2",null,"ä¹¦æ¶ç©ºç©ºå¦‚ä¹Ÿ",-1)),o[22]||(o[22]=e("p",null,'ç‚¹å‡»"æ–°å»ºä¹¦ç±"å¼€å§‹ä½ çš„ç¿»è¯‘ä¹‹æ—…',-1)),e("button",{class:"btn btn-primary",onClick:z},[...o[19]||(o[19]=[e("span",{class:"btn-icon"},"+",-1),e("span",null,"æ–°å»ºç¬¬ä¸€æœ¬ä¹¦",-1)])])])):(a(),i("div",Ko,[...o[23]||(o[23]=[e("div",{class:"empty-icon"},"ğŸ”",-1),e("h2",null,"æœªæ‰¾åˆ°åŒ¹é…çš„ä¹¦ç±",-1),e("p",null,"å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–æ ‡ç­¾ç­›é€‰",-1)])]))])]),d.value?(a(),P(dt,{key:0,"book-id":f.value,onClose:o[0]||(o[0]=$=>d.value=!1),onSaved:o[1]||(o[1]=$=>d.value=!1)},null,8,["book-id"])):A("",!0),h.value?(a(),P(io,{key:1,onClose:o[2]||(o[2]=$=>h.value=!1),onEdit:H})):A("",!0),y.value?(a(),P(_o,{key:2,onClose:o[3]||(o[3]=$=>y.value=!1)})):A("",!0),b.value?(a(),P(Eo,{key:3,message:D.value,onConfirm:o[4]||(o[4]=$=>{x.value?.(),b.value=!1}),onCancel:o[5]||(o[5]=$=>b.value=!1)},null,8,["message"])):A("",!0),(a(),P(ce,{to:"body"},[Q.value?(a(),i("div",Qo,[e("div",{class:"modal-overlay",onClick:o[6]||(o[6]=$=>Q.value=!1)}),e("div",jo,[e("div",Go,[e("h2",null,_(q.value==="add"?"æ‰¹é‡æ·»åŠ æ ‡ç­¾":"æ‰¹é‡ç§»é™¤æ ‡ç­¾"),1),e("button",{class:"modal-close",onClick:o[7]||(o[7]=$=>Q.value=!1)},"Ã—")]),e("div",Wo,[e("p",Ho,_(q.value==="add"?"é€‰æ‹©è¦æ·»åŠ åˆ°é€‰ä¸­ä¹¦ç±çš„æ ‡ç­¾ï¼š":"é€‰æ‹©è¦ä»é€‰ä¸­ä¹¦ç±ç§»é™¤çš„æ ‡ç­¾ï¼š"),1),p.value.length>0?(a(),i("div",Jo,[(a(!0),i(K,null,j(p.value,$=>(a(),i("div",{key:$.id,class:ie(["tag-select-item",{selected:L.value.includes($.name)}]),onClick:O=>fe($.name)},[e("span",{class:"tag-color",style:se({background:$.color||"#667eea"})},null,4),e("span",Yo,_($.name),1),L.value.includes($.name)?(a(),i("span",Zo,"âœ“")):A("",!0)],10,Xo))),128))])):(a(),i("div",es,[...o[24]||(o[24]=[e("p",null,'æš‚æ— æ ‡ç­¾ï¼Œè¯·å…ˆåœ¨"ç®¡ç†æ ‡ç­¾"ä¸­åˆ›å»º',-1)])]))]),e("div",ts,[e("button",{type:"button",class:"btn btn-secondary",onClick:o[8]||(o[8]=$=>Q.value=!1)},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-primary",disabled:L.value.length===0,onClick:me}," ç¡®å®š ",8,os)])])])):A("",!0)]))])}}}),vs=X(ss,[["__scopeId","data-v-858efc56"]]);export{vs as default};
