const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/system.CZEHfbsz.js","js/index.BH6DVBCX.js","js/vue-vendor.nHHJLq3r.js","assets/index.BYanE9pL.css","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js","js/session.Kpy-QhBa.js"])))=>i.map(i=>d[i]);
import{D as Go,b as ao,c as lo,d as io,e as Xo,a as nt,S as Po,_ as qe,f as Je,s as fe,u as rt,g as Ln,h as Un,i as On,j as zn,k as Ao,l as Fo,B as Lo,m as Uo,n as Nn,F as Xt,o as Oo,p as zo,q as Vn,L as No,W as Wn}from"./index.BH6DVBCX.js";import{d as At,r as S,c as Q,a as He,e as K,h as ge,f as e,t as le,i as st,k as L,g as at,n as Me,u as Ce,o as ut,v as se,x as Fe,l as he,s as Vo,m as ht,K as Qe,D as X,F as Ke,j as je,L as Zo,w as ye,B as ct,M as kt,z as we,N as Kn,p as Ze,O as eo,b as Tt,P as yt,Q as Wo,A as qn,S as Hn,T as Jn,C as jn}from"./vue-vendor.nHHJLq3r.js";import{p as Yn,a as Gn,b as Xn,c as Zn,d as Qn,e as es,f as ts,h as os,i as ns,j as ss,k as ro,l as Qo}from"./system.CZEHfbsz.js";import{getFontList as en,uploadFont as as,getTextboxPrompts as ls,getPrompts as is,configApi as Ne,getFontListApi as rs}from"./config.CwRcCkM9.js";import{_ as Oe}from"./CustomSelect.vue_vue_type_style_index_0_lang.DGaYiHlK.js";import{apiClient as ot}from"./client.Bht704G-.js";import{B as tn}from"./BaseModal.DLkAykgX.js";import{getBookDetail as us}from"./bookshelf.B4ums9uK.js";import"./utils-vendor.B9ygI19o.js";function Ko(){return{firecrawl:{apiKey:""},agent:{provider:"openai",apiKey:"",customBaseUrl:"",modelName:"gpt-4o-mini",useStream:!1,forceJsonOutput:!0,maxRetries:3,timeout:120},extraction:{prompt:Go,maxIterations:10},download:{concurrency:3,timeout:30,retries:3,delay:100,useReferer:!0},imagePreprocess:{enabled:!1,autoRotate:!0,compression:{enabled:!1,quality:85,maxWidth:0,maxHeight:0},formatConvert:{enabled:!1,targetFormat:"original"}},advanced:{customCookie:"",customHeaders:"",bypassProxy:!1},ui:{showAgentLogs:!0,autoImport:!1}}}function cs(n,t){function p(a){n.value.firecrawl.apiKey=a,t()}function o(a){n.value.agent.provider=a,t()}function l(a){n.value.agent.apiKey=a,t()}function c(a){n.value.agent.customBaseUrl=a,t()}function s(a){n.value.agent.modelName=a,t()}function i(a){n.value.agent.useStream=a,t()}function k(a){n.value.agent.forceJsonOutput=a,t()}function P(a){n.value.agent.timeout=a,t()}function w(a){n.value.extraction.prompt=a,t()}function O(a){n.value.extraction.maxIterations=a,t()}function Y(){n.value.extraction.prompt=Go,t()}function J(a){n.value.download.concurrency=a,t()}function R(a){n.value.download.timeout=a,t()}function f(a){n.value.download.retries=a,t()}function I(a){n.value.download.delay=a,t()}function T(a){n.value.download.useReferer=a,t()}function M(a){n.value.imagePreprocess.enabled=a,t()}function g(a){n.value.imagePreprocess.autoRotate=a,t()}function d(a){n.value.imagePreprocess.compression.enabled=a,t()}function y(a){n.value.imagePreprocess.compression.quality=a,t()}function v(a){n.value.imagePreprocess.compression.maxWidth=a,t()}function C(a){n.value.imagePreprocess.compression.maxHeight=a,t()}function E(a){n.value.imagePreprocess.formatConvert.enabled=a,t()}function q(a){n.value.imagePreprocess.formatConvert.targetFormat=a,t()}function B(a){n.value.advanced.customCookie=a,t()}function H(a){n.value.advanced.customHeaders=a,t()}function V(a){n.value.advanced.bypassProxy=a,t()}function x(a){n.value.ui.showAgentLogs=a,t()}function b(a){n.value.ui.autoImport=a,t()}function $(a){n.value={...n.value,...a},t()}return{setFirecrawlApiKey:p,setAgentProvider:o,setAgentApiKey:l,setAgentBaseUrl:c,setAgentModelName:s,setAgentUseStream:i,setAgentForceJson:k,setAgentTimeout:P,setExtractionPrompt:w,setExtractionMaxIterations:O,resetExtractionPrompt:Y,setDownloadConcurrency:J,setDownloadTimeout:R,setDownloadRetries:f,setDownloadDelay:I,setDownloadUseReferer:T,setImagePreprocessEnabled:M,setImageAutoRotate:g,setImageCompressionEnabled:d,setImageCompressionQuality:y,setImageMaxWidth:v,setImageMaxHeight:C,setImageFormatConvertEnabled:E,setImageTargetFormat:q,setCustomCookie:B,setCustomHeaders:H,setBypassProxy:V,setShowAgentLogs:x,setAutoImport:b,updateWebImportSettings:$}}async function Et(n){return ot.post("/api/translate_image",n)}async function uo(n){return ot.post("/api/re_render_image",n)}async function ds(n){try{return{success:!0,data:await ot.post("/api/translate_single_text",n)}}catch(t){return{success:!1,error:t instanceof Error?t.message:"ç¿»è¯‘å¤±è´¥"}}}async function co(n){return ot.post("/api/hq_translate_batch",n)}async function to(n,t,p){return ot.post("/api/detect_boxes",{image:n,detector_type:t,...p})}async function on(n,t,p,o){return ot.post("/api/ocr_single_bubble",{image_data:n,bubble_coords:t,ocr_engine:p,...o})}async function go(n,t,p){return ot.post("/api/inpaint_single_bubble",{image_data:n,bubble_coords:t,bubble_angle:p?.bubbleAngle??0,method:p?.method??"lama",lama_model:p?.lamaModel??"lama_mpe",...p?.maskData&&{mask_data:p.maskData}})}const gs=Object.freeze(Object.defineProperty({__proto__:null,detectBoxes:to,hqTranslateBatch:co,inpaintSingleBubble:go,ocrSingleBubble:on,reRenderImage:uo,translateImage:Et,translateSingleText:ds},Symbol.toStringTag,{value:"Module"}));async function ps(){return ot.get("/api/plugins")}async function vs(n){const t=encodeURIComponent(n);return ot.post(`/api/plugins/${t}/enable`)}async function ms(n){const t=encodeURIComponent(n);return ot.post(`/api/plugins/${t}/disable`)}async function bs(n){const t=encodeURIComponent(n);return ot.delete(`/api/plugins/${t}`)}async function fs(n){const t=encodeURIComponent(n);return ot.get(`/api/plugins/${t}/config_schema`)}async function hs(n){const t=encodeURIComponent(n);return ot.get(`/api/plugins/${t}/config`)}async function ys(n,t){const p=encodeURIComponent(n);return ot.post(`/api/plugins/${p}/config`,t)}async function xs(){return ot.get("/api/plugins/default_states")}async function ks(n,t){const p=encodeURIComponent(n);return ot.post(`/api/plugins/${p}/set_default_state`,{enabled:t})}async function _s(){return{states:(await xs()).default_states}}const Ss=ks,Cs=fs,ws=hs,$s=ys;function Is(){return`img_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function qo(n,t,p){return{id:Is(),fileName:n,originalDataURL:t,translatedDataURL:null,cleanImageData:null,bubbleStates:null,translationStatus:"pending",translationFailed:!1,fontSize:25,autoFontSize:!0,fontFamily:"fonts/STSONG.TTF",layoutDirection:"vertical",textColor:"#000000",fillColor:Xo,inpaintMethod:"solid",strokeEnabled:io,strokeColor:lo,strokeWidth:ao,hasUnsavedChanges:!1,...p}}const et=At("image",()=>{const n=S([]),t=S(-1),p=S(!1),o=Q(()=>t.value>=0&&t.value<n.value.length?n.value[t.value]??null:null),l=Q(()=>n.value.length),c=Q(()=>n.value.length>0),s=Q(()=>t.value>0),i=Q(()=>t.value<n.value.length-1),k=Q(()=>n.value.filter(a=>a.translationFailed).length),P=Q(()=>n.value.filter(a=>a.translationStatus==="completed").length),w=Q(()=>n.value.filter(a=>a.translationStatus==="pending").length);function O(a,u,h){const W=qo(a,u,h);return n.value.push(W),n.value.length===1&&(t.value=0),console.log(`å›¾ç‰‡å·²æ·»åŠ : ${a}ï¼Œå½“å‰å…± ${n.value.length} å¼ å›¾ç‰‡`),W}function Y(a){const u=a.map(({fileName:W,originalDataURL:A,overrides:U})=>qo(W,A,U)),h=n.value.length===0;return n.value.push(...u),h&&n.value.length>0&&(t.value=0),console.log(`æ‰¹é‡æ·»åŠ äº† ${u.length} å¼ å›¾ç‰‡ï¼Œå½“å‰å…± ${n.value.length} å¼ `),u}function J(a){n.value=a.map(u=>({...u,strokeEnabled:u.strokeEnabled??io,strokeColor:u.strokeColor||lo,strokeWidth:u.strokeWidth??ao,hasUnsavedChanges:u.hasUnsavedChanges||!1})),n.value.length>0?t.value=Math.min(Math.max(0,t.value),n.value.length-1):t.value=-1,console.log(`å›¾ç‰‡æ•°ç»„å·²è®¾ç½®ï¼Œå…± ${n.value.length} å¼ å›¾ç‰‡`)}function R(a){return a<0||a>=n.value.length?(console.warn(`åˆ é™¤å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${a}`),!1):(n.value.splice(a,1),t.value===a?(t.value=Math.min(a,n.value.length-1),n.value.length===0&&(t.value=-1)):t.value>a&&t.value--,console.log(`å›¾ç‰‡å·²åˆ é™¤ï¼Œå½“å‰å…± ${n.value.length} å¼ å›¾ç‰‡`),!0)}function f(){return R(t.value)}function I(){n.value=[],t.value=-1,p.value=!1,console.log("æ‰€æœ‰å›¾ç‰‡å·²æ¸…é™¤")}function T(){const a=o.value?.id||null;if(n.value.sort((u,h)=>u.fileName.localeCompare(h.fileName,void 0,{numeric:!0,sensitivity:"base"})),a){const u=n.value.findIndex(h=>h.id===a);u>=0&&u!==t.value&&(console.log(`å›¾ç‰‡æ’åº: currentImageIndex ä» ${t.value} æ›´æ–°ä¸º ${u}`),t.value=u)}console.log("å›¾ç‰‡å·²æŒ‰æ–‡ä»¶åæ’åº")}function M(a){a>=-1&&a<n.value.length?(t.value=a,console.log(`å½“å‰å›¾ç‰‡ç´¢å¼•å·²è®¾ç½®ä¸º ${a}`)):console.warn(`è®¾ç½®ç´¢å¼•å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${a}`)}function g(){return s.value?(t.value--,!0):!1}function d(){return i.value?(t.value++,!0):!1}function y(a){o.value?(Object.assign(o.value,a),console.log("å½“å‰å›¾ç‰‡å±æ€§å·²æ›´æ–°:",Object.keys(a))):console.warn("æ›´æ–°å¤±è´¥: å½“å‰æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡")}function v(a,u){if(a>=0&&a<n.value.length){const h=n.value[a];h&&(Object.assign(h,u),console.log(`å›¾ç‰‡ ${a} å±æ€§å·²æ›´æ–°:`,Object.keys(u)))}else console.warn(`æ›´æ–°å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${a}`)}function C(a){o.value&&(o.value.bubbleStates=a,o.value.hasUnsavedChanges=!0,console.log(`å½“å‰å›¾ç‰‡æ°”æ³¡çŠ¶æ€å·²æ›´æ–°ï¼Œå…± ${a?.length??0} ä¸ªæ°”æ³¡`))}function E(a){o.value&&(o.value.isManuallyAnnotated=a,o.value.hasUnsavedChanges=!0,console.log(`æ‰‹åŠ¨æ ‡æ³¨æ ‡è®°å·²è®¾ç½®ä¸º: ${a}`))}function q(a,u){o.value?(o.value[a]=u,o.value.hasUnsavedChanges=!0,console.log(`å½“å‰å›¾ç‰‡å±æ€§ ${String(a)} å·²æ›´æ–°`)):console.warn("æ›´æ–°å¤±è´¥: å½“å‰æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡")}function B(a,u){o.value&&(o.value.translatedDataURL=a,u&&(o.value.cleanImageData=u),o.value.translationStatus="completed",o.value.translationFailed=!1,o.value.hasUnsavedChanges=!0,console.log("å½“å‰å›¾ç‰‡ç¿»è¯‘ç»“æœå·²æ›´æ–°"))}function H(a,u,h){if(a>=0&&a<n.value.length){const W=n.value[a];W&&(W.translationStatus=u,W.translationFailed=u==="failed",h&&(W.errorMessage=h),console.log(`å›¾ç‰‡ ${a} ç¿»è¯‘çŠ¶æ€: ${u}`))}}function V(a){o.value&&(o.value.translationStatus="failed",o.value.translationFailed=!0,o.value.errorMessage=a,console.log(`å½“å‰å›¾ç‰‡ç¿»è¯‘å¤±è´¥: ${a}`))}function x(){n.value.forEach(a=>{a.translationStatus="pending",a.translationFailed=!1,a.errorMessage=void 0}),console.log("æ‰€æœ‰å›¾ç‰‡ç¿»è¯‘çŠ¶æ€å·²é‡ç½®")}function b(a){p.value=a,console.log(`æ‰¹é‡ç¿»è¯‘çŠ¶æ€: ${a?"è¿›è¡Œä¸­":"å·²å®Œæˆ"}`)}function $(){return n.value.map((a,u)=>a.translationFailed?u:-1).filter(a=>a!==-1)}return{images:n,currentImageIndex:t,isBatchTranslationInProgress:p,currentImage:o,imageCount:l,hasImages:c,canGoPrevious:s,canGoNext:i,failedImageCount:k,completedImageCount:P,pendingImageCount:w,addImage:O,addImages:Y,setImages:J,deleteImage:R,deleteCurrentImage:f,clearImages:I,sortImagesByFileName:T,setCurrentImageIndex:M,goToPrevious:g,goToNext:d,updateCurrentImage:y,updateImageByIndex:v,updateCurrentBubbleStates:C,setManuallyAnnotated:E,updateCurrentImageProperty:q,updateCurrentTranslationResult:B,setTranslationStatus:H,markCurrentAsFailed:V,resetAllTranslationStatus:x,setBatchTranslationInProgress:b,getFailedImageIndices:$}}),Ho=Object.freeze(Object.defineProperty({__proto__:null,useImageStore:et},Symbol.toStringTag,{value:"Module"})),nn=At("session",()=>{const n=S(null),t=S({bookId:null,chapterId:null,bookTitle:null,chapterTitle:null}),p=S([]),o=S(!1),l=S({current:0,total:0,message:""}),c=S(null),s=S(!1),i=Q(()=>t.value.bookId!==null&&t.value.chapterId!==null),k=Q(()=>t.value.bookId),P=Q(()=>t.value.chapterId);function w(x,b,$=null,a=null){t.value={bookId:x,chapterId:b,bookTitle:$,chapterTitle:a},console.log(`ä¼šè¯ä¸Šä¸‹æ–‡å·²è®¾ç½®: ä¹¦ç±=${x}, ç« èŠ‚=${b}`)}function O(x,b,$,a){w(x,b,$,a)}function Y(){t.value={bookId:null,chapterId:null,bookTitle:null,chapterTitle:null},console.log("ä¼šè¯ä¸Šä¸‹æ–‡å·²æ¸…é™¤")}function J(x){const b=x.get("book"),$=x.get("chapter");b&&$&&w(b,$)}function R(x){n.value=x,console.log(`å½“å‰ä¼šè¯åç§°: ${x}`)}function f(){n.value=null}function I(x){p.value=x,console.log(`ä¼šè¯åˆ—è¡¨å·²æ›´æ–°ï¼Œå…± ${x.length} ä¸ªä¼šè¯`)}function T(x){const b=p.value.findIndex($=>$.name===x.name);b>=0?p.value[b]=x:p.value.unshift(x)}function M(x){const b=p.value.findIndex($=>$.name===x);b>=0&&p.value.splice(b,1)}function g(x,b){const $=p.value.find(a=>a.name===x);$&&($.name=b)}function d(x){o.value=x}function y(x){s.value=x}function v(x){c.value=x}function C(x,b,$,a){return{name:x,version:"2.0",savedAt:new Date().toISOString(),imageCount:b.length,ui_settings:a,images:b.map(u=>({originalDataURL:u.originalDataURL,translatedDataURL:u.translatedDataURL||void 0,cleanImageData:u.cleanImageData||void 0,bubbleStates:u.bubbleStates||void 0,isManuallyAnnotated:u.isManuallyAnnotated||void 0,fileName:u.fileName,fontSize:u.fontSize,autoFontSize:u.autoFontSize,fontFamily:u.fontFamily,layoutDirection:u.layoutDirection,textColor:u.textColor,fillColor:u.fillColor,inpaintMethod:u.inpaintMethod,strokeEnabled:u.strokeEnabled,strokeColor:u.strokeColor,strokeWidth:u.strokeWidth,translationStatus:u.translationStatus,translationFailed:u.translationFailed})),currentImageIndex:$}}function E(){n.value=null,t.value={bookId:null,chapterId:null,bookTitle:null,chapterTitle:null},p.value=[],o.value=!1,s.value=!1,c.value=null,console.log("ä¼šè¯çŠ¶æ€å·²é‡ç½®")}async function q(x){if(!x||typeof x!="string")return null;if(x.startsWith("data:"))return x;if(!x.startsWith("/api/"))return null;try{const b=await fetch(x);if(!b.ok)return null;const $=await b.blob();return new Promise(a=>{const u=new FileReader;u.onloadend=()=>a(u.result),u.onerror=()=>a(null),u.readAsDataURL($)})}catch(b){return console.error(`è½¬æ¢å›¾ç‰‡ URL å¤±è´¥: ${x}`,b),null}}async function B(x,b){const $=x.length;for(let a=0;a<$;a++){const u=x[a];if(u){if(b&&b(a+1,$),u.originalDataURL&&u.originalDataURL.startsWith("/api/")){const h=await q(u.originalDataURL);h&&(u.originalDataURL=h)}if(u.translatedDataURL&&u.translatedDataURL.startsWith("/api/")){const h=await q(u.translatedDataURL);h&&(u.translatedDataURL=h)}if(u.cleanImageData&&u.cleanImageData.startsWith("/api/")){const h=await q(u.cleanImageData);h&&(u.cleanImageData=h.replace(/^data:image\/\w+;base64,/,""))}}}}async function H(x){d(!0),v(null),l.value={current:0,total:0,message:"æ­£åœ¨åŠ è½½..."};try{const{useImageStore:b}=await nt(async()=>{const{useImageStore:m}=await Promise.resolve().then(()=>Ho);return{useImageStore:m}},void 0),{useSettingsStore:$}=await nt(async()=>{const{useSettingsStore:m}=await import("./system.CZEHfbsz.js").then(N=>N.s);return{useSettingsStore:m}},__vite__mapDeps([0,1,2,3,4,5])),{useBubbleStore:a}=await nt(async()=>{const{useBubbleStore:m}=await Promise.resolve().then(()=>xl);return{useBubbleStore:m}},void 0),u=b(),h=$(),W=a(),{loadSessionByPathApi:A}=await nt(async()=>{const{loadSessionByPathApi:m}=await import("./session.Kpy-QhBa.js");return{loadSessionByPathApi:m}},__vite__mapDeps([6,4,5])),U=await A(x);if(!U.success||!U.session)throw new Error(U.error||"åŠ è½½ä¼šè¯å¤±è´¥");const G=U.session;if(G.images&&G.images.length>0){const m=G.images.map((_,re)=>({id:`session-${re}-${Date.now()}`,originalDataURL:_.originalDataURL,translatedDataURL:_.translatedDataURL||null,cleanImageData:_.cleanImageData||null,bubbleStates:_.bubbleStates!==void 0&&_.bubbleStates!==null?_.bubbleStates:null,isManuallyAnnotated:!!_.isManuallyAnnotated,fileName:_.fileName||`image-${re+1}.png`,translationStatus:_.translationStatus||"pending",translationFailed:!!_.translationFailed,hasUnsavedChanges:!1,fontSize:_.fontSize||24,autoFontSize:_.autoFontSize??!0,fontFamily:_.fontFamily||"Microsoft YaHei",layoutDirection:_.layoutDirection||"vertical",textColor:_.textColor||"#000000",fillColor:_.fillColor||"#FFFFFF",inpaintMethod:_.inpaintMethod||"litelama",strokeEnabled:_.strokeEnabled??!1,strokeColor:_.strokeColor||"#FFFFFF",strokeWidth:_.strokeWidth||2}));m.length>0&&(console.log("æ­£åœ¨åŠ è½½å›¾ç‰‡..."),l.value={current:0,total:m.length,message:"æ­£åœ¨åŠ è½½å›¾ç‰‡..."},await B(m,(_,re)=>{const F=_/re*100;l.value={current:_,total:re,message:`åŠ è½½å›¾ç‰‡ ${_}/${re}...`},console.log(`åŠ è½½å›¾ç‰‡ ${_}/${re}... (${F.toFixed(0)}%)`)}),l.value={current:m.length,total:m.length,message:"åŠ è½½å®Œæˆ"},console.log("å›¾ç‰‡åŠ è½½å®Œæˆï¼Œå·²è½¬æ¢ä¸º Base64"),setTimeout(()=>{l.value={current:0,total:0,message:""}},500)),u.setImages(m);let N=0;typeof G.currentImageIndex=="number"&&(N=G.currentImageIndex,(N>=m.length||N<0)&&(N=m.length>0?0:-1)),u.setCurrentImageIndex(N);const r=m[N];r&&r.bubbleStates&&r.bubbleStates.length>0?W.setBubbles(r.bubbleStates,!0):W.clearBubblesLocal(),console.log(`æŒ‰è·¯å¾„åŠ è½½ä¼šè¯æˆåŠŸ: ${x}, å…± ${m.length} å¼ å›¾ç‰‡`)}const D=G.ui_settings;if(D){(D.targetLanguage||D.sourceLanguage)&&h.updateSettings({targetLanguage:D.targetLanguage||void 0,sourceLanguage:D.sourceLanguage||void 0});const m=D.useInpaintingMethod,r=["solid","lama_mpe","litelama"].includes(m)?m:h.settings.textStyle.inpaintMethod;h.updateTextStyle({fontSize:D.fontSize||h.settings.textStyle.fontSize,autoFontSize:D.autoFontSize??h.settings.textStyle.autoFontSize,fontFamily:D.fontFamily||h.settings.textStyle.fontFamily,layoutDirection:D.layoutDirection||h.settings.textStyle.layoutDirection,textColor:D.textColor||h.settings.textStyle.textColor,fillColor:D.fillColor||h.settings.textStyle.fillColor,inpaintMethod:r,strokeEnabled:D.strokeEnabled??h.settings.textStyle.strokeEnabled,strokeColor:D.strokeColor||h.settings.textStyle.strokeColor,strokeWidth:D.strokeWidth||h.settings.textStyle.strokeWidth}),console.log("UI è®¾ç½®å·²æ¢å¤")}return R(x),!0}catch(b){const $=b instanceof Error?b.message:"åŠ è½½ä¼šè¯å¤±è´¥";throw v($),console.error(`æŒ‰è·¯å¾„åŠ è½½ä¼šè¯å¤±è´¥: ${x}`,b),b}finally{d(!1)}}async function V(x,b){if(!x||!b)return console.log("æœªåœ¨ä¹¦ç±/ç« èŠ‚æ¨¡å¼ï¼Œä¸æ”¯æŒä¿å­˜"),!1;console.log(`ä¿å­˜ç« èŠ‚ä¼šè¯ï¼ˆåˆ†æ‰¹ï¼‰: book=${x}, chapter=${b}`);const{useImageStore:$}=await nt(async()=>{const{useImageStore:U}=await Promise.resolve().then(()=>Ho);return{useImageStore:U}},void 0),{useSettingsStore:a}=await nt(async()=>{const{useSettingsStore:U}=await import("./system.CZEHfbsz.js").then(G=>G.s);return{useSettingsStore:U}},__vite__mapDeps([0,1,2,3,4,5])),u=$(),h=a(),W=Array.isArray(u.images)?u.images:[];if(!W||W.length===0)return console.log("æ²¡æœ‰å›¾ç‰‡æ•°æ®å¯ä¿å­˜"),!1;const A=`bookshelf/${x}/${b}`;y(!0),v(null),l.value={current:0,total:100,message:"å‡†å¤‡ä¿å­˜..."};try{const{batchSaveStartApi:U,batchSaveImageApi:G,batchSaveCompleteApi:D}=await nt(async()=>{const{batchSaveStartApi:z,batchSaveImageApi:ne,batchSaveCompleteApi:oe}=await import("./session.Kpy-QhBa.js");return{batchSaveStartApi:z,batchSaveImageApi:ne,batchSaveCompleteApi:oe}},__vite__mapDeps([6,4,5])),m=W.length;W.some(z=>z.originalDataURL&&z.originalDataURL.startsWith("/api/")||z.translatedDataURL&&z.translatedDataURL.startsWith("/api/")||z.cleanImageData&&z.cleanImageData.startsWith("/api/"))&&(console.log("[saveChapterSession] æ£€æµ‹åˆ° /api/ URL æ ¼å¼å›¾ç‰‡ï¼Œå¼€å§‹è½¬æ¢ä¸º Base64..."),l.value={current:2,total:100,message:"è½¬æ¢å›¾ç‰‡æ ¼å¼..."},await B(W,(z,ne)=>{const oe=2+z/ne*3;l.value={current:Math.round(oe),total:100,message:`è½¬æ¢å›¾ç‰‡ ${z}/${ne}...`}}),console.log("[saveChapterSession] å›¾ç‰‡æ ¼å¼è½¬æ¢å®Œæˆ")),l.value={current:5,total:100,message:"æ”¶é›†å…ƒæ•°æ®..."};const{textStyle:r,targetLanguage:_,sourceLanguage:re}=h.settings,F={targetLanguage:_,sourceLanguage:re,fontSize:r.fontSize,autoFontSize:r.autoFontSize,fontFamily:r.fontFamily,layoutDirection:r.layoutDirection,textColor:r.textColor,useInpaintingMethod:r.inpaintMethod,fillColor:r.fillColor,strokeEnabled:r.strokeEnabled,strokeColor:r.strokeColor,strokeWidth:r.strokeWidth},te=W.map(z=>{const ne={};for(const oe of Object.keys(z))oe!=="originalDataURL"&&oe!=="translatedDataURL"&&oe!=="cleanImageData"&&(ne[oe]=z[oe]);return ne.hasOriginalData=!!z.originalDataURL,ne.hasTranslatedData=!!z.translatedDataURL,ne.hasCleanData=!!z.cleanImageData,ne}),de={ui_settings:F,images_meta:te,currentImageIndex:u.currentImageIndex};l.value={current:10,total:100,message:"åˆå§‹åŒ–ä¿å­˜..."};const _e=await U(A,de);if(!_e.success)throw new Error(_e.error||"åˆå§‹åŒ–ä¿å­˜å¤±è´¥");const $e=_e.session_folder;if(!$e)throw new Error("æœªè·å–åˆ°ä¼šè¯æ–‡ä»¶å¤¹è·¯å¾„");console.log(`ä¼šè¯æ–‡ä»¶å¤¹: ${$e}`);let Pe=0,Be=0;const ae=z=>!!z&&typeof z=="string"&&z.startsWith("data:");for(let z=0;z<m;z++){const ne=W[z];if(!ne)continue;const oe=10+z/m*80;if(l.value={current:Math.round(oe),total:100,message:`ä¿å­˜å›¾ç‰‡ ${z+1}/${m}...`},ae(ne.originalDataURL))try{const ue=await G($e,z,"original",ne.originalDataURL);ue.success||(console.error(`ä¿å­˜å›¾ç‰‡ ${z} original å¤±è´¥:`,ue.error),Be++)}catch(ue){console.error(`ä¿å­˜å›¾ç‰‡ ${z} original å‡ºé”™:`,ue),Be++}if(ae(ne.translatedDataURL))try{const ue=await G($e,z,"translated",ne.translatedDataURL);ue.success||(console.error(`ä¿å­˜å›¾ç‰‡ ${z} translated å¤±è´¥:`,ue.error),Be++)}catch(ue){console.error(`ä¿å­˜å›¾ç‰‡ ${z} translated å‡ºé”™:`,ue),Be++}if(ne.cleanImageData&&typeof ne.cleanImageData=="string"&&!ne.cleanImageData.startsWith("/api/"))try{const ue=await G($e,z,"clean",ne.cleanImageData);ue.success||(console.error(`ä¿å­˜å›¾ç‰‡ ${z} clean å¤±è´¥:`,ue.error),Be++)}catch(ue){console.error(`ä¿å­˜å›¾ç‰‡ ${z} clean å‡ºé”™:`,ue),Be++}Pe++}l.value={current:95,total:100,message:"å®Œæˆä¿å­˜..."};const Z=await D($e,te);if(!Z.success)throw new Error(Z.error||"å®Œæˆä¿å­˜å¤±è´¥");return l.value={current:100,total:100,message:"ä¿å­˜å®Œæˆ"},console.log(`åˆ†æ‰¹ä¿å­˜å®Œæˆ: ${Pe} å¼ å›¾ç‰‡, ${Be} ä¸ªå¤±è´¥`),setTimeout(()=>{l.value={current:0,total:0,message:""}},1e3),!0}catch(U){const G=U instanceof Error?U.message:"ä¿å­˜ç« èŠ‚ä¼šè¯å¤±è´¥";return v(G),console.error("åˆ†æ‰¹ä¿å­˜å¤±è´¥:",U),l.value={current:0,total:0,message:""},!1}finally{y(!1)}}return{currentSessionName:n,context:t,sessionList:p,isLoading:o,isSaving:s,error:c,loadingProgress:l,isBookshelfMode:i,currentBookId:k,currentChapterId:P,setContext:w,clearContext:Y,parseContextFromUrl:J,setSessionName:R,clearSessionName:f,setSessionList:I,addToSessionList:T,removeFromSessionList:M,renameInSessionList:g,setLoading:d,setSaving:y,setError:v,createSessionData:C,imageUrlToBase64:q,saveChapterSession:V,loadSessionByPath:H,setBookChapterContext:O,reset:E}}),sn=At("webImport",()=>{const n=S(Ko()),t=S("idle"),p=S(""),o=S([]),l=S(null),c=S(new Set),s=S({current:0,total:0}),i=S([]),k=S(null),P=S(!1),w=Q(()=>t.value==="extracting"),O=Q(()=>t.value==="downloading"),Y=Q(()=>w.value||O.value),J=Q(()=>c.value.size),R=Q(()=>s.value.total===0?0:Math.round(s.value.current/s.value.total*100));function f(){try{localStorage.setItem(Po,JSON.stringify(n.value))}catch(u){console.error("ä¿å­˜ç½‘é¡µå¯¼å…¥è®¾ç½®å¤±è´¥:",u)}}function I(){try{const u=localStorage.getItem(Po);if(u){const h=JSON.parse(u);n.value=T(Ko(),h)}}catch(u){console.error("åŠ è½½ç½‘é¡µå¯¼å…¥è®¾ç½®å¤±è´¥:",u)}}function T(u,h){const W={...u};for(const A in h)if(Object.prototype.hasOwnProperty.call(h,A)){const U=h[A],G=u[A];U!==null&&typeof U=="object"&&!Array.isArray(U)&&G!==null&&typeof G=="object"&&!Array.isArray(G)?W[A]=T(G,U):U!==void 0&&(W[A]=U)}return W}function M(){P.value=!0}function g(){P.value=!1}function d(){t.value="idle",p.value="",o.value=[],l.value=null,c.value=new Set,s.value={current:0,total:0},i.value=[],k.value=null}function y(u){p.value=u}function v(u){o.value.push(u)}function C(){o.value=[]}function E(u){l.value&&l.value.pages.length>0?(l.value.comicTitle=u.comicTitle,l.value.chapterTitle=u.chapterTitle,l.value.totalPages=u.totalPages,l.value.sourceUrl=u.sourceUrl,l.value.referer=u.referer,l.value.engine=u.engine,l.value.success=u.success,l.value.error=u.error):(l.value=u,u.success&&u.pages&&(c.value=new Set(u.pages.map(h=>h.pageNumber))))}function q(u){c.value.has(u)?c.value.delete(u):c.value.add(u),c.value=new Set(c.value)}function B(){l.value?.pages&&(c.value.size===l.value.pages.length?c.value=new Set:c.value=new Set(l.value.pages.map(u=>u.pageNumber)))}function H(u){t.value=u}function V(u){k.value=u,u&&(t.value="error")}function x(u,h){s.value={current:u,total:h}}function b(u){i.value=u}function $(u){l.value||(l.value={success:!0,comicTitle:"",chapterTitle:"",pages:[],totalPages:0,sourceUrl:p.value,referer:"",engine:"gallery-dl"}),l.value.pages.push(u),l.value.totalPages=l.value.pages.length,c.value.add(u.pageNumber),c.value=new Set(c.value)}const a=cs(n,f);return I(),{settings:n,status:t,url:p,logs:o,extractResult:l,selectedPages:c,downloadProgress:s,downloadedImages:i,error:k,modalVisible:P,isExtracting:w,isDownloading:O,isProcessing:Y,selectedCount:J,downloadProgressPercent:R,saveToStorage:f,loadFromStorage:I,openModal:M,closeModal:g,resetState:d,setUrl:y,addLog:v,clearLogs:C,setExtractResult:E,togglePageSelection:q,toggleSelectAll:B,setStatus:H,setError:V,updateDownloadProgress:x,setDownloadedImages:b,addPageIncremental:$,...a}}),Ts={key:0,class:"translation-progress-bar"},Ds={class:"progress-bar-label"},Rs={class:"progress-bar"},Ms=He({__name:"ProgressBar",props:{visible:{type:Boolean,default:!0},percentage:{},label:{default:"è¿›åº¦"}},setup(n){return(t,p)=>n.visible?(L(),K("div",Ts,[e("div",Ds,le(n.label),1),e("div",Rs,[e("div",{class:"progress",style:st({width:`${n.percentage}%`})},null,4)])])):ge("",!0)}}),po=qe(Ms,[["__scopeId","data-v-f915cadf"]]),Bs={class:"image-upload"},Es={class:"error-text"},Ps={key:2,class:"loading-overlay"},As=He({__name:"ImageUpload",emits:["uploadComplete"],setup(n,{expose:t,emit:p}){const o=p,l=et(),c=Je(),s=sn(),i=S(null),k=S(!1),P=S(!1),w=S(""),O=S(0),Y=S(""),J=S(!1),R=Q(()=>c.settings.pdfProcessingMethod);function f(){i.value?.click()}function I(){s.openModal()}async function T(x){const b=x.target;!b.files||b.files.length===0||(await y(Array.from(b.files)),b.value="")}async function M(x){x.preventDefault(),P.value=!1,!(!x.dataTransfer?.files||x.dataTransfer.files.length===0)&&await y(Array.from(x.dataTransfer.files))}function g(x){x.preventDefault(),P.value=!0}function d(x){const b=x.currentTarget.getBoundingClientRect(),$=x.clientX,a=x.clientY;($<b.left||$>b.right||a<b.top||a>b.bottom)&&(P.value=!1)}async function y(x){if(x.length!==0){k.value=!0,w.value="",J.value=!0,O.value=0;try{let b=0;const $=x.length;for(let a=0;a<x.length;a++){const u=x[a];if(!u)continue;Y.value=u.name;const h=u.type,W=u.name.toLowerCase();if(h.startsWith("image/"))await v(u),b++;else if(h==="application/pdf"||W.endsWith(".pdf")){const A=await C(u);b+=A}else if(W.endsWith(".mobi")||W.endsWith(".azw")||W.endsWith(".azw3")){const A=await H(u);b+=A}else console.warn(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${u.name}`),fe(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${u.name}`,"warning");O.value=Math.round((a+1)/$*100)}b>0&&(fe(`å·²æ·»åŠ  ${b} å¼ å›¾ç‰‡`,"success"),o("uploadComplete",b))}catch(b){console.error("å¤„ç†æ–‡ä»¶å¤±è´¥:",b);const $=b instanceof Error?b.message:"å¤„ç†æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•";w.value=$,fe($,"error")}finally{k.value=!1,J.value=!1,Y.value=""}}}async function v(x){return new Promise((b,$)=>{const a=new FileReader;a.onload=u=>{const h=u.target?.result;l.addImage(x.name,h),b()},a.onerror=()=>$(new Error(`è¯»å–å›¾ç‰‡æ–‡ä»¶å¤±è´¥: ${x.name}`)),a.readAsDataURL(x)})}async function C(x){return R.value==="frontend"?await q(x):await B(x)}function E(x){return new Promise((b,$)=>{const a=new FileReader;a.onload=()=>b(a.result),a.onerror=$,a.readAsDataURL(x)})}async function q(x){try{const b=await nt(()=>import("./pdf.U7tdldy2.js").then(A=>A.p),[]);b.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${b.version}/pdf.worker.min.js`;const $=await x.arrayBuffer(),a=await b.getDocument({data:$}).promise,u=a.numPages;console.log(`PDF ${x.name} å…± ${u} é¡µï¼Œå¼€å§‹æœ¬åœ°æ¸²æŸ“...`),fe(`æ­£åœ¨è§£æ PDFï¼Œå…± ${u} é¡µ...`,"info");const h=typeof OffscreenCanvas<"u";h&&console.log("ä½¿ç”¨ OffscreenCanvas åå°æ¸²æŸ“æ¨¡å¼");let W=0;for(let A=1;A<=u;A++){Y.value=`${x.name} - ç¬¬ ${A}/${u} é¡µ`,O.value=Math.round(A/u*100);try{const U=await a.getPage(A),D=U.getViewport({scale:2});let m;if(h){const r=new OffscreenCanvas(D.width,D.height),_=r.getContext("2d");await U.render({canvasContext:_,viewport:D}).promise;const re=await r.convertToBlob({type:"image/jpeg",quality:1});m=await E(re)}else{const r=document.createElement("canvas"),_=r.getContext("2d");r.width=D.width,r.height=D.height,await U.render({canvasContext:_,viewport:D}).promise,m=r.toDataURL("image/jpeg",1)}const N=`${x.name}_é¡µé¢${A}`;l.addImage(N,m),W++,console.log(`  é¡µé¢ ${A}/${u} å¤„ç†å®Œæˆ`)}catch(U){console.warn(`PDF ${x.name} ç¬¬ ${A} é¡µæ¸²æŸ“å¤±è´¥:`,U)}}return console.log(`PDF ${x.name} å…¨éƒ¨ ${u} é¡µå¤„ç†å®Œæˆ`),W}catch(b){return console.error("å‰ç«¯ PDF è§£æå¤±è´¥:",b),fe("å‰ç«¯ PDF è§£æå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨åç«¯è§£æ...","warning"),await B(x)}}async function B(x){let $=null;try{fe("æ­£åœ¨ä¸Šä¼  PDF æ–‡ä»¶...","info");const a=await Yn(x,5);if(!a.success||!a.session_id)throw new Error(a.error||"PDF è§£æå¯åŠ¨å¤±è´¥");$=a.session_id;const u=a.total_pages||0;console.log(`PDF ${x.name} å…± ${u} é¡µï¼Œå¼€å§‹åç«¯åˆ†æ‰¹è§£æ...`),fe(`æ­£åœ¨è§£æ PDFï¼Œå…± ${u} é¡µ...`,"info");let h=0;for(let W=0;W<u;W+=5){Y.value=`${x.name} - å¤„ç†ä¸­ ${Math.min(W+5,u)}/${u} é¡µ`,O.value=u>0?Math.round(W/u*100):0;const A=await Gn($,W,5);if(!A.success){console.warn(`æ‰¹æ¬¡ ${W} è·å–å¤±è´¥:`,A.error);continue}if(A.images&&A.images.length>0)for(const U of A.images){if(!U||!U.data_url)continue;const G=`${x.name}_é¡µé¢${String(U.page_index+1).padStart(4,"0")}`;l.addImage(G,U.data_url),h++}console.log(`  å·²åŠ è½½ ${h}/${u} é¡µ`)}return console.log(`PDF ${x.name} å…¨éƒ¨ ${h} é¡µå¤„ç†å®Œæˆ`),h}catch(a){throw console.error("åç«¯ PDF è§£æå¤±è´¥:",a),a}finally{if($)try{await Xn($)}catch(a){console.warn("PDF ä¼šè¯æ¸…ç†å¤±è´¥:",a)}}}async function H(x){let b=null;try{fe("æ­£åœ¨ä¸Šä¼ ç”µå­ä¹¦æ–‡ä»¶...","info");const $=await Zn(x,5);if(!$.success||!$.session_id)throw new Error($.error||"MOBI/AZW è§£æå¯åŠ¨å¤±è´¥");b=$.session_id;const a=$.total_images||0;fe(`æ­£åœ¨è§£æç”µå­ä¹¦ï¼Œå…± ${a} å¼ å›¾ç‰‡...`,"info");let u=0,h=!0;for(;h;){Y.value=`${x.name} - å·²å¤„ç† ${u}/${a} å¼ `,O.value=a>0?Math.round(u/a*100):0;const W=await Qn(b);if(!W.success)throw new Error(W.error||"MOBI/AZW æ‰¹æ¬¡è§£æå¤±è´¥");if(W.images&&W.images.length>0){for(let A=0;A<W.images.length;A++){const U=W.images[A];if(!U)continue;const G=u+A+1,D=`${x.name.replace(/\.(mobi|azw|azw3)$/i,"")}_image_${String(G).padStart(3,"0")}.png`,m=U.startsWith("data:")?U:`data:image/png;base64,${U}`;l.addImage(D,m)}u+=W.images.length}h=W.has_more??!1}return u}catch($){throw console.error("MOBI/AZW è§£æå¤±è´¥:",$),$}finally{if(b)try{await es(b)}catch($){console.warn("MOBI/AZW ä¼šè¯æ¸…ç†å¤±è´¥:",$)}}}function V(){w.value=""}return t({triggerFileSelect:f,processFiles:y,clearError:V}),(x,b)=>(L(),K("div",Bs,[e("div",{id:"drop-area",class:Me(["drop-area",{"drag-over":P.value,loading:k.value}]),onDragover:g,onDragleave:d,onDrop:M},[e("div",{class:"drop-content"},[e("p",{class:"drop-text"},[b[0]||(b[0]=Ce(" æ‹–æ‹½å›¾ç‰‡ã€PDFæˆ–MOBIæ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ– ",-1)),e("span",{class:"select-link",onClick:f}," ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ "),b[1]||(b[1]=e("span",{class:"separator"}," | ",-1)),e("span",{class:"select-link web-import-link",onClick:I}," ğŸŒ ä»ç½‘é¡µå¯¼å…¥ ")])]),e("input",{ref_key:"fileInputRef",ref:i,type:"file",id:"imageUpload",accept:"image/*,application/pdf,.mobi,.azw,.azw3",multiple:"",class:"file-input",onChange:T},null,544)],34),J.value?(L(),at(po,{key:0,visible:!0,percentage:O.value,label:Y.value||"å¤„ç†ä¸­..."},null,8,["percentage","label"])):ge("",!0),w.value?(L(),K("div",{key:1,class:"error-message",onClick:V},[b[2]||(b[2]=e("span",{class:"error-icon"},"âš ï¸",-1)),e("span",Es,le(w.value),1),b[3]||(b[3]=e("span",{class:"error-close"},"Ã—",-1))])):ge("",!0),k.value&&!J.value?(L(),K("div",Ps,[...b[4]||(b[4]=[e("div",{class:"spinner"},null,-1),e("span",{class:"loading-text"},"å¤„ç†ä¸­...",-1)])])):ge("",!0)]))}}),Fs=qe(As,[["__scopeId","data-v-ffdddfae"]]),Ls={id:"settings-sidebar",class:"settings-sidebar"},Us={class:"card settings-card"},Os={id:"font-settings",class:"settings-card collapsible-panel"},zs={class:"toggle-icon"},Ns={class:"collapsible-content"},Vs={class:"settings-form"},Ws={class:"form-group"},Ks=["value","disabled","title"],qs={class:"auto-fontSize-option",title:"å‹¾é€‰åï¼Œé¦–æ¬¡ç¿»è¯‘æ—¶è‡ªåŠ¨ä¸ºæ¯ä¸ªæ°”æ³¡è®¡ç®—åˆé€‚çš„å­—å·"},Hs=["checked"],Js={class:"form-group"},js={class:"form-group"},Ys={class:"form-group"},Gs={class:"color-with-auto"},Xs={class:"auto-color-toggle",title:"ç¿»è¯‘æ—¶è‡ªåŠ¨ä½¿ç”¨è¯†åˆ«åˆ°çš„æ–‡å­—é¢œè‰²"},Zs=["checked"],Qs=["value","disabled"],ea={key:0,class:"auto-color-hint"},ta={class:"form-group"},oa={class:"checkbox-label"},na=["checked"],sa={key:0,id:"strokeOptions",class:"stroke-options"},aa={class:"form-group"},la=["value"],ia={class:"form-group"},ra=["value"],ua={class:"form-group"},ca={key:0,id:"solidColorOptions",class:"form-group"},da=["value"],ga={class:"apply-settings-group"},pa=["disabled"],va={key:0,class:"apply-options-dropdown"},ma={class:"apply-option"},ba=["checked"],fa={class:"apply-option"},ha={class:"apply-option"},ya={class:"apply-option"},xa={class:"apply-option"},ka={class:"apply-option"},_a={class:"apply-option"},Sa={class:"apply-option"},Ca={class:"apply-option"},wa={class:"action-buttons"},$a=["disabled"],Ia=["disabled"],Ta=["disabled"],Da=["disabled"],Ra=["disabled"],Ma=["disabled"],Ba=["disabled"],Ea=["disabled"],Pa={class:"navigation-buttons"},Aa=["disabled"],Fa=["disabled"],La=He({__name:"SettingsSidebar",emits:["translateCurrent","translateAll","hqTranslate","proofread","removeText","removeAllText","deleteCurrent","clearAll","cleanTemp","openPlugins","openSettings","previous","next","applyToAll","textStyleChanged","autoFontSizeChanged"],setup(n,{emit:t}){const p=t,o=et(),l=Je(),c=S(!0),s=S(!1),i=S({fontSize:!0,fontFamily:!0,layoutDirection:!0,textColor:!0,fillColor:!0,strokeEnabled:!0,strokeColor:!0,strokeWidth:!0}),k=[{label:"è‡ªåŠ¨ (æ ¹æ®æ£€æµ‹)",value:"auto"},{label:"ç«–å‘æ’ç‰ˆ",value:"vertical"},{label:"æ¨ªå‘æ’ç‰ˆ",value:"horizontal"}],P=[{label:"çº¯è‰²å¡«å……",value:"solid"},{label:"LAMAä¿®å¤ (é€Ÿåº¦ä¼˜åŒ–)",value:"lama_mpe"},{label:"LAMAä¿®å¤ (é€šç”¨)",value:"litelama"}],w=Q(()=>o.currentImage),O=Q(()=>o.hasImages),Y=Q(()=>O.value&&!o.isBatchTranslationInProgress),J=Q(()=>o.canGoPrevious),R=Q(()=>o.canGoNext),f=Q(()=>l.textStyle),I=S([]),T=["fonts/STSONG.TTF","fonts/msyh.ttc","fonts/simhei.ttf","fonts/simsun.ttc"],M=S(null),g=Q(()=>{const D=I.value.map(m=>({label:q(m),value:m}));return D.push({label:"è‡ªå®šä¹‰å­—ä½“...",value:"custom-font"}),D});ut(async()=>{await d();const D=f.value.fontFamily;D&&!I.value.includes(D)&&(I.value=[D,...I.value])});async function d(){try{const D=await en();if(D.fonts&&Array.isArray(D.fonts)&&D.fonts.length>0){const m=D.fonts[0];if(typeof m=="object"&&"path"in m){const N=D.fonts.map(r=>typeof r=="object"?r.path:r);I.value=N}else I.value=D.fonts}else I.value=[...T]}catch(D){console.error("åŠ è½½å­—ä½“åˆ—è¡¨å¤±è´¥:",D),I.value=[...T]}}function y(){c.value=!c.value}function v(D){const m=parseInt(D.target.value);isNaN(m)||(l.updateTextStyle({fontSize:m}),p("textStyleChanged","fontSize",m))}function C(D){const m=D.target.checked;l.updateTextStyle({autoFontSize:m}),console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${m}`),p("autoFontSizeChanged",m)}async function E(D){const m=D.target,N=m.files?.[0];if(!N)return;const r=[".ttf",".ttc",".otf"],_=N.name.toLowerCase();if(!r.some(F=>_.endsWith(F))){fe("è¯·é€‰æ‹© .ttfã€.ttc æˆ– .otf æ ¼å¼çš„å­—ä½“æ–‡ä»¶","error"),m.value="";return}try{const F=await as(N);F.success&&F.fontPath?(await d(),l.updateTextStyle({fontFamily:F.fontPath}),fe("å­—ä½“ä¸Šä¼ æˆåŠŸ","success")):fe(F.error||"å­—ä½“ä¸Šä¼ å¤±è´¥","error")}catch(F){console.error("å­—ä½“ä¸Šä¼ å¤±è´¥:",F),fe("å­—ä½“ä¸Šä¼ å¤±è´¥","error")}finally{m.value=""}}function q(D){const m={"fonts/STXINGKA.TTF":"åæ–‡è¡Œæ¥·","fonts/STXINWEI.TTF":"åæ–‡æ–°é­","fonts/STZHONGS.TTF":"åæ–‡ä¸­å®‹","fonts/STKAITI.TTF":"æ¥·ä½“","fonts/STLITI.TTF":"éš¶ä¹¦","fonts/STSONG.TTF":"åæ–‡å®‹ä½“","fonts/msyh.ttc":"å¾®è½¯é›…é»‘","fonts/msyhbd.ttc":"å¾®è½¯é›…é»‘ç²—ä½“","fonts/SIMYOU.TTF":"å¹¼åœ†","fonts/STFANGSO.TTF":"ä»¿å®‹","fonts/STHUPO.TTF":"åæ–‡ç¥ç€","fonts/STXIHEI.TTF":"åæ–‡ç»†é»‘","fonts/simkai.ttf":"ä¸­æ˜“æ¥·ä½“","fonts/simfang.ttf":"ä¸­æ˜“ä»¿å®‹","fonts/simhei.ttf":"ä¸­æ˜“é»‘ä½“","fonts/SIMLI.TTF":"ä¸­æ˜“éš¶ä¹¦","fonts/simsun.ttc":"å®‹ä½“"};if(m[D])return m[D];const N=D.split("/").pop()||D;for(const[r,_]of Object.entries(m))if((r.split("/").pop()||"").toLowerCase()===N.toLowerCase())return _;return N.replace(/\.(ttf|ttc|otf)$/i,"")}function B(D){const m=String(D);if(m==="custom-font"){M.value?.click();return}l.updateTextStyle({fontFamily:m}),p("textStyleChanged","fontFamily",m)}function H(D){const m=String(D);l.updateTextStyle({layoutDirection:m}),p("textStyleChanged","layoutDirection",m)}function V(D){const m=String(D);l.updateTextStyle({inpaintMethod:m})}function x(D){const m=D.target.value;l.updateTextStyle({textColor:m}),p("textStyleChanged","textColor",m)}function b(D){const m=D.target.checked;l.updateTextStyle({useAutoTextColor:m})}function $(D){const m=D.target.checked;l.updateTextStyle({strokeEnabled:m}),p("textStyleChanged","strokeEnabled",m)}function a(D){const m=D.target.value;l.updateTextStyle({strokeColor:m}),p("textStyleChanged","strokeColor",m)}function u(D){const m=parseInt(D.target.value);isNaN(m)||(l.updateTextStyle({strokeWidth:m}),p("textStyleChanged","strokeWidth",m))}function h(D){const m=D.target.value;l.updateTextStyle({fillColor:m}),p("textStyleChanged","fillColor",m)}function W(){s.value=!s.value}function A(){const m=!Object.values(i.value).every(N=>N);i.value={fontSize:m,fontFamily:m,layoutDirection:m,textColor:m,fillColor:m,strokeEnabled:m,strokeColor:m,strokeWidth:m}}function U(){p("applyToAll",{...i.value}),s.value=!1}function G(D){D.target.closest(".apply-settings-group")||(s.value=!1)}return typeof window<"u"&&window.addEventListener("click",G),(D,m)=>(L(),K("aside",Ls,[e("div",Us,[m[43]||(m[43]=e("h2",null,"ç¿»è¯‘è®¾ç½®",-1)),e("div",Os,[e("h3",{class:"collapsible-header",onClick:y},[m[20]||(m[20]=Ce(" æ–‡å­—è®¾ç½® ",-1)),e("span",zs,le(c.value?"â–¼":"â–¶"),1)]),se(e("div",Ns,[e("div",Vs,[e("div",Ws,[m[22]||(m[22]=e("label",{for:"fontSize"},"å­—å·å¤§å°:",-1)),e("input",{type:"number",id:"fontSize",value:f.value.fontSize,min:"10",max:"100",disabled:f.value.autoFontSize,class:Me({"disabled-input":f.value.autoFontSize}),title:f.value.autoFontSize?"å·²å¯ç”¨è‡ªåŠ¨å­—å·ï¼Œé¦–æ¬¡ç¿»è¯‘æ—¶å°†è‡ªåŠ¨è®¡ç®—":"",onInput:v},null,42,Ks),e("span",qs,[e("input",{type:"checkbox",id:"autoFontSize",checked:f.value.autoFontSize,onChange:C},null,40,Hs),m[21]||(m[21]=e("label",{for:"autoFontSize"},"è‡ªåŠ¨è®¡ç®—åˆå§‹å­—å·",-1))])]),e("div",Js,[m[23]||(m[23]=e("label",{for:"fontFamily"},"æ–‡æœ¬å­—ä½“:",-1)),he(Oe,{"model-value":f.value.fontFamily,options:g.value,onChange:B},null,8,["model-value","options"]),e("input",{ref_key:"fontUploadInput",ref:M,type:"file",id:"fontUpload",accept:".ttf,.ttc,.otf",style:{display:"none"},onChange:E},null,544)]),e("div",js,[m[24]||(m[24]=e("label",{for:"layoutDirection"},"æ’ç‰ˆè®¾ç½®:",-1)),he(Oe,{"model-value":f.value.layoutDirection,options:k,onChange:H},null,8,["model-value"])]),e("div",Ys,[m[26]||(m[26]=e("label",{for:"textColor"},"æ–‡å­—é¢œè‰²:",-1)),e("div",Gs,[e("label",Xs,[e("input",{type:"checkbox",checked:f.value.useAutoTextColor,onChange:b},null,40,Zs),m[25]||(m[25]=e("span",null,"è‡ªåŠ¨",-1))]),e("input",{type:"color",id:"textColor",value:f.value.textColor,disabled:f.value.useAutoTextColor,onInput:x},null,40,Qs)]),f.value.useAutoTextColor?(L(),K("div",ea," ğŸ’¡ ç¿»è¯‘æ—¶å°†è‡ªåŠ¨ä½¿ç”¨è¯†åˆ«åˆ°çš„æ–‡å­—é¢œè‰² ")):ge("",!0)]),e("div",ta,[e("span",oa,[e("input",{type:"checkbox",id:"strokeEnabled",checked:f.value.strokeEnabled,onChange:$},null,40,na),m[27]||(m[27]=e("label",{for:"strokeEnabled"},"å¯ç”¨æ–‡æœ¬æè¾¹:",-1))])]),he(Vo,{name:"stroke-slide"},{default:ht(()=>[f.value.strokeEnabled?(L(),K("div",sa,[e("div",aa,[m[28]||(m[28]=e("label",{for:"strokeColor"},"æè¾¹é¢œè‰²:",-1)),e("input",{type:"color",id:"strokeColor",value:f.value.strokeColor,onInput:a},null,40,la)]),e("div",ia,[m[29]||(m[29]=e("label",{for:"strokeWidth"},"æè¾¹å®½åº¦ (px):",-1)),e("input",{type:"number",id:"strokeWidth",value:f.value.strokeWidth,min:"0",max:"10",style:{width:"60px",padding:"5px"},onInput:u},null,40,ra),m[30]||(m[30]=e("div",{class:"input-hint"},"0 è¡¨ç¤ºæ— æè¾¹ã€‚",-1))])])):ge("",!0)]),_:1}),e("div",ua,[m[31]||(m[31]=e("label",{for:"useInpainting"},"æ°”æ³¡å¡«å……æ–¹å¼:",-1)),he(Oe,{"model-value":f.value.inpaintMethod,options:P,onChange:V},null,8,["model-value"])]),he(Vo,{name:"slide-fade"},{default:ht(()=>[f.value.inpaintMethod==="solid"?(L(),K("div",ca,[m[32]||(m[32]=e("label",{for:"fillColor"},"å¡«å……é¢œè‰²:",-1)),e("input",{type:"color",id:"fillColor",value:f.value.fillColor,onInput:h},null,40,da)])):ge("",!0)]),_:1})]),e("div",ga,[e("button",{type:"button",class:"settings-button",disabled:!O.value,onClick:U}," åº”ç”¨åˆ°å…¨éƒ¨ ",8,pa),e("button",{type:"button",class:"settings-gear-btn",title:"é€‰æ‹©è¦åº”ç”¨çš„å‚æ•°",onClick:W}," âš™ï¸ "),s.value?(L(),K("div",va,[e("div",ma,[e("input",{type:"checkbox",id:"apply_selectAll",checked:Object.values(i.value).every(N=>N),onChange:A},null,40,ba),m[33]||(m[33]=e("label",{for:"apply_selectAll"},"å…¨é€‰",-1))]),m[42]||(m[42]=e("hr",null,null,-1)),e("div",fa,[se(e("input",{type:"checkbox",id:"apply_fontSize","onUpdate:modelValue":m[0]||(m[0]=N=>i.value.fontSize=N)},null,512),[[Qe,i.value.fontSize]]),m[34]||(m[34]=e("label",{for:"apply_fontSize"},"å­—å·",-1))]),e("div",ha,[se(e("input",{type:"checkbox",id:"apply_fontFamily","onUpdate:modelValue":m[1]||(m[1]=N=>i.value.fontFamily=N)},null,512),[[Qe,i.value.fontFamily]]),m[35]||(m[35]=e("label",{for:"apply_fontFamily"},"å­—ä½“",-1))]),e("div",ya,[se(e("input",{type:"checkbox",id:"apply_layoutDirection","onUpdate:modelValue":m[2]||(m[2]=N=>i.value.layoutDirection=N)},null,512),[[Qe,i.value.layoutDirection]]),m[36]||(m[36]=e("label",{for:"apply_layoutDirection"},"æ’ç‰ˆæ–¹å‘",-1))]),e("div",xa,[se(e("input",{type:"checkbox",id:"apply_textColor","onUpdate:modelValue":m[3]||(m[3]=N=>i.value.textColor=N)},null,512),[[Qe,i.value.textColor]]),m[37]||(m[37]=e("label",{for:"apply_textColor"},"æ–‡å­—é¢œè‰²",-1))]),e("div",ka,[se(e("input",{type:"checkbox",id:"apply_fillColor","onUpdate:modelValue":m[4]||(m[4]=N=>i.value.fillColor=N)},null,512),[[Qe,i.value.fillColor]]),m[38]||(m[38]=e("label",{for:"apply_fillColor"},"å¡«å……é¢œè‰²",-1))]),e("div",_a,[se(e("input",{type:"checkbox",id:"apply_strokeEnabled","onUpdate:modelValue":m[5]||(m[5]=N=>i.value.strokeEnabled=N)},null,512),[[Qe,i.value.strokeEnabled]]),m[39]||(m[39]=e("label",{for:"apply_strokeEnabled"},"æè¾¹å¼€å…³",-1))]),e("div",Sa,[se(e("input",{type:"checkbox",id:"apply_strokeColor","onUpdate:modelValue":m[6]||(m[6]=N=>i.value.strokeColor=N)},null,512),[[Qe,i.value.strokeColor]]),m[40]||(m[40]=e("label",{for:"apply_strokeColor"},"æè¾¹é¢œè‰²",-1))]),e("div",Ca,[se(e("input",{type:"checkbox",id:"apply_strokeWidth","onUpdate:modelValue":m[7]||(m[7]=N=>i.value.strokeWidth=N)},null,512),[[Qe,i.value.strokeWidth]]),m[41]||(m[41]=e("label",{for:"apply_strokeWidth"},"æè¾¹å®½åº¦",-1))])])):ge("",!0)])],512),[[Fe,c.value]])]),e("div",wa,[e("button",{id:"translateButton",disabled:!Y.value,onClick:m[8]||(m[8]=N=>p("translateCurrent"))}," ç¿»è¯‘å½“å‰å›¾ç‰‡ ",8,$a),e("button",{id:"translateAllButton",disabled:!Y.value,onClick:m[9]||(m[9]=N=>p("translateAll"))}," ç¿»è¯‘æ‰€æœ‰å›¾ç‰‡ ",8,Ia),e("button",{id:"startHqTranslationBtn",class:"settings-button purple-button",disabled:!Y.value,title:"ä½¿ç”¨é«˜è´¨é‡ç¿»è¯‘æ¨¡å¼ï¼ˆéœ€åœ¨è®¾ç½®ä¸­é…ç½®ï¼‰",onClick:m[10]||(m[10]=N=>p("hqTranslate"))}," é«˜è´¨é‡ç¿»è¯‘ ",8,Ta),e("button",{id:"proofreadButton",disabled:!Y.value,onClick:m[11]||(m[11]=N=>p("proofread"))}," AIæ ¡å¯¹ ",8,Da),e("button",{id:"removeTextOnlyButton",disabled:!w.value,title:"æ¶ˆé™¤å›¾ç‰‡ä¸­çš„æ°”æ³¡æ–‡å­—ï¼Œæ— éœ€å¡«å†™ç¿»è¯‘æœåŠ¡å•†å’ŒAPI Key",onClick:m[12]||(m[12]=N=>p("removeText"))}," ä»…æ¶ˆé™¤æ–‡å­— ",8,Ra),e("button",{id:"removeAllTextButton",disabled:!O.value,title:"æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡ä¸­çš„æ°”æ³¡æ–‡å­—ï¼Œæ— éœ€å¡«å†™ç¿»è¯‘æœåŠ¡å•†å’ŒAPI Key",onClick:m[13]||(m[13]=N=>p("removeAllText"))}," æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡æ–‡å­— ",8,Ma),e("button",{id:"deleteCurrentImageButton",class:"settings-button red-button",disabled:!w.value,onClick:m[14]||(m[14]=N=>p("deleteCurrent"))}," åˆ é™¤å½“å‰å›¾ç‰‡ ",8,Ba),e("button",{id:"clearAllImagesButton",class:"settings-button red-button",disabled:!O.value,onClick:m[15]||(m[15]=N=>p("clearAll"))}," æ¸…é™¤æ‰€æœ‰å›¾ç‰‡ ",8,Ea),e("button",{id:"cleanDebugFilesButton",class:"settings-button orange-button",onClick:m[16]||(m[16]=N=>p("cleanTemp"))}," æ¸…ç†ä¸´æ—¶æ–‡ä»¶ "),e("button",{id:"managePluginsButton",class:"settings-button blue-button",onClick:m[17]||(m[17]=N=>p("openPlugins"))}," æ’ä»¶ç®¡ç† ")]),e("div",Pa,[e("button",{id:"prevImageButton",disabled:!J.value,onClick:m[18]||(m[18]=N=>p("previous"))}," ä¸Šä¸€å¼  ",8,Aa),e("button",{id:"nextImageButton",disabled:!R.value,onClick:m[19]||(m[19]=N=>p("next"))}," ä¸‹ä¸€å¼  ",8,Fa)])])]))}}),Ua=qe(La,[["__scopeId","data-v-df51db99"]]);function _t(n){if(n.textDirection&&n.textDirection!=="auto")return n.textDirection;if(n.autoTextDirection&&n.autoTextDirection!=="auto")return n.autoTextDirection;if(n.coords){const[t,p,o,l]=n.coords;return l-p>o-t?"vertical":"horizontal"}return"vertical"}function Oa(){const n=et(),t=Je(),p=rt(),o=S(!1),l=S(0),c=S(""),s=S(!1),i=S(0),k=S(""),P=Q(()=>n.hasImages),w=Q(()=>n.hasImages),O=Q(()=>n.hasImages);function Y(){const g=n.images;if(g.length===0){p.warning("æ²¡æœ‰å¯å¯¼å‡ºçš„å›¾ç‰‡æ–‡æœ¬");return}const d=[];for(let H=0;H<g.length;H++){const V=g[H];if(!V)continue;const x=V.bubbleStates||[],b={imageIndex:H,bubbles:[]};for(let $=0;$<x.length;$++){const a=x[$];if(!a)continue;const u=a.originalText||"",h=a.translatedText||a.textboxText||"";let W="vertical";a.textDirection&&a.textDirection!=="auto"?W=a.textDirection:a.autoTextDirection&&(W=a.autoTextDirection),b.bubbles.push({bubbleIndex:$,original:u,translated:h,textDirection:W})}d.push(b)}const y=JSON.stringify(d,null,2),v=new Blob([y],{type:"application/json"}),C=URL.createObjectURL(v),E=document.createElement("a");E.href=C;const B=new Date().toISOString().replace(/[-:T]/g,"").slice(0,15);E.download=`translations_${B}.json`,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(C),p.success("æ–‡æœ¬å¯¼å‡ºæˆåŠŸï¼")}function J(){const g=n.images;if(g.length===0)return null;const d=[];for(let y=0;y<g.length;y++){const v=g[y];if(!v)continue;const C=v.bubbleStates||[],E={imageIndex:y,bubbles:[]};for(let q=0;q<C.length;q++){const B=C[q];if(!B)continue;const H=B.originalText||"",V=B.translatedText||B.textboxText||"";let x="vertical";B.textDirection&&B.textDirection!=="auto"?x=B.textDirection:B.autoTextDirection&&(x=B.autoTextDirection),E.bubbles.push({bubbleIndex:q,original:H,translated:V,textDirection:x})}d.push(E)}return d}async function R(g){if(!g){p.warning("æœªé€‰æ‹©æ–‡ä»¶");return}s.value=!0,i.value=0,k.value="å‡†å¤‡å¯¼å…¥æ–‡æœ¬...",p.info("æ­£åœ¨å¯¼å…¥æ–‡æœ¬...",0);try{const d=await f(g);i.value=10,k.value="è§£æ JSON æ•°æ®...";const y=JSON.parse(d);if(!Array.isArray(y))throw new Error("å¯¼å…¥çš„ JSON æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸ºæ•°ç»„");let v=0,C=0;const E=t.settings.textStyle,q=E.autoFontSize?"auto":E.fontSize,B=E.fontFamily,H=E.textColor,V=E.fillColor;i.value=20,k.value="å¼€å§‹æ›´æ–°å›¾ç‰‡...";const x=y.length;let b=0;const $=[];for(const h of y){b++;const W=20+b/x*60;i.value=W,k.value=`å¤„ç†å›¾ç‰‡ ${b}/${x}`;const A=h.imageIndex;if(A<0||A>=n.images.length){console.warn(`è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${A}`);continue}const U=n.images[A];if(!U)continue;let G=!1;U.bubbleStates||(U.bubbleStates=[]),U.bubbleTexts||(U.bubbleTexts=[]),U.originalTexts||(U.originalTexts=[]);for(const D of h.bubbles){const m=D.bubbleIndex,N=D.original,r=D.translated,_=D.textDirection,re=_==="vertical"||_==="horizontal"?_:"vertical";for(;U.bubbleTexts.length<=m;)U.bubbleTexts.push("");for(;U.originalTexts.length<=m;)U.originalTexts.push("");for(N&&(U.originalTexts[m]=N),r&&(U.bubbleTexts[m]=r);U.bubbleStates.length<=m;)U.bubbleStates.push(I(q,B,H,V));const F=U.bubbleStates[m];F&&(N&&(F.originalText=N),r&&(F.translatedText=r,F.textboxText=r),F.textDirection=re,G=!0,C++)}G&&U.bubbleStates&&(U.bubbleTexts=U.bubbleStates.map(D=>D.translatedText||"")),G&&(v++,U.hasUnsavedChanges=!0,U.translatedDataURL&&U.bubbleStates&&U.bubbleStates.length>0&&$.push(A))}if($.length>0){i.value=80,k.value="å¼€å§‹æ¸²æŸ“å›¾ç‰‡...",p.info("æ­£åœ¨æ¸²æŸ“å›¾ç‰‡ï¼Œè¯·ç¨å€™...",0);const h=t.settings.textStyle,W=h.layoutDirection,A=W==="auto";for(let U=0;U<$.length;U++){const G=$[U];if(G===void 0)continue;const D=n.images[G];if(!(!D||!D.bubbleStates)){i.value=80+U/$.length*20,k.value=`æ¸²æŸ“å›¾ç‰‡ ${U+1}/${$.length}`;try{let m="";if(D.cleanImageData?m=D.cleanImageData.includes("base64,")?D.cleanImageData.split("base64,")[1]||"":D.cleanImageData:D.originalDataURL&&(m=D.originalDataURL.includes("base64,")?D.originalDataURL.split("base64,")[1]||"":D.originalDataURL,console.log(`importText: å›¾ç‰‡ ${G} ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰`)),!m){console.log(`importText: å›¾ç‰‡ ${G} æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡`);continue}const N=D.bubbleStates.map(_=>({translatedText:_.translatedText||"",coords:_.coords,fontSize:_.fontSize||h.fontSize,fontFamily:_.fontFamily||h.fontFamily,textDirection:_t(_),textColor:_.textColor||h.textColor,rotationAngle:_.rotationAngle||0,position:_.position||{x:0,y:0},strokeEnabled:_.strokeEnabled??h.strokeEnabled,strokeColor:_.strokeColor||h.strokeColor,strokeWidth:_.strokeWidth??h.strokeWidth})),r=await uo({clean_image:m,bubble_texts:N.map(_=>_.translatedText),bubble_coords:N.map(_=>_.coords),fontSize:h.fontSize,fontFamily:h.fontFamily,textDirection:A?"vertical":W,textColor:h.textColor,bubble_states:N,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,is_font_style_change:!0,strokeEnabled:h.strokeEnabled,strokeColor:h.strokeColor,strokeWidth:h.strokeWidth});r.rendered_image&&(n.updateImageByIndex(G,{translatedDataURL:`data:image/png;base64,${r.rendered_image}`,hasUnsavedChanges:!0}),console.log(`importText: å›¾ç‰‡ ${G} æ¸²æŸ“æˆåŠŸ`))}catch(m){console.error(`importText: é‡æ¸²æŸ“å›¾ç‰‡ ${G} å¤±è´¥:`,m)}}}}i.value=100,k.value="å¯¼å…¥å®Œæˆ";const a=$.length,u=a>0?`å¯¼å…¥æˆåŠŸï¼æ›´æ–°äº† ${v} å¼ å›¾ç‰‡ä¸­çš„ ${C} ä¸ªæ°”æ³¡æ–‡æœ¬ï¼Œé‡æ¸²æŸ“äº† ${a} å¼ å›¾ç‰‡`:`å¯¼å…¥æˆåŠŸï¼æ›´æ–°äº† ${v} å¼ å›¾ç‰‡ä¸­çš„ ${C} ä¸ªæ°”æ³¡æ–‡æœ¬`;p.success(u)}catch(d){console.error("å¯¼å…¥æ–‡æœ¬å‡ºé”™:",d),p.error(`å¯¼å…¥å¤±è´¥: ${d instanceof Error?d.message:String(d)}`)}finally{s.value=!1,setTimeout(()=>{i.value=0,k.value=""},2e3)}}function f(g){return new Promise((d,y)=>{const v=new FileReader;v.onload=C=>{C.target?.result?d(C.target.result):y(new Error("è¯»å–æ–‡ä»¶å¤±è´¥"))},v.onerror=()=>y(new Error("è¯»å–æ–‡ä»¶æ—¶å‡ºé”™")),v.readAsText(g)})}function I(g,d,y,v){const C=t.settings.textStyle;return{coords:[0,0,100,100],polygon:[],originalText:"",translatedText:"",textboxText:"",fontSize:typeof g=="number"?g:25,fontFamily:d,textDirection:"vertical",autoTextDirection:"vertical",textColor:y,fillColor:v,rotationAngle:0,position:{x:0,y:0},strokeEnabled:C.strokeEnabled,strokeColor:C.strokeColor,strokeWidth:C.strokeWidth,inpaintMethod:C.inpaintMethod}}function T(){const g=n.currentImage;if(!g){p.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}const d=g.translatedDataURL||g.originalDataURL;if(!d){p.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}o.value=!0;try{const y=d.split(",")[1];if(!y)throw new Error("æ— æ•ˆçš„å›¾ç‰‡æ•°æ®");const v=atob(y),C=[];for(let x=0;x<v.length;x+=512){const b=v.slice(x,x+512),$=new Array(b.length);for(let u=0;u<b.length;u++)$[u]=b.charCodeAt(u);const a=new Uint8Array($);C.push(a.buffer)}const E=new Blob(C,{type:"image/png"}),q=URL.createObjectURL(E),B=document.createElement("a");B.href=q;let H=g.fileName||`image_${n.currentImageIndex}.png`;H=`${g.translatedDataURL?"translated":"original"}_${H.replace(/\.[^/.]+$/,"")}.png`,B.download=H,document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(q),p.success(`ä¸‹è½½æˆåŠŸ: ${H}`)}catch(y){console.error("ä¸‹è½½å›¾ç‰‡æ—¶å‡ºé”™:",y),p.error("ä¸‹è½½å¤±è´¥")}finally{o.value=!1}}async function M(g="zip"){const d=n.images;if(d.length===0){p.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}o.value=!0,l.value=0,c.value="å‡†å¤‡ä¸‹è½½...",p.info("ä¸‹è½½ä¸­...å¤„ç†å¯èƒ½éœ€è¦ä¸€å®šæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…...",0);try{const y=[];let v=0,C=0;l.value=5,c.value="æ£€æŸ¥å›¾ç‰‡æ•°æ®...";for(let u=0;u<d.length;u++){const h=d[u];h&&(h.translatedDataURL?(y.push({index:u,type:"translated"}),v++):h.originalDataURL&&(y.push({index:u,type:"original"}),C++))}if(y.length===0){p.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}l.value=10,c.value="åˆ›å»ºä¸‹è½½ä¼šè¯...";const E=await ts(y.length);if(!E.success||!E.session_id)throw new Error(E.error||"åˆ›å»ºä¼šè¯å¤±è´¥");const q=E.session_id,B=y.length;let H=0,V=0;for(let u=0;u<y.length;u++){const h=y[u];if(!h)continue;const W=d[h.index];if(!W)continue;const A=h.type==="translated"?W.translatedDataURL:W.originalDataURL;if(!A)continue;const U=10+u/B*70;l.value=U,c.value=`ä¸Šä¼ å›¾ç‰‡ ${u+1}/${B}...`;try{const G=await os(q,A,u);G.success?H++:(console.error(`ä¸Šä¼ å›¾ç‰‡ ${u} å¤±è´¥:`,G.error),V++)}catch(G){console.error(`ä¸Šä¼ å›¾ç‰‡ ${u} å‡ºé”™:`,G),V++}}if(H===0)throw new Error("æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ å¤±è´¥");l.value=85,c.value="æ‰“åŒ…æ–‡ä»¶...";const x=await ns(q,g);if(!x.success||!x.file_id)throw new Error(x.error||"æ‰“åŒ…å¤±è´¥");l.value=95,c.value="å‡†å¤‡ä¸‹è½½...";const b=ss(x.file_id,g),$=document.createElement("a");$.href=b,document.body.appendChild($),$.click(),document.body.removeChild($),l.value=100,c.value="ä¸‹è½½å·²å¼€å§‹";let a=`å·²æˆåŠŸå¤„ç† ${H} å¼ å›¾ç‰‡`;V>0&&(a+=`ï¼ˆ${V} å¼ å¤±è´¥ï¼‰`),v>0&&C>0?a+=`ï¼ˆ${v} å¼ ç¿»è¯‘å›¾ç‰‡å’Œ ${C} å¼ åŸå§‹å›¾ç‰‡ï¼‰`:v>0?a+="ï¼ˆå…¨éƒ¨ä¸ºç¿»è¯‘åå›¾ç‰‡ï¼‰":C>0&&(a+="ï¼ˆå…¨éƒ¨ä¸ºåŸå§‹å›¾ç‰‡ï¼‰"),a+="ï¼Œä¸‹è½½å³å°†å¼€å§‹",p.success(a),setTimeout(async()=>{try{const u=await ro();console.log("ä¸´æ—¶æ–‡ä»¶æ¸…ç†ç»“æœ:",u)}catch(u){console.error("æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥:",u)}},6e4)}catch(y){console.error("ä¸‹è½½æ‰€æœ‰å›¾ç‰‡æ—¶å‡ºé”™:",y),p.error(`ä¸‹è½½å¤±è´¥: ${y instanceof Error?y.message:String(y)}`)}finally{o.value=!1,setTimeout(()=>{l.value=0,c.value=""},2e3)}}return{isDownloading:o,downloadProgress:l,downloadProgressText:c,isImporting:s,importProgress:i,importProgressText:k,canExportText:P,canImportText:w,canDownload:O,exportText:Y,exportTextToJson:J,importText:R,downloadCurrentImage:T,downloadAllImages:M}}const za={key:0,class:"result-section card result-card"},Na={class:"image-controls"},Va={class:"image-size-control"},Wa=["value"],Ka={id:"imageSizeValue"},qa={class:"content-container"},Ha={class:"image-container"},Ja=["src"],ja={id:"detectedTextInfo",class:"text-info"},Ya={id:"detectedTextList"},Ga={class:"original-text"},Xa={class:"download-section"},Za={class:"download-buttons"},Qa=["disabled"],el={class:"download-all-container"},tl=["disabled"],ol={class:"download-format-selector"},nl=["disabled"],sl=["disabled"],al={key:1,class:"empty-state-section"},Zt=60,ll=He({__name:"ImageResultDisplay",props:{isEditMode:{type:Boolean,default:!1}},emits:["toggle-edit-mode","retry-failed"],setup(n,{emit:t}){const p=[{label:"ZIPå‹ç¼©åŒ…",value:"zip"},{label:"PDFæ–‡æ¡£",value:"pdf"},{label:"CBZæ¼«ç”»",value:"cbz"}],o=t,l=et(),c=Je(),s=Oa(),i=S(100),k=Q({get:()=>f.value?.showOriginal??!1,set:U=>{f.value&&l.updateCurrentImage({showOriginal:U})}}),P=S("zip"),w=S(null),O=Q(()=>s.isDownloading.value),Y=Q(()=>s.downloadProgressText.value),J=Q(()=>s.downloadProgress.value),R=Q(()=>l.hasImages),f=Q(()=>l.currentImage),I=Q(()=>!!f.value?.translatedDataURL),T=Q(()=>!!(f.value?.translatedDataURL||f.value?.originalDataURL)),M=Q(()=>f.value?k.value||!f.value.translatedDataURL?f.value.originalDataURL:f.value.translatedDataURL:""),g=Q(()=>l.failedImageCount>0),d=Q(()=>({width:`${i.value}%`})),y=Q(()=>c.settings.useTextboxPrompt),v=Q(()=>{if(!f.value)return[];if(f.value.bubbleStates&&f.value.bubbleStates.length>0)return f.value.bubbleStates.map(D=>({original:D.originalText||"",translated:y.value?D.textboxText||D.translatedText||"":D.translatedText||""}));const U=f.value.originalTexts||[],G=y.value?f.value.textboxTexts||f.value.bubbleTexts||[]:f.value.bubbleTexts||[];return U.length===0?[]:U.map((D,m)=>({original:D||"",translated:G[m]||""}))}),C=Q(()=>v.value.length>0);function E(U){if(!U||U.length<=Zt)return U;let G="",D="";for(let m=0;m<U.length;m++)if(D+=U[m],D.length>=Zt){let N=-1;for(let r=D.length-1;r>=0;r--){const _=D[r];if(_&&["ã€‚","ï¼","ï¼Ÿ",".","!","?","ï¼›",";","ï¼Œ",","].includes(_)){N=r+1;break}}N>Zt*.6?(G+=D.substring(0,N)+`
`,D=D.substring(N)):(G+=D+`
`,D="")}return D&&(G+=D),G}function q(U){return E((U||"").trim())}function B(U){const G=(U||"").trim();return E(G)}function H(U){return(U||"").includes("ç¿»è¯‘å¤±è´¥")}function V(){k.value=!k.value}function x(){o("toggle-edit-mode")}function b(U){const G=U.target;i.value=parseInt(G.value,10)}function $(){o("retry-failed")}function a(){s.downloadCurrentImage()}function u(){s.downloadAllImages(P.value)}function h(){s.exportText()}function W(){w.value?.click()}async function A(U){const G=U.target,D=G.files?.[0];D&&(await s.importText(D),G.value="")}return(U,G)=>f.value?(L(),K("section",za,[e("div",Na,[I.value?(L(),K("button",{key:0,id:"toggleImageButton",class:"control-btn",onClick:V},le(k.value?"æŸ¥çœ‹ç¿»è¯‘å›¾":"æŸ¥çœ‹åŸå›¾"),1)):ge("",!0),e("button",{id:"toggleEditModeButton",class:Me(["control-btn",{active:n.isEditMode}]),onClick:x},le(n.isEditMode?"é€€å‡ºç¼–è¾‘":"åˆ‡æ¢ç¼–è¾‘æ¨¡å¼"),3),e("div",Va,[G[1]||(G[1]=e("label",{for:"imageSize"},"å›¾ç‰‡å¤§å°:",-1)),e("input",{type:"range",id:"imageSize",min:"50",max:"200",value:i.value,class:"slider range-slider",onInput:b},null,40,Wa),e("span",Ka,le(i.value)+"%",1)]),g.value?(L(),K("button",{key:1,id:"retranslateFailedButton",class:"retry-failed-btn",onClick:$,title:"é‡æ–°ç¿»è¯‘æ‰€æœ‰å¤±è´¥çš„å›¾ç‰‡"}," é‡æ–°ç¿»è¯‘å¤±è´¥å›¾ç‰‡ ("+le(X(l).failedImageCount)+") ",1)):ge("",!0)]),e("div",qa,[e("div",Ha,[e("img",{id:"translatedImageDisplay",src:M.value,alt:"ç¿»è¯‘åå›¾ç‰‡",style:st(d.value)},null,12,Ja)])]),e("div",ja,[G[6]||(G[6]=e("h3",null,"æ£€æµ‹åˆ°çš„æ–‡æœ¬ï¼ˆåŸæ–‡ â†’ è¯‘æ–‡ï¼‰",-1)),e("pre",Ya,[C.value?(L(!0),K(Ke,{key:0},je(v.value,(D,m)=>(L(),K("span",{key:m,class:"text-item"},[e("span",Ga,le(q(D.original)),1),G[2]||(G[2]=Ce(`
`,-1)),e("span",{class:Me(["translated-text",{"translation-error":H(D.translated)}])},le(B(D.translated)),3),G[3]||(G[3]=Ce(`
`,-1)),G[4]||(G[4]=e("span",{class:"separator"},"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",-1)),G[5]||(G[5]=Ce(`

`,-1))]))),128)):(L(),K(Ke,{key:1},[Ce("æœªæ£€æµ‹åˆ°æ–‡æœ¬æˆ–å°šæœªç¿»è¯‘")],64))])]),e("div",Xa,[O.value?(L(),at(po,{key:0,visible:!0,percentage:J.value,label:Y.value||"ä¸‹è½½ä¸­ï¼Œè¯·ç¨å€™..."},null,8,["percentage","label"])):ge("",!0),e("div",Za,[e("button",{id:"downloadButton",class:"download-btn primary",disabled:!T.value,onClick:a}," ä¸‹è½½å½“å‰å›¾ç‰‡ ",8,Qa),e("div",el,[e("button",{id:"downloadAllImagesButton",class:"download-btn primary",disabled:!R.value,onClick:u}," ä¸‹è½½æ‰€æœ‰å›¾ç‰‡ ",8,tl),e("div",ol,[he(Oe,{modelValue:P.value,"onUpdate:modelValue":G[0]||(G[0]=D=>P.value=D),options:p},null,8,["modelValue"])])]),e("button",{id:"exportTextButton",class:"download-btn success",disabled:!R.value,onClick:h}," å¯¼å‡ºæ–‡æœ¬ ",8,nl),e("button",{id:"importTextButton",class:"download-btn success",disabled:!R.value,onClick:W}," å¯¼å…¥æ–‡æœ¬ ",8,sl),e("input",{type:"file",ref_key:"importFileInput",ref:w,id:"importTextFileInput",style:{display:"none"},accept:".json",onChange:A},null,544)])])])):(L(),K("section",al))}}),il=qe(ll,[["__scopeId","data-v-a26b9c58"]]),rl={class:"guide-content"},ul={class:"guide-footer"},cl={class:"dont-show-option"},Dt="saber_translator_dismiss_setup_reminder",dl=He({__name:"FirstTimeGuide",emits:["openSettings"],setup(n,{expose:t,emit:p}){const o=p,l=S(!1),c=S(!1);ut(()=>{localStorage.getItem(Dt)!=="true"&&(l.value=!0)});function s(){c.value&&localStorage.setItem(Dt,"true"),l.value=!1}function i(){localStorage.setItem(Dt,"true"),l.value=!1,o("openSettings")}function k(){localStorage.removeItem(Dt)}return t({resetGuideState:k,showGuide:l}),(P,w)=>(L(),at(tn,{"model-value":l.value,title:"æ¬¢è¿ä½¿ç”¨ Saber-Translator",onClose:s},{default:ht(()=>[e("div",rl,[w[3]||(w[3]=e("div",{class:"guide-icon"},"ğŸ‰",-1)),w[4]||(w[4]=e("div",{class:"guide-message"},[e("p",{class:"guide-title"},"é¦–æ¬¡ä½¿ç”¨æé†’"),e("p",{class:"guide-text"}," åœ¨å¼€å§‹ç¿»è¯‘ä¹‹å‰ï¼Œè¯·å…ˆé…ç½®ç¿»è¯‘æœåŠ¡ã€‚ "),e("p",{class:"guide-text"},[Ce(" ç‚¹å‡»å³ä¸Šè§’çš„ "),e("span",{class:"highlight"},"âš™ï¸ è®¾ç½®"),Ce(" æŒ‰é’®ï¼Œé…ç½®ä»¥ä¸‹å†…å®¹ï¼š ")]),e("ul",{class:"guide-list"},[e("li",null,"é€‰æ‹© OCR å¼•æ“ï¼ˆæ–‡å­—è¯†åˆ«ï¼‰"),e("li",null,"é…ç½®ç¿»è¯‘æœåŠ¡å•†å’Œ API Key"),e("li",null,"ï¼ˆå¯é€‰ï¼‰é…ç½®é«˜è´¨é‡ç¿»è¯‘å’Œ AI æ ¡å¯¹")])],-1)),e("div",{class:"guide-actions"},[e("button",{class:"guide-btn primary",onClick:i},[...w[1]||(w[1]=[e("span",{class:"btn-icon"},"âš™ï¸",-1),Ce(" ç«‹å³é…ç½® ",-1)])]),e("button",{class:"guide-btn secondary",onClick:s}," ç¨åé…ç½® ")]),e("div",ul,[e("label",cl,[se(e("input",{type:"checkbox","onUpdate:modelValue":w[0]||(w[0]=O=>c.value=O)},null,512),[[Qe,c.value]]),w[2]||(w[2]=e("span",null,"ä¸å†æ˜¾ç¤ºæ­¤æé†’",-1))])])])]),_:1},8,["model-value"]))}}),gl=qe(dl,[["__scopeId","data-v-eda18e4a"]]),Qt="saber_translator_dismiss_setup_reminder",pl=["siliconflow","deepseek","volcano","caiyun","baidu_translate","youdao_translate","gemini","custom_openai"],vl={manga_ocr:"MangaOCR",paddle_ocr:"PaddleOCR",baidu_ocr:"ç™¾åº¦OCR",ai_vision:"AIè§†è§‰OCR"},ml=["ollama","sakura"],bl=["custom_openai"],fl=["custom_openai"],hl={siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",caiyun:"å½©äº‘å°è¯‘",baidu_translate:"ç™¾åº¦ç¿»è¯‘",youdao_translate:"æœ‰é“ç¿»è¯‘",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰ OpenAI",ollama:"Ollama",sakura:"Sakura"};function Ft(){const n=Je(),t=rt(),p=S(!1),o=S(!1),l=Q(()=>{try{return localStorage.getItem(Qt)==="true"}catch{return!1}});function c(v){return hl[v]||v}function s(v){return pl.includes(v)}function i(v){return ml.includes(v)}function k(v){return bl.includes(v)}function P(v){return fl.includes(v)}function w(v){return vl[v]||v}function O(){const v=n.settings,C=v.ocrEngine,E=v.baiduOcr,q=v.aiVisionOcr,B=[];return C?(C==="baidu_ocr"&&((!E?.apiKey||E.apiKey.trim()==="")&&B.push("ç™¾åº¦OCR çš„ API Key"),(!E?.secretKey||E.secretKey.trim()==="")&&B.push("ç™¾åº¦OCR çš„ Secret Key")),C==="ai_vision"&&(q?.provider||B.push("AIè§†è§‰OCR çš„æœåŠ¡å•†"),(!q?.apiKey||q.apiKey.trim()==="")&&B.push("AIè§†è§‰OCR çš„ API Key"),(!q?.modelName||q.modelName.trim()==="")&&B.push("AIè§†è§‰OCR çš„æ¨¡å‹åç§°"),q?.provider==="custom"&&(!q?.customBaseUrl||q.customBaseUrl.trim()==="")&&B.push("AIè§†è§‰OCR çš„è‡ªå®šä¹‰ Base URL")),B.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${B[0]}`,missingItems:B}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹© OCR å¼•æ“",missingItems:["OCR å¼•æ“"]}}function Y(){const{translation:v}=n.settings,{provider:C,apiKey:E,modelName:q,customBaseUrl:B}=v,H=[];return C?(s(C)&&(!E||E.trim()==="")&&H.push(`${c(C)} çš„ API Key`),(!q||q.trim()==="")&&(i(C)||s(C))&&H.push(`${c(C)} çš„æ¨¡å‹åç§°`),k(C)&&(!B||B.trim()==="")&&H.push("è‡ªå®šä¹‰ OpenAI æœåŠ¡çš„ Base URL"),H.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${H[0]}`,missingItems:H}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹©ç¿»è¯‘æœåŠ¡å•†",missingItems:["ç¿»è¯‘æœåŠ¡å•†"]}}function J(){const{hqTranslation:v}=n.settings,{provider:C,apiKey:E,modelName:q,customBaseUrl:B}=v,H=[];return C?((!E||E.trim()==="")&&H.push("é«˜è´¨é‡ç¿»è¯‘çš„ API Key"),(!q||q.trim()==="")&&H.push("é«˜è´¨é‡ç¿»è¯‘çš„æ¨¡å‹åç§°"),P(C)&&(!B||B.trim()==="")&&H.push("é«˜è´¨é‡ç¿»è¯‘çš„ Base URL"),H.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${H[0]}`,missingItems:H}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹©é«˜è´¨é‡ç¿»è¯‘çš„æœåŠ¡å•†",missingItems:["é«˜è´¨é‡ç¿»è¯‘æœåŠ¡å•†"]}}function R(v){const C=v||n.settings.proofreading.rounds,E=[];if(!C||C.length===0)return{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­æ·»åŠ è‡³å°‘ä¸€ä¸ªæ ¡å¯¹è½®æ¬¡",missingItems:["æ ¡å¯¹è½®æ¬¡"]};for(let q=0;q<C.length;q++){const B=C[q];if(!B)continue;const H=B.name||`è½®æ¬¡${q+1}`;if(B.provider||E.push(`æ ¡å¯¹ ${H} çš„æœåŠ¡å•†`),(!B.apiKey||B.apiKey.trim()==="")&&E.push(`æ ¡å¯¹ ${H} çš„ API Key`),(!B.modelName||B.modelName.trim()==="")&&E.push(`æ ¡å¯¹ ${H} çš„æ¨¡å‹åç§°`),E.length>0)return{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­ä¸º ${E[0]}`,missingItems:E}}return{valid:!0,message:""}}function f(v="normal",C={}){let E;switch(v){case"normal":E=Y();break;case"hq":E=J();break;case"proofread":E=R(C.proofreadingRounds);break;case"ocr":E=O();break;default:E=Y()}return E.valid?!0:(t.error(E.message),T(),!1)}function I(){const v=O();if(!v.valid)return t.error(v.message),T(),!1;const C=Y();return C.valid?!0:(t.error(C.message),T(),!1)}function T(){const v=document.getElementById("openSettingsBtn");v&&(o.value=!0,v.style.animation="settingsBtnPulse 0.5s ease-in-out 3",v.style.boxShadow="0 0 10px var(--primary-color, #4a90d9)",setTimeout(()=>{v.style.animation="",v.style.boxShadow="",o.value=!1},3e3))}function M(){if(l.value){console.log("ç”¨æˆ·å·²é€‰æ‹©ä¸å†æ˜¾ç¤ºè®¾ç½®æé†’");return}p.value=!0}function g(v=!1){if(v)try{localStorage.setItem(Qt,"true"),console.log("ç”¨æˆ·é€‰æ‹©æ°¸ä¹…å…³é—­è®¾ç½®æé†’")}catch(C){console.error("ä¿å­˜è®¾ç½®æé†’çŠ¶æ€å¤±è´¥:",C)}p.value=!1}function d(){try{localStorage.removeItem(Qt),console.log("è®¾ç½®æé†’çŠ¶æ€å·²é‡ç½®")}catch(v){console.error("é‡ç½®è®¾ç½®æé†’çŠ¶æ€å¤±è´¥:",v)}}function y(){setTimeout(()=>{M()},500)}return{showSetupReminder:p,isSettingsButtonHighlighted:o,isSetupReminderDismissed:l,validateOcrConfig:O,validateTranslationConfig:Y,validateHqTranslationConfig:J,validateProofreadingConfig:R,validateBeforeTranslation:f,validateFullTranslationConfig:I,highlightSettingsButton:T,checkAndShowSetupReminder:M,closeSetupReminder:g,resetSetupReminderDismiss:d,initValidation:y,getProviderDisplayName:c,getOcrEngineDisplayName:w,requiresApiKey:s,isLocalProvider:i,requiresBaseUrl:k}}const Rt={originalText:"",translatedText:"",textboxText:"",coords:[0,0,100,100],polygon:[],fontSize:25,fontFamily:"fonts/STSONG.TTF",textDirection:"auto",autoTextDirection:"vertical",textColor:"#000000",fillColor:Xo,rotationAngle:0,position:{x:0,y:0},strokeEnabled:io,strokeColor:lo,strokeWidth:ao,inpaintMethod:"solid",autoFgColor:null,autoBgColor:null,colorConfidence:0};function oo(n){return{...{...Rt,...n},coords:n?.coords?[...n.coords]:[...Rt.coords],polygon:n?.polygon?n.polygon.map(p=>[...p]):[],position:n?.position?{...Rt.position,...n.position}:{...Rt.position}}}function an(n){const[t,p,o,l]=n,c=Math.abs(o-t);return Math.abs(l-p)>c?"vertical":"horizontal"}function ln(n,t){const{bubble_coords:p=[],bubble_states:o=[],original_texts:l=[],bubble_texts:c=[],textbox_texts:s=[],bubble_angles:i=[],auto_directions:k=[]}=n;return o.length>0?o.map((P,w)=>({...oo(t),...P,coords:P.coords||p[w]||[0,0,100,100]})):p.map((P,w)=>{let O;return k[w]?O=k[w]==="v"?"vertical":"horizontal":O=an(P),oo({coords:P,originalText:l[w]||"",translatedText:c[w]||"",textboxText:s[w]||"",rotationAngle:i[w]||0,autoTextDirection:O,...t})})}function Mt(n){return n.map(t=>({...t,coords:[...t.coords],polygon:t.polygon?t.polygon.map(p=>[...p]):[],position:{...t.position},autoFgColor:t.autoFgColor?[...t.autoFgColor]:null,autoBgColor:t.autoBgColor?[...t.autoBgColor]:null}))}function yl(n){if(!n||typeof n!="object")return!1;const t=n;if(!Array.isArray(t.coords)||t.coords.length!==4||!t.coords.every(l=>typeof l=="number"&&!isNaN(l))||typeof t.fontSize!="number"||t.fontSize<=0)return!1;const p=["vertical","horizontal","auto"];if(typeof t.textDirection!="string"||!p.includes(t.textDirection))return!1;const o=["solid","lama_mpe","litelama"];return!(typeof t.inpaintMethod!="string"||!o.includes(t.inpaintMethod))}const dt=At("bubble",()=>{const n=S([]),t=S(-1),p=S([]),o=S([]),l=S(!1),c=S(-1),s=S(0),i=S(0),k=S(0),P=S(0),w=S(!1),O=S(-1),Y=S(null),J=S(!1),R=S(-1),f=S(0),I=Q(()=>t.value>=0&&t.value<n.value.length?n.value[t.value]??null:null),T=Q(()=>n.value.length),M=Q(()=>n.value.length>0),g=Q(()=>t.value>=0),d=Q(()=>p.value.length>1),y=Q(()=>p.value.filter(F=>F>=0&&F<n.value.length).map(F=>n.value[F]).filter(F=>F!==void 0));function v(){const te=et().currentImage;te&&(te.bubbleStates=Mt(n.value),te.hasUnsavedChanges=!0,console.log("æ°”æ³¡çŠ¶æ€å·²åŒæ­¥åˆ°å½“å‰å›¾ç‰‡"))}function C(F,te=!1){n.value=F,o.value=Mt(F),$(),console.log(`æ°”æ³¡æ•°ç»„å·²è®¾ç½®ï¼Œå…± ${F.length} ä¸ªæ°”æ³¡`),te||v()}function E(F,te){const de=an(F),$e=Je().settings.textStyle,Pe=$e.layoutDirection,Be=Pe==="auto"?"vertical":Pe||"vertical",ae=oo({coords:F,translatedText:"",autoTextDirection:de,fontSize:$e.fontSize,fontFamily:$e.fontFamily,textDirection:Be,textColor:$e.textColor,fillColor:$e.fillColor,inpaintMethod:$e.inpaintMethod,strokeEnabled:$e.strokeEnabled,strokeColor:$e.strokeColor,strokeWidth:$e.strokeWidth,rotationAngle:0,position:{x:0,y:0},...te});return n.value.push(ae),console.log(`å·²æ·»åŠ æ°”æ³¡ï¼Œå½“å‰å…± ${n.value.length} ä¸ª`),v(),ae}function q(F){return F<0||F>=n.value.length?(console.warn(`åˆ é™¤å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${F}`),!1):(n.value.splice(F,1),t.value===F?t.value=-1:t.value>F&&t.value--,p.value=p.value.filter(te=>te!==F).map(te=>te>F?te-1:te),console.log(`å·²åˆ é™¤æ°”æ³¡ï¼Œå½“å‰å…± ${n.value.length} ä¸ª`),v(),!0)}function B(){if(p.value.length===0&&t.value<0)return;const F=[...new Set([...p.value,t.value])].filter(te=>te>=0).sort((te,de)=>de-te);for(const te of F)n.value.splice(te,1);$(),console.log(`å·²åˆ é™¤ ${F.length} ä¸ªæ°”æ³¡`),v()}function H(){n.value=[],o.value=[],$(),console.log("æ‰€æœ‰æ°”æ³¡å·²æ¸…é™¤"),v()}function V(){n.value=[],o.value=[],$(),console.log("æœ¬åœ°æ°”æ³¡çŠ¶æ€å·²æ¸…é™¤ï¼ˆä¸åŒæ­¥åˆ°imageStoreï¼‰")}function x(F){F>=-1&&F<n.value.length&&(t.value=F,p.value=F>=0?[F]:[],console.log(`å·²é€‰ä¸­æ°”æ³¡ ${F}`))}function b(F){if(F<0||F>=n.value.length)return;const te=p.value.indexOf(F);te>=0?(p.value.splice(te,1),t.value===F&&(t.value=p.value[0]??-1)):(p.value.push(F),t.value=F),console.log(`å¤šé€‰çŠ¶æ€: ${p.value.join(", ")}`)}function $(){t.value=-1,p.value=[]}function a(){t.value>=0?p.value=[t.value]:p.value=[]}function u(){if(n.value.length===0)return!1;const F=t.value<n.value.length-1?t.value+1:0;return x(F),!0}function h(){if(n.value.length===0)return!1;const F=t.value>0?t.value-1:n.value.length-1;return x(F),!0}function W(F,te){if(F<0||F>=n.value.length)return console.warn(`æ›´æ–°å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${F}`),!1;const de=n.value[F];return de?(Object.assign(de,te),console.log(`å·²æ›´æ–°æ°”æ³¡ ${F}`),v(),!0):!1}function A(F){return t.value<0?(console.warn("æ›´æ–°å¤±è´¥: æ²¡æœ‰é€‰ä¸­çš„æ°”æ³¡"),!1):W(t.value,F)}function U(F){const te=p.value.length>0?p.value:t.value>=0?[t.value]:[];for(const de of te){const _e=n.value[de];_e&&Object.assign(_e,F)}v(),console.log(`å·²æ‰¹é‡æ›´æ–° ${te.length} ä¸ªæ°”æ³¡`)}function G(F){for(let te=0;te<n.value.length;te++){const de=n.value[te];de&&Object.assign(de,F)}v(),console.log(`å·²æ›´æ–°æ‰€æœ‰ ${n.value.length} ä¸ªæ°”æ³¡`)}function D(){if(n.value.length!==o.value.length)return!0;for(let F=0;F<n.value.length;F++){const te=n.value[F],de=o.value[F];if(!(!te||!de)&&(te.translatedText!==de.translatedText||te.textboxText!==de.textboxText||te.fontSize!==de.fontSize||te.fontFamily!==de.fontFamily||te.textDirection!==de.textDirection||te.textColor!==de.textColor||te.fillColor!==de.fillColor||te.rotationAngle!==de.rotationAngle||te.strokeEnabled!==de.strokeEnabled||te.strokeColor!==de.strokeColor||te.strokeWidth!==de.strokeWidth||te.inpaintMethod!==de.inpaintMethod||JSON.stringify(te.coords)!==JSON.stringify(de.coords)))return!0}return!1}function m(){n.value=Mt(o.value),$(),console.log("æ°”æ³¡çŠ¶æ€å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€")}function N(){o.value=Mt(n.value),console.log("å½“å‰çŠ¶æ€å·²ä¿å­˜ä¸ºåˆå§‹çŠ¶æ€")}function r(){return{bubble_coords:n.value.map(F=>F.coords),bubble_texts:n.value.map(F=>F.translatedText),textbox_texts:n.value.map(F=>F.textboxText),font_sizes:n.value.map(F=>F.fontSize),font_families:n.value.map(F=>F.fontFamily),text_directions:n.value.map(F=>F.textDirection==="auto"?F.autoTextDirection==="vertical"?"v":"h":F.textDirection==="vertical"?"v":"h"),text_colors:n.value.map(F=>F.textColor),fill_colors:n.value.map(F=>F.fillColor),rotation_angles:n.value.map(F=>F.rotationAngle),stroke_enabled:n.value.map(F=>F.strokeEnabled),stroke_colors:n.value.map(F=>F.strokeColor),stroke_widths:n.value.map(F=>F.strokeWidth),inpaint_methods:n.value.map(F=>F.inpaintMethod)}}function _(){return JSON.stringify(n.value)}function re(F){try{const te=JSON.parse(F);if(!Array.isArray(te))return console.error("ååºåˆ—åŒ–å¤±è´¥: æ•°æ®ä¸æ˜¯æ•°ç»„"),!1;const de=[];for(const _e of te)yl(_e)?de.push(_e):console.warn("è·³è¿‡æ— æ•ˆçš„æ°”æ³¡çŠ¶æ€:",_e);return C(de),!0}catch(te){return console.error("ååºåˆ—åŒ–å¤±è´¥:",te),!1}}return{bubbles:n,selectedIndex:t,selectedIndices:p,initialStates:o,isDragging:l,draggingIndex:c,dragOffsetX:s,dragOffsetY:i,dragInitialX:k,dragInitialY:P,isResizing:w,resizingIndex:O,resizeCurrentCoords:Y,isRotating:J,rotatingIndex:R,rotateCurrentAngle:f,selectedBubble:I,bubbleCount:T,hasBubbles:M,hasSelection:g,isMultiSelect:d,selectedBubbles:y,setBubbles:C,addBubble:E,deleteBubble:q,deleteSelected:B,clearBubbles:H,clearBubblesLocal:V,selectBubble:x,toggleMultiSelect:b,clearSelection:$,clearMultiSelect:a,selectNext:u,selectPrevious:h,updateBubble:W,updateSelectedBubble:A,updateAllSelected:U,updateAllBubbles:G,hasChanges:D,resetToInitial:m,saveAsInitial:N,toApiRequest:r,serialize:_,deserialize:re}}),xl=Object.freeze(Object.defineProperty({__proto__:null,useBubbleStore:dt},Symbol.toStringTag,{value:"Module"}));function vo(n){let t=n,p=0,o=0,l=Date.now();const c=()=>t<=0?0:Math.ceil(6e4/t);return{async acquire(){if(t<=0)return;const s=Date.now(),i=c();if(s-l>=6e4&&(l=s,o=0),o>=t){const P=6e4-(s-l);P>0&&await Jo(P),l=Date.now(),o=0}const k=s-p;k<i&&await Jo(i-k),p=Date.now(),o++},reset(){p=0,o=0,l=Date.now()},getRpm(){return t},setRpm(s){t=s,this.reset()}}}function Jo(n){return new Promise(t=>setTimeout(t,n))}function kl(n){return n.includes(",")&&n.split(",")[1]||n}function no(n){if(n.isManuallyAnnotated){const t=n.bubbleStates||[];return{coords:t.map(p=>p.coords),angles:t.map(p=>p.rotationAngle||0),isEmpty:t.length===0,isManual:!0}}return Array.isArray(n.bubbleStates)&&n.bubbleStates.length>0?{coords:n.bubbleStates.map(t=>t.coords),angles:n.bubbleStates.map(t=>t.rotationAngle||0),isEmpty:!1,isManual:!1}:Array.isArray(n.bubbleCoords)&&n.bubbleCoords.length>0?{coords:n.bubbleCoords,angles:n.bubbleAngles,isEmpty:!1,isManual:!1}:null}function so(n,t={}){const p=Je(),{settings:o}=p,{textStyle:l,translation:c,baiduOcr:s,aiVisionOcr:i,boxExpand:k,preciseMask:P}=o,w={image:kl(n),ocr_engine:o.ocrEngine,source_language:o.sourceLanguage,model_provider:c.provider,api_key:c.apiKey,model_name:c.modelName,custom_base_url:c.customBaseUrl,target_language:o.targetLanguage,prompt_content:o.translatePrompt,textbox_prompt_content:o.textboxPrompt,use_textbox_prompt:o.useTextboxPrompt,rpm_limit_translation:c.rpmLimit,max_retries:c.maxRetries,use_json_format_translation:c.isJsonMode,detector_type:o.textDetector,box_expand_ratio:k.ratio,box_expand_top:k.top,box_expand_bottom:k.bottom,box_expand_left:k.left,box_expand_right:k.right,usePreciseMask:P.enabled,maskDilateSize:P.dilateSize,maskBoxExpandRatio:P.boxExpandRatio,fontSize:l.fontSize,autoFontSize:l.autoFontSize,fontFamily:l.fontFamily,textDirection:l.layoutDirection==="auto"?"vertical":l.layoutDirection,autoTextDirection:l.layoutDirection==="auto",textColor:l.textColor,fillColor:l.fillColor,strokeEnabled:l.strokeEnabled,strokeColor:l.strokeColor,strokeWidth:l.strokeWidth,useAutoTextColor:l.useAutoTextColor??!0,use_inpainting:!1,use_lama:l.inpaintMethod==="lama_mpe"||l.inpaintMethod==="litelama",lamaModel:l.inpaintMethod==="litelama"?"litelama":"lama_mpe",showDetectionDebug:o.showDetectionDebug,remove_only:t.removeTextOnly,skip_translation:t.removeTextOnly},O=Y=>Y.map(J=>[Math.round(J[0]),Math.round(J[1]),Math.round(J[2]),Math.round(J[3])]);return t.existingBubbleStates&&t.existingBubbleStates.length>0?(w.bubble_coords=O(t.existingBubbleStates.map(Y=>Y.coords)),w.bubble_angles=t.existingBubbleStates.map(Y=>Y.rotationAngle||0)):t.existingBubbleCoords&&(w.bubble_coords=O(t.existingBubbleCoords),w.bubble_angles=t.existingBubbleAngles),o.ocrEngine==="baidu_ocr"&&(w.baidu_api_key=s.apiKey,w.baidu_secret_key=s.secretKey,w.baidu_version=s.version,w.baidu_ocr_language=s.sourceLanguage),o.ocrEngine==="ai_vision"&&(w.ai_vision_provider=i.provider,w.ai_vision_api_key=i.apiKey,w.ai_vision_model_name=i.modelName,w.ai_vision_ocr_prompt=i.prompt,w.rpm_limit_ai_vision_ocr=i.rpmLimit,w.custom_ai_vision_base_url=i.customBaseUrl,w.use_json_format_ai_vision_ocr=i.isJsonMode),w}function _l(n){const t=Je(),{textStyle:p}=t.settings;if(!n.bubble_coords||n.bubble_coords.length===0)return null;const o={bubble_coords:n.bubble_coords,bubble_states:n.bubble_states,original_texts:n.original_texts,bubble_texts:n.bubble_texts,textbox_texts:n.textbox_texts,bubble_angles:n.bubble_angles,auto_directions:n.auto_directions},l={fontSize:p.fontSize,fontFamily:p.fontFamily,textDirection:p.layoutDirection==="auto"?"vertical":p.layoutDirection,textColor:p.textColor,fillColor:p.fillColor,strokeEnabled:p.strokeEnabled,strokeColor:p.strokeColor,strokeWidth:p.strokeWidth,inpaintMethod:p.inpaintMethod};return ln(o,l)}function Pt(){return"session_"+Date.now()+"_"+Math.random().toString(36).substring(2,9)}function rn(n,t,p){return n.filter(o=>o.imageIndex>=t&&o.imageIndex<p)}function un(n){if(!n||n.length===0)return[];const t=[];for(const p of n){if(!p){console.warn("mergeJsonResults: è·³è¿‡ç©ºçš„æ‰¹æ¬¡ç»“æœ");continue}const o=Array.isArray(p)?p:[p];for(const l of o)l&&typeof l=="object"&&"imageIndex"in l?t.push(l):console.warn("mergeJsonResults: è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡æ•°æ®",l)}return t.sort((p,o)=>p.imageIndex-o.imageIndex),t}function Sl(){const n=et(),t=Je(),p=Ft(),o=rt(),l=S(!1),c=S({current:0,total:0,completed:0,failed:0,isInProgress:!1});let s=[],i=null;function k(){const R=n.images;if(R.length===0)return null;const f=[];for(let I=0;I<R.length;I++){const T=R[I];if(!T)continue;const M=T.originalTexts||[],g={imageIndex:I,bubbles:[]};for(let d=0;d<M.length;d++){const y=M[d]||"";let v="vertical";const C=T.bubbleStates?.[d];if(C&&C.textDirection){const E=C.textDirection;v=E==="auto"?"vertical":E}else T.userLayoutDirection&&T.userLayoutDirection!=="auto"&&(v=T.userLayoutDirection);g.bubbles.push({bubbleIndex:d,original:y,translated:"",textDirection:v})}f.push(g)}return f}function P(){return n.images.map(R=>{const f=R.originalDataURL;return f.includes(",")?f.split(",")[1]||"":f})}async function w(R,f,I){const{hqTranslation:T}=t.settings,M=JSON.stringify(f,null,2),g=[{type:"text",text:T.prompt+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®:
\`\`\`json
`+M+"\n```"}];for(const v of R)g.push({type:"image_url",image_url:{url:`data:image/png;base64,${v}`}});const d=[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹å’Œä¸Šä¸‹æ–‡æä¾›é«˜è´¨é‡çš„ç¿»è¯‘ã€‚"},{role:"user",content:g}],y={provider:T.provider,api_key:T.apiKey,model_name:T.modelName,custom_base_url:T.customBaseUrl,messages:d,low_reasoning:T.lowReasoning,force_json_output:T.forceJsonOutput,no_thinking_method:T.noThinkingMethod,use_stream:T.useStream};try{console.log(`é«˜è´¨é‡ç¿»è¯‘: é€šè¿‡åç«¯ä»£ç†è°ƒç”¨ ${T.provider} API...`);const v=await co(y);if(!v.success)throw new Error(v.error||"API è°ƒç”¨å¤±è´¥");if(v.results&&v.results.length>0){const E=v.results[0];if(E&&"imageIndex"in E&&"bubbles"in E)return v.results}const C=v.content;if(C)if(T.forceJsonOutput)try{return JSON.parse(C)}catch(E){throw console.error("è§£æAIå¼ºåˆ¶JSONè¿”å›çš„å†…å®¹å¤±è´¥:",E),new Error("è§£æAIè¿”å›çš„JSONç»“æœå¤±è´¥")}else{const E=C.match(/```json\s*([\s\S]*?)\s*```/);if(E&&E[1])try{return JSON.parse(E[1])}catch(q){throw console.error("è§£æAIè¿”å›çš„JSONå¤±è´¥:",q),new Error("è§£æAIè¿”å›çš„ç¿»è¯‘ç»“æœå¤±è´¥")}}return null}catch(v){throw console.error("è°ƒç”¨AIç¿»è¯‘APIå¤±è´¥:",v),v}}async function O(){const R=n.images.length;let f=0;c.value.label=`æ¶ˆé™¤æ–‡å­—: 0/${R}`,c.value.percentage=0;for(let I=0;I<R;I++){const T=Math.floor(I/R*25);c.value.label=`æ¶ˆé™¤æ–‡å­—: ${I+1}/${R}`,c.value.percentage=T,n.setTranslationStatus(I,"processing");const M=n.images[I];if(!M||!M.originalDataURL){n.setTranslationStatus(I,"pending");continue}const g=no(M);if(g?.isEmpty){console.log(`é«˜è´¨é‡ç¿»è¯‘[${I}]: æ–‡æœ¬æ¡†å·²è¢«ç”¨æˆ·æ¸…ç©ºï¼Œè·³è¿‡æ­¤å›¾ç‰‡`),n.setTranslationStatus(I,"pending");continue}if(g){const d=g.isManual?"æ‰‹åŠ¨æ ‡æ³¨æ¡†":"å·²æœ‰æ–‡æœ¬æ¡†";console.log(`é«˜è´¨é‡ç¿»è¯‘[${I}]: ä½¿ç”¨${d} ${g.coords.length} ä¸ª`)}try{const d=so(M.originalDataURL,{removeTextOnly:!0,existingBubbleCoords:g?.coords,existingBubbleAngles:g?.angles,useExistingBubbles:!!g}),y=await Et(d);if(y.translated_image){const v=i?.textDirection,C=v==="vertical"||v==="horizontal"||v==="auto"?v:"vertical",E=y.bubble_coords?ln(y,{fontSize:i?.fontSize||t.settings.textStyle.fontSize,fontFamily:i?.fontFamily||t.settings.textStyle.fontFamily,textDirection:C,textColor:i?.textColor||t.settings.textStyle.textColor,fillColor:i?.fillColor||t.settings.textStyle.fillColor,strokeEnabled:i?.strokeEnabled??t.settings.textStyle.strokeEnabled,strokeColor:i?.strokeColor||t.settings.textStyle.strokeColor,strokeWidth:i?.strokeWidth??t.settings.textStyle.strokeWidth,inpaintMethod:t.settings.textStyle.inpaintMethod}):[];n.updateImageByIndex(I,{translatedDataURL:`data:image/png;base64,${y.translated_image}`,cleanImageData:y.clean_image||null,bubbleCoords:y.bubble_coords||[],bubbleAngles:y.bubble_angles||[],originalTexts:y.original_texts||[],textboxTexts:y.textbox_texts||[],bubbleStates:E,bubbleTexts:E.map(q=>q.translatedText||""),translationFailed:!1,translationStatus:"completed",showOriginal:!1,hasUnsavedChanges:!0}),console.log(`é«˜è´¨é‡ç¿»è¯‘-æ¶ˆé™¤æ–‡å­—[${I+1}/${R}]: å¤„ç†å®Œæˆ`)}else f++,n.updateImageByIndex(I,{translationFailed:!0,translationStatus:"failed"})}catch(d){console.error(`å›¾ç‰‡ ${I} æ¶ˆé™¤æ–‡å­—å¤±è´¥:`,d),f++,n.updateImageByIndex(I,{translationFailed:!0,translationStatus:"failed"})}}if(c.value.label="æ¶ˆé™¤æ–‡å­—å®Œæˆ",c.value.percentage=25,f>0)throw new Error(`æ¶ˆé™¤æ–‡å­—å®Œæˆï¼Œä½†æœ‰ ${f} å¼ å›¾ç‰‡å¤±è´¥`)}async function Y(R){if(!R||R.length===0)throw new Error("æ²¡æœ‰æœ‰æ•ˆçš„ç¿»è¯‘æ•°æ®å¯å¯¼å…¥");const f=n.images,I=n.currentImageIndex,T=i?.fontSize||t.settings.textStyle.fontSize,M=i?.autoFontSize??t.settings.textStyle.autoFontSize,g=i?.fontFamily||t.settings.textStyle.fontFamily,d=i?.textDirection||t.settings.textStyle.layoutDirection,y=d==="auto"?"vertical":d,v=i?.textColor||t.settings.textStyle.textColor,C=i?.fillColor||t.settings.textStyle.fillColor,E=i?.strokeEnabled??t.settings.textStyle.strokeEnabled,q=i?.strokeColor||t.settings.textStyle.strokeColor,B=i?.strokeWidth??t.settings.textStyle.strokeWidth;c.value.label="æ›´æ–°å›¾ç‰‡æ•°æ®...",c.value.percentage=90;const H=R.length;let V=0;for(const x of R){V++,c.value.label=`å¤„ç†å›¾ç‰‡ ${V}/${H}`,c.value.percentage=90+V/H*5;const b=x.imageIndex;if(b<0||b>=f.length){console.warn(`è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${b}`);continue}const $=f[b];if(!$)continue;let a=!1;const u=$.bubbleTexts||[],h=$.bubbleCoords||[];for(const W of x.bubbles||[]){const A=W.bubbleIndex;if(A<0||A>=h.length){console.warn(`å›¾ç‰‡ ${b}: è·³è¿‡æ— æ•ˆçš„æ°”æ³¡ç´¢å¼• ${A}`);continue}const U=W.translated;let G=W.textDirection;G==="auto"&&(G=y),u[A]=U;const D=G==="vertical"||G==="horizontal"?G:y;if(!$.bubbleStates||!Array.isArray($.bubbleStates)||$.bubbleStates.length!==h.length){const m=$.bubbleAngles||[],N=[];for(let r=0;r<h.length;r++){const _=r===A?D:y,re=h[r];let F=_;const te=$.bubbleStates?.[r];if(te?.autoTextDirection&&te.autoTextDirection!=="auto")F=te.autoTextDirection;else if(re&&re.length>=4){const[de,_e,$e,Pe]=re;F=Pe-_e>$e-de?"vertical":"horizontal"}N.push({translatedText:u[r]||"",originalText:$.originalTexts?.[r]||"",textboxText:"",coords:re,polygon:[],fontSize:T,fontFamily:g,textDirection:_,autoTextDirection:F,position:{x:0,y:0},textColor:v,rotationAngle:m[r]||0,fillColor:C,strokeEnabled:E,strokeColor:q,strokeWidth:B,inpaintMethod:t.settings.textStyle.inpaintMethod})}$.bubbleStates=N}else if($.bubbleStates[A])$.bubbleStates[A].translatedText=U,G&&G!=="auto"&&($.bubbleStates[A].textDirection=D);else{const N=($.bubbleAngles||[])[A]||0,r=h[A];let _=D;if(r&&r.length>=4){const[re,F,te,de]=r;_=de-F>te-re?"vertical":"horizontal"}$.bubbleStates[A]={translatedText:U,originalText:$.originalTexts?.[A]||"",textboxText:"",coords:r,polygon:[],fontSize:T,fontFamily:g,textDirection:D,autoTextDirection:_,position:{x:0,y:0},textColor:v,rotationAngle:N,fillColor:C,strokeEnabled:E,strokeColor:q,strokeWidth:B,inpaintMethod:t.settings.textStyle.inpaintMethod}}a=!0}if(a&&$.bubbleStates){const W=$.bubbleStates.map(A=>A.translatedText||"");if($.cleanImageData)try{const{apiClient:A}=await nt(async()=>{const{apiClient:m}=await import("./client.Bht704G-.js");return{apiClient:m}},__vite__mapDeps([4,5])),U=$.bubbleStates.map(m=>({translatedText:m.translatedText||"",coords:m.coords,fontSize:m.fontSize||T,fontFamily:m.fontFamily||g,textDirection:m.textDirection||y,textColor:m.textColor||v,rotationAngle:m.rotationAngle||0,position:m.position||{x:0,y:0},strokeEnabled:m.strokeEnabled??E,strokeColor:m.strokeColor||q,strokeWidth:m.strokeWidth??B}));let G=$.cleanImageData;G.includes("base64,")&&(G=G.split("base64,")[1]||"");const D=await A.post("/api/re_render_image",{clean_image:G,bubble_texts:W,bubble_coords:h,fontSize:M?"auto":T,autoFontSize:M,fontFamily:g,textDirection:y,textColor:v,bubble_states:U,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!1,strokeEnabled:E,strokeColor:q,strokeWidth:B});D.rendered_image&&(n.updateImageByIndex(b,{translatedDataURL:`data:image/png;base64,${D.rendered_image}`,bubbleStates:$.bubbleStates,bubbleTexts:W,hasUnsavedChanges:!0}),console.log(`å·²å®Œæˆå›¾ç‰‡ ${b} çš„æ¸²æŸ“`))}catch(A){console.error(`é‡æ–°æ¸²æŸ“å›¾ç‰‡ ${b} å¤±è´¥:`,A)}else n.updateImageByIndex(b,{bubbleStates:$.bubbleStates,bubbleTexts:W,hasUnsavedChanges:!0})}}I>=0&&I<f.length&&n.setCurrentImageIndex(I)}async function J(){if(n.images.length===0)return o.warning("è¯·å…ˆæ·»åŠ å›¾ç‰‡"),!1;if(n.isBatchTranslationInProgress)return o.warning("è¯·ç­‰å¾…å½“å‰æ‰¹é‡æ“ä½œå®Œæˆ"),!1;if(!p.validateBeforeTranslation("hq"))return!1;const{hqTranslation:R,textStyle:f}=t.settings,I=f.layoutDirection;i={fontFamily:f.fontFamily,fontSize:f.fontSize,autoFontSize:f.autoFontSize,autoTextDirection:I==="auto",textDirection:I==="auto"?"vertical":I,fillColor:f.fillColor,textColor:f.textColor,rotationAngle:0,strokeEnabled:f.strokeEnabled,strokeColor:f.strokeColor,strokeWidth:f.strokeWidth},console.log("é«˜è´¨é‡ç¿»è¯‘å‰ä¿å­˜çš„æ–‡æœ¬æ ·å¼è®¾ç½®:",i),c.value={current:0,total:n.images.length,completed:0,failed:0,isInProgress:!0,label:"å‡†å¤‡ç¿»è¯‘...",percentage:0},o.info("æ­¥éª¤1/4: æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡æ–‡å­—..."),l.value=!0,n.setBatchTranslationInProgress(!0);try{await O(),o.info("æ­¥éª¤2/4: å¯¼å‡ºæ–‡æœ¬æ•°æ®..."),c.value.label="å¯¼å‡ºæ–‡æœ¬æ•°æ®...",c.value.percentage=25;const T=k();if(!T)throw new Error("å¯¼å‡ºæ–‡æœ¬å¤±è´¥");o.info("æ­¥éª¤3/4: å‡†å¤‡å›¾ç‰‡æ•°æ®..."),c.value.label="å‡†å¤‡å›¾ç‰‡æ•°æ®...",c.value.percentage=40;const M=P();o.info("æ­¥éª¤4/4: å‘é€åˆ°AIè¿›è¡Œç¿»è¯‘..."),c.value.label="å¼€å§‹å‘é€åˆ°AI...",c.value.percentage=50;const g=R.batchSize||3,d=R.sessionReset||5,y=R.maxRetries??2;s=[];const v=M.length,C=Math.ceil(v/g),E=R.rpmLimit||0,q=E>0?vo(E):null;let B=0,H=Pt();for(let V=0;V<C;V++){c.value.label=`${V+1}/${C}`,c.value.percentage=Math.round(50+V/C*40),B>=d&&(console.log("é‡ç½®ä¼šè¯ä¸Šä¸‹æ–‡"),H=Pt(),B=0);const x=V*g,b=Math.min(x+g,v),$=M.slice(x,b),a=rn(T,x,b);let u=0,h=!1;for(;u<=y&&!h;)try{q&&await q.acquire();const W=await w($,a,H);if(W)s.push(W),h=!0;else{if(u++,u>y)break;await new Promise(A=>setTimeout(A,1e3));continue}B++}catch(W){u++,u<=y?(console.log(`æ‰¹æ¬¡ ${V+1} ç¿»è¯‘å¤±è´¥ï¼Œç¬¬ ${u}/${y} æ¬¡é‡è¯•...`),o.warning(`æ‰¹æ¬¡ ${V+1} å¤±è´¥ï¼Œæ­£åœ¨é‡è¯• (${u}/${y})...`),await new Promise(A=>setTimeout(A,1e3))):(console.error(`æ‰¹æ¬¡ ${V+1} ç¿»è¯‘æœ€ç»ˆå¤±è´¥:`,W),o.error(`æ‰¹æ¬¡ ${V+1} ç¿»è¯‘å¤±è´¥: ${W instanceof Error?W.message:"æœªçŸ¥é”™è¯¯"}`))}}return o.info("ç¿»è¯‘å®Œæˆï¼Œæ­£åœ¨å¯¼å…¥ç¿»è¯‘ç»“æœ..."),c.value.label="å¯¼å…¥ç¿»è¯‘ç»“æœ...",c.value.percentage=90,await Y(un(s)),c.value.label="ç¿»è¯‘å®Œæˆï¼",c.value.percentage=100,o.success("é«˜è´¨é‡ç¿»è¯‘å®Œæˆï¼"),!0}catch(T){return console.error("é«˜è´¨é‡ç¿»è¯‘è¿‡ç¨‹å‡ºé”™:",T),o.error(`ç¿»è¯‘å¤±è´¥: ${T instanceof Error?T.message:"æœªçŸ¥é”™è¯¯"}`),!1}finally{l.value=!1,n.setBatchTranslationInProgress(!1),setTimeout(()=>{c.value.isInProgress=!1},1e3)}}return{isHqTranslating:l,progress:c,executeHqTranslation:J}}function Cl(){const n=et(),t=Je(),p=Ft(),o=rt(),l=S(!1),c=S({current:0,total:0,completed:0,failed:0,isInProgress:!1});let s=[];function i(){const Y=n.images;if(Y.length===0)return null;const J=[];for(let R=0;R<Y.length;R++){const f=Y[R];if(!f)continue;const I=f.originalTexts||[],T=f.bubbleTexts||[],M={imageIndex:R,bubbles:[]};for(let g=0;g<I.length;g++){const d=I[g]||"",y=(g<T.length?T[g]:"")||"";let v="vertical";const C=f.bubbleStates?.[g];if(C&&C.textDirection){const E=C.textDirection;v=E==="auto"?"vertical":E}else f.userLayoutDirection&&f.userLayoutDirection!=="auto"&&(v=f.userLayoutDirection);M.bubbles.push({bubbleIndex:g,original:d,translated:y,textDirection:v})}J.push(M)}return J}function k(){return n.images.map(Y=>{const J=Y.originalDataURL;return J.includes(",")?J.split(",")[1]||"":J})}async function P(Y,J,R,f){const I=JSON.stringify(J,null,2),T=[{type:"text",text:R.prompt+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®ï¼ŒåŒ…å«åŸæ–‡å’Œå·²æœ‰è¯‘æ–‡:
\`\`\`json
`+I+"\n```\nè¯·åœ¨ä¿æŒJSONæ ¼å¼çš„æƒ…å†µä¸‹ï¼Œæ ¡å¯¹æ¯ä¸ªbubbleçš„translatedå­—æ®µï¼Œä½¿ç¿»è¯‘æ›´åŠ å‡†ç¡®ã€è‡ªç„¶ã€ç¬¦åˆè¯­å¢ƒã€‚"}];for(const g of Y)T.push({type:"image_url",image_url:{url:`data:image/png;base64,${g}`}});const M={provider:R.provider,api_key:R.apiKey,model_name:R.modelName,custom_base_url:R.customBaseUrl,messages:[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘æ ¡å¯¹åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹å’Œä¸Šä¸‹æ–‡å¯¹å·²æœ‰ç¿»è¯‘è¿›è¡Œæ ¡å¯¹å’Œæ¶¦è‰²ã€‚"},{role:"user",content:T}],low_reasoning:R.lowReasoning,no_thinking_method:R.noThinkingMethod,force_json_output:R.forceJsonOutput};try{console.log(`AIæ ¡å¯¹: é€šè¿‡åç«¯ä»£ç†è°ƒç”¨ ${R.provider} API...`);const g=await co(M);if(!g.success)throw new Error(g.error||"API è°ƒç”¨å¤±è´¥");if(g.results&&g.results.length>0){const y=g.results[0];if(y&&"imageIndex"in y&&"bubbles"in y)return g.results}const d=g.content;if(d)if(R.forceJsonOutput)try{return JSON.parse(d)}catch(y){throw console.error("è§£æAIå¼ºåˆ¶JSONè¿”å›çš„å†…å®¹å¤±è´¥:",y),new Error("è§£æAIè¿”å›çš„JSONç»“æœå¤±è´¥")}else{const y=d.match(/```json\s*([\s\S]*?)\s*```/);if(y&&y[1])try{return JSON.parse(y[1])}catch(v){throw console.error("è§£æAIè¿”å›çš„JSONå¤±è´¥:",v),new Error("è§£æAIè¿”å›çš„æ ¡å¯¹ç»“æœå¤±è´¥")}try{return JSON.parse(d)}catch(v){throw console.error("ç›´æ¥è§£æAIè¿”å›å†…å®¹å¤±è´¥:",v),new Error("æ— æ³•è§£æAIè¿”å›çš„æ ¡å¯¹ç»“æœ")}}return null}catch(g){throw console.error("è°ƒç”¨AIæ ¡å¯¹APIå¤±è´¥:",g),g}}async function w(Y){if(!Y||Y.length===0){console.warn("æ²¡æœ‰æœ‰æ•ˆçš„æ ¡å¯¹æ•°æ®å¯å¯¼å…¥"),o.warning("æ²¡æœ‰æœ‰æ•ˆçš„æ ¡å¯¹ç»“æœå¯å¯¼å…¥");return}const J=n.images,R=n.currentImageIndex,{textStyle:f}=t.settings,I=f.fontSize,T=f.fontFamily,M=f.layoutDirection,g=M==="auto"?"vertical":M,d=f.textColor,y=f.fillColor,v=f.strokeEnabled,C=f.strokeColor,E=f.strokeWidth;for(const q of Y){const B=q.imageIndex;if(B<0||B>=J.length){console.warn(`è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${B}`);continue}const H=J[B];if(!H)continue;if(!q.bubbles||!Array.isArray(q.bubbles)||q.bubbles.length===0){console.warn(`å›¾ç‰‡ ${B}: æ²¡æœ‰æœ‰æ•ˆçš„æ°”æ³¡æ•°æ®`);continue}let V=!1;const x=H.bubbleTexts||[],b=H.bubbleCoords||[];for(const $ of q.bubbles){const a=$.bubbleIndex,u=$.translated||"";let h=$.textDirection;if((!h||h==="auto")&&(h=g),a<0||a>=b.length){console.warn(`å›¾ç‰‡ ${B}: è·³è¿‡æ— æ•ˆçš„æ°”æ³¡ç´¢å¼• ${a}`);continue}for(;x.length<=a;)x.push("");if(x[a]=u,h&&h!=="auto"){const W=h==="vertical"||h==="horizontal"?h:g;if(!H.bubbleStates||!Array.isArray(H.bubbleStates)||H.bubbleStates.length!==b.length){const A=H.bubbleAngles||[],U=[];for(let G=0;G<b.length;G++){const D=G===a?W:g,m=b[G];let N=D;const r=H.bubbleStates?.[G];if(r?.autoTextDirection&&r.autoTextDirection!=="auto")N=r.autoTextDirection;else if(m&&m.length>=4){const[_,re,F,te]=m;N=te-re>F-_?"vertical":"horizontal"}U.push({translatedText:x[G]||"",originalText:H.originalTexts?.[G]||"",coords:m,fontSize:I,fontFamily:T,textDirection:D,autoTextDirection:N,position:{x:0,y:0},textColor:d,rotationAngle:A[G]||0,fillColor:y,strokeEnabled:v,strokeColor:C,strokeWidth:E})}H.bubbleStates=U}else H.bubbleStates[a]&&(H.bubbleStates[a].translatedText=u,H.bubbleStates[a].textDirection=W)}V=!0}if(V&&H.bubbleStates){const $=H.bubbleStates.map(a=>a.translatedText||"");if(H.cleanImageData)try{const{apiClient:a}=await nt(async()=>{const{apiClient:A}=await import("./client.Bht704G-.js");return{apiClient:A}},__vite__mapDeps([4,5])),u=H.bubbleStates.map(A=>({translatedText:A.translatedText||"",coords:A.coords,fontSize:A.fontSize||I,fontFamily:A.fontFamily||T,textDirection:A.textDirection||g,textColor:A.textColor||d,rotationAngle:A.rotationAngle||0,position:A.position||{x:0,y:0},strokeEnabled:A.strokeEnabled??v,strokeColor:A.strokeColor||C,strokeWidth:A.strokeWidth??E}));let h=H.cleanImageData;h.includes("base64,")&&(h=h.split("base64,")[1]||"");const W=await a.post("/api/re_render_image",{clean_image:h,bubble_texts:$,bubble_coords:b,fontSize:I,fontFamily:T,textDirection:g,textColor:d,bubble_states:u,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!1,strokeEnabled:v,strokeColor:C,strokeWidth:E});W.rendered_image&&(n.updateImageByIndex(B,{translatedDataURL:`data:image/png;base64,${W.rendered_image}`,bubbleStates:H.bubbleStates,bubbleTexts:$,hasUnsavedChanges:!0}),console.log(`å·²å®Œæˆå›¾ç‰‡ ${B} çš„æ ¡å¯¹æ¸²æŸ“`))}catch(a){console.error(`é‡æ–°æ¸²æŸ“å›¾ç‰‡ ${B} å¤±è´¥:`,a)}else n.updateImageByIndex(B,{bubbleStates:H.bubbleStates,bubbleTexts:$,hasUnsavedChanges:!0})}}R>=0&&R<J.length&&n.setCurrentImageIndex(R)}async function O(){if(!p.validateBeforeTranslation("proofread"))return!1;const{proofreading:Y}=t.settings;if(!Y.enabled||Y.rounds.length===0)return o.error("è¯·å…ˆå¯ç”¨ AI æ ¡å¯¹å¹¶æ·»åŠ æ ¡å¯¹è½®æ¬¡"),!1;const J=n.images;if(J.length===0)return o.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;if(!J.some(I=>I.bubbleTexts&&I.bubbleTexts.length>0))return o.error("è¯·å…ˆè¿›è¡Œç¿»è¯‘ä»¥è·å–è¯‘æ–‡"),!1;l.value=!0,n.setBatchTranslationInProgress(!0);const f=Y.rounds.length;c.value={current:0,total:f,completed:0,failed:0,isInProgress:!0,label:"å‡†å¤‡æ ¡å¯¹...",percentage:0},o.info(`å¼€å§‹æ ¡å¯¹ï¼Œå…± ${f} è½®`);try{for(let I=0;I<f;I++){const T=Y.rounds[I];if(!T)continue;const M=T.name||`è½®æ¬¡${I+1}`,g=I/f*100,d=1/f*100;o.info(`æ ¡å¯¹ç¬¬ ${I+1}/${f} è½®: ${M}`),c.value.label=`è½®æ¬¡ ${I+1}/${f}`,c.value.percentage=Math.round(g),o.info(`è½®æ¬¡ ${I+1}/${f}: å¯¼å‡ºæ–‡æœ¬æ•°æ®...`),c.value.label="å¯¼å‡ºæ–‡æœ¬...",c.value.percentage=Math.round(g+d*.2);const y=i();if(!y)throw new Error("å¯¼å‡ºæ–‡æœ¬å¤±è´¥");o.info(`è½®æ¬¡ ${I+1}/${f}: å‡†å¤‡å›¾ç‰‡æ•°æ®...`),c.value.label="å‡†å¤‡å›¾ç‰‡æ•°æ®...",c.value.percentage=Math.round(g+d*.4);const v=k();o.info(`è½®æ¬¡ ${I+1}/${f}: å‘é€åˆ°AIè¿›è¡Œæ ¡å¯¹...`),c.value.label="å¼€å§‹å‘é€åˆ°AI...",c.value.percentage=Math.round(g+d*.5);const C=T.batchSize||3,E=T.sessionReset||20,q=Y.maxRetries??2;s=[];const B=v.length,H=Math.ceil(B/C),V=T.rpmLimit||7,x=V>0?vo(V):null;let b=0,$=Pt(),a=0;for(let u=0;u<H;u++){const h=g+d*.5+d*.4*(u/H);c.value.label=`è½®æ¬¡ ${I+1}/${f}: ${u+1}/${H}`,c.value.percentage=Math.round(h),b>=E&&(console.log("é‡ç½®ä¼šè¯ä¸Šä¸‹æ–‡"),$=Pt(),b=0);const W=u*C,A=Math.min(W+C,B),U=v.slice(W,A),G=rn(y,W,A);let D=0,m=!1;for(;D<=q&&!m;)try{x&&await x.acquire();const N=await P(U,G,T,$);N&&(s.push(N),a++,m=!0),b++}catch(N){D++,D<=q?(console.log(`è½®æ¬¡ ${I+1}, æ‰¹æ¬¡ ${u+1} æ ¡å¯¹å¤±è´¥ï¼Œç¬¬ ${D}/${q} æ¬¡é‡è¯•...`),o.warning(`è½®æ¬¡ ${I+1}, æ‰¹æ¬¡ ${u+1} å¤±è´¥ï¼Œæ­£åœ¨é‡è¯• (${D}/${q})...`),await new Promise(r=>setTimeout(r,1e3))):(console.error(`è½®æ¬¡ ${I+1}, æ‰¹æ¬¡ ${u+1} æ ¡å¯¹æœ€ç»ˆå¤±è´¥:`,N),o.error(`è½®æ¬¡ ${I+1}, æ‰¹æ¬¡ ${u+1} æ ¡å¯¹å¤±è´¥: ${N instanceof Error?N.message:"æœªçŸ¥é”™è¯¯"}`))}}if(a===0)throw new Error(`è½®æ¬¡ ${I+1} æ ¡å¯¹å®Œå…¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIè®¾ç½®æˆ–æ ¡å¯¹æç¤ºè¯`);o.info(`è½®æ¬¡ ${I+1}/${f}: å¯¼å…¥æ ¡å¯¹ç»“æœ...`),c.value.label="å¯¼å…¥æ ¡å¯¹ç»“æœ...",c.value.percentage=Math.round(g+d*.9),await w(un(s)),c.value.completed++}return c.value.label="æ ¡å¯¹å®Œæˆï¼",c.value.percentage=100,o.success(`AIæ ¡å¯¹å®Œæˆï¼Œå…± ${f} è½®`),!0}catch(I){const T=I instanceof Error?I.message:"AI æ ¡å¯¹å¤±è´¥";return o.error(`æ ¡å¯¹å¤±è´¥: ${T}`),c.value.label="æ ¡å¯¹å·²å–æ¶ˆ",c.value.percentage=0,!1}finally{l.value=!1,n.setBatchTranslationInProgress(!1),setTimeout(()=>{c.value.isInProgress=!1},1e3)}}return{isProofreading:l,progress:c,executeProofreading:O}}function mo(){const n=et(),t=Je(),p=dt(),o=Ft(),l=rt(),c=Sl(),s=Cl(),i=S(null),k=S({current:0,total:0,completed:0,failed:0,isInProgress:!1}),P=S(!1),w=Q(()=>P.value||n.isBatchTranslationInProgress||c.isHqTranslating.value||s.isProofreading.value),O=Q(()=>k.value.total===0?0:Math.round(k.value.completed/k.value.total*100));function Y(){const v=t.settings.translation.rpmLimit;i.value?i.value.setRpm(v):i.value=vo(v)}function J(v,C,E={}){if(C.error||!C.translated_image){n.setTranslationStatus(v,"failed",C.error||"ç¿»è¯‘å¤±è´¥");return}const q=_l(C),B=C.translated_image?`data:image/png;base64,${C.translated_image}`:null,H=t.settings.textStyle.layoutDirection;n.updateImageByIndex(v,{translatedDataURL:B,cleanImageData:C.clean_image||null,bubbleStates:q,bubbleCoords:C.bubble_coords,bubbleAngles:C.bubble_angles||[],originalTexts:C.original_texts,textboxTexts:C.textbox_texts||[],bubbleTexts:q?.map(V=>V.translatedText||"")||[],userLayoutDirection:H,translationStatus:"completed",translationFailed:!1,hasUnsavedChanges:!0}),v===n.currentImageIndex&&q&&p.setBubbles(q)}async function R(v={}){if(v.removeTextOnly){if(!o.validateBeforeTranslation("ocr"))return!1}else if(!o.validateBeforeTranslation("normal"))return!1;const C=n.currentImage;if(!C)return l.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;P.value=!0,n.setTranslationStatus(n.currentImageIndex,"processing");const E=l.showGeneralMessage("ç¿»è¯‘ä¸­...","info",!1,0);try{Y(),i.value&&await i.value.acquire();const q={...v};if(!q.existingBubbleCoords&&!q.existingBubbleStates){const V=no(C);if(V)if(V.isEmpty)console.log("ç¿»è¯‘å½“å‰å›¾ç‰‡: æ–‡æœ¬æ¡†å·²è¢«ç”¨æˆ·æ¸…ç©ºï¼Œå°†è·³è¿‡ç¿»è¯‘"),l.info("è¯¥å›¾ç‰‡æ— æ–‡æœ¬æ¡†ï¼Œè·³è¿‡ç¿»è¯‘",3e3),q.existingBubbleCoords=[],q.existingBubbleAngles=[],q.useExistingBubbles=!0;else{q.existingBubbleCoords=V.coords,q.existingBubbleAngles=V.angles,q.useExistingBubbles=!0;const x=V.isManual?"æ‰‹åŠ¨æ ‡æ³¨æ¡†":"å·²æœ‰çš„æ–‡æœ¬æ¡†";console.log(`ç¿»è¯‘å½“å‰å›¾ç‰‡: ä½¿ç”¨ ${V.coords.length} ä¸ª${x}`),l.info(V.isManual?"æ£€æµ‹åˆ°æ‰‹åŠ¨æ ‡æ³¨æ¡†ï¼Œå°†ä¼˜å…ˆä½¿ç”¨...":"ä½¿ç”¨å·²æœ‰çš„æ–‡æœ¬æ¡†è¿›è¡Œç¿»è¯‘...",3e3)}}const B=so(C.originalDataURL,q),H=await Et(B);return l.clearGeneralMessageById(E),J(n.currentImageIndex,H,v),H.translated_image&&!H.error?(l.success("ç¿»è¯‘æˆåŠŸï¼"),!0):(l.error(H.error||"ç¿»è¯‘å¤±è´¥"),!1)}catch(q){l.clearGeneralMessageById(E);const B=q instanceof Error?q.message:"ç¿»è¯‘è¯·æ±‚å¤±è´¥";return n.markCurrentAsFailed(B),l.error(B),!1}finally{P.value=!1}}async function f(v,C={}){const E=n.images[v];if(!E)return console.error(`å›¾ç‰‡ç´¢å¼• ${v} ä¸å­˜åœ¨`),!1;n.setTranslationStatus(v,"processing");try{i.value&&await i.value.acquire();const q={...C};if(!q.existingBubbleCoords&&!q.existingBubbleStates){const V=no(E);if(V)if(V.isEmpty)console.log(`æ‰¹é‡ç¿»è¯‘å›¾ç‰‡ ${v}: æ–‡æœ¬æ¡†å·²è¢«ç”¨æˆ·æ¸…ç©ºï¼Œè·³è¿‡æ­¤å›¾ç‰‡çš„ç¿»è¯‘`),q.existingBubbleCoords=[],q.existingBubbleAngles=[],q.useExistingBubbles=!0;else{q.existingBubbleCoords=V.coords,q.existingBubbleAngles=V.angles,q.useExistingBubbles=!0;const x=V.isManual?"æ‰‹åŠ¨æ ‡æ³¨æ¡†":"å·²æœ‰çš„æ–‡æœ¬æ¡†";console.log(`æ‰¹é‡ç¿»è¯‘å›¾ç‰‡ ${v}: ä½¿ç”¨ ${V.coords.length} ä¸ª${x}`)}}const B=so(E.originalDataURL,q),H=await Et(B);return J(v,H,C),!!H.translated_image&&!H.error}catch(q){const B=q instanceof Error?q.message:"ç¿»è¯‘è¯·æ±‚å¤±è´¥";return n.setTranslationStatus(v,"failed",B),!1}}async function I(v={}){if(v.removeTextOnly){if(!o.validateBeforeTranslation("ocr"))return!1}else if(!o.validateBeforeTranslation("normal"))return!1;const C=n.images;if(C.length===0)return l.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;const E=v.removeTextOnly===!0;k.value={current:0,total:C.length,completed:0,failed:0,isInProgress:!0,label:E?`æ¶ˆé™¤æ–‡å­—: 0/${C.length}`:`0/${C.length}`,percentage:0},n.setBatchTranslationInProgress(!0),Y(),l.info(E?`å¼€å§‹æ¶ˆé™¤ ${C.length} å¼ å›¾ç‰‡æ–‡å­—...`:`å¼€å§‹æ‰¹é‡ç¿»è¯‘ ${C.length} å¼ å›¾ç‰‡...`);let q=!0;try{for(let B=0;B<C.length;B++){if(!n.isBatchTranslationInProgress){console.log("æ‰¹é‡ç¿»è¯‘å·²å–æ¶ˆ");break}k.value.current=B+1,k.value.label=E?`æ¶ˆé™¤æ–‡å­—: ${B+1}/${C.length}`:`${B+1}/${C.length}`,k.value.percentage=Math.round((B+1)/C.length*100),await f(B,v)?k.value.completed++:(k.value.failed++,q=!1)}return k.value.failed>0?l.warning(E?`æ¶ˆé™¤æ–‡å­—å®Œæˆï¼Œ${k.value.failed} å¼ å›¾ç‰‡å¤±è´¥`:`ç¿»è¯‘å®Œæˆï¼Œ${k.value.failed} å¼ å›¾ç‰‡å¤±è´¥`):l.success(E?"æ‰€æœ‰å›¾ç‰‡æ–‡å­—æ¶ˆé™¤å®Œæˆ":"æ‰€æœ‰å›¾ç‰‡ç¿»è¯‘å®Œæˆ"),q}catch(B){const H=B instanceof Error?B.message:"æ‰¹é‡ç¿»è¯‘å¤±è´¥";return l.error(H),!1}finally{n.setBatchTranslationInProgress(!1);const B=n.currentImageIndex;if(B>=0&&B<n.images.length){const H=n.images[B];H&&(H.bubbleStates&&H.bubbleStates.length>0&&p.setBubbles(H.bubbleStates),n.setCurrentImageIndex(B))}setTimeout(()=>{k.value.isInProgress=!1},1e3)}}function T(){n.isBatchTranslationInProgress&&(n.setBatchTranslationInProgress(!1),k.value.isInProgress=!1,l.info("æ‰¹é‡ç¿»è¯‘å·²å–æ¶ˆ"))}async function M(){return R({removeTextOnly:!0})}async function g(){return I({removeTextOnly:!0})}async function d(v={}){if(!o.validateBeforeTranslation("normal"))return!1;const C=n.getFailedImageIndices();if(C.length===0)return l.info("æ²¡æœ‰å¤±è´¥çš„å›¾ç‰‡éœ€è¦é‡æ–°ç¿»è¯‘"),!0;k.value={current:0,total:C.length,completed:0,failed:0,isInProgress:!0},n.setBatchTranslationInProgress(!0),Y();let E=!0;try{for(let q=0;q<C.length&&n.isBatchTranslationInProgress;q++){k.value.current=q+1;const B=C[q];if(B===void 0)continue;await f(B,v)?k.value.completed++:(k.value.failed++,E=!1)}return k.value.failed>0?l.warning(`é‡è¯•å®Œæˆï¼Œä»æœ‰ ${k.value.failed} å¼ å›¾ç‰‡å¤±è´¥`):l.success("æ‰€æœ‰å¤±è´¥å›¾ç‰‡é‡æ–°ç¿»è¯‘å®Œæˆ"),E}catch(q){const B=q instanceof Error?q.message:"é‡è¯•ç¿»è¯‘å¤±è´¥";return l.error(B),!1}finally{n.setBatchTranslationInProgress(!1),setTimeout(()=>{k.value.isInProgress=!1},1e3)}}async function y(){if(!n.currentImage)return l.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;const C=p.bubbles;return!C||C.length===0?(l.error("å½“å‰å›¾ç‰‡æ²¡æœ‰æ°”æ³¡æ¡†ï¼Œè¯·å…ˆæ£€æµ‹æˆ–æ‰‹åŠ¨æ·»åŠ "),!1):R({useExistingBubbles:!0,existingBubbleStates:C})}return{progress:k,isTranslatingSingle:P,isHqTranslating:c.isHqTranslating,isProofreading:s.isProofreading,isTranslating:w,progressPercent:O,translateCurrentImage:R,translateImageByIndex:f,translateAllImages:I,cancelBatchTranslation:T,removeTextOnly:M,removeAllTexts:g,retryFailedImages:d,executeHqTranslation:c.executeHqTranslation,executeProofreading:s.executeProofreading,translateWithCurrentBubbles:y}}function wl(){const n=dt(),t=et(),p=S(!1);function o(){if(!p.value)return;const l=t.currentImage;n.bubbleCount>0?t.updateCurrentBubbleStates([...n.bubbles]):l&&Array.isArray(l.bubbleStates)&&l.bubbleStates.length>0&&(t.updateCurrentBubbleStates([]),console.log("é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼ˆæ— é‡æ¸²æŸ“ï¼‰ï¼Œç”¨æˆ·å·²åˆ é™¤æ‰€æœ‰æ°”æ³¡")),p.value=!1,n.clearSelection(),console.log("å·²é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼ˆæ— é‡æ¸²æŸ“ï¼‰")}return{isActive:p,exitEditModeWithoutRender:o}}function $l(){const n=Zo(),t=Je(),p=et(),o=nn(),l=dt(),c=wl(),s=S(!1),i=S(!1),k=S(null),P=S([]),w=S([]),O=S([]),Y=S(null),J=S(null),R=S(null),f=S(null),I=S(!1);async function T(V=!1){if(!V&&(s.value||i.value)){console.log("[TranslateInit] å·²ç»åˆå§‹åŒ–ï¼Œä»…é‡æ–°åŠ è½½ä¸Šä¸‹æ–‡"),await v();return}console.log("[TranslateInit] å¼€å§‹åˆå§‹åŒ–åº”ç”¨..."),s.value=!0,k.value=null;try{await M(),await g(),await d(),await y(),await v(),console.log("[TranslateInit] åº”ç”¨åˆå§‹åŒ–å®Œæˆ"),i.value=!0}catch(x){console.error("[TranslateInit] åº”ç”¨åˆå§‹åŒ–å¤±è´¥:",x),k.value=x instanceof Error?x.message:"åˆå§‹åŒ–å¤±è´¥"}finally{s.value=!1}}async function M(){console.log("[TranslateInit] åˆå§‹åŒ–è®¾ç½®..."),t.initSettings();try{const V=await t.loadFromBackend();console.log(V?"[TranslateInit] å·²ä»åç«¯åŠ è½½è®¾ç½®":"[TranslateInit] åç«¯æ— è®¾ç½®ï¼Œä½¿ç”¨ localStorage æ•°æ®")}catch(V){console.warn("[TranslateInit] ä»åç«¯åŠ è½½è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨ localStorage æ•°æ®:",V)}console.log("[TranslateInit] è®¾ç½®åˆå§‹åŒ–å®Œæˆ")}async function g(){console.log("[TranslateInit] åˆå§‹åŒ–å­—ä½“åˆ—è¡¨...");try{const V=await en();V.fonts&&V.fonts.length>0?(P.value=V.fonts,console.log(`[TranslateInit] å·²åŠ è½½ ${V.fonts.length} ä¸ªå­—ä½“`)):V.error?console.warn("[TranslateInit] è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:",V.error):console.warn("[TranslateInit] å­—ä½“åˆ—è¡¨ä¸ºç©º")}catch(V){console.error("[TranslateInit] è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:",V)}}async function d(){console.log("[TranslateInit] åˆå§‹åŒ–ç¿»è¯‘æç¤ºè¯è®¾ç½®...");try{const V=await is();V.prompt_names!==void 0?(w.value=V.prompt_names||[],!t.settings.translatePrompt&&V.default_prompt_content&&t.setTranslatePrompt(V.default_prompt_content),console.log(`[TranslateInit] å·²åŠ è½½ ${w.value.length} ä¸ªç¿»è¯‘æç¤ºè¯`)):V.error&&console.warn("[TranslateInit] è·å–ç¿»è¯‘æç¤ºè¯å¤±è´¥:",V.error)}catch(V){console.error("[TranslateInit] è·å–ç¿»è¯‘æç¤ºè¯å¤±è´¥:",V)}}async function y(){console.log("[TranslateInit] åˆå§‹åŒ–æ–‡æœ¬æ¡†æç¤ºè¯è®¾ç½®...");try{const V=await ls();V.prompt_names!==void 0?(O.value=V.prompt_names||[],!t.settings.textboxPrompt&&V.default_prompt_content&&t.setTextboxPrompt(V.default_prompt_content),console.log(`[TranslateInit] å·²åŠ è½½ ${O.value.length} ä¸ªæ–‡æœ¬æ¡†æç¤ºè¯`)):V.error&&console.warn("[TranslateInit] è·å–æ–‡æœ¬æ¡†æç¤ºè¯å¤±è´¥:",V.error)}catch(V){console.error("[TranslateInit] è·å–æ–‡æœ¬æ¡†æç¤ºè¯å¤±è´¥:",V)}}async function v(){const V=n.query.book,x=n.query.chapter;if(!V||!x){console.log("[TranslateInit] æœªæŒ‡å®šä¹¦ç±/ç« èŠ‚å‚æ•°ï¼Œä½¿ç”¨ç‹¬ç«‹æ¨¡å¼"),I.value=!1,Y.value=null,J.value=null,R.value=null,f.value=null,o.clearContext();return}console.log(`[TranslateInit] æ£€æµ‹åˆ°ä¹¦ç±/ç« èŠ‚å‚æ•°: book=${V}, chapter=${x}`),I.value=!0,Y.value=V,J.value=x;try{const b=await us(V);if(!b.success||!b.book){console.warn("[TranslateInit] ä¹¦ç±ä¸å­˜åœ¨:",V),fe("ä¹¦ç±ä¸å­˜åœ¨","warning");return}const $=b.book,a=$.chapters?.find(u=>u.id===x);if(!a){console.warn("[TranslateInit] ç« èŠ‚ä¸å­˜åœ¨:",x),fe("ç« èŠ‚ä¸å­˜åœ¨","warning");return}if(R.value=$.title,f.value=a.title,o.setBookChapterContext(V,x,$.title,a.title),typeof document<"u"&&(document.title=`${a.title} - ${$.title} - Saber-Translator`),a.session_path){console.log(`[TranslateInit] å°è¯•åŠ è½½ç« èŠ‚ä¼šè¯: ${a.session_path}`);try{await o.loadSessionByPath(a.session_path),fe(`å·²åŠ è½½ç« èŠ‚: ${a.title}`,"success")}catch{console.log("[TranslateInit] ç« èŠ‚ä¼šè¯æ•°æ®ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥ï¼Œå°†åˆ›å»ºæ–°ä¼šè¯")}}}catch(b){console.error("[TranslateInit] åŠ è½½ä¹¦ç±/ç« èŠ‚ä¿¡æ¯å¤±è´¥:",b),fe("åŠ è½½ä¹¦ç±ä¿¡æ¯å¤±è´¥","error")}}function C(V){if(V<0||V>=p.imageCount){console.warn(`[TranslateInit] æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${V}`);return}window._isChangingFromSwitchImage=!0,c.isActive.value&&c.exitEditModeWithoutRender(),p.currentImage&&l.bubbles.length>0&&p.updateCurrentImageProperty("bubbleStates",l.bubbles),p.setCurrentImageIndex(V);const b=p.currentImage;if(!b){console.warn("[TranslateInit] åˆ‡æ¢åˆ°çš„å›¾ç‰‡ä¸å­˜åœ¨"),window._isChangingFromSwitchImage=!1;return}console.log(`[TranslateInit] åˆ‡æ¢åˆ°å›¾ç‰‡: ${V}, ${b.fileName}`),b.bubbleStates&&b.bubbleStates.length>0?l.setBubbles(b.bubbleStates,!0):l.clearBubblesLocal(),E(b),setTimeout(()=>{window._isChangingFromSwitchImage=!1,console.log("[TranslateInit] å·²é‡ç½®åˆ‡æ¢å›¾ç‰‡æ“ä½œæ ‡è®°")},100)}function E(V){if(!V)return;const x=V.bubbleStates?.[0];x&&t.updateTextStyle({fontSize:x.fontSize||t.settings.textStyle.fontSize,fontFamily:x.fontFamily||t.settings.textStyle.fontFamily,layoutDirection:V.userLayoutDirection||x.textDirection||t.settings.textStyle.layoutDirection,textColor:x.textColor||t.settings.textStyle.textColor,fillColor:x.fillColor||t.settings.textStyle.fillColor,strokeEnabled:x.strokeEnabled??t.settings.textStyle.strokeEnabled,strokeColor:x.strokeColor||t.settings.textStyle.strokeColor,strokeWidth:x.strokeWidth||t.settings.textStyle.strokeWidth,inpaintMethod:x.inpaintMethod||t.settings.textStyle.inpaintMethod,autoFontSize:V.autoFontSize??t.settings.textStyle.autoFontSize})}function q(){p.canGoPrevious&&C(p.currentImageIndex-1)}function B(){p.canGoNext&&C(p.currentImageIndex+1)}function H(){ut(async()=>{await T()})}return{isInitializing:s,isInitialized:i,initError:k,fontList:P,promptNames:w,textboxPromptNames:O,currentBookId:Y,currentChapterId:J,currentBookTitle:R,currentChapterTitle:f,isBookshelfMode:I,initializeApp:T,initializeSettings:M,initializeFontList:g,initializePromptSettings:d,initializeTextboxPromptSettings:y,initializeBookChapterContext:v,switchImage:C,goToPrevious:q,goToNext:B,loadImageSettingsToStore:E,editMode:c,setupAutoInit:H}}const Il={key:0,id:"translationProgressBar",class:"translation-progress-bar"},Tl={class:"progress-bar-label"},Dl={key:0,class:"failed-count"},Rl={class:"progress-bar"},Ml=He({__name:"TranslationProgress",props:{progress:{}},setup(n){const t=n,p=et(),o=mo(),l=Q(()=>t.progress||o.progress.value),c=Q(()=>l.value.isInProgress||p.isBatchTranslationInProgress),s=Q(()=>l.value.current),i=Q(()=>l.value.total),k=Q(()=>l.value.failed),P=Q(()=>l.value.percentage!==void 0?l.value.percentage:i.value===0?0:Math.round(s.value/i.value*100)),w=Q(()=>l.value.label?l.value.label:`ç¿»è¯‘ä¸­ï¼š${s.value} / ${i.value}`);return(O,Y)=>c.value?(L(),K("div",Il,[e("div",Tl,[Ce(le(w.value)+" ",1),k.value>0?(L(),K("span",Dl,"ï¼ˆ"+le(k.value)+" å¼ å¤±è´¥ï¼‰",1)):ge("",!0)]),e("div",Rl,[e("div",{class:"progress",style:st({width:`${P.value}%`})},null,4)])])):ge("",!0)}}),Bl=qe(Ml,[["__scopeId","data-v-dd9100ec"]]),El=He({__name:"SponsorModal",emits:["close"],setup(n,{emit:t}){const p=t;return(o,l)=>(L(),at(tn,{title:"æ”¯æŒä½œè€…",onClose:l[1]||(l[1]=c=>p("close"))},{footer:ht(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:l[0]||(l[0]=c=>p("close"))},"å…³é—­")]),default:ht(()=>[l[2]||(l[2]=e("div",{class:"sponsor-content"},[e("p",{class:"sponsor-message"}," å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯·ä½œè€…å–æ¯å’–å•¡ â˜• "),e("div",{class:"qr-codes"},[e("div",{class:"qr-item"},[e("div",{class:"qr-image"},[e("img",{src:"/pic/wechat_qrcode.png",alt:"å¾®ä¿¡æ”¯ä»˜"})]),e("span",{class:"qr-label"},"å¾®ä¿¡æ”¯ä»˜")]),e("div",{class:"qr-item"},[e("div",{class:"qr-image"},[e("img",{src:"/pic/alipay_qrcode.png",alt:"æ”¯ä»˜å®"})]),e("span",{class:"qr-label"},"æ”¯ä»˜å®")])]),e("p",{class:"sponsor-thanks"},"æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼ğŸ™")],-1))]),_:1}))}}),Pl=qe(El,[["__scopeId","data-v-02b6948e"]]),Al={id:"thumbnail-sidebar",class:"thumbnail-sidebar"},Fl={class:"card thumbnail-card"},Ll=["title","data-index","onClick"],Ul=["src","alt"],Ol={key:1,class:"translation-failed-indicator"},zl={key:2,class:"labeled-indicator"},Nl={key:3,class:"thumbnail-processing-indicator"},Vl={key:1,class:"empty-state"},Wl=He({__name:"ThumbnailSidebar",emits:["select"],setup(n,{emit:t}){const p=t,o=et(),l=S(null),c=S([]),s=Q(()=>o.images),i=Q(()=>o.currentImageIndex),k=Q(()=>o.hasImages);function P(f){p("select",f)}function w(){ct(()=>{const f=c.value[i.value];if(f&&l.value){const I=l.value,T=f.offsetTop-I.clientHeight/2+f.clientHeight/2;I.scrollTo({top:Math.max(0,T),behavior:"smooth"})}})}function O(f,I){c.value[I]=f}function Y(f){return f.translationFailed?"failed":f.isManuallyAnnotated?"labeled":f.translationStatus==="processing"?"processing":null}function J(f){const I=[];return f.translationFailed&&I.push("translation-failed"),f.isManuallyAnnotated&&I.push("has-manual-labels"),I}function R(f){return f.translationFailed?"ç¿»è¯‘å¤±è´¥ï¼Œç‚¹å‡»å¯é‡è¯•":f.isManuallyAnnotated?"åŒ…å«æ‰‹åŠ¨æ ‡æ³¨":f.fileName||""}return ye(i,()=>{w()}),ut(()=>{k.value&&w()}),(f,I)=>(L(),K("aside",Al,[e("div",Fl,[I[1]||(I[1]=e("h2",null,"å›¾ç‰‡æ¦‚è§ˆ",-1)),k.value?(L(),K("ul",{key:0,ref_key:"containerRef",ref:l,id:"thumbnailList",class:"thumbnail-list"},[(L(!0),K(Ke,null,je(s.value,(T,M)=>(L(),K("li",{key:T.id,ref_for:!0,ref:g=>O(g,M),class:Me(["thumbnail-item",[{active:M===i.value},...J(T)]]),title:R(T),"data-index":M,onClick:g=>P(M)},[T.originalDataURL?(L(),K("img",{key:0,src:T.originalDataURL,alt:T.fileName,class:"thumbnail-image"},null,8,Ul)):ge("",!0),Y(T)==="failed"?(L(),K("span",Ol,"!")):Y(T)==="labeled"?(L(),K("span",zl,"âœï¸")):ge("",!0),Y(T)==="processing"?(L(),K("div",Nl,"âŸ³")):ge("",!0)],10,Ll))),128))],512)):(L(),K("div",Vl,[...I[0]||(I[0]=[e("p",null,"æš‚æ— å›¾ç‰‡",-1)])]))])]))}}),Kl=qe(Wl,[["__scopeId","data-v-899e5674"]]),ql={class:"saved-prompts-picker"},Hl={class:"prompts-chips-container"},Jl={key:0,class:"empty-hint"},jl={key:1,class:"empty-hint"},Yl=["title","onClick"],Gl=He({__name:"SavedPromptsPicker",props:{promptType:{}},emits:["select"],setup(n,{expose:t,emit:p}){const o=n,l=p,c=S([]),s=S(!1);async function i(){s.value=!0;try{let P;o.promptType==="textbox"?P=await Ne.getTextboxPrompts():P=await Ne.getPrompts(o.promptType);const w=P.prompt_names||[];c.value=w.map(O=>({name:O}))}catch(P){console.error("åŠ è½½æç¤ºè¯åˆ—è¡¨å¤±è´¥:",P),c.value=[]}finally{s.value=!1}}async function k(P){try{let w;o.promptType==="textbox"?w=await Ne.getTextboxPromptContent(P):w=await Ne.getPromptContent(o.promptType,P),w.prompt_content&&l("select",w.prompt_content,P)}catch(w){console.error("åŠ è½½æç¤ºè¯å†…å®¹å¤±è´¥:",w)}}return ye(()=>o.promptType,()=>{i()}),ut(()=>{i()}),t({refresh:i}),(P,w)=>(L(),K("div",ql,[w[1]||(w[1]=e("span",{class:"picker-label"},"ğŸ“‘ å¿«é€Ÿé€‰æ‹©:",-1)),e("div",Hl,[s.value?(L(),K("span",Jl,"åŠ è½½ä¸­...")):c.value.length===0?(L(),K("span",jl,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(L(!0),K(Ke,{key:2},je(c.value,O=>(L(),K("button",{key:O.name,type:"button",class:"prompt-chip",title:O.name,onClick:Y=>k(O.name)},[w[0]||(w[0]=e("span",{class:"chip-icon"},"ğŸ“",-1)),Ce(" "+le(O.name),1)],8,Yl))),128))])]))}}),It=qe(Gl,[["__scopeId","data-v-2ebbb8b3"]]),Xl={class:"ocr-settings"},Zl={class:"settings-group"},Ql={class:"settings-item"},ei={class:"settings-item"},ti={class:"input-hint"},oi={class:"settings-group"},ni={class:"settings-row"},si={class:"settings-item"},ai={class:"password-input-wrapper"},li=["type"],ii={key:0,class:"eye-icon"},ri={key:1,class:"eye-off-icon"},ui={class:"settings-item"},ci={class:"password-input-wrapper"},di=["type"],gi={key:0,class:"eye-icon"},pi={key:1,class:"eye-off-icon"},vi={class:"settings-row"},mi={class:"settings-item"},bi={class:"settings-item"},fi=["disabled"],hi={class:"settings-group"},yi={class:"settings-row"},xi={class:"settings-item"},ki={class:"settings-item"},_i={class:"password-input-wrapper"},Si=["type"],Ci={key:0,class:"eye-icon"},wi={key:1,class:"eye-off-icon"},$i={class:"settings-item"},Ii={class:"settings-item"},Ti={class:"model-input-with-fetch"},Di=["disabled"],Ri={class:"fetch-text"},Mi={key:0,class:"model-select-container"},Bi={class:"model-count"},Ei={class:"settings-item"},Pi={class:"prompt-format-selector"},Ai={class:"settings-item"},Fi=["disabled"],Li=He({__name:"OcrSettings",setup(n){const t=[{label:"MangaOCR (æ—¥è¯­ä¸“ç”¨)",value:"manga_ocr"},{label:"PaddleOCR (å¤šè¯­è¨€)",value:"paddle_ocr"},{label:"ç™¾åº¦OCR",value:"baidu_ocr"},{label:"48px OCR",value:"48px_ocr"},{label:"AIè§†è§‰OCR",value:"ai_vision"}],p=[{label:"æ ‡å‡†ç‰ˆ",value:"standard"},{label:"é«˜ç²¾åº¦ç‰ˆ",value:"high_precision"}],o=[{label:"è‡ªåŠ¨æ£€æµ‹",value:"auto_detect"},{label:"ä¸­è‹±æ–‡æ··åˆ",value:"CHN_ENG"},{label:"è‹±æ–‡",value:"ENG"},{label:"æ—¥è¯­",value:"JAP"},{label:"éŸ©è¯­",value:"KOR"},{label:"æ³•è¯­",value:"FRE"},{label:"å¾·è¯­",value:"GER"},{label:"ä¿„è¯­",value:"RUS"}],l=[{label:"SiliconFlow (ç¡…åŸºæµåŠ¨)",value:"siliconflow"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai_vision"}],c=[{label:"æ™®é€šæç¤ºè¯",value:"false"},{label:"JSONæç¤ºè¯",value:"true"}],s=[{label:"ğŸš€ å¸¸ç”¨è¯­è¨€",options:[{label:"æ—¥è¯­",value:"japanese"},{label:"è‹±è¯­",value:"en"},{label:"ç®€ä½“ä¸­æ–‡",value:"chinese"},{label:"ç¹ä½“ä¸­æ–‡",value:"chinese_cht"},{label:"éŸ©è¯­",value:"korean"}]},{label:"ğŸŒ æ‹‰ä¸è¯­ç³»",options:[{label:"æ³•è¯­",value:"french"},{label:"å¾·è¯­",value:"german"},{label:"è¥¿ç­ç‰™è¯­",value:"spanish"},{label:"æ„å¤§åˆ©è¯­",value:"italian"},{label:"è‘¡è„ç‰™è¯­",value:"portuguese"}]},{label:"ğŸŒ å…¶ä»–è¯­ç³»",options:[{label:"ä¿„è¯­",value:"russian"}]}],i=Je(),k=rt(),P=S({apiKey:i.settings.baiduOcr.apiKey,secretKey:i.settings.baiduOcr.secretKey,version:i.settings.baiduOcr.version,sourceLanguage:i.settings.baiduOcr.sourceLanguage}),w=S({apiKey:i.settings.aiVisionOcr.apiKey,modelName:i.settings.aiVisionOcr.modelName,customBaseUrl:i.settings.aiVisionOcr.customBaseUrl,prompt:i.settings.aiVisionOcr.prompt,rpmLimit:i.settings.aiVisionOcr.rpmLimit}),O=Q(()=>i.settings);ye(()=>P.value.apiKey,x=>{i.updateBaiduOcr({apiKey:x})}),ye(()=>P.value.secretKey,x=>{i.updateBaiduOcr({secretKey:x})}),ye(()=>P.value.version,x=>{i.updateBaiduOcr({version:x})}),ye(()=>P.value.sourceLanguage,x=>{i.updateBaiduOcr({sourceLanguage:x})}),ye(()=>w.value.apiKey,x=>{i.updateAiVisionOcr({apiKey:x})}),ye(()=>w.value.modelName,x=>{i.updateAiVisionOcr({modelName:x})}),ye(()=>w.value.customBaseUrl,x=>{i.updateAiVisionOcr({customBaseUrl:x})}),ye(()=>w.value.prompt,x=>{i.updateAiVisionOcr({prompt:x})}),ye(()=>w.value.rpmLimit,x=>{i.updateAiVisionOcr({rpmLimit:x})});const Y=S(!1),J=S(!1),R=S(!1),f=S(!1),I=S(!1),T=S([]),M=Q(()=>{const x=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return T.value.forEach(b=>{x.push({label:b,value:b})}),x});function g(){i.saveToStorage()}function d(){i.saveToStorage()}function y(){switch(i.settings.ocrEngine){case"manga_ocr":return"MangaOCR ä¸“ä¸ºæ—¥è¯­æ¼«ç”»ä¼˜åŒ–ï¼Œæºè¯­è¨€è®¾ç½®ä¸å½±å“è¯†åˆ«";case"paddle_ocr":return"PaddleOCR ä¼šæ ¹æ®æºè¯­è¨€åŠ è½½å¯¹åº”çš„è¯†åˆ«æ¨¡å‹";case"baidu_ocr":return"ç™¾åº¦OCR ä½¿ç”¨ç‹¬ç«‹çš„æºè¯­è¨€è®¾ç½®ï¼ˆè§ä¸‹æ–¹ï¼‰";case"ai_vision":return"AIè§†è§‰OCR é€šè¿‡æç¤ºè¯æŒ‡å®šè¯†åˆ«è¯­è¨€";case"48px_ocr":return"48px OCR æ”¯æŒæ—¥ä¸­è‹±éŸ©ç­‰å¤šè¯­è¨€ï¼Œæºè¯­è¨€è®¾ç½®ä¸å½±å“è¯†åˆ«";default:return"é€‰æ‹©è¦è¯†åˆ«çš„åŸæ–‡è¯­è¨€"}}function v(x){i.setAiVisionOcrProvider(x),T.value=[],C()}function C(){w.value.apiKey=i.settings.aiVisionOcr.apiKey,w.value.modelName=i.settings.aiVisionOcr.modelName,w.value.customBaseUrl=i.settings.aiVisionOcr.customBaseUrl,w.value.prompt=i.settings.aiVisionOcr.prompt,w.value.rpmLimit=i.settings.aiVisionOcr.rpmLimit}function E(){const x=i.settings.aiVisionOcr.isJsonMode?Ln:Un;i.updateAiVisionOcr({prompt:x}),w.value.prompt=x}async function q(){const x=P.value.apiKey?.trim(),b=P.value.secretKey?.trim();if(!x||!b){k.warning("è¯·å¡«å†™ç™¾åº¦OCRçš„API Keyå’ŒSecret Key");return}f.value=!0,k.info("æ­£åœ¨æµ‹è¯•ç™¾åº¦OCRè¿æ¥...");try{const $=await Ne.testBaiduOcrConnection(x,b);$.success?k.success($.message||"ç™¾åº¦OCRè¿æ¥æˆåŠŸ!"):k.error($.message||$.error||"ç™¾åº¦OCRè¿æ¥å¤±è´¥")}catch($){const a=$ instanceof Error?$.message:"è¿æ¥æµ‹è¯•å¤±è´¥";k.error(a)}finally{f.value=!1}}async function B(){f.value=!0;try{const x=await Ne.testAiVisionOcrConnection({provider:i.settings.aiVisionOcr.provider,apiKey:w.value.apiKey,modelName:w.value.modelName,customBaseUrl:w.value.customBaseUrl,prompt:w.value.prompt});x.success?k.success("AIè§†è§‰OCRè¿æ¥æˆåŠŸ"):k.error(`AIè§†è§‰OCRè¿æ¥å¤±è´¥: ${x.error||"æœªçŸ¥é”™è¯¯"}`)}catch(x){const b=x instanceof Error?x.message:"è¿æ¥æµ‹è¯•å¤±è´¥";k.error(b)}finally{f.value=!1}}async function H(){const x=i.settings.aiVisionOcr.provider,b=w.value.apiKey?.trim(),$=w.value.customBaseUrl?.trim();if(!b){k.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","volcano","gemini","custom_openai_vision"].includes(x)){k.warning("å½“å‰æœåŠ¡å•†ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨");return}if(x==="custom_openai_vision"&&!$){k.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}I.value=!0;try{const u=await Ne.fetchModels(x,b,$);u.success&&u.models&&u.models.length>0?(T.value=u.models.map(h=>h.id),k.success(`è·å–åˆ° ${u.models.length} ä¸ªæ¨¡å‹`)):k.warning(u.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(u){const h=u instanceof Error?u.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";k.error(h)}finally{I.value=!1}}function V(x,b){i.updateAiVisionOcr({prompt:x}),w.value.prompt=x,k.success(`å·²åº”ç”¨æç¤ºè¯: ${b}`)}return(x,b)=>(L(),K("div",Xl,[e("div",Zl,[b[19]||(b[19]=e("div",{class:"settings-group-title"},"OCRå¼•æ“é€‰æ‹©",-1)),e("div",Ql,[b[17]||(b[17]=e("label",{for:"settingsOcrEngine"},"OCRå¼•æ“:",-1)),he(Oe,{"model-value":O.value.ocrEngine,options:t,onChange:b[0]||(b[0]=$=>{O.value.ocrEngine=$,g()})},null,8,["model-value"])]),se(e("div",ei,[b[18]||(b[18]=e("label",{for:"settingsSourceLanguage"},"æºè¯­è¨€:",-1)),he(Oe,{"model-value":O.value.sourceLanguage,groups:s,onChange:b[1]||(b[1]=$=>{O.value.sourceLanguage=$,d()})},null,8,["model-value"]),e("div",ti,le(y()),1)],512),[[Fe,O.value.ocrEngine==="paddle_ocr"]])]),se(e("div",oi,[b[24]||(b[24]=e("div",{class:"settings-group-title"},"ç™¾åº¦OCR è®¾ç½®",-1)),e("div",ni,[e("div",si,[b[20]||(b[20]=e("label",{for:"settingsBaiduApiKey"},"API Key:",-1)),e("div",ai,[se(e("input",{type:Y.value?"text":"password",id:"settingsBaiduApiKey","onUpdate:modelValue":b[2]||(b[2]=$=>P.value.apiKey=$),class:"secure-input",placeholder:"è¯·è¾“å…¥ç™¾åº¦OCR API Key",autocomplete:"off"},null,8,li),[[kt,P.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:b[3]||(b[3]=$=>Y.value=!Y.value)},[Y.value?(L(),K("span",ri,"ğŸ‘â€ğŸ—¨")):(L(),K("span",ii,"ğŸ‘"))])])]),e("div",ui,[b[21]||(b[21]=e("label",{for:"settingsBaiduSecretKey"},"Secret Key:",-1)),e("div",ci,[se(e("input",{type:J.value?"text":"password",id:"settingsBaiduSecretKey","onUpdate:modelValue":b[4]||(b[4]=$=>P.value.secretKey=$),class:"secure-input",placeholder:"è¯·è¾“å…¥Secret Key",autocomplete:"off"},null,8,di),[[kt,P.value.secretKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:b[5]||(b[5]=$=>J.value=!J.value)},[J.value?(L(),K("span",pi,"ğŸ‘â€ğŸ—¨")):(L(),K("span",gi,"ğŸ‘"))])])])]),e("div",vi,[e("div",mi,[b[22]||(b[22]=e("label",{for:"settingsBaiduVersion"},"è¯†åˆ«ç‰ˆæœ¬:",-1)),he(Oe,{modelValue:P.value.version,"onUpdate:modelValue":b[6]||(b[6]=$=>P.value.version=$),options:p},null,8,["modelValue"])]),e("div",bi,[b[23]||(b[23]=e("label",{for:"settingsBaiduSourceLanguage"},"æºè¯­è¨€:",-1)),he(Oe,{modelValue:P.value.sourceLanguage,"onUpdate:modelValue":b[7]||(b[7]=$=>P.value.sourceLanguage=$),options:o},null,8,["modelValue"])])]),e("button",{class:"settings-test-btn",onClick:q,disabled:f.value},le(f.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,fi)],512),[[Fe,O.value.ocrEngine==="baidu_ocr"]]),se(e("div",hi,[b[34]||(b[34]=e("div",{class:"settings-group-title"},"AIè§†è§‰OCR è®¾ç½®",-1)),e("div",yi,[e("div",xi,[b[25]||(b[25]=e("label",{for:"settingsAiVisionProvider"},"æœåŠ¡å•†:",-1)),he(Oe,{"model-value":O.value.aiVisionOcr.provider,options:l,onChange:b[8]||(b[8]=$=>v($))},null,8,["model-value"])]),e("div",ki,[b[26]||(b[26]=e("label",{for:"settingsAiVisionApiKey"},"API Key:",-1)),e("div",_i,[se(e("input",{type:R.value?"text":"password",id:"settingsAiVisionApiKey","onUpdate:modelValue":b[9]||(b[9]=$=>w.value.apiKey=$),class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,Si),[[kt,w.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:b[10]||(b[10]=$=>R.value=!R.value)},[R.value?(L(),K("span",wi,"ğŸ‘â€ğŸ—¨")):(L(),K("span",Ci,"ğŸ‘"))])])])]),se(e("div",$i,[b[27]||(b[27]=e("label",{for:"settingsCustomAiVisionBaseUrl"},"Base URL:",-1)),se(e("input",{type:"text",id:"settingsCustomAiVisionBaseUrl","onUpdate:modelValue":b[11]||(b[11]=$=>w.value.customBaseUrl=$),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[we,w.value.customBaseUrl]])],512),[[Fe,O.value.aiVisionOcr.provider==="custom_openai_vision"]]),e("div",Ii,[b[29]||(b[29]=e("label",{for:"settingsAiVisionModelName"},"æ¨¡å‹åç§°:",-1)),e("div",Ti,[se(e("input",{type:"text",id:"settingsAiVisionModelName","onUpdate:modelValue":b[12]||(b[12]=$=>w.value.modelName=$),placeholder:"å¦‚: silicon-llava2-34b"},null,512),[[we,w.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:H,disabled:I.value},[b[28]||(b[28]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",Ri,le(I.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,Di)]),T.value.length>0?(L(),K("div",Mi,[he(Oe,{modelValue:w.value.modelName,"onUpdate:modelValue":b[13]||(b[13]=$=>w.value.modelName=$),options:M.value},null,8,["modelValue","options"]),e("span",Bi,"å…± "+le(T.value.length)+" ä¸ªæ¨¡å‹",1)])):ge("",!0)]),e("div",Ei,[b[31]||(b[31]=e("label",{for:"settingsAiVisionOcrPrompt"},"OCRæç¤ºè¯:",-1)),se(e("textarea",{id:"settingsAiVisionOcrPrompt","onUpdate:modelValue":b[14]||(b[14]=$=>w.value.prompt=$),rows:"3",placeholder:"AIè§†è§‰OCRæç¤ºè¯"},null,512),[[we,w.value.prompt]]),he(It,{"prompt-type":"ai_vision_ocr",onSelect:V}),e("div",Pi,[he(Oe,{"model-value":O.value.aiVisionOcr.isJsonMode?"true":"false",options:c,onChange:b[15]||(b[15]=$=>{O.value.aiVisionOcr.isJsonMode=$==="true",E()})},null,8,["model-value"]),b[30]||(b[30]=e("span",{class:"input-hint"},"JSONæ ¼å¼è¾“å‡ºæ›´ç»“æ„åŒ–",-1))])]),e("div",Ai,[b[32]||(b[32]=e("label",{for:"settingsRpmAiVisionOcr"},"RPMé™åˆ¶ (æ¯åˆ†é’Ÿè¯·æ±‚æ•°):",-1)),se(e("input",{type:"number",id:"settingsRpmAiVisionOcr","onUpdate:modelValue":b[16]||(b[16]=$=>w.value.rpmLimit=$),min:"0",step:"1"},null,512),[[we,w.value.rpmLimit,void 0,{number:!0}]]),b[33]||(b[33]=e("div",{class:"input-hint"},"0 è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("button",{class:"settings-test-btn",onClick:B,disabled:f.value},le(f.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,Fi)],512),[[Fe,O.value.ocrEngine==="ai_vision"]])]))}}),Ui=qe(Li,[["__scopeId","data-v-38c660c4"]]),Oi={class:"translation-settings"},zi={class:"settings-group"},Ni={class:"settings-row"},Vi={class:"settings-item"},Wi={class:"settings-item"},Ki={for:"settingsApiKey"},qi={class:"password-input-wrapper"},Hi=["type","placeholder"],Ji={key:0,class:"eye-icon"},ji={key:1,class:"eye-off-icon"},Yi={class:"settings-item"},Gi={class:"settings-item"},Xi={for:"settingsModelName"},Zi={class:"model-input-with-fetch"},Qi=["placeholder"],er=["disabled"],tr={class:"fetch-text"},or={key:0,class:"model-select-container"},nr={class:"model-count"},sr={class:"settings-item"},ar={class:"local-model-list"},lr={key:0,class:"model-list-container"},ir=["disabled"],rr={key:1,class:"model-hint"},ur={key:1,class:"model-list-container"},cr=["disabled"],dr={key:1,class:"model-hint"},gr={class:"settings-row"},pr={class:"settings-item"},vr={class:"settings-item"},mr={class:"settings-item"},br=["disabled"],fr={class:"settings-item"},hr=["disabled"],yr={class:"settings-group"},xr={class:"settings-item"},kr={class:"prompt-format-selector"},_r={class:"settings-item"},Sr={class:"checkbox-label"},Cr={class:"settings-item"},wr=He({__name:"TranslationSettings",setup(n){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"å½©äº‘å°è¯‘",value:"caiyun"},{label:"ç™¾åº¦ç¿»è¯‘",value:"baidu_translate"},{label:"æœ‰é“ç¿»è¯‘",value:"youdao_translate"},{label:"Google Gemini",value:"gemini"},{label:"Ollama (æœ¬åœ°)",value:"ollama"},{label:"Sakura (æœ¬åœ°)",value:"sakura"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],p=[{label:"æ™®é€šæç¤ºè¯",value:"normal"},{label:"JSONæç¤ºè¯",value:"json"}],o=Je(),l=rt(),c=S({modelProvider:o.settings.translation.provider,apiKey:o.settings.translation.apiKey,modelName:o.settings.translation.modelName,customBaseUrl:o.settings.translation.customBaseUrl,rpmTranslation:o.settings.translation.rpmLimit,translationMaxRetries:o.settings.translation.maxRetries,promptContent:o.settings.translatePrompt,translatePromptMode:o.settings.translation.isJsonMode?"json":"normal",enableTextboxPrompt:o.settings.useTextboxPrompt,textboxPromptContent:o.settings.textboxPrompt}),s=S(!1),i=S(!1),k=S(!1),P=S([]),w=S([]),O=S([]),Y=Q(()=>{const a=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return P.value.forEach(u=>a.push({label:u,value:u})),a}),J=Q(()=>{const a=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return w.value.forEach(u=>a.push({label:u,value:u})),a}),R=Q(()=>{const a=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return O.value.forEach(u=>a.push({label:u,value:u})),a}),f=Q(()=>["ollama","sakura"].includes(c.value.modelProvider)),I=Q(()=>!["ollama","sakura","caiyun","baidu_translate","youdao_translate"].includes(c.value.modelProvider)),T=Q(()=>["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(c.value.modelProvider)),M=Q(()=>{switch(c.value.modelProvider){case"baidu_translate":return"App ID";case"youdao_translate":return"App Key";case"caiyun":return"API Token";default:return"API Key"}}),g=Q(()=>{switch(c.value.modelProvider){case"baidu_translate":return"è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘App ID";case"youdao_translate":return"è¯·è¾“å…¥æœ‰é“ç¿»è¯‘åº”ç”¨ID";case"caiyun":return"è¯·è¾“å…¥å½©äº‘å°è¯‘Token";default:return"è¯·è¾“å…¥API Key"}}),d=Q(()=>{switch(c.value.modelProvider){case"baidu_translate":return"App Key";case"youdao_translate":return"App Secret";case"caiyun":return"æºè¯­è¨€ (å¯é€‰)";default:return"æ¨¡å‹åç§°"}}),y=Q(()=>{switch(c.value.modelProvider){case"baidu_translate":return"è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘App Key";case"youdao_translate":return"è¯·è¾“å…¥æœ‰é“ç¿»è¯‘åº”ç”¨å¯†é’¥";case"caiyun":return"å¯é€‰: auto/æ—¥è¯­/è‹±è¯­";default:return"è¯·è¾“å…¥æ¨¡å‹åç§°"}});function v(){const a=c.value.modelProvider;o.setTranslationProvider(a),c.value.apiKey=o.settings.translation.apiKey,c.value.modelName=o.settings.translation.modelName,c.value.customBaseUrl=o.settings.translation.customBaseUrl,c.value.rpmTranslation=o.settings.translation.rpmLimit,c.value.translationMaxRetries=o.settings.translation.maxRetries,P.value=[]}function C(){const a=c.value.translatePromptMode==="json";a?c.value.promptContent=On:c.value.promptContent=zn,o.updateTranslationService({isJsonMode:a}),o.setTranslatePrompt(c.value.promptContent)}ye(()=>c.value.apiKey,a=>{o.updateTranslationService({apiKey:a})}),ye(()=>c.value.modelName,a=>{o.updateTranslationService({modelName:a})}),ye(()=>c.value.customBaseUrl,a=>{o.updateTranslationService({customBaseUrl:a})}),ye(()=>c.value.rpmTranslation,a=>{o.updateTranslationService({rpmLimit:a})}),ye(()=>c.value.translationMaxRetries,a=>{o.updateTranslationService({maxRetries:a})}),ye(()=>c.value.promptContent,a=>{o.setTranslatePrompt(a)}),ye(()=>c.value.enableTextboxPrompt,a=>{o.setUseTextboxPrompt(a)}),ye(()=>c.value.textboxPromptContent,a=>{o.setTextboxPrompt(a)});async function E(){const a=c.value.modelProvider,u=c.value.apiKey?.trim(),h=c.value.customBaseUrl?.trim();if(!u){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(a)){l.warning(`${q(a)} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`);return}if(a==="custom_openai"&&!h){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}k.value=!0;try{const A=await Ne.fetchModels(a,u,h);A.success&&A.models&&A.models.length>0?(P.value=A.models.map(U=>U.id),l.success(`è·å–åˆ° ${A.models.length} ä¸ªæ¨¡å‹`)):l.warning(A.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(A){const U=A instanceof Error?A.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";l.error(U)}finally{k.value=!1}}function q(a){return{siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰OpenAI",ollama:"Ollama",sakura:"Sakura",caiyun:"å½©äº‘å°è¯‘",baidu_translate:"ç™¾åº¦ç¿»è¯‘",youdao_translate:"æœ‰é“ç¿»è¯‘"}[a]||a}async function B(){k.value=!0;try{const a=await Ne.testOllamaConnection();a.success&&a.models?(w.value=a.models,l.success(`è·å–åˆ° ${a.models.length} ä¸ªOllamaæ¨¡å‹`)):l.error(a.error||"Ollamaè¿æ¥å¤±è´¥")}catch(a){const u=a instanceof Error?a.message:"è·å–Ollamaæ¨¡å‹å¤±è´¥";l.error(u)}finally{k.value=!1}}async function H(){k.value=!0;try{const a=await Ne.testSakuraConnection();a.success&&a.models?(O.value=a.models,l.success(`è·å–åˆ° ${a.models.length} ä¸ªSakuraæ¨¡å‹`)):l.error(a.error||"Sakuraè¿æ¥å¤±è´¥")}catch(a){const u=a instanceof Error?a.message:"è·å–Sakuraæ¨¡å‹å¤±è´¥";l.error(u)}finally{k.value=!1}}async function V(){i.value=!0;try{let a;c.value.modelProvider==="ollama"?a=await Ne.testOllamaConnection():a=await Ne.testSakuraConnection(),a.success?l.success(`${c.value.modelProvider==="ollama"?"Ollama":"Sakura"} è¿æ¥æˆåŠŸ`):l.error(a.error||"è¿æ¥å¤±è´¥")}catch(a){const u=a instanceof Error?a.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(u)}finally{i.value=!1}}async function x(){const a=c.value.modelProvider,u=c.value.apiKey?.trim(),h=c.value.modelName?.trim(),W=c.value.customBaseUrl?.trim();if(!u){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(a!=="caiyun"&&!h){l.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}if(a==="custom_openai"&&!W){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å¡«å†™ Base URL");return}i.value=!0,l.info("æ­£åœ¨æµ‹è¯•è¿æ¥...");try{let A;switch(a){case"baidu_translate":A=await Ne.testBaiduTranslateConnection(u,h);break;case"youdao_translate":A=await Ne.testYoudaoTranslateConnection(u,h);break;default:A=await Ne.testAiTranslateConnection({provider:a,apiKey:u,modelName:h,baseUrl:W})}A.success?l.success(A.message||`${q(a)} è¿æ¥æˆåŠŸ!`):l.error(A.message||A.error||"è¿æ¥å¤±è´¥")}catch(A){const U=A instanceof Error?A.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(U)}finally{i.value=!1}}function b(a,u){c.value.promptContent=a,l.success(`å·²åº”ç”¨æç¤ºè¯: ${u}`)}function $(a,u){c.value.textboxPromptContent=a,l.success(`å·²åº”ç”¨æç¤ºè¯: ${u}`)}return(a,u)=>(L(),K("div",Oi,[e("div",zi,[u[21]||(u[21]=e("div",{class:"settings-group-title"},"ç¿»è¯‘æœåŠ¡é…ç½®",-1)),e("div",Ni,[e("div",Vi,[u[14]||(u[14]=e("label",{for:"settingsModelProvider"},"ç¿»è¯‘æœåŠ¡å•†:",-1)),he(Oe,{"model-value":c.value.modelProvider,options:t,onChange:u[0]||(u[0]=h=>{c.value.modelProvider=h,v()})},null,8,["model-value"])]),se(e("div",Wi,[e("label",Ki,le(M.value)+":",1),e("div",qi,[se(e("input",{type:s.value?"text":"password",id:"settingsApiKey","onUpdate:modelValue":u[1]||(u[1]=h=>c.value.apiKey=h),class:"secure-input",placeholder:g.value,autocomplete:"off"},null,8,Hi),[[kt,c.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:u[2]||(u[2]=h=>s.value=!s.value)},[s.value?(L(),K("span",ji,"ğŸ‘â€ğŸ—¨")):(L(),K("span",Ji,"ğŸ‘"))])])],512),[[Fe,!f.value]])]),se(e("div",Yi,[u[15]||(u[15]=e("label",{for:"settingsCustomBaseUrl"},"Base URL:",-1)),se(e("input",{type:"text",id:"settingsCustomBaseUrl","onUpdate:modelValue":u[3]||(u[3]=h=>c.value.customBaseUrl=h),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[we,c.value.customBaseUrl]])],512),[[Fe,c.value.modelProvider==="custom_openai"]]),se(e("div",Gi,[e("label",Xi,le(d.value)+":",1),e("div",Zi,[se(e("input",{type:"text",id:"settingsModelName","onUpdate:modelValue":u[4]||(u[4]=h=>c.value.modelName=h),placeholder:y.value},null,8,Qi),[[we,c.value.modelName]]),se(e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:E,disabled:k.value},[u[16]||(u[16]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",tr,le(k.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,er),[[Fe,T.value]])]),P.value.length>0?(L(),K("div",or,[he(Oe,{"model-value":c.value.modelName,options:Y.value,onChange:u[5]||(u[5]=h=>{c.value.modelName=h})},null,8,["model-value","options"]),e("span",nr,"å…± "+le(P.value.length)+" ä¸ªæ¨¡å‹",1)])):ge("",!0)],512),[[Fe,!f.value]]),se(e("div",sr,[u[17]||(u[17]=e("label",null,"æœ¬åœ°æ¨¡å‹:",-1)),e("div",ar,[c.value.modelProvider==="ollama"?(L(),K("div",lr,[e("button",{class:"settings-test-btn",onClick:B,disabled:k.value},le(k.value?"è·å–ä¸­...":"ğŸ”„ åˆ·æ–°æ¨¡å‹åˆ—è¡¨"),9,ir),w.value.length>0?(L(),at(Oe,{key:0,"model-value":c.value.modelName,options:J.value,onChange:u[6]||(u[6]=h=>c.value.modelName=h)},null,8,["model-value","options"])):(L(),K("p",rr,"ç‚¹å‡»åˆ·æ–°è·å–å¯ç”¨æ¨¡å‹"))])):c.value.modelProvider==="sakura"?(L(),K("div",ur,[e("button",{class:"settings-test-btn",onClick:H,disabled:k.value},le(k.value?"è·å–ä¸­...":"ğŸ”„ åˆ·æ–°æ¨¡å‹åˆ—è¡¨"),9,cr),O.value.length>0?(L(),at(Oe,{key:0,"model-value":c.value.modelName,options:R.value,onChange:u[7]||(u[7]=h=>c.value.modelName=h)},null,8,["model-value","options"])):(L(),K("p",dr,"ç‚¹å‡»åˆ·æ–°è·å–å¯ç”¨æ¨¡å‹"))])):ge("",!0)])],512),[[Fe,f.value]]),se(e("div",gr,[e("div",pr,[u[18]||(u[18]=e("label",{for:"settingsRpmTranslation"},"RPMé™åˆ¶:",-1)),se(e("input",{type:"number",id:"settingsRpmTranslation","onUpdate:modelValue":u[8]||(u[8]=h=>c.value.rpmTranslation=h),min:"0",step:"1"},null,512),[[we,c.value.rpmTranslation,void 0,{number:!0}]]),u[19]||(u[19]=e("div",{class:"input-hint"},"æ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",vr,[u[20]||(u[20]=e("label",{for:"settingsTranslationMaxRetries"},"é‡è¯•æ¬¡æ•°:",-1)),se(e("input",{type:"number",id:"settingsTranslationMaxRetries","onUpdate:modelValue":u[9]||(u[9]=h=>c.value.translationMaxRetries=h),min:"0",max:"10",step:"1"},null,512),[[we,c.value.translationMaxRetries,void 0,{number:!0}]])])],512),[[Fe,I.value]]),se(e("div",mr,[e("button",{class:"settings-test-btn",onClick:V,disabled:i.value},le(i.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,br)],512),[[Fe,f.value]]),se(e("div",fr,[e("button",{class:"settings-test-btn",onClick:x,disabled:i.value},le(i.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,hr)],512),[[Fe,!f.value]])]),e("div",yr,[u[26]||(u[26]=e("div",{class:"settings-group-title"},"æç¤ºè¯è®¾ç½®",-1)),e("div",xr,[u[23]||(u[23]=e("label",{for:"settingsPromptContent"},"ç¿»è¯‘æç¤ºè¯:",-1)),se(e("textarea",{id:"settingsPromptContent","onUpdate:modelValue":u[10]||(u[10]=h=>c.value.promptContent=h),rows:"4",placeholder:"ç¿»è¯‘æç¤ºè¯"},null,512),[[we,c.value.promptContent]]),e("div",kr,[he(Oe,{"model-value":c.value.translatePromptMode,options:p,onChange:u[11]||(u[11]=h=>{c.value.translatePromptMode=h,C()})},null,8,["model-value"]),u[22]||(u[22]=e("span",{class:"input-hint"},"JSONæ ¼å¼è¾“å‡ºæ›´ç»“æ„åŒ–",-1))]),he(It,{"prompt-type":"translate",onSelect:b})]),e("div",_r,[e("label",Sr,[se(e("input",{type:"checkbox","onUpdate:modelValue":u[12]||(u[12]=h=>c.value.enableTextboxPrompt=h)},null,512),[[Qe,c.value.enableTextboxPrompt]]),u[24]||(u[24]=Ce(" å¯ç”¨æ–‡æœ¬æ¡†æç¤ºè¯ ",-1))])]),se(e("div",Cr,[u[25]||(u[25]=e("label",{for:"settingsTextboxPromptContent"},"æ–‡æœ¬æ¡†æç¤ºè¯:",-1)),se(e("textarea",{id:"settingsTextboxPromptContent","onUpdate:modelValue":u[13]||(u[13]=h=>c.value.textboxPromptContent=h),rows:"3",placeholder:"æ–‡æœ¬æ¡†æç¤ºè¯"},null,512),[[we,c.value.textboxPromptContent]]),he(It,{"prompt-type":"textbox",onSelect:$})],512),[[Fe,c.value.enableTextboxPrompt]])])]))}}),$r=qe(wr,[["__scopeId","data-v-165d523b"]]),Ir={class:"detection-settings"},Tr={class:"settings-group"},Dr={class:"settings-item"},Rr={class:"settings-group"},Mr={class:"settings-item"},Br={class:"settings-row"},Er={class:"settings-item"},Pr={class:"settings-item"},Ar={class:"settings-row"},Fr={class:"settings-item"},Lr={class:"settings-item"},Ur={class:"settings-group"},Or={class:"settings-item"},zr={class:"checkbox-label"},Nr={class:"settings-row"},Vr={class:"settings-item"},Wr={class:"settings-item"},Kr={class:"settings-group"},qr={class:"settings-item"},Hr={class:"checkbox-label"},Jr=He({__name:"DetectionSettings",setup(n){const t=[{label:"CTD (Comic Text Detector)",value:"ctd"},{label:"YOLO",value:"yolo"},{label:"YOLOv5",value:"yolov5"},{label:"Default (DBNet)",value:"default"}],p=Je(),o=Kn({textDetector:p.settings.textDetector,boxExpandRatio:p.settings.boxExpand.ratio,boxExpandTop:p.settings.boxExpand.top,boxExpandBottom:p.settings.boxExpand.bottom,boxExpandLeft:p.settings.boxExpand.left,boxExpandRight:p.settings.boxExpand.right,usePreciseMask:p.settings.preciseMask.enabled,maskDilateSize:p.settings.preciseMask.dilateSize,maskBoxExpandRatio:p.settings.preciseMask.boxExpandRatio,showDetectionDebug:p.settings.showDetectionDebug}),l=Q(()=>["ctd","default"].includes(o.textDetector));ye(()=>o.textDetector,s=>{p.setTextDetector(s)}),ye(()=>o.boxExpandRatio,s=>{p.updateBoxExpand({ratio:s})}),ye(()=>o.boxExpandTop,s=>{p.updateBoxExpand({top:s})}),ye(()=>o.boxExpandBottom,s=>{p.updateBoxExpand({bottom:s})}),ye(()=>o.boxExpandLeft,s=>{p.updateBoxExpand({left:s})}),ye(()=>o.boxExpandRight,s=>{p.updateBoxExpand({right:s})}),ye(()=>o.usePreciseMask,s=>{p.updatePreciseMask({enabled:s})}),ye(()=>o.maskDilateSize,s=>{p.updatePreciseMask({dilateSize:s})}),ye(()=>o.maskBoxExpandRatio,s=>{p.updatePreciseMask({boxExpandRatio:s})}),ye(()=>o.showDetectionDebug,s=>{p.setShowDetectionDebug(s)});function c(){l.value||(o.usePreciseMask=!1)}return(s,i)=>(L(),K("div",Ir,[e("div",Tr,[i[11]||(i[11]=e("div",{class:"settings-group-title"},"æ–‡å­—æ£€æµ‹å™¨",-1)),e("div",Dr,[i[10]||(i[10]=e("label",{for:"settingsTextDetector"},"æ£€æµ‹å™¨ç±»å‹:",-1)),he(Oe,{modelValue:o.textDetector,"onUpdate:modelValue":i[0]||(i[0]=k=>o.textDetector=k),options:t,onChange:c},null,8,["modelValue"])])]),e("div",Rr,[i[18]||(i[18]=e("div",{class:"settings-group-title"},"æ–‡æœ¬æ¡†æ‰©å±•å‚æ•°",-1)),e("div",Mr,[i[12]||(i[12]=e("label",{for:"settingsBoxExpandRatio"},"æ•´ä½“æ‰©å±• (%):",-1)),se(e("input",{type:"number",id:"settingsBoxExpandRatio","onUpdate:modelValue":i[1]||(i[1]=k=>o.boxExpandRatio=k),min:"0",max:"50",step:"1"},null,512),[[we,o.boxExpandRatio,void 0,{number:!0}]]),i[13]||(i[13]=e("div",{class:"input-hint"},"å‘å››å‘¨å‡åŒ€æ‰©å±•çš„ç™¾åˆ†æ¯” (0-50%)",-1))]),e("div",Br,[e("div",Er,[i[14]||(i[14]=e("label",{for:"settingsBoxExpandTop"},"ä¸Šæ–¹æ‰©å±• (%):",-1)),se(e("input",{type:"number",id:"settingsBoxExpandTop","onUpdate:modelValue":i[2]||(i[2]=k=>o.boxExpandTop=k),min:"0",max:"50",step:"1"},null,512),[[we,o.boxExpandTop,void 0,{number:!0}]])]),e("div",Pr,[i[15]||(i[15]=e("label",{for:"settingsBoxExpandBottom"},"ä¸‹æ–¹æ‰©å±• (%):",-1)),se(e("input",{type:"number",id:"settingsBoxExpandBottom","onUpdate:modelValue":i[3]||(i[3]=k=>o.boxExpandBottom=k),min:"0",max:"50",step:"1"},null,512),[[we,o.boxExpandBottom,void 0,{number:!0}]])])]),e("div",Ar,[e("div",Fr,[i[16]||(i[16]=e("label",{for:"settingsBoxExpandLeft"},"å·¦ä¾§æ‰©å±• (%):",-1)),se(e("input",{type:"number",id:"settingsBoxExpandLeft","onUpdate:modelValue":i[4]||(i[4]=k=>o.boxExpandLeft=k),min:"0",max:"50",step:"1"},null,512),[[we,o.boxExpandLeft,void 0,{number:!0}]])]),e("div",Lr,[i[17]||(i[17]=e("label",{for:"settingsBoxExpandRight"},"å³ä¾§æ‰©å±• (%):",-1)),se(e("input",{type:"number",id:"settingsBoxExpandRight","onUpdate:modelValue":i[5]||(i[5]=k=>o.boxExpandRight=k),min:"0",max:"50",step:"1"},null,512),[[we,o.boxExpandRight,void 0,{number:!0}]])])])]),se(e("div",Ur,[i[25]||(i[25]=e("div",{class:"settings-group-title"},"ç²¾ç¡®æ–‡å­—æ©è†œ",-1)),e("div",Or,[e("label",zr,[se(e("input",{type:"checkbox","onUpdate:modelValue":i[6]||(i[6]=k=>o.usePreciseMask=k)},null,512),[[Qe,o.usePreciseMask]]),i[19]||(i[19]=Ce(" å¯ç”¨ç²¾ç¡®æ–‡å­—æ©è†œ ",-1))]),i[20]||(i[20]=e("div",{class:"input-hint"},"ä½¿ç”¨æ›´ç²¾ç¡®çš„æ–‡å­—åŒºåŸŸæ©è†œè¿›è¡Œä¿®å¤",-1))]),se(e("div",Nr,[e("div",Vr,[i[21]||(i[21]=e("label",{for:"settingsMaskDilateSize"},"è†¨èƒ€å¤§å°:",-1)),se(e("input",{type:"number",id:"settingsMaskDilateSize","onUpdate:modelValue":i[7]||(i[7]=k=>o.maskDilateSize=k),min:"0",step:"1"},null,512),[[we,o.maskDilateSize,void 0,{number:!0}]]),i[22]||(i[22]=e("div",{class:"input-hint"},"æ©è†œè†¨èƒ€åƒç´ æ•°",-1))]),e("div",Wr,[i[23]||(i[23]=e("label",{for:"settingsMaskBoxExpandRatio"},"æ ‡æ³¨æ¡†æ‰©å¤§æ¯”ä¾‹ (%):",-1)),se(e("input",{type:"number",id:"settingsMaskBoxExpandRatio","onUpdate:modelValue":i[8]||(i[8]=k=>o.maskBoxExpandRatio=k),min:"0",max:"100",step:"1"},null,512),[[we,o.maskBoxExpandRatio,void 0,{number:!0}]]),i[24]||(i[24]=e("div",{class:"input-hint"},"æ ‡æ³¨æ¡†åŒºåŸŸæ‰©å¤§ç™¾åˆ†æ¯”",-1))])],512),[[Fe,o.usePreciseMask]])],512),[[Fe,l.value]]),e("div",Kr,[i[28]||(i[28]=e("div",{class:"settings-group-title"},"è°ƒè¯•é€‰é¡¹",-1)),e("div",qr,[e("label",Hr,[se(e("input",{type:"checkbox","onUpdate:modelValue":i[9]||(i[9]=k=>o.showDetectionDebug=k)},null,512),[[Qe,o.showDetectionDebug]]),i[26]||(i[26]=Ce(" æ˜¾ç¤ºæ£€æµ‹æ¡†è°ƒè¯•ä¿¡æ¯ ",-1))]),i[27]||(i[27]=e("div",{class:"input-hint"},"åœ¨ç¿»è¯‘ç»“æœä¸­æ˜¾ç¤ºæ°”æ³¡æ£€æµ‹æ¡†ï¼Œç”¨äºè°ƒè¯•",-1))])])]))}}),jr=qe(Jr,[["__scopeId","data-v-c12c43ee"]]),Yr={class:"hq-translation-settings"},Gr={class:"settings-group"},Xr={class:"settings-row"},Zr={class:"settings-item"},Qr={class:"settings-item"},eu={class:"password-input-wrapper"},tu=["type"],ou={key:0,class:"eye-icon"},nu={key:1,class:"eye-off-icon"},su={class:"settings-item"},au={class:"settings-item"},lu={class:"model-input-with-fetch"},iu=["disabled"],ru={class:"fetch-text"},uu={key:0,class:"model-select-container"},cu={class:"model-count"},du={class:"settings-item"},gu=["disabled"],pu={class:"settings-group"},vu={class:"settings-row"},mu={class:"settings-item"},bu={class:"settings-item"},fu={class:"settings-row"},hu={class:"settings-item"},yu={class:"settings-item"},xu={class:"settings-group"},ku={class:"settings-row"},_u={class:"settings-item"},Su={class:"checkbox-label"},Cu={class:"settings-item"},wu={class:"settings-row"},$u={class:"settings-item"},Iu={class:"checkbox-label"},Tu={class:"settings-item"},Du={class:"checkbox-label"},Ru={class:"settings-group"},Mu={class:"settings-item"},Bu=He({__name:"HqTranslationSettings",setup(n){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],p=[{label:"Geminié£æ ¼ (reasoning_effort=low)",value:"gemini"},{label:"ç«å±±å¼•æ“é£æ ¼ (thinking=null)",value:"volcano"}],o=Je(),l=rt(),c=Q(()=>o.settings.hqTranslation),s=S({apiKey:o.settings.hqTranslation.apiKey,modelName:o.settings.hqTranslation.modelName,customBaseUrl:o.settings.hqTranslation.customBaseUrl,batchSize:o.settings.hqTranslation.batchSize,sessionReset:o.settings.hqTranslation.sessionReset,rpmLimit:o.settings.hqTranslation.rpmLimit,maxRetries:o.settings.hqTranslation.maxRetries,lowReasoning:o.settings.hqTranslation.lowReasoning,noThinkingMethod:o.settings.hqTranslation.noThinkingMethod,forceJsonOutput:o.settings.hqTranslation.forceJsonOutput,useStream:o.settings.hqTranslation.useStream,prompt:o.settings.hqTranslation.prompt});ye(()=>s.value.apiKey,g=>{o.updateHqTranslation({apiKey:g})}),ye(()=>s.value.modelName,g=>{o.updateHqTranslation({modelName:g})}),ye(()=>s.value.customBaseUrl,g=>{o.updateHqTranslation({customBaseUrl:g})}),ye(()=>s.value.batchSize,g=>{o.updateHqTranslation({batchSize:g})}),ye(()=>s.value.sessionReset,g=>{o.updateHqTranslation({sessionReset:g})}),ye(()=>s.value.rpmLimit,g=>{o.updateHqTranslation({rpmLimit:g})}),ye(()=>s.value.maxRetries,g=>{o.updateHqTranslation({maxRetries:g})}),ye(()=>s.value.lowReasoning,g=>{o.updateHqTranslation({lowReasoning:g})}),ye(()=>s.value.noThinkingMethod,g=>{o.updateHqTranslation({noThinkingMethod:g})}),ye(()=>s.value.forceJsonOutput,g=>{o.updateHqTranslation({forceJsonOutput:g})}),ye(()=>s.value.useStream,g=>{o.updateHqTranslation({useStream:g})}),ye(()=>s.value.prompt,g=>{o.updateHqTranslation({prompt:g})});const i=S(!1),k=S(!1),P=S([]),w=S(!1),O=Q(()=>{const g=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return P.value.forEach(d=>g.push({label:d,value:d})),g});function Y(g){o.setHqProvider(g),P.value=[],J()}function J(){const g=o.settings.hqTranslation;s.value.apiKey=g.apiKey,s.value.modelName=g.modelName,s.value.customBaseUrl=g.customBaseUrl,s.value.batchSize=g.batchSize,s.value.sessionReset=g.sessionReset,s.value.rpmLimit=g.rpmLimit,s.value.maxRetries=g.maxRetries,s.value.lowReasoning=g.lowReasoning,s.value.noThinkingMethod=g.noThinkingMethod,s.value.forceJsonOutput=g.forceJsonOutput,s.value.useStream=g.useStream,s.value.prompt=g.prompt}function R(g){return{siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰OpenAI"}[g]||g}async function f(){const g=c.value.provider,d=s.value.apiKey?.trim(),y=s.value.customBaseUrl?.trim();if(!d){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(g)){l.warning(`${R(g)} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`);return}if(g==="custom_openai"&&!y){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}k.value=!0;try{const C=await Ne.fetchModels(g,d,y);C.success&&C.models&&C.models.length>0?(P.value=C.models.map(E=>E.id),l.success(`è·å–åˆ° ${C.models.length} ä¸ªæ¨¡å‹`)):l.warning(C.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(C){const E=C instanceof Error?C.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";l.error(E)}finally{k.value=!1}}async function I(){const g=c.value.provider,d=s.value.apiKey?.trim(),y=s.value.modelName?.trim(),v=s.value.customBaseUrl?.trim();if(!d){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!y){l.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}if(g==="custom_openai"&&!v){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å¡«å†™ Base URL");return}w.value=!0,l.info("æ­£åœ¨æµ‹è¯•è¿æ¥...");try{const C=await Ne.testAiTranslateConnection({provider:g,apiKey:d,modelName:y,baseUrl:v});C.success?l.success(C.message||`${R(g)} è¿æ¥æˆåŠŸ!`):l.error(C.message||C.error||"è¿æ¥å¤±è´¥")}catch(C){const E=C instanceof Error?C.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(E)}finally{w.value=!1}}function T(){o.updateHqTranslation({prompt:Ao}),s.value.prompt=Ao,l.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}function M(g,d){o.updateHqTranslation({prompt:g}),s.value.prompt=g,l.success(`å·²åº”ç”¨æç¤ºè¯: ${d}`)}return(g,d)=>(L(),K("div",Yr,[e("div",Gr,[d[20]||(d[20]=e("div",{class:"settings-group-title"},"é«˜è´¨é‡ç¿»è¯‘æœåŠ¡é…ç½®",-1)),e("div",Xr,[e("div",Zr,[d[15]||(d[15]=e("label",{for:"settingsHqTranslateProvider"},"æœåŠ¡å•†:",-1)),he(Oe,{"model-value":c.value.provider,options:t,onChange:d[0]||(d[0]=y=>Y(y))},null,8,["model-value"])]),e("div",Qr,[d[16]||(d[16]=e("label",{for:"settingsHqApiKey"},"API Key:",-1)),e("div",eu,[se(e("input",{type:i.value?"text":"password",id:"settingsHqApiKey","onUpdate:modelValue":d[1]||(d[1]=y=>s.value.apiKey=y),class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,tu),[[kt,s.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:d[2]||(d[2]=y=>i.value=!i.value)},[i.value?(L(),K("span",nu,"ğŸ‘â€ğŸ—¨")):(L(),K("span",ou,"ğŸ‘"))])])])]),se(e("div",su,[d[17]||(d[17]=e("label",{for:"settingsHqCustomBaseUrl"},"Base URL:",-1)),se(e("input",{type:"text",id:"settingsHqCustomBaseUrl","onUpdate:modelValue":d[3]||(d[3]=y=>s.value.customBaseUrl=y),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[we,s.value.customBaseUrl]])],512),[[Fe,c.value.provider==="custom_openai"]]),e("div",au,[d[19]||(d[19]=e("label",{for:"settingsHqModelName"},"æ¨¡å‹åç§°:",-1)),e("div",lu,[se(e("input",{type:"text",id:"settingsHqModelName","onUpdate:modelValue":d[4]||(d[4]=y=>s.value.modelName=y),placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},null,512),[[we,s.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:f,disabled:k.value},[d[18]||(d[18]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",ru,le(k.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,iu)]),P.value.length>0?(L(),K("div",uu,[he(Oe,{modelValue:s.value.modelName,"onUpdate:modelValue":d[5]||(d[5]=y=>s.value.modelName=y),options:O.value},null,8,["modelValue","options"]),e("span",cu,"å…± "+le(P.value.length)+" ä¸ªæ¨¡å‹",1)])):ge("",!0)]),e("div",du,[e("button",{class:"settings-test-btn",onClick:I,disabled:w.value},le(w.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,gu)])]),e("div",pu,[d[28]||(d[28]=e("div",{class:"settings-group-title"},"æ‰¹å¤„ç†è®¾ç½®",-1)),e("div",vu,[e("div",mu,[d[21]||(d[21]=e("label",{for:"settingsHqBatchSize"},"æ‰¹æ¬¡å¤§å°:",-1)),se(e("input",{type:"number",id:"settingsHqBatchSize","onUpdate:modelValue":d[6]||(d[6]=y=>s.value.batchSize=y),min:"1",max:"10",step:"1"},null,512),[[we,s.value.batchSize,void 0,{number:!0}]]),d[22]||(d[22]=e("div",{class:"input-hint"},"æ¯æ‰¹å¤„ç†çš„å›¾ç‰‡æ•°é‡ (æ¨è3-5å¼ )",-1))]),e("div",bu,[d[23]||(d[23]=e("label",{for:"settingsHqSessionReset"},"ä¼šè¯é‡ç½®é¢‘ç‡:",-1)),se(e("input",{type:"number",id:"settingsHqSessionReset","onUpdate:modelValue":d[7]||(d[7]=y=>s.value.sessionReset=y),min:"1",step:"1"},null,512),[[we,s.value.sessionReset,void 0,{number:!0}]]),d[24]||(d[24]=e("div",{class:"input-hint"},"å¤šå°‘æ‰¹æ¬¡åé‡ç½®ä¸Šä¸‹æ–‡",-1))])]),e("div",fu,[e("div",hu,[d[25]||(d[25]=e("label",{for:"settingsHqRpmLimit"},"RPMé™åˆ¶:",-1)),se(e("input",{type:"number",id:"settingsHqRpmLimit","onUpdate:modelValue":d[8]||(d[8]=y=>s.value.rpmLimit=y),min:"0",step:"1"},null,512),[[we,s.value.rpmLimit,void 0,{number:!0}]]),d[26]||(d[26]=e("div",{class:"input-hint"},"æ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",yu,[d[27]||(d[27]=e("label",{for:"settingsHqMaxRetries"},"é‡è¯•æ¬¡æ•°:",-1)),se(e("input",{type:"number",id:"settingsHqMaxRetries","onUpdate:modelValue":d[9]||(d[9]=y=>s.value.maxRetries=y),min:"0",max:"10",step:"1"},null,512),[[we,s.value.maxRetries,void 0,{number:!0}]])])])]),e("div",xu,[d[36]||(d[36]=e("div",{class:"settings-group-title"},"é«˜çº§é€‰é¡¹",-1)),e("div",ku,[e("div",_u,[e("label",Su,[se(e("input",{type:"checkbox","onUpdate:modelValue":d[10]||(d[10]=y=>s.value.lowReasoning=y)},null,512),[[Qe,s.value.lowReasoning]]),d[29]||(d[29]=Ce(" ä½æ¨ç†æ¨¡å¼ ",-1))]),d[30]||(d[30]=e("div",{class:"input-hint"},"å‡å°‘æ¨¡å‹æ¨ç†æ·±åº¦ï¼Œæé«˜é€Ÿåº¦",-1))]),e("div",Cu,[d[31]||(d[31]=e("label",{for:"settingsHqNoThinkingMethod"},"å–æ¶ˆæ€è€ƒæ–¹æ³•:",-1)),he(Oe,{modelValue:s.value.noThinkingMethod,"onUpdate:modelValue":d[11]||(d[11]=y=>s.value.noThinkingMethod=y),options:p},null,8,["modelValue"])])]),e("div",wu,[e("div",$u,[e("label",Iu,[se(e("input",{type:"checkbox","onUpdate:modelValue":d[12]||(d[12]=y=>s.value.forceJsonOutput=y)},null,512),[[Qe,s.value.forceJsonOutput]]),d[32]||(d[32]=Ce(" å¼ºåˆ¶JSONè¾“å‡º ",-1))]),d[33]||(d[33]=e("div",{class:"input-hint"},"ä½¿ç”¨ response_format: json_object",-1))]),e("div",Tu,[e("label",Du,[se(e("input",{type:"checkbox","onUpdate:modelValue":d[13]||(d[13]=y=>s.value.useStream=y)},null,512),[[Qe,s.value.useStream]]),d[34]||(d[34]=Ce(" æµå¼è°ƒç”¨ ",-1))]),d[35]||(d[35]=e("div",{class:"input-hint"},"ä½¿ç”¨æµå¼APIè°ƒç”¨",-1))])])]),e("div",Ru,[d[37]||(d[37]=e("div",{class:"settings-group-title"},"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯",-1)),e("div",Mu,[se(e("textarea",{id:"settingsHqPrompt","onUpdate:modelValue":d[14]||(d[14]=y=>s.value.prompt=y),rows:"6",placeholder:"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯"},null,512),[[we,s.value.prompt]]),he(It,{"prompt-type":"hq_translate",onSelect:M}),e("button",{class:"btn btn-secondary btn-sm",onClick:T},"é‡ç½®ä¸ºé»˜è®¤")])])]))}}),Eu=qe(Bu,[["__scopeId","data-v-23f4a3f7"]]),Pu={class:"proofreading-settings"},Au={class:"settings-group"},Fu={class:"settings-item"},Lu={class:"checkbox-label"},Uu={class:"settings-item"},Ou={class:"settings-group"},zu={class:"round-header"},Nu={class:"round-title"},Vu=["onClick","disabled"],Wu={class:"round-content"},Ku={class:"settings-item"},qu=["onUpdate:modelValue"],Hu={class:"settings-row"},Ju={class:"settings-item"},ju={class:"settings-item"},Yu={class:"password-input-wrapper"},Gu=["type","onUpdate:modelValue"],Xu=["onClick"],Zu={key:0,class:"eye-icon"},Qu={key:1,class:"eye-off-icon"},ec={class:"settings-item"},tc=["onUpdate:modelValue"],oc={class:"settings-item"},nc={class:"model-input-with-fetch"},sc=["onUpdate:modelValue"],ac=["onClick","disabled"],lc={class:"fetch-text"},ic={key:0,class:"model-select-container"},rc={class:"model-count"},uc={class:"settings-item"},cc=["onClick","disabled"],dc={class:"settings-row"},gc={class:"settings-item"},pc=["onUpdate:modelValue"],vc={class:"settings-item"},mc=["onUpdate:modelValue"],bc={class:"settings-item"},fc=["onUpdate:modelValue"],hc={class:"settings-row"},yc={class:"settings-item"},xc={class:"checkbox-label"},kc=["onUpdate:modelValue"],_c={class:"settings-item"},Sc={class:"settings-item"},Cc={class:"checkbox-label"},wc=["onUpdate:modelValue"],$c={class:"settings-item"},Ic=["onUpdate:modelValue"],Tc=["onClick"],Dc=He({__name:"ProofreadingSettings",setup(n){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],p=[{label:"Geminié£æ ¼",value:"gemini"},{label:"ç«å±±å¼•æ“é£æ ¼",value:"volcano"}],o=Je(),l=rt(),c=S({}),s=S({}),i=S({}),k=Q(()=>o.settings.proofreading.rounds),P=Q({get:()=>o.settings.proofreading.maxRetries,set:M=>o.setProofreadingMaxRetries(M)}),w=Q({get:()=>o.settings.proofreading.enabled,set:M=>o.setProofreadingEnabled(M)});ye(()=>o.settings.proofreading.rounds,()=>{o.saveToStorage()},{deep:!0});function O(M){const g=i.value[M]||[],d=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return g.forEach(y=>d.push({label:y,value:y})),d}async function Y(M){const g=k.value[M];if(!g)return;const d=g.provider,y=g.apiKey?.trim(),v=g.customBaseUrl?.trim();if(!y){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(d)){l.warning("å½“å‰æœåŠ¡å•†ä¸æ”¯æŒè·å–æ¨¡å‹åˆ—è¡¨");return}c.value[M]=!0;try{const E=await Ne.fetchModels(d,y,v);E.success&&E.models&&E.models.length>0?(i.value[M]=E.models.map(q=>q.id),l.success(`è½®æ¬¡ ${M+1}: è·å–åˆ° ${E.models.length} ä¸ªæ¨¡å‹`)):l.warning(E.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(E){const q=E instanceof Error?E.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";l.error(q)}finally{c.value[M]=!1}}async function J(M){const g=k.value[M];if(!g)return;const d=g.provider,y=g.apiKey?.trim(),v=g.modelName?.trim(),C=g.customBaseUrl?.trim();if(!y){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!v){l.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}s.value[M]=!0,l.info(`æ­£åœ¨æµ‹è¯•è½®æ¬¡ ${M+1} çš„è¿æ¥...`);try{const E=await Ne.testAiTranslateConnection({provider:d,apiKey:y,modelName:v,baseUrl:C});E.success?l.success(E.message||"è¿æ¥æˆåŠŸ!"):l.error(E.message||E.error||"è¿æ¥å¤±è´¥")}catch(E){const q=E instanceof Error?E.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(q)}finally{s.value[M]=!1}}function R(){const M={name:`ç¬¬${k.value.length+1}è½®æ ¡å¯¹`,provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",batchSize:3,sessionReset:20,rpmLimit:7,lowReasoning:!1,noThinkingMethod:"gemini",forceJsonOutput:!0,prompt:Fo,showApiKey:!1};o.addProofreadingRound(M),l.success("å·²æ·»åŠ æ–°çš„æ ¡å¯¹è½®æ¬¡")}function f(M){if(k.value.length<=1){l.warning("è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªæ ¡å¯¹è½®æ¬¡");return}o.removeProofreadingRound(M),l.success("å·²åˆ é™¤æ ¡å¯¹è½®æ¬¡")}function I(M){o.updateProofreadingRound(M,{prompt:Fo}),l.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}function T(M,g,d){o.updateProofreadingRound(M,{prompt:g}),l.success(`å·²åº”ç”¨æç¤ºè¯: ${d}`)}return(M,g)=>(L(),K("div",Pu,[e("div",Au,[g[5]||(g[5]=e("div",{class:"settings-group-title"},"AIæ ¡å¯¹è®¾ç½®",-1)),e("div",Fu,[e("label",Lu,[se(e("input",{type:"checkbox","onUpdate:modelValue":g[0]||(g[0]=d=>w.value=d)},null,512),[[Qe,w.value]]),g[2]||(g[2]=Ce(" å¯ç”¨AIæ ¡å¯¹ ",-1))]),g[3]||(g[3]=e("div",{class:"input-hint"},"ç¿»è¯‘å®Œæˆåè‡ªåŠ¨è¿›è¡ŒAIæ ¡å¯¹",-1))]),e("div",Uu,[g[4]||(g[4]=e("label",{for:"settingsProofreadingMaxRetries"},"å…¨å±€é‡è¯•æ¬¡æ•°:",-1)),se(e("input",{type:"number",id:"settingsProofreadingMaxRetries","onUpdate:modelValue":g[1]||(g[1]=d=>P.value=d),min:"0",max:"10",step:"1"},null,512),[[we,P.value,void 0,{number:!0}]])])]),se(e("div",Ou,[e("div",{class:"settings-group-title"},[g[6]||(g[6]=Ce(" æ ¡å¯¹è½®æ¬¡é…ç½® ",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:R},"+ æ·»åŠ è½®æ¬¡")]),(L(!0),K(Ke,null,je(k.value,(d,y)=>(L(),K("div",{key:y,class:"proofreading-round"},[e("div",zu,[e("span",Nu,"è½®æ¬¡ "+le(y+1)+": "+le(d.name||"æœªå‘½å"),1),e("button",{class:"btn btn-danger btn-sm",onClick:v=>f(y),disabled:k.value.length<=1}," åˆ é™¤ ",8,Vu)]),e("div",Wu,[e("div",Ku,[g[7]||(g[7]=e("label",null,"è½®æ¬¡åç§°:",-1)),se(e("input",{type:"text","onUpdate:modelValue":v=>d.name=v,placeholder:"å¦‚: ç¬¬ä¸€è½®æ ¡å¯¹"},null,8,qu),[[we,d.name]])]),e("div",Hu,[e("div",Ju,[g[8]||(g[8]=e("label",null,"æœåŠ¡å•†:",-1)),he(Oe,{modelValue:d.provider,"onUpdate:modelValue":v=>d.provider=v,options:t},null,8,["modelValue","onUpdate:modelValue"])]),e("div",ju,[g[9]||(g[9]=e("label",null,"API Key:",-1)),e("div",Yu,[se(e("input",{type:d.showApiKey?"text":"password","onUpdate:modelValue":v=>d.apiKey=v,class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,Gu),[[kt,d.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:v=>d.showApiKey=!d.showApiKey},[d.showApiKey?(L(),K("span",Qu,"ğŸ‘â€ğŸ—¨")):(L(),K("span",Zu,"ğŸ‘"))],8,Xu)])])]),se(e("div",ec,[g[10]||(g[10]=e("label",null,"Base URL:",-1)),se(e("input",{type:"text","onUpdate:modelValue":v=>d.customBaseUrl=v,placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,8,tc),[[we,d.customBaseUrl]])],512),[[Fe,d.provider==="custom_openai"]]),e("div",oc,[g[12]||(g[12]=e("label",null,"æ¨¡å‹åç§°:",-1)),e("div",nc,[se(e("input",{type:"text","onUpdate:modelValue":v=>d.modelName=v,placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},null,8,sc),[[we,d.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:v=>Y(y),disabled:c.value[y]},[g[11]||(g[11]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",lc,le(c.value[y]?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,ac)]),i.value[y]&&i.value[y].length>0?(L(),K("div",ic,[he(Oe,{modelValue:d.modelName,"onUpdate:modelValue":v=>d.modelName=v,options:O(y)},null,8,["modelValue","onUpdate:modelValue","options"]),e("span",rc,"å…± "+le(i.value[y].length)+" ä¸ªæ¨¡å‹",1)])):ge("",!0)]),e("div",uc,[e("button",{class:"settings-test-btn",onClick:v=>J(y),disabled:s.value[y]},le(s.value[y]?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,cc)]),e("div",dc,[e("div",gc,[g[13]||(g[13]=e("label",null,"æ‰¹æ¬¡å¤§å°:",-1)),se(e("input",{type:"number","onUpdate:modelValue":v=>d.batchSize=v,min:"1",max:"10",step:"1"},null,8,pc),[[we,d.batchSize,void 0,{number:!0}]])]),e("div",vc,[g[14]||(g[14]=e("label",null,"ä¼šè¯é‡ç½®é¢‘ç‡:",-1)),se(e("input",{type:"number","onUpdate:modelValue":v=>d.sessionReset=v,min:"1",step:"1"},null,8,mc),[[we,d.sessionReset,void 0,{number:!0}]])]),e("div",bc,[g[15]||(g[15]=e("label",null,"RPMé™åˆ¶:",-1)),se(e("input",{type:"number","onUpdate:modelValue":v=>d.rpmLimit=v,min:"0",step:"1"},null,8,fc),[[we,d.rpmLimit,void 0,{number:!0}]])])]),e("div",hc,[e("div",yc,[e("label",xc,[se(e("input",{type:"checkbox","onUpdate:modelValue":v=>d.lowReasoning=v},null,8,kc),[[Qe,d.lowReasoning]]),g[16]||(g[16]=Ce(" ä½æ¨ç†æ¨¡å¼ ",-1))])]),e("div",_c,[g[17]||(g[17]=e("label",null,"å–æ¶ˆæ€è€ƒæ–¹æ³•:",-1)),he(Oe,{modelValue:d.noThinkingMethod,"onUpdate:modelValue":v=>d.noThinkingMethod=v,options:p},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Sc,[e("label",Cc,[se(e("input",{type:"checkbox","onUpdate:modelValue":v=>d.forceJsonOutput=v},null,8,wc),[[Qe,d.forceJsonOutput]]),g[18]||(g[18]=Ce(" å¼ºåˆ¶JSONè¾“å‡º ",-1))])])]),e("div",$c,[g[19]||(g[19]=e("label",null,"æ ¡å¯¹æç¤ºè¯:",-1)),se(e("textarea",{"onUpdate:modelValue":v=>d.prompt=v,rows:"4",placeholder:"æ ¡å¯¹æç¤ºè¯"},null,8,Ic),[[we,d.prompt]]),he(It,{"prompt-type":"proofreading",onSelect:(v,C)=>T(y,v,C)},null,8,["onSelect"]),e("button",{class:"btn btn-secondary btn-sm",onClick:v=>I(y)},"é‡ç½®ä¸ºé»˜è®¤",8,Tc)])])]))),128))],512),[[Fe,w.value]])]))}}),Rc=qe(Dc,[["__scopeId","data-v-663a7972"]]),Mc={class:"prompt-library"},Bc={class:"settings-group"},Ec={class:"settings-item"},Pc={key:0,class:"settings-item"},Ac={class:"mode-hint"},Fc={class:"settings-group"},Lc={key:0,class:"loading-hint"},Uc={key:1,class:"empty-hint"},Oc={key:2,class:"prompt-list"},zc=["onClick"],Nc={class:"prompt-name"},Vc={class:"prompt-actions"},Wc=["onClick"],Kc=["onClick","disabled"],qc={class:"settings-group"},Hc={class:"settings-item"},Jc={class:"settings-item"},jc={class:"prompt-editor-actions"},Yc=["disabled"],Gc=He({__name:"PromptLibrary",setup(n){const t=[{label:"ç¿»è¯‘æç¤ºè¯",value:"translate"},{label:"æ–‡æœ¬æ¡†æç¤ºè¯",value:"textbox"},{label:"AIè§†è§‰OCRæç¤ºè¯",value:"ai_vision_ocr"},{label:"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯",value:"hq_translate"},{label:"æ ¡å¯¹æç¤ºè¯",value:"proofreading"}],p=[{label:"æ™®é€šæ¨¡å¼",value:"false"},{label:"JSONæ ¼å¼æ¨¡å¼",value:"true"}],o=rt(),l=Je(),c=S("translate"),s=S([]),i=S(""),k=S(""),P=S(""),w=S(!1),O=S(!1),Y=Q(()=>c.value==="translate"||c.value==="ai_vision_ocr"),J=Q(()=>O.value?"é€‚ç”¨äºéœ€è¦ç»“æ„åŒ–è¾“å‡ºçš„åœºæ™¯":"é€‚ç”¨äºæ™®é€šç¿»è¯‘åœºæ™¯");async function R(){w.value=!0;try{let y;c.value==="textbox"?y=await Ne.getTextboxPrompts():y=await Ne.getPrompts(c.value);const v=y.prompt_names||[];s.value=v.map(C=>({name:C}))}catch(y){const v=y instanceof Error?y.message:"åŠ è½½æç¤ºè¯åˆ—è¡¨å¤±è´¥";o.error(v)}finally{w.value=!1}}async function f(y){i.value=y,k.value=y,await I(y)}async function I(y){try{let v;c.value==="textbox"?v=await Ne.getTextboxPromptContent(y):v=await Ne.getPromptContent(c.value,y),k.value=y,P.value=v.prompt_content||"",i.value=y,o.success("å·²åŠ è½½æç¤ºè¯")}catch(v){const C=v instanceof Error?v.message:"åŠ è½½æç¤ºè¯å†…å®¹å¤±è´¥";o.error(C)}}async function T(){if(!k.value||!P.value){o.warning("è¯·è¾“å…¥æç¤ºè¯åç§°å’Œå†…å®¹");return}try{c.value==="textbox"?await Ne.saveTextboxPrompt(k.value,P.value):await Ne.savePrompt(c.value,k.value,P.value),o.success("æç¤ºè¯ä¿å­˜æˆåŠŸ"),k.value="",P.value="",await R()}catch(y){const v=y instanceof Error?y.message:"ä¿å­˜æç¤ºè¯å¤±è´¥";o.error(v)}}async function M(y){if(y==="default"){o.warning("é»˜è®¤æç¤ºè¯ä¸èƒ½åˆ é™¤");return}try{c.value==="textbox"?await Ne.deleteTextboxPrompt(y):await Ne.deletePrompt(c.value,y),o.success("æç¤ºè¯åˆ é™¤æˆåŠŸ"),i.value===y&&(i.value="",k.value="",P.value=""),await R()}catch(v){const C=v instanceof Error?v.message:"åˆ é™¤æç¤ºè¯å¤±è´¥";o.error(C)}}function g(){i.value="",k.value="",P.value="",c.value==="translate"?O.value=l.settings.translation.isJsonMode:c.value==="ai_vision_ocr"?O.value=l.settings.aiVisionOcr.isJsonMode:O.value=!1,R()}function d(){c.value==="translate"?l.updateTranslationService({isJsonMode:O.value}):c.value==="ai_vision_ocr"&&l.updateAiVisionOcr({isJsonMode:O.value}),o.info(`å·²åˆ‡æ¢åˆ°${O.value?"JSONæ ¼å¼":"æ™®é€š"}æ¨¡å¼`)}return ut(()=>{O.value=l.settings.translation.isJsonMode,R()}),(y,v)=>(L(),K("div",Mc,[e("div",Bc,[v[6]||(v[6]=e("div",{class:"settings-group-title"},"æç¤ºè¯ç®¡ç†",-1)),e("div",Ec,[v[4]||(v[4]=e("label",{for:"promptType"},"æç¤ºè¯ç±»å‹:",-1)),he(Oe,{modelValue:c.value,"onUpdate:modelValue":v[0]||(v[0]=C=>c.value=C),options:t,onChange:g},null,8,["modelValue"])]),Y.value?(L(),K("div",Pc,[v[5]||(v[5]=e("label",{for:"promptMode"},"æç¤ºè¯æ¨¡å¼:",-1)),he(Oe,{"model-value":O.value?"true":"false",options:p,onChange:v[1]||(v[1]=C=>{O.value=C==="true",d()})},null,8,["model-value"]),e("span",Ac,le(J.value),1)])):ge("",!0)]),e("div",Fc,[v[7]||(v[7]=e("div",{class:"settings-group-title"},"å·²ä¿å­˜çš„æç¤ºè¯",-1)),w.value?(L(),K("div",Lc,"åŠ è½½ä¸­...")):s.value.length===0?(L(),K("div",Uc,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(L(),K("div",Oc,[(L(!0),K(Ke,null,je(s.value,C=>(L(),K("div",{key:C.name,class:Me(["prompt-item",{active:i.value===C.name}]),onClick:E=>f(C.name)},[e("span",Nc,le(C.name),1),e("div",Vc,[e("button",{class:"btn btn-sm",onClick:Ze(E=>I(C.name),["stop"]),title:"åŠ è½½åˆ°ç¼–è¾‘å™¨"},"ğŸ“¥",8,Wc),e("button",{class:"btn btn-sm btn-danger",onClick:Ze(E=>M(C.name),["stop"]),title:"åˆ é™¤",disabled:C.name==="default"}," ğŸ—‘ï¸ ",8,Kc)])],10,zc))),128))]))]),e("div",qc,[v[10]||(v[10]=e("div",{class:"settings-group-title"},"æç¤ºè¯ç¼–è¾‘",-1)),e("div",Hc,[v[8]||(v[8]=e("label",{for:"promptName"},"æç¤ºè¯åç§°:",-1)),se(e("input",{type:"text",id:"promptName","onUpdate:modelValue":v[2]||(v[2]=C=>k.value=C),placeholder:"è¯·è¾“å…¥æç¤ºè¯åç§°"},null,512),[[we,k.value]])]),e("div",Jc,[v[9]||(v[9]=e("label",{for:"promptContent"},"æç¤ºè¯å†…å®¹:",-1)),se(e("textarea",{id:"promptContent","onUpdate:modelValue":v[3]||(v[3]=C=>P.value=C),rows:"8",placeholder:"è¯·è¾“å…¥æç¤ºè¯å†…å®¹"},null,512),[[we,P.value]])]),e("div",jc,[e("button",{class:"btn btn-primary",onClick:T,disabled:!k.value||!P.value},"ä¿å­˜æç¤ºè¯",8,Yc)])])]))}}),Xc=qe(Gc,[["__scopeId","data-v-70f0ec19"]]),Zc={class:"plugin-manager"},Qc={class:"settings-group"},ed={key:0,class:"loading-hint"},td={key:1,class:"empty-hint"},od={key:2,class:"plugin-list"},nd={class:"plugin-info"},sd={class:"plugin-header"},ad={class:"plugin-name"},ld={class:"plugin-version"},id={class:"plugin-description"},rd={class:"plugin-controls"},ud={class:"switch"},cd=["checked","onChange"],dd=["onClick"],gd=["onClick"],pd={class:"settings-group"},vd={class:"plugin-name"},md={class:"switch"},bd=["checked","onChange"],fd={class:"plugin-config-content"},hd={class:"plugin-config-header"},yd={class:"plugin-config-body"},xd=["for"],kd=["id","onUpdate:modelValue"],_d=["id","onUpdate:modelValue","min","max"],Sd=["id","onUpdate:modelValue","placeholder"],Cd={key:4,class:"field-description"},wd=He({__name:"PluginManager",setup(n){const t=rt(),p=S([]),o=S({}),l=S(!1),c=S(!1),s=S(null),i=S({}),k=S({});async function P(){l.value=!0;try{const T=await ps();p.value=T.plugins||[]}catch(T){const M=T instanceof Error?T.message:"åŠ è½½æ’ä»¶åˆ—è¡¨å¤±è´¥";t.error(M)}finally{l.value=!1}}async function w(){try{const T=await _s();o.value=T.states||{}}catch(T){console.error("åŠ è½½é»˜è®¤çŠ¶æ€å¤±è´¥:",T)}}async function O(T){try{T.enabled?(await ms(T.name),T.enabled=!1,t.success(`å·²ç¦ç”¨ ${T.display_name||T.name}`)):(await vs(T.name),T.enabled=!0,t.success(`å·²å¯ç”¨ ${T.display_name||T.name}`))}catch(M){const g=M instanceof Error?M.message:"æ“ä½œå¤±è´¥";t.error(g)}}async function Y(T,M){const g=M.target,d=g.checked;try{await Ss(T,d),o.value[T]=d,t.success("é»˜è®¤çŠ¶æ€å·²æ›´æ–°")}catch(y){const v=y instanceof Error?y.message:"è®¾ç½®å¤±è´¥";t.error(v),g.checked=!d}}async function J(T){s.value=T;try{const M=await Cs(T.name);i.value=M.schema||{};const g=await ws(T.name);k.value=g.config||{},c.value=!0}catch(M){const g=M instanceof Error?M.message:"åŠ è½½é…ç½®å¤±è´¥";t.error(g)}}function R(){c.value=!1,s.value=null,i.value={},k.value={}}async function f(){if(s.value)try{await $s(s.value.name,k.value),t.success("é…ç½®ä¿å­˜æˆåŠŸ"),R()}catch(T){const M=T instanceof Error?T.message:"ä¿å­˜é…ç½®å¤±è´¥";t.error(M)}}async function I(T){if(confirm(`ç¡®å®šè¦åˆ é™¤æ’ä»¶ "${T.display_name||T.name}" å—ï¼Ÿ`))try{await bs(T.name),t.success("æ’ä»¶åˆ é™¤æˆåŠŸ"),await P()}catch(M){const g=M instanceof Error?M.message:"åˆ é™¤æ’ä»¶å¤±è´¥";t.error(g)}}return ut(()=>{P(),w()}),(T,M)=>(L(),K("div",Zc,[e("div",Qc,[M[1]||(M[1]=e("div",{class:"settings-group-title"},"å·²å®‰è£…æ’ä»¶",-1)),l.value?(L(),K("div",ed,"åŠ è½½ä¸­...")):p.value.length===0?(L(),K("div",td,"æš‚æ— å·²å®‰è£…çš„æ’ä»¶")):(L(),K("div",od,[(L(!0),K(Ke,null,je(p.value,g=>(L(),K("div",{key:g.name,class:"plugin-item"},[e("div",nd,[e("div",sd,[e("span",ad,le(g.display_name||g.name),1),e("span",ld,"v"+le(g.version||"1.0.0"),1)]),e("p",id,le(g.description||"æš‚æ— æè¿°"),1)]),e("div",rd,[e("label",ud,[e("input",{type:"checkbox",checked:g.enabled,onChange:d=>O(g)},null,40,cd),M[0]||(M[0]=e("span",{class:"slider"},null,-1))]),g.has_config?(L(),K("button",{key:0,class:"btn btn-sm",onClick:d=>J(g),title:"é…ç½®"},"âš™ï¸",8,dd)):ge("",!0),e("button",{class:"btn btn-sm btn-danger",onClick:d=>I(g),title:"åˆ é™¤"},"ğŸ—‘ï¸",8,gd)])]))),128))]))]),e("div",pd,[M[3]||(M[3]=e("div",{class:"settings-group-title"},"é»˜è®¤å¯ç”¨çŠ¶æ€",-1)),M[4]||(M[4]=e("p",{class:"settings-hint"},"è®¾ç½®æ’ä»¶åœ¨æ–°ä¼šè¯ä¸­çš„é»˜è®¤å¯ç”¨çŠ¶æ€",-1)),(L(!0),K(Ke,null,je(p.value,g=>(L(),K("div",{key:"default-"+g.name,class:"default-state-item"},[e("span",vd,le(g.display_name||g.name),1),e("label",md,[e("input",{type:"checkbox",checked:o.value[g.name],onChange:d=>Y(g.name,d)},null,40,bd),M[2]||(M[2]=e("span",{class:"slider"},null,-1))])]))),128))]),c.value?(L(),K("div",{key:0,class:"plugin-config-modal",onClick:Ze(R,["self"])},[e("div",fd,[e("div",hd,[e("h4",null,le(s.value?.display_name||s.value?.name)+" é…ç½®",1),e("span",{class:"close-btn",onClick:R},"Ã—")]),e("div",yd,[(L(!0),K(Ke,null,je(i.value,(g,d)=>(L(),K("div",{key:d,class:"config-field"},[e("label",{for:"config-"+d},le(g.label||d)+":",9,xd),g.type==="boolean"?se((L(),K("input",{key:0,type:"checkbox",id:"config-"+d,"onUpdate:modelValue":y=>k.value[d]=y},null,8,kd)),[[Qe,k.value[d]]]):g.type==="select"?(L(),at(Oe,{key:1,"model-value":String(k.value[d]??""),options:g.options||[],onChange:y=>{k.value[d]=y}},null,8,["model-value","options","onChange"])):g.type==="number"?se((L(),K("input",{key:2,type:"number",id:"config-"+d,"onUpdate:modelValue":y=>k.value[d]=y,min:g.min,max:g.max},null,8,_d)),[[we,k.value[d],void 0,{number:!0}]]):se((L(),K("input",{key:3,type:"text",id:"config-"+d,"onUpdate:modelValue":y=>k.value[d]=y,placeholder:g.placeholder},null,8,Sd)),[[we,k.value[d]]]),g.description?(L(),K("p",Cd,le(g.description),1)):ge("",!0)]))),128))]),e("div",{class:"plugin-config-footer"},[e("button",{class:"btn btn-secondary",onClick:R},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:f},"ä¿å­˜")])])])):ge("",!0)]))}}),$d=qe(wd,[["__scopeId","data-v-a62393a7"]]),Id={class:"more-settings"},Td={class:"settings-group"},Dd={class:"settings-item"},Rd={class:"settings-group"},Md={class:"settings-item"},Bd=["disabled"],Ed={key:0,class:"font-count"},Pd={class:"settings-item"},Ad={class:"settings-group"},Fd={class:"settings-row"},Ld={class:"settings-item"},Ud=["disabled"],Od={class:"settings-item"},zd=["disabled"],Nd=He({__name:"MoreSettings",setup(n){const t=[{label:"å‰ç«¯ pdf.js (æ¨è)",value:"frontend"},{label:"åç«¯ PyMuPDF",value:"backend"}],p=Je(),o=rt(),l=S(!1),c=S([]),s=S(!1),i=S(null),k=S({pdfProcessingMethod:p.settings.pdfProcessingMethod||"frontend"});ye(()=>k.value.pdfProcessingMethod,J=>{p.setPdfProcessingMethod(J)});async function P(){l.value=!0;try{const J=await Ne.getFontList();c.value=J.fonts||[],o.success(`è·å–åˆ° ${c.value.length} ä¸ªå­—ä½“`)}catch(J){const R=J instanceof Error?J.message:"è·å–å­—ä½“åˆ—è¡¨å¤±è´¥";o.error(R)}finally{l.value=!1}}async function w(J){const f=J.target.files?.[0];if(!f)return;const I=[".ttf",".ttc",".otf"],T=f.name.toLowerCase().slice(f.name.lastIndexOf("."));if(!I.includes(T)){o.error("ä¸æ”¯æŒçš„å­—ä½“æ ¼å¼ï¼Œè¯·ä¸Šä¼  .ttf, .ttc æˆ– .otf æ–‡ä»¶");return}try{const M=await Ne.uploadFont(f);M.success?(o.success(`å­—ä½“ "${M.fontPath||f.name}" ä¸Šä¼ æˆåŠŸ`),await P()):o.error(M.error||"å­—ä½“ä¸Šä¼ å¤±è´¥")}catch(M){const g=M instanceof Error?M.message:"å­—ä½“ä¸Šä¼ å¤±è´¥";o.error(g)}finally{i.value&&(i.value.value="")}}async function O(){s.value=!0;try{const J=await Qo();J.success?o.success(`å·²æ¸…ç† ${J.deleted_count||0} ä¸ªè°ƒè¯•æ–‡ä»¶`):o.error(J.error||"æ¸…ç†å¤±è´¥")}catch(J){const R=J instanceof Error?J.message:"æ¸…ç†å¤±è´¥";o.error(R)}finally{s.value=!1}}async function Y(){s.value=!0;try{const J=await ro();J.success?o.success(`å·²æ¸…ç† ${J.deleted_count||0} ä¸ªä¸´æ—¶æ–‡ä»¶`):o.error(J.error||"æ¸…ç†å¤±è´¥")}catch(J){const R=J instanceof Error?J.message:"æ¸…ç†å¤±è´¥";o.error(R)}finally{s.value=!1}}return(J,R)=>(L(),K("div",Id,[e("div",Td,[R[3]||(R[3]=e("div",{class:"settings-group-title"},"PDFå¤„ç†è®¾ç½®",-1)),e("div",Dd,[R[1]||(R[1]=e("label",{for:"settingsPdfProcessingMethod"},"PDFå¤„ç†æ–¹å¼:",-1)),he(Oe,{modelValue:k.value.pdfProcessingMethod,"onUpdate:modelValue":R[0]||(R[0]=f=>k.value.pdfProcessingMethod=f),options:t},null,8,["modelValue"]),R[2]||(R[2]=e("div",{class:"input-hint"},"å‰ç«¯å¤„ç†é€Ÿåº¦æ›´å¿«ï¼Œåç«¯å¤„ç†å…¼å®¹æ€§æ›´å¥½",-1))])]),e("div",Rd,[R[7]||(R[7]=e("div",{class:"settings-group-title"},"å­—ä½“è®¾ç½®",-1)),e("div",Md,[R[4]||(R[4]=e("label",null,"ç³»ç»Ÿå­—ä½“åˆ—è¡¨:",-1)),e("button",{class:"btn btn-secondary",onClick:P,disabled:l.value},le(l.value?"åŠ è½½ä¸­...":"ğŸ”„ åˆ·æ–°å­—ä½“åˆ—è¡¨"),9,Bd),c.value.length>0?(L(),K("div",Ed,"å…± "+le(c.value.length)+" ä¸ªå­—ä½“",1)):ge("",!0)]),e("div",Pd,[R[5]||(R[5]=e("label",null,"ä¸Šä¼ è‡ªå®šä¹‰å­—ä½“:",-1)),e("input",{type:"file",accept:".ttf,.ttc,.otf",onChange:w,ref_key:"fontInput",ref:i},null,544),R[6]||(R[6]=e("div",{class:"input-hint"},"æ”¯æŒ .ttf, .ttc, .otf æ ¼å¼",-1))])]),e("div",Ad,[R[10]||(R[10]=e("div",{class:"settings-group-title"},"ç¼“å­˜æ¸…ç†",-1)),e("div",Fd,[e("div",Ld,[e("button",{class:"btn btn-secondary",onClick:O,disabled:s.value},le(s.value?"æ¸…ç†ä¸­...":"ğŸ—‘ï¸ æ¸…ç†è°ƒè¯•æ–‡ä»¶"),9,Ud),R[8]||(R[8]=e("div",{class:"input-hint"},"æ¸…ç†è°ƒè¯•è¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶",-1))]),e("div",Od,[e("button",{class:"btn btn-secondary",onClick:Y,disabled:s.value},le(s.value?"æ¸…ç†ä¸­...":"ğŸ—‘ï¸ æ¸…ç†ä¸´æ—¶æ–‡ä»¶"),9,zd),R[9]||(R[9]=e("div",{class:"input-hint"},"æ¸…ç†ä¸‹è½½å’Œå¤„ç†è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶",-1))])])]),R[11]||(R[11]=eo('<div class="settings-group" data-v-136fb3b8><div class="settings-group-title" data-v-136fb3b8>å…³äº</div><div class="about-info" data-v-136fb3b8><p data-v-136fb3b8><strong data-v-136fb3b8>Saber-Translator</strong></p><p data-v-136fb3b8>AIé©±åŠ¨çš„æ¼«ç”»ç¿»è¯‘å·¥å…·</p><p class="links" data-v-136fb3b8><a href="http://www.mashirosaber.top" target="_blank" data-v-136fb3b8>ğŸ“– ä½¿ç”¨æ•™ç¨‹</a><a href="https://github.com/MashiroSaber/saber-translator" target="_blank" data-v-136fb3b8>ğŸ™ GitHub</a></p><p class="disclaimer" data-v-136fb3b8>æœ¬é¡¹ç›®å®Œå…¨å¼€æºå…è´¹ï¼Œè¯·å‹¿ä¸Šå½“å—éª—</p></div></div>',1))]))}}),Vd=qe(Nd,[["__scopeId","data-v-136fb3b8"]]),Wd={class:"settings-modal-content"},Kd={class:"settings-tabs"},qd=["onClick"],Hd={class:"settings-tab-content"},Jd={class:"settings-tab-pane active"},jd={class:"settings-tab-pane"},Yd={class:"settings-tab-pane"},Gd={class:"settings-tab-pane"},Xd={class:"settings-tab-pane"},Zd={class:"settings-tab-pane"},Qd={class:"settings-tab-pane"},eg={class:"settings-tab-pane"},tg=He({__name:"SettingsModal",props:{modelValue:{type:Boolean},initialTab:{}},emits:["update:modelValue","save"],setup(n,{emit:t}){const p=n,o=t,l=Je(),c=S(p.modelValue),s=S("ocr"),i=[{id:"ocr",label:"OCRè¯†åˆ«"},{id:"translate",label:"ç¿»è¯‘æœåŠ¡"},{id:"detection",label:"æ£€æµ‹è®¾ç½®"},{id:"hq",label:"é«˜è´¨é‡ç¿»è¯‘"},{id:"proofreading",label:"AIæ ¡å¯¹"},{id:"prompt-library",label:"æç¤ºè¯ç®¡ç†"},{id:"plugins",label:"æ’ä»¶ç®¡ç†"},{id:"more",label:"æ›´å¤š"}];ye(()=>p.modelValue,O=>{c.value=O,O?(document.body.style.overflow="hidden",p.initialTab&&i.some(Y=>Y.id===p.initialTab)&&(s.value=p.initialTab)):(document.body.style.overflow="",s.value="ocr")});function k(){c.value=!1,o("update:modelValue",!1),document.body.style.overflow=""}async function P(){l.saveToStorage();try{await l.saveToBackend(),console.log("[SettingsModal] è®¾ç½®å·²ä¿å­˜åˆ°åç«¯")}catch(O){console.warn("[SettingsModal] ä¿å­˜åˆ°åç«¯å¤±è´¥ï¼Œä»…ä¿å­˜åˆ° localStorage:",O)}o("save"),k()}function w(O){O.key==="Escape"&&c.value&&k()}return ut(()=>{document.addEventListener("keydown",w)}),Tt(()=>{document.removeEventListener("keydown",w),document.body.style.overflow=""}),(O,Y)=>c.value?(L(),K("div",{key:0,class:"settings-modal",onClick:Ze(k,["self"])},[e("div",Wd,[e("div",{class:"settings-modal-header"},[Y[0]||(Y[0]=e("h3",null,"âš™ï¸ è®¾ç½®",-1)),e("span",{class:"settings-modal-close",onClick:k},"Ã—")]),e("div",Kd,[(L(),K(Ke,null,je(i,J=>e("button",{key:J.id,class:Me(["settings-tab",{active:s.value===J.id}]),onClick:R=>s.value=J.id},le(J.label),11,qd)),64))]),e("div",Hd,[se(e("div",Jd,[he(Ui)],512),[[Fe,s.value==="ocr"]]),se(e("div",jd,[he($r)],512),[[Fe,s.value==="translate"]]),se(e("div",Yd,[he(jr)],512),[[Fe,s.value==="detection"]]),se(e("div",Gd,[he(Eu)],512),[[Fe,s.value==="hq"]]),se(e("div",Xd,[he(Rc)],512),[[Fe,s.value==="proofreading"]]),se(e("div",Zd,[he(Xc)],512),[[Fe,s.value==="prompt-library"]]),se(e("div",Qd,[he($d)],512),[[Fe,s.value==="plugins"]]),se(e("div",eg,[he(Vd)],512),[[Fe,s.value==="more"]])]),e("div",{class:"settings-modal-footer"},[e("button",{class:"btn btn-secondary",onClick:k},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:P},"ä¿å­˜è®¾ç½®")])])])):ge("",!0)}}),og=qe(tg,[["__scopeId","data-v-e1ec20ab"]]),ng={minScale:.1,maxScale:5,zoomSpeed:.1};function jo(n={}){const t={...ng,...n},p=S(1),o=S(0),l=S(0),c=S(!1),s=S(0),i=S(0),k=Q(()=>({transform:`translate(${o.value}px, ${l.value}px) scale(${p.value})`}));function P(B,H,V){const x=Math.min(Math.max(p.value*V,t.minScale),t.maxScale),b=x/p.value;o.value=B-(B-o.value)*b,l.value=H-(H-l.value)*b,p.value=x,n.onScaleChange?.(p.value),n.onTransformChange?.(v())}function w(B,H=800,V=600){P(H/2,V/2,B)}function O(){w(1.2)}function Y(){w(.8)}function J(B,H=800,V=600){const x=B/p.value;P(H/2,V/2,x)}function R(B,H){c.value=!0,s.value=B,i.value=H}function f(B,H){if(!c.value)return;const V=B-s.value,x=H-i.value;o.value+=V,l.value+=x,s.value=B,i.value=H,n.onTransformChange?.(v())}function I(){c.value=!1}function T(B,H){o.value+=B,l.value+=H,n.onTransformChange?.(v())}function M(){p.value=1,o.value=0,l.value=0,n.onScaleChange?.(p.value),n.onTransformChange?.(v())}function g(){M()}function d(){p.value=1,o.value=0,l.value=0}function y(B,H,V,x){if(!B||!H)return;const b=V/B,$=x/H;p.value=Math.min(b,$)*.95,o.value=(V-B*p.value)/2,l.value=(x-H*p.value)/2,n.onScaleChange?.(p.value),n.onTransformChange?.(v())}function v(){return{scale:p.value,translateX:o.value,translateY:l.value}}function C(B){B.scale!==void 0&&(p.value=B.scale),B.translateX!==void 0&&(o.value=B.translateX),B.translateY!==void 0&&(l.value=B.translateY),n.onTransformChange?.(v())}function E(B){p.value=B.scale,o.value=B.translateX,l.value=B.translateY}function q(B,H,V){if(!B||B.length<4)return;const[x,b,$,a]=B,u=(x+$)/2,h=(b+a)/2,W=H/2,A=V/2;o.value=W-u*p.value,l.value=A-h*p.value,n.onTransformChange?.(v())}return{scale:p,translateX:o,translateY:l,isDragging:c,transformStyle:k,zoomAt:P,zoom:w,zoomIn:O,zoomOut:Y,setScale:J,startDrag:R,drag:f,endDrag:I,pan:T,reset:M,resetZoom:g,resetTransform:d,fitToScreen:y,getTransform:v,setTransform:C,syncWith:E,scrollToBubble:q}}function sg(n){const t=et(),p=Je(),o=S(null),l=S(Nn),c=S(!1),s=S(!1),i=S([]),k=S(0),P=S(0);let w=null,O=null,Y=null;const J=Q(()=>o.value!==null),R=Q(()=>o.value==="repair"?{fill:"rgba(76, 175, 80, 0.4)",border:"#4CAF50"}:o.value==="restore"?{fill:"rgba(33, 150, 243, 0.4)",border:"#2196F3"}:{fill:"transparent",border:"transparent"});function f(h){o.value!==h&&(o.value=h,c.value=!0,i.value=[],console.log(`è¿›å…¥${h==="repair"?"ä¿®å¤":"è¿˜åŸ"}ç¬”åˆ·æ¨¡å¼ï¼Œç¬”åˆ·å¤§å°: ${l.value}px`))}function I(){s.value&&C();const h=o.value!==null;o.value=null,c.value=!1,s.value=!1,i.value=[],H(),h&&console.log("é€€å‡ºç¬”åˆ·æ¨¡å¼")}function T(h){o.value===h?I():f(h)}function M(h){l.value=Math.max(Uo,Math.min(Lo,h))}function g(h){M(l.value+h)}function d(h){if(!J.value)return;h.preventDefault(),h.stopPropagation();const W=h.deltaY>0?-5:5;g(W)}function y(h,W){if(!J.value||h.button!==0)return;h.preventDefault(),h.stopPropagation(),s.value=!0,w=W,i.value=[];const A=E(h,W);A&&(i.value.push(A),B(W),V(A)),console.log("å¼€å§‹ç¬”åˆ·æ¶‚æŠ¹")}function v(h){if(k.value=h.clientX,P.value=h.clientY,!s.value||!J.value)return;const W=E(h,w);W&&(i.value.push(W),V(W))}function C(){if(!s.value)return;s.value=!1;const h=t.currentImage;if(!h||i.value.length===0){H(),i.value=[];return}const W=q();if(!W){H(),i.value=[];return}const A=o.value;(async()=>{A==="restore"?await x(h,W):A==="repair"&&await b(h,W),n?.onBrushComplete?.()})(),H(),i.value=[]}function E(h,W){if(!W)return null;const A=W.querySelector(".image-canvas-wrapper"),U=A?.querySelector("img");if(!U||!U.naturalWidth)return null;const G=A.getBoundingClientRect(),D=window.getComputedStyle(A).transform;let m=1;D&&D!=="none"&&(m=new DOMMatrix(D).a);const N=(h.clientX-G.left)/m,r=(h.clientY-G.top)/m,_=U.naturalWidth,re=U.naturalHeight;return N<0||r<0||N>_||r>re?null:{x:N,y:r,scale:m}}function q(){if(i.value.length===0)return null;const W=i.value[0]?.scale||1,A=l.value/2/W;let U=1/0,G=1/0,D=-1/0,m=-1/0;for(const N of i.value)U=Math.min(U,N.x-A),G=Math.min(G,N.y-A),D=Math.max(D,N.x+A),m=Math.max(m,N.y+A);return{x1:Math.max(0,Math.floor(U)),y1:Math.max(0,Math.floor(G)),x2:Math.ceil(D),y2:Math.ceil(m),path:[...i.value],radius:A}}function B(h){H();const W=h.querySelector(".image-canvas-wrapper"),A=W?.querySelector("img");if(!A)return;const U=document.createElement("canvas");U.id="brushOverlayCanvas",U.width=A.naturalWidth,U.height=A.naturalHeight,U.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100;",W.appendChild(U),O=U,Y=U.getContext("2d")}function H(){O&&O.parentNode&&O.parentNode.removeChild(O),O=null,Y=null}function V(h){if(!Y||!h)return;const W=R.value.fill,A=l.value/2/(h.scale||1);Y.beginPath(),Y.arc(h.x,h.y,A,0,Math.PI*2),Y.fillStyle=W,Y.fill()}async function x(h,W){if(!h.originalDataURL)return;let A;return h.cleanImageData?A="data:image/png;base64,"+h.cleanImageData:A=h.originalDataURL,new Promise(U=>{const G=new Image,D=new Image;let m=0;const N=()=>{if(m++,m<2)return;const r=document.createElement("canvas");r.width=G.naturalWidth,r.height=G.naturalHeight;const _=r.getContext("2d");if(!_){U();return}_.drawImage(G,0,0);const re=document.createElement("canvas");re.width=r.width,re.height=r.height;const F=re.getContext("2d");if(!F){U();return}F.fillStyle="white";for(const de of W.path)F.beginPath(),F.arc(de.x,de.y,W.radius,0,Math.PI*2),F.fill();_.globalCompositeOperation="destination-out",_.drawImage(re,0,0),_.globalCompositeOperation="destination-over",_.drawImage(D,0,0),_.globalCompositeOperation="source-over";const te=r.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:te}),console.log("è¿˜åŸç¬”åˆ·åŒºåŸŸå®Œæˆ"),U()};G.onload=N,G.onerror=()=>U(),D.onload=N,D.onerror=()=>U(),G.src=A,D.src=h.originalDataURL})}async function b(h,W){const A=n?.getCurrentRepairSettings?.()||{inpaintMethod:"solid",fillColor:"#FFFFFF"},U=A.inpaintMethod;U==="lama_mpe"||U==="litelama"?await $(h,W,U):await a(h,W,A.fillColor)}async function $(h,W,A="lama_mpe"){let U,G;if(h.cleanImageData)U=h.cleanImageData,G="data:image/png;base64,"+h.cleanImageData;else if(h.originalDataURL)U=h.originalDataURL.split(",")[1],G=h.originalDataURL;else{console.error("æ— æ³•è·å–åŸºç¡€å›¾åƒç”¨äº LAMA ä¿®å¤");return}return new Promise(D=>{const m=new Image;m.onload=async()=>{const N=m.naturalWidth,r=m.naturalHeight,_=document.createElement("canvas");_.width=N,_.height=r;const re=_.getContext("2d");if(!re){console.error("æ— æ³•åˆ›å»ºæ©è†œç”»å¸ƒä¸Šä¸‹æ–‡"),D();return}re.fillStyle="black",re.fillRect(0,0,N,r),re.fillStyle="white";for(const $e of W.path)re.beginPath(),re.arc($e.x,$e.y,W.radius,0,Math.PI*2),re.fill();const te=_.toDataURL("image/png").split(",")[1],de=[W.x1,W.y1,W.x2,W.y2],_e=A==="litelama"?"litelama":"lama_mpe";try{fe("LAMA ä¿®å¤ä¸­...","info");const $e=await go(U,de,{method:"lama",lamaModel:_e,maskData:te});if($e.success&&$e.inpainted_image)t.updateCurrentImage({cleanImageData:$e.inpainted_image}),console.log("ä¿®å¤ç¬”åˆ·åŒºåŸŸå®Œæˆï¼ˆLAMA ä¿®å¤ï¼Œç²¾ç¡®æ©è†œï¼‰"),fe("LAMA ä¿®å¤å®Œæˆ","success");else throw new Error($e.error||"LAMA ä¿®å¤è¿”å›æ— æ•ˆæ•°æ®")}catch($e){console.error("LAMA ä¿®å¤å¤±è´¥ï¼Œå›é€€åˆ°çº¯è‰²å¡«å……:",$e),fe("LAMA ä¿®å¤å¤±è´¥ï¼Œä½¿ç”¨çº¯è‰²å¡«å……","warning");const Pe=n?.getCurrentRepairSettings?.();await a(h,W,Pe?.fillColor)}D()},m.onerror=()=>{console.error("åŠ è½½å›¾åƒå¤±è´¥ï¼Œæ— æ³•è¿›è¡Œ LAMA ä¿®å¤"),D()},m.src=G})}async function a(h,W,A){const U=A||p.settings.textStyle.fillColor||"#FFFFFF";let G;if(h.cleanImageData)G="data:image/png;base64,"+h.cleanImageData;else if(h.originalDataURL)G=h.originalDataURL;else return;return new Promise(D=>{const m=new Image;m.onload=()=>{const N=document.createElement("canvas");N.width=m.naturalWidth,N.height=m.naturalHeight;const r=N.getContext("2d");if(!r){D();return}r.drawImage(m,0,0),r.fillStyle=U;for(const re of W.path)r.beginPath(),r.arc(re.x,re.y,W.radius,0,Math.PI*2),r.fill();const _=N.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:_}),console.log("ä¿®å¤ç¬”åˆ·åŒºåŸŸå®Œæˆï¼ˆçº¯è‰²å¡«å……ï¼‰"),D()},m.onerror=()=>D(),m.src=G})}async function u(){const h=t.currentImage;if(!h)return console.warn("ensureCleanBackground: æ²¡æœ‰å½“å‰å›¾ç‰‡"),!1;if(h.cleanImageData)return console.log("ensureCleanBackground: å·²æœ‰å¹²å‡€èƒŒæ™¯"),!0;const W=n?.getCurrentRepairSettings?.();if((W?.inpaintMethod||p.settings.textStyle.inpaintMethod)!=="solid")return console.log("ensureCleanBackground: éçº¯è‰²å¡«å……æ¨¡å¼ï¼Œè·³è¿‡"),!1;if(!h.bubbleStates||h.bubbleStates.length===0)return console.warn("ensureCleanBackground: æ²¡æœ‰æ°”æ³¡æ•°æ®"),!1;if(!h.translatedDataURL&&!h.originalDataURL)return console.warn("ensureCleanBackground: æ²¡æœ‰å›¾ç‰‡æ•°æ®"),!1;console.log("ensureCleanBackground: å°è¯•ä¸ºçº¯è‰²å¡«å……æ¨¡å¼åˆ›å»ºä¸´æ—¶å¹²å‡€èƒŒæ™¯");const U=h.translatedDataURL||h.originalDataURL,G=W?.fillColor||p.settings.textStyle.fillColor||"#FFFFFF";return new Promise(D=>{const m=new Image;m.onload=()=>{try{const N=document.createElement("canvas");N.width=m.naturalWidth,N.height=m.naturalHeight;const r=N.getContext("2d");if(!r){console.error("ensureCleanBackground: æ— æ³•è·å– Canvas ä¸Šä¸‹æ–‡"),D(!1);return}r.drawImage(m,0,0),r.fillStyle=G;for(const re of h.bubbleStates){const[F,te,de,_e]=re.coords;r.fillRect(F,te,de-F+1,_e-te+1)}const _=N.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:_}),console.log("ensureCleanBackground: æˆåŠŸåˆ›å»ºä¸´æ—¶å¹²å‡€èƒŒæ™¯ï¼ˆçº¯è‰²å¡«å……ï¼‰"),D(!0)}catch(N){console.error("ensureCleanBackground: Canvas æ“ä½œå¤±è´¥:",N),D(!1)}},m.onerror=()=>{console.error("ensureCleanBackground: åŠ è½½å›¾åƒå¤±è´¥"),D(!1)},m.src=U})}return Tt(()=>{I()}),{brushMode:o,brushSize:l,isBrushKeyDown:c,isBrushPainting:s,mouseX:k,mouseY:P,isActive:J,brushColor:R,BRUSH_MIN_SIZE:Uo,BRUSH_MAX_SIZE:Lo,enterBrushMode:f,exitBrushMode:I,toggleBrushMode:T,setBrushSize:M,adjustBrushSize:g,handleBrushWheel:d,startBrushPainting:y,continueBrushPainting:v,finishBrushPainting:C,getBrushPositionInImage:E,getBrushPathBounds:q,ensureCleanBackground:u}}function ag(n){return[Math.round(n[0]),Math.round(n[1]),Math.round(n[2]),Math.round(n[3])]}function lg(n){const t=dt(),p=et(),o=Je(),{bubbles:l,selectedIndex:c,hasSelection:s}=yt(t),{currentImage:i}=yt(p),k=S(!1),P=S(!1),w=S(null),O=S(0),Y=S(0),J=S(!1);function R(r){t.selectBubble(r)}function f(r){t.toggleMultiSelect(r)}function I(){t.clearMultiSelect()}function T(r,_){console.log(`å¼€å§‹æ‹–åŠ¨æ°”æ³¡ #${r+1}`)}function M(r,_){}function g(r,_){t.updateBubble(r,{coords:_}),console.log(`æ°”æ³¡ #${r+1} æ‹–åŠ¨å®Œæˆ:`,_),A()}function d(r,_,re){console.log(`å¼€å§‹è°ƒæ•´æ°”æ³¡ #${r+1} å¤§å°ï¼Œæ‰‹æŸ„: ${_}`)}function y(r){}function v(r,_){t.updateBubble(r,{coords:_}),console.log(`æ°”æ³¡ #${r+1} è°ƒæ•´å¤§å°å®Œæˆ:`,_),A()}function C(r,_){console.log(`å¼€å§‹æ—‹è½¬æ°”æ³¡ #${r+1}`)}function E(r){}function q(r,_){t.updateBubble(r,{rotationAngle:_}),console.log(`æ°”æ³¡ #${r+1} æ—‹è½¬å®Œæˆ: ${_}Â°`),A()}function B(){k.value=!k.value,k.value?console.log("è¿›å…¥ç»˜åˆ¶æ¨¡å¼"):console.log("é€€å‡ºç»˜åˆ¶æ¨¡å¼")}function H(r){t.addBubble(r),t.selectBubble(t.bubbleCount-1),console.log("å·²æ·»åŠ æ–°æ°”æ³¡:",r),n?.onReRender?.()}function V(r,_){P.value=!0,O.value=r,Y.value=_,w.value=[r,_,r,_]}function x(r,_){P.value&&(w.value=[O.value,Y.value,r,_])}function b(){if(!P.value||!w.value)return P.value=!1,w.value=null,null;const[r,_,re,F]=w.value,te=10;if(Math.abs(re-r)<te||Math.abs(F-_)<te)return P.value=!1,w.value=null,null;const de=[Math.min(r,re),Math.min(_,F),Math.max(r,re),Math.max(_,F)];return P.value=!1,w.value=null,de}function $(){P.value=!1,w.value=null,k.value=!1}function a(){if(!w.value)return{};const[r,_,re,F]=w.value;return{position:"absolute",left:`${Math.min(r,re)}px`,top:`${Math.min(_,F)}px`,width:`${Math.abs(re-r)}px`,height:`${Math.abs(F-_)}px`,border:"2px dashed #00d4ff",background:"rgba(0, 212, 255, 0.1)",pointerEvents:"none",zIndex:"25",boxSizing:"border-box"}}let u=null,h=!1;const W=150;function A(){u&&clearTimeout(u),u=setTimeout(async()=>{if(h){console.log("è·³è¿‡æ¸²æŸ“ï¼Œä¸Šä¸€æ¬¡æ¸²æŸ“ä»åœ¨è¿›è¡Œä¸­");return}console.log("è§¦å‘å»¶è¿Ÿæ¸²æŸ“é¢„è§ˆ"),h=!0;try{n?.onDelayedPreview?await n.onDelayedPreview():n?.onReRender&&await n.onReRender()}catch(r){console.error("å»¶è¿Ÿæ¸²æŸ“é¢„è§ˆå¤±è´¥:",r)}finally{h=!1}},W)}function U(r){t.updateSelectedBubble(r),A()}function G(){s.value&&(t.deleteSelected(),console.log("å·²åˆ é™¤é€‰ä¸­çš„æ°”æ³¡"),n?.onReRender?.())}async function D(){const r=c.value;if(r<0){console.warn("è¯·å…ˆé€‰ä¸­è¦ä¿®å¤çš„æ°”æ³¡æ¡†");return}const _=l.value[r],re=i.value;if(!_||!re?.originalDataURL){console.warn("æ— æ³•ä¿®å¤èƒŒæ™¯ï¼šç¼ºå°‘æ°”æ³¡æˆ–å›¾ç‰‡æ•°æ®");return}const F=_.inpaintMethod||"solid",te=_.fillColor||"#FFFFFF",de=_.rotationAngle||0;try{console.log(`å¼€å§‹ä¿®å¤æ°”æ³¡ #${r+1} èƒŒæ™¯ï¼Œæ–¹æ³•: ${F}`);let _e;if(re.cleanImageData)_e=re.cleanImageData;else{const Pe=re.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/);if(_e=Pe&&Pe[1]?Pe[1]:"",!_e){console.error("æ— æ³•è§£æå›¾åƒæ•°æ®");return}}if(F==="lama_mpe"||F==="litelama"){const Pe=F==="litelama"?"litelama":"lama_mpe",Be=ag(_.coords),ae=await go(_e,Be,{bubbleAngle:de,method:"lama",lamaModel:Pe});ae.success&&ae.inpainted_image?(p.updateCurrentImage({cleanImageData:ae.inpainted_image}),console.log(`æ°”æ³¡ #${r+1} LAMAèƒŒæ™¯ä¿®å¤æˆåŠŸ`),A()):(console.error("LAMAä¿®å¤å¤±è´¥:",ae.error||"æœªçŸ¥é”™è¯¯"),await m(_.coords,te,de),A())}else await m(_.coords,te,de),console.log(`æ°”æ³¡ #${r+1} çº¯è‰²å¡«å……ä¿®å¤æˆåŠŸ`),A()}catch(_e){console.error("èƒŒæ™¯ä¿®å¤å‡ºé”™:",_e)}}async function m(r,_,re=0){const F=i.value;if(!F)return;const[te,de,_e,$e]=r;let Pe;if(F.cleanImageData)Pe="data:image/png;base64,"+F.cleanImageData;else if(F.originalDataURL)Pe=F.originalDataURL;else{console.error("æ— æ³•æ‰¾åˆ°åŸºç¡€å›¾åƒç”¨äºå¡«å……");return}return new Promise(Be=>{const ae=new Image;ae.onload=()=>{const Z=document.createElement("canvas");Z.width=ae.naturalWidth,Z.height=ae.naturalHeight;const z=Z.getContext("2d");if(!z){Be();return}if(z.drawImage(ae,0,0),z.fillStyle=_,Math.abs(re)<.1)z.fillRect(te,de,_e-te,$e-de);else{const oe=(te+_e)/2,ue=(de+$e)/2,me=(_e-te)/2,xe=($e-de)/2,be=re*Math.PI/180,pe=Math.cos(be),Ie=Math.sin(be),Se=[[-me,-xe],[me,-xe],[me,xe],[-me,xe]].map(([Le,De])=>[oe+Le*pe-De*Ie,ue+Le*Ie+De*pe]);z.beginPath();const ze=Se[0];if(ze){z.moveTo(ze[0],ze[1]);for(let Le=1;Le<Se.length;Le++){const De=Se[Le];De&&z.lineTo(De[0],De[1])}}z.closePath(),z.fill()}const ne=Z.toDataURL("image/png").split(",")[1];p.updateCurrentImage({cleanImageData:ne}),console.log("å·²å¯¹æ°”æ³¡åŒºåŸŸè¿›è¡Œçº¯è‰²å¡«å……:",r,_,"è§’åº¦:",re),Be()},ae.onerror=()=>{console.error("åŠ è½½åŸºç¡€å›¾åƒå¤±è´¥"),Be()},ae.src=Pe})}async function N(r){const _=l.value[r],re=i.value;if(!_||!re?.originalDataURL){console.warn("æ— æ³•è¿›è¡Œ OCR è¯†åˆ«ï¼šç¼ºå°‘æ°”æ³¡æˆ–å›¾ç‰‡æ•°æ®");return}try{console.log(`å¼€å§‹ OCR è¯†åˆ«æ°”æ³¡ #${r+1}`);const F=re.originalDataURL.split(",")[1]||"",te=o.settings,de=await on(F,_.coords,te.ocrEngine||"manga_ocr",{source_language:te.sourceLanguage,baidu_ocr_api_key:te.baiduOcr.apiKey,baidu_ocr_secret_key:te.baiduOcr.secretKey,baidu_version:te.baiduOcr.version,baidu_source_language:te.baiduOcr.sourceLanguage,ai_vision_provider:te.aiVisionOcr.provider,ai_vision_api_key:te.aiVisionOcr.apiKey,ai_vision_model_name:te.aiVisionOcr.modelName,ai_vision_ocr_prompt:te.aiVisionOcr.prompt,custom_ai_vision_base_url:te.aiVisionOcr.customBaseUrl});de.success&&de.text!==void 0?(t.updateBubble(r,{originalText:de.text}),console.log(`OCR è¯†åˆ«æˆåŠŸ: "${de.text}"`)):console.error("OCR è¯†åˆ«å¤±è´¥:",de.error||"æœªçŸ¥é”™è¯¯")}catch(F){console.error("OCR è¯†åˆ«å‡ºé”™:",F)}}return{isDrawingMode:k,isDrawingBox:P,currentDrawingRect:w,isMiddleButtonDown:J,handleBubbleSelect:R,handleBubbleMultiSelect:f,handleClearMultiSelect:I,handleBubbleDragStart:T,handleBubbleDragging:M,handleBubbleDragEnd:g,handleBubbleResizeStart:d,handleBubbleResizing:y,handleBubbleResizeEnd:v,handleBubbleRotateStart:C,handleBubbleRotating:E,handleBubbleRotateEnd:q,toggleDrawingMode:B,handleDrawBubble:H,startDrawingBox:V,updateDrawingBox:x,finishDrawingBox:b,cancelDrawing:$,getDrawingRectStyle:a,handleBubbleUpdate:U,deleteSelectedBubbles:G,repairSelectedBubble:D,triggerDelayedPreview:A,handleOcrRecognize:N}}function ig(n){const t=dt(),p=et(),{bubbles:o}=yt(t),{currentImage:l}=yt(p),c=S(!1),s=S("");let i=null;function k(){const O=l.value;if(!O)return null;if(O.cleanImageData)return O.cleanImageData;if(O.originalDataURL){const Y=O.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/);if(Y&&Y[1])return Y[1]}return null}async function P(O=!1){if(!l.value)return console.warn("reRenderFullImage: æ²¡æœ‰å½“å‰å›¾ç‰‡"),!1;if(o.value.length===0){console.log("reRenderFullImage: æ²¡æœ‰æ°”æ³¡ï¼Œè·³è¿‡åç«¯æ¸²æŸ“");const f=k();if(f){const I=`data:image/png;base64,${f}`;p.updateCurrentImage({translatedDataURL:I}),O||n?.onRenderSuccess?.(I)}return!0}const J=k();if(!J)return console.error("reRenderFullImage: ç¼ºå°‘å›¾åƒæ•°æ®"),s.value="ç¼ºå°‘å›¾åƒæ•°æ®",O||n?.onRenderError?.("ç¼ºå°‘å›¾åƒæ•°æ®"),!1;const R=Symbol("render");i=R,c.value=!0,s.value="",O||n?.onRenderStart?.();try{console.log("reRenderFullImage: å¼€å§‹é‡æ–°æ¸²æŸ“ï¼Œæ°”æ³¡æ•°é‡:",o.value.length);const f=o.value,I=f.map(d=>d.translatedText||""),T=f.map(d=>d.coords.map(y=>Math.round(y))),M=f.map(d=>({translatedText:d.translatedText||"",coords:d.coords,fontSize:Number(d.fontSize)||24,fontFamily:d.fontFamily||"fonts/STSONG.TTF",textDirection:_t(d),textColor:d.textColor||"#231816",rotationAngle:Math.round(Number(d.rotationAngle)||0),position:d.position?{x:Math.round(d.position.x||0),y:Math.round(d.position.y||0)}:{x:0,y:0},strokeEnabled:d.strokeEnabled!==void 0?d.strokeEnabled:!0,strokeColor:d.strokeColor||"#FFFFFF",strokeWidth:Number(d.strokeWidth)||3})),g=await uo({clean_image:J,bubble_texts:I,bubble_coords:T,bubble_states:M,fontSize:Number(f[0]?.fontSize)||24,fontFamily:f[0]?.fontFamily||"fonts/STSONG.TTF",textDirection:f[0]?_t(f[0]):"vertical",textColor:f[0]?.textColor||"#231816",strokeEnabled:f[0]?.strokeEnabled!==void 0?f[0].strokeEnabled:!0,strokeColor:f[0]?.strokeColor||"#FFFFFF",strokeWidth:Number(f[0]?.strokeWidth)||3,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,is_font_style_change:!0});if(i!==R)return console.log("reRenderFullImage: æ¸²æŸ“ç»“æœå·²è¿‡æœŸï¼Œå¿½ç•¥"),!1;if(g.rendered_image){const d=`data:image/png;base64,${g.rendered_image}`;return p.updateCurrentImage({translatedDataURL:d}),console.log("reRenderFullImage: æ¸²æŸ“æˆåŠŸ"),O||n?.onRenderSuccess?.(d),!0}else{const d=g.error||"æ¸²æŸ“å¤±è´¥";return console.error("reRenderFullImage: æ¸²æŸ“å¤±è´¥ -",d),s.value=d,O||n?.onRenderError?.(d),!1}}catch(f){if(i!==R)return!1;const I=f instanceof Error?f.message:"æ¸²æŸ“è¯·æ±‚å¤±è´¥";return console.error("reRenderFullImage: æ¸²æŸ“å‡ºé”™ -",f),s.value=I,O||n?.onRenderError?.(I),!1}finally{i===R&&(c.value=!1,O||n?.onRenderEnd?.())}}function w(){i=null,c.value=!1}return{isRendering:c,renderError:s,reRenderFullImage:P,cancelRender:w}}const rg=["data-index","data-coords","data-rotation","onClick","onMousedown"],ug={class:"bubble-index"},cg=["data-parent-index","onMousedown"],dg=["data-parent-index","onMousedown"],gg=["data-parent-index","onMousedown"],pg=["data-parent-index","onMousedown"],vg=["data-parent-index","onMousedown"],mg=["data-parent-index","onMousedown"],bg=["data-parent-index","onMousedown"],fg=["data-parent-index","onMousedown"],hg=["data-parent-index","onMousedown"],yg=He({__name:"BubbleOverlay",props:{bubbles:{},selectedIndex:{},selectedIndices:{},scale:{},isDrawingMode:{type:Boolean},isBrushMode:{type:Boolean},imageWidth:{},imageHeight:{}},emits:["select","multiSelect","dragStart","dragging","dragEnd","resizeStart","resizing","resizeEnd","rotateStart","rotating","rotateEnd","drawBubble"],setup(n,{emit:t}){const p=dt(),{isDragging:o,draggingIndex:l,dragOffsetX:c,dragOffsetY:s,dragInitialX:i,dragInitialY:k,isResizing:P,resizingIndex:w,resizeCurrentCoords:O,isRotating:Y,rotatingIndex:J,rotateCurrentAngle:R}=yt(p),f=n,I=t,T=S(null),M=S(0),g=S(0),d=S(""),y=S(0),v=S(0),C=S(null),E=S(0),q=S(0),B=S(0),H=S(0),V=S(!1),x=S(0),b=S(0),$=S(null),a=S(!1);function u(Z,z){let ne,oe,ue,me,xe=Z.rotationAngle||0;if(o.value&&l.value===z){const[Se,ze,Le,De]=Z.coords;ne=i.value+c.value,oe=k.value+s.value,ue=ne+(Le-Se),me=oe+(De-ze)}else P.value&&w.value===z&&O.value?[ne,oe,ue,me]=O.value:Y.value&&J.value===z?([ne,oe,ue,me]=Z.coords,xe=R.value):[ne,oe,ue,me]=Z.coords;const be=ue-ne,pe=me-oe,Ie={left:`${ne}px`,top:`${oe}px`,width:`${be}px`,height:`${pe}px`};return xe&&(Ie.transformOrigin="center center",Ie.transform=`rotate(${xe}deg)`),Ie}function h(){if(!$.value)return{};const[Z,z,ne,oe]=$.value;return{left:`${Math.min(Z,ne)}px`,top:`${Math.min(z,oe)}px`,width:`${Math.abs(ne-Z)}px`,height:`${Math.abs(oe-z)}px`}}function W(Z){if(!T.value)return null;const z=T.value.getBoundingClientRect(),ne=f.scale||1,oe=(Z.clientX-z.left)/ne,ue=(Z.clientY-z.top)/ne;return{x:oe,y:ue}}function A(Z,z){f.isBrushMode||z.shiftKey||I("select",Z)}function U(Z){if(!f.isBrushMode){if(Z.button===1){Z.preventDefault(),a.value=!0,document.body.classList.add("middle-button-drawing"),_e(Z);return}Z.button===0&&f.isDrawingMode&&_e(Z)}}function G(Z,z){if(!f.isBrushMode&&z.button===0){if(z.preventDefault(),z.stopPropagation(),z.shiftKey){I("multiSelect",Z);return}if(Z!==f.selectedIndex){I("select",Z);return}D(Z,z)}}function D(Z,z){document.removeEventListener("mousemove",Be),document.removeEventListener("mouseup",ae),o.value=!0,l.value=Z,M.value=z.clientX,g.value=z.clientY,c.value=0,s.value=0;const ne=f.bubbles[Z];ne&&(i.value=ne.coords[0],k.value=ne.coords[1]),I("dragStart",Z,z),document.addEventListener("mousemove",Be),document.addEventListener("mouseup",ae)}function m(Z){const z=f.scale||1,ne=(Z.clientX-M.value)/z,oe=(Z.clientY-g.value)/z;c.value=ne,s.value=oe}function N(Z){const z=l.value;o.value=!1,l.value=-1,c.value=0,s.value=0;const ne=f.scale||1,oe=(Z.clientX-M.value)/ne,ue=(Z.clientY-g.value)/ne,me=f.bubbles[z];if(!me)return;const[xe,be,pe,Ie]=me.coords,Se=pe-xe,ze=Ie-be;let Le=Math.round(i.value+oe),De=Math.round(k.value+ue);const Te=f.imageWidth||2e3,Ye=f.imageHeight||2e3,lt=Math.min(Se,Te),it=Math.min(ze,Ye);Le=Math.max(0,Math.min(Le,Te-lt)),De=Math.max(0,Math.min(De,Ye-it));const ke=[Le,De,Le+lt,De+it];I("dragEnd",z,ke)}function r(Z,z,ne){if(f.isBrushMode||ne.button!==0)return;ne.preventDefault(),ne.stopPropagation(),document.removeEventListener("mousemove",Be),document.removeEventListener("mouseup",ae),P.value=!0,w.value=z,d.value=Z,y.value=ne.clientX,v.value=ne.clientY;const oe=f.bubbles[z];oe&&(C.value=[...oe.coords],O.value=[...oe.coords]),I("resizeStart",z,Z,ne),document.addEventListener("mousemove",Be),document.addEventListener("mouseup",ae)}function _(Z){if(!C.value)return;const z=f.scale||1,ne=(Z.clientX-y.value)/z,oe=(Z.clientY-v.value)/z;let[ue,me,xe,be]=C.value;const pe=d.value;pe.includes("w")&&(ue+=ne),pe.includes("e")&&(xe+=ne),pe.includes("n")&&(me+=oe),pe.includes("s")&&(be+=oe),ue>xe&&([ue,xe]=[xe,ue]),me>be&&([me,be]=[be,me]);const Ie=10;xe-ue<Ie||be-me<Ie||(O.value=[ue,me,xe,be])}function re(Z){if(!C.value)return;const z=f.scale||1,ne=(Z.clientX-y.value)/z,oe=(Z.clientY-v.value)/z;let[ue,me,xe,be]=C.value;const pe=d.value;pe.includes("w")&&(ue+=ne),pe.includes("e")&&(xe+=ne),pe.includes("n")&&(me+=oe),pe.includes("s")&&(be+=oe),ue>xe&&([ue,xe]=[xe,ue]),me>be&&([me,be]=[be,me]);const Ie=f.imageWidth||2e3,Se=f.imageHeight||2e3;ue=Math.max(0,Math.round(ue)),me=Math.max(0,Math.round(me)),xe=Math.min(Ie,Math.round(xe)),be=Math.min(Se,Math.round(be));const ze=10;if(xe-ue<ze||be-me<ze){console.warn("è°ƒæ•´åå°ºå¯¸è¿‡å°ï¼Œå·²æ’¤é”€"),P.value=!1,w.value=-1,C.value=null;return}I("resizeEnd",w.value,[ue,me,xe,be]),P.value=!1,w.value=-1,C.value=null,O.value=null}function F(Z,z){if(f.isBrushMode||z.button!==0)return;z.preventDefault(),z.stopPropagation(),document.removeEventListener("mousemove",Be),document.removeEventListener("mouseup",ae),Y.value=!0,J.value=Z;const ne=f.bubbles[Z];if(!ne||!T.value)return;const[oe,ue,me,xe]=ne.coords,be=f.scale||1,pe=T.value.getBoundingClientRect();B.value=pe.left+(oe+me)/2*be,H.value=pe.top+(ue+xe)/2*be;const Ie=z.clientX-B.value,Se=z.clientY-H.value;E.value=Math.atan2(Se,Ie)*180/Math.PI,q.value=ne.rotationAngle||0,R.value=ne.rotationAngle||0,I("rotateStart",Z,z),document.body.classList.add("rotating-box"),document.addEventListener("mousemove",Be),document.addEventListener("mouseup",ae),console.log(`å¼€å§‹æ—‹è½¬æ°”æ³¡ #${Z+1}ï¼Œåˆå§‹è§’åº¦: ${q.value}Â°`)}function te(Z){const z=Z.clientX-B.value,ne=Z.clientY-H.value,ue=Math.atan2(ne,z)*180/Math.PI-E.value;let me=q.value+ue;for(;me>180;)me-=360;for(;me<-180;)me+=360;Z.shiftKey&&(me=Math.round(me/15)*15),R.value=me}function de(Z){document.body.classList.remove("rotating-box");const z=J.value,ne=R.value;I("rotateEnd",z,ne),Y.value=!1,J.value=-1,console.log(`æ°”æ³¡ #${z+1} æ—‹è½¬å®Œæˆï¼Œè§’åº¦: ${ne}Â°`)}function _e(Z){const z=W(Z);if(!z)return;const ne=f.imageWidth||2e3,oe=f.imageHeight||2e3;z.x<0||z.x>ne||z.y<0||z.y>oe||(V.value=!0,x.value=z.x,b.value=z.y,$.value=[z.x,z.y,z.x,z.y],document.addEventListener("mousemove",Be),document.addEventListener("mouseup",ae),console.log("å¼€å§‹ç»˜åˆ¶æ–°æ¡†:",z.x.toFixed(1),z.y.toFixed(1)))}function $e(Z){const z=W(Z);!z||!$.value||($.value=[x.value,b.value,z.x,z.y])}function Pe(Z){const z=W(Z);if(a.value&&(a.value=!1,document.body.classList.remove("middle-button-drawing")),!z||!$.value){V.value=!1,$.value=null;return}const ne=f.imageWidth||2e3,oe=f.imageHeight||2e3,ue=Math.max(0,Math.round(Math.min(x.value,z.x))),me=Math.max(0,Math.round(Math.min(b.value,z.y))),xe=Math.min(ne,Math.round(Math.max(x.value,z.x))),be=Math.min(oe,Math.round(Math.max(b.value,z.y))),pe=10;if(xe-ue<pe||be-me<pe){console.log("ç»˜åˆ¶çš„æ¡†å¤ªå°ï¼Œå·²å¿½ç•¥"),V.value=!1,$.value=null;return}console.log("å®Œæˆç»˜åˆ¶æ–°æ¡†:",[ue,me,xe,be]),I("drawBubble",[ue,me,xe,be]),V.value=!1,$.value=null}function Be(Z){o.value?m(Z):P.value?_(Z):Y.value?te(Z):V.value&&$e(Z)}function ae(Z){document.removeEventListener("mousemove",Be),document.removeEventListener("mouseup",ae),(Z.button===1||a.value)&&(a.value=!1,document.body.classList.remove("middle-button-drawing")),o.value?N(Z):P.value?re(Z):Y.value?de():V.value&&Pe(Z)}return ut(()=>{}),Tt(()=>{document.removeEventListener("mousemove",Be),document.removeEventListener("mouseup",ae),document.body.classList.remove("middle-button-drawing"),document.body.classList.remove("rotating-box")}),(Z,z)=>(L(),K("div",{class:Me(["bubble-overlay",{"brush-mode":n.isBrushMode}]),ref_key:"overlayRef",ref:T,onMousedown:U},[(L(!0),K(Ke,null,je(n.bubbles,(ne,oe)=>(L(),K("div",{key:oe,class:Me(["bubble-highlight-box",{selected:oe===n.selectedIndex,"multi-selected":n.selectedIndices.length>1&&n.selectedIndices.includes(oe)&&oe!==n.selectedIndex}]),style:st(u(ne,oe)),"data-index":oe,"data-coords":JSON.stringify(ne.coords),"data-rotation":ne.rotationAngle||0,onClick:Ze(ue=>A(oe,ue),["stop"]),onMousedown:Ze(ue=>G(oe,ue),["stop"])},[e("span",ug,le(oe+1),1),oe===n.selectedIndex?(L(),K(Ke,{key:0},[e("div",{class:"resize-handle nw","data-handle":"nw","data-parent-index":oe,onMousedown:Ze(ue=>r("nw",oe,ue),["stop"])},null,40,cg),e("div",{class:"resize-handle n","data-handle":"n","data-parent-index":oe,onMousedown:Ze(ue=>r("n",oe,ue),["stop"])},null,40,dg),e("div",{class:"resize-handle ne","data-handle":"ne","data-parent-index":oe,onMousedown:Ze(ue=>r("ne",oe,ue),["stop"])},null,40,gg),e("div",{class:"resize-handle e","data-handle":"e","data-parent-index":oe,onMousedown:Ze(ue=>r("e",oe,ue),["stop"])},null,40,pg),e("div",{class:"resize-handle se","data-handle":"se","data-parent-index":oe,onMousedown:Ze(ue=>r("se",oe,ue),["stop"])},null,40,vg),e("div",{class:"resize-handle s","data-handle":"s","data-parent-index":oe,onMousedown:Ze(ue=>r("s",oe,ue),["stop"])},null,40,mg),e("div",{class:"resize-handle sw","data-handle":"sw","data-parent-index":oe,onMousedown:Ze(ue=>r("sw",oe,ue),["stop"])},null,40,bg),e("div",{class:"resize-handle w","data-handle":"w","data-parent-index":oe,onMousedown:Ze(ue=>r("w",oe,ue),["stop"])},null,40,fg),z[0]||(z[0]=e("div",{class:"rotate-line"},null,-1)),e("div",{class:"rotate-handle",title:"æ‹–æ‹½æ—‹è½¬","data-parent-index":oe,onMousedown:Ze(ue=>F(oe,ue),["stop"])},null,40,hg)],64)):ge("",!0)],46,rg))),128)),$.value?(L(),K("div",{key:0,class:"drawing-rect",style:st(h())},null,4)):ge("",!0)],34))}}),Yo=qe(yg,[["__scopeId","data-v-a3e510ac"]]),xg={key:0,class:"kana-keyboard"},kg={class:"kana-keyboard-header"},_g={class:"kana-keyboard-tabs"},Sg=["onClick"],Cg={class:"kana-keyboard-options"},wg={class:"kana-mode-select"},$g={class:"kana-target-select"},Ig={class:"kana-table"},Tg={class:"row-label"},Dg=["onClick"],Rg={class:"kana-hiragana"},Mg={class:"kana-katakana"},Bg={class:"kana-table"},Eg={class:"row-label"},Pg=["onClick"],Ag={class:"kana-hiragana"},Fg={class:"kana-katakana"},Lg={class:"kana-table combo-table"},Ug={class:"row-label"},Og=["onClick"],zg={class:"kana-hiragana"},Ng={class:"kana-katakana"},Vg={class:"special-chars-grid"},Wg=["onClick"],Kg={key:0,class:"char-label"},qg=He({__name:"JapaneseKeyboard",props:{visible:{type:Boolean,default:!1},defaultTarget:{default:"original"}},emits:["close","insert","delete"],setup(n,{emit:t}){const p=n,o=t,l=S("basic"),c=S("hiragana"),s=S(p.defaultTarget),i=S(null),k=[{label:"åŸæ–‡",value:"original"},{label:"è¯‘æ–‡",value:"translated"}],P=[{id:"basic",label:"åŸºæœ¬"},{id:"dakuten",label:"æµŠ/åŠæµŠéŸ³"},{id:"combo",label:"æ‹—éŸ³"},{id:"special",label:"ç‰¹æ®Š"}],w=[{label:"ã‚è¡Œ",chars:[{h:"ã‚",k:"ã‚¢"},{h:"ã„",k:"ã‚¤"},{h:"ã†",k:"ã‚¦"},{h:"ãˆ",k:"ã‚¨"},{h:"ãŠ",k:"ã‚ª"}]},{label:"ã‹è¡Œ",chars:[{h:"ã‹",k:"ã‚«"},{h:"ã",k:"ã‚­"},{h:"ã",k:"ã‚¯"},{h:"ã‘",k:"ã‚±"},{h:"ã“",k:"ã‚³"}]},{label:"ã•è¡Œ",chars:[{h:"ã•",k:"ã‚µ"},{h:"ã—",k:"ã‚·"},{h:"ã™",k:"ã‚¹"},{h:"ã›",k:"ã‚»"},{h:"ã",k:"ã‚½"}]},{label:"ãŸè¡Œ",chars:[{h:"ãŸ",k:"ã‚¿"},{h:"ã¡",k:"ãƒ"},{h:"ã¤",k:"ãƒ„"},{h:"ã¦",k:"ãƒ†"},{h:"ã¨",k:"ãƒˆ"}]},{label:"ãªè¡Œ",chars:[{h:"ãª",k:"ãƒŠ"},{h:"ã«",k:"ãƒ‹"},{h:"ã¬",k:"ãƒŒ"},{h:"ã­",k:"ãƒ"},{h:"ã®",k:"ãƒ"}]},{label:"ã¯è¡Œ",chars:[{h:"ã¯",k:"ãƒ"},{h:"ã²",k:"ãƒ’"},{h:"ãµ",k:"ãƒ•"},{h:"ã¸",k:"ãƒ˜"},{h:"ã»",k:"ãƒ›"}]},{label:"ã¾è¡Œ",chars:[{h:"ã¾",k:"ãƒ"},{h:"ã¿",k:"ãƒŸ"},{h:"ã‚€",k:"ãƒ "},{h:"ã‚",k:"ãƒ¡"},{h:"ã‚‚",k:"ãƒ¢"}]},{label:"ã‚„è¡Œ",chars:[{h:"ã‚„",k:"ãƒ¤"},null,{h:"ã‚†",k:"ãƒ¦"},null,{h:"ã‚ˆ",k:"ãƒ¨"}]},{label:"ã‚‰è¡Œ",chars:[{h:"ã‚‰",k:"ãƒ©"},{h:"ã‚Š",k:"ãƒª"},{h:"ã‚‹",k:"ãƒ«"},{h:"ã‚Œ",k:"ãƒ¬"},{h:"ã‚",k:"ãƒ­"}]},{label:"ã‚è¡Œ",chars:[{h:"ã‚",k:"ãƒ¯"},null,null,null,{h:"ã‚’",k:"ãƒ²"}]},{label:"ã‚“",chars:[{h:"ã‚“",k:"ãƒ³"},null,null,null,null]}],O=[{label:"ãŒè¡Œ",chars:[{h:"ãŒ",k:"ã‚¬"},{h:"ã",k:"ã‚®"},{h:"ã",k:"ã‚°"},{h:"ã’",k:"ã‚²"},{h:"ã”",k:"ã‚´"}]},{label:"ã–è¡Œ",chars:[{h:"ã–",k:"ã‚¶"},{h:"ã˜",k:"ã‚¸"},{h:"ãš",k:"ã‚º"},{h:"ãœ",k:"ã‚¼"},{h:"ã",k:"ã‚¾"}]},{label:"ã è¡Œ",chars:[{h:"ã ",k:"ãƒ€"},{h:"ã¢",k:"ãƒ‚"},{h:"ã¥",k:"ãƒ…"},{h:"ã§",k:"ãƒ‡"},{h:"ã©",k:"ãƒ‰"}]},{label:"ã°è¡Œ",chars:[{h:"ã°",k:"ãƒ"},{h:"ã³",k:"ãƒ“"},{h:"ã¶",k:"ãƒ–"},{h:"ã¹",k:"ãƒ™"},{h:"ã¼",k:"ãƒœ"}]},{label:"ã±è¡Œ",chars:[{h:"ã±",k:"ãƒ‘"},{h:"ã´",k:"ãƒ”"},{h:"ã·",k:"ãƒ—"},{h:"ãº",k:"ãƒš"},{h:"ã½",k:"ãƒ"}]}],Y=[{label:"ãã‚ƒè¡Œ",chars:[{h:"ãã‚ƒ",k:"ã‚­ãƒ£"},{h:"ãã‚…",k:"ã‚­ãƒ¥"},{h:"ãã‚‡",k:"ã‚­ãƒ§"}]},{label:"ã—ã‚ƒè¡Œ",chars:[{h:"ã—ã‚ƒ",k:"ã‚·ãƒ£"},{h:"ã—ã‚…",k:"ã‚·ãƒ¥"},{h:"ã—ã‚‡",k:"ã‚·ãƒ§"}]},{label:"ã¡ã‚ƒè¡Œ",chars:[{h:"ã¡ã‚ƒ",k:"ãƒãƒ£"},{h:"ã¡ã‚…",k:"ãƒãƒ¥"},{h:"ã¡ã‚‡",k:"ãƒãƒ§"}]},{label:"ã«ã‚ƒè¡Œ",chars:[{h:"ã«ã‚ƒ",k:"ãƒ‹ãƒ£"},{h:"ã«ã‚…",k:"ãƒ‹ãƒ¥"},{h:"ã«ã‚‡",k:"ãƒ‹ãƒ§"}]},{label:"ã²ã‚ƒè¡Œ",chars:[{h:"ã²ã‚ƒ",k:"ãƒ’ãƒ£"},{h:"ã²ã‚…",k:"ãƒ’ãƒ¥"},{h:"ã²ã‚‡",k:"ãƒ’ãƒ§"}]},{label:"ã¿ã‚ƒè¡Œ",chars:[{h:"ã¿ã‚ƒ",k:"ãƒŸãƒ£"},{h:"ã¿ã‚…",k:"ãƒŸãƒ¥"},{h:"ã¿ã‚‡",k:"ãƒŸãƒ§"}]},{label:"ã‚Šã‚ƒè¡Œ",chars:[{h:"ã‚Šã‚ƒ",k:"ãƒªãƒ£"},{h:"ã‚Šã‚…",k:"ãƒªãƒ¥"},{h:"ã‚Šã‚‡",k:"ãƒªãƒ§"}]},{label:"ãã‚ƒè¡Œ",chars:[{h:"ãã‚ƒ",k:"ã‚®ãƒ£"},{h:"ãã‚…",k:"ã‚®ãƒ¥"},{h:"ãã‚‡",k:"ã‚®ãƒ§"}]},{label:"ã˜ã‚ƒè¡Œ",chars:[{h:"ã˜ã‚ƒ",k:"ã‚¸ãƒ£"},{h:"ã˜ã‚…",k:"ã‚¸ãƒ¥"},{h:"ã˜ã‚‡",k:"ã‚¸ãƒ§"}]},{label:"ã³ã‚ƒè¡Œ",chars:[{h:"ã³ã‚ƒ",k:"ãƒ“ãƒ£"},{h:"ã³ã‚…",k:"ãƒ“ãƒ¥"},{h:"ã³ã‚‡",k:"ãƒ“ãƒ§"}]},{label:"ã´ã‚ƒè¡Œ",chars:[{h:"ã´ã‚ƒ",k:"ãƒ”ãƒ£"},{h:"ã´ã‚…",k:"ãƒ”ãƒ¥"},{h:"ã´ã‚‡",k:"ãƒ”ãƒ§"}]}],J=[{char:"ã£",label:"ä¿ƒéŸ³"},{char:"ãƒƒ",label:"ä¿ƒéŸ³"},{char:"ãƒ¼",label:"é•¿éŸ³"},{char:"ã€œ",label:"æ³¢æµª"},{char:"ã€‚",label:"å¥å·"},{char:"ã€",label:"é¡¿å·"},{char:"ã€Œ",label:"å¼•å·"},{char:"ã€",label:"å¼•å·"},{char:"ã€",label:"åŒå¼•"},{char:"ã€",label:"åŒå¼•"},{char:"â€¦",label:"çœç•¥"},{char:"ãƒ»",label:"ä¸­ç‚¹"},{char:"ï¼",label:"æ„Ÿå¹"},{char:"ï¼Ÿ",label:"é—®å·"},{char:"â™ª",label:"éŸ³ç¬¦"},{char:"â™¡",label:"å¿ƒå½¢"},{char:"â˜…",label:"æ˜Ÿå½¢"},{char:"â˜†",label:"ç©ºæ˜Ÿ"},{char:"ã",label:"å°ã‚"},{char:"ãƒ",label:"å°ã„"},{char:"ã…",label:"å°ã†"},{char:"ã‡",label:"å°ãˆ"},{char:"ã‰",label:"å°ãŠ"},{char:"ã‚¡",label:"å°ã‚¢"},{char:"ã‚£",label:"å°ã‚¤"},{char:"ã‚¥",label:"å°ã‚¦"},{char:"ã‚§",label:"å°ã‚¨"},{char:"ã‚©",label:"å°ã‚ª"},{char:"ã‚ƒ",label:"å°ã‚„"},{char:"ã‚…",label:"å°ã‚†"},{char:"ã‚‡",label:"å°ã‚ˆ"},{char:"ãƒ£",label:"å°ãƒ¤"},{char:"ãƒ¥",label:"å°ãƒ¦"},{char:"ãƒ§",label:"å°ãƒ¨"}];function R(){o("close")}function f(M){const g=c.value==="hiragana"?M.h:M.k;i.value=M.h,setTimeout(()=>{i.value=null},100),o("insert",g,s.value)}function I(M){i.value=M,setTimeout(()=>{i.value=null},100),o("insert",M,s.value)}function T(){o("delete",s.value)}return(M,g)=>n.visible?(L(),K("div",xg,[e("div",kg,[g[3]||(g[3]=e("span",{class:"kana-keyboard-title"},"50éŸ³é”®ç›˜",-1)),e("div",_g,[(L(),K(Ke,null,je(P,d=>e("button",{key:d.id,class:Me(["kana-tab",{active:l.value===d.id}]),onClick:y=>l.value=d.id},le(d.label),11,Sg)),64))]),e("button",{class:"kana-keyboard-close",onClick:R},"âœ•")]),e("div",Cg,[e("div",wg,[e("label",null,[se(e("input",{type:"radio",name:"kanaMode",value:"hiragana","onUpdate:modelValue":g[0]||(g[0]=d=>c.value=d)},null,512),[[Wo,c.value]]),g[4]||(g[4]=Ce(" å¹³å‡å ",-1))]),e("label",null,[se(e("input",{type:"radio",name:"kanaMode",value:"katakana","onUpdate:modelValue":g[1]||(g[1]=d=>c.value=d)},null,512),[[Wo,c.value]]),g[5]||(g[5]=Ce(" ç‰‡å‡å ",-1))])]),e("div",$g,[g[6]||(g[6]=e("label",null,"è¾“å…¥åˆ°ï¼š",-1)),he(Oe,{modelValue:s.value,"onUpdate:modelValue":g[2]||(g[2]=d=>s.value=d),options:k},null,8,["modelValue"])])]),e("div",{class:Me(["kana-tab-content",{active:l.value==="basic"}])},[e("table",Ig,[g[7]||(g[7]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚æ®µ"),e("th",null,"ã„æ®µ"),e("th",null,"ã†æ®µ"),e("th",null,"ãˆæ®µ"),e("th",null,"ãŠæ®µ")])],-1)),e("tbody",null,[(L(),K(Ke,null,je(w,d=>e("tr",{key:d.label},[e("td",Tg,le(d.label),1),(L(!0),K(Ke,null,je(d.chars,(y,v)=>(L(),K("td",{key:v},[y?(L(),K("button",{key:0,class:Me(["kana-key",{pressed:i.value===y.h}]),onClick:C=>f(y)},[e("span",Rg,le(y.h),1),e("span",Mg,le(y.k),1)],10,Dg)):ge("",!0)]))),128))])),64))])])],2),e("div",{class:Me(["kana-tab-content",{active:l.value==="dakuten"}])},[e("table",Bg,[g[8]||(g[8]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚æ®µ"),e("th",null,"ã„æ®µ"),e("th",null,"ã†æ®µ"),e("th",null,"ãˆæ®µ"),e("th",null,"ãŠæ®µ")])],-1)),e("tbody",null,[(L(),K(Ke,null,je(O,d=>e("tr",{key:d.label},[e("td",Eg,le(d.label),1),(L(!0),K(Ke,null,je(d.chars,(y,v)=>(L(),K("td",{key:v},[y?(L(),K("button",{key:0,class:Me(["kana-key",{pressed:i.value===y.h}]),onClick:C=>f(y)},[e("span",Ag,le(y.h),1),e("span",Fg,le(y.k),1)],10,Pg)):ge("",!0)]))),128))])),64))])])],2),e("div",{class:Me(["kana-tab-content",{active:l.value==="combo"}])},[e("table",Lg,[g[9]||(g[9]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚ƒ"),e("th",null,"ã‚…"),e("th",null,"ã‚‡")])],-1)),e("tbody",null,[(L(),K(Ke,null,je(Y,d=>e("tr",{key:d.label},[e("td",Ug,le(d.label),1),(L(!0),K(Ke,null,je(d.chars,(y,v)=>(L(),K("td",{key:v},[y?(L(),K("button",{key:0,class:Me(["kana-key",{pressed:i.value===y.h}]),onClick:C=>f(y)},[e("span",zg,le(y.h),1),e("span",Ng,le(y.k),1)],10,Og)):ge("",!0)]))),128))])),64))])])],2),e("div",{class:Me(["kana-tab-content",{active:l.value==="special"}])},[e("div",Vg,[(L(),K(Ke,null,je(J,d=>e("button",{key:d.char,class:Me(["kana-key special-key",{pressed:i.value===d.char}]),onClick:y=>I(d.char)},[Ce(le(d.char)+" ",1),d.label?(L(),K("span",Kg,le(d.label),1)):ge("",!0)],10,Wg)),64))])],2),e("div",{class:"kana-keyboard-footer"},[e("button",{class:"kana-backspace",onClick:T},"âŒ« é€€æ ¼")])])):ge("",!0)}}),Hg=qe(qg,[["__scopeId","data-v-ebfc2125"]]),Jg={class:"edit-panel-content"},jg={class:"text-column original-text-column text-block"},Yg={class:"text-column translated-text-column text-block"},Gg={class:"style-settings-section text-block"},Xg={class:"office-toolbar"},Zg={class:"toolbar-row toolbar-row-top"},Qg={class:"combo-control font-control"},ep={class:"combo-control size-control"},tp={class:"size-input-wrap"},op=["min","max","step"],np={class:"toolbar-row toolbar-row-actions"},sp={class:"toolbar-icon-group","aria-label":"æ’ç‰ˆæ–¹å‘"},ap=["data-active"],lp=["data-active"],ip={class:"toolbar-color-group"},rp={class:"toolbar-color-picker",title:"æ–‡å­—é¢œè‰²"},up={class:"toolbar-inpaint-group",title:"èƒŒæ™¯ä¿®å¤æ–¹å¼"},cp={class:"toolbar-stroke-cluster"},dp=["data-active"],gp={class:"toolbar-row toolbar-row-bottom"},pp={class:"toolbar-rotation-group",title:"æ—‹è½¬è§’åº¦"},vp={class:"toolbar-position-group",title:"ä½ç½®è°ƒæ•´"},mp={class:"toolbar-position-value"},bp={class:"fontsize-presets-panel"},fp={class:"font-size-presets"},hp=["onClick"],Bt=2,yp=He({__name:"BubbleEditor",props:{bubble:{},bubbleIndex:{}},emits:["update","reRender","ocrRecognize","reTranslate","applyBubble","resetCurrent"],setup(n,{emit:t}){const p=n,o=t,l=dt(),c={originalText:"",translatedText:"",fontSize:24,fontFamily:"fonts/STSONG.TTF",textDirection:"auto",textColor:"#231816",fillColor:"#FFFFFF",strokeEnabled:!0,strokeColor:"#FFFFFF",strokeWidth:3,rotationAngle:0,inpaintMethod:"solid",position:{x:0,y:0}},s=S(""),i=S(""),k=S(24),P=S("fonts/STSONG.TTF"),w=S("auto"),O=S("#231816"),Y=S("#FFFFFF"),J=S(!0),R=S("#FFFFFF"),f=S(3),I=S(0),T=S("solid"),M=S(0),g=S(0),d=S(null),y=S(null),v=S(null),C=S(null),E=S(null),q=S(!1),B=S("original"),H=S([{name:"åæ–‡å®‹ä½“",path:"fonts/STSONG.TTF"},{name:"åæ–‡æ¥·ä½“",path:"fonts/STKAITI.TTF"},{name:"åæ–‡ç»†é»‘",path:"fonts/STXIHEI.TTF"},{name:"é»‘ä½“",path:"fonts/SIMHEI.TTF"},{name:"å®‹ä½“",path:"fonts/SIMSUN.TTC"}]),V=S([]),x=Q(()=>p.bubble?p.bubble.coords[0]+M.value:0),b=Q(()=>p.bubble?p.bubble.coords[1]+g.value:0),$=Q(()=>{const ke=[{label:"ç³»ç»Ÿå­—ä½“",options:H.value.map(ee=>({label:ee.name,value:ee.path}))}];return V.value.length>0&&ke.push({label:"è‡ªå®šä¹‰å­—ä½“",options:V.value.map(ee=>({label:ee.name,value:ee.path}))}),ke}),a=[{label:"çº¯è‰²å¡«å……",value:"solid"},{label:"LAMAä¿®å¤(æ¼«ç”»)",value:"lama_mpe"},{label:"LAMAä¿®å¤(é€šç”¨)",value:"litelama"}];function u(ke){const ee=ke||c;s.value=ee.originalText,i.value=ee.translatedText,k.value=ee.fontSize,P.value=ee.fontFamily,w.value=ee.textDirection,O.value=ee.textColor,Y.value=ee.fillColor,J.value=ee.strokeEnabled,R.value=ee.strokeColor,f.value=ee.strokeWidth,I.value=ee.rotationAngle,T.value=ee.inpaintMethod,M.value=ee.position?.x||0,g.value=ee.position?.y||0}ye(()=>p.bubble,ke=>{u(ke)},{deep:!0,immediate:!0});function h(){o("update",{originalText:s.value})}function W(){o("update",{translatedText:i.value})}function A(){navigator.clipboard.writeText(s.value)}function U(){navigator.clipboard.writeText(i.value)}function G(){o("update",{fontSize:k.value})}function D(ke){k.value=ke,o("update",{fontSize:ke})}function m(){k.value=Math.min(Oo,k.value+Xt),o("update",{fontSize:k.value})}function N(){k.value=Math.max(zo,k.value-Xt),o("update",{fontSize:k.value})}function r(){o("update",{fontFamily:P.value})}function _(ke){w.value=ke,o("update",{textDirection:ke})}function re(){v.value?.click()}function F(){o("update",{textColor:O.value})}function te(){C.value?.click()}function de(){o("update",{fillColor:Y.value})}function _e(){E.value?.click()}function $e(){o("update",{strokeColor:R.value})}function Pe(){J.value=!J.value,o("update",{strokeEnabled:J.value})}function Be(){o("update",{strokeWidth:f.value})}function ae(){o("update",{inpaintMethod:T.value})}function Z(){o("update",{rotationAngle:I.value})}function z(){I.value=Math.max(-180,I.value-5),o("update",{rotationAngle:I.value})}function ne(){I.value=Math.min(180,I.value+5),o("update",{rotationAngle:I.value})}function oe(){I.value=0,o("update",{rotationAngle:0})}function ue(){M.value-=Bt,o("update",{position:{x:M.value,y:g.value}})}function me(){M.value+=Bt,o("update",{position:{x:M.value,y:g.value}})}function xe(){g.value-=Bt,o("update",{position:{x:M.value,y:g.value}})}function be(){g.value+=Bt,o("update",{position:{x:M.value,y:g.value}})}function pe(){M.value=0,g.value=0,o("update",{position:{x:0,y:0}})}function Ie(){o("applyBubble",p.bubbleIndex)}function Se(){l.updateAllBubbles({fontSize:k.value,fontFamily:P.value,textDirection:w.value,textColor:O.value,fillColor:Y.value,strokeEnabled:J.value,strokeColor:R.value,strokeWidth:f.value,inpaintMethod:T.value}),console.log("æ ·å¼å·²åº”ç”¨åˆ°æ‰€æœ‰æ°”æ³¡"),o("reRender")}function ze(){o("resetCurrent",p.bubbleIndex)}function Le(){o("ocrRecognize",p.bubbleIndex)}function De(){o("reTranslate",p.bubbleIndex)}function Te(){q.value=!q.value}function Ye(ke,ee){if(ee==="original"){const ve=d.value;if(ve){const Ve=ve.selectionStart||s.value.length,Ge=ve.selectionEnd||s.value.length,vt=s.value;s.value=vt.slice(0,Ve)+ke+vt.slice(Ge),ct(()=>{ve.selectionStart=ve.selectionEnd=Ve+ke.length,ve.focus()}),o("update",{originalText:s.value})}}else{const ve=y.value;if(ve){const Ve=ve.selectionStart||i.value.length,Ge=ve.selectionEnd||i.value.length,vt=i.value;i.value=vt.slice(0,Ve)+ke+vt.slice(Ge),ct(()=>{ve.selectionStart=ve.selectionEnd=Ve+ke.length,ve.focus()}),o("update",{translatedText:i.value})}}}function lt(ke){if(ke==="original"){const ee=d.value;if(ee&&s.value.length>0){const ve=ee.selectionStart||s.value.length,Ve=ee.selectionEnd||s.value.length,Ge=s.value;ve===Ve&&ve>0?(s.value=Ge.slice(0,ve-1)+Ge.slice(Ve),ct(()=>{ee.selectionStart=ee.selectionEnd=ve-1,ee.focus()})):ve!==Ve&&(s.value=Ge.slice(0,ve)+Ge.slice(Ve),ct(()=>{ee.selectionStart=ee.selectionEnd=ve,ee.focus()})),o("update",{originalText:s.value})}}else{const ee=y.value;if(ee&&i.value.length>0){const ve=ee.selectionStart||i.value.length,Ve=ee.selectionEnd||i.value.length,Ge=i.value;ve===Ve&&ve>0?(i.value=Ge.slice(0,ve-1)+Ge.slice(Ve),ct(()=>{ee.selectionStart=ee.selectionEnd=ve-1,ee.focus()})):ve!==Ve&&(i.value=Ge.slice(0,ve)+Ge.slice(Ve),ct(()=>{ee.selectionStart=ee.selectionEnd=ve,ee.focus()})),o("update",{translatedText:i.value})}}}async function it(){try{const ke=await rs();if(ke.fonts){const ee=[],ve=[];for(const Ve of ke.fonts){const Ge={name:typeof Ve=="string"?Ve:Ve.display_name||Ve.file_name||"",path:typeof Ve=="string"?Ve:Ve.path};Ge.path.startsWith("fonts/")?ee.push(Ge):ve.push(Ge)}ee.length>0&&(H.value=ee),V.value=ve}}catch(ke){console.error("åŠ è½½å­—ä½“åˆ—è¡¨å¤±è´¥:",ke)}}return ut(()=>{it()}),(ke,ee)=>(L(),K("div",Jg,[e("div",jg,[e("div",{class:"text-column-header"},[ee[13]||(ee[13]=e("span",{class:"column-title"},"ğŸ‡¯ğŸ‡µ æ—¥è¯­åŸæ–‡ (OCRç»“æœ)",-1)),e("button",{class:"re-ocr-btn",onClick:Le,title:"é‡æ–°OCRæ­¤æ°”æ³¡"},"ğŸ”„")]),se(e("textarea",{ref_key:"originalTextInput",ref:d,"onUpdate:modelValue":ee[0]||(ee[0]=ve=>s.value=ve),class:"text-editor original-editor",placeholder:"OCRè¯†åˆ«çš„æ—¥è¯­åŸæ–‡...",spellcheck:"false",onInput:h},null,544),[[we,s.value]]),e("div",{class:"text-actions"},[e("button",{class:"copy-btn",onClick:A},"ğŸ“‹ å¤åˆ¶"),e("button",{class:"keyboard-toggle-btn",onClick:Te,title:"æ˜¾ç¤º/éšè—50éŸ³é”®ç›˜"}," âŒ¨ï¸ 50éŸ³ ")]),he(Hg,{visible:q.value,"default-target":B.value,onClose:ee[1]||(ee[1]=ve=>q.value=!1),onInsert:Ye,onDelete:lt},null,8,["visible","default-target"])]),e("div",Yg,[e("div",{class:"text-column-header"},[ee[14]||(ee[14]=e("span",{class:"column-title"},"ğŸ‡¨ğŸ‡³ ä¸­æ–‡è¯‘æ–‡",-1)),e("button",{class:"re-translate-btn",onClick:De,title:"é‡æ–°ç¿»è¯‘æ­¤æ°”æ³¡"}," ğŸ”„ ")]),se(e("textarea",{ref_key:"translatedTextInput",ref:y,"onUpdate:modelValue":ee[2]||(ee[2]=ve=>i.value=ve),class:"text-editor translated-editor",placeholder:"ç¿»è¯‘åçš„ä¸­æ–‡...",spellcheck:"false",onInput:W},null,544),[[we,i.value]]),e("div",{class:"text-actions"},[e("button",{class:"copy-btn",onClick:U},"ğŸ“‹ å¤åˆ¶"),e("button",{class:"apply-text-btn",onClick:Ie},"âœ“ åº”ç”¨æ–‡æœ¬")])]),e("div",Gg,[e("div",Xg,[e("div",Zg,[e("div",Qg,[ee[15]||(ee[15]=e("label",null,"å­—ä½“",-1)),he(Oe,{modelValue:P.value,"onUpdate:modelValue":ee[3]||(ee[3]=ve=>P.value=ve),groups:$.value,title:"å­—ä½“",onChange:r},null,8,["modelValue","groups"])]),e("div",ep,[ee[16]||(ee[16]=e("label",null,"å­—å·",-1)),e("div",tp,[se(e("input",{type:"number","onUpdate:modelValue":ee[4]||(ee[4]=ve=>k.value=ve),class:"toolbar-fontsize-input",min:X(zo),max:X(Oo),step:X(Xt),title:"å­—å·",onChange:G},null,40,op),[[we,k.value,void 0,{number:!0}]]),e("div",{class:"toolbar-fontsize-btns"},[e("button",{class:"toolbar-fontsize-btn",onClick:m,title:"å¢å¤§å­—å·"}," A+ "),e("button",{class:"toolbar-fontsize-btn",onClick:N,title:"å‡å°å­—å·"}," A- ")])])])]),e("div",np,[e("div",sp,[e("button",{class:"toolbar-btn","data-active":w.value==="vertical",onClick:ee[5]||(ee[5]=ve=>_("vertical")),title:"ç«–å‘æ’ç‰ˆ"},[...ee[17]||(ee[17]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M8 2v12M8 2L5 5M8 2l3 3",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])],8,ap),e("button",{class:"toolbar-btn","data-active":w.value==="horizontal",onClick:ee[6]||(ee[6]=ve=>_("horizontal")),title:"æ¨ªå‘æ’ç‰ˆ"},[...ee[18]||(ee[18]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M2 8h12M14 8l-3-3M14 8l-3 3",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])],8,lp)]),ee[24]||(ee[24]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",ip,[e("div",rp,[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:re},[ee[19]||(ee[19]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("text",{x:"3",y:"11","font-size":"10","font-weight":"bold",fill:"currentColor"},"A")],-1)),e("span",{class:"color-indicator",style:st({background:O.value})},null,4)]),se(e("input",{ref_key:"textColorInput",ref:v,type:"color","onUpdate:modelValue":ee[7]||(ee[7]=ve=>O.value=ve),class:"hidden-color-input",onInput:F,onChange:F},null,544),[[we,O.value]])])]),ee[25]||(ee[25]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",up,[he(Oe,{modelValue:T.value,"onUpdate:modelValue":ee[8]||(ee[8]=ve=>T.value=ve),options:a,onChange:ae},null,8,["modelValue"]),e("div",{class:Me(["toolbar-color-picker toolbar-solid-color-options",{hidden:T.value!=="solid"}])},[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:te},[ee[20]||(ee[20]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("rect",{x:"2",y:"2",width:"12",height:"12",rx:"2",fill:"none",stroke:"currentColor","stroke-width":"1.2"}),e("rect",{x:"4",y:"4",width:"8",height:"8",rx:"1",fill:"currentColor",opacity:"0.3"})],-1)),e("span",{class:"color-indicator",style:st({background:Y.value})},null,4)]),se(e("input",{ref_key:"fillColorInput",ref:C,type:"color","onUpdate:modelValue":ee[9]||(ee[9]=ve=>Y.value=ve),class:"hidden-color-input",onChange:de},null,544),[[we,Y.value]])],2)]),ee[26]||(ee[26]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",cp,[e("button",{class:"toolbar-btn","data-active":J.value,onClick:Pe,title:"æ–‡å­—æè¾¹"},[...ee[21]||(ee[21]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("text",{x:"3",y:"12","font-size":"11","font-weight":"bold",stroke:"currentColor","stroke-width":"2",fill:"none"}," A "),e("text",{x:"3",y:"12","font-size":"11","font-weight":"bold",fill:"currentColor"},"A")],-1)])],8,dp),e("div",{class:Me(["toolbar-color-picker toolbar-stroke-options",{hidden:!J.value}]),title:"æè¾¹é¢œè‰²"},[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:_e},[ee[22]||(ee[22]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"2"})],-1)),e("span",{class:"color-indicator",style:st({background:R.value})},null,4)]),se(e("input",{ref_key:"strokeColorInput",ref:E,type:"color","onUpdate:modelValue":ee[10]||(ee[10]=ve=>R.value=ve),class:"hidden-color-input",onChange:$e},null,544),[[we,R.value]])],2),e("div",{class:Me(["toolbar-stroke-width toolbar-stroke-options",{hidden:!J.value}]),title:"æè¾¹å®½åº¦"},[se(e("input",{type:"number","onUpdate:modelValue":ee[11]||(ee[11]=ve=>f.value=ve),class:"toolbar-mini-input",min:"0",max:"10",onChange:Be},null,544),[[we,f.value,void 0,{number:!0}]]),ee[23]||(ee[23]=e("span",{class:"toolbar-unit"},"px",-1))],2)])]),e("div",gp,[e("div",pp,[e("button",{class:"toolbar-btn",onClick:z,title:"é€†æ—¶é’ˆæ—‹è½¬"},[...ee[27]||(ee[27]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M2 8a6 6 0 1 1 1.5 4",stroke:"currentColor","stroke-width":"1.5",fill:"none"}),e("path",{d:"M2 5v3.5h3.5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),se(e("input",{type:"number","onUpdate:modelValue":ee[12]||(ee[12]=ve=>I.value=ve),class:"toolbar-mini-input toolbar-rotation-input",min:"-180",max:"180",step:"5",onChange:Z},null,544),[[we,I.value,void 0,{number:!0}]]),ee[29]||(ee[29]=e("span",{class:"toolbar-unit"},"Â°",-1)),e("button",{class:"toolbar-btn",onClick:ne,title:"é¡ºæ—¶é’ˆæ—‹è½¬"},[...ee[28]||(ee[28]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M14 8a6 6 0 1 0-1.5 4",stroke:"currentColor","stroke-width":"1.5",fill:"none"}),e("path",{d:"M14 5v3.5h-3.5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn toolbar-small-btn",onClick:oe,title:"é‡ç½®æ—‹è½¬"}," 0 ")]),ee[35]||(ee[35]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",vp,[e("button",{class:"toolbar-btn",onClick:ue,title:"å·¦ç§»"},[...ee[30]||(ee[30]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M10 3L5 8l5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:me,title:"å³ç§»"},[...ee[31]||(ee[31]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M6 3l5 5-5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:xe,title:"ä¸Šç§»"},[...ee[32]||(ee[32]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M3 10l5-5 5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:be,title:"ä¸‹ç§»"},[...ee[33]||(ee[33]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M3 6l5 5 5-5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("span",mp,[e("span",null,le(x.value),1),ee[34]||(ee[34]=Ce(",",-1)),e("span",null,le(b.value),1)]),e("button",{class:"toolbar-btn toolbar-small-btn",onClick:pe,title:"é‡ç½®ä½ç½®"}," âŒ‚ ")])])]),e("details",bp,[ee[36]||(ee[36]=e("summary",null,"å­—å·é¢„è®¾",-1)),e("div",fp,[(L(!0),K(Ke,null,je(X(Vn),ve=>(L(),K("button",{key:ve,class:Me(["preset-btn",{active:k.value===ve}]),onClick:Ve=>D(ve)},le(ve),11,hp))),128))])]),e("div",{class:"edit-action-buttons"},[e("button",{class:"btn-apply",onClick:Ie},"åº”ç”¨"),e("button",{class:"btn-apply-all",onClick:Se},"åº”ç”¨å…¨éƒ¨"),e("button",{class:"btn-reset",onClick:ze},"é‡ç½®")])])]))}}),xp=qe(yp,[["__scopeId","data-v-ea49fb5e"]]),kp={class:"edit-toolbar-wrapper"},_p={class:"edit-toolbar toolbar-row-1"},Sp={class:"image-navigator"},Cp=["disabled"],wp=["disabled"],$p={class:"bubble-navigator"},Ip=["disabled"],Tp={class:"bubble-indicator"},Dp={id:"currentBubbleNum"},Rp={id:"totalBubbleNum"},Mp=["disabled"],Bp={class:"view-controls"},Ep={key:0,viewBox:"0 0 20 20",width:"16",height:"16"},Pp={key:1,viewBox:"0 0 20 20",width:"16",height:"16"},Ap={id:"zoomLevel"},Fp={class:"edit-toolbar toolbar-row-2"},Lp={class:"annotation-tools"},Up=["disabled"],Op=["disabled"],zp={key:0,class:"brush-size-indicator"},Np={key:1,class:"brush-mode-hint"},Vp={class:"edit-progress-info"},Wp={class:"edit-progress-text"},Kp={class:"edit-progress-count"},qp={class:"edit-progress-bar"},Hp={class:"quick-actions"},Jp=He({__name:"EditToolbar",props:{currentImageIndex:{},imageCount:{},canGoPrevious:{type:Boolean},canGoNext:{type:Boolean},showThumbnails:{type:Boolean},hasBubbles:{type:Boolean},selectedBubbleIndex:{},bubbleCount:{},layoutMode:{},syncEnabled:{type:Boolean},scale:{},isDrawingMode:{type:Boolean},hasSelection:{type:Boolean},brushMode:{},brushSize:{},mouseX:{},mouseY:{},isProcessing:{type:Boolean},progressText:{},progressCurrent:{},progressTotal:{}},emits:["go-previous-image","go-next-image","toggle-thumbnails","select-previous-bubble","select-next-bubble","toggle-layout","toggle-view-mode","toggle-sync","fit-to-screen","zoom-in","zoom-out","reset-zoom","exit-edit-mode","auto-detect-bubbles","detect-all-images","translate-with-bubbles","toggle-drawing-mode","delete-selected-bubbles","repair-selected-bubble","activate-repair-brush","activate-restore-brush","apply-and-next"],setup(n){const t=n,p=Q(()=>t.progressTotal===0?0:Math.round(t.progressCurrent/t.progressTotal*100)),o=Q(()=>t.progressTotal>0&&t.progressCurrent>=t.progressTotal),l=Q(()=>{const c=t.brushMode==="repair"?{fill:"rgba(76, 175, 80, 0.4)",border:"#4CAF50"}:{fill:"rgba(33, 150, 243, 0.4)",border:"#2196F3"};return{position:"fixed",left:`${t.mouseX}px`,top:`${t.mouseY}px`,width:`${t.brushSize}px`,height:`${t.brushSize}px`,borderRadius:"50%",border:`2px solid ${c.border}`,backgroundColor:c.fill,pointerEvents:"none",zIndex:99999,transform:"translate(-50%, -50%)",display:t.brushMode?"block":"none"}});return(c,s)=>(L(),K("div",kp,[e("div",_p,[e("div",Sp,[e("button",{class:"nav-btn",disabled:!n.canGoPrevious,onClick:s[0]||(s[0]=i=>c.$emit("go-previous-image")),title:"ä¸Šä¸€å¼ å›¾ç‰‡ (PageUp)"}," â—€â—€ ",8,Cp),e("span",{class:"image-indicator",onClick:s[1]||(s[1]=i=>c.$emit("toggle-thumbnails")),title:"ç‚¹å‡»å±•å¼€ç¼©ç•¥å›¾"},[s[23]||(s[23]=Ce(" å›¾ ",-1)),e("span",null,le(n.currentImageIndex+1),1),s[24]||(s[24]=Ce(" / ",-1)),e("span",null,le(n.imageCount),1)]),e("button",{class:"nav-btn",disabled:!n.canGoNext,onClick:s[2]||(s[2]=i=>c.$emit("go-next-image")),title:"ä¸‹ä¸€å¼ å›¾ç‰‡ (PageDown)"}," â–¶â–¶ ",8,wp),e("button",{class:Me(["thumb-toggle-btn",{active:n.showThumbnails}]),onClick:s[3]||(s[3]=i=>c.$emit("toggle-thumbnails")),title:"æ˜¾ç¤º/éšè—ç¼©ç•¥å›¾"}," â˜· ",2)]),s[30]||(s[30]=e("div",{class:"toolbar-divider"},null,-1)),e("div",$p,[e("button",{id:"prevBubbleBtn",class:"nav-btn",disabled:!n.hasBubbles||n.selectedBubbleIndex<=0,onClick:s[4]||(s[4]=i=>c.$emit("select-previous-bubble")),title:"ä¸Šä¸€ä¸ªæ°”æ³¡ (â†)"}," â—€ ",8,Ip),e("span",Tp,[s[25]||(s[25]=Ce(" æ°”æ³¡ ",-1)),e("span",Dp,le(n.selectedBubbleIndex>=0?n.selectedBubbleIndex+1:0),1),s[26]||(s[26]=Ce(" / ",-1)),e("span",Rp,le(n.bubbleCount),1)]),e("button",{id:"nextBubbleBtn",class:"nav-btn",disabled:!n.hasBubbles||n.selectedBubbleIndex>=n.bubbleCount-1,onClick:s[5]||(s[5]=i=>c.$emit("select-next-bubble")),title:"ä¸‹ä¸€ä¸ªæ°”æ³¡ (â†’)"}," â–¶ ",8,Mp)]),s[31]||(s[31]=e("div",{class:"toolbar-divider"},null,-1)),e("div",Bp,[e("button",{class:"layout-toggle-btn",onClick:s[6]||(s[6]=i=>c.$emit("toggle-layout")),title:"åˆ‡æ¢å¸ƒå±€ï¼šå·¦å³/ä¸Šä¸‹"},[n.layoutMode==="horizontal"?(L(),K("svg",Ep,[...s[27]||(s[27]=[e("rect",{x:"1",y:"2",width:"8",height:"16",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1),e("rect",{x:"11",y:"2",width:"8",height:"16",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1)])])):(L(),K("svg",Pp,[...s[28]||(s[28]=[e("rect",{x:"2",y:"1",width:"16",height:"8",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1),e("rect",{x:"2",y:"11",width:"16",height:"8",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1)])]))]),e("button",{class:"view-mode-btn",onClick:s[7]||(s[7]=i=>c.$emit("toggle-view-mode")),title:"åˆ‡æ¢è§†å›¾æ¨¡å¼"},[...s[29]||(s[29]=[e("span",{class:"dual-icon"},"â§‰",-1)])]),e("button",{class:Me({active:n.syncEnabled}),onClick:s[8]||(s[8]=i=>c.$emit("toggle-sync")),title:"åŒæ­¥ç¼©æ”¾/æ‹–åŠ¨",style:{"font-size":"12px"}}," ğŸ”— ",2),e("button",{onClick:s[9]||(s[9]=i=>c.$emit("fit-to-screen")),title:"é€‚åº”å±å¹• (åŒå‡»)"},"â›¶"),e("button",{onClick:s[10]||(s[10]=i=>c.$emit("zoom-in")),title:"æ”¾å¤§ (+)"},"+"),e("span",Ap,le(Math.round(n.scale*100))+"%",1),e("button",{onClick:s[11]||(s[11]=i=>c.$emit("zoom-out")),title:"ç¼©å° (-)"},"âˆ’"),e("button",{onClick:s[12]||(s[12]=i=>c.$emit("reset-zoom")),title:"åŸå§‹å¤§å°"},"1:1")]),s[32]||(s[32]=e("div",{class:"toolbar-spacer"},null,-1)),e("button",{class:"secondary-btn",onClick:s[13]||(s[13]=i=>c.$emit("exit-edit-mode"))},"é€€å‡ºç¼–è¾‘")]),e("div",Fp,[e("div",Lp,[e("button",{class:"annotation-btn detect-btn",onClick:s[14]||(s[14]=i=>c.$emit("auto-detect-bubbles")),title:"è‡ªåŠ¨æ£€æµ‹å½“å‰å›¾ç‰‡çš„æ–‡æœ¬æ¡†"},[...s[33]||(s[33]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"6",cy:"6",r:"4",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M9 9l4 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1),e("span",null,"æ£€æµ‹",-1)])]),e("button",{class:"annotation-btn detect-btn",onClick:s[15]||(s[15]=i=>c.$emit("detect-all-images")),title:"æ‰¹é‡æ£€æµ‹æ‰€æœ‰å›¾ç‰‡"},[...s[34]||(s[34]=[eo('<svg viewBox="0 0 16 16" width="14" height="14" data-v-b7164359><circle cx="5" cy="5" r="2.5" fill="none" stroke="currentColor" stroke-width="1" data-v-b7164359></circle><path d="M7 7l2 2" stroke="currentColor" stroke-width="1" stroke-linecap="round" data-v-b7164359></path><circle cx="10" cy="10" r="2.5" fill="none" stroke="currentColor" stroke-width="1" data-v-b7164359></circle><path d="M12 12l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-b7164359></path></svg><span data-v-b7164359>æ‰¹é‡æ£€æµ‹</span>',2)])]),e("button",{class:"annotation-btn primary-action-btn",onClick:s[16]||(s[16]=i=>c.$emit("translate-with-bubbles")),title:"ä½¿ç”¨å½“å‰æ–‡æœ¬æ¡†ç¿»è¯‘æ­¤å›¾ç‰‡"},[...s[35]||(s[35]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M2 3h5M4.5 3v7M2 6h5",stroke:"currentColor","stroke-width":"1.2",fill:"none"}),e("path",{d:"M9 13l2-7 2 7M9.5 11h3",stroke:"currentColor","stroke-width":"1.2",fill:"none"})],-1),e("span",null,"ç¿»è¯‘",-1)])]),s[41]||(s[41]=e("div",{class:"toolbar-divider"},null,-1)),e("button",{class:Me(["annotation-btn",{active:n.isDrawingMode}]),onClick:s[17]||(s[17]=i=>c.$emit("toggle-drawing-mode")),title:"æ·»åŠ æ°”æ³¡æ¡†ï¼ˆæˆ–ä¸­é”®æ‹–æ‹½ç»˜åˆ¶ï¼‰"},[...s[36]||(s[36]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("rect",{x:"3",y:"3",width:"10",height:"10",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M8 5v6M5 8h6",stroke:"currentColor","stroke-width":"1.5"})],-1),e("span",null,"æ·»åŠ ",-1)])],2),e("button",{class:"annotation-btn",disabled:!n.hasSelection,onClick:s[18]||(s[18]=i=>c.$emit("delete-selected-bubbles")),title:"åˆ é™¤é€‰ä¸­æ°”æ³¡æ¡† (Delete)"},[...s[37]||(s[37]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("rect",{x:"3",y:"3",width:"10",height:"10",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M5 8h6",stroke:"currentColor","stroke-width":"1.5"})],-1),e("span",null,"åˆ é™¤",-1)])],8,Up),e("button",{class:"annotation-btn",disabled:!n.hasSelection,onClick:s[19]||(s[19]=i=>c.$emit("repair-selected-bubble")),title:"ä¿®å¤é€‰ä¸­æ°”æ³¡èƒŒæ™¯ (R)"},[...s[38]||(s[38]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M2 14l3-3m0 0l6-6 3 3-6 6m-3 0l-1 1 1-1z",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M11 5l-1-1 2-2 2 2-2 2-1-1z",fill:"currentColor"})],-1),e("span",null,"ä¿®å¤",-1)])],8,Op),s[42]||(s[42]=e("div",{class:"toolbar-divider"},null,-1)),e("button",{class:Me(["annotation-btn brush-btn",{active:n.brushMode==="repair"}]),onClick:s[20]||(s[20]=i=>c.$emit("activate-repair-brush")),title:"ä¿®å¤ç¬”åˆ· (æŒ‰ä½R+å·¦é”®æ‹–æ‹½)"},[...s[39]||(s[39]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("circle",{cx:"8",cy:"8",r:"2",fill:"currentColor"})],-1),e("span",null,"ä¿®å¤ç¬”åˆ·",-1)])],2),e("button",{class:Me(["annotation-btn brush-btn",{active:n.brushMode==="restore"}]),onClick:s[21]||(s[21]=i=>c.$emit("activate-restore-brush")),title:"è¿˜åŸç¬”åˆ· (æŒ‰ä½U+å·¦é”®æ‹–æ‹½)"},[...s[40]||(s[40]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M5 8h6M8 5v6",stroke:"currentColor","stroke-width":"1",transform:"rotate(45 8 8)"})],-1),e("span",null,"è¿˜åŸç¬”åˆ·",-1)])],2),n.brushMode?(L(),K("span",zp," ç¬”åˆ·: "+le(n.brushSize)+"px ",1)):ge("",!0),s[43]||(s[43]=eo('<div class="help-tooltip-container" data-v-b7164359><button class="help-tooltip-btn" title="å¿«æ·é”®æ“ä½œå¸®åŠ©" data-v-b7164359><svg viewBox="0 0 16 16" width="14" height="14" data-v-b7164359><circle cx="8" cy="8" r="6.5" fill="none" stroke="currentColor" stroke-width="1.2" data-v-b7164359></circle><text x="8" y="11" text-anchor="middle" font-size="9" font-weight="bold" fill="currentColor" data-v-b7164359>?</text></svg><span class="help-btn-text" data-v-b7164359>å¿«æ·é”®</span></button><div class="help-tooltip-popup" data-v-b7164359><div class="help-section" data-v-b7164359><div class="help-title" data-v-b7164359>ğŸ–±ï¸ é¼ æ ‡æ“ä½œ</div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®ç‚¹å‡»æ°”æ³¡</span><span class="help-desc" data-v-b7164359>é€‰æ‹©æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Shift+å·¦é”®ç‚¹å‡»</span><span class="help-desc" data-v-b7164359>å¤šé€‰æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®æ‹–æ‹½å››è§’/è¾¹</span><span class="help-desc" data-v-b7164359>è°ƒæ•´å¤§å°</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®æ‹–æ‹½æ¡†å†…éƒ¨</span><span class="help-desc" data-v-b7164359>ç§»åŠ¨æ°”æ³¡æ¡†</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>ä¸­é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>ç»˜åˆ¶æ–°æ°”æ³¡æ¡†</span></div></div><div class="help-section" data-v-b7164359><div class="help-title" data-v-b7164359>âŒ¨ï¸ å¿«æ·é”®</div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>A / D</span><span class="help-desc" data-v-b7164359>åˆ‡æ¢ä¸Š/ä¸‹ä¸€å¼ å›¾ç‰‡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Ctrl+Enter</span><span class="help-desc" data-v-b7164359>åº”ç”¨å¹¶è·³è½¬ä¸‹ä¸€å¼ </span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Delete / Backspace</span><span class="help-desc" data-v-b7164359>åˆ é™¤é€‰ä¸­æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>æŒ‰ä½R+å·¦é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>ä¿®å¤ç¬”åˆ·</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>æŒ‰ä½U+å·¦é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>è¿˜åŸç¬”åˆ·</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>ç¬”åˆ·æ¨¡å¼ä¸‹æ»šè½®</span><span class="help-desc" data-v-b7164359>è°ƒæ•´ç¬”åˆ·å¤§å°</span></div></div></div></div>',1))]),n.brushMode?(L(),K("div",{key:0,class:"brush-cursor",style:st(l.value)},null,4)):ge("",!0),n.brushMode?(L(),K("div",Np,le(n.brushMode==="repair"?"ä¿®å¤ç¬”åˆ· (R)":"è¿˜åŸç¬”åˆ· (U)")+" - æ»šè½®è°ƒæ•´å¤§å° ",1)):ge("",!0),n.isProcessing?(L(),K("div",{key:2,class:Me(["edit-progress-container",{completed:o.value}])},[e("div",Vp,[e("span",Wp,le(n.progressText),1),e("span",Kp,le(n.progressCurrent)+"/"+le(n.progressTotal),1)]),e("div",qp,[e("div",{class:Me(["edit-progress-fill",{animating:!o.value}]),style:st({width:p.value+"%"})},null,6)])],2)):ge("",!0),s[44]||(s[44]=e("div",{class:"toolbar-spacer"},null,-1)),e("div",Hp,[e("button",{class:"primary-btn",onClick:s[22]||(s[22]=i=>c.$emit("apply-and-next")),title:"åº”ç”¨æ›´æ”¹å¹¶è·³è½¬ä¸‹ä¸€å¼  (Ctrl+Enter)"}," åº”ç”¨å¹¶ä¸‹ä¸€å¼  ")])])]))}}),jp=qe(Jp,[["__scopeId","data-v-b7164359"]]),Yp={key:0,class:"edit-thumbnails-panel"},Gp={class:"thumbnails-scroll"},Xp=["onClick"],Zp=["src","alt"],Qp={class:"thumb-index"},ev=He({__name:"EditThumbnailPanel",props:{visible:{type:Boolean},images:{},currentImageIndex:{}},emits:["switch-to-image"],setup(n){return(t,p)=>n.visible?(L(),K("div",Yp,[e("div",Gp,[(L(!0),K(Ke,null,je(n.images,(o,l)=>(L(),K("div",{key:o.id,class:Me(["edit-thumbnail-item",{active:l===n.currentImageIndex}]),onClick:c=>t.$emit("switch-to-image",l)},[e("img",{src:o.translatedDataURL||o.originalDataURL,alt:`å›¾ç‰‡ ${l+1}`},null,8,Zp),e("span",Qp,le(l+1),1)],10,Xp))),128))])])):ge("",!0)}}),tv=qe(ev,[["__scopeId","data-v-9d2a43d9"]]),ov={class:"edit-main-layout"},nv={class:"image-comparison-container"},sv={class:"panel-header"},av=["src"],lv={class:"panel-header"},iv=["src"],rv=He({__name:"EditWorkspace",props:{isEditModeActive:{type:Boolean}},emits:["exit"],setup(n,{emit:t}){const p=n,o=t,l=et(),c=dt(),{translateWithCurrentBubbles:s}=mo(),{reRenderFullImage:i}=ig({onRenderStart:()=>console.log("å¼€å§‹é‡æ–°æ¸²æŸ“..."),onRenderSuccess:j=>console.log("æ¸²æŸ“æˆåŠŸ:",j.substring(0,50)+"..."),onRenderError:j=>console.error("æ¸²æŸ“å¤±è´¥:",j)}),{isDrawingMode:k,isDrawingBox:P,currentDrawingRect:w,isMiddleButtonDown:O,handleBubbleSelect:Y,handleBubbleMultiSelect:J,handleClearMultiSelect:R,handleBubbleDragStart:f,handleBubbleDragging:I,handleBubbleDragEnd:T,handleBubbleResizeStart:M,handleBubbleResizing:g,handleBubbleResizeEnd:d,handleBubbleRotateStart:y,handleBubbleRotating:v,handleBubbleRotateEnd:C,toggleDrawingMode:E,handleDrawBubble:q,getDrawingRectStyle:B,handleBubbleUpdate:H,deleteSelectedBubbles:V,repairSelectedBubble:x,handleOcrRecognize:b}=lg({onReRender:()=>i(),onDelayedPreview:()=>i()}),$=S(0),a=S(0),{brushMode:u,brushSize:h,mouseX:W,mouseY:A,isBrushKeyDown:U,toggleBrushMode:G,exitBrushMode:D,startBrushPainting:m,continueBrushPainting:N,finishBrushPainting:r,adjustBrushSize:_}=sg({onBrushComplete:()=>i(),getCurrentRepairSettings:()=>({inpaintMethod:ke.value,fillColor:ee.value})}),{images:re,currentImageIndex:F,currentImage:te,imageCount:de,canGoPrevious:_e,canGoNext:$e}=yt(l),{bubbles:Pe,selectedIndex:Be,selectedIndices:ae,selectedBubble:Z,bubbleCount:z,hasBubbles:ne,hasSelection:oe}=yt(c),ue=Q(()=>pe.value?.querySelector("img")?.naturalWidth||2e3),me=Q(()=>pe.value?.querySelector("img")?.naturalHeight||2e3),xe=S(null),be=S(null),pe=S(null),Ie=S(null),Se=S(null),ze=S(null),Le=S("dual"),De=S("horizontal"),Te=S(!1),Ye=S(!0),lt=S(!1),it=S(!1),ke=S("solid"),ee=S("#FFFFFF"),ve=S(!1),Ve=S("å¤„ç†ä¸­..."),Ge=S(0),vt=S(0),tt=jo(),Xe=jo(),Lt=Q(()=>Xe.scale.value),cn=Q(()=>Xe.translateX.value),dn=Q(()=>Xe.translateY.value),gn=Q(()=>tt.scale.value),bt=S(null),pn=Q(()=>({transform:`translate(${tt.translateX.value}px, ${tt.translateY.value}px) scale(${tt.scale.value})`})),vn=Q(()=>({transform:`translate(${Xe.translateX.value}px, ${Xe.translateY.value}px) scale(${Xe.scale.value})`}));function bo(){Xe.zoomIn(),Ye.value&&tt.setTransform(Xe.getTransform())}function fo(){Xe.zoomOut(),Ye.value&&tt.setTransform(Xe.getTransform())}function ho(){Xe.resetZoom(),Ye.value&&tt.setTransform(Xe.getTransform())}const Ut=S(!1),mn=S(0),Ot=S(!1),Ct=S({x:0,y:0,size:0});function zt(){u.value&&D(),Wt()}function Nt(){c.bubbles.length>0&&c.selectBubble(0)}function yo(){_e.value&&(zt(),l.goToPrevious())}function Vt(){$e.value&&(zt(),l.goToNext())}function bn(j){j!==F.value&&j>=0&&j<de.value&&(zt(),l.setCurrentImageIndex(j))}function Wt(){if(!te.value)return;const j=Array.isArray(te.value.bubbleStates);Pe.value.length>0?(l.updateCurrentBubbleStates([...Pe.value]),l.setManuallyAnnotated(!0),console.log("å·²ä¿å­˜æ°”æ³¡çŠ¶æ€åˆ°å½“å‰å›¾ç‰‡ï¼Œæ ‡è®°ä¸ºæ‰‹åŠ¨æ ‡æ³¨")):j&&(l.updateCurrentBubbleStates([]),l.setManuallyAnnotated(!0),console.log("å·²ä¿å­˜ç©ºæ°”æ³¡çŠ¶æ€åˆ°å½“å‰å›¾ç‰‡ï¼ˆç”¨æˆ·ä¸»åŠ¨æ¸…ç©ºï¼Œæ ‡è®°ä¸ºæ‰‹åŠ¨æ ‡æ³¨ï¼‰"))}function wt(){te.value?.bubbleStates?(c.setBubbles([...te.value.bubbleStates],!0),console.log(`å·²åŠ è½½ ${te.value.bubbleStates.length} ä¸ªæ°”æ³¡çŠ¶æ€`)):c.clearBubblesLocal(),Nt()}function fn(){c.selectPrevious()}function hn(){c.selectNext()}function yn(){Te.value=!Te.value}function xn(){De.value=De.value==="horizontal"?"vertical":"horizontal";try{localStorage.setItem(No,De.value)}catch(j){console.warn("ä¿å­˜å¸ƒå±€æ¨¡å¼å¤±è´¥:",j)}setTimeout(()=>{$t()},300)}function kn(){const j=["dual","original","translated"],ie=j.indexOf(Le.value),ce=j[(ie+1)%j.length];ce&&(Le.value=ce)}function _n(){Ye.value=!Ye.value,console.log("åŒå›¾åŒæ­¥:",Ye.value?"å¼€å¯":"å…³é—­"),Ye.value&&tt.setTransform(Xe.getTransform())}function $t(){const j=Ie.value||be.value,ie=Se.value||pe.value;if(!j||!ie)return;const ce=ie.querySelector("img");if(!ce||!ce.naturalWidth)return;const We=j.getBoundingClientRect(),Ae=We.width/ce.naturalWidth,Re=We.height/ce.naturalHeight,Ue=Math.min(Ae,Re)*.95,Ee=(We.width-ce.naturalWidth*Ue)/2,mt=(We.height-ce.naturalHeight*Ue)/2,ft={scale:Ue,translateX:Ee,translateY:mt};Xe.setTransform(ft),tt.setTransform(ft)}function xo(j,ie){if(u.value){const Ee=j.deltaY>0?-5:5;_(Ee);return}const ce=j.currentTarget.getBoundingClientRect(),We=j.clientX-ce.left,Ae=j.clientY-ce.top,Re=j.deltaY>0?.9:1.1,Ue=ie==="original"?tt:Xe;Ue.zoomAt(We,Ae,Re),Ye.value&&(ie==="original"?Xe:tt).setTransform(Ue.getTransform())}function ko(j,ie){if(u.value){const ce=ie==="original"?be.value:Ie.value;ce&&m(j,ce);return}if(j.button===1){O.value=!0,Co(j,ie),j.preventDefault();return}if(k.value&&j.button===0){Co(j,ie),j.preventDefault();return}if(j.button===0){if(j.target.closest(".bubble-highlight-box"))return;j.shiftKey||R(),bt.value=ie,(ie==="original"?tt:Xe).startDrag(j.clientX,j.clientY),document.addEventListener("mousemove",_o),document.addEventListener("mouseup",So),j.preventDefault()}}function _o(j){if(!bt.value)return;const ie=bt.value==="original"?tt:Xe;ie.drag(j.clientX,j.clientY),Ye.value&&(bt.value==="original"?Xe:tt).setTransform(ie.getTransform())}function So(){bt.value&&(bt.value==="original"?tt:Xe).endDrag(),bt.value=null,document.removeEventListener("mousemove",_o),document.removeEventListener("mouseup",So)}let Kt="translated";function Co(j,ie="translated"){Kt=ie;const ce=ie==="original"?pe.value:Se.value,We=ie==="original"?tt:Xe;if(!ce)return;const Ae=ce.getBoundingClientRect(),Re=(j.clientX-Ae.left)/We.scale.value,Ue=(j.clientY-Ae.top)/We.scale.value;$.value=Re,a.value=Ue,P.value=!0,w.value=[Re,Ue,Re,Ue],document.addEventListener("mousemove",qt),document.addEventListener("mouseup",Ht)}function qt(j){if(!P.value)return;const ie=Kt==="original"?pe.value:Se.value,ce=Kt==="original"?tt:Xe;if(!ie)return;const We=ie.getBoundingClientRect(),Ae=(j.clientX-We.left)/ce.scale.value,Re=(j.clientY-We.top)/ce.scale.value;w.value=[Math.min($.value,Ae),Math.min(a.value,Re),Math.max($.value,Ae),Math.max(a.value,Re)]}function Ht(j){document.removeEventListener("mousemove",qt),document.removeEventListener("mouseup",Ht);const ie=O.value;if(!P.value||!w.value){P.value=!1,w.value=null,O.value=!1;return}const[ce,We,Ae,Re]=w.value,Ue=Ae-ce,Ee=Re-We;Ue>10&&Ee>10&&(c.addBubble(w.value),c.selectBubble(c.bubbleCount-1),console.log("å·²æ·»åŠ æ–°æ°”æ³¡:",w.value)),P.value=!1,w.value=null,O.value=!1,!ie&&k.value&&(k.value=!1)}function wo(j){console.log(`${j} å›¾ç‰‡åŠ è½½å®Œæˆ`),Lt.value===1&&cn.value===0&&dn.value===0&&ct(()=>{$t()})}function Sn(){i()}function Cn(j){j.inpaintMethod!==void 0&&(ke.value=j.inpaintMethod),j.fillColor!==void 0&&(ee.value=j.fillColor),Be.value>=0&&H(j)}function wn(j){fe("æ–‡æœ¬å·²åº”ç”¨","success"),i()}function $n(j){const ie=c.initialStates[j];if(!ie){console.warn(`æ— æ³•é‡ç½®æ°”æ³¡ #${j+1}ï¼šæ‰¾ä¸åˆ°åˆå§‹çŠ¶æ€`),fe("æ— æ³•é‡ç½®ï¼šæ‰¾ä¸åˆ°åˆå§‹çŠ¶æ€","warning");return}const ce=JSON.parse(JSON.stringify(ie));c.updateBubble(j,ce),console.log(`æ°”æ³¡ #${j+1} å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€`),fe("æ°”æ³¡å·²é‡ç½®","success"),i()}async function In(j){const ie=Pe.value[j];if(!ie?.originalText){console.warn("æ— æ³•é‡æ–°ç¿»è¯‘ï¼šç¼ºå°‘æ°”æ³¡æˆ–åŸæ–‡");return}try{console.log(`å¼€å§‹é‡æ–°ç¿»è¯‘æ°”æ³¡ #${j+1}`);const{translateSingleText:ce}=await nt(async()=>{const{translateSingleText:Ue}=await Promise.resolve().then(()=>gs);return{translateSingleText:Ue}},void 0),{useSettingsStore:We}=await nt(async()=>{const{useSettingsStore:Ue}=await import("./system.CZEHfbsz.js").then(Ee=>Ee.s);return{useSettingsStore:Ue}},__vite__mapDeps([0,1,2,3,4,5])),Ae=We().settings,Re=await ce({original_text:ie.originalText,model_provider:Ae.translation.provider,api_key:Ae.translation.apiKey,model_name:Ae.translation.modelName,custom_base_url:Ae.translation.customBaseUrl,target_language:Ae.targetLanguage,prompt_content:Ae.translatePrompt});Re.success&&Re.data?.translated_text?(c.updateBubble(j,{translatedText:Re.data.translated_text}),console.log(`ç¿»è¯‘æˆåŠŸ: "${Re.data.translated_text}"`),i()):console.error("ç¿»è¯‘å¤±è´¥:",Re.error||"æœªçŸ¥é”™è¯¯")}catch(ce){console.error("ç¿»è¯‘å‡ºé”™:",ce)}}function $o(j,ie){for(j.bubbleTexts||(j.bubbleTexts=[]),j.originalTexts||(j.originalTexts=[]);j.bubbleTexts.length<ie;)j.bubbleTexts.push("");for(;j.originalTexts.length<ie;)j.originalTexts.push("")}function Io(j,ie,ce){const We=j.auto_directions||[];return j.bubble_coords.map((Ae,Re)=>{const Ue=Ae[0]??0,Ee=Ae[1]??0,mt=Ae[2]??0,ft=Ae[3]??0;let gt;return We[Re]?gt=We[Re]==="v"?"vertical":"horizontal":gt=ft-Ee>mt-Ue?"vertical":"horizontal",{coords:Ae,originalText:ie.originalTexts?.[Re]||"",translatedText:ie.bubbleTexts?.[Re]||"",textboxText:"",fontSize:ce.fontSize,fontFamily:ce.fontFamily,textDirection:gt,autoTextDirection:gt,textColor:ce.textColor,fillColor:ce.fillColor,strokeEnabled:ce.strokeEnabled,strokeColor:ce.strokeColor,strokeWidth:ce.strokeWidth,rotationAngle:j.bubble_angles?.[Re]||0,inpaintMethod:ce.inpaintMethod,position:{x:0,y:0},polygon:[]}})}async function Tn(){const j=te.value;if(!j?.originalDataURL){fe("æ²¡æœ‰æœ‰æ•ˆçš„å›¾ç‰‡ç”¨äºæ£€æµ‹","warning");return}try{fe("æ­£åœ¨è‡ªåŠ¨æ£€æµ‹æ–‡æœ¬æ¡†...","info");const ce=j.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/)?.[1]||"";if(!ce){fe("æ— æ³•è§£æå›¾ç‰‡æ•°æ®","error");return}const We=Je(),{textDetector:Ae,boxExpand:Re,textStyle:Ue}=We.settings,Ee=await to(ce,Ae,{box_expand_ratio:Re.ratio,box_expand_top:Re.top,box_expand_bottom:Re.bottom,box_expand_left:Re.left,box_expand_right:Re.right});if(Ee.success&&Ee.bubble_coords){l.updateCurrentImage({bubbleCoords:Ee.bubble_coords,bubbleAngles:Ee.bubble_angles||[]}),$o(j,Ee.bubble_coords.length);const mt={bubble_coords:Ee.bubble_coords.map(gt=>[...gt]),bubble_angles:Ee.bubble_angles,auto_directions:Ee.auto_directions},ft=Io(mt,j,Ue);c.setBubbles(ft),Nt(),fe(`è‡ªåŠ¨æ£€æµ‹åˆ° ${Ee.bubble_coords.length} ä¸ªæ–‡æœ¬æ¡†`,"success")}else fe(Ee.error||"æ£€æµ‹å¤±è´¥","error")}catch(ie){console.error("è‡ªåŠ¨æ£€æµ‹å¤±è´¥:",ie),fe("è‡ªåŠ¨æ£€æµ‹å¤±è´¥","error")}}async function Dn(){if(re.value.length<=1){fe("è‡³å°‘éœ€è¦ä¸¤å¼ å›¾ç‰‡æ‰èƒ½æ‰§è¡Œæ‰¹é‡æ£€æµ‹","warning");return}if(!confirm("æ­¤æ“ä½œå°†å¯¹æ‰€æœ‰å›¾ç‰‡è¿›è¡Œæ–‡æœ¬æ¡†æ£€æµ‹ï¼Œå¯èƒ½ä¼šè¦†ç›–å·²æœ‰çš„æ£€æµ‹ç»“æœã€‚ç¡®å®šç»§ç»­å—ï¼Ÿ"))return;const j=Je(),{textDetector:ie,boxExpand:ce,textStyle:We}=j.settings,Ae=F.value,Re=re.value.length;ve.value=!0,Ve.value="æ‰¹é‡æ£€æµ‹ä¸­",vt.value=Re,Ge.value=0;try{let Ue=0;for(let Ee=0;Ee<Re;Ee++){const mt=re.value[Ee];if(!mt?.originalDataURL)continue;Ge.value=Ee+1;const gt=mt.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/)?.[1]||"";if(!gt)continue;const pt=await to(gt,ie,{box_expand_ratio:ce.ratio,box_expand_top:ce.top,box_expand_bottom:ce.bottom,box_expand_left:ce.left,box_expand_right:ce.right});if(pt.success&&pt.bubble_coords){const xt=re.value[Ee];if(xt){xt.bubbleCoords=pt.bubble_coords,xt.bubbleAngles=pt.bubble_angles||[],$o(xt,pt.bubble_coords.length);const An={bubble_coords:pt.bubble_coords.map(Fn=>[...Fn]),bubble_angles:pt.bubble_angles,auto_directions:pt.auto_directions};xt.bubbleStates=Io(An,xt,We),Ue+=pt.bubble_coords.length,Ee===F.value&&wt()}}}Ve.value="æ£€æµ‹å®Œæˆ",Ge.value=Re,Ae!==F.value&&l.setCurrentImageIndex(Ae),wt(),fe(`æ‰¹é‡æ£€æµ‹å®Œæˆï¼å…±å¤„ç† ${Re} å¼ å›¾ç‰‡ï¼Œæ£€æµ‹åˆ° ${Ue} ä¸ªæ–‡æœ¬æ¡†`,"success"),setTimeout(()=>{ve.value=!1},2e3)}catch(Ue){console.error("æ‰¹é‡æ£€æµ‹å¤±è´¥:",Ue),fe("æ‰¹é‡æ£€æµ‹å¤±è´¥","error"),ve.value=!1}}async function Rn(){if(!te.value?.originalDataURL){fe("æ²¡æœ‰æœ‰æ•ˆçš„å›¾ç‰‡ç”¨äºç¿»è¯‘","warning");return}if(Pe.value.length===0){fe("æ²¡æœ‰æ–‡æœ¬æ¡†å¯ç”¨äºç¿»è¯‘ï¼Œè¯·å…ˆæ£€æµ‹æˆ–æ·»åŠ æ–‡æœ¬æ¡†","warning");return}fe("æ­£åœ¨ä½¿ç”¨å½“å‰æ–‡æœ¬æ¡†ç¿»è¯‘...","info");try{await s()&&(fe("ç¿»è¯‘æˆåŠŸï¼","success"),Nt())}catch(ie){console.error("ç¿»è¯‘å¤±è´¥:",ie),fe(`ç¿»è¯‘å¤±è´¥: ${ie instanceof Error?ie.message:"æœªçŸ¥é”™è¯¯"}`,"error")}}function Mn(){G("repair")}function Bn(){G("restore")}function To(j){N(j)}function Do(){r()}function En(j){Ut.value=!0,mn.value=De.value==="horizontal"?j.clientX:j.clientY,document.body.style.cursor=De.value==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",Jt),document.addEventListener("mouseup",jt),j.preventDefault()}function Jt(j){if(!Ut.value)return;const ie=be.value?.parentElement?.parentElement;if(!ie)return;const ce=ie.getBoundingClientRect();if(De.value==="horizontal"){const We=j.clientX-ce.left,Ae=ce.width,Re=Math.max(20,Math.min(80,We/Ae*100)),Ue=ie.querySelector(".original-panel"),Ee=ie.querySelector(".translated-panel");Ue&&Ee&&(Ue.style.flex=`0 0 ${Re}%`,Ee.style.flex=`0 0 ${100-Re}%`)}else{const We=j.clientY-ce.top,Ae=ce.height,Re=Math.max(20,Math.min(80,We/Ae*100)),Ue=ie.querySelector(".original-panel"),Ee=ie.querySelector(".translated-panel");Ue&&Ee&&(Ue.style.flex=`0 0 ${Re}%`,Ee.style.flex=`0 0 ${100-Re}%`)}}function jt(){Ut.value=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",Jt),document.removeEventListener("mouseup",jt)}function Pn(j){Ot.value=!0;const ie=ze.value;ie&&(Ct.value={x:j.clientX,y:j.clientY,size:De.value==="horizontal"?ie.offsetWidth:ie.offsetHeight},document.body.style.cursor=De.value==="horizontal"?"ew-resize":"ns-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",Yt),document.addEventListener("mouseup",Gt),j.preventDefault())}function Yt(j){if(!(!Ot.value||!ze.value))if(De.value==="horizontal"){const ie=Ct.value.x-j.clientX;let ce=Ct.value.size+ie;ce=Math.max(300,Math.min(window.innerWidth*.6,ce)),ze.value.style.flex=`0 0 ${ce}px`,ze.value.style.minWidth=`${ce}px`}else{const ie=Ct.value.y-j.clientY;let ce=Ct.value.size+ie;ce=Math.max(200,Math.min(window.innerHeight*.5,ce)),ze.value.style.flex=`0 0 ${ce}px`,ze.value.style.height=`${ce}px`}}function Gt(){Ot.value=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",Yt),document.removeEventListener("mouseup",Gt)}function Ro(j){const ie=j.target,ce=j.key.toLowerCase();if(ce==="r"||ce==="u"||ce==="a"||ce==="d"){if(ie.tagName==="TEXTAREA")return;(ie.tagName==="INPUT"||ie.tagName==="SELECT"||ie.tagName==="BUTTON")&&ie.blur()}else if(ie.tagName==="INPUT"||ie.tagName==="TEXTAREA"||ie.tagName==="SELECT")return;switch(j.key){case"Escape":Eo();break;case"Delete":case"Backspace":!u.value&&oe.value&&(V(),j.preventDefault());break;case"a":case"A":u.value||(yo(),j.preventDefault());break;case"d":case"D":u.value||(Vt(),j.preventDefault());break;case"Enter":j.ctrlKey&&!u.value&&(Bo(),j.preventDefault());break;case"r":case"R":U.value||(G("repair"),j.preventDefault());break;case"u":case"U":U.value||(G("restore"),j.preventDefault());break;case"+":case"=":bo(),j.preventDefault();break;case"-":fo(),j.preventDefault();break;case"0":ho(),j.preventDefault();break}}function Mo(j){(j.key==="r"||j.key==="R"||j.key==="u"||j.key==="U")&&(D(),j.preventDefault())}async function Bo(){Wt(),await i(),$e.value?Vt():fe("å·²æ˜¯æœ€åä¸€å¼ å›¾ç‰‡","info")}function Eo(){Wt(),o("exit")}return ut(()=>{try{const j=localStorage.getItem(No);(j==="horizontal"||j==="vertical")&&(De.value=j)}catch(j){console.warn("åŠ è½½å¸ƒå±€æ¨¡å¼å¤±è´¥:",j)}document.addEventListener("keydown",Ro),document.addEventListener("keyup",Mo),document.addEventListener("mousemove",To),document.addEventListener("mouseup",Do),p.isEditModeActive&&(wt(),ct(()=>{xe.value?.focus()}))}),Tt(()=>{document.removeEventListener("keydown",Ro),document.removeEventListener("keyup",Mo),document.removeEventListener("mousemove",To),document.removeEventListener("mouseup",Do),document.removeEventListener("mousemove",qt),document.removeEventListener("mouseup",Ht),document.removeEventListener("mousemove",Jt),document.removeEventListener("mouseup",jt),document.removeEventListener("mousemove",Yt),document.removeEventListener("mouseup",Gt)}),ye(()=>p.isEditModeActive,j=>{j&&(wt(),ct(()=>{xe.value?.focus()}))}),ye(F,()=>{p.isEditModeActive&&wt()}),ye(Z,j=>{j&&(ke.value=j.inpaintMethod||"solid",ee.value=j.fillColor||"#FFFFFF")},{immediate:!0}),(j,ie)=>n.isEditModeActive?(L(),K("div",{key:0,class:Me(["edit-workspace",[`layout-${De.value}`,{"drawing-mode":X(k)}]]),tabindex:"0",ref_key:"workspaceRef",ref:xe},[he(jp,{"current-image-index":X(F),"image-count":X(de),"can-go-previous":X(_e),"can-go-next":X($e),"show-thumbnails":Te.value,"has-bubbles":X(ne),"selected-bubble-index":X(Be),"bubble-count":X(z),"layout-mode":De.value,"sync-enabled":Ye.value,scale:Lt.value,"is-drawing-mode":X(k),"has-selection":X(oe),"brush-mode":X(u),"brush-size":X(h),"mouse-x":X(W),"mouse-y":X(A),"is-processing":ve.value,"progress-text":Ve.value,"progress-current":Ge.value,"progress-total":vt.value,onGoPreviousImage:yo,onGoNextImage:Vt,onToggleThumbnails:yn,onSelectPreviousBubble:fn,onSelectNextBubble:hn,onToggleLayout:xn,onToggleViewMode:kn,onToggleSync:_n,onFitToScreen:$t,onZoomIn:bo,onZoomOut:fo,onResetZoom:ho,onExitEditMode:Eo,onAutoDetectBubbles:Tn,onDetectAllImages:Dn,onTranslateWithBubbles:Rn,onToggleDrawingMode:X(E),onDeleteSelectedBubbles:X(V),onRepairSelectedBubble:X(x),onActivateRepairBrush:Mn,onActivateRestoreBrush:Bn,onApplyAndNext:Bo},null,8,["current-image-index","image-count","can-go-previous","can-go-next","show-thumbnails","has-bubbles","selected-bubble-index","bubble-count","layout-mode","sync-enabled","scale","is-drawing-mode","has-selection","brush-mode","brush-size","mouse-x","mouse-y","is-processing","progress-text","progress-current","progress-total","onToggleDrawingMode","onDeleteSelectedBubbles","onRepairSelectedBubble"]),he(tv,{visible:Te.value,images:X(re),"current-image-index":X(F),onSwitchToImage:bn},null,8,["visible","images","current-image-index"]),e("div",ov,[e("div",nv,[se(e("div",{class:Me(["image-panel original-panel",{collapsed:Le.value==="translated"||lt.value}])},[e("div",sv,[ie[8]||(ie[8]=e("span",{class:"panel-title"},"ğŸ“– åŸå›¾ (æ—¥æ–‡)",-1)),e("button",{class:"panel-toggle",onClick:ie[0]||(ie[0]=ce=>lt.value=!lt.value),title:"æŠ˜å /å±•å¼€"},le(lt.value?"+":"âˆ’"),1)]),e("div",{ref_key:"originalViewportRef",ref:be,class:"image-viewport",onWheel:ie[2]||(ie[2]=Ze(ce=>xo(ce,"original"),["prevent"])),onMousedown:ie[3]||(ie[3]=ce=>ko(ce,"original")),onDblclick:$t},[e("div",{ref_key:"originalWrapperRef",ref:pe,class:"image-canvas-wrapper",style:st(pn.value)},[X(te)?.originalDataURL?(L(),K("img",{key:0,src:X(te).originalDataURL,alt:"åŸå›¾",onLoad:ie[1]||(ie[1]=ce=>wo("original"))},null,40,av)):ge("",!0),X(te)?.originalDataURL?(L(),at(Yo,{key:1,bubbles:X(Pe),"selected-index":X(Be),"selected-indices":X(ae),scale:gn.value,"is-drawing-mode":X(k),"is-brush-mode":!!X(u),"image-width":ue.value,"image-height":me.value,onSelect:X(Y),onMultiSelect:X(J),onDragStart:X(f),onDragging:X(I),onDragEnd:X(T),onResizeStart:X(M),onResizing:X(g),onResizeEnd:X(d),onRotateStart:X(y),onRotating:X(v),onRotateEnd:X(C),onDrawBubble:X(q)},null,8,["bubbles","selected-index","selected-indices","scale","is-drawing-mode","is-brush-mode","image-width","image-height","onSelect","onMultiSelect","onDragStart","onDragging","onDragEnd","onResizeStart","onResizing","onResizeEnd","onRotateStart","onRotating","onRotateEnd","onDrawBubble"])):ge("",!0),X(w)?(L(),K("div",{key:2,class:"drawing-rect-edit",style:st(X(B)())},null,4)):ge("",!0)],4)],544)],2),[[Fe,Le.value!=="translated"]]),Le.value==="dual"?(L(),K("div",{key:0,class:Me(["panel-divider",{"vertical-divider":De.value==="vertical"}]),onMousedown:En},null,34)):ge("",!0),se(e("div",{class:Me(["image-panel translated-panel",{collapsed:Le.value==="original"||it.value}])},[e("div",lv,[ie[9]||(ie[9]=e("span",{class:"panel-title"},"ğŸ“ ç¿»è¯‘å›¾ (ä¸­æ–‡)",-1)),e("button",{class:"panel-toggle",onClick:ie[4]||(ie[4]=ce=>it.value=!it.value),title:"æŠ˜å /å±•å¼€"},le(it.value?"+":"âˆ’"),1)]),e("div",{ref_key:"translatedViewportRef",ref:Ie,class:"image-viewport",onWheel:ie[6]||(ie[6]=Ze(ce=>xo(ce,"translated"),["prevent"])),onMousedown:ie[7]||(ie[7]=ce=>ko(ce,"translated")),onDblclick:$t},[e("div",{ref_key:"translatedWrapperRef",ref:Se,class:"image-canvas-wrapper",style:st(vn.value)},[X(te)?.translatedDataURL||X(te)?.originalDataURL?(L(),K("img",{key:0,src:X(te)?.translatedDataURL||X(te)?.originalDataURL,alt:"ç¿»è¯‘å›¾",onLoad:ie[5]||(ie[5]=ce=>wo("translated"))},null,40,iv)):ge("",!0),X(te)?.translatedDataURL||X(te)?.originalDataURL?(L(),at(Yo,{key:1,bubbles:X(Pe),"selected-index":X(Be),"selected-indices":X(ae),scale:Lt.value,"is-drawing-mode":X(k),"is-brush-mode":!!X(u),"image-width":ue.value,"image-height":me.value,onSelect:X(Y),onMultiSelect:X(J),onDragStart:X(f),onDragging:X(I),onDragEnd:X(T),onResizeStart:X(M),onResizing:X(g),onResizeEnd:X(d),onRotateStart:X(y),onRotating:X(v),onRotateEnd:X(C),onDrawBubble:X(q)},null,8,["bubbles","selected-index","selected-indices","scale","is-drawing-mode","is-brush-mode","image-width","image-height","onSelect","onMultiSelect","onDragStart","onDragging","onDragEnd","onResizeStart","onResizing","onResizeEnd","onRotateStart","onRotating","onRotateEnd","onDrawBubble"])):ge("",!0),X(w)?(L(),K("div",{key:2,class:"drawing-rect-edit translated-drawing-rect",style:st(X(B)())},null,4)):ge("",!0)],4)],544)],2),[[Fe,Le.value!=="original"]])]),e("div",{ref_key:"editPanelRef",ref:ze,class:"edit-panel-container"},[e("div",{class:"panel-resize-handle vertical",onMousedown:Pn}," â‹®â‹®â‹® ",32),he(xp,{bubble:X(Z),"bubble-index":X(Be),onUpdate:Cn,onReRender:Sn,onOcrRecognize:X(b),onReTranslate:In,onApplyBubble:wn,onResetCurrent:$n},null,8,["bubble","bubble-index","onOcrRecognize"])],512)])],2)):ge("",!0)}}),uv=qe(rv,[["__scopeId","data-v-0916fb0e"]]),St="/api/web-import";async function cv(n){return(await fetch(`${St}/check-support?url=${encodeURIComponent(n)}`)).json()}async function dv(){return(await fetch(`${St}/gallery-dl-images`)).json()}async function gv(n,t,p,o,l,c="auto",s){const i=await fetch(`${St}/extract`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:n,config:t,engine:c})});if(!i.ok){const O=await i.json().catch(()=>({error:"è¯·æ±‚å¤±è´¥"}));l(O.error||`HTTP ${i.status}`);return}const k=i.body?.getReader();if(!k){l("æ— æ³•è¯»å–å“åº”æµ");return}const P=new TextDecoder;let w="";try{for(;;){const{done:O,value:Y}=await k.read();if(O)break;w+=P.decode(Y,{stream:!0});const J=w.split(`
`);w=J.pop()||"";let R="",f="";for(const I of J)if(I.startsWith("event:"))R=I.slice(6).trim();else if(I.startsWith("data:"))f=I.slice(5).trim();else if(I===""&&R&&f){try{const T=JSON.parse(f);R==="log"?p(T):R==="page"?s&&s(T):R==="result"?o(T):R==="error"&&l(T.error||"æœªçŸ¥é”™è¯¯")}catch(T){console.error("è§£æ SSE æ•°æ®å¤±è´¥:",T)}R="",f=""}}}finally{k.releaseLock()}}async function pv(n,t,p,o="ai-agent"){const l=await fetch(`${St}/download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pages:n,sourceUrl:t,config:p,engine:o})});if(!l.ok){const c=await l.json().catch(()=>({error:"è¯·æ±‚å¤±è´¥"}));throw new Error(c.error||`HTTP ${l.status}`)}return l.json()}async function vv(n){return(await fetch(`${St}/test-firecrawl`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:n})})).json()}async function mv(n,t,p,o){return(await fetch(`${St}/test-agent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:n,apiKey:t,customBaseUrl:p,modelName:o})})).json()}const bv={class:"modal-container"},fv={class:"modal-body"},hv={class:"url-section"},yv=["disabled"],xv=["disabled"],kv=["disabled"],_v={key:0,class:"loading-spinner"},Sv={key:1},Cv={key:0,class:"engine-hint"},wv={key:0,class:"hint-checking"},$v={key:1,class:"hint-supported"},Iv={key:2,class:"hint-unsupported"},Tv={class:"settings-section"},Dv={class:"settings-toggle"},Rv={key:0,class:"settings-content"},Mv={class:"settings-tabs"},Bv={class:"settings-tab-content"},Ev={class:"settings-group"},Pv={class:"form-row"},Av={class:"input-group"},Fv=["type","value"],Lv=["disabled"],Uv={class:"settings-group"},Ov={class:"form-row"},zv=["value"],Nv=["value"],Vv={class:"form-row"},Wv={class:"input-group"},Kv=["type","value"],qv={key:0,class:"form-row"},Hv=["value"],Jv={class:"form-row"},jv=["value"],Yv={class:"form-row inline"},Gv={class:"checkbox-label"},Xv=["checked"],Zv={class:"checkbox-label"},Qv=["checked"],em={class:"form-row"},tm=["disabled"],om={class:"settings-group"},nm={class:"form-row"},sm=["value"],am={class:"form-row"},lm=["value"],im={class:"settings-group"},rm={class:"form-grid"},um={class:"form-row"},cm=["value"],dm={class:"form-row"},gm=["value"],pm={class:"form-row"},vm=["value"],mm={class:"form-row"},bm=["value"],fm={class:"form-row"},hm={class:"checkbox-label"},ym=["checked"],xm={class:"settings-group"},km={class:"form-row inline"},_m={class:"checkbox-label"},Sm=["checked"],Cm={class:"checkbox-label"},wm=["checked"],$m={class:"settings-tab-content"},Im={class:"settings-group"},Tm={class:"form-row"},Dm={class:"checkbox-label"},Rm=["checked"],Mm={class:"form-row"},Bm={class:"checkbox-label"},Em=["checked"],Pm={class:"form-row"},Am={class:"checkbox-label"},Fm=["checked"],Lm={key:0,class:"form-grid"},Um={class:"form-row"},Om=["value"],zm={class:"form-row"},Nm=["value"],Vm={class:"form-row"},Wm=["value"],Km={class:"form-row"},qm={class:"checkbox-label"},Hm=["checked"],Jm={key:1,class:"form-row"},jm=["value"],Ym={class:"settings-tab-content"},Gm={class:"settings-group"},Xm={class:"form-row"},Zm=["value"],Qm={class:"form-row"},eb=["value"],tb={class:"form-row"},ob={class:"checkbox-label"},nb=["checked"],sb={key:1,class:"logs-section"},ab={class:"logs-toggle"},lb={key:0,class:"extracting-hint"},ib={key:0,class:"logs-content"},rb={class:"log-time"},ub={class:"log-message"},cb={key:2,class:"error-section"},db={class:"error-message"},gb={key:3,class:"result-section"},pb={class:"result-header"},vb={class:"result-title"},mb={class:"result-meta"},bb={class:"result-count"},fb={key:0,class:"result-engine"},hb={class:"select-control"},yb={class:"select-all"},xb=["checked"],kb={class:"selected-count"},_b={class:"image-grid"},Sb=["onClick"],Cb={class:"image-checkbox"},wb=["checked","onChange"],$b={class:"image-preview"},Ib=["src","alt"],Tb={class:"image-label"},Db={key:4,class:"progress-section"},Rb={class:"progress-label"},Mb={class:"progress-bar"},Bb={class:"modal-footer"},Eb=["disabled"],Pb=["disabled"],Ab={key:0,class:"loading-spinner"},Fb={key:1},Lb=He({__name:"WebImportModal",setup(n){const t=sn(),p=et(),o=S(""),l=S(!0),c=S("auto"),s=S(!1),i=S(!1),k=S(!1),P=S(!1),w=S("basic"),O=S(!1),Y=S(!1),J=S(!1),R=S(!1),f=Q(()=>t.modalVisible),I=Q(()=>t.status),T=Q(()=>t.logs),M=Q(()=>t.extractResult),g=Q(()=>t.selectedPages),d=Q(()=>t.selectedCount),y=Q(()=>t.downloadProgress),v=Q(()=>t.downloadProgressPercent),C=Q(()=>t.error),E=Q(()=>t.isProcessing),q=Q(()=>t.settings.ui.showAgentLogs),B=Q(()=>M.value?.engine||null),H=Q(()=>{switch(B.value){case"gallery-dl":return"Gallery-DL";case"ai-agent":return"AI Agent";default:return""}}),V=Q(()=>M.value?.pages?d.value===M.value.pages.length:!1);function x(N){return B.value==="gallery-dl",N}let b=null;async function $(N){if(b&&clearTimeout(b),!N.trim()){s.value=!1,i.value=!1;return}b=setTimeout(async()=>{k.value=!0;try{const r=await cv(N);s.value=r.available,i.value=r.supported}catch{s.value=!1,i.value=!1}finally{k.value=!1}},500)}function a(){E.value&&!confirm("æ­£åœ¨å¤„ç†ä¸­ï¼Œç¡®å®šè¦å…³é—­å—ï¼Ÿ")||(t.closeModal(),t.resetState(),o.value="")}async function u(){const N=o.value.trim();if(!N){alert("è¯·è¾“å…¥ç½‘å€");return}try{new URL(N)}catch{alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€");return}t.resetState(),t.setUrl(N),t.setStatus("extracting");try{await gv(N,t.settings,r=>{t.addLog(r)},r=>{t.setExtractResult(r),r.success?t.setStatus("extracted"):t.setError(r.error||"æå–å¤±è´¥")},r=>{t.setError(r)},c.value,r=>{t.addPageIncremental(r)})}catch(r){t.setError(r instanceof Error?r.message:"æå–å¤±è´¥")}}function h(N){t.togglePageSelection(N)}function W(){t.toggleSelectAll()}async function A(){if(!M.value?.pages||d.value===0){alert("è¯·é€‰æ‹©è¦å¯¼å…¥çš„å›¾ç‰‡");return}const N=M.value.pages.filter(_=>g.value.has(_.pageNumber));t.setStatus("downloading"),t.updateDownloadProgress(0,N.length);const r=B.value||"ai-agent";try{if(r==="gallery-dl"){const re=await dv();if(re.success&&re.images.length>0){let F=0;const te=Math.min(re.images.length,N.length);for(let de=0;de<te;de++){const _e=re.images[de];_e&&_e.filename&&_e.data&&(p.addImage(_e.filename,_e.data),F++,t.updateDownloadProgress(F,te))}t.setStatus("completed"),alert(`æˆåŠŸå¯¼å…¥ ${F} å¼ å›¾ç‰‡`),a();return}else throw new Error(re.error||"è·å–å›¾ç‰‡å¤±è´¥")}const _=await pv(N,M.value.sourceUrl,t.settings,r);if(_.success&&_.images.length>0){t.setDownloadedImages(_.images),t.updateDownloadProgress(_.images.length,N.length);for(const F of _.images)p.addImage(F.filename,F.dataUrl);t.setStatus("completed");const re=_.failedCount>0?`ï¼Œ${_.failedCount} å¼ å¤±è´¥`:"";alert(`æˆåŠŸå¯¼å…¥ ${_.images.length} å¼ å›¾ç‰‡${re}`),a()}else t.setError(_.error||"ä¸‹è½½å¤±è´¥")}catch(_){t.setError(_ instanceof Error?_.message:"ä¸‹è½½å¤±è´¥")}}ye(f,N=>{N&&setTimeout(()=>{document.querySelector(".url-input")?.focus()},100)}),ye(o,N=>{$(N)});const U=Q(()=>t.settings.agent.provider==="custom_openai");async function G(){if(!t.settings.firecrawl.apiKey){alert("è¯·è¾“å…¥ Firecrawl API Key");return}O.value=!0;try{const N=await vv(t.settings.firecrawl.apiKey);N.success?alert("âœ… Firecrawl è¿æ¥æˆåŠŸ"):alert(`âŒ è¿æ¥å¤±è´¥: ${N.error}`)}catch(N){alert(`âŒ è¿æ¥å¤±è´¥: ${N instanceof Error?N.message:"æœªçŸ¥é”™è¯¯"}`)}finally{O.value=!1}}async function D(){if(!t.settings.agent.apiKey){alert("è¯·è¾“å…¥ AI Agent API Key");return}Y.value=!0;try{const N=await mv(t.settings.agent.provider,t.settings.agent.apiKey,t.settings.agent.customBaseUrl,t.settings.agent.modelName);N.success?alert("âœ… AI Agent è¿æ¥æˆåŠŸ"):alert(`âŒ è¿æ¥å¤±è´¥: ${N.error}`)}catch(N){alert(`âŒ è¿æ¥å¤±è´¥: ${N instanceof Error?N.message:"æœªçŸ¥é”™è¯¯"}`)}finally{Y.value=!1}}function m(){confirm("ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯å—ï¼Ÿ")&&t.resetExtractionPrompt()}return(N,r)=>(L(),at(Jn,{to:"body"},[f.value?(L(),K("div",{key:0,class:"modal-overlay",onClick:Ze(a,["self"])},[e("div",bv,[e("div",{class:"modal-header"},[r[37]||(r[37]=e("h2",{class:"modal-title"},[e("span",{class:"title-icon"},"ğŸŒ"),Ce(" ä»ç½‘é¡µå¯¼å…¥æ¼«ç”» ")],-1)),e("button",{class:"close-btn",onClick:a,title:"å…³é—­"},"Ã—")]),e("div",fv,[e("div",hv,[se(e("input",{"onUpdate:modelValue":r[0]||(r[0]=_=>o.value=_),type:"url",class:"url-input",placeholder:"è¾“å…¥æ¼«ç”»ç½‘é¡µ URLï¼Œå¦‚ https://example.com/chapter-1",disabled:E.value,onKeyup:qn(u,["enter"])},null,40,yv),[[we,o.value]]),se(e("select",{"onUpdate:modelValue":r[1]||(r[1]=_=>c.value=_),class:"engine-select",disabled:E.value},[...r[38]||(r[38]=[e("option",{value:"auto"},"è‡ªåŠ¨é€‰æ‹©",-1),e("option",{value:"gallery-dl"},"Gallery-DL",-1),e("option",{value:"ai-agent"},"AI Agent",-1)])],8,xv),[[Hn,c.value]]),e("button",{class:"extract-btn",disabled:E.value||!o.value.trim(),onClick:u},[I.value==="extracting"?(L(),K("span",_v)):(L(),K("span",Sv,"ğŸ”")),Ce(" "+le(I.value==="extracting"?"æå–ä¸­...":"å¼€å§‹æå–"),1)],8,kv)]),o.value.trim()&&!E.value?(L(),K("div",Cv,[k.value?(L(),K("span",wv,"æ£€æŸ¥ä¸­...")):i.value?(L(),K("span",$v,"âœ“ è¯¥ç½‘ç«™æ”¯æŒ Gallery-DL é«˜é€Ÿä¸‹è½½")):s.value?(L(),K("span",Iv,"è¯¥ç½‘ç«™å°†ä½¿ç”¨ AI Agent æ¨¡å¼")):ge("",!0)])):ge("",!0),r[80]||(r[80]=e("div",{class:"notice"}," âš ï¸ è¯·ä»…çˆ¬å–æ‚¨æœ‰æƒè®¿é—®çš„å†…å®¹ï¼Œå¹¶éµå®ˆç›®æ ‡ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾ã€‚ ",-1)),e("div",Tv,[e("div",{class:"settings-header",onClick:r[2]||(r[2]=_=>P.value=!P.value)},[e("span",Dv,le(P.value?"â–¼":"â–¶"),1),r[39]||(r[39]=e("span",{class:"settings-title"},"âš™ï¸ è®¾ç½®",-1)),r[40]||(r[40]=e("span",{class:"settings-hint"},"ç‚¹å‡»å±•å¼€é…ç½®",-1))]),P.value?(L(),K("div",Rv,[e("div",Mv,[e("button",{class:Me(["settings-tab",{active:w.value==="basic"}]),onClick:r[3]||(r[3]=_=>w.value="basic")}," åŸºæœ¬è®¾ç½® ",2),e("button",{class:Me(["settings-tab",{active:w.value==="preprocess"}]),onClick:r[4]||(r[4]=_=>w.value="preprocess")}," å›¾ç‰‡é¢„å¤„ç† ",2),e("button",{class:Me(["settings-tab",{active:w.value==="advanced"}]),onClick:r[5]||(r[5]=_=>w.value="advanced")}," é«˜çº§è®¾ç½® ",2)]),se(e("div",Bv,[e("div",Ev,[r[42]||(r[42]=e("h4",{class:"group-title"},"Firecrawl é…ç½®",-1)),e("div",Pv,[r[41]||(r[41]=e("label",{class:"form-label"},"API Key",-1)),e("div",Av,[e("input",{type:J.value?"text":"password",class:"form-input",value:X(t).settings.firecrawl.apiKey,onInput:r[6]||(r[6]=_=>X(t).setFirecrawlApiKey(_.target.value)),placeholder:"fc-xxxxxxxxxxxxxxxx"},null,40,Fv),e("button",{class:"toggle-btn",onClick:r[7]||(r[7]=_=>J.value=!J.value)},le(J.value?"ğŸ‘":"ğŸ‘â€ğŸ—¨"),1),e("button",{class:"test-btn",disabled:O.value||!X(t).settings.firecrawl.apiKey,onClick:G},le(O.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,Lv)])])]),e("div",Uv,[r[49]||(r[49]=e("h4",{class:"group-title"},"AI Agent é…ç½®",-1)),e("div",Ov,[r[43]||(r[43]=e("label",{class:"form-label"},"æœåŠ¡å•†",-1)),e("select",{class:"form-select",value:X(t).settings.agent.provider,onChange:r[8]||(r[8]=_=>X(t).setAgentProvider(_.target.value))},[(L(!0),K(Ke,null,je(X(Wn),_=>(L(),K("option",{key:_.value,value:_.value},le(_.label),9,Nv))),128))],40,zv)]),e("div",Vv,[r[44]||(r[44]=e("label",{class:"form-label"},"API Key",-1)),e("div",Wv,[e("input",{type:R.value?"text":"password",class:"form-input",value:X(t).settings.agent.apiKey,onInput:r[9]||(r[9]=_=>X(t).setAgentApiKey(_.target.value)),placeholder:"sk-xxxxxxxxxxxxxxxx"},null,40,Kv),e("button",{class:"toggle-btn",onClick:r[10]||(r[10]=_=>R.value=!R.value)},le(R.value?"ğŸ‘":"ğŸ‘â€ğŸ—¨"),1)])]),U.value?(L(),K("div",qv,[r[45]||(r[45]=e("label",{class:"form-label"},"è‡ªå®šä¹‰ API åœ°å€",-1)),e("input",{type:"url",class:"form-input",value:X(t).settings.agent.customBaseUrl,onInput:r[11]||(r[11]=_=>X(t).setAgentBaseUrl(_.target.value)),placeholder:"https://api.example.com/v1"},null,40,Hv)])):ge("",!0),e("div",Jv,[r[46]||(r[46]=e("label",{class:"form-label"},"æ¨¡å‹åç§°",-1)),e("input",{type:"text",class:"form-input",value:X(t).settings.agent.modelName,onInput:r[12]||(r[12]=_=>X(t).setAgentModelName(_.target.value)),placeholder:"gpt-4o-mini"},null,40,jv)]),e("div",Yv,[e("label",Gv,[e("input",{type:"checkbox",checked:X(t).settings.agent.forceJsonOutput,onChange:r[13]||(r[13]=_=>X(t).setAgentForceJson(_.target.checked))},null,40,Xv),r[47]||(r[47]=Ce(" å¼ºåˆ¶ JSON æ ¼å¼ ",-1))]),e("label",Zv,[e("input",{type:"checkbox",checked:X(t).settings.agent.useStream,onChange:r[14]||(r[14]=_=>X(t).setAgentUseStream(_.target.checked))},null,40,Qv),r[48]||(r[48]=Ce(" æµå¼è°ƒç”¨ ",-1))])]),e("div",em,[e("button",{class:"test-btn full",disabled:Y.value||!X(t).settings.agent.apiKey,onClick:D},le(Y.value?"æµ‹è¯•ä¸­...":"æµ‹è¯• Agent è¿æ¥"),9,tm)])]),e("div",om,[e("h4",{class:"group-title"},[r[50]||(r[50]=Ce(" æå–è®¾ç½® ",-1)),e("button",{class:"reset-btn",onClick:m},"é‡ç½®ä¸ºé»˜è®¤")]),e("div",nm,[r[51]||(r[51]=e("label",{class:"form-label"},"æå–æç¤ºè¯",-1)),e("textarea",{class:"form-textarea",value:X(t).settings.extraction.prompt,onInput:r[15]||(r[15]=_=>X(t).setExtractionPrompt(_.target.value)),rows:"6",placeholder:"è¾“å…¥æå–æç¤ºè¯..."},null,40,sm)]),e("div",am,[r[52]||(r[52]=e("label",{class:"form-label"},"æœ€å¤§è¿­ä»£æ¬¡æ•°",-1)),e("input",{type:"number",class:"form-input small",value:X(t).settings.extraction.maxIterations,onInput:r[16]||(r[16]=_=>X(t).setExtractionMaxIterations(Number(_.target.value))),min:"1",max:"20"},null,40,lm)])]),e("div",im,[r[58]||(r[58]=e("h4",{class:"group-title"},"ä¸‹è½½è®¾ç½®",-1)),e("div",rm,[e("div",um,[r[53]||(r[53]=e("label",{class:"form-label"},"å¹¶å‘æ•°",-1)),e("input",{type:"number",class:"form-input small",value:X(t).settings.download.concurrency,onInput:r[17]||(r[17]=_=>X(t).setDownloadConcurrency(Number(_.target.value))),min:"1",max:"10"},null,40,cm)]),e("div",dm,[r[54]||(r[54]=e("label",{class:"form-label"},"è¶…æ—¶ (ç§’)",-1)),e("input",{type:"number",class:"form-input small",value:X(t).settings.download.timeout,onInput:r[18]||(r[18]=_=>X(t).setDownloadTimeout(Number(_.target.value))),min:"5",max:"120"},null,40,gm)]),e("div",pm,[r[55]||(r[55]=e("label",{class:"form-label"},"é‡è¯•æ¬¡æ•°",-1)),e("input",{type:"number",class:"form-input small",value:X(t).settings.download.retries,onInput:r[19]||(r[19]=_=>X(t).setDownloadRetries(Number(_.target.value))),min:"0",max:"5"},null,40,vm)]),e("div",mm,[r[56]||(r[56]=e("label",{class:"form-label"},"ä¸‹è½½é—´éš” (ms)",-1)),e("input",{type:"number",class:"form-input small",value:X(t).settings.download.delay,onInput:r[20]||(r[20]=_=>X(t).setDownloadDelay(Number(_.target.value))),min:"0",max:"2000",step:"100"},null,40,bm)])]),e("div",fm,[e("label",hm,[e("input",{type:"checkbox",checked:X(t).settings.download.useReferer,onChange:r[21]||(r[21]=_=>X(t).setDownloadUseReferer(_.target.checked))},null,40,ym),r[57]||(r[57]=Ce(" è‡ªåŠ¨æ·»åŠ  Referer ",-1))])])]),e("div",xm,[r[61]||(r[61]=e("h4",{class:"group-title"},"ç•Œé¢è®¾ç½®",-1)),e("div",km,[e("label",_m,[e("input",{type:"checkbox",checked:X(t).settings.ui.showAgentLogs,onChange:r[22]||(r[22]=_=>X(t).setShowAgentLogs(_.target.checked))},null,40,Sm),r[59]||(r[59]=Ce(" æ˜¾ç¤º AI å·¥ä½œæ—¥å¿— ",-1))]),e("label",Cm,[e("input",{type:"checkbox",checked:X(t).settings.ui.autoImport,onChange:r[23]||(r[23]=_=>X(t).setAutoImport(_.target.checked))},null,40,wm),r[60]||(r[60]=Ce(" æå–åè‡ªåŠ¨å¯¼å…¥ ",-1))])])])],512),[[Fe,w.value==="basic"]]),se(e("div",$m,[e("div",Im,[e("div",Tm,[e("label",Dm,[e("input",{type:"checkbox",checked:X(t).settings.imagePreprocess.enabled,onChange:r[24]||(r[24]=_=>X(t).setImagePreprocessEnabled(_.target.checked))},null,40,Rm),r[62]||(r[62]=Ce(" å¯ç”¨å›¾ç‰‡é¢„å¤„ç† ",-1))])]),X(t).settings.imagePreprocess.enabled?(L(),K(Ke,{key:0},[e("div",Mm,[e("label",Bm,[e("input",{type:"checkbox",checked:X(t).settings.imagePreprocess.autoRotate,onChange:r[25]||(r[25]=_=>X(t).setImageAutoRotate(_.target.checked))},null,40,Em),r[63]||(r[63]=Ce(" æ ¹æ® EXIF è‡ªåŠ¨æ—‹è½¬ ",-1))])]),r[71]||(r[71]=e("h5",{class:"subsection-title"},"å‹ç¼©è®¾ç½®",-1)),e("div",Pm,[e("label",Am,[e("input",{type:"checkbox",checked:X(t).settings.imagePreprocess.compression.enabled,onChange:r[26]||(r[26]=_=>X(t).setImageCompressionEnabled(_.target.checked))},null,40,Fm),r[64]||(r[64]=Ce(" å¯ç”¨å‹ç¼© ",-1))])]),X(t).settings.imagePreprocess.compression.enabled?(L(),K("div",Lm,[e("div",Um,[r[65]||(r[65]=e("label",{class:"form-label"},"è´¨é‡ (0-100)",-1)),e("input",{type:"number",class:"form-input small",value:X(t).settings.imagePreprocess.compression.quality,onInput:r[27]||(r[27]=_=>X(t).setImageCompressionQuality(Number(_.target.value))),min:"1",max:"100"},null,40,Om)]),e("div",zm,[r[66]||(r[66]=e("label",{class:"form-label"},"æœ€å¤§å®½åº¦ (0=ä¸é™)",-1)),e("input",{type:"number",class:"form-input small",value:X(t).settings.imagePreprocess.compression.maxWidth,onInput:r[28]||(r[28]=_=>X(t).setImageMaxWidth(Number(_.target.value))),min:"0"},null,40,Nm)]),e("div",Vm,[r[67]||(r[67]=e("label",{class:"form-label"},"æœ€å¤§é«˜åº¦ (0=ä¸é™)",-1)),e("input",{type:"number",class:"form-input small",value:X(t).settings.imagePreprocess.compression.maxHeight,onInput:r[29]||(r[29]=_=>X(t).setImageMaxHeight(Number(_.target.value))),min:"0"},null,40,Wm)])])):ge("",!0),r[72]||(r[72]=e("h5",{class:"subsection-title"},"æ ¼å¼è½¬æ¢",-1)),e("div",Km,[e("label",qm,[e("input",{type:"checkbox",checked:X(t).settings.imagePreprocess.formatConvert.enabled,onChange:r[30]||(r[30]=_=>X(t).setImageFormatConvertEnabled(_.target.checked))},null,40,Hm),r[68]||(r[68]=Ce(" å¯ç”¨æ ¼å¼è½¬æ¢ ",-1))])]),X(t).settings.imagePreprocess.formatConvert.enabled?(L(),K("div",Jm,[r[70]||(r[70]=e("label",{class:"form-label"},"ç›®æ ‡æ ¼å¼",-1)),e("select",{class:"form-select",value:X(t).settings.imagePreprocess.formatConvert.targetFormat,onChange:r[31]||(r[31]=_=>X(t).setImageTargetFormat(_.target.value))},[...r[69]||(r[69]=[e("option",{value:"original"},"ä¿æŒåŸæ ¼å¼",-1),e("option",{value:"jpeg"},"JPEG",-1),e("option",{value:"png"},"PNG",-1),e("option",{value:"webp"},"WebP",-1)])],40,jm)])):ge("",!0)],64)):ge("",!0)])],512),[[Fe,w.value==="preprocess"]]),se(e("div",Ym,[e("div",Gm,[r[76]||(r[76]=e("h4",{class:"group-title"},"è‡ªå®šä¹‰è¯·æ±‚å¤´",-1)),e("div",Xm,[r[73]||(r[73]=e("label",{class:"form-label"},"Cookie",-1)),e("input",{type:"text",class:"form-input",value:X(t).settings.advanced.customCookie,onInput:r[32]||(r[32]=_=>X(t).setCustomCookie(_.target.value)),placeholder:"name=value; name2=value2"},null,40,Zm)]),e("div",Qm,[r[74]||(r[74]=e("label",{class:"form-label"},"Headers (JSON)",-1)),e("textarea",{class:"form-textarea",value:X(t).settings.advanced.customHeaders,onInput:r[33]||(r[33]=_=>X(t).setCustomHeaders(_.target.value)),rows:"3",placeholder:'{"X-Custom-Header": "value"}'},null,40,eb)]),e("div",tb,[e("label",ob,[e("input",{type:"checkbox",checked:X(t).settings.advanced.bypassProxy,onChange:r[34]||(r[34]=_=>X(t).setBypassProxy(_.target.checked))},null,40,nb),r[75]||(r[75]=Ce(" ç»•è¿‡ç³»ç»Ÿä»£ç† (è¿æ¥æœ¬åœ°æœåŠ¡æ—¶ä½¿ç”¨) ",-1))])])])],512),[[Fe,w.value==="advanced"]])])):ge("",!0)]),q.value&&T.value.length>0?(L(),K("div",sb,[e("div",{class:"logs-header",onClick:r[35]||(r[35]=_=>l.value=!l.value)},[e("span",ab,le(l.value?"â–¼":"â–¶"),1),r[77]||(r[77]=e("span",null,"AI å·¥ä½œæ—¥å¿—",-1)),I.value==="extracting"?(L(),K("span",lb,"(æå–ä¸­...)")):ge("",!0)]),l.value?(L(),K("div",ib,[(L(!0),K(Ke,null,je(T.value,(_,re)=>(L(),K("div",{key:re,class:Me(["log-item",`log-${_.type}`])},[e("span",rb,"["+le(_.timestamp)+"]",1),e("span",ub,le(_.message),1)],2))),128))])):ge("",!0)])):ge("",!0),C.value?(L(),K("div",cb,[r[78]||(r[78]=e("span",{class:"error-icon"},"âŒ",-1)),e("span",db,le(C.value),1)])):ge("",!0),M.value?.success?(L(),K("div",gb,[e("div",pb,[e("span",vb," ğŸ“– ã€Š"+le(M.value.comicTitle)+"ã€‹- "+le(M.value.chapterTitle),1),e("span",mb,[e("span",bb,"å…± "+le(M.value.totalPages)+" å¼ ",1),H.value?(L(),K("span",fb,"| å¼•æ“: "+le(H.value),1)):ge("",!0)])]),e("div",hb,[e("label",yb,[e("input",{type:"checkbox",checked:V.value,onChange:W},null,40,xb),r[79]||(r[79]=Ce(" å…¨é€‰ ",-1))]),e("span",kb,"å·²é€‰: "+le(d.value)+" å¼ ",1)]),e("div",_b,[(L(!0),K(Ke,null,je(M.value.pages,_=>(L(),K("div",{key:_.pageNumber,class:Me(["image-item",{selected:g.value.has(_.pageNumber)}]),onClick:re=>h(_.pageNumber)},[e("div",Cb,[e("input",{type:"checkbox",checked:g.value.has(_.pageNumber),onClick:r[36]||(r[36]=Ze(()=>{},["stop"])),onChange:re=>h(_.pageNumber)},null,40,wb)]),e("div",$b,[e("img",{src:x(_.imageUrl),alt:`ç¬¬${_.pageNumber}é¡µ`,loading:"lazy"},null,8,Ib)]),e("div",Tb,"ç¬¬ "+le(_.pageNumber)+" é¡µ",1)],10,Sb))),128))])])):ge("",!0),I.value==="downloading"?(L(),K("div",Db,[e("div",Rb," ä¸‹è½½è¿›åº¦: "+le(y.value.current)+"/"+le(y.value.total),1),e("div",Mb,[e("div",{class:"progress-fill",style:st({width:`${v.value}%`})},null,4)])])):ge("",!0)]),e("div",Bb,[e("button",{class:"cancel-btn",onClick:a,disabled:I.value==="downloading"}," å–æ¶ˆ ",8,Eb),e("button",{class:"import-btn",disabled:!M.value?.success||d.value===0||E.value,onClick:A},[I.value==="downloading"?(L(),K("span",Ab)):(L(),K("span",Fb,"ğŸ“¥")),Ce(" "+le(I.value==="downloading"?"ä¸‹è½½ä¸­...":"å¯¼å…¥"),1)],8,Pb)])])])):ge("",!0)]))}}),Ub=qe(Lb,[["__scopeId","data-v-78fc5cb0"]]),Ob={class:"app-header"},zb={class:"header-content"},Nb={class:"logo-container"},Vb={class:"header-links"},Wb={class:"container"},Kb={id:"image-display-area"},qb={id:"upload-section",class:"card upload-card"},Hb={class:"upload-actions"},Jb={key:1,class:"bookshelf-mode-hint"},jb=He({__name:"TranslateView",setup(n){const t=Zo(),p=et(),o=Je(),l=nn(),c=dt(),{validateBeforeTranslation:s,initValidation:i}=Ft(),k=mo(),P=$l(),w=S(!1),O=S(void 0),Y=S(!1),J=S(!1),R=S(null),f=S(null),I=Q(()=>p.currentImage),T=Q(()=>p.hasImages);Q(()=>p.imageCount),Q(()=>p.currentImageIndex+1),Q(()=>T.value&&!p.isBatchTranslationInProgress),Q(()=>p.canGoPrevious),Q(()=>p.canGoNext);const M=Q(()=>p.isBatchTranslationInProgress);Q(()=>{if(!M.value)return 0;const ae=p.completedImageCount,Z=p.imageCount;return Z>0?Math.round(ae/Z*100):0}),Q(()=>`${p.completedImageCount}/${p.imageCount}`);const g=Q(()=>p.failedImageCount>0),d=Q(()=>!!t.query.book&&!!t.query.chapter),y=Q(()=>t.query.book),v=Q(()=>t.query.chapter),C=Q(()=>P.currentBookTitle.value),E=Q(()=>P.currentChapterTitle.value),q=Q(()=>d.value&&E.value&&C.value?`${E.value} - ${C.value}`:"Saber-Translator");ut(async()=>{p.clearImages(),c.clearBubbles(),await P.initializeApp(),i(),window.addEventListener("keydown",_e)}),Tt(()=>{window.removeEventListener("keydown",_e)}),ye(()=>[t.query.book,t.query.chapter],async([ae,Z],[z,ne])=>{ae&&Z?(p.clearImages(),c.clearBubbles(),await B()):z&&ne&&!ae&&!Z&&(p.clearImages(),c.clearBubbles(),await P.initializeBookChapterContext(),console.log("[TranslateView] ä»ä¹¦æ¶æ¨¡å¼åˆ‡æ¢åˆ°å¿«é€Ÿç¿»è¯‘æ¨¡å¼ï¼Œå·²æ¸…ç©ºæ•°æ®"))}),ye(q,ae=>{typeof document<"u"&&(document.title=ae)},{immediate:!0});async function B(){if(!(!y.value||!v.value))try{await P.initializeBookChapterContext()}catch(ae){console.error("åŠ è½½ç« èŠ‚ä¼šè¯å¤±è´¥:",ae),fe("åŠ è½½ç« èŠ‚ä¼šè¯å¤±è´¥","error")}}function H(ae){console.log(`ä¸Šä¼ å®Œæˆï¼Œå…± ${ae} å¼ å›¾ç‰‡`),p.hasImages&&(p.sortImagesByFileName(),P.switchImage(0))}async function V(ae){const Z=I.value;if(!Z||!Z.bubbleStates||Z.bubbleStates.length===0){fe("è¯·å…ˆé€‰æ‹©ä¸€å¼ å·²ç¿»è¯‘çš„å›¾ç‰‡","warning");return}if(p.images.length<=1){fe("åªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œæ— éœ€åº”ç”¨åˆ°å…¨éƒ¨","info");return}if(!Object.values(ae).some(ne=>ne)){fe("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè¦åº”ç”¨çš„è®¾ç½®é¡¹","warning");return}try{const ne=Z.bubbleStates[0],oe={};ae.fontSize&&(oe.fontSize=ne.fontSize),ae.fontFamily&&(oe.fontFamily=ne.fontFamily),ae.layoutDirection&&(oe.textDirection=ne.textDirection==="auto"?"vertical":ne.textDirection),ae.textColor&&(oe.textColor=ne.textColor),ae.fillColor&&(oe.fillColor=ne.fillColor),ae.strokeEnabled&&(oe.strokeEnabled=ne.strokeEnabled),ae.strokeColor&&(oe.strokeColor=ne.strokeColor),ae.strokeWidth&&(oe.strokeWidth=ne.strokeWidth);const ue=Ie=>{const Se={...Ie};return ae.fontSize&&oe.fontSize!==void 0&&(Se.fontSize=oe.fontSize),ae.fontFamily&&oe.fontFamily!==void 0&&(Se.fontFamily=oe.fontFamily),ae.layoutDirection&&oe.textDirection!==void 0&&(Se.textDirection=oe.textDirection),ae.textColor&&oe.textColor!==void 0&&(Se.textColor=oe.textColor),ae.fillColor&&oe.fillColor!==void 0&&(Se.fillColor=oe.fillColor),ae.strokeEnabled&&oe.strokeEnabled!==void 0&&(Se.strokeEnabled=oe.strokeEnabled),ae.strokeColor&&oe.strokeColor!==void 0&&(Se.strokeColor=oe.strokeColor),ae.strokeWidth&&oe.strokeWidth!==void 0&&(Se.strokeWidth=oe.strokeWidth),Se};let me=0;const xe=p.images;for(let Ie=0;Ie<xe.length;Ie++){const Se=xe[Ie];if(Se&&Se.bubbleStates&&Se.bubbleStates.length>0){const ze=Se.bubbleStates.map(ue);p.updateImageByIndex(Ie,{bubbleStates:ze}),me++}}if(c.bubbles.length>0){const Ie=c.bubbles.map(ue);c.setBubbles(Ie)}const be=[];ae.fontSize&&be.push("å­—å·"),ae.fontFamily&&be.push("å­—ä½“"),ae.layoutDirection&&be.push("æ’ç‰ˆæ–¹å‘"),ae.textColor&&be.push("æ–‡å­—é¢œè‰²"),ae.fillColor&&be.push("å¡«å……é¢œè‰²"),ae.strokeEnabled&&be.push("æè¾¹å¼€å…³"),ae.strokeColor&&be.push("æè¾¹é¢œè‰²"),ae.strokeWidth&&be.push("æè¾¹å®½åº¦");const pe=[];for(let Ie=0;Ie<xe.length;Ie++){const Se=xe[Ie];Se&&Se.translatedDataURL&&Se.bubbleStates&&Se.bubbleStates.length>0&&pe.push(Ie)}if(pe.length>0){const{apiClient:Ie}=await nt(async()=>{const{apiClient:Le}=await import("./client.Bht704G-.js");return{apiClient:Le}},__vite__mapDeps([4,5])),Se=o.settings.textStyle.layoutDirection,ze=Se==="auto";for(let Le=0;Le<pe.length;Le++){const De=pe[Le];if(De===void 0)continue;const Te=p.images[De];if(!(!Te||!Te.bubbleStates))try{let Ye="";if(Te.cleanImageData?Ye=Te.cleanImageData.includes("base64,")?Te.cleanImageData.split("base64,")[1]||"":Te.cleanImageData:Te.originalDataURL&&(Ye=Te.originalDataURL.includes("base64,")?Te.originalDataURL.split("base64,")[1]||"":Te.originalDataURL,console.log(`handleApplyToAll: å›¾ç‰‡ ${De} ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰`)),!Ye){console.log(`handleApplyToAll: å›¾ç‰‡ ${De} æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡`);continue}const lt=Te.bubbleStates.map(ke=>({translatedText:ke.translatedText||"",coords:ke.coords,fontSize:ke.fontSize||o.settings.textStyle.fontSize,fontFamily:ke.fontFamily||o.settings.textStyle.fontFamily,textDirection:_t(ke),textColor:ke.textColor||o.settings.textStyle.textColor,rotationAngle:ke.rotationAngle||0,position:ke.position||{x:0,y:0},strokeEnabled:ke.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:ke.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:ke.strokeWidth??o.settings.textStyle.strokeWidth})),it=await Ie.post("/api/re_render_image",{clean_image:Ye,bubble_texts:lt.map(ke=>ke.translatedText),bubble_coords:lt.map(ke=>ke.coords),fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:ze?"vertical":Se,textColor:o.settings.textStyle.textColor,bubble_states:lt,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});it.rendered_image&&p.updateImageByIndex(De,{translatedDataURL:`data:image/png;base64,${it.rendered_image}`,hasUnsavedChanges:!0})}catch(Ye){console.error(`é‡æ¸²æŸ“å›¾ç‰‡ ${De} å¤±è´¥:`,Ye)}}}fe(`å·²å°† ${be.join("ã€")} åº”ç”¨åˆ° ${me} å¼ å›¾ç‰‡`,"success"),console.log(`[TranslateView] åº”ç”¨è®¾ç½®åˆ°å…¨éƒ¨å®Œæˆï¼Œæ›´æ–°äº† ${me} å¼ å›¾ç‰‡ï¼Œé‡æ¸²æŸ“äº† ${pe.length} å¼ `)}catch(ne){console.error("åº”ç”¨è®¾ç½®åˆ°å…¨éƒ¨å¤±è´¥:",ne),fe("åº”ç”¨è®¾ç½®å¤±è´¥","error")}}async function x(){I.value&&s("normal")&&await k.translateCurrentImage()}async function b(){T.value&&s("normal")&&await k.translateAllImages()}async function $(){T.value&&s("hq")&&await k.executeHqTranslation()}async function a(){T.value&&s("proofread")&&await k.executeProofreading()}async function u(){I.value&&await k.removeTextOnly()}async function h(){T.value&&await k.removeAllTexts()}function W(){if(!I.value)return;const ae=I.value.fileName||`å›¾ç‰‡ ${p.currentImageIndex+1}`;confirm(`ç¡®å®šè¦åˆ é™¤å½“å‰å›¾ç‰‡ (${ae}) å—ï¼Ÿ`)&&(p.deleteCurrentImage(),fe("å›¾ç‰‡å·²åˆ é™¤","success"))}function A(){T.value&&confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å›¾ç‰‡å—ï¼Ÿè¿™å°†ä¸¢å¤±æ‰€æœ‰æœªä¿å­˜çš„è¿›åº¦ã€‚")&&(p.clearImages(),fe("æ‰€æœ‰å›¾ç‰‡å·²æ¸…é™¤","success"))}async function U(){try{const ae=await Qo(),Z=await ro();if(ae.success&&Z.success)fe("ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ","success");else{const z=[];ae.success||z.push("è°ƒè¯•æ–‡ä»¶æ¸…ç†å¤±è´¥"),Z.success||z.push("ä¸´æ—¶æ–‡ä»¶æ¸…ç†å¤±è´¥"),fe(z.join("ï¼Œ"),"warning")}}catch{fe("æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥","error")}}function G(){P.goToPrevious()}function D(){P.goToNext()}function m(){J.value=!J.value}async function N(){if(!g.value){fe("æ²¡æœ‰å¤±è´¥çš„å›¾ç‰‡éœ€è¦é‡æ–°ç¿»è¯‘","info");return}s("normal")&&await k.retryFailedImages()}async function r(){if(!T.value){fe("æ²¡æœ‰å¯ä¿å­˜çš„å†…å®¹","warning");return}if(!(!y.value||!v.value))try{await l.saveChapterSession(y.value,v.value)?fe("ç« èŠ‚è¿›åº¦å·²ä¿å­˜","success"):fe("ä¿å­˜å¤±è´¥","error")}catch(ae){console.error("ä¿å­˜ä¼šè¯å¤±è´¥:",ae),fe("ä¿å­˜å¤±è´¥: "+(ae instanceof Error?ae.message:"æœªçŸ¥é”™è¯¯"),"error")}}function _(ae){O.value=ae,w.value=!0}function re(){_("plugins")}function F(){fe("è®¾ç½®å·²ä¿å­˜","success")}function te(){Y.value=!0}function de(){fe("ğŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}function _e(ae){const Z=ae.target;if(!(Z instanceof HTMLInputElement||Z instanceof HTMLTextAreaElement||Z.getAttribute("contenteditable")==="true"||Z.id==="bubbleTextEditor")&&!J.value&&ae.altKey)switch(ae.key){case"ArrowLeft":ae.preventDefault(),G();break;case"ArrowRight":ae.preventDefault(),D();break;case"ArrowUp":if(ae.preventDefault(),!o.settings.textStyle.autoFontSize){const ne=o.settings.textStyle.fontSize;o.updateTextStyle({fontSize:ne+1})}break;case"ArrowDown":if(ae.preventDefault(),!o.settings.textStyle.autoFontSize){const ne=o.settings.textStyle.fontSize;o.updateTextStyle({fontSize:Math.max(10,ne-1)})}break}}async function $e(ae){const Z=I.value;if(!Z||!Z.translatedDataURL){console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${ae} (ä»…å½±å“ä¸‹æ¬¡ç¿»è¯‘)`);return}const z=Z.bubbleStates;if(!z||!Array.isArray(z)||z.length===0){console.log("å½“å‰å›¾ç‰‡æ²¡æœ‰ bubbleStatesï¼Œè·³è¿‡é‡æ¸²æŸ“");return}if(console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${ae}ï¼Œå°†é‡æ–°æ¸²æŸ“...`),ae){console.log("è‡ªåŠ¨å­—å·å·²å¼€å¯ï¼Œé‡æ–°è®¡ç®—å­—å·å¹¶æ¸²æŸ“...");try{const{apiClient:ne}=await nt(async()=>{const{apiClient:pe}=await import("./client.Bht704G-.js");return{apiClient:pe}},__vite__mapDeps([4,5]));let oe="";if(Z.cleanImageData){const pe=Z.cleanImageData;oe=pe.includes("base64,")?pe.split("base64,")[1]||"":pe}else Z.originalDataURL&&(oe=Z.originalDataURL.includes("base64,")?Z.originalDataURL.split("base64,")[1]||"":Z.originalDataURL);if(!oe){console.log("æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const ue=z.map(pe=>({translatedText:pe.translatedText||"",coords:pe.coords,fontSize:pe.fontSize||o.settings.textStyle.fontSize,fontFamily:pe.fontFamily||o.settings.textStyle.fontFamily,textDirection:_t(pe),textColor:pe.textColor||o.settings.textStyle.textColor,rotationAngle:pe.rotationAngle||0,position:pe.position||{x:0,y:0},strokeEnabled:pe.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:pe.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:pe.strokeWidth??o.settings.textStyle.strokeWidth})),me=ue.map(pe=>pe.translatedText),xe=ue.map(pe=>pe.coords),be=await ne.post("/api/re_render_image",{clean_image:oe,bubble_texts:me,bubble_coords:xe,fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:o.settings.textStyle.layoutDirection==="auto"?"vertical":o.settings.textStyle.layoutDirection,textColor:o.settings.textStyle.textColor,bubble_states:ue,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,autoFontSize:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});if(be.rendered_image){if(be.bubble_states&&Array.isArray(be.bubble_states)){const pe=z.map((Ie,Se)=>({...Ie,fontSize:be.bubble_states[Se]?.fontSize??Ie.fontSize}));p.updateCurrentImage({translatedDataURL:`data:image/png;base64,${be.rendered_image}`,bubbleStates:pe,hasUnsavedChanges:!0}),c.setBubbles(pe)}else p.updateCurrentImage({translatedDataURL:`data:image/png;base64,${be.rendered_image}`,hasUnsavedChanges:!0});console.log("è‡ªåŠ¨å­—å·æ¸²æŸ“æˆåŠŸ")}else be.error&&(console.error("è‡ªåŠ¨å­—å·æ¸²æŸ“å¤±è´¥:",be.error),fe("é‡æ–°æ¸²æŸ“å¤±è´¥: "+be.error,"error"))}catch(ne){console.error("è‡ªåŠ¨å­—å·æ¸²æŸ“å‡ºé”™:",ne)}}else{const ne=o.settings.textStyle.fontSize;console.log(`è‡ªåŠ¨å­—å·å·²å…³é—­ï¼Œä½¿ç”¨å›ºå®šå­—å· ${ne} æ¸²æŸ“...`);const oe=z.map(ue=>({...ue,fontSize:ne}));p.updateCurrentImage({bubbleStates:oe}),c.setBubbles(oe),await Pe("fontSize",ne)}}async function Pe(ae,Z){const z=I.value;if(!z||!z.translatedDataURL||!z.bubbleStates||z.bubbleStates.length===0||!["fontSize","fontFamily","layoutDirection","textColor","strokeEnabled","strokeColor","strokeWidth","fillColor"].includes(ae))return;console.log(`å…¨å±€è®¾ç½®å˜æ›´ (${ae}=${Z})ï¼Œå‡†å¤‡é‡æ¸²æŸ“...`);const ue={fontSize:"fontSize",fontFamily:"fontFamily",layoutDirection:"textDirection",textColor:"textColor",strokeEnabled:"strokeEnabled",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fillColor:"fillColor"}[ae];if(ue&&z.bubbleStates)if(ae==="layoutDirection"&&Z==="auto")console.log("æ’ç‰ˆæ–¹å‘è®¾ç½®ä¸º 'auto'ï¼Œä¸ä¿®æ”¹æ°”æ³¡çš„ textDirectionï¼Œä½¿ç”¨ autoTextDirection æ¸²æŸ“");else{const me=z.bubbleStates.map(xe=>({...xe,[ue]:Z}));p.updateCurrentImage({bubbleStates:me}),c.setBubbles(me)}try{const xe=p.currentImage?.bubbleStates||z.bubbleStates||[];if(xe.length===0||!xe[0]?.coords){console.log("æ²¡æœ‰æœ‰æ•ˆçš„æ°”æ³¡åæ ‡ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const be=o.settings.textStyle.layoutDirection,pe=xe.map(Te=>({translatedText:Te.translatedText||"",coords:Te.coords,fontSize:Te.fontSize||o.settings.textStyle.fontSize,fontFamily:Te.fontFamily||o.settings.textStyle.fontFamily,textDirection:_t(Te),textColor:Te.textColor||o.settings.textStyle.textColor,rotationAngle:Te.rotationAngle||0,position:Te.position||{x:0,y:0},strokeEnabled:Te.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:Te.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:Te.strokeWidth??o.settings.textStyle.strokeWidth})),Ie=pe.map(Te=>Te.translatedText),Se=pe.map(Te=>Te.coords);let ze="";if(z.cleanImageData){const Te=z.cleanImageData;ze=Te.includes("base64,")?Te.split("base64,")[1]||"":Te}else z.originalDataURL&&(ze=z.originalDataURL.includes("base64,")?z.originalDataURL.split("base64,")[1]||"":z.originalDataURL,console.log("handleTextStyleChanged: ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰"));if(!ze){console.log("æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const{apiClient:Le}=await nt(async()=>{const{apiClient:Te}=await import("./client.Bht704G-.js");return{apiClient:Te}},__vite__mapDeps([4,5])),De=await Le.post("/api/re_render_image",{clean_image:ze,bubble_texts:Ie,bubble_coords:Se,fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:be==="auto"?"vertical":be,textColor:o.settings.textStyle.textColor,bubble_states:pe,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});De.rendered_image?(p.updateCurrentImage({translatedDataURL:`data:image/png;base64,${De.rendered_image}`,hasUnsavedChanges:!0}),console.log("è®¾ç½®å˜æ›´åé‡æ–°æ¸²æŸ“æˆåŠŸ")):De.error&&console.error("é‡æ–°æ¸²æŸ“å¤±è´¥:",De.error)}catch(me){console.error("è®¾ç½®å˜æ›´åé‡æ–°æ¸²æŸ“å¤±è´¥:",me)}}function Be(ae){P.switchImage(ae)}return(ae,Z)=>{const z=jn("router-link");return L(),K("div",{class:Me(["translate-page",{"edit-mode-active":J.value}])},[e("header",Ob,[e("div",zb,[e("div",Nb,[he(z,{to:"/",title:"è¿”å›ä¹¦æ¶"},{default:ht(()=>[...Z[3]||(Z[3]=[e("img",{src:"/pic/logo.png",alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",Vb,[he(z,{to:"/",class:"back-to-shelf",title:"è¿”å›ä¹¦æ¶"},{default:ht(()=>[...Z[4]||(Z[4]=[Ce("ğŸ“š",-1)])]),_:1}),d.value?(L(),K("button",{key:0,class:"save-header-btn",title:"ä¿å­˜è¿›åº¦",onClick:r}," ğŸ’¾ ")):ge("",!0),e("button",{id:"openSettingsBtn",class:"settings-header-btn",title:"æ‰“å¼€è®¾ç½®",onClick:Z[0]||(Z[0]=ne=>_())},[...Z[5]||(Z[5]=[e("span",{class:"icon"},"âš™ï¸",-1),e("span",null,"è®¾ç½®",-1)])]),Z[8]||(Z[8]=e("a",{href:"http://www.mashirosaber.top",target:"_blank",class:"tutorial-link"},"ä½¿ç”¨æ•™ç¨‹",-1)),e("a",{href:"javascript:void(0)",class:"donate-link",onClick:te},[...Z[6]||(Z[6]=[e("span",null,"â¤ï¸ è¯·ä½œè€…å–å¥¶èŒ¶",-1)])]),Z[9]||(Z[9]=e("a",{href:"https://github.com/MashiroSaber03",target:"_blank",class:"github-link"},[e("img",{src:"/pic/github.jpg",alt:"GitHub",class:"github-icon"})],-1)),e("button",{class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:de},[...Z[7]||(Z[7]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("div",Wb,[he(Ua,{onTranslateCurrent:x,onTranslateAll:b,onHqTranslate:$,onProofread:a,onRemoveText:u,onRemoveAllText:h,onRetryFailed:N,onDeleteCurrent:W,onClearAll:A,onCleanTemp:U,onOpenPlugins:re,onOpenSettings:_,onPrevious:G,onNext:D,onApplyToAll:V,onTextStyleChanged:Pe,onAutoFontSizeChanged:$e}),e("main",Kb,[e("section",qb,[e("div",Hb,[he(Fs,{ref_key:"imageUploadRef",ref:R,onUploadComplete:H},null,512)]),X(l).loadingProgress.total>0?(L(),at(po,{key:0,visible:!0,percentage:X(l).loadingProgress.current/X(l).loadingProgress.total*100,label:X(l).loadingProgress.message},null,8,["percentage","label"])):ge("",!0),he(Bl,{progress:X(k).progress.value},null,8,["progress"]),M.value&&d.value?(L(),K("div",Jb,[...Z[10]||(Z[10]=[e("span",{style:{color:"#888","font-size":"0.85em"}}," ï¼ˆä¹¦æ¶æ¨¡å¼ä¸‹é€€å‡ºå‰è¯·ç‚¹å‡»é¡¶éƒ¨ä¿å­˜æŒ‰é’®ï¼‰ ",-1)])])):ge("",!0)]),he(il,{ref_key:"imageResultRef",ref:f,"is-edit-mode":J.value,onToggleEditMode:m,onRetryFailed:N},null,8,["is-edit-mode"])]),T.value&&!J.value?(L(),at(Kl,{key:0,onSelect:Be})):ge("",!0)]),I.value&&J.value?(L(),at(uv,{key:0,"is-edit-mode-active":J.value,onExit:m},null,8,["is-edit-mode-active"])):ge("",!0),he(gl,{onOpenSettings:_}),he(og,{modelValue:w.value,"onUpdate:modelValue":Z[1]||(Z[1]=ne=>w.value=ne),"initial-tab":O.value,onSave:F},null,8,["modelValue","initial-tab"]),Y.value?(L(),at(Pl,{key:1,onClose:Z[2]||(Z[2]=ne=>Y.value=!1)})):ge("",!0),he(Ub)],2)}}}),sf=qe(jb,[["__scopeId","data-v-34601989"]]);export{sf as default};
