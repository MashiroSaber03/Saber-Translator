import{d as Me,r as l,c as f}from"./vue-vendor.BToK7iAN.js";import{getBooks as Oe,getTags as Ee,createBook as Ke,updateBook as Le,deleteBook as j,createTag as _e,deleteTag as Qe,createChapter as be,updateChapter as je,deleteChapter as ze,reorderChapters as Re,addTagsToBook as qe,removeTagsFromBook as Ge}from"./bookshelf.C_zUWUVG.js";const Ne="/static/vue/pic/logo.png",Pe=Me("bookshelf",()=>{const s=l([]),d=l([]),v=l(""),c=l([]),g=l("updatedAt"),h=l("desc"),B=l(!1),a=l(new Set),u=l(null),k=l(null),w=l(!1),$=l(null),p=f(()=>{let e=[...s.value];if(v.value.trim()){const o=v.value.toLowerCase().trim();e=e.filter(t=>{const n=t.title.toLowerCase().includes(o),r=t.description?.toLowerCase().includes(o)||!1;return n||r})}return c.value.length>0&&(e=e.filter(o=>!o.tags||o.tags.length===0?!1:c.value.every(t=>o.tags?.includes(t)))),e.sort((o,t)=>{let n=0;switch(g.value){case"title":n=o.title.localeCompare(t.title);break;case"createdAt":n=new Date(o.createdAt).getTime()-new Date(t.createdAt).getTime();break;case"updatedAt":n=new Date(o.updatedAt).getTime()-new Date(t.updatedAt).getTime();break}return h.value==="asc"?n:-n}),e}),z=f(()=>s.value.length),R=f(()=>p.value.length),q=f(()=>a.value.size),x=f(()=>p.value.length===0?!1:p.value.every(e=>a.value.has(e.id))),G=f(()=>u.value&&s.value.find(e=>e.id===u.value)||null),H=f(()=>k.value&&s.value.find(e=>e.id===k.value)||null),J=f(()=>a.value),N=f(()=>v.value);function S(e){s.value=e,console.log(`书籍列表已设置，共 ${e.length} 本书`)}function F(e){s.value.unshift(e),console.log(`已添加书籍: ${e.title}`)}function D(e,o){const t=s.value.findIndex(n=>n.id===e);if(t>=0){const n=s.value[t];n&&(s.value[t]={...n,...o},console.log(`已更新书籍: ${e}`))}}function y(e){const o=s.value.findIndex(t=>t.id===e);o>=0&&(s.value.splice(o,1),a.value.delete(e),u.value===e&&(u.value=null),console.log(`已删除书籍: ${e}`))}function P(e){for(const o of e)y(o);console.log(`已批量删除 ${e.length} 本书`)}function U(e){return s.value.find(o=>o.id===e)||null}function M(e,o){const t=s.value.find(n=>n.id===e);t&&(t.chapters||(t.chapters=[]),t.chapters.push(o),console.log(`已添加章节到书籍 ${e}: ${o.title}`))}function O(e,o,t){const n=s.value.find(r=>r.id===e);if(n&&n.chapters){const r=n.chapters.find(i=>i.id===o);r&&(Object.assign(r,t),console.log(`已更新章节: ${o}`))}}function E(e,o){const t=s.value.find(n=>n.id===e);if(t&&t.chapters){const n=t.chapters.findIndex(r=>r.id===o);n>=0&&(t.chapters.splice(n,1),console.log(`已删除章节: ${o}`))}}function K(e,o){const t=s.value.find(n=>n.id===e);if(t&&t.chapters){const n=[];for(let r=0;r<o.length;r++){const i=t.chapters.find(De=>De.id===o[r]);i&&(i.order=r,n.push(i))}t.chapters=n,console.log(`已重新排序章节: ${e}`)}}function L(e){d.value=e,console.log(`标签列表已设置，共 ${e.length} 个标签`)}function _(e){d.value.push(e),console.log(`已添加标签: ${e.name}`)}function Q(e){const o=d.value.findIndex(t=>t.id===e);if(o>=0){d.value.splice(o,1);const t=c.value.indexOf(e);t>=0&&c.value.splice(t,1),console.log(`已删除标签: ${e}`)}}function m(e,o){const t=s.value.find(n=>n.id===e);t&&(t.tags||(t.tags=[]),t.tags.includes(o)||(t.tags.push(o),console.log(`已为书籍 ${e} 添加标签 ${o}`)))}function C(e,o){const t=s.value.find(n=>n.id===e);if(t&&t.tags){const n=t.tags.indexOf(o);n>=0&&(t.tags.splice(n,1),console.log(`已从书籍 ${e} 移除标签 ${o}`))}}function V(e,o){for(const t of e)for(const n of o)m(t,n);console.log(`已批量添加标签到 ${e.length} 本书`)}function W(e,o){for(const t of e)for(const n of o)C(t,n);console.log(`已批量从 ${e.length} 本书移除标签`)}function X(e){v.value=e}function Y(){v.value=""}function Z(e){const o=c.value.indexOf(e);o>=0?c.value.splice(o,1):c.value.push(e)}function I(e){c.value=e}function ee(){c.value=[]}function te(e,o="desc"){g.value=e,h.value=o}function oe(){B.value=!0,a.value.clear(),console.log("已进入批量操作模式")}function ne(){B.value=!1,a.value.clear(),console.log("已退出批量操作模式")}function re(e){a.value.has(e)?a.value.delete(e):a.value.add(e)}function se(){if(x.value)a.value.clear();else for(const e of p.value)a.value.add(e.id)}function ae(){return Array.from(a.value)}function le(e){u.value=e}function ce(){u.value=null}function ue(e){u.value===e?u.value=null:u.value=e}function A(e){w.value=e}function T(e){$.value=e}function ie(e){k.value=e}function fe(e){a.value.add(e)}function de(e){a.value.delete(e)}function ve(){a.value.clear()}function pe(e){v.value=e}async function b(){A(!0),T(null);try{const e=await Oe();e.success&&e.books?S(e.books):T(e.error||"加载书籍失败")}catch(e){T(e instanceof Error?e.message:"加载书籍失败"),console.error("加载书籍失败:",e)}finally{A(!1)}}async function ge(){try{const e=await Ee();e.success&&e.tags&&L(e.tags)}catch(e){console.error("加载标签失败:",e)}}async function he(e,o,t,n){try{const r=await Ke(e,o,t,n);return r.success&&r.book?(F(r.book),r.book):null}catch(r){return console.error("创建书籍失败:",r),null}}async function Be(e,o){try{const t=await Le(e,o);return t.success&&t.book?(D(e,t.book),!0):!1}catch(t){return console.error("更新书籍失败:",t),!1}}async function ke(e){try{return(await j(e)).success?(y(e),!0):!1}catch(o){return console.error("删除书籍失败:",o),!1}}async function ye(e){try{for(const o of e)await j(o),y(o);return!0}catch(o){return console.error("批量删除书籍失败:",o),!1}}async function Te(e,o){try{const t=await _e(e,o);return t.success&&t.tag?(_(t.tag),t.tag):null}catch(t){return console.error("创建标签失败:",t),null}}async function we(e){try{return(await Qe(e)).success?(Q(e),!0):!1}catch(o){return console.error("删除标签失败:",o),!1}}async function $e(e,o){try{const t=await be(e,o);return t.success&&t.chapter?(M(e,t.chapter),t.chapter):null}catch(t){return console.error("创建章节失败:",t),null}}async function me(e,o,t){try{return(await je(e,o,t)).success?(O(e,o,{title:t}),!0):!1}catch(n){return console.error("更新章节失败:",n),!1}}async function Ce(e,o){try{return(await ze(e,o)).success?(E(e,o),!0):!1}catch(t){return console.error("删除章节失败:",t),!1}}async function Ae(e,o){try{return(await Re(e,o)).success?(K(e,o),!0):!1}catch(t){return console.error("重新排序章节失败:",t),!1}}async function xe(e,o){try{if((await qe(e,o)).success){for(const n of o){const r=d.value.find(i=>i.id===n);r&&m(e,r.name)}return!0}return!1}catch(t){return console.error("添加标签失败:",t),!1}}async function Se(e,o){try{if((await Ge(e,o)).success){for(const n of o){const r=d.value.find(i=>i.id===n);r&&C(e,r.name)}return!0}return!1}catch(t){return console.error("移除标签失败:",t),!1}}function Fe(){s.value=[],d.value=[],v.value="",c.value=[],g.value="updatedAt",h.value="desc",B.value=!1,a.value.clear(),u.value=null,w.value=!1,$.value=null,console.log("书架状态已重置")}return{books:s,tags:d,searchKeyword:v,selectedTagIds:c,sortBy:g,sortOrder:h,batchMode:B,selectedBookIds:a,expandedBookId:u,currentBookId:k,isLoading:w,error:$,filteredBooks:p,bookCount:z,filteredBookCount:R,selectedBookCount:q,isAllSelected:x,expandedBook:G,currentBook:H,selectedBooks:J,searchQuery:N,setBooks:S,addBook:F,updateBook:D,deleteBook:y,deleteBooks:P,getBookById:U,addChapter:M,updateChapter:O,deleteChapter:E,reorderChapters:K,setTags:L,addTag:_,deleteTag:Q,addTagToBook:m,removeTagFromBook:C,batchAddTags:V,batchRemoveTags:W,setSearchKeyword:X,clearSearchKeyword:Y,setSearchQuery:pe,toggleTagFilter:Z,setTagFilter:I,clearTagFilter:ee,setSort:te,enterBatchMode:oe,exitBatchMode:ne,toggleBookSelection:re,toggleSelectAll:se,getSelectedBookIds:ae,selectBook:fe,deselectBook:de,clearSelection:ve,expandBook:le,collapseBook:ce,toggleBookExpand:ue,setCurrentBook:ie,setLoading:A,setError:T,loadBooks:b,fetchBooks:b,loadTags:ge,createBook:he,updateBookApi:Be,deleteBookApi:ke,batchDeleteBooks:ye,createTag:Te,deleteTagApi:we,createChapterApi:$e,updateChapterApi:me,deleteChapterApi:Ce,reorderChaptersApi:Ae,addTagsToBookApi:xe,removeTagsFromBookApi:Se,reset:Fe}});export{Ne as _,Pe as u};
