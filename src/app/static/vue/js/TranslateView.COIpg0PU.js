const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/system.CH8MZBkG.js","js/index.C6kBk5ff.js","js/vue-vendor.J6rApW3j.js","assets/index.BYanE9pL.css","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js","js/session.C_VZSWrV.js"])))=>i.map(i=>d[i]);
import{D as xn,b as ho,c as xo,d as yo,e as yn,f as xt,a as it,S as Go,_ as Je,g as Fe,s as _e,u as ct,h as Cs,i as Ss,j as ks,k as ws,l as $s,m as Ts,n as Xo,o as Zo,B as Qo,p as en,q as Is,F as po,r as tn,t as on,v as Ps,L as nn,W as Rs}from"./index.C6kBk5ff.js";import{d as Yt,r as w,c as G,a as Ye,e as A,h as ce,f as e,t as te,i as nt,k as B,g as ut,n as De,u as pe,o as dt,v as oe,x as Oe,l as Se,s as sn,m as St,K as Xe,D as K,F as ze,j as Ge,M as _o,N as Ds,L as _n,w as Ce,B as mt,O as $t,z as Re,p as st,P as fo,b as zt,Q as kt,S as an,U as Ms,A as Cn,V as Bs,T as Sn,C as Es}from"./vue-vendor.J6rApW3j.js";import{p as As,a as Ls,b as Fs,c as Us,d as Os,e as zs,f as Ns,h as Vs,i as Ws,j as Ks,k as Co,l as qs,m as kn}from"./system.CH8MZBkG.js";import{getFontList as wn,uploadFont as Hs,getTextboxPrompts as js,getPrompts as Js,configApi as je,getFontListApi as Ys}from"./config.CwRcCkM9.js";import{_ as We}from"./CustomSelect.vue_vue_type_style_index_0_lang.Dil26xem.js";import{apiClient as Ze}from"./client.Bht704G-.js";import{B as $n}from"./BaseModal.B3rFqKVm.js";import{getBookDetail as Gs}from"./bookshelf.B4ums9uK.js";import"./utils-vendor.B9ygI19o.js";function ln(){return{firecrawl:{apiKey:""},agent:{provider:"openai",apiKey:"",customBaseUrl:"",modelName:"gpt-4o-mini",useStream:!1,forceJsonOutput:!0,maxRetries:3,timeout:120},extraction:{prompt:xn,maxIterations:10},download:{concurrency:3,timeout:30,retries:3,delay:100,useReferer:!0},imagePreprocess:{enabled:!1,autoRotate:!0,compression:{enabled:!1,quality:85,maxWidth:0,maxHeight:0},formatConvert:{enabled:!1,targetFormat:"original"}},advanced:{customCookie:"",customHeaders:"",bypassProxy:!1},ui:{showAgentLogs:!0,autoImport:!1}}}function Xs(n,t){function s(h){n.value.firecrawl.apiKey=h,t()}function o(h){n.value.agent.provider=h,t()}function a(h){n.value.agent.apiKey=h,t()}function u(h){n.value.agent.customBaseUrl=h,t()}function l(h){n.value.agent.modelName=h,t()}function c(h){n.value.agent.useStream=h,t()}function g(h){n.value.agent.forceJsonOutput=h,t()}function d(h){n.value.agent.timeout=h,t()}function C(h){n.value.extraction.prompt=h,t()}function $(h){n.value.extraction.maxIterations=h,t()}function P(){n.value.extraction.prompt=xn,t()}function R(h){n.value.download.concurrency=h,t()}function _(h){n.value.download.timeout=h,t()}function D(h){n.value.download.retries=h,t()}function j(h){n.value.download.delay=h,t()}function z(h){n.value.download.useReferer=h,t()}function L(h){n.value.imagePreprocess.enabled=h,t()}function b(h){n.value.imagePreprocess.autoRotate=h,t()}function p(h){n.value.imagePreprocess.compression.enabled=h,t()}function T(h){n.value.imagePreprocess.compression.quality=h,t()}function k(h){n.value.imagePreprocess.compression.maxWidth=h,t()}function N(h){n.value.imagePreprocess.compression.maxHeight=h,t()}function O(h){n.value.imagePreprocess.formatConvert.enabled=h,t()}function ee(h){n.value.imagePreprocess.formatConvert.targetFormat=h,t()}function J(h){n.value.advanced.customCookie=h,t()}function ae(h){n.value.advanced.customHeaders=h,t()}function U(h){n.value.advanced.bypassProxy=h,t()}function Q(h){n.value.ui.showAgentLogs=h,t()}function ie(h){n.value.ui.autoImport=h,t()}function F(h){n.value={...n.value,...h},t()}return{setFirecrawlApiKey:s,setAgentProvider:o,setAgentApiKey:a,setAgentBaseUrl:u,setAgentModelName:l,setAgentUseStream:c,setAgentForceJson:g,setAgentTimeout:d,setExtractionPrompt:C,setExtractionMaxIterations:$,resetExtractionPrompt:P,setDownloadConcurrency:R,setDownloadTimeout:_,setDownloadRetries:D,setDownloadDelay:j,setDownloadUseReferer:z,setImagePreprocessEnabled:L,setImageAutoRotate:b,setImageCompressionEnabled:p,setImageCompressionQuality:T,setImageMaxWidth:k,setImageMaxHeight:N,setImageFormatConvertEnabled:O,setImageTargetFormat:ee,setCustomCookie:J,setCustomHeaders:ae,setBypassProxy:U,setShowAgentLogs:Q,setAutoImport:ie,updateWebImportSettings:F}}async function So(n){return Ze.post("/api/re_render_image",n)}async function At(n){try{return{success:!0,data:await Ze.post("/api/translate_single_text",n)}}catch(t){return{success:!1,error:t instanceof Error?t.message:"ç¿»è¯‘å¤±è´¥"}}}async function Lt(n){return Ze.post("/api/hq_translate_batch",n)}async function bo(n,t,s){return Ze.post("/api/detect_boxes",{image:n,detector_type:t,...s})}async function Tn(n,t,s,o){return Ze.post("/api/ocr_single_bubble",{image_data:n,bubble_coords:t,ocr_engine:s,...o})}async function ko(n,t,s){return Ze.post("/api/inpaint_single_bubble",{image_data:n,bubble_coords:t,bubble_angle:s?.bubbleAngle??0,method:s?.method??"lama",lama_model:s?.lamaModel??"lama_mpe",...s?.maskData&&{mask_data:s.maskData}})}const Zs=Object.freeze(Object.defineProperty({__proto__:null,detectBoxes:bo,hqTranslateBatch:Lt,inpaintSingleBubble:ko,ocrSingleBubble:Tn,reRenderImage:So,translateSingleText:At},Symbol.toStringTag,{value:"Module"}));async function In(n,t){return Ze.post(`/api/sessions/meta/${n}`,t)}async function jt(n,t,s,o){return Ze.post(`/api/sessions/page/${n}/${t}/${s}`,{data:o})}async function Pn(n,t,s){return Ze.post(`/api/sessions/page/${n}/${t}/meta`,s)}async function Rn(n,t,s){return Ze.post(`/api/sessions/save_translated/${n}/${t}`,s)}function Jt(n){if(!n||typeof n!="string"||n.startsWith("/api/"))return null;if(n.startsWith("data:")){const t=n.split(",");return t.length>1?t[1]??null:null}return n}async function Qs(n,t,s){const o=t.length;let a=0;for(let u=0;u<o;u++){const l=t[u];if(l){s?.onProgress?.(u+1,o);try{const c=Jt(l.originalDataURL);c&&await jt(n,u,"original",c);const g=Jt(l.translatedDataURL);g&&await jt(n,u,"translated",g);const d=Jt(l.cleanImageData);d&&await jt(n,u,"clean",d);const C={fileName:l.fileName,translationStatus:l.translationStatus,translationFailed:l.translationFailed,bubbleStates:l.bubbleStates,isManuallyAnnotated:l.isManuallyAnnotated,relativePath:l.relativePath,folderPath:l.folderPath,fontSize:l.fontSize,autoFontSize:l.autoFontSize,fontFamily:l.fontFamily,layoutDirection:l.layoutDirection,useAutoTextColor:l.useAutoTextColor,textColor:l.textColor,fillColor:l.fillColor,inpaintMethod:l.inpaintMethod,strokeEnabled:l.strokeEnabled,strokeColor:l.strokeColor,strokeWidth:l.strokeWidth};await Pn(n,u,C),a++}catch(c){console.error(`ä¿å­˜ç¬¬ ${u+1} é¡µå¤±è´¥:`,c)}}}return a}const Dn=Object.freeze(Object.defineProperty({__proto__:null,extractBase64:Jt,saveAllPagesSequentially:Qs,savePageImage:jt,savePageMeta:Pn,saveSessionMeta:In,saveTranslatedPage:Rn},Symbol.toStringTag,{value:"Module"}));async function ea(){return Ze.get("/api/plugins")}async function ta(n){const t=encodeURIComponent(n);return Ze.post(`/api/plugins/${t}/enable`)}async function oa(n){const t=encodeURIComponent(n);return Ze.post(`/api/plugins/${t}/disable`)}async function na(n){const t=encodeURIComponent(n);return Ze.delete(`/api/plugins/${t}`)}async function sa(n){const t=encodeURIComponent(n);return Ze.get(`/api/plugins/${t}/config_schema`)}async function aa(n){const t=encodeURIComponent(n);return Ze.get(`/api/plugins/${t}/config`)}async function la(n,t){const s=encodeURIComponent(n);return Ze.post(`/api/plugins/${s}/config`,t)}async function ia(){return Ze.get("/api/plugins/default_states")}async function ra(n,t){const s=encodeURIComponent(n);return Ze.post(`/api/plugins/${s}/set_default_state`,{enabled:t})}async function ua(){return{states:(await ia()).default_states}}const ca=ra,da=sa,ga=aa,pa=la;function ma(){return`img_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function rn(n,t,s){return{id:ma(),fileName:n,width:0,height:0,originalDataURL:t,translatedDataURL:null,cleanImageData:null,bubbleStates:null,translationStatus:"pending",translationFailed:!1,fontSize:25,autoFontSize:!1,fontFamily:xt,layoutDirection:"auto",textColor:"#000000",fillColor:yn,inpaintMethod:"solid",strokeEnabled:yo,strokeColor:xo,strokeWidth:ho,hasUnsavedChanges:!1,...s}}const Qe=Yt("image",()=>{const n=w([]),t=w(-1),s=w(!1),o=G(()=>t.value>=0&&t.value<n.value.length?n.value[t.value]??null:null),a=G(()=>n.value.length),u=G(()=>n.value.length>0),l=G(()=>t.value>0),c=G(()=>t.value<n.value.length-1),g=G(()=>n.value.filter(m=>m.translationFailed).length),d=G(()=>n.value.filter(m=>m.translationStatus==="completed").length),C=G(()=>n.value.filter(m=>m.translationStatus==="pending").length);function $(m,i,f){const v=rn(m,i,f);return n.value.push(v),n.value.length===1&&(t.value=0),console.log(`å›¾ç‰‡å·²æ·»åŠ : ${m}ï¼Œå½“å‰å…± ${n.value.length} å¼ å›¾ç‰‡`),v}function P(m){const i=m.map(({fileName:v,originalDataURL:y,overrides:I})=>rn(v,y,I)),f=n.value.length===0;return n.value.push(...i),f&&n.value.length>0&&(t.value=0),console.log(`æ‰¹é‡æ·»åŠ äº† ${i.length} å¼ å›¾ç‰‡ï¼Œå½“å‰å…± ${n.value.length} å¼ `),i}function R(m){n.value=m.map(i=>({...i,width:i.width||0,height:i.height||0,strokeEnabled:i.strokeEnabled??yo,strokeColor:i.strokeColor||xo,strokeWidth:i.strokeWidth??ho,hasUnsavedChanges:i.hasUnsavedChanges||!1})),n.value.length>0?t.value=Math.min(Math.max(0,t.value),n.value.length-1):t.value=-1,console.log(`å›¾ç‰‡æ•°ç»„å·²è®¾ç½®ï¼Œå…± ${n.value.length} å¼ å›¾ç‰‡`)}function _(m){return m<0||m>=n.value.length?(console.warn(`åˆ é™¤å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${m}`),!1):(n.value.splice(m,1),t.value===m?(t.value=Math.min(m,n.value.length-1),n.value.length===0&&(t.value=-1)):t.value>m&&t.value--,console.log(`å›¾ç‰‡å·²åˆ é™¤ï¼Œå½“å‰å…± ${n.value.length} å¼ å›¾ç‰‡`),!0)}function D(){return _(t.value)}function j(){n.value=[],t.value=-1,s.value=!1,console.log("æ‰€æœ‰å›¾ç‰‡å·²æ¸…é™¤")}function z(){const m=o.value?.id||null;if(n.value.sort((i,f)=>i.fileName.localeCompare(f.fileName,void 0,{numeric:!0,sensitivity:"base"})),m){const i=n.value.findIndex(f=>f.id===m);i>=0&&i!==t.value&&(console.log(`å›¾ç‰‡æ’åº: currentImageIndex ä» ${t.value} æ›´æ–°ä¸º ${i}`),t.value=i)}console.log("å›¾ç‰‡å·²æŒ‰æ–‡ä»¶åæ’åº")}function L(m){m>=-1&&m<n.value.length?(t.value=m,console.log(`å½“å‰å›¾ç‰‡ç´¢å¼•å·²è®¾ç½®ä¸º ${m}`)):console.warn(`è®¾ç½®ç´¢å¼•å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${m}`)}function b(){return l.value?(t.value--,!0):!1}function p(){return c.value?(t.value++,!0):!1}function T(m){o.value?(Object.assign(o.value,m),console.log("å½“å‰å›¾ç‰‡å±æ€§å·²æ›´æ–°:",Object.keys(m))):console.warn("æ›´æ–°å¤±è´¥: å½“å‰æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡")}function k(m,i){if(m>=0&&m<n.value.length){const f=n.value[m];f&&(Object.assign(f,i),console.log(`å›¾ç‰‡ ${m} å±æ€§å·²æ›´æ–°:`,Object.keys(i)))}else console.warn(`æ›´æ–°å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${m}`)}function N(m){o.value&&(o.value.bubbleStates=m,o.value.hasUnsavedChanges=!0,console.log(`å½“å‰å›¾ç‰‡æ°”æ³¡çŠ¶æ€å·²æ›´æ–°ï¼Œå…± ${m?.length??0} ä¸ªæ°”æ³¡`))}function O(m){o.value&&(o.value.isManuallyAnnotated=m,o.value.hasUnsavedChanges=!0,console.log(`æ‰‹åŠ¨æ ‡æ³¨æ ‡è®°å·²è®¾ç½®ä¸º: ${m}`))}function ee(m,i){o.value?(o.value[m]=i,o.value.hasUnsavedChanges=!0,console.log(`å½“å‰å›¾ç‰‡å±æ€§ ${String(m)} å·²æ›´æ–°`)):console.warn("æ›´æ–°å¤±è´¥: å½“å‰æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡")}function J(m,i){o.value&&(o.value.translatedDataURL=m,i&&(o.value.cleanImageData=i),o.value.translationStatus="completed",o.value.translationFailed=!1,o.value.hasUnsavedChanges=!0,console.log("å½“å‰å›¾ç‰‡ç¿»è¯‘ç»“æœå·²æ›´æ–°"))}function ae(m,i){o.value&&(o.value.width=m,o.value.height=i,console.log(`å½“å‰å›¾ç‰‡å°ºå¯¸å·²æ›´æ–°: ${m} x ${i}`))}function U(m,i,f){if(m>=0&&m<n.value.length){const v=n.value[m];v&&(v.translationStatus=i,v.translationFailed=i==="failed",f&&(v.errorMessage=f),console.log(`å›¾ç‰‡ ${m} ç¿»è¯‘çŠ¶æ€: ${i}`))}}function Q(m){o.value&&(o.value.translationStatus="failed",o.value.translationFailed=!0,o.value.errorMessage=m,console.log(`å½“å‰å›¾ç‰‡ç¿»è¯‘å¤±è´¥: ${m}`))}function ie(){n.value.forEach(m=>{m.translationStatus="pending",m.translationFailed=!1,m.errorMessage=void 0}),console.log("æ‰€æœ‰å›¾ç‰‡ç¿»è¯‘çŠ¶æ€å·²é‡ç½®")}function F(m){s.value=m,console.log(`æ‰¹é‡ç¿»è¯‘çŠ¶æ€: ${m?"è¿›è¡Œä¸­":"å·²å®Œæˆ"}`)}function h(){return n.value.map((m,i)=>m.translationFailed?i:-1).filter(m=>m!==-1)}return{images:n,currentImageIndex:t,isBatchTranslationInProgress:s,currentImage:o,imageCount:a,hasImages:u,canGoPrevious:l,canGoNext:c,failedImageCount:g,completedImageCount:d,pendingImageCount:C,addImage:$,addImages:P,setImages:R,deleteImage:_,deleteCurrentImage:D,clearImages:j,sortImagesByFileName:z,setCurrentImageIndex:L,goToPrevious:b,goToNext:p,updateCurrentImage:T,updateImageByIndex:k,updateCurrentBubbleStates:N,setManuallyAnnotated:O,updateCurrentImageProperty:ee,updateCurrentTranslationResult:J,updateCurrentImageDimensions:ae,setTranslationStatus:U,markCurrentAsFailed:Q,resetAllTranslationStatus:ie,setBatchTranslationInProgress:F,getFailedImageIndices:h}}),un=Object.freeze(Object.defineProperty({__proto__:null,useImageStore:Qe},Symbol.toStringTag,{value:"Module"})),It=Yt("session",()=>{const n=w(null),t=w({bookId:null,chapterId:null,bookTitle:null,chapterTitle:null}),s=w([]),o=w(!1),a=w({current:0,total:0,message:""}),u=w(null),l=w(!1),c=G(()=>t.value.bookId!==null&&t.value.chapterId!==null),g=G(()=>t.value.bookId),d=G(()=>t.value.chapterId);function C(U,Q,ie=null,F=null){t.value={bookId:U,chapterId:Q,bookTitle:ie,chapterTitle:F},console.log(`ä¼šè¯ä¸Šä¸‹æ–‡å·²è®¾ç½®: ä¹¦ç±=${U}, ç« èŠ‚=${Q}`)}function $(U,Q,ie,F){C(U,Q,ie,F)}function P(){t.value={bookId:null,chapterId:null,bookTitle:null,chapterTitle:null},console.log("ä¼šè¯ä¸Šä¸‹æ–‡å·²æ¸…é™¤")}function R(U){const Q=U.get("book"),ie=U.get("chapter");Q&&ie&&C(Q,ie)}function _(U){n.value=U,console.log(`å½“å‰ä¼šè¯åç§°: ${U}`)}function D(){n.value=null}function j(U){s.value=U,console.log(`ä¼šè¯åˆ—è¡¨å·²æ›´æ–°ï¼Œå…± ${U.length} ä¸ªä¼šè¯`)}function z(U){const Q=s.value.findIndex(ie=>ie.name===U.name);Q>=0?s.value[Q]=U:s.value.unshift(U)}function L(U){const Q=s.value.findIndex(ie=>ie.name===U);Q>=0&&s.value.splice(Q,1)}function b(U,Q){const ie=s.value.find(F=>F.name===U);ie&&(ie.name=Q)}function p(U){o.value=U}function T(U){l.value=U}function k(U){u.value=U}function N(){n.value=null,t.value={bookId:null,chapterId:null,bookTitle:null,chapterTitle:null},s.value=[],o.value=!1,l.value=!1,u.value=null,console.log("ä¼šè¯çŠ¶æ€å·²é‡ç½®")}async function O(U){if(!U||typeof U!="string")return null;if(U.startsWith("data:"))return U;if(!U.startsWith("/api/"))return null;try{const Q=await fetch(U);if(!Q.ok)return null;const ie=await Q.blob();return new Promise(F=>{const h=new FileReader;h.onloadend=()=>F(h.result),h.onerror=()=>F(null),h.readAsDataURL(ie)})}catch(Q){return console.error(`è½¬æ¢å›¾ç‰‡ URL å¤±è´¥: ${U}`,Q),null}}async function ee(U,Q){const ie=U.length;for(let F=0;F<ie;F++){const h=U[F];if(h){if(Q&&Q(F+1,ie),h.originalDataURL&&h.originalDataURL.startsWith("/api/")){const m=await O(h.originalDataURL);m&&(h.originalDataURL=m)}if(h.translatedDataURL&&h.translatedDataURL.startsWith("/api/")){const m=await O(h.translatedDataURL);m&&(h.translatedDataURL=m)}if(h.cleanImageData&&h.cleanImageData.startsWith("/api/")){const m=await O(h.cleanImageData);m&&(h.cleanImageData=m.replace(/^data:image\/\w+;base64,/,""))}}}}async function J(U){p(!0),k(null),a.value={current:0,total:0,message:"æ­£åœ¨åŠ è½½..."};try{const{useImageStore:Q}=await it(async()=>{const{useImageStore:E}=await Promise.resolve().then(()=>un);return{useImageStore:E}},void 0),{useSettingsStore:ie}=await it(async()=>{const{useSettingsStore:E}=await import("./system.CH8MZBkG.js").then(H=>H.s);return{useSettingsStore:E}},__vite__mapDeps([0,1,2,3,4,5])),{useBubbleStore:F}=await it(async()=>{const{useBubbleStore:E}=await Promise.resolve().then(()=>ki);return{useBubbleStore:E}},void 0),h=Q(),m=ie(),i=F(),{loadSessionByPathApi:f}=await it(async()=>{const{loadSessionByPathApi:E}=await import("./session.C_VZSWrV.js");return{loadSessionByPathApi:E}},__vite__mapDeps([6,4,5])),v=await f(U);if(!v.success||!v.session)throw new Error(v.error||"åŠ è½½ä¼šè¯å¤±è´¥");const y=v.session;if(y.images&&y.images.length>0){const E=y.images.map((r,x)=>({id:`session-${x}-${Date.now()}`,originalDataURL:r.originalDataURL,translatedDataURL:r.translatedDataURL||null,cleanImageData:r.cleanImageData||null,bubbleStates:r.bubbleStates!==void 0&&r.bubbleStates!==null?r.bubbleStates:null,isManuallyAnnotated:!!r.isManuallyAnnotated,relativePath:r.relativePath||void 0,folderPath:r.folderPath||void 0,fileName:r.fileName||`image-${x+1}.png`,translationStatus:r.translationStatus||"pending",translationFailed:!!r.translationFailed,hasUnsavedChanges:!1,fontSize:r.fontSize||24,autoFontSize:r.autoFontSize??!1,fontFamily:r.fontFamily||"Microsoft YaHei",layoutDirection:r.layoutDirection||"auto",useAutoTextColor:r.useAutoTextColor??void 0,textColor:r.textColor||"#000000",fillColor:r.fillColor||"#FFFFFF",inpaintMethod:r.inpaintMethod||"litelama",strokeEnabled:r.strokeEnabled??!1,strokeColor:r.strokeColor||"#FFFFFF",strokeWidth:r.strokeWidth||2}));E.length>0&&(console.log("æ­£åœ¨åŠ è½½å›¾ç‰‡..."),a.value={current:0,total:E.length,message:"æ­£åœ¨åŠ è½½å›¾ç‰‡..."},await ee(E,(r,x)=>{const ne=r/x*100;a.value={current:r,total:x,message:`åŠ è½½å›¾ç‰‡ ${r}/${x}...`},console.log(`åŠ è½½å›¾ç‰‡ ${r}/${x}... (${ne.toFixed(0)}%)`)}),a.value={current:E.length,total:E.length,message:"åŠ è½½å®Œæˆ"},console.log("å›¾ç‰‡åŠ è½½å®Œæˆï¼Œå·²è½¬æ¢ä¸º Base64"),setTimeout(()=>{a.value={current:0,total:0,message:""}},500)),h.setImages(E);let H=0;typeof y.currentImageIndex=="number"&&(H=y.currentImageIndex,(H>=E.length||H<0)&&(H=E.length>0?0:-1)),h.setCurrentImageIndex(H);const X=E[H];X&&X.bubbleStates&&X.bubbleStates.length>0?i.setBubbles(X.bubbleStates,!0):i.clearBubblesLocal(),console.log(`æŒ‰è·¯å¾„åŠ è½½ä¼šè¯æˆåŠŸ: ${U}, å…± ${E.length} å¼ å›¾ç‰‡`)}const I=y.ui_settings;if(I){(I.targetLanguage||I.sourceLanguage)&&m.updateSettings({targetLanguage:I.targetLanguage||void 0,sourceLanguage:I.sourceLanguage||void 0});const E=I.useInpaintingMethod,X=["solid","lama_mpe","litelama"].includes(E)?E:m.settings.textStyle.inpaintMethod;m.updateTextStyle({fontSize:I.fontSize||m.settings.textStyle.fontSize,autoFontSize:I.autoFontSize??m.settings.textStyle.autoFontSize,fontFamily:I.fontFamily||m.settings.textStyle.fontFamily,layoutDirection:I.layoutDirection||m.settings.textStyle.layoutDirection,textColor:I.textColor||m.settings.textStyle.textColor,fillColor:I.fillColor||m.settings.textStyle.fillColor,inpaintMethod:X,strokeEnabled:I.strokeEnabled??m.settings.textStyle.strokeEnabled,strokeColor:I.strokeColor||m.settings.textStyle.strokeColor,strokeWidth:I.strokeWidth||m.settings.textStyle.strokeWidth,useAutoTextColor:I.useAutoTextColor??m.settings.textStyle.useAutoTextColor}),console.log("UI è®¾ç½®å·²æ¢å¤")}return _(U),!0}catch(Q){const ie=Q instanceof Error?Q.message:"åŠ è½½ä¼šè¯å¤±è´¥";throw k(ie),console.error(`æŒ‰è·¯å¾„åŠ è½½ä¼šè¯å¤±è´¥: ${U}`,Q),Q}finally{p(!1)}}async function ae(U,Q){if(!U||!Q)return console.log("æœªåœ¨ä¹¦ç±/ç« èŠ‚æ¨¡å¼ï¼Œä¸æ”¯æŒä¿å­˜"),!1;console.log(`ä¿å­˜ç« èŠ‚ä¼šè¯: book=${U}, chapter=${Q}`);const{useImageStore:ie}=await it(async()=>{const{useImageStore:y}=await Promise.resolve().then(()=>un);return{useImageStore:y}},void 0),{useSettingsStore:F}=await it(async()=>{const{useSettingsStore:y}=await import("./system.CH8MZBkG.js").then(I=>I.s);return{useSettingsStore:y}},__vite__mapDeps([0,1,2,3,4,5])),h=ie(),m=F(),i=Array.isArray(h.images)?h.images:[];if(!i||i.length===0)return console.log("æ²¡æœ‰å›¾ç‰‡æ•°æ®å¯ä¿å­˜"),!1;const f=`bookshelf/${U}/${Q}`;T(!0),k(null);const v=i.length;a.value={current:0,total:v,message:`å‡†å¤‡ä¿å­˜ ${v} å¼ å›¾ç‰‡...`};try{i.some(x=>x.originalDataURL&&x.originalDataURL.startsWith("/api/")||x.translatedDataURL&&x.translatedDataURL.startsWith("/api/")||x.cleanImageData&&x.cleanImageData.startsWith("/api/"))&&(console.log("[saveChapterSession] æ£€æµ‹åˆ° /api/ URL æ ¼å¼å›¾ç‰‡ï¼Œå¼€å§‹è½¬æ¢ä¸º Base64..."),a.value={current:0,total:v,message:"è½¬æ¢å›¾ç‰‡æ ¼å¼..."},await ee(i,(x,ne)=>{a.value={current:0,total:v,message:`è½¬æ¢å›¾ç‰‡ ${x}/${ne}...`}}),console.log("[saveChapterSession] å›¾ç‰‡æ ¼å¼è½¬æ¢å®Œæˆ"));const{textStyle:I}=m.settings,E={fontSize:I.fontSize,autoFontSize:I.autoFontSize,fontFamily:I.fontFamily,layoutDirection:I.layoutDirection,textColor:I.textColor,useInpaintingMethod:I.inpaintMethod,fillColor:I.fillColor,strokeEnabled:I.strokeEnabled,strokeColor:I.strokeColor,strokeWidth:I.strokeWidth,useAutoTextColor:I.useAutoTextColor},{saveAllPagesSequentially:H,saveSessionMeta:X}=await it(async()=>{const{saveAllPagesSequentially:x,saveSessionMeta:ne}=await Promise.resolve().then(()=>Dn);return{saveAllPagesSequentially:x,saveSessionMeta:ne}},void 0),r=await H(f,i,{onProgress:(x,ne)=>{a.value={current:x,total:ne,message:`ä¿å­˜å›¾ç‰‡ ${x}/${ne}...`}}});a.value={current:v,total:v,message:"å®Œæˆä¿å­˜..."},await X(f,{ui_settings:E,total_pages:v,currentImageIndex:h.currentImageIndex}),console.log(`ç« èŠ‚ä¿å­˜å®Œæˆ: ${r}/${v} å¼ å›¾ç‰‡`);try{const{apiClient:x}=await it(async()=>{const{apiClient:ne}=await import("./client.Bht704G-.js");return{apiClient:ne}},__vite__mapDeps([4,5]));await x.put(`/api/bookshelf/books/${U}/chapters/${Q}/image-count`,{count:v})}catch(x){console.warn("æ›´æ–°ç« èŠ‚å›¾ç‰‡æ•°é‡å¤±è´¥ï¼ˆéè‡´å‘½ï¼‰:",x)}return a.value={current:v,total:v,message:"ä¿å­˜å®Œæˆ"},setTimeout(()=>{a.value={current:0,total:0,message:""}},1e3),!0}catch(y){const I=y instanceof Error?y.message:"ä¿å­˜ç« èŠ‚ä¼šè¯å¤±è´¥";return k(I),console.error("ä¿å­˜å¤±è´¥:",y),a.value={current:0,total:0,message:""},!1}finally{T(!1)}}return{currentSessionName:n,context:t,sessionList:s,isLoading:o,isSaving:l,error:u,loadingProgress:a,isBookshelfMode:c,currentBookId:g,currentChapterId:d,setContext:C,clearContext:P,parseContextFromUrl:R,setSessionName:_,clearSessionName:D,setSessionList:j,addToSessionList:z,removeFromSessionList:L,renameInSessionList:b,setLoading:p,setSaving:T,setError:k,imageUrlToBase64:O,saveChapterSession:ae,loadSessionByPath:J,setBookChapterContext:$,reset:N}}),Nt={originalText:"",translatedText:"",textboxText:"",coords:[0,0,100,100],polygon:[],fontSize:25,fontFamily:xt,textDirection:"vertical",autoTextDirection:"vertical",textColor:"#000000",fillColor:yn,rotationAngle:0,position:{x:0,y:0},strokeEnabled:yo,strokeColor:xo,strokeWidth:ho,inpaintMethod:"solid",autoFgColor:null,autoBgColor:null,colorConfidence:0};function va(n){return{...{...Nt,...n},coords:n?.coords?[...n.coords]:[...Nt.coords],polygon:n?.polygon?n.polygon.map(s=>[...s]):[],position:n?.position?{...Nt.position,...n.position}:{...Nt.position}}}function fa(n){const[t,s,o,a]=n,u=Math.abs(o-t);return Math.abs(a-s)>u?"vertical":"horizontal"}function Vt(n){return n.map(t=>({...t,coords:[...t.coords],polygon:t.polygon?t.polygon.map(s=>[...s]):[],position:{...t.position},autoFgColor:t.autoFgColor?[...t.autoFgColor]:null,autoBgColor:t.autoBgColor?[...t.autoBgColor]:null}))}function ba(n){if(!n||typeof n!="object")return!1;const t=n;if(!Array.isArray(t.coords)||t.coords.length!==4||!t.coords.every(a=>typeof a=="number"&&!isNaN(a))||typeof t.fontSize!="number"||t.fontSize<=0)return!1;const s=["vertical","horizontal","auto"];if(typeof t.textDirection!="string"||!s.includes(t.textDirection))return!1;const o=["solid","lama_mpe","litelama"];return!(typeof t.inpaintMethod!="string"||!o.includes(t.inpaintMethod))}function ha(n){let t=n,s=0,o=0,a=Date.now();const u=()=>t<=0?0:Math.ceil(6e4/t);return{async acquire(){if(t<=0)return;const l=Date.now(),c=u();if(l-a>=6e4&&(a=l,o=0),o>=t){const d=6e4-(l-a);d>0&&await cn(d),a=Date.now(),o=0}const g=l-s;g<c&&await cn(c-g),s=Date.now(),o++},reset(){s=0,o=0,a=Date.now()},getRpm(){return t},setRpm(l){t=l,this.reset()}}}function cn(n){return new Promise(t=>setTimeout(t,n))}function dn(n){const t=n.replace(/\\/g,"/"),s=[],o=/(\d+)/g;let a=0,u;for(;(u=o.exec(t))!==null;){if(u.index>a){const l=t.slice(a,u.index);l&&s.push([!0,l.toLowerCase()])}s.push([!1,parseInt(u[0],10)]),a=o.lastIndex}if(a<t.length){const l=t.slice(a);l&&s.push([!0,l.toLowerCase()])}return s}function xa(n,t){const s=dn(n),o=dn(t),a=Math.min(s.length,o.length);for(let u=0;u<a;u++){const[l,c]=s[u],[g,d]=o[u];if(l!==g)return l?1:-1;if(c<d)return-1;if(c>d)return 1}return s.length-o.length}function ya(n,t=s=>String(s)){return[...n].sort((s,o)=>xa(t(s),t(o)))}const gn="webImportDisclaimerAccepted",wo=Yt("webImport",()=>{const n=w(ln()),t=w("idle"),s=w(""),o=w([]),a=w(null),u=w(new Set),l=w({current:0,total:0}),c=w([]),g=w(null),d=w(!1),C=w(!1),$=w(!1),P=G(()=>t.value==="extracting"),R=G(()=>t.value==="downloading"),_=G(()=>P.value||R.value),D=G(()=>u.value.size),j=G(()=>l.value.total===0?0:Math.round(l.value.current/l.value.total*100));function z(){try{localStorage.setItem(Go,JSON.stringify(n.value))}catch(I){console.error("ä¿å­˜ç½‘é¡µå¯¼å…¥è®¾ç½®å¤±è´¥:",I)}}function L(){try{const I=localStorage.getItem(Go);if(I){const E=JSON.parse(I);n.value=b(ln(),E)}}catch(I){console.error("åŠ è½½ç½‘é¡µå¯¼å…¥è®¾ç½®å¤±è´¥:",I)}}function b(I,E){const H={...I};for(const X in E)if(Object.prototype.hasOwnProperty.call(E,X)){const r=E[X],x=I[X];r!==null&&typeof r=="object"&&!Array.isArray(r)&&x!==null&&typeof x=="object"&&!Array.isArray(x)?H[X]=b(x,r):r!==void 0&&(H[X]=r)}return H}function p(){C.value?d.value=!0:$.value=!0}function T(){C.value=!0,$.value=!1,d.value=!0;try{localStorage.setItem(gn,"true")}catch(I){console.error("ä¿å­˜å…è´£å£°æ˜çŠ¶æ€å¤±è´¥:",I)}}function k(){$.value=!1}function N(){try{const I=localStorage.getItem(gn);C.value=I==="true"}catch(I){console.error("åŠ è½½å…è´£å£°æ˜çŠ¶æ€å¤±è´¥:",I)}}function O(){d.value=!1}function ee(){t.value="idle",s.value="",o.value=[],a.value=null,u.value=new Set,l.value={current:0,total:0},c.value=[],g.value=null}function J(I){s.value=I}function ae(I){o.value.push(I)}function U(){o.value=[]}function Q(I){a.value&&a.value.pages.length>0?(a.value.comicTitle=I.comicTitle,a.value.chapterTitle=I.chapterTitle,a.value.totalPages=I.totalPages,a.value.sourceUrl=I.sourceUrl,a.value.referer=I.referer,a.value.engine=I.engine,a.value.success=I.success,a.value.error=I.error):(a.value=I,I.success&&I.pages&&(u.value=new Set(I.pages.map(E=>E.pageNumber))))}function ie(I){u.value.has(I)?u.value.delete(I):u.value.add(I),u.value=new Set(u.value)}function F(){a.value?.pages&&(u.value.size===a.value.pages.length?u.value=new Set:u.value=new Set(a.value.pages.map(I=>I.pageNumber)))}function h(I){t.value=I}function m(I){g.value=I,I&&(t.value="error")}function i(I,E){l.value={current:I,total:E}}function f(I){c.value=I}function v(I){a.value||(a.value={success:!0,comicTitle:"",chapterTitle:"",pages:[],totalPages:0,sourceUrl:s.value,referer:"",engine:"gallery-dl"}),a.value.pages.push(I),a.value.totalPages=a.value.pages.length,u.value.add(I.pageNumber),u.value=new Set(u.value)}const y=Xs(n,z);return L(),N(),{settings:n,status:t,url:s,logs:o,extractResult:a,selectedPages:u,downloadProgress:l,downloadedImages:c,error:g,modalVisible:d,disclaimerAccepted:C,disclaimerVisible:$,isExtracting:P,isDownloading:R,isProcessing:_,selectedCount:D,downloadProgressPercent:j,saveToStorage:z,loadFromStorage:L,openModal:p,closeModal:O,resetState:ee,setUrl:J,addLog:ae,clearLogs:U,setExtractResult:Q,togglePageSelection:ie,toggleSelectAll:F,setStatus:h,setError:m,updateDownloadProgress:i,setDownloadedImages:f,addPageIncremental:v,acceptDisclaimer:T,rejectDisclaimer:k,...y}}),_a={key:0,class:"translation-progress-bar"},Ca={class:"progress-bar-label"},Sa={class:"progress-bar"},ka=Ye({__name:"ProgressBar",props:{visible:{type:Boolean,default:!0},percentage:{},label:{default:"è¿›åº¦"}},setup(n){return(t,s)=>n.visible?(B(),A("div",_a,[e("div",Ca,te(n.label),1),e("div",Sa,[e("div",{class:"progress",style:nt({width:`${n.percentage}%`})},null,4)])])):ce("",!0)}}),$o=Je(ka,[["__scopeId","data-v-f915cadf"]]),wa={class:"image-upload"},$a={class:"error-text"},Ta={key:2,class:"loading-overlay"},Ia=Ye({__name:"ImageUpload",emits:["uploadComplete"],setup(n,{expose:t,emit:s}){const o=s,a=Qe(),u=Fe(),l=wo(),c=w(null),g=w(null),d=w(!1),C=w(!1),$=w(""),P=w(0),R=w(""),_=w(!1),D=G(()=>u.settings.pdfProcessingMethod);function j(){c.value?.click()}function z(){l.openModal()}function L(){g.value?.click()}async function b(m){const i=m.target;if(!i.files||i.files.length===0)return;const v=Array.from(i.files).filter(I=>I.type.startsWith("image/"));if(v.length===0){_e("æ‰€é€‰æ–‡ä»¶å¤¹ä¸­æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶","warning"),i.value="";return}const y=ya(v,I=>I.webkitRelativePath);console.log(`ä»æ–‡ä»¶å¤¹å¯¼å…¥ ${y.length} å¼ å›¾ç‰‡`),await p(y),i.value=""}async function p(m){if(m.length!==0){d.value=!0,_.value=!0,P.value=0;try{let i=0;const f=m.length;for(let v=0;v<m.length;v++){const y=m[v];if(!y||!y.type.startsWith("image/"))continue;R.value=y.name;const I=y.webkitRelativePath||"",E=I.includes("/")?I.substring(0,I.lastIndexOf("/")):"";await new Promise((H,X)=>{const r=new FileReader;r.onload=x=>{const ne=x.target?.result;a.addImage(y.name,ne,{relativePath:I,folderPath:E}),H()},r.onerror=()=>X(new Error(`è¯»å–å›¾ç‰‡å¤±è´¥: ${y.name}`)),r.readAsDataURL(y)}),i++,P.value=Math.round((v+1)/f*100)}i>0&&(_e(`å·²æ·»åŠ  ${i} å¼ å›¾ç‰‡`,"success"),o("uploadComplete",i))}catch(i){console.error("å¤„ç†æ–‡ä»¶å¤±è´¥:",i);const f=i instanceof Error?i.message:"å¤„ç†æ–‡ä»¶å¤±è´¥";_e(f,"error")}finally{d.value=!1,_.value=!1}}}async function T(m){const i=m.target;!i.files||i.files.length===0||(await ee(Array.from(i.files)),i.value="")}async function k(m){m.preventDefault(),C.value=!1,!(!m.dataTransfer?.files||m.dataTransfer.files.length===0)&&await ee(Array.from(m.dataTransfer.files))}function N(m){m.preventDefault(),C.value=!0}function O(m){const i=m.currentTarget.getBoundingClientRect(),f=m.clientX,v=m.clientY;(f<i.left||f>i.right||v<i.top||v>i.bottom)&&(C.value=!1)}async function ee(m){if(m.length!==0){d.value=!0,$.value="",_.value=!0,P.value=0;try{let i=0;const f=m.length;for(let v=0;v<m.length;v++){const y=m[v];if(!y)continue;R.value=y.name;const I=y.type,E=y.name.toLowerCase();if(I.startsWith("image/"))await J(y),i++;else if(I==="application/pdf"||E.endsWith(".pdf")){const H=await ae(y);i+=H}else if(E.endsWith(".mobi")||E.endsWith(".azw")||E.endsWith(".azw3")){const H=await F(y);i+=H}else console.warn(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${y.name}`),_e(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${y.name}`,"warning");P.value=Math.round((v+1)/f*100)}i>0&&(_e(`å·²æ·»åŠ  ${i} å¼ å›¾ç‰‡`,"success"),o("uploadComplete",i))}catch(i){console.error("å¤„ç†æ–‡ä»¶å¤±è´¥:",i);const f=i instanceof Error?i.message:"å¤„ç†æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•";$.value=f,_e(f,"error")}finally{d.value=!1,_.value=!1,R.value=""}}}async function J(m){return new Promise((i,f)=>{const v=new FileReader;v.onload=y=>{const I=y.target?.result;a.addImage(m.name,I),i()},v.onerror=()=>f(new Error(`è¯»å–å›¾ç‰‡æ–‡ä»¶å¤±è´¥: ${m.name}`)),v.readAsDataURL(m)})}async function ae(m){return D.value==="frontend"?await Q(m):await ie(m)}function U(m){return new Promise((i,f)=>{const v=new FileReader;v.onload=()=>i(v.result),v.onerror=f,v.readAsDataURL(m)})}async function Q(m){try{const i=await it(()=>import("./pdf.U7tdldy2.js").then(H=>H.p),[]);i.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${i.version}/pdf.worker.min.js`;const f=await m.arrayBuffer(),v=await i.getDocument({data:f}).promise,y=v.numPages;console.log(`PDF ${m.name} å…± ${y} é¡µï¼Œå¼€å§‹æœ¬åœ°æ¸²æŸ“...`),_e(`æ­£åœ¨è§£æ PDFï¼Œå…± ${y} é¡µ...`,"info");const I=typeof OffscreenCanvas<"u";I&&console.log("ä½¿ç”¨ OffscreenCanvas åå°æ¸²æŸ“æ¨¡å¼");let E=0;for(let H=1;H<=y;H++){R.value=`${m.name} - ç¬¬ ${H}/${y} é¡µ`,P.value=Math.round(H/y*100);try{const X=await v.getPage(H),x=X.getViewport({scale:2});let ne;if(I){const Z=new OffscreenCanvas(x.width,x.height),de=Z.getContext("2d");await X.render({canvasContext:de,viewport:x}).promise;const me=await Z.convertToBlob({type:"image/jpeg",quality:1});ne=await U(me)}else{const Z=document.createElement("canvas"),de=Z.getContext("2d");Z.width=x.width,Z.height=x.height,await X.render({canvasContext:de,viewport:x}).promise,ne=Z.toDataURL("image/jpeg",1)}const M=`${m.name}_é¡µé¢${H}`;a.addImage(M,ne),E++,console.log(`  é¡µé¢ ${H}/${y} å¤„ç†å®Œæˆ`)}catch(X){console.warn(`PDF ${m.name} ç¬¬ ${H} é¡µæ¸²æŸ“å¤±è´¥:`,X)}}return console.log(`PDF ${m.name} å…¨éƒ¨ ${y} é¡µå¤„ç†å®Œæˆ`),E}catch(i){return console.error("å‰ç«¯ PDF è§£æå¤±è´¥:",i),_e("å‰ç«¯ PDF è§£æå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨åç«¯è§£æ...","warning"),await ie(m)}}async function ie(m){let f=null;try{_e("æ­£åœ¨ä¸Šä¼  PDF æ–‡ä»¶...","info");const v=await As(m,5);if(!v.success||!v.session_id)throw new Error(v.error||"PDF è§£æå¯åŠ¨å¤±è´¥");f=v.session_id;const y=v.total_pages||0;console.log(`PDF ${m.name} å…± ${y} é¡µï¼Œå¼€å§‹åç«¯åˆ†æ‰¹è§£æ...`),_e(`æ­£åœ¨è§£æ PDFï¼Œå…± ${y} é¡µ...`,"info");let I=0;for(let E=0;E<y;E+=5){R.value=`${m.name} - å¤„ç†ä¸­ ${Math.min(E+5,y)}/${y} é¡µ`,P.value=y>0?Math.round(E/y*100):0;const H=await Ls(f,E,5);if(!H.success){console.warn(`æ‰¹æ¬¡ ${E} è·å–å¤±è´¥:`,H.error);continue}if(H.images&&H.images.length>0)for(const X of H.images){if(!X||!X.data_url)continue;const r=`${m.name}_é¡µé¢${String(X.page_index+1).padStart(4,"0")}`;a.addImage(r,X.data_url),I++}console.log(`  å·²åŠ è½½ ${I}/${y} é¡µ`)}return console.log(`PDF ${m.name} å…¨éƒ¨ ${I} é¡µå¤„ç†å®Œæˆ`),I}catch(v){throw console.error("åç«¯ PDF è§£æå¤±è´¥:",v),v}finally{if(f)try{await Fs(f)}catch(v){console.warn("PDF ä¼šè¯æ¸…ç†å¤±è´¥:",v)}}}async function F(m){let i=null;try{_e("æ­£åœ¨ä¸Šä¼ ç”µå­ä¹¦æ–‡ä»¶...","info");const f=await Us(m,5);if(!f.success||!f.session_id)throw new Error(f.error||"MOBI/AZW è§£æå¯åŠ¨å¤±è´¥");i=f.session_id;const v=f.total_images||0;_e(`æ­£åœ¨è§£æç”µå­ä¹¦ï¼Œå…± ${v} å¼ å›¾ç‰‡...`,"info");let y=0,I=!0;for(;I;){R.value=`${m.name} - å·²å¤„ç† ${y}/${v} å¼ `,P.value=v>0?Math.round(y/v*100):0;const E=await Os(i);if(!E.success)throw new Error(E.error||"MOBI/AZW æ‰¹æ¬¡è§£æå¤±è´¥");if(E.images&&E.images.length>0){for(let H=0;H<E.images.length;H++){const X=E.images[H];if(!X)continue;const r=y+H+1,x=`${m.name.replace(/\.(mobi|azw|azw3)$/i,"")}_image_${String(r).padStart(3,"0")}.png`,ne=X.startsWith("data:")?X:`data:image/png;base64,${X}`;a.addImage(x,ne)}y+=E.images.length}I=E.has_more??!1}return y}catch(f){throw console.error("MOBI/AZW è§£æå¤±è´¥:",f),f}finally{if(i)try{await zs(i)}catch(f){console.warn("MOBI/AZW ä¼šè¯æ¸…ç†å¤±è´¥:",f)}}}function h(){$.value=""}return t({triggerFileSelect:j,triggerFolderSelect:L,processFiles:ee,clearError:h}),(m,i)=>(B(),A("div",wa,[e("div",{id:"drop-area",class:De(["drop-area",{"drag-over":C.value,loading:d.value}]),onDragover:N,onDragleave:O,onDrop:k},[e("div",{class:"drop-content"},[e("p",{class:"drop-text"},[i[0]||(i[0]=pe(" æ‹–æ‹½å›¾ç‰‡ã€PDFæˆ–MOBIæ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ– ",-1)),e("span",{class:"select-link",onClick:j}," é€‰æ‹©æ–‡ä»¶ "),i[1]||(i[1]=e("span",{class:"separator"}," | ",-1)),e("span",{class:"select-link folder-link",onClick:L}," ğŸ“ é€‰æ‹©æ–‡ä»¶å¤¹ "),i[2]||(i[2]=e("span",{class:"separator"}," | ",-1)),e("span",{class:"select-link web-import-link",onClick:z}," ğŸŒ ä»ç½‘é¡µå¯¼å…¥ ")])]),e("input",{ref_key:"fileInputRef",ref:c,type:"file",id:"imageUpload",accept:"image/*,application/pdf,.mobi,.azw,.azw3",multiple:"",class:"file-input",onChange:T},null,544),e("input",{ref_key:"folderInputRef",ref:g,type:"file",webkitdirectory:"",class:"file-input",onChange:b},null,544)],34),_.value?(B(),ut($o,{key:0,visible:!0,percentage:P.value,label:R.value||"å¤„ç†ä¸­..."},null,8,["percentage","label"])):ce("",!0),$.value?(B(),A("div",{key:1,class:"error-message",onClick:h},[i[3]||(i[3]=e("span",{class:"error-icon"},"âš ï¸",-1)),e("span",$a,te($.value),1),i[4]||(i[4]=e("span",{class:"error-close"},"Ã—",-1))])):ce("",!0),d.value&&!_.value?(B(),A("div",Ta,[...i[5]||(i[5]=[e("div",{class:"spinner"},null,-1),e("span",{class:"loading-text"},"å¤„ç†ä¸­...",-1)])])):ce("",!0)]))}}),Pa=Je(Ia,[["__scopeId","data-v-5ff3dc04"]]),Ra={id:"settings-sidebar",class:"settings-sidebar"},Da={class:"card settings-card"},Ma={id:"font-settings",class:"settings-card collapsible-panel"},Ba={class:"toggle-icon"},Ea={class:"collapsible-content"},Aa={class:"settings-form"},La={class:"form-group"},Fa=["value","disabled","title"],Ua={class:"auto-fontSize-option",title:"å‹¾é€‰åï¼Œé¦–æ¬¡ç¿»è¯‘æ—¶è‡ªåŠ¨ä¸ºæ¯ä¸ªæ°”æ³¡è®¡ç®—åˆé€‚çš„å­—å·"},Oa=["checked"],za={class:"form-group"},Na={class:"form-group"},Va={class:"form-group"},Wa={class:"color-with-auto"},Ka={class:"auto-color-toggle",title:"ç¿»è¯‘æ—¶è‡ªåŠ¨ä½¿ç”¨è¯†åˆ«åˆ°çš„æ–‡å­—é¢œè‰²"},qa=["checked"],Ha=["value","disabled"],ja={key:0,class:"auto-color-hint"},Ja={class:"form-group"},Ya={class:"checkbox-label"},Ga=["checked"],Xa={key:0,id:"strokeOptions",class:"stroke-options"},Za={class:"form-group"},Qa=["value"],el={class:"form-group"},tl=["value"],ol={class:"form-group"},nl={key:0,id:"solidColorOptions",class:"form-group"},sl=["value"],al={class:"apply-settings-group"},ll=["disabled"],il={key:0,class:"apply-options-dropdown"},rl={class:"apply-option"},ul=["checked"],cl={class:"apply-option"},dl={class:"apply-option"},gl={class:"apply-option"},pl={class:"apply-option"},ml={class:"apply-option"},vl={class:"apply-option"},fl={class:"apply-option"},bl={class:"apply-option"},hl={id:"page-range-settings",class:"settings-card collapsible-panel"},xl={class:"toggle-icon"},yl={class:"collapsible-content"},_l={class:"settings-form page-range-form"},Cl={class:"range-header-row"},Sl={class:"range-toggle-compact"},kl=["disabled"],wl={class:"total-count"},$l={class:"page-range-inputs-compact"},Tl=["value"],Il=["value"],Pl={key:0,class:"range-error-compact"},Rl={class:"action-buttons"},Dl=["disabled"],Ml=["disabled","title"],Bl=["disabled","title"],El=["disabled","title"],Al=["disabled"],Ll=["disabled","title"],Fl=["disabled"],Ul=["disabled"],Ol={class:"navigation-buttons"},zl=["disabled"],Nl=["disabled"],Vl=Ye({__name:"SettingsSidebar",emits:["translateCurrent","translateAll","translateRange","hqTranslate","hqTranslateRange","proofread","proofreadRange","removeText","removeAllText","removeTextRange","deleteCurrent","clearAll","cleanTemp","openPlugins","openSettings","previous","next","applyToAll","textStyleChanged","autoFontSizeChanged"],setup(n,{emit:t}){const s=t,o=Qe(),a=Fe(),u=w(!0),l=w(!1),c=w({fontSize:!0,fontFamily:!0,layoutDirection:!0,textColor:!0,fillColor:!0,strokeEnabled:!0,strokeColor:!0,strokeWidth:!0}),g=w(!1),d=w(!1),C=w(1),$=w(1),P=[{label:"è‡ªåŠ¨ (æ ¹æ®æ£€æµ‹)",value:"auto"},{label:"ç«–å‘æ’ç‰ˆ",value:"vertical"},{label:"æ¨ªå‘æ’ç‰ˆ",value:"horizontal"}],R=[{label:"çº¯è‰²å¡«å……",value:"solid"},{label:"LAMAä¿®å¤ (é€Ÿåº¦ä¼˜åŒ–)",value:"lama_mpe"},{label:"LAMAä¿®å¤ (é€šç”¨)",value:"litelama"}],_=G(()=>o.currentImage),D=G(()=>o.hasImages),j=G(()=>o.images.length),z=G(()=>C.value>=1&&$.value<=j.value&&C.value<=$.value),L=G(()=>D.value&&!o.isBatchTranslationInProgress),b=G(()=>o.canGoPrevious),p=G(()=>o.canGoNext),T=G(()=>a.textStyle),k=w([]),N=[xt,"fonts/msyh.ttc","fonts/simhei.ttf","fonts/simsun.ttc"],O=w(null),ee=G(()=>{const le=k.value.map(S=>({label:F(S),value:S}));return le.push({label:"è‡ªå®šä¹‰å­—ä½“...",value:"custom-font"}),le});dt(async()=>{await J();const le=T.value.fontFamily;le&&!k.value.includes(le)&&(k.value=[le,...k.value])});async function J(){try{const le=await wn();if(le.fonts&&Array.isArray(le.fonts)&&le.fonts.length>0){const S=le.fonts[0];if(typeof S=="object"&&"path"in S){const Y=le.fonts.map(be=>typeof be=="object"?be.path:be);k.value=Y}else k.value=le.fonts}else k.value=[...N]}catch(le){console.error("åŠ è½½å­—ä½“åˆ—è¡¨å¤±è´¥:",le),k.value=[...N]}}function ae(){u.value=!u.value}function U(le){const S=parseInt(le.target.value);isNaN(S)||(a.updateTextStyle({fontSize:S}),s("textStyleChanged","fontSize",S))}function Q(le){const S=le.target.checked;a.updateTextStyle({autoFontSize:S}),console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${S}`),s("autoFontSizeChanged",S)}async function ie(le){const S=le.target,Y=S.files?.[0];if(!Y)return;const be=[".ttf",".ttc",".otf"],fe=Y.name.toLowerCase();if(!be.some(V=>fe.endsWith(V))){_e("è¯·é€‰æ‹© .ttfã€.ttc æˆ– .otf æ ¼å¼çš„å­—ä½“æ–‡ä»¶","error"),S.value="";return}try{const V=await Hs(Y);V.success&&V.fontPath?(await J(),a.updateTextStyle({fontFamily:V.fontPath}),_e("å­—ä½“ä¸Šä¼ æˆåŠŸ","success")):_e(V.error||"å­—ä½“ä¸Šä¼ å¤±è´¥","error")}catch(V){console.error("å­—ä½“ä¸Šä¼ å¤±è´¥:",V),_e("å­—ä½“ä¸Šä¼ å¤±è´¥","error")}finally{S.value=""}}function F(le){const S={"fonts/STXINGKA.TTF":"åæ–‡è¡Œæ¥·","fonts/STXINWEI.TTF":"åæ–‡æ–°é­","fonts/STZHONGS.TTF":"åæ–‡ä¸­å®‹","fonts/STKAITI.TTF":"æ¥·ä½“","fonts/STLITI.TTF":"éš¶ä¹¦","fonts/æ€æºé»‘ä½“SourceHanSansK-Bold.TTF":"æ€æºé»‘ä½“","fonts/STSONG.TTF":"åæ–‡å®‹ä½“","fonts/msyh.ttc":"å¾®è½¯é›…é»‘","fonts/msyhbd.ttc":"å¾®è½¯é›…é»‘ç²—ä½“","fonts/SIMYOU.TTF":"å¹¼åœ†","fonts/STFANGSO.TTF":"ä»¿å®‹","fonts/STHUPO.TTF":"åæ–‡ç¥ç€","fonts/STXIHEI.TTF":"åæ–‡ç»†é»‘","fonts/simkai.ttf":"ä¸­æ˜“æ¥·ä½“","fonts/simfang.ttf":"ä¸­æ˜“ä»¿å®‹","fonts/simhei.ttf":"ä¸­æ˜“é»‘ä½“","fonts/SIMLI.TTF":"ä¸­æ˜“éš¶ä¹¦","fonts/simsun.ttc":"å®‹ä½“"};if(S[le])return S[le];const Y=le.split("/").pop()||le;for(const[be,fe]of Object.entries(S))if((be.split("/").pop()||"").toLowerCase()===Y.toLowerCase())return fe;return Y.replace(/\.(ttf|ttc|otf)$/i,"")}function h(le){const S=String(le);if(S==="custom-font"){O.value?.click();return}a.updateTextStyle({fontFamily:S}),s("textStyleChanged","fontFamily",S)}function m(le){const S=String(le);a.updateTextStyle({layoutDirection:S}),s("textStyleChanged","layoutDirection",S)}function i(le){const S=String(le);a.updateTextStyle({inpaintMethod:S})}function f(le){const S=le.target.value;a.updateTextStyle({textColor:S}),s("textStyleChanged","textColor",S)}function v(le){const S=le.target.checked;a.updateTextStyle({useAutoTextColor:S})}function y(le){const S=le.target.checked;a.updateTextStyle({strokeEnabled:S}),s("textStyleChanged","strokeEnabled",S)}function I(le){const S=le.target.value;a.updateTextStyle({strokeColor:S}),s("textStyleChanged","strokeColor",S)}function E(le){const S=parseInt(le.target.value);isNaN(S)||(a.updateTextStyle({strokeWidth:S}),s("textStyleChanged","strokeWidth",S))}function H(le){const S=le.target.value;a.updateTextStyle({fillColor:S}),s("textStyleChanged","fillColor",S)}function X(){l.value=!l.value}function r(){const S=!Object.values(c.value).every(Y=>Y);c.value={fontSize:S,fontFamily:S,layoutDirection:S,textColor:S,fillColor:S,strokeEnabled:S,strokeColor:S,strokeWidth:S}}function x(){s("applyToAll",{...c.value}),l.value=!1}function ne(le){le.target.closest(".apply-settings-group")||(l.value=!1)}function M(){g.value=!g.value,g.value&&j.value>0&&(!z.value||C.value===1&&$.value===1)&&(C.value=1,$.value=j.value)}function Z(le){const S=parseInt(le.target.value);isNaN(S)||(C.value=Math.max(1,Math.min(S,j.value)))}function de(le){const S=parseInt(le.target.value);isNaN(S)||($.value=Math.max(1,Math.min(S,j.value)))}function me(){d.value&&z.value?s("translateRange",C.value,$.value):s("translateAll")}function ve(){d.value&&z.value?s("hqTranslateRange",C.value,$.value):s("hqTranslate")}function $e(){d.value&&z.value?s("proofreadRange",C.value,$.value):s("proofread")}function Pe(){d.value&&z.value?s("removeTextRange",C.value,$.value):s("removeAllText")}return typeof window<"u"&&window.addEventListener("click",ne),(le,S)=>(B(),A("aside",Ra,[e("div",Da,[S[43]||(S[43]=e("h2",null,"ç¿»è¯‘è®¾ç½®",-1)),e("div",Ma,[e("h3",{class:"collapsible-header",onClick:ae},[S[17]||(S[17]=pe(" æ–‡å­—è®¾ç½® ",-1)),e("span",Ba,te(u.value?"â–¼":"â–¶"),1)]),oe(e("div",Ea,[e("div",Aa,[e("div",La,[S[19]||(S[19]=e("label",{for:"fontSize"},"å­—å·å¤§å°:",-1)),e("input",{type:"number",id:"fontSize",value:T.value.fontSize,min:"10",disabled:T.value.autoFontSize,class:De({"disabled-input":T.value.autoFontSize}),title:T.value.autoFontSize?"å·²å¯ç”¨è‡ªåŠ¨å­—å·ï¼Œé¦–æ¬¡ç¿»è¯‘æ—¶å°†è‡ªåŠ¨è®¡ç®—":"",onInput:U},null,42,Fa),e("span",Ua,[e("input",{type:"checkbox",id:"autoFontSize",checked:T.value.autoFontSize,onChange:Q},null,40,Oa),S[18]||(S[18]=e("label",{for:"autoFontSize"},"è‡ªåŠ¨è®¡ç®—åˆå§‹å­—å·",-1))])]),e("div",za,[S[20]||(S[20]=e("label",{for:"fontFamily"},"æ–‡æœ¬å­—ä½“:",-1)),Se(We,{"model-value":T.value.fontFamily,options:ee.value,onChange:h},null,8,["model-value","options"]),e("input",{ref_key:"fontUploadInput",ref:O,type:"file",id:"fontUpload",accept:".ttf,.ttc,.otf",style:{display:"none"},onChange:ie},null,544)]),e("div",Na,[S[21]||(S[21]=e("label",{for:"layoutDirection"},"æ’ç‰ˆè®¾ç½®:",-1)),Se(We,{"model-value":T.value.layoutDirection,options:P,onChange:m},null,8,["model-value"])]),e("div",Va,[S[23]||(S[23]=e("label",{for:"textColor"},"æ–‡å­—é¢œè‰²:",-1)),e("div",Wa,[e("label",Ka,[e("input",{type:"checkbox",checked:T.value.useAutoTextColor,onChange:v},null,40,qa),S[22]||(S[22]=e("span",null,"è‡ªåŠ¨",-1))]),e("input",{type:"color",id:"textColor",value:T.value.textColor,disabled:T.value.useAutoTextColor,onInput:f},null,40,Ha)]),T.value.useAutoTextColor?(B(),A("div",ja," ğŸ’¡ ç¿»è¯‘æ—¶å°†è‡ªåŠ¨ä½¿ç”¨è¯†åˆ«åˆ°çš„æ–‡å­—é¢œè‰² ")):ce("",!0)]),e("div",Ja,[e("span",Ya,[e("input",{type:"checkbox",id:"strokeEnabled",checked:T.value.strokeEnabled,onChange:y},null,40,Ga),S[24]||(S[24]=e("label",{for:"strokeEnabled"},"å¯ç”¨æ–‡æœ¬æè¾¹:",-1))])]),Se(sn,{name:"stroke-slide"},{default:St(()=>[T.value.strokeEnabled?(B(),A("div",Xa,[e("div",Za,[S[25]||(S[25]=e("label",{for:"strokeColor"},"æè¾¹é¢œè‰²:",-1)),e("input",{type:"color",id:"strokeColor",value:T.value.strokeColor,onInput:I},null,40,Qa)]),e("div",el,[S[26]||(S[26]=e("label",{for:"strokeWidth"},"æè¾¹å®½åº¦ (px):",-1)),e("input",{type:"number",id:"strokeWidth",value:T.value.strokeWidth,min:"0",max:"10",style:{width:"60px",padding:"5px"},onInput:E},null,40,tl),S[27]||(S[27]=e("div",{class:"input-hint"},"0 è¡¨ç¤ºæ— æè¾¹ã€‚",-1))])])):ce("",!0)]),_:1}),e("div",ol,[S[28]||(S[28]=e("label",{for:"useInpainting"},"æ°”æ³¡å¡«å……æ–¹å¼:",-1)),Se(We,{"model-value":T.value.inpaintMethod,options:R,onChange:i},null,8,["model-value"])]),Se(sn,{name:"slide-fade"},{default:St(()=>[T.value.inpaintMethod==="solid"?(B(),A("div",nl,[S[29]||(S[29]=e("label",{for:"fillColor"},"å¡«å……é¢œè‰²:",-1)),e("input",{type:"color",id:"fillColor",value:T.value.fillColor,onInput:H},null,40,sl)])):ce("",!0)]),_:1})]),e("div",al,[e("button",{type:"button",class:"settings-button",disabled:!D.value,onClick:x}," åº”ç”¨åˆ°å…¨éƒ¨ ",8,ll),e("button",{type:"button",class:"settings-gear-btn",title:"é€‰æ‹©è¦åº”ç”¨çš„å‚æ•°",onClick:X}," âš™ï¸ "),l.value?(B(),A("div",il,[e("div",rl,[e("input",{type:"checkbox",id:"apply_selectAll",checked:Object.values(c.value).every(Y=>Y),onChange:r},null,40,ul),S[30]||(S[30]=e("label",{for:"apply_selectAll"},"å…¨é€‰",-1))]),S[39]||(S[39]=e("hr",null,null,-1)),e("div",cl,[oe(e("input",{type:"checkbox",id:"apply_fontSize","onUpdate:modelValue":S[0]||(S[0]=Y=>c.value.fontSize=Y)},null,512),[[Xe,c.value.fontSize]]),S[31]||(S[31]=e("label",{for:"apply_fontSize"},"å­—å·",-1))]),e("div",dl,[oe(e("input",{type:"checkbox",id:"apply_fontFamily","onUpdate:modelValue":S[1]||(S[1]=Y=>c.value.fontFamily=Y)},null,512),[[Xe,c.value.fontFamily]]),S[32]||(S[32]=e("label",{for:"apply_fontFamily"},"å­—ä½“",-1))]),e("div",gl,[oe(e("input",{type:"checkbox",id:"apply_layoutDirection","onUpdate:modelValue":S[2]||(S[2]=Y=>c.value.layoutDirection=Y)},null,512),[[Xe,c.value.layoutDirection]]),S[33]||(S[33]=e("label",{for:"apply_layoutDirection"},"æ’ç‰ˆæ–¹å‘",-1))]),e("div",pl,[oe(e("input",{type:"checkbox",id:"apply_textColor","onUpdate:modelValue":S[3]||(S[3]=Y=>c.value.textColor=Y)},null,512),[[Xe,c.value.textColor]]),S[34]||(S[34]=e("label",{for:"apply_textColor"},"æ–‡å­—é¢œè‰²",-1))]),e("div",ml,[oe(e("input",{type:"checkbox",id:"apply_fillColor","onUpdate:modelValue":S[4]||(S[4]=Y=>c.value.fillColor=Y)},null,512),[[Xe,c.value.fillColor]]),S[35]||(S[35]=e("label",{for:"apply_fillColor"},"å¡«å……é¢œè‰²",-1))]),e("div",vl,[oe(e("input",{type:"checkbox",id:"apply_strokeEnabled","onUpdate:modelValue":S[5]||(S[5]=Y=>c.value.strokeEnabled=Y)},null,512),[[Xe,c.value.strokeEnabled]]),S[36]||(S[36]=e("label",{for:"apply_strokeEnabled"},"æè¾¹å¼€å…³",-1))]),e("div",fl,[oe(e("input",{type:"checkbox",id:"apply_strokeColor","onUpdate:modelValue":S[6]||(S[6]=Y=>c.value.strokeColor=Y)},null,512),[[Xe,c.value.strokeColor]]),S[37]||(S[37]=e("label",{for:"apply_strokeColor"},"æè¾¹é¢œè‰²",-1))]),e("div",bl,[oe(e("input",{type:"checkbox",id:"apply_strokeWidth","onUpdate:modelValue":S[7]||(S[7]=Y=>c.value.strokeWidth=Y)},null,512),[[Xe,c.value.strokeWidth]]),S[38]||(S[38]=e("label",{for:"apply_strokeWidth"},"æè¾¹å®½åº¦",-1))])])):ce("",!0)])],512),[[Oe,u.value]])]),e("div",hl,[e("h3",{class:"collapsible-header",onClick:M},[S[40]||(S[40]=pe(" æŒ‡å®šèŒƒå›´ ",-1)),e("span",xl,te(g.value?"â–¼":"â–¶"),1)]),oe(e("div",yl,[e("div",_l,[e("div",Cl,[e("label",Sl,[oe(e("input",{type:"checkbox","onUpdate:modelValue":S[8]||(S[8]=Y=>d.value=Y),disabled:j.value===0},null,8,kl),[[Xe,d.value]]),S[41]||(S[41]=e("span",null,"å¯ç”¨",-1))]),e("span",wl,"å…± "+te(j.value)+" å¼ ",1)]),oe(e("div",$l,[e("input",{type:"number",id:"pageRangeStart",value:C.value,onInput:Z,placeholder:"èµ·å§‹"},null,40,Tl),S[42]||(S[42]=e("span",{class:"range-sep"},"~",-1)),e("input",{type:"number",id:"pageRangeEnd",value:$.value,onInput:de,placeholder:"ç»“æŸ"},null,40,Il)],512),[[Oe,d.value]]),d.value&&!z.value&&j.value>0?(B(),A("div",Pl," èŒƒå›´æ— æ•ˆ ")):ce("",!0)])],512),[[Oe,g.value]])]),e("div",Rl,[e("button",{id:"translateButton",disabled:!L.value,onClick:S[9]||(S[9]=Y=>s("translateCurrent"))}," ç¿»è¯‘å½“å‰å›¾ç‰‡ ",8,Dl),e("button",{id:"translateAllButton",disabled:!L.value||d.value&&!z.value,title:d.value?`ç¿»è¯‘ç¬¬ ${C.value}-${$.value} é¡µ`:"ç¿»è¯‘æ‰€æœ‰å›¾ç‰‡",onClick:me},te(d.value?`ç¿»è¯‘ ${C.value}-${$.value} é¡µ`:"ç¿»è¯‘æ‰€æœ‰å›¾ç‰‡"),9,Ml),e("button",{id:"startHqTranslationBtn",class:"settings-button purple-button",disabled:!L.value||d.value&&!z.value,title:d.value?`é«˜è´¨é‡ç¿»è¯‘ç¬¬ ${C.value}-${$.value} é¡µ`:"ä½¿ç”¨é«˜è´¨é‡ç¿»è¯‘æ¨¡å¼ï¼ˆéœ€åœ¨è®¾ç½®ä¸­é…ç½®ï¼‰",onClick:ve},te(d.value?`é«˜è´¨é‡ç¿»è¯‘ ${C.value}-${$.value}`:"é«˜è´¨é‡ç¿»è¯‘"),9,Bl),e("button",{id:"proofreadButton",disabled:!L.value||d.value&&!z.value,title:d.value?`AIæ ¡å¯¹ç¬¬ ${C.value}-${$.value} é¡µ`:"AIæ ¡å¯¹",onClick:$e},te(d.value?`AIæ ¡å¯¹ ${C.value}-${$.value}`:"AIæ ¡å¯¹"),9,El),e("button",{id:"removeTextOnlyButton",disabled:!_.value,title:"æ¶ˆé™¤å›¾ç‰‡ä¸­çš„æ°”æ³¡æ–‡å­—ï¼Œæ— éœ€å¡«å†™ç¿»è¯‘æœåŠ¡å•†å’ŒAPI Key",onClick:S[10]||(S[10]=Y=>s("removeText"))}," ä»…æ¶ˆé™¤æ–‡å­— ",8,Al),e("button",{id:"removeAllTextButton",disabled:!D.value||d.value&&!z.value,title:d.value?`æ¶ˆé™¤ç¬¬ ${C.value}-${$.value} é¡µçš„æ–‡å­—`:"æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡ä¸­çš„æ°”æ³¡æ–‡å­—",onClick:Pe},te(d.value?`æ¶ˆé™¤ ${C.value}-${$.value} é¡µæ–‡å­—`:"æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡æ–‡å­—"),9,Ll),e("button",{id:"deleteCurrentImageButton",class:"settings-button red-button",disabled:!_.value,onClick:S[11]||(S[11]=Y=>s("deleteCurrent"))}," åˆ é™¤å½“å‰å›¾ç‰‡ ",8,Fl),e("button",{id:"clearAllImagesButton",class:"settings-button red-button",disabled:!D.value,onClick:S[12]||(S[12]=Y=>s("clearAll"))}," æ¸…é™¤æ‰€æœ‰å›¾ç‰‡ ",8,Ul),e("button",{id:"cleanDebugFilesButton",class:"settings-button orange-button",onClick:S[13]||(S[13]=Y=>s("cleanTemp"))}," æ¸…ç†ä¸´æ—¶æ–‡ä»¶ "),e("button",{id:"managePluginsButton",class:"settings-button blue-button",onClick:S[14]||(S[14]=Y=>s("openPlugins"))}," æ’ä»¶ç®¡ç† ")]),e("div",Ol,[e("button",{id:"prevImageButton",disabled:!b.value,onClick:S[15]||(S[15]=Y=>s("previous"))}," ä¸Šä¸€å¼  ",8,zl),e("button",{id:"nextImageButton",disabled:!p.value,onClick:S[16]||(S[16]=Y=>s("next"))}," ä¸‹ä¸€å¼  ",8,Nl)])])]))}}),Wl=Je(Vl,[["__scopeId","data-v-cf679ea9"]]);function Ft(n){if(n.textDirection==="vertical"||n.textDirection==="horizontal")return n.textDirection;if(n.autoTextDirection==="vertical"||n.autoTextDirection==="horizontal")return n.autoTextDirection;if(n.coords){const[t,s,o,a]=n.coords;return a-s>o-t?"vertical":"horizontal"}return"vertical"}function Kl(){const n=Qe(),t=Fe(),s=ct(),o=w(!1),a=w(0),u=w(""),l=w(!1),c=w(0),g=w(""),d=G(()=>n.hasImages),C=G(()=>n.hasImages),$=G(()=>n.hasImages);function P(){const b=n.images;if(b.length===0){s.warning("æ²¡æœ‰å¯å¯¼å‡ºçš„å›¾ç‰‡æ–‡æœ¬");return}const p=[];for(let ae=0;ae<b.length;ae++){const U=b[ae];if(!U)continue;const Q=U.bubbleStates||[],ie={imageIndex:ae,bubbles:[]};for(let F=0;F<Q.length;F++){const h=Q[F];if(!h)continue;const m=h.originalText||"",i=h.translatedText||h.textboxText||"";let f="vertical";h.textDirection&&h.textDirection!=="auto"?f=h.textDirection:h.autoTextDirection&&(f=h.autoTextDirection),ie.bubbles.push({bubbleIndex:F,original:m,translated:i,textDirection:f})}p.push(ie)}const T=JSON.stringify(p,null,2),k=new Blob([T],{type:"application/json"}),N=URL.createObjectURL(k),O=document.createElement("a");O.href=N;const J=new Date().toISOString().replace(/[-:T]/g,"").slice(0,15);O.download=`translations_${J}.json`,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(N),s.success("æ–‡æœ¬å¯¼å‡ºæˆåŠŸï¼")}function R(){const b=n.images;if(b.length===0)return null;const p=[];for(let T=0;T<b.length;T++){const k=b[T];if(!k)continue;const N=k.bubbleStates||[],O={imageIndex:T,bubbles:[]};for(let ee=0;ee<N.length;ee++){const J=N[ee];if(!J)continue;const ae=J.originalText||"",U=J.translatedText||J.textboxText||"";let Q="vertical";J.textDirection&&J.textDirection!=="auto"?Q=J.textDirection:J.autoTextDirection&&(Q=J.autoTextDirection),O.bubbles.push({bubbleIndex:ee,original:ae,translated:U,textDirection:Q})}p.push(O)}return p}async function _(b){if(!b){s.warning("æœªé€‰æ‹©æ–‡ä»¶");return}l.value=!0,c.value=0,g.value="å‡†å¤‡å¯¼å…¥æ–‡æœ¬...",s.info("æ­£åœ¨å¯¼å…¥æ–‡æœ¬...",0);try{const p=await D(b);c.value=10,g.value="è§£æ JSON æ•°æ®...";const T=JSON.parse(p);if(!Array.isArray(T))throw new Error("å¯¼å…¥çš„ JSON æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸ºæ•°ç»„");let k=0,N=0;const O=t.settings.textStyle,ee=O.autoFontSize?"auto":O.fontSize,J=O.fontFamily,ae=O.textColor,U=O.fillColor;c.value=20,g.value="å¼€å§‹æ›´æ–°å›¾ç‰‡...";const Q=T.length;let ie=0;const F=[];for(const i of T){ie++;const f=20+ie/Q*60;c.value=f,g.value=`å¤„ç†å›¾ç‰‡ ${ie}/${Q}`;const v=i.imageIndex;if(v<0||v>=n.images.length){console.warn(`è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${v}`);continue}const y=n.images[v];if(!y)continue;let I=!1;y.bubbleStates||(y.bubbleStates=[]),y.bubbleTexts||(y.bubbleTexts=[]),y.originalTexts||(y.originalTexts=[]);for(const E of i.bubbles){const H=E.bubbleIndex,X=E.original,r=E.translated,x=E.textDirection,ne=x==="vertical"||x==="horizontal"?x:"vertical";for(;y.bubbleTexts.length<=H;)y.bubbleTexts.push("");for(;y.originalTexts.length<=H;)y.originalTexts.push("");for(X&&(y.originalTexts[H]=X),r&&(y.bubbleTexts[H]=r);y.bubbleStates.length<=H;)y.bubbleStates.push(j(ee,J,ae,U));const M=y.bubbleStates[H];M&&(X&&(M.originalText=X),r&&(M.translatedText=r,M.textboxText=r),M.textDirection=ne,I=!0,N++)}I&&y.bubbleStates&&(y.bubbleTexts=y.bubbleStates.map(E=>E.translatedText||"")),I&&(k++,y.hasUnsavedChanges=!0,y.translatedDataURL&&y.bubbleStates&&y.bubbleStates.length>0&&F.push(v))}if(F.length>0){c.value=80,g.value="å¼€å§‹æ¸²æŸ“å›¾ç‰‡...",s.info("æ­£åœ¨æ¸²æŸ“å›¾ç‰‡ï¼Œè¯·ç¨å€™...",0);const i=t.settings.textStyle,f=i.layoutDirection,v=f==="auto";for(let y=0;y<F.length;y++){const I=F[y];if(I===void 0)continue;const E=n.images[I];if(!(!E||!E.bubbleStates)){c.value=80+y/F.length*20,g.value=`æ¸²æŸ“å›¾ç‰‡ ${y+1}/${F.length}`;try{let H="";if(E.cleanImageData?H=E.cleanImageData.includes("base64,")?E.cleanImageData.split("base64,")[1]||"":E.cleanImageData:E.originalDataURL&&(H=E.originalDataURL.includes("base64,")?E.originalDataURL.split("base64,")[1]||"":E.originalDataURL,console.log(`importText: å›¾ç‰‡ ${I} ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰`)),!H){console.log(`importText: å›¾ç‰‡ ${I} æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡`);continue}const X=E.bubbleStates.map(x=>({translatedText:x.translatedText||"",coords:x.coords,fontSize:x.fontSize||i.fontSize,fontFamily:x.fontFamily||i.fontFamily,textDirection:Ft(x),textColor:x.textColor||i.textColor,rotationAngle:x.rotationAngle||0,position:x.position||{x:0,y:0},strokeEnabled:x.strokeEnabled??i.strokeEnabled,strokeColor:x.strokeColor||i.strokeColor,strokeWidth:x.strokeWidth??i.strokeWidth})),r=await So({clean_image:H,bubble_texts:X.map(x=>x.translatedText),bubble_coords:X.map(x=>x.coords),fontSize:i.fontSize,fontFamily:i.fontFamily,textDirection:v?"vertical":f,textColor:i.textColor,bubble_states:X,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,is_font_style_change:!0,strokeEnabled:i.strokeEnabled,strokeColor:i.strokeColor,strokeWidth:i.strokeWidth});r.rendered_image&&(n.updateImageByIndex(I,{translatedDataURL:`data:image/png;base64,${r.rendered_image}`,hasUnsavedChanges:!0}),console.log(`importText: å›¾ç‰‡ ${I} æ¸²æŸ“æˆåŠŸ`))}catch(H){console.error(`importText: é‡æ¸²æŸ“å›¾ç‰‡ ${I} å¤±è´¥:`,H)}}}}c.value=100,g.value="å¯¼å…¥å®Œæˆ";const h=F.length,m=h>0?`å¯¼å…¥æˆåŠŸï¼æ›´æ–°äº† ${k} å¼ å›¾ç‰‡ä¸­çš„ ${N} ä¸ªæ°”æ³¡æ–‡æœ¬ï¼Œé‡æ¸²æŸ“äº† ${h} å¼ å›¾ç‰‡`:`å¯¼å…¥æˆåŠŸï¼æ›´æ–°äº† ${k} å¼ å›¾ç‰‡ä¸­çš„ ${N} ä¸ªæ°”æ³¡æ–‡æœ¬`;s.success(m)}catch(p){console.error("å¯¼å…¥æ–‡æœ¬å‡ºé”™:",p),s.error(`å¯¼å…¥å¤±è´¥: ${p instanceof Error?p.message:String(p)}`)}finally{l.value=!1,setTimeout(()=>{c.value=0,g.value=""},2e3)}}function D(b){return new Promise((p,T)=>{const k=new FileReader;k.onload=N=>{N.target?.result?p(N.target.result):T(new Error("è¯»å–æ–‡ä»¶å¤±è´¥"))},k.onerror=()=>T(new Error("è¯»å–æ–‡ä»¶æ—¶å‡ºé”™")),k.readAsText(b)})}function j(b,p,T,k){const N=t.settings.textStyle;return{coords:[0,0,100,100],polygon:[],originalText:"",translatedText:"",textboxText:"",fontSize:typeof b=="number"?b:25,fontFamily:p,textDirection:"vertical",autoTextDirection:"vertical",textColor:T,fillColor:k,rotationAngle:0,position:{x:0,y:0},strokeEnabled:N.strokeEnabled,strokeColor:N.strokeColor,strokeWidth:N.strokeWidth,inpaintMethod:N.inpaintMethod}}function z(){const b=n.currentImage;if(!b){s.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}const p=b.translatedDataURL||b.originalDataURL;if(!p){s.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}o.value=!0;try{const T=p.split(",")[1];if(!T)throw new Error("æ— æ•ˆçš„å›¾ç‰‡æ•°æ®");const k=atob(T),N=[];for(let Q=0;Q<k.length;Q+=512){const ie=k.slice(Q,Q+512),F=new Array(ie.length);for(let m=0;m<ie.length;m++)F[m]=ie.charCodeAt(m);const h=new Uint8Array(F);N.push(h.buffer)}const O=new Blob(N,{type:"image/png"}),ee=URL.createObjectURL(O),J=document.createElement("a");J.href=ee;let ae=b.fileName||`image_${n.currentImageIndex}.png`;ae=`${b.translatedDataURL?"translated":"original"}_${ae.replace(/\.[^/.]+$/,"")}.png`,J.download=ae,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(ee),s.success(`ä¸‹è½½æˆåŠŸ: ${ae}`)}catch(T){console.error("ä¸‹è½½å›¾ç‰‡æ—¶å‡ºé”™:",T),s.error("ä¸‹è½½å¤±è´¥")}finally{o.value=!1}}async function L(b="zip"){const p=n.images;if(p.length===0){s.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}o.value=!0,a.value=0,u.value="å‡†å¤‡ä¸‹è½½...",s.info("ä¸‹è½½ä¸­...å¤„ç†å¯èƒ½éœ€è¦ä¸€å®šæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…...",0);try{const T=[];let k=0,N=0;a.value=5,u.value="æ£€æŸ¥å›¾ç‰‡æ•°æ®...";for(let m=0;m<p.length;m++){const i=p[m];i&&(i.translatedDataURL?(T.push({index:m,type:"translated"}),k++):i.originalDataURL&&(T.push({index:m,type:"original"}),N++))}if(T.length===0){s.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}a.value=10,u.value="åˆ›å»ºä¸‹è½½ä¼šè¯...";const O=await Ns(T.length);if(!O.success||!O.session_id)throw new Error(O.error||"åˆ›å»ºä¼šè¯å¤±è´¥");const ee=O.session_id,J=T.length;let ae=0,U=0;for(let m=0;m<T.length;m++){const i=T[m];if(!i)continue;const f=p[i.index];if(!f)continue;const v=i.type==="translated"?f.translatedDataURL:f.originalDataURL;if(!v)continue;const y=10+m/J*70;a.value=y,u.value=`ä¸Šä¼ å›¾ç‰‡ ${m+1}/${J}...`;try{const I=await Vs(ee,v,m);I.success?ae++:(console.error(`ä¸Šä¼ å›¾ç‰‡ ${m} å¤±è´¥:`,I.error),U++)}catch(I){console.error(`ä¸Šä¼ å›¾ç‰‡ ${m} å‡ºé”™:`,I),U++}}if(ae===0)throw new Error("æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ å¤±è´¥");a.value=85,u.value="æ‰“åŒ…æ–‡ä»¶...";const Q=await Ws(ee,b);if(!Q.success||!Q.file_id)throw new Error(Q.error||"æ‰“åŒ…å¤±è´¥");a.value=95,u.value="å‡†å¤‡ä¸‹è½½...";const ie=Ks(Q.file_id,b),F=document.createElement("a");F.href=ie,document.body.appendChild(F),F.click(),document.body.removeChild(F),a.value=100,u.value="ä¸‹è½½å·²å¼€å§‹";let h=`å·²æˆåŠŸå¤„ç† ${ae} å¼ å›¾ç‰‡`;U>0&&(h+=`ï¼ˆ${U} å¼ å¤±è´¥ï¼‰`),k>0&&N>0?h+=`ï¼ˆ${k} å¼ ç¿»è¯‘å›¾ç‰‡å’Œ ${N} å¼ åŸå§‹å›¾ç‰‡ï¼‰`:k>0?h+="ï¼ˆå…¨éƒ¨ä¸ºç¿»è¯‘åå›¾ç‰‡ï¼‰":N>0&&(h+="ï¼ˆå…¨éƒ¨ä¸ºåŸå§‹å›¾ç‰‡ï¼‰"),h+="ï¼Œä¸‹è½½å³å°†å¼€å§‹",s.success(h),setTimeout(async()=>{try{const m=await Co();console.log("ä¸´æ—¶æ–‡ä»¶æ¸…ç†ç»“æœ:",m)}catch(m){console.error("æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥:",m)}},6e4)}catch(T){console.error("ä¸‹è½½æ‰€æœ‰å›¾ç‰‡æ—¶å‡ºé”™:",T),s.error(`ä¸‹è½½å¤±è´¥: ${T instanceof Error?T.message:String(T)}`)}finally{o.value=!1,setTimeout(()=>{a.value=0,u.value=""},2e3)}}return{isDownloading:o,downloadProgress:a,downloadProgressText:u,isImporting:l,importProgress:c,importProgressText:g,canExportText:d,canImportText:C,canDownload:$,exportText:P,exportTextToJson:R,importText:_,downloadCurrentImage:z,downloadAllImages:L}}const ql={key:0,class:"result-section card result-card"},Hl={class:"image-controls"},jl={class:"image-size-control"},Jl=["value"],Yl={id:"imageSizeValue"},Gl={class:"content-container"},Xl={class:"image-container"},Zl=["src"],Ql={id:"detectedTextInfo",class:"text-info"},ei={id:"detectedTextList"},ti={class:"original-text"},oi={class:"download-section"},ni={class:"download-buttons"},si=["disabled"],ai={class:"download-all-container"},li=["disabled"],ii={class:"download-format-selector"},ri=["disabled"],ui=["disabled"],ci={key:1,class:"empty-state-section"},mo=60,di=Ye({__name:"ImageResultDisplay",props:{isEditMode:{type:Boolean,default:!1}},emits:["toggle-edit-mode","retry-failed"],setup(n,{emit:t}){const s=[{label:"ZIPå‹ç¼©åŒ…",value:"zip"},{label:"PDFæ–‡æ¡£",value:"pdf"},{label:"CBZæ¼«ç”»",value:"cbz"}],o=t,a=Qe(),u=Fe(),l=Kl(),c=w(100),g=G({get:()=>D.value?.showOriginal??!1,set:y=>{D.value&&a.updateCurrentImage({showOriginal:y})}}),d=w("zip"),C=w(null),$=G(()=>l.isDownloading.value),P=G(()=>l.downloadProgressText.value),R=G(()=>l.downloadProgress.value),_=G(()=>a.hasImages),D=G(()=>a.currentImage),j=G(()=>!!D.value?.translatedDataURL),z=G(()=>!!(D.value?.translatedDataURL||D.value?.originalDataURL)),L=G(()=>D.value?g.value||!D.value.translatedDataURL?D.value.originalDataURL:D.value.translatedDataURL:""),b=G(()=>a.failedImageCount>0),p=G(()=>({width:`${c.value}%`})),T=G(()=>u.settings.useTextboxPrompt),k=G(()=>{if(!D.value)return[];if(D.value.bubbleStates&&D.value.bubbleStates.length>0)return D.value.bubbleStates.map(E=>({original:E.originalText||"",translated:T.value?E.textboxText||E.translatedText||"":E.translatedText||""}));const y=D.value.originalTexts||[],I=T.value?D.value.textboxTexts||D.value.bubbleTexts||[]:D.value.bubbleTexts||[];return y.length===0?[]:y.map((E,H)=>({original:E||"",translated:I[H]||""}))}),N=G(()=>k.value.length>0);function O(y){if(!y||y.length<=mo)return y;let I="",E="";for(let H=0;H<y.length;H++)if(E+=y[H],E.length>=mo){let X=-1;for(let r=E.length-1;r>=0;r--){const x=E[r];if(x&&["ã€‚","ï¼","ï¼Ÿ",".","!","?","ï¼›",";","ï¼Œ",","].includes(x)){X=r+1;break}}X>mo*.6?(I+=E.substring(0,X)+`
`,E=E.substring(X)):(I+=E+`
`,E="")}return E&&(I+=E),I}function ee(y){return O((y||"").trim())}function J(y){const I=(y||"").trim();return O(I)}function ae(y){const I=y||"";return I.includes("ã€ç¿»è¯‘å¤±è´¥ã€‘")||I.includes("[ç¿»è¯‘å¤±è´¥]")||I.includes("ç¿»è¯‘å¤±è´¥")}function U(){g.value=!g.value}function Q(){o("toggle-edit-mode")}function ie(y){const I=y.target;c.value=parseInt(I.value,10)}function F(){o("retry-failed")}function h(){l.downloadCurrentImage()}function m(){l.downloadAllImages(d.value)}function i(){l.exportText()}function f(){C.value?.click()}async function v(y){const I=y.target,E=I.files?.[0];E&&(await l.importText(E),I.value="")}return(y,I)=>D.value?(B(),A("section",ql,[e("div",Hl,[j.value?(B(),A("button",{key:0,id:"toggleImageButton",class:"control-btn",onClick:U},te(g.value?"æŸ¥çœ‹ç¿»è¯‘å›¾":"æŸ¥çœ‹åŸå›¾"),1)):ce("",!0),e("button",{id:"toggleEditModeButton",class:De(["control-btn",{active:n.isEditMode}]),onClick:Q},te(n.isEditMode?"é€€å‡ºç¼–è¾‘":"åˆ‡æ¢ç¼–è¾‘æ¨¡å¼"),3),e("div",jl,[I[1]||(I[1]=e("label",{for:"imageSize"},"å›¾ç‰‡å¤§å°:",-1)),e("input",{type:"range",id:"imageSize",min:"50",max:"200",value:c.value,class:"slider range-slider",onInput:ie},null,40,Jl),e("span",Yl,te(c.value)+"%",1)]),b.value?(B(),A("button",{key:1,id:"retranslateFailedButton",class:"retry-failed-btn",onClick:F,title:"é‡æ–°ç¿»è¯‘æ‰€æœ‰å¤±è´¥çš„å›¾ç‰‡"}," é‡æ–°ç¿»è¯‘å¤±è´¥å›¾ç‰‡ ("+te(K(a).failedImageCount)+") ",1)):ce("",!0)]),e("div",Gl,[e("div",Xl,[e("img",{id:"translatedImageDisplay",src:L.value,alt:"ç¿»è¯‘åå›¾ç‰‡",style:nt(p.value)},null,12,Zl)])]),e("div",Ql,[I[6]||(I[6]=e("h3",null,"æ£€æµ‹åˆ°çš„æ–‡æœ¬ï¼ˆåŸæ–‡ â†’ è¯‘æ–‡ï¼‰",-1)),e("pre",ei,[N.value?(B(!0),A(ze,{key:0},Ge(k.value,(E,H)=>(B(),A("span",{key:H,class:"text-item"},[e("span",ti,te(ee(E.original)),1),I[2]||(I[2]=pe(`
`,-1)),e("span",{class:De(["translated-text",{"translation-error":ae(E.translated)}])},te(J(E.translated)),3),I[3]||(I[3]=pe(`
`,-1)),I[4]||(I[4]=e("span",{class:"separator"},"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",-1)),I[5]||(I[5]=pe(`

`,-1))]))),128)):(B(),A(ze,{key:1},[pe("æœªæ£€æµ‹åˆ°æ–‡æœ¬æˆ–å°šæœªç¿»è¯‘")],64))])]),e("div",oi,[$.value?(B(),ut($o,{key:0,visible:!0,percentage:R.value,label:P.value||"ä¸‹è½½ä¸­ï¼Œè¯·ç¨å€™..."},null,8,["percentage","label"])):ce("",!0),e("div",ni,[e("button",{id:"downloadButton",class:"download-btn primary",disabled:!z.value,onClick:h}," ä¸‹è½½å½“å‰å›¾ç‰‡ ",8,si),e("div",ai,[e("button",{id:"downloadAllImagesButton",class:"download-btn primary",disabled:!_.value,onClick:m}," ä¸‹è½½æ‰€æœ‰å›¾ç‰‡ ",8,li),e("div",ii,[Se(We,{modelValue:d.value,"onUpdate:modelValue":I[0]||(I[0]=E=>d.value=E),options:s},null,8,["modelValue"])])]),e("button",{id:"exportTextButton",class:"download-btn success",disabled:!_.value,onClick:i}," å¯¼å‡ºæ–‡æœ¬ ",8,ri),e("button",{id:"importTextButton",class:"download-btn success",disabled:!_.value,onClick:f}," å¯¼å…¥æ–‡æœ¬ ",8,ui),e("input",{type:"file",ref_key:"importFileInput",ref:C,id:"importTextFileInput",style:{display:"none"},accept:".json",onChange:v},null,544)])])])):(B(),A("section",ci))}}),gi=Je(di,[["__scopeId","data-v-7a09e8a5"]]),pi={class:"guide-content"},mi={class:"guide-footer"},vi={class:"dont-show-option"},Wt="saber_translator_dismiss_setup_reminder",fi=Ye({__name:"FirstTimeGuide",emits:["openSettings"],setup(n,{expose:t,emit:s}){const o=s,a=w(!1),u=w(!1);dt(()=>{localStorage.getItem(Wt)!=="true"&&(a.value=!0)});function l(){u.value&&localStorage.setItem(Wt,"true"),a.value=!1}function c(){localStorage.setItem(Wt,"true"),a.value=!1,o("openSettings")}function g(){localStorage.removeItem(Wt)}return t({resetGuideState:g,showGuide:a}),(d,C)=>(B(),ut($n,{"model-value":a.value,title:"æ¬¢è¿ä½¿ç”¨ Saber-Translator",onClose:l},{default:St(()=>[e("div",pi,[C[3]||(C[3]=e("div",{class:"guide-icon"},"ğŸ‰",-1)),C[4]||(C[4]=e("div",{class:"guide-message"},[e("p",{class:"guide-title"},"é¦–æ¬¡ä½¿ç”¨æé†’"),e("p",{class:"guide-text"}," åœ¨å¼€å§‹ç¿»è¯‘ä¹‹å‰ï¼Œè¯·å…ˆé…ç½®ç¿»è¯‘æœåŠ¡ã€‚ "),e("p",{class:"guide-text"},[pe(" ç‚¹å‡»å³ä¸Šè§’çš„ "),e("span",{class:"highlight"},"âš™ï¸ è®¾ç½®"),pe(" æŒ‰é’®ï¼Œé…ç½®ä»¥ä¸‹å†…å®¹ï¼š ")]),e("ul",{class:"guide-list"},[e("li",null,"é€‰æ‹© OCR å¼•æ“ï¼ˆæ–‡å­—è¯†åˆ«ï¼‰"),e("li",null,"é…ç½®ç¿»è¯‘æœåŠ¡å•†å’Œ API Key"),e("li",null,"ï¼ˆå¯é€‰ï¼‰é…ç½®é«˜è´¨é‡ç¿»è¯‘å’Œ AI æ ¡å¯¹")])],-1)),e("div",{class:"guide-actions"},[e("button",{class:"guide-btn primary",onClick:c},[...C[1]||(C[1]=[e("span",{class:"btn-icon"},"âš™ï¸",-1),pe(" ç«‹å³é…ç½® ",-1)])]),e("button",{class:"guide-btn secondary",onClick:l}," ç¨åé…ç½® ")]),e("div",mi,[e("label",vi,[oe(e("input",{type:"checkbox","onUpdate:modelValue":C[0]||(C[0]=$=>u.value=$)},null,512),[[Xe,u.value]]),C[2]||(C[2]=e("span",null,"ä¸å†æ˜¾ç¤ºæ­¤æé†’",-1))])])])]),_:1},8,["model-value"]))}}),bi=Je(fi,[["__scopeId","data-v-eda18e4a"]]),vo="saber_translator_dismiss_setup_reminder",hi=["siliconflow","deepseek","volcano","caiyun","baidu_translate","youdao_translate","gemini","custom_openai"],xi={manga_ocr:"MangaOCR",paddle_ocr:"PaddleOCR",baidu_ocr:"ç™¾åº¦OCR",ai_vision:"AIè§†è§‰OCR"},yi=["ollama","sakura"],_i=["custom_openai"],Ci=["custom_openai"],Si={siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",caiyun:"å½©äº‘å°è¯‘",baidu_translate:"ç™¾åº¦ç¿»è¯‘",youdao_translate:"æœ‰é“ç¿»è¯‘",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰ OpenAI",ollama:"Ollama",sakura:"Sakura"};function Mn(){const n=Fe(),t=ct(),s=w(!1),o=w(!1),a=G(()=>{try{return localStorage.getItem(vo)==="true"}catch{return!1}});function u(k){return Si[k]||k}function l(k){return hi.includes(k)}function c(k){return yi.includes(k)}function g(k){return _i.includes(k)}function d(k){return Ci.includes(k)}function C(k){return xi[k]||k}function $(){const k=n.settings,N=k.ocrEngine,O=k.baiduOcr,ee=k.aiVisionOcr,J=[];return N?(N==="baidu_ocr"&&((!O?.apiKey||O.apiKey.trim()==="")&&J.push("ç™¾åº¦OCR çš„ API Key"),(!O?.secretKey||O.secretKey.trim()==="")&&J.push("ç™¾åº¦OCR çš„ Secret Key")),N==="ai_vision"&&(ee?.provider||J.push("AIè§†è§‰OCR çš„æœåŠ¡å•†"),(!ee?.apiKey||ee.apiKey.trim()==="")&&J.push("AIè§†è§‰OCR çš„ API Key"),(!ee?.modelName||ee.modelName.trim()==="")&&J.push("AIè§†è§‰OCR çš„æ¨¡å‹åç§°"),ee?.provider==="custom"&&(!ee?.customBaseUrl||ee.customBaseUrl.trim()==="")&&J.push("AIè§†è§‰OCR çš„è‡ªå®šä¹‰ Base URL")),J.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${J[0]}`,missingItems:J}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹© OCR å¼•æ“",missingItems:["OCR å¼•æ“"]}}function P(){const{translation:k}=n.settings,{provider:N,apiKey:O,modelName:ee,customBaseUrl:J}=k,ae=[];return N?(l(N)&&(!O||O.trim()==="")&&ae.push(`${u(N)} çš„ API Key`),(!ee||ee.trim()==="")&&(c(N)||l(N))&&ae.push(`${u(N)} çš„æ¨¡å‹åç§°`),g(N)&&(!J||J.trim()==="")&&ae.push("è‡ªå®šä¹‰ OpenAI æœåŠ¡çš„ Base URL"),ae.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${ae[0]}`,missingItems:ae}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹©ç¿»è¯‘æœåŠ¡å•†",missingItems:["ç¿»è¯‘æœåŠ¡å•†"]}}function R(){const{hqTranslation:k}=n.settings,{provider:N,apiKey:O,modelName:ee,customBaseUrl:J}=k,ae=[];return N?((!O||O.trim()==="")&&ae.push("é«˜è´¨é‡ç¿»è¯‘çš„ API Key"),(!ee||ee.trim()==="")&&ae.push("é«˜è´¨é‡ç¿»è¯‘çš„æ¨¡å‹åç§°"),d(N)&&(!J||J.trim()==="")&&ae.push("é«˜è´¨é‡ç¿»è¯‘çš„ Base URL"),ae.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${ae[0]}`,missingItems:ae}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹©é«˜è´¨é‡ç¿»è¯‘çš„æœåŠ¡å•†",missingItems:["é«˜è´¨é‡ç¿»è¯‘æœåŠ¡å•†"]}}function _(k){const N=k||n.settings.proofreading.rounds,O=[];if(!N||N.length===0)return{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­æ·»åŠ è‡³å°‘ä¸€ä¸ªæ ¡å¯¹è½®æ¬¡",missingItems:["æ ¡å¯¹è½®æ¬¡"]};for(let ee=0;ee<N.length;ee++){const J=N[ee];if(!J)continue;const ae=J.name||`è½®æ¬¡${ee+1}`;if(J.provider||O.push(`æ ¡å¯¹ ${ae} çš„æœåŠ¡å•†`),(!J.apiKey||J.apiKey.trim()==="")&&O.push(`æ ¡å¯¹ ${ae} çš„ API Key`),(!J.modelName||J.modelName.trim()==="")&&O.push(`æ ¡å¯¹ ${ae} çš„æ¨¡å‹åç§°`),O.length>0)return{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­ä¸º ${O[0]}`,missingItems:O}}return{valid:!0,message:""}}function D(k="normal",N={}){let O;switch(k){case"normal":O=P();break;case"hq":O=R();break;case"proofread":O=_(N.proofreadingRounds);break;case"ocr":O=$();break;default:O=P()}return O.valid?!0:(t.error(O.message),z(),!1)}function j(){const k=$();if(!k.valid)return t.error(k.message),z(),!1;const N=P();return N.valid?!0:(t.error(N.message),z(),!1)}function z(){const k=document.getElementById("openSettingsBtn");k&&(o.value=!0,k.style.animation="settingsBtnPulse 0.5s ease-in-out 3",k.style.boxShadow="0 0 10px var(--primary-color, #4a90d9)",setTimeout(()=>{k.style.animation="",k.style.boxShadow="",o.value=!1},3e3))}function L(){if(a.value){console.log("ç”¨æˆ·å·²é€‰æ‹©ä¸å†æ˜¾ç¤ºè®¾ç½®æé†’");return}s.value=!0}function b(k=!1){if(k)try{localStorage.setItem(vo,"true"),console.log("ç”¨æˆ·é€‰æ‹©æ°¸ä¹…å…³é—­è®¾ç½®æé†’")}catch(N){console.error("ä¿å­˜è®¾ç½®æé†’çŠ¶æ€å¤±è´¥:",N)}s.value=!1}function p(){try{localStorage.removeItem(vo),console.log("è®¾ç½®æé†’çŠ¶æ€å·²é‡ç½®")}catch(k){console.error("é‡ç½®è®¾ç½®æé†’çŠ¶æ€å¤±è´¥:",k)}}function T(){setTimeout(()=>{L()},500)}return{showSetupReminder:s,isSettingsButtonHighlighted:o,isSetupReminderDismissed:a,validateOcrConfig:$,validateTranslationConfig:P,validateHqTranslationConfig:R,validateProofreadingConfig:_,validateBeforeTranslation:D,validateFullTranslationConfig:j,highlightSettingsButton:z,checkAndShowSetupReminder:L,closeSetupReminder:b,resetSetupReminderDismiss:p,initValidation:T,getProviderDisplayName:u,getOcrEngineDisplayName:C,requiresApiKey:l,isLocalProvider:c,requiresBaseUrl:g}}const gt=Yt("bubble",()=>{const n=w([]),t=w(-1),s=w([]),o=w([]),a=w(!1),u=w(-1),l=w(0),c=w(0),g=w(0),d=w(0),C=w(!1),$=w(-1),P=w(null),R=w(!1),_=w(-1),D=w(0),j=G(()=>t.value>=0&&t.value<n.value.length?n.value[t.value]??null:null),z=G(()=>n.value.length),L=G(()=>n.value.length>0),b=G(()=>t.value>=0),p=G(()=>s.value.length>1),T=G(()=>s.value.filter(M=>M>=0&&M<n.value.length).map(M=>n.value[M]).filter(M=>M!==void 0));function k(){const Z=Qe().currentImage;Z&&(Z.bubbleStates=Vt(n.value),Z.hasUnsavedChanges=!0,console.log("æ°”æ³¡çŠ¶æ€å·²åŒæ­¥åˆ°å½“å‰å›¾ç‰‡"))}function N(M,Z=!1){n.value=M,o.value=Vt(M),F(),console.log(`æ°”æ³¡æ•°ç»„å·²è®¾ç½®ï¼Œå…± ${M.length} ä¸ªæ°”æ³¡`),Z||k()}function O(M,Z){const de=fa(M),ve=Fe().settings.textStyle,$e=ve.layoutDirection,Pe=$e==="vertical"||$e==="horizontal"?$e:de==="vertical"||de==="horizontal"?de:"vertical",le=va({coords:M,translatedText:"",autoTextDirection:de,fontSize:ve.fontSize,fontFamily:ve.fontFamily,textDirection:Pe,textColor:ve.textColor,fillColor:ve.fillColor,inpaintMethod:ve.inpaintMethod,strokeEnabled:ve.strokeEnabled,strokeColor:ve.strokeColor,strokeWidth:ve.strokeWidth,rotationAngle:0,position:{x:0,y:0},...Z});return n.value.push(le),console.log(`å·²æ·»åŠ æ°”æ³¡ï¼Œå½“å‰å…± ${n.value.length} ä¸ª`),k(),le}function ee(M){return M<0||M>=n.value.length?(console.warn(`åˆ é™¤å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${M}`),!1):(n.value.splice(M,1),t.value===M?t.value=-1:t.value>M&&t.value--,s.value=s.value.filter(Z=>Z!==M).map(Z=>Z>M?Z-1:Z),console.log(`å·²åˆ é™¤æ°”æ³¡ï¼Œå½“å‰å…± ${n.value.length} ä¸ª`),k(),!0)}function J(){if(s.value.length===0&&t.value<0)return;const M=[...new Set([...s.value,t.value])].filter(Z=>Z>=0).sort((Z,de)=>de-Z);for(const Z of M)n.value.splice(Z,1);F(),console.log(`å·²åˆ é™¤ ${M.length} ä¸ªæ°”æ³¡`),k()}function ae(){n.value=[],o.value=[],F(),console.log("æ‰€æœ‰æ°”æ³¡å·²æ¸…é™¤"),k()}function U(){n.value=[],o.value=[],F(),console.log("æœ¬åœ°æ°”æ³¡çŠ¶æ€å·²æ¸…é™¤ï¼ˆä¸åŒæ­¥åˆ°imageStoreï¼‰")}function Q(M){M>=-1&&M<n.value.length&&(t.value=M,s.value=M>=0?[M]:[],console.log(`å·²é€‰ä¸­æ°”æ³¡ ${M}`))}function ie(M){if(M<0||M>=n.value.length)return;const Z=s.value.indexOf(M);Z>=0?(s.value.splice(Z,1),t.value===M&&(t.value=s.value[0]??-1)):(s.value.push(M),t.value=M),console.log(`å¤šé€‰çŠ¶æ€: ${s.value.join(", ")}`)}function F(){t.value=-1,s.value=[]}function h(){t.value>=0?s.value=[t.value]:s.value=[]}function m(){if(n.value.length===0)return!1;const M=t.value<n.value.length-1?t.value+1:0;return Q(M),!0}function i(){if(n.value.length===0)return!1;const M=t.value>0?t.value-1:n.value.length-1;return Q(M),!0}function f(M,Z){if(M<0||M>=n.value.length)return console.warn(`æ›´æ–°å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${M}`),!1;const de=n.value[M];return de?(Object.assign(de,Z),console.log(`å·²æ›´æ–°æ°”æ³¡ ${M}`),k(),!0):!1}function v(M){return t.value<0?(console.warn("æ›´æ–°å¤±è´¥: æ²¡æœ‰é€‰ä¸­çš„æ°”æ³¡"),!1):f(t.value,M)}function y(M){const Z=s.value.length>0?s.value:t.value>=0?[t.value]:[];for(const de of Z){const me=n.value[de];me&&Object.assign(me,M)}k(),console.log(`å·²æ‰¹é‡æ›´æ–° ${Z.length} ä¸ªæ°”æ³¡`)}function I(M){for(let Z=0;Z<n.value.length;Z++){const de=n.value[Z];de&&Object.assign(de,M)}k(),console.log(`å·²æ›´æ–°æ‰€æœ‰ ${n.value.length} ä¸ªæ°”æ³¡`)}function E(){if(n.value.length!==o.value.length)return!0;for(let M=0;M<n.value.length;M++){const Z=n.value[M],de=o.value[M];if(!(!Z||!de)&&(Z.translatedText!==de.translatedText||Z.textboxText!==de.textboxText||Z.fontSize!==de.fontSize||Z.fontFamily!==de.fontFamily||Z.textDirection!==de.textDirection||Z.textColor!==de.textColor||Z.fillColor!==de.fillColor||Z.rotationAngle!==de.rotationAngle||Z.strokeEnabled!==de.strokeEnabled||Z.strokeColor!==de.strokeColor||Z.strokeWidth!==de.strokeWidth||Z.inpaintMethod!==de.inpaintMethod||JSON.stringify(Z.coords)!==JSON.stringify(de.coords)))return!0}return!1}function H(){n.value=Vt(o.value),F(),console.log("æ°”æ³¡çŠ¶æ€å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€")}function X(){o.value=Vt(n.value),console.log("å½“å‰çŠ¶æ€å·²ä¿å­˜ä¸ºåˆå§‹çŠ¶æ€")}function r(){return{bubble_coords:n.value.map(M=>M.coords),bubble_texts:n.value.map(M=>M.translatedText),textbox_texts:n.value.map(M=>M.textboxText),font_sizes:n.value.map(M=>M.fontSize),font_families:n.value.map(M=>M.fontFamily),text_directions:n.value.map(M=>M.textDirection==="vertical"||M.textDirection==="horizontal"?M.textDirection==="vertical"?"v":"h":M.autoTextDirection==="vertical"||M.autoTextDirection==="horizontal"?M.autoTextDirection==="vertical"?"v":"h":"v"),text_colors:n.value.map(M=>M.textColor),fill_colors:n.value.map(M=>M.fillColor),rotation_angles:n.value.map(M=>M.rotationAngle),stroke_enabled:n.value.map(M=>M.strokeEnabled),stroke_colors:n.value.map(M=>M.strokeColor),stroke_widths:n.value.map(M=>M.strokeWidth),inpaint_methods:n.value.map(M=>M.inpaintMethod)}}function x(){return JSON.stringify(n.value)}function ne(M){try{const Z=JSON.parse(M);if(!Array.isArray(Z))return console.error("ååºåˆ—åŒ–å¤±è´¥: æ•°æ®ä¸æ˜¯æ•°ç»„"),!1;const de=[];for(const me of Z)ba(me)?de.push(me):console.warn("è·³è¿‡æ— æ•ˆçš„æ°”æ³¡çŠ¶æ€:",me);return N(de),!0}catch(Z){return console.error("ååºåˆ—åŒ–å¤±è´¥:",Z),!1}}return{bubbles:n,selectedIndex:t,selectedIndices:s,initialStates:o,isDragging:a,draggingIndex:u,dragOffsetX:l,dragOffsetY:c,dragInitialX:g,dragInitialY:d,isResizing:C,resizingIndex:$,resizeCurrentCoords:P,isRotating:R,rotatingIndex:_,rotateCurrentAngle:D,selectedBubble:j,bubbleCount:z,hasBubbles:L,hasSelection:b,isMultiSelect:p,selectedBubbles:T,setBubbles:N,addBubble:O,deleteBubble:ee,deleteSelected:J,clearBubbles:ae,clearBubblesLocal:U,selectBubble:Q,toggleMultiSelect:ie,clearSelection:F,clearMultiSelect:h,selectNext:m,selectPrevious:i,updateBubble:f,updateSelectedBubble:v,updateAllSelected:y,updateAllBubbles:I,hasChanges:E,resetToInitial:H,saveAsInitial:X,toApiRequest:r,serialize:x,deserialize:ne}}),ki=Object.freeze(Object.defineProperty({__proto__:null,useBubbleStore:gt},Symbol.toStringTag,{value:"Module"}));function wi(){const n=w({current:0,total:0,completed:0,failed:0,isInProgress:!1,label:"",percentage:0});return{progress:n,reporter:{init(s,o){n.value={current:0,total:s,completed:0,failed:0,isInProgress:!0,label:o||"å‡†å¤‡ä¸­...",percentage:0}},update(s,o){n.value.current=s,o!==void 0&&(n.value.label=o),n.value.total>0&&(n.value.percentage=Math.round(s/n.value.total*100))},setPercentage(s,o){n.value.percentage=Math.min(100,Math.max(0,s)),o!==void 0&&(n.value.label=o)},incrementCompleted(){n.value.completed++},incrementFailed(){n.value.failed++},finish(){n.value.isInProgress=!1,n.value.percentage=100},getProgress(){return{...n.value}}}}}async function Bn(n){return Ze.post("/api/parallel/detect",n)}async function En(n){return Ze.post("/api/parallel/ocr",n)}async function An(n){return Ze.post("/api/parallel/color",n)}async function To(n){return Ze.post("/api/parallel/translate",n)}async function Ln(n){return Ze.post("/api/parallel/inpaint",n)}async function Io(n){return Ze.post("/api/parallel/render",n)}const $i=Object.freeze(Object.defineProperty({__proto__:null,parallelColor:An,parallelDetect:Bn,parallelInpaint:Ln,parallelOcr:En,parallelRender:Io,parallelTranslate:To},Symbol.toStringTag,{value:"Module"}));async function Fn(n){const{imageIndex:t,image:s,forceDetect:o=!1}=n,a=Fe(),u=s.bubbleStates;if(!o&&u!==null&&u!==void 0)return u.length>0?(console.log(`å›¾ç‰‡ ${t+1} å·²æœ‰ ${u.length} ä¸ªæ°”æ³¡ï¼Œè·³è¿‡æ£€æµ‹`),{bubbleCoords:u.map(d=>d.coords.map(C=>Math.round(C))),bubbleAngles:u.map(d=>d.rotationAngle||0),bubblePolygons:u.map(d=>d.polygon||[]),autoDirections:u.map(d=>d.autoTextDirection||d.textDirection||"vertical"),textlinesPerBubble:[],originalTexts:u.map(d=>d.originalText||"")}):(console.log(`å›¾ç‰‡ ${t+1} æ°”æ³¡å·²è¢«æ¸…ç©ºï¼Œè·³è¿‡æ£€æµ‹`),{bubbleCoords:[],bubbleAngles:[],bubblePolygons:[],autoDirections:[],textlinesPerBubble:[],originalTexts:[]});const l=a.settings,c=Ti(s.originalDataURL),g=await Bn({image:c,detector_type:l.textDetector,box_expand_ratio:l.boxExpand.ratio,box_expand_top:l.boxExpand.top,box_expand_bottom:l.boxExpand.bottom,box_expand_left:l.boxExpand.left,box_expand_right:l.boxExpand.right});if(!g.success)throw new Error(g.error||"æ£€æµ‹å¤±è´¥");return{bubbleCoords:g.bubble_coords||[],bubbleAngles:g.bubble_angles||[],bubblePolygons:g.bubble_polygons||[],autoDirections:g.auto_directions||[],rawMask:g.raw_mask,textlinesPerBubble:g.textlines_per_bubble||[]}}function Ti(n){return n.includes("base64,")?n.split("base64,")[1]||"":n}async function Un(n){const{image:t,bubbleCoords:s,textlinesPerBubble:o}=n;if(s.length===0)return{originalTexts:[]};const u=Fe().settings,l=Ii(t.originalDataURL),c=u.ocrEngine==="paddleocr_vl"?u.paddleOcrVl?.sourceLanguage||"japanese":u.sourceLanguage,g=await En({image:l,bubble_coords:s,source_language:c,ocr_engine:u.ocrEngine,baidu_api_key:u.baiduOcr?.apiKey,baidu_secret_key:u.baiduOcr?.secretKey,baidu_version:u.baiduOcr?.version,baidu_ocr_language:u.baiduOcr?.sourceLanguage,ai_vision_provider:u.aiVisionOcr?.provider,ai_vision_api_key:u.aiVisionOcr?.apiKey,ai_vision_model_name:u.aiVisionOcr?.modelName,ai_vision_ocr_prompt:u.aiVisionOcr?.prompt,custom_ai_vision_base_url:u.aiVisionOcr?.customBaseUrl,textlines_per_bubble:o});if(!g.success)throw new Error(g.error||"OCRå¤±è´¥");return{originalTexts:g.original_texts||[]}}function Ii(n){return n.includes("base64,")?n.split("base64,")[1]||"":n}async function On(n){const{image:t,bubbleCoords:s,textlinesPerBubble:o}=n;if(s.length===0)return{colors:[]};const a=Pi(t.originalDataURL),u=await An({image:a,bubble_coords:s,textlines_per_bubble:o});if(!u.success)throw new Error(u.error||"é¢œè‰²æå–å¤±è´¥");return{colors:u.colors||[]}}function Pi(n){return n.includes("base64,")?n.split("base64,")[1]||"":n}async function Ri(n){const{originalTexts:t,rateLimiter:s=null}=n;if(t.length===0)return{translatedTexts:[],textboxTexts:[]};const a=Fe().settings;if((a.translation.translationMode||"batch")==="single"){console.log(`[ç¿»è¯‘] ä½¿ç”¨é€æ°”æ³¡ç¿»è¯‘æ¨¡å¼ï¼Œå…± ${t.length} ä¸ªæ°”æ³¡`);const l=[],c=[];for(let g=0;g<t.length;g++){const d=t[g];if(!d||d.trim()===""){l.push(""),a.useTextboxPrompt&&c.push("");continue}try{const C=a.translation.isJsonMode?a.translation.singleJsonPrompt:a.translation.singleNormalPrompt,$=await At({original_text:d,model_provider:a.translation.provider,model_name:a.translation.modelName,api_key:a.translation.apiKey,custom_base_url:a.translation.customBaseUrl,target_language:a.targetLanguage,prompt_content:C,use_json_format:a.translation.isJsonMode,rpm_limit_translation:a.translation.rpmLimit,max_retries:a.translation.maxRetries});if($.success&&$.data?l.push($.data.translated_text||""):(console.warn(`[ç¿»è¯‘] æ°”æ³¡ ${g+1} ç¿»è¯‘å¤±è´¥: ${$.error}`),l.push("ã€ç¿»è¯‘å¤±è´¥ã€‘è¯·æ£€æŸ¥ç»ˆç«¯ä¸­çš„é”™è¯¯æ—¥å¿—")),a.useTextboxPrompt&&a.textboxPrompt){const P=await At({original_text:d,model_provider:a.translation.provider,model_name:a.translation.modelName,api_key:a.translation.apiKey,custom_base_url:a.translation.customBaseUrl,target_language:a.targetLanguage,prompt_content:a.textboxPrompt,rpm_limit_translation:a.translation.rpmLimit,max_retries:a.translation.maxRetries});P.success&&P.data?c.push(P.data.translated_text||""):c.push("")}s&&g<t.length-1&&await s.acquire()}catch(C){console.error(`[ç¿»è¯‘] æ°”æ³¡ ${g+1} ç¿»è¯‘å‡ºé”™:`,C),l.push("ã€ç¿»è¯‘å¤±è´¥ã€‘è¯·æ£€æŸ¥ç»ˆç«¯ä¸­çš„é”™è¯¯æ—¥å¿—"),a.useTextboxPrompt&&c.push("")}}return console.log(`[ç¿»è¯‘] é€æ°”æ³¡ç¿»è¯‘å®Œæˆï¼ŒæˆåŠŸ ${l.filter(g=>g&&!g.startsWith("[ç¿»è¯‘")).length}/${t.length}`),{translatedTexts:l,textboxTexts:c}}else{console.log(`[ç¿»è¯‘] ä½¿ç”¨æ•´é¡µæ‰¹é‡ç¿»è¯‘æ¨¡å¼ï¼Œå…± ${t.length} ä¸ªæ°”æ³¡`);const l=await To({original_texts:t,target_language:a.targetLanguage,source_language:a.sourceLanguage,model_provider:a.translation.provider,model_name:a.translation.modelName,api_key:a.translation.apiKey,custom_base_url:a.translation.customBaseUrl,prompt_content:a.translatePrompt,textbox_prompt_content:a.textboxPrompt,use_textbox_prompt:a.useTextboxPrompt,rpm_limit:a.translation.rpmLimit,max_retries:a.translation.maxRetries,use_json_format:a.translation.isJsonMode});if(!l.success)throw new Error(l.error||"ç¿»è¯‘å¤±è´¥");return{translatedTexts:l.translated_texts||[],textboxTexts:l.textbox_texts||[]}}}async function zn(n){const{image:t,bubbleCoords:s,bubblePolygons:o,rawMask:a}=n;if(s.length===0)return{cleanImage:pn(t.originalDataURL)};const l=Fe().settings,{textStyle:c,preciseMask:g}=l,d=pn(t.originalDataURL),C=await Ln({image:d,bubble_coords:s,bubble_polygons:o,raw_mask:a,method:c.inpaintMethod==="solid"?"solid":"lama",lama_model:c.inpaintMethod==="litelama"?"litelama":"lama_mpe",fill_color:c.fillColor,mask_dilate_size:g.dilateSize,mask_box_expand_ratio:g.boxExpandRatio});if(!C.success)throw new Error(C.error||"èƒŒæ™¯ä¿®å¤å¤±è´¥");return{cleanImage:C.clean_image||""}}function pn(n){return n.includes("base64,")?n.split("base64,")[1]||"":n}async function Nn(n){const{cleanImage:t,bubbleCoords:s,bubbleAngles:o,autoDirections:a,originalTexts:u,translatedTexts:l,textboxTexts:c,colors:g,savedTextStyles:d,currentMode:C}=n;if(!t)throw C==="proofread"?new Error("æ­¤å›¾ç‰‡å°šæœªç¿»è¯‘ï¼Œè¯·å…ˆç¿»è¯‘åå†è¿›è¡Œæ ¡å¯¹"):new Error("ç¼ºå°‘å¹²å‡€èƒŒæ™¯å›¾ç‰‡");const $=Fe(),{textStyle:P}=$.settings,R=d?.autoTextDirection?"auto":d?.textDirection||P.layoutDirection,_=s.map((j,z)=>{const L=a[z]||"vertical",b=L==="v"?"vertical":L==="h"?"horizontal":L==="vertical"||L==="horizontal"?L:"vertical",p=R==="vertical"||R==="horizontal"?R:b,T=d?.useAutoTextColor??P.useAutoTextColor;let k=d?.textColor||P.textColor,N=d?.fillColor||P.fillColor;const O=g[z];return T&&O&&(O.textColor&&(k=O.textColor),O.bgColor&&(N=O.bgColor)),{coords:j,polygon:[],position:{x:0,y:0},rotationAngle:o[z]||0,originalText:u[z]||"",translatedText:l[z]||"",textboxText:c[z]||"",textDirection:p,autoTextDirection:b,fontSize:d?.fontSize||P.fontSize,fontFamily:d?.fontFamily||P.fontFamily,autoFontSize:d?.autoFontSize??P.autoFontSize,textColor:k,fillColor:N,strokeEnabled:d?.strokeEnabled??P.strokeEnabled,strokeColor:d?.strokeColor||P.strokeColor,strokeWidth:d?.strokeWidth||P.strokeWidth,inpaintMethod:d?.inpaintMethod||P.inpaintMethod,autoFgColor:g[z]?.autoFgColor||null,autoBgColor:g[z]?.autoBgColor||null}}),D=await Io({clean_image:t,bubble_states:_,fontSize:d?.fontSize||P.fontSize,fontFamily:d?.fontFamily||P.fontFamily,textDirection:d?.textDirection||P.layoutDirection,textColor:d?.textColor||P.textColor,strokeEnabled:d?.strokeEnabled??P.strokeEnabled,strokeColor:d?.strokeColor||P.strokeColor,strokeWidth:d?.strokeWidth||P.strokeWidth,autoFontSize:d?.autoFontSize??P.autoFontSize,use_individual_styles:!0});if(!D.success)throw new Error(D.error||"æ¸²æŸ“å¤±è´¥");return{finalImage:D.final_image||"",bubbleStates:D.bubble_states||_}}let Tt=null,Ut=!1;function Pt(){const n=It();return Fe().settings.autoSaveInBookshelfMode&&n.isBookshelfMode}function Po(){const n=It(),t=n.currentBookId,s=n.currentChapterId;return!t||!s?null:`bookshelf/${t}/${s}`}function Vn(){const n=Fe(),{textStyle:t}=n.settings;return{fontSize:t.fontSize,autoFontSize:t.autoFontSize,fontFamily:t.fontFamily,layoutDirection:t.layoutDirection,textColor:t.textColor,useInpaintingMethod:t.inpaintMethod,fillColor:t.fillColor,strokeEnabled:t.strokeEnabled,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,useAutoTextColor:t.useAutoTextColor}}async function Wn(n){const t=Qe();if(!Pt())return console.log("[AutoSave] è‡ªåŠ¨ä¿å­˜æœªå¯ç”¨æˆ–éä¹¦æ¶æ¨¡å¼ï¼Œè·³è¿‡é¢„ä¿å­˜"),!0;const s=Po();if(!s)return console.warn("[AutoSave] ç¼ºå°‘ä¹¦ç±/ç« èŠ‚IDï¼Œè·³è¿‡é¢„ä¿å­˜"),n?.onError?.("ç¼ºå°‘ä¹¦ç±/ç« èŠ‚ID"),!1;const o=t.images,a=o.length;if(a===0)return console.warn("[AutoSave] æ²¡æœ‰å›¾ç‰‡ï¼Œè·³è¿‡é¢„ä¿å­˜"),n?.onError?.("æ²¡æœ‰å›¾ç‰‡"),!1;console.log(`[AutoSave] é¢„ä¿å­˜å¼€å§‹ï¼š${a} é¡µï¼ˆé€é¡µä¿å­˜ï¼‰`),n?.onStart?.(a);try{const{saveAllPagesSequentially:u,saveSessionMeta:l}=await it(async()=>{const{saveAllPagesSequentially:P,saveSessionMeta:R}=await Promise.resolve().then(()=>Dn);return{saveAllPagesSequentially:P,saveSessionMeta:R}},void 0),c=Vn(),g=await u(s,o,{onProgress:(P,R)=>{n?.onProgress?.(P,R)}});await l(s,{ui_settings:c,total_pages:a,currentImageIndex:t.currentImageIndex});const d=It(),C=d.currentBookId,$=d.currentChapterId;if(C&&$)try{const{apiClient:P}=await it(async()=>{const{apiClient:R}=await import("./client.Bht704G-.js");return{apiClient:R}},__vite__mapDeps([4,5]));await P.put(`/api/bookshelf/books/${C}/chapters/${$}/image-count`,{count:a}),console.log(`[AutoSave] å·²æ›´æ–°ç« èŠ‚å›¾ç‰‡æ•°é‡ä¸º ${a}`)}catch(P){console.warn("[AutoSave] æ›´æ–°ç« èŠ‚å›¾ç‰‡æ•°é‡å¤±è´¥ï¼ˆéè‡´å‘½ï¼‰:",P)}return Tt=s,Ut=!0,console.log(`[AutoSave] é¢„ä¿å­˜å®Œæˆï¼Œå…±ä¿å­˜ ${g}/${a} é¡µ`),n?.onComplete?.(),!0}catch(u){console.error("[AutoSave] é¢„ä¿å­˜å¤±è´¥:",u);const l=u instanceof Error?u.message:"é¢„ä¿å­˜å¤±è´¥";return n?.onError?.(l),Tt=null,Ut=!1,!1}}async function Kn(n){if(!Pt())return;const t=Tt||Po();if(!t){console.warn("[AutoSave] ä¼šè¯è·¯å¾„ä¸å­˜åœ¨ï¼Œè·³è¿‡ä¿å­˜");return}const s=Qe(),o=s.images[n];if(!o){console.warn(`[AutoSave] é¡µé¢ ${n} ä¸å­˜åœ¨`);return}try{const a={};o.translatedDataURL?.startsWith("data:")&&(a.translated=o.translatedDataURL),o.cleanImageData&&typeof o.cleanImageData=="string"&&!o.cleanImageData.startsWith("/api/")&&(a.clean=o.cleanImageData.startsWith("data:")?o.cleanImageData:`data:image/png;base64,${o.cleanImageData}`);const u={};for(const c of Object.keys(o))["originalDataURL","translatedDataURL","cleanImageData"].includes(c)||(u[c]=o[c]);a.meta=u;const l=await Rn(t,n,a);if(!l.success)throw new Error(l.error||"ä¿å­˜å¤±è´¥");s.updateImageByIndex(n,{hasUnsavedChanges:!1}),console.log(`[AutoSave] é¡µé¢ ${n+1} å·²ä¿å­˜`)}catch(a){throw console.error(`[AutoSave] ä¿å­˜é¡µé¢ ${n+1} å¤±è´¥:`,a),a}}async function qn(){if(!Pt())return;const n=Tt||Po();if(!n||!Ut){console.log("[AutoSave] æœªæ‰§è¡Œé¢„ä¿å­˜ï¼Œè·³è¿‡å®Œæˆä¿å­˜");return}console.log("[AutoSave] å®Œæˆä¿å­˜...");const t=Qe(),s=It(),o=t.images.length;try{await In(n,{ui_settings:Vn(),total_pages:o,currentImageIndex:t.currentImageIndex});const a=s.currentBookId,u=s.currentChapterId;if(a&&u)try{const{apiClient:l}=await it(async()=>{const{apiClient:c}=await import("./client.Bht704G-.js");return{apiClient:c}},__vite__mapDeps([4,5]));await l.put(`/api/bookshelf/books/${a}/chapters/${u}/image-count`,{count:o}),console.log(`[AutoSave] å·²æ›´æ–°ç« èŠ‚å›¾ç‰‡æ•°é‡ä¸º ${o}`)}catch(l){console.warn("[AutoSave] æ›´æ–°ç« èŠ‚å›¾ç‰‡æ•°é‡å¤±è´¥ï¼ˆéè‡´å‘½ï¼‰:",l)}console.log("[AutoSave] ä¼šè¯ä¿å­˜å®Œæˆ")}catch(a){console.error("[AutoSave] å®Œæˆä¿å­˜å¤±è´¥:",a)}finally{Tt=null,Ut=!1}}function Hn(){Tt=null,Ut=!1,console.log("[AutoSave] ä¿å­˜çŠ¶æ€å·²é‡ç½®")}const mn={standard:["detection","ocr","color","translate","inpaint","render"],hq:["detection","ocr","color","aiTranslate","inpaint","render"],proofread:["aiTranslate","render"],removeText:["detection","inpaint","render"]},Kt={detection:"æ°”æ³¡æ£€æµ‹",ocr:"æ–‡å­—è¯†åˆ«",color:"é¢œè‰²æå–",translate:"ç¿»è¯‘",aiTranslate:"AIç¿»è¯‘",inpaint:"èƒŒæ™¯ä¿®å¤",render:"æ¸²æŸ“",save:"ä¿å­˜"};function Di(){const n=Qe(),t=gt(),s=Fe(),o=Mn(),a=ct(),{progress:u,reporter:l}=wi(),c=w(!1),g=w(null);let d=null,C="standard";const $=G(()=>c.value||n.isBatchTranslationInProgress),P=G(()=>u.value.percentage||0);function R(){const i=s.settings.translation.rpmLimit;g.value?g.value.setRpm(i):g.value=ha(i)}function _(i){const f=i.mode==="hq"?"hq":i.mode==="proofread"?"proofread":i.mode==="removeText"?"ocr":"normal";return o.validateBeforeTranslation(f)}function D(){const{textStyle:i}=s.settings,f=i.layoutDirection;d={fontFamily:i.fontFamily,fontSize:i.fontSize,autoFontSize:i.autoFontSize,autoTextDirection:f==="auto",textDirection:f==="auto"?"vertical":f,layoutDirection:f,fillColor:i.fillColor,textColor:i.textColor,rotationAngle:0,strokeEnabled:i.strokeEnabled,strokeColor:i.strokeColor,strokeWidth:i.strokeWidth,useAutoTextColor:i.useAutoTextColor,inpaintMethod:i.inpaintMethod}}function j(i){return i.includes("base64,")?i.split("base64,")[1]||"":i}function z(i){const f=n.images;if(i.scope==="current"){const v=n.currentImage;return v?[{image:v,index:n.currentImageIndex}]:[]}if(i.scope==="failed")return n.getFailedImageIndices().map(v=>({image:f[v],index:v})).filter(v=>v.image!==void 0);if(i.scope==="range"&&i.pageRange){const v=Math.max(0,i.pageRange.startPage-1),y=Math.min(f.length-1,i.pageRange.endPage-1);return v>y||v>=f.length?[]:f.slice(v,y+1).map((I,E)=>({image:I,index:v+E}))}return f.map((v,y)=>({image:v,index:y}))}async function L(i){const f=await Fn({imageIndex:i.imageIndex,image:i.image,forceDetect:!1});i.bubbleCoords=f.bubbleCoords,i.bubbleAngles=f.bubbleAngles,i.bubblePolygons=f.bubblePolygons,i.autoDirections=f.autoDirections,i.rawMask=f.rawMask,i.textlinesPerBubble=f.textlinesPerBubble,f.originalTexts&&(i.originalTexts=f.originalTexts)}async function b(i){const f=await Un({imageIndex:i.imageIndex,image:i.image,bubbleCoords:i.bubbleCoords,textlinesPerBubble:i.textlinesPerBubble});i.originalTexts=f.originalTexts}async function p(i){const f=await On({imageIndex:i.imageIndex,image:i.image,bubbleCoords:i.bubbleCoords,textlinesPerBubble:i.textlinesPerBubble});i.colors=f.colors}async function T(i){const f=await Ri({imageIndex:i.imageIndex,originalTexts:i.originalTexts,rateLimiter:g.value});i.translatedTexts=f.translatedTexts,i.textboxTexts=f.textboxTexts}async function k(i){const f=s.settings,v=C==="proofread",y=i.map(me=>v?{imageIndex:me.imageIndex,bubbles:(me.image.bubbleStates||[]).map((ve,$e)=>({bubbleIndex:$e,original:ve.originalText||"",translated:f.useTextboxPrompt?ve.textboxText||ve.translatedText||"":ve.translatedText||"",textDirection:ve.textDirection==="vertical"||ve.textDirection==="horizontal"?ve.textDirection:ve.autoTextDirection==="vertical"||ve.autoTextDirection==="horizontal"?ve.autoTextDirection:"vertical"}))}:{imageIndex:me.imageIndex,bubbles:me.originalTexts.map((ve,$e)=>({bubbleIndex:$e,original:ve,translated:"",textDirection:me.autoDirections[$e]||"vertical"}))}),I=i.map(me=>{const ve=v&&me.image.translatedDataURL||me.image.originalDataURL;return j(ve)}),E=v?f.proofreading.rounds[0]:f.hqTranslation,H=v?E?.prompt:f.hqTranslation.prompt,X=v?"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘æ ¡å¯¹åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹æ£€æŸ¥å’Œä¿®æ­£ç¿»è¯‘ã€‚":"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹å’Œä¸Šä¸‹æ–‡æä¾›é«˜è´¨é‡çš„ç¿»è¯‘ã€‚",r=f.hqTranslation,x=v?E:null,ne=await Lt({provider:(v?x?.provider:r.provider)||"openai",api_key:(v?x?.apiKey:r.apiKey)||"",model_name:(v?x?.modelName:r.modelName)||"",custom_base_url:v?x?.customBaseUrl:r.customBaseUrl,jsonData:y,imageBase64Array:I,prompt:H||"",systemPrompt:X,isProofreading:v,enableDebugLogs:f.enableVerboseLogs,low_reasoning:v?x?.lowReasoning:r.lowReasoning,force_json_output:v?x?.forceJsonOutput:r.forceJsonOutput,no_thinking_method:v?x?.noThinkingMethod:r.noThinkingMethod,use_stream:v?x?.useStream??!0:r.useStream,max_retries:v?f.proofreading.maxRetries||2:r.maxRetries||2}),M=v?x?.forceJsonOutput||!1:r.forceJsonOutput;let de=ee(ne,M)||y;if(v&&f.proofreading.rounds.length>1)for(let me=1;me<f.proofreading.rounds.length;me++){const ve=f.proofreading.rounds[me],$e=await Lt({provider:ve.provider,api_key:ve.apiKey,model_name:ve.modelName,custom_base_url:ve.customBaseUrl,jsonData:de,imageBase64Array:I,prompt:ve.prompt,systemPrompt:X,isProofreading:!0,enableDebugLogs:f.enableVerboseLogs,low_reasoning:ve.lowReasoning,force_json_output:ve.forceJsonOutput,no_thinking_method:ve.noThinkingMethod,use_stream:ve.useStream??!0,max_retries:ve.maxRetries||f.proofreading.maxRetries||2}),Pe=ee($e,ve.forceJsonOutput);Pe&&(de=Pe)}for(const me of i){const ve=de?.find($e=>$e.imageIndex===me.imageIndex);ve?me.translatedTexts=ve.bubbles.map($e=>$e.translated):me.translatedTexts=[],me.textboxTexts=[]}}async function N(i){const f=await zn({imageIndex:i.imageIndex,image:i.image,bubbleCoords:i.bubbleCoords,bubblePolygons:i.bubblePolygons,rawMask:i.rawMask});i.cleanImage=f.cleanImage}async function O(i){const f=await Nn({imageIndex:i.imageIndex,cleanImage:i.cleanImage,bubbleCoords:i.bubbleCoords,bubbleAngles:i.bubbleAngles,autoDirections:i.autoDirections,originalTexts:i.originalTexts,translatedTexts:i.translatedTexts,textboxTexts:i.textboxTexts,colors:i.colors,savedTextStyles:d,currentMode:C});i.finalImage=f.finalImage,i.bubbleStates=f.bubbleStates}function ee(i,f){if(!i.success)return console.error("APIè°ƒç”¨å¤±è´¥:",i.error),null;if(i.results&&i.results.length>0){const y=i.results[0];if(y&&"imageIndex"in y&&"bubbles"in y)return i.results}const v=i.content;if(v){let y=null;if(f)try{y=JSON.parse(v)}catch{return null}else{const I=v.match(/```json\s*([\s\S]*?)\s*```/);if(I?.[1])try{y=JSON.parse(I[1])}catch{return null}}if(y){if(Array.isArray(y))return y;if(typeof y=="object"&&"imageIndex"in y&&"bubbles"in y)return console.log("[parseHqResponse] æ£€æµ‹åˆ°å•å¼ å›¾ç‰‡æ ¼å¼ï¼Œè‡ªåŠ¨åŒ…è£…ä¸ºæ•°ç»„"),[y]}}return null}async function J(i,f){switch(i){case"detection":await L(f);break;case"ocr":await b(f);break;case"color":await p(f);break;case"translate":await T(f);break;case"inpaint":await N(f);break;case"render":await O(f);break;case"save":await Kn(f.imageIndex);break;case"aiTranslate":throw new Error("aiTranslate åº”é€šè¿‡æ‰¹é‡å¤„ç†é€»è¾‘è°ƒç”¨")}}function ae(i){const f=i.finalImage?`data:image/png;base64,${i.finalImage}`:i.cleanImage?`data:image/png;base64,${i.cleanImage}`:null,{textStyle:v}=s.settings;n.updateImageByIndex(i.imageIndex,{translatedDataURL:f,cleanImageData:i.cleanImage||null,bubbleStates:i.bubbleStates,bubbleCoords:i.bubbleCoords,bubbleAngles:i.bubbleAngles,originalTexts:i.originalTexts,textboxTexts:i.textboxTexts,bubbleTexts:i.translatedTexts,translationStatus:"completed",translationFailed:!1,showOriginal:!1,hasUnsavedChanges:!0,fontSize:d?.fontSize??v.fontSize,autoFontSize:d?.autoFontSize??v.autoFontSize,fontFamily:d?.fontFamily??v.fontFamily,layoutDirection:d?.layoutDirection??v.layoutDirection,textColor:d?.textColor??v.textColor,fillColor:d?.fillColor??v.fillColor,strokeEnabled:d?.strokeEnabled??v.strokeEnabled,strokeColor:d?.strokeColor??v.strokeColor,strokeWidth:d?.strokeWidth??v.strokeWidth,inpaintMethod:d?.inpaintMethod??v.inpaintMethod,useAutoTextColor:d?.useAutoTextColor??v.useAutoTextColor}),i.imageIndex===n.currentImageIndex&&i.bubbleStates&&t.setBubbles(i.bubbleStates)}function U(i){return i==="standard"||i==="removeText"}function Q(i){const f=s.settings;return i==="hq"?f.hqTranslation.batchSize||5:i==="proofread"?f.proofreading.rounds[0]?.batchSize||5:1}async function ie(i,f,v,y){let I=0,E=0;for(let H=0;H<i.length;H++){const X=i[H];if(v.scope==="all"&&!n.isBatchTranslationInProgress){console.log("â¹ï¸ æ‰¹é‡ç¿»è¯‘å·²å–æ¶ˆï¼Œåœæ­¢å¤„ç†");break}const r=Math.floor(H/i.length*90);l.setPercentage(r,`å¤„ç†å›¾ç‰‡ ${H+1}/${i.length}`),a.info(`å¤„ç†å›¾ç‰‡ ${H+1}/${i.length}...`),n.setTranslationStatus(X.imageIndex,"processing");let x=!1;for(let ne=0;ne<f.length;ne++){const M=f[ne];if(x)break;g.value&&await g.value.acquire();try{const Z=r+Math.floor(ne/f.length*(90/i.length));l.setPercentage(Z,`å›¾ç‰‡ ${H+1}: ${Kt[M]}`),await J(M,X)}catch(Z){const de=Z instanceof Error?Z.message:"æœªçŸ¥é”™è¯¯";y.push(`å›¾ç‰‡ ${X.imageIndex+1}: ${M} - ${de}`),n.setTranslationStatus(X.imageIndex,"failed",de),x=!0,E++}}x||(ae(X),I++,console.log(`âœ… å›¾ç‰‡ ${H+1}/${i.length} å¤„ç†å®Œæˆ`))}return{completed:I,failed:E}}async function F(i,f,v,y){let I=0,E=0;const H=Q(v.mode),X=Math.ceil(i.length/H),r=f.indexOf("aiTranslate"),x=r>=0?f.slice(0,r):f,ne=r>=0?f.slice(r+1):[];console.log(`ğŸ“¦ æ‰¹æ¬¡å¤„ç†æ¨¡å¼ï¼šå…± ${i.length} å¼ å›¾ç‰‡ï¼Œæ¯æ‰¹ ${H} å¼ ï¼Œå…± ${X} æ‰¹`),console.log(`   AIç¿»è¯‘å‰æ­¥éª¤: [${x.join(" â†’ ")}]`),console.log(`   AIç¿»è¯‘åæ­¥éª¤: [${ne.join(" â†’ ")}]`);for(let M=0;M<X;M++){if(v.scope==="all"&&!n.isBatchTranslationInProgress){console.log("â¹ï¸ æ‰¹é‡ç¿»è¯‘å·²å–æ¶ˆï¼Œåœæ­¢å¤„ç†");break}const Z=M*H,de=Math.min(Z+H,i.length),me=i.slice(Z,de),ve=Math.floor(M/X*90);l.setPercentage(ve,`å¤„ç†æ‰¹æ¬¡ ${M+1}/${X}`),a.info(`å¤„ç†æ‰¹æ¬¡ ${M+1}/${X}ï¼ˆå›¾ç‰‡ ${Z+1}-${de}ï¼‰...`);for(const Pe of me)n.setTranslationStatus(Pe.imageIndex,"processing");const $e=new Set;for(let Pe=0;Pe<me.length;Pe++){const le=me[Pe];for(const S of x){if($e.has(le.imageIndex))break;g.value&&await g.value.acquire();try{const Y=ve+Math.floor(Pe/me.length*30);l.setPercentage(Y,`å›¾ç‰‡ ${Z+Pe+1}: ${Kt[S]}`),await J(S,le)}catch(Y){const be=Y instanceof Error?Y.message:"æœªçŸ¥é”™è¯¯";y.push(`å›¾ç‰‡ ${le.imageIndex+1}: ${S} - ${be}`),n.setTranslationStatus(le.imageIndex,"failed",be),$e.add(le.imageIndex)}}}if(r>=0){const Pe=ve+40;l.setPercentage(Pe,`æ‰¹æ¬¡ ${M+1}: ${Kt.aiTranslate}`);try{const le=me.filter(S=>!$e.has(S.imageIndex));le.length>0&&await k(le)}catch(le){const S=le instanceof Error?le.message:"æœªçŸ¥é”™è¯¯";y.push(`æ‰¹æ¬¡ ${M+1} AIç¿»è¯‘å¤±è´¥: ${S}`);for(const Y of me)$e.has(Y.imageIndex)||(n.setTranslationStatus(Y.imageIndex,"failed",S),$e.add(Y.imageIndex))}}for(let Pe=0;Pe<me.length;Pe++){const le=me[Pe];if(!$e.has(le.imageIndex)){for(const S of ne){if($e.has(le.imageIndex))break;g.value&&await g.value.acquire();try{const Y=ve+50+Math.floor(Pe/me.length*40);l.setPercentage(Y,`å›¾ç‰‡ ${Z+Pe+1}: ${Kt[S]}`),await J(S,le)}catch(Y){const be=Y instanceof Error?Y.message:"æœªçŸ¥é”™è¯¯";y.push(`å›¾ç‰‡ ${le.imageIndex+1}: ${S} - ${be}`),n.setTranslationStatus(le.imageIndex,"failed",be),$e.add(le.imageIndex)}}$e.has(le.imageIndex)||(ae(le),I++,console.log(`âœ… å›¾ç‰‡ ${Z+Pe+1} å¤„ç†å®Œæˆ`))}}E+=$e.size,console.log(`âœ… æ‰¹æ¬¡ ${M+1}/${X} å¤„ç†å®Œæˆ`)}return{completed:I,failed:E}}async function h(i){if(!_(i))return{success:!1,completed:0,failed:0,errors:["é…ç½®éªŒè¯å¤±è´¥"]};if(n.images.length===0)return a.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),{success:!1,completed:0,failed:0,errors:["æ²¡æœ‰å›¾ç‰‡"]};C=i.mode;const v=U(i.mode);c.value=!0,(i.scope==="all"||i.scope==="failed")&&n.setBatchTranslationInProgress(!0),R(),D();const y=z(i),I=[];if(d&&y.length>1){console.log(`ğŸ“ é¢„åˆ†å‘æ–‡å­—è®¾ç½®åˆ° ${y.length} å¼ å¾…ç¿»è¯‘å›¾ç‰‡...`);for(const{index:r}of y)n.updateImageByIndex(r,{fontSize:d.fontSize,autoFontSize:d.autoFontSize,fontFamily:d.fontFamily,layoutDirection:d.layoutDirection,textColor:d.textColor,fillColor:d.fillColor,strokeEnabled:d.strokeEnabled,strokeColor:d.strokeColor,strokeWidth:d.strokeWidth,inpaintMethod:d.inpaintMethod,useAutoTextColor:d.useAutoTextColor})}const E=Pt();let H=[...mn[i.mode]];if(i.mode==="removeText"&&s.settings.removeTextWithOcr){const r=H.indexOf("detection");r!==-1&&H.splice(r+1,0,"ocr")}E&&H.push("save"),console.log("ğŸš€ é¡ºåºç®¡çº¿å¯åŠ¨"),console.log(`   æ¨¡å¼: ${i.mode}`),console.log(`   å¤„ç†æ–¹å¼: ${v?"é€å¼ å¤„ç†":"æ‰¹æ¬¡å¤„ç†"}`),console.log(`   æ­¥éª¤é“¾: [${H.join(" â†’ ")}]`),console.log(`   è‡ªåŠ¨ä¿å­˜: ${E?"å¯ç”¨":"ç¦ç”¨"}`);const X=y.map(({image:r,index:x})=>{const ne={imageIndex:x,image:r,bubbleCoords:[],bubbleAngles:[],bubblePolygons:[],autoDirections:[],textlinesPerBubble:[],originalTexts:[],colors:[],translatedTexts:[],textboxTexts:[]};return i.mode==="proofread"&&r.bubbleStates&&r.bubbleStates.length>0&&(ne.bubbleCoords=r.bubbleStates.map(M=>M.coords),ne.bubbleAngles=r.bubbleStates.map(M=>M.rotationAngle||0),ne.autoDirections=r.bubbleStates.map(M=>M.autoTextDirection||M.textDirection||"vertical"),ne.originalTexts=r.bubbleStates.map(M=>M.originalText||""),ne.translatedTexts=r.bubbleStates.map(M=>M.translatedText||""),ne.textboxTexts=r.bubbleStates.map(M=>M.textboxText||""),ne.colors=r.bubbleStates.map(M=>({textColor:M.textColor||"",bgColor:M.fillColor||"",autoFgColor:M.autoFgColor||null,autoBgColor:M.autoBgColor||null})),r.cleanImageData&&(ne.cleanImage=r.cleanImageData)),ne});try{l.init(y.length,`${i.mode} æ¨¡å¼å¯åŠ¨...`),E&&(l.setPercentage(0,"é¢„ä¿å­˜åŸå§‹å›¾ç‰‡..."),await Wn({onStart:M=>{l.setPercentage(0,`é¢„ä¿å­˜åŸå§‹å›¾ç‰‡ 0/${M}...`)},onProgress:(M,Z)=>{const de=Math.round(M/Z*10);l.setPercentage(de,`é¢„ä¿å­˜åŸå§‹å›¾ç‰‡ ${M}/${Z}...`)},onComplete:()=>{l.setPercentage(10,"é¢„ä¿å­˜å®Œæˆï¼Œå¼€å§‹ç¿»è¯‘...")},onError:M=>{l.setPercentage(0,`é¢„ä¿å­˜å¤±è´¥: ${M}`)}})||a.warning("é¢„ä¿å­˜å¤±è´¥ï¼Œç¿»è¯‘å®Œæˆåè¯·æ‰‹åŠ¨ä¿å­˜"));let r;v?r=await ie(X,H,i,I):r=await F(X,H,i,I),l.setPercentage(100,"å®Œæˆï¼");const x={standard:"ç¿»è¯‘",hq:"é«˜è´¨é‡ç¿»è¯‘",proofread:"AIæ ¡å¯¹",removeText:"æ¶ˆé™¤æ–‡å­—"};return a.success(`${x[i.mode]}å®Œæˆï¼`),{success:r.failed===0,completed:r.completed,failed:r.failed,errors:I.length>0?I:void 0}}catch(r){const x=r instanceof Error?r.message:"æ‰§è¡Œå¤±è´¥";return a.error(x),I.push(x),{success:!1,completed:0,failed:y.length,errors:I}}finally{c.value=!1,n.setBatchTranslationInProgress(!1),E&&await qn();const r=n.currentImageIndex,x=n.images[r];x?.bubbleStates&&x.bubbleStates.length>0&&t.setBubbles(x.bubbleStates),setTimeout(()=>l.finish(),1e3)}}function m(){n.isBatchTranslationInProgress&&(n.setBatchTranslationInProgress(!1),Hn(),a.info("æ“ä½œå·²å–æ¶ˆ"))}return{progress:u,isExecuting:c,isTranslating:$,progressPercent:P,execute:h,cancel:m,STEP_CHAIN_CONFIGS:mn}}class Mi{currentCount=0;maxCount;waitQueue=[];holders=[];constructor(t=1){this.maxCount=Math.max(1,t)}setSize(t){this.maxCount=Math.max(1,t),this.tryWakeUp()}getSize(){return this.maxCount}async acquire(t){if(this.currentCount<this.maxCount){this.currentCount++,this.holders.push(t);return}return new Promise(s=>{this.waitQueue.push({resolve:s,poolName:t})})}release(t){const s=this.holders.indexOf(t);s>=0&&(this.holders.splice(s,1),this.currentCount--),this.tryWakeUp()}tryWakeUp(){for(;this.currentCount<this.maxCount&&this.waitQueue.length>0;){const t=this.waitQueue.shift();this.currentCount++,this.holders.push(t.poolName),t.resolve()}}async withLock(t,s){await this.acquire(t);try{return await s()}finally{this.release(t)}}getStatus(){return{isLocked:this.currentCount>=this.maxCount,currentCount:this.currentCount,maxCount:this.maxCount,holders:[...this.holders],waitingCount:this.waitQueue.length,waitingPools:this.waitQueue.map(t=>t.poolName)}}isWaiting(t){return this.waitQueue.some(s=>s.poolName===t)}isHolding(t){return this.holders.includes(t)}reset(){this.currentCount=0,this.holders=[];for(const t of this.waitQueue)t.resolve();this.waitQueue=[]}}class Rt{queue=[];currentTask=null;isRunning=!1;isCancelled=!1;completedCount=0;nextPool;name;icon;lock;progressTracker;onTaskComplete;constructor(t,s,o,a,u,l){this.name=t,this.icon=s,this.nextPool=o,this.lock=a,this.progressTracker=u,this.onTaskComplete=l}getName(){return this.name}getIcon(){return this.icon}setNextPool(t){this.nextPool=t}enqueue(t){this.isCancelled||(this.queue.push(t),this.progressTracker.updatePool(this.name,{waiting:this.queue.length}),this.tryProcessNext())}enqueueBatch(t){if(!this.isCancelled){for(const s of t)this.queue.push(s);this.progressTracker.updatePool(this.name,{waiting:this.queue.length}),this.tryProcessNext()}}async tryProcessNext(){if(!(this.isRunning||this.isCancelled||this.queue.length===0)){this.isRunning=!0,this.currentTask=this.queue.shift(),this.progressTracker.updatePool(this.name,{waiting:this.queue.length,isProcessing:!0,currentPage:this.currentTask.imageIndex+1,isWaitingLock:!1});try{let t;this.lock?(this.progressTracker.updatePool(this.name,{isWaitingLock:!0}),t=await this.lock.withLock(this.name,async()=>(this.progressTracker.updatePool(this.name,{isWaitingLock:!1}),await this.process(this.currentTask)))):t=await this.process(this.currentTask),this.completedCount++,this.progressTracker.updatePool(this.name,{completed:this.completedCount}),this.nextPool&&t.status!=="failed"&&t.status!=="buffered"&&this.nextPool.enqueue(t),this.onTaskComplete?.(t)}catch(t){this.currentTask.status="failed",this.currentTask.error=t.message,console.error(`[${this.name}] å¤„ç†ä»»åŠ¡å¤±è´¥:`,t),this.onTaskComplete?.(this.currentTask)}finally{this.currentTask=null,this.isRunning=!1,this.progressTracker.updatePool(this.name,{isProcessing:!1,currentPage:void 0}),this.tryProcessNext()}}}getStatus(){return{name:this.name,icon:this.icon,waiting:this.queue.length,processing:this.isRunning,currentPage:this.currentTask?.imageIndex,completed:this.completedCount,isWaitingLock:this.lock?.isWaiting(this.name)??!1}}cancel(){this.isCancelled=!0,this.queue=[]}reset(){this.isCancelled=!1,this.queue=[],this.currentTask=null,this.isRunning=!1,this.completedCount=0}getCompletedCount(){return this.completedCount}getWaitingCount(){return this.queue.length}isProcessing(){return this.isRunning}}const Bi=[{name:"æ£€æµ‹",icon:"ğŸ“"},{name:"OCR",icon:"ğŸ“–"},{name:"é¢œè‰²",icon:"ğŸ¨"},{name:"ç¿»è¯‘",icon:"ğŸŒ"},{name:"ä¿®å¤",icon:"ğŸ–Œï¸"},{name:"æ¸²æŸ“",icon:"âœ¨"}];class Ei{poolStatuses=new Map;totalPages=0;startTime=0;progress=_o({pools:[],totalCompleted:0,totalFailed:0,totalPages:0,estimatedTimeRemaining:0});constructor(){this.initPools()}initPools(){for(const t of Bi){const s={name:t.name,icon:t.icon,waiting:0,processing:!1,completed:0,isWaitingLock:!1};this.poolStatuses.set(t.name,s)}this.syncToReactive()}init(t){this.totalPages=t,this.startTime=Date.now();for(const s of this.poolStatuses.values())s.waiting=0,s.processing=!1,s.currentPage=void 0,s.completed=0,s.isWaitingLock=!1;this.progress.totalCompleted=0,this.progress.totalFailed=0,this.progress.totalPages=t,this.progress.estimatedTimeRemaining=0,this.syncToReactive()}updatePool(t,s){const o=this.poolStatuses.get(t);o&&(s.waiting!==void 0&&(o.waiting=s.waiting),s.isProcessing!==void 0&&(o.processing=s.isProcessing),s.currentPage!==void 0&&(o.currentPage=s.currentPage),s.completed!==void 0&&(o.completed=s.completed),s.isWaitingLock!==void 0&&(o.isWaitingLock=s.isWaitingLock),this.syncToReactive(),this.updateEstimatedTime())}incrementCompleted(){this.progress.totalCompleted++,this.updateEstimatedTime()}incrementFailed(){this.progress.totalFailed++}updateEstimatedTime(){if(this.progress.totalCompleted===0){this.progress.estimatedTimeRemaining=0;return}const s=(Date.now()-this.startTime)/1e3/this.progress.totalCompleted,o=this.totalPages-this.progress.totalCompleted-this.progress.totalFailed;this.progress.estimatedTimeRemaining=Math.ceil(s*o)}syncToReactive(){this.progress.pools=Array.from(this.poolStatuses.values()).map(t=>({...t}))}getPoolStatus(t){return this.poolStatuses.get(t)}getAllPoolStatuses(){return Array.from(this.poolStatuses.values())}getProgress(){return{...this.progress}}reset(){this.totalPages=0,this.startTime=0,this.initPools()}formatRemainingTime(){const t=this.progress.estimatedTimeRemaining;if(t<=0)return"--";const s=Math.floor(t/60),o=t%60;return s>0?`${s}åˆ†${o}ç§’`:`${o}ç§’`}}class Ai{results=new Map;totalExpected=0;completedCount=0;failedCount=0;resolveWaitAll=null;init(t){this.results.clear(),this.totalExpected=t,this.completedCount=0,this.failedCount=0,this.resolveWaitAll=null}add(t){this.results.has(t.imageIndex)||(this.results.set(t.imageIndex,t),t.status==="completed"?this.completedCount++:t.status==="failed"&&this.failedCount++,this.completedCount+this.failedCount>=this.totalExpected&&this.resolveWaitAll&&(this.resolveWaitAll({success:this.completedCount,failed:this.failedCount}),this.resolveWaitAll=null))}waitForAll(t){return this.totalExpected=t,this.completedCount+this.failedCount>=t?Promise.resolve({success:this.completedCount,failed:this.failedCount}):new Promise(s=>{this.resolveWaitAll=s})}get(t){return this.results.get(t)}getAll(){return Array.from(this.results.values()).sort((t,s)=>t.imageIndex-s.imageIndex)}getSuccessful(){return this.getAll().filter(t=>t.status==="completed")}getFailed(){return this.getAll().filter(t=>t.status==="failed")}getStats(){return{total:this.totalExpected,completed:this.completedCount,failed:this.failedCount,pending:this.totalExpected-this.completedCount-this.failedCount}}reset(){this.results.clear(),this.totalExpected=0,this.completedCount=0,this.failedCount=0,this.resolveWaitAll=null}}class Li extends Rt{constructor(t,s,o,a){super("æ£€æµ‹","ğŸ“",t,s,o,a)}async process(t){const{imageData:s}=t,o=await Fn({imageIndex:t.imageIndex,image:s,forceDetect:!1});return t.detectionResult={bubbleCoords:o.bubbleCoords,bubbleAngles:o.bubbleAngles,bubblePolygons:o.bubblePolygons,autoDirections:o.autoDirections,rawMask:o.rawMask,textlinesPerBubble:o.textlinesPerBubble},t.status="processing",t}}class Fi extends Rt{constructor(t,s,o,a){super("OCR","ğŸ“–",t,s,o,a)}async process(t){const{imageData:s,detectionResult:o}=t;if(!o||o.bubbleCoords.length===0)return t.ocrResult={originalTexts:[],textlinesPerBubble:[]},t.status="processing",t;const a=await Un({imageIndex:t.imageIndex,image:s,bubbleCoords:o.bubbleCoords,textlinesPerBubble:o.textlinesPerBubble||[]});return t.ocrResult={originalTexts:a.originalTexts,textlinesPerBubble:o.textlinesPerBubble||[]},t.status="processing",t}}class Ui extends Rt{constructor(t,s,o,a){super("é¢œè‰²","ğŸ¨",t,s,o,a)}async process(t){const{imageData:s,detectionResult:o,ocrResult:a}=t;if(!o||o.bubbleCoords.length===0)return t.colorResult={colors:[]},t.status="processing",t;const u=await On({imageIndex:t.imageIndex,image:s,bubbleCoords:o.bubbleCoords,textlinesPerBubble:a?.textlinesPerBubble||o.textlinesPerBubble||[]});return t.colorResult={colors:u.colors},t.status="processing",t}}class Oi extends Rt{mode="standard";batchBuffer=[];totalTasks=0;processedCount=0;constructor(t,s,o){super("ç¿»è¯‘","ğŸŒ",t,null,s,o)}setMode(t,s,o){this.mode=t,this.totalTasks=s,this.batchBuffer=[],this.processedCount=0,this.nextPool=o}async process(t){switch(this.mode){case"standard":return this.handleStandardTranslate(t);case"hq":return this.handleHqTranslate(t);case"proofread":return this.handleProofread(t);case"removeText":return this.handleRemoveTextOnly(t);default:return t}}async handleStandardTranslate(t){const o=Fe().settings;if(!t.ocrResult||t.ocrResult.originalTexts.length===0)return t.translateResult={translatedTexts:[],textboxTexts:[]},t.status="processing",t;const a=o.translation.translationMode||"batch",u=t.ocrResult.originalTexts;if(a==="single"){console.log(`[å¹¶è¡Œç¿»è¯‘æ± ] ä½¿ç”¨é€æ°”æ³¡ç¿»è¯‘æ¨¡å¼ï¼Œå›¾ç‰‡ ${t.imageIndex}ï¼Œå…± ${u.length} ä¸ªæ°”æ³¡`);const l=[],c=[];for(let g=0;g<u.length;g++){const d=u[g];if(!d||d.trim()===""){l.push(""),o.useTextboxPrompt&&c.push("");continue}try{const C=o.translation.isJsonMode?o.translation.singleJsonPrompt:o.translation.singleNormalPrompt,$=await At({original_text:d,model_provider:o.translation.provider,model_name:o.translation.modelName,api_key:o.translation.apiKey,custom_base_url:o.translation.customBaseUrl,target_language:o.targetLanguage,prompt_content:C,use_json_format:o.translation.isJsonMode,rpm_limit_translation:o.translation.rpmLimit,max_retries:o.translation.maxRetries});if($.success&&$.data?l.push($.data.translated_text||""):(console.warn(`[å¹¶è¡Œç¿»è¯‘æ± ] æ°”æ³¡ ${g+1} ç¿»è¯‘å¤±è´¥: ${$.error}`),l.push("ã€ç¿»è¯‘å¤±è´¥ã€‘è¯·æ£€æŸ¥ç»ˆç«¯ä¸­çš„é”™è¯¯æ—¥å¿—")),o.useTextboxPrompt&&o.textboxPrompt){const P=await At({original_text:d,model_provider:o.translation.provider,model_name:o.translation.modelName,api_key:o.translation.apiKey,custom_base_url:o.translation.customBaseUrl,target_language:o.targetLanguage,prompt_content:o.textboxPrompt,rpm_limit_translation:o.translation.rpmLimit,max_retries:o.translation.maxRetries});P.success&&P.data?c.push(P.data.translated_text||""):c.push("")}}catch(C){console.error(`[å¹¶è¡Œç¿»è¯‘æ± ] æ°”æ³¡ ${g+1} ç¿»è¯‘å‡ºé”™:`,C),l.push("ã€ç¿»è¯‘å¤±è´¥ã€‘è¯·æ£€æŸ¥ç»ˆç«¯ä¸­çš„é”™è¯¯æ—¥å¿—"),o.useTextboxPrompt&&c.push("")}}t.translateResult={translatedTexts:l,textboxTexts:c}}else{console.log(`[å¹¶è¡Œç¿»è¯‘æ± ] ä½¿ç”¨æ•´é¡µæ‰¹é‡ç¿»è¯‘æ¨¡å¼ï¼Œå›¾ç‰‡ ${t.imageIndex}ï¼Œå…± ${u.length} ä¸ªæ°”æ³¡`);const l=await To({original_texts:u,target_language:o.targetLanguage,source_language:o.sourceLanguage,model_provider:o.translation.provider,model_name:o.translation.modelName,api_key:o.translation.apiKey,custom_base_url:o.translation.customBaseUrl,prompt_content:o.translatePrompt,textbox_prompt_content:o.textboxPrompt,use_textbox_prompt:o.useTextboxPrompt,rpm_limit:o.translation.rpmLimit,max_retries:o.translation.maxRetries,use_json_format:o.translation.isJsonMode});if(!l.success)throw new Error(l.error||"ç¿»è¯‘å¤±è´¥");t.translateResult={translatedTexts:l.translated_texts||[],textboxTexts:l.textbox_texts||[]}}return t.status="processing",t}async handleHqTranslate(t){this.batchBuffer.push(t),this.processedCount++;const s=Fe(),{hqTranslation:o}=s.settings,a=o.batchSize||3,u=this.processedCount>=this.totalTasks;if(!(this.batchBuffer.length>=a||u))return t.status="buffered",t;const c=[...this.batchBuffer];this.batchBuffer=[];const g=c.map(P=>({imageIndex:P.imageIndex,bubbles:(P.ocrResult?.originalTexts||[]).map((R,_)=>({bubbleIndex:_,original:R,translated:"",textDirection:P.detectionResult?.autoDirections[_]||"vertical"}))})),d=c.map(P=>this.extractBase64(P.imageData.originalDataURL)),C=await Lt({provider:o.provider,api_key:o.apiKey,model_name:o.modelName,custom_base_url:o.customBaseUrl,jsonData:g,imageBase64Array:d,prompt:o.prompt,systemPrompt:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹å’Œä¸Šä¸‹æ–‡æä¾›é«˜è´¨é‡çš„ç¿»è¯‘ã€‚",isProofreading:!1,enableDebugLogs:s.settings.enableVerboseLogs,low_reasoning:o.lowReasoning,force_json_output:o.forceJsonOutput,no_thinking_method:o.noThinkingMethod,use_stream:o.useStream,max_retries:o.maxRetries||2}),$=this.parseHqResponse(C,o.forceJsonOutput);for(const P of c){const R=$?.find(_=>_.imageIndex===P.imageIndex);R?P.translateResult={translatedTexts:R.bubbles.map(_=>_.translated),textboxTexts:[]}:P.translateResult={translatedTexts:[],textboxTexts:[]},P.status="processing",this.nextPool&&this.nextPool.enqueue(P)}return t.status="buffered",t}async handleProofread(t){this.batchBuffer.push(t),this.processedCount++;const s=Fe(),{proofreading:o,useTextboxPrompt:a}=s.settings,u=o.rounds[0]?.batchSize||3,l=this.processedCount>=this.totalTasks;if(!(this.batchBuffer.length>=u||l))return t.status="buffered",t;const g=[...this.batchBuffer];this.batchBuffer=[];const d=g.map(P=>({imageIndex:P.imageIndex,bubbles:(P.imageData.bubbleStates||[]).map((R,_)=>({bubbleIndex:_,original:R.originalText||"",translated:a?R.textboxText||R.translatedText||"":R.translatedText||"",textDirection:R.textDirection==="vertical"||R.textDirection==="horizontal"?R.textDirection:R.autoTextDirection==="vertical"||R.autoTextDirection==="horizontal"?R.autoTextDirection:"vertical"}))})),C=g.map(P=>{const R=P.imageData.translatedDataURL||P.imageData.originalDataURL;return this.extractBase64(R)});let $=d;for(const P of o.rounds){const R=await Lt({provider:P.provider,api_key:P.apiKey,model_name:P.modelName,custom_base_url:P.customBaseUrl,jsonData:$,imageBase64Array:C,prompt:P.prompt,systemPrompt:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘æ ¡å¯¹åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹æ£€æŸ¥å’Œä¿®æ­£ç¿»è¯‘ã€‚",isProofreading:!0,enableDebugLogs:s.settings.enableVerboseLogs,low_reasoning:P.lowReasoning,force_json_output:P.forceJsonOutput,no_thinking_method:P.noThinkingMethod,use_stream:P.useStream??!0,max_retries:P.maxRetries||o.maxRetries||2}),_=this.parseHqResponse(R,P.forceJsonOutput);_&&($=_)}for(const P of g){const R=$.find(_=>_.imageIndex===P.imageIndex);R?P.translateResult={translatedTexts:R.bubbles.map(_=>_.translated),textboxTexts:[]}:P.translateResult={translatedTexts:[],textboxTexts:[]},P.status="processing",this.nextPool&&this.nextPool.enqueue(P)}return t.status="buffered",t}async handleRemoveTextOnly(t){return t.translateResult={translatedTexts:[],textboxTexts:[]},t.status="processing",t}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}parseHqResponse(t,s){if(!t.success)return console.error("APIè°ƒç”¨å¤±è´¥:",t.error),null;if(t.results&&t.results.length>0){const a=t.results[0];if(a&&"imageIndex"in a&&"bubbles"in a)return t.results}const o=t.content;if(o){let a=null;if(s)try{a=JSON.parse(o)}catch(u){return console.error("è§£æAIå¼ºåˆ¶JSONè¿”å›çš„å†…å®¹å¤±è´¥:",u),null}else{const u=o.match(/```json\s*([\s\S]*?)\s*```/);if(u?.[1])try{a=JSON.parse(u[1])}catch(l){return console.error("è§£æAIè¿”å›çš„JSONå¤±è´¥:",l),null}}if(a){if(Array.isArray(a))return a;if(typeof a=="object"&&"imageIndex"in a&&"bubbles"in a)return console.log("[TranslatePool.parseHqResponse] æ£€æµ‹åˆ°å•å¼ å›¾ç‰‡æ ¼å¼ï¼Œè‡ªåŠ¨åŒ…è£…ä¸ºæ•°ç»„"),[a]}}return null}}class zi extends Rt{constructor(t,s,o,a){super("ä¿®å¤","ğŸ–Œï¸",t,s,o,a)}async process(t){const{imageData:s,detectionResult:o}=t;if(!o||o.bubbleCoords.length===0){const u=l=>l.includes("base64,")?l.split("base64,")[1]||"":l;return t.inpaintResult={cleanImage:u(s.originalDataURL)},t.status="processing",t}const a=await zn({imageIndex:t.imageIndex,image:s,bubbleCoords:o.bubbleCoords,bubblePolygons:o.bubblePolygons,rawMask:o.rawMask});return t.inpaintResult={cleanImage:a.cleanImage},t.status="processing",t}}const bt=_o({pools:[{name:"æ£€æµ‹",icon:"ğŸ“",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"OCR",icon:"ğŸ“–",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"é¢œè‰²",icon:"ğŸ¨",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"ç¿»è¯‘",icon:"ğŸŒ",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"ä¿®å¤",icon:"ğŸ–Œï¸",waiting:0,processing:!1,completed:0,isWaitingLock:!1},{name:"æ¸²æŸ“",icon:"âœ¨",waiting:0,processing:!1,completed:0,isWaitingLock:!1}],totalCompleted:0,totalFailed:0,totalPages:0,estimatedTimeRemaining:0,preSave:void 0,save:void 0}),Ni=w(!1);function Ro(){const n=Qe(),t=Fe(),s=Ds(null),o=G(()=>t.settings.parallel),a=G(()=>o.value?.enabled??!1),u=Ni,l=G(()=>bt);function c(){const P=t.settings;return P.proofreading?.enabled&&P.proofreading.rounds.length>0?"proofread":["gemini","openai","claude","deepseek"].includes(P.hqTranslation?.provider||"")&&P.hqTranslation?.apiKey?"hq":"standard"}function g(){if(!s.value)return;const P=s.value.progress;P&&(bt.pools=P.pools.map(R=>({...R})),bt.totalCompleted=P.totalCompleted,bt.totalFailed=P.totalFailed,bt.totalPages=P.totalPages,bt.estimatedTimeRemaining=P.estimatedTimeRemaining)}async function d(P,R,_=0){if(u.value)return{success:0,failed:0,errors:["ç¿»è¯‘æ­£åœ¨è¿›è¡Œä¸­"]};const D=R??n.images;if(D.length===0)return{success:0,failed:0,errors:["æ²¡æœ‰å›¾ç‰‡"]};u.value=!0,bt.totalPages=D.length,bt.totalCompleted=0,bt.totalFailed=0;const j=setInterval(g,200);try{s.value=Ki({enabled:!0,deepLearningLockSize:o.value?.deepLearningLockSize??1});const z=P??c();console.log(`ğŸš€ å¼€å§‹å¹¶è¡Œç¿»è¯‘ï¼Œæ¨¡å¼: ${z}ï¼Œå›¾ç‰‡æ•°: ${D.length}ï¼Œèµ·å§‹ç´¢å¼•: ${_}`);const L=await s.value.execute(D,z,_);return g(),console.log(`âœ… å¹¶è¡Œç¿»è¯‘å®Œæˆï¼ŒæˆåŠŸ: ${L.success}ï¼Œå¤±è´¥: ${L.failed}`),L}catch(z){return console.error("å¹¶è¡Œç¿»è¯‘å‡ºé”™:",z),{success:0,failed:D.length,errors:[z.message]}}finally{clearInterval(j),u.value=!1}}function C(){s.value&&s.value.cancel(),u.value=!1}function $(){s.value=null,u.value=!1}return{isEnabled:a,isRunning:u,progress:l,executeParallel:d,cancel:C,reset:$,determineMode:c}}class Vi extends Rt{resultCollector;constructor(t,s,o){super("æ¸²æŸ“","âœ¨",null,null,t,o),this.resultCollector=s}async process(t){const s=Qe(),o=gt(),a=Fe(),u=t.inpaintResult?.cleanImage||t.imageData.cleanImageData||this.extractBase64(t.imageData.translatedDataURL||t.imageData.originalDataURL),l=t.detectionResult?.bubbleCoords||[],c=t.translateResult?.translatedTexts||[],g=t.ocrResult?.originalTexts||[],d=t.colorResult?.colors||[],C=t.detectionResult?.bubbleAngles||[],$=t.detectionResult?.autoDirections||[],P=t.translateResult?.textboxTexts||[];if(l.length===0)return t.renderResult={finalImage:u,bubbleStates:[]},t.status="completed",this.updateImageToUI(t,s,o,a),this.resultCollector.add(t),t;if(!t.detectionResult&&t.imageData.bubbleStates&&t.imageData.bubbleStates.length>0){const _=t.imageData.bubbleStates.map((j,z)=>({...j,translatedText:c[z]||j.translatedText||""})),D=await Io({clean_image:u,bubble_states:_,fontSize:a.settings.textStyle.fontSize,fontFamily:a.settings.textStyle.fontFamily,textDirection:a.settings.textStyle.layoutDirection,textColor:a.settings.textStyle.textColor,strokeEnabled:a.settings.textStyle.strokeEnabled,strokeColor:a.settings.textStyle.strokeColor,strokeWidth:a.settings.textStyle.strokeWidth,autoFontSize:a.settings.textStyle.autoFontSize,use_individual_styles:!0});if(!D.success)throw new Error(D.error||"æ¸²æŸ“å¤±è´¥");return t.renderResult={finalImage:D.final_image||"",bubbleStates:D.bubble_states||_},t.status="completed",this.updateImageToUI(t,s,o,a),this.resultCollector.add(t),t}if(t.detectionResult&&!t.translateResult&&!t.ocrResult)return console.log(`[æ¸²æŸ“æ± ] å›¾ç‰‡ ${t.imageIndex+1}: æ£€æµ‹åˆ°æ¶ˆé™¤æ–‡å­—æ¨¡å¼ï¼ˆæ— ç¿»è¯‘å’ŒOCRç»“æœï¼‰ï¼Œè·³è¿‡æ¸²æŸ“`),t.renderResult={finalImage:u,bubbleStates:[]},t.status="completed",this.updateImageToUI(t,s,o,a),this.resultCollector.add(t),t;const R=await Nn({imageIndex:t.imageIndex,cleanImage:u,bubbleCoords:l,bubbleAngles:C,autoDirections:$,originalTexts:g,translatedTexts:c,textboxTexts:P,colors:d,savedTextStyles:null,currentMode:"standard"});return t.renderResult={finalImage:R.finalImage,bubbleStates:R.bubbleStates},t.status="completed",this.updateImageToUI(t,s,o,a),this.resultCollector.add(t),t}updateImageToUI(t,s,o,a){const u=t.imageIndex,l=(t.detectionResult?.bubbleCoords||[]).map(c=>c.length>=4?[c[0],c[1],c[2],c[3]]:[0,0,0,0]);s.updateImageByIndex(u,{translatedDataURL:`data:image/png;base64,${t.renderResult.finalImage}`,cleanImageData:t.inpaintResult?.cleanImage||null,bubbleStates:t.renderResult.bubbleStates,bubbleCoords:l,bubbleAngles:t.detectionResult?.bubbleAngles||[],originalTexts:t.ocrResult?.originalTexts||[],bubbleTexts:t.translateResult?.translatedTexts||[],textboxTexts:t.translateResult?.textboxTexts||[],translationStatus:"completed",translationFailed:!1,showOriginal:!1,hasUnsavedChanges:!0,fontSize:a.settings.textStyle.fontSize,autoFontSize:a.settings.textStyle.autoFontSize,fontFamily:a.settings.textStyle.fontFamily,layoutDirection:a.settings.textStyle.layoutDirection,textColor:a.settings.textStyle.textColor,fillColor:a.settings.textStyle.fillColor,strokeEnabled:a.settings.textStyle.strokeEnabled,strokeColor:a.settings.textStyle.strokeColor,strokeWidth:a.settings.textStyle.strokeWidth,inpaintMethod:a.settings.textStyle.inpaintMethod,useAutoTextColor:a.settings.textStyle.useAutoTextColor}),u===s.currentImageIndex&&t.renderResult?.bubbleStates&&o.setBubbles(t.renderResult.bubbleStates),this.progressTracker.incrementCompleted(),Pt()&&Kn(u).catch(c=>{console.error(`[RenderPool] è‡ªåŠ¨ä¿å­˜å›¾ç‰‡ ${u+1} å¤±è´¥:`,c)}).finally(()=>{const{progress:c}=Ro(),g=c.value;g.save&&(g.save.completed=(g.save.completed||0)+1)}),console.log(`âœ… å›¾ç‰‡ ${u+1} æ¸²æŸ“å®Œæˆ`)}extractBase64(t){return t.includes("base64,")?t.split("base64,")[1]||"":t}}const vn={standard:["detection","ocr","color","translate","inpaint","render"],hq:["detection","ocr","color","translate","inpaint","render"],proofread:["translate","render"],removeText:["detection","inpaint","render"]};class Wi{lock;progressTracker;resultCollector;detectionPool;ocrPool;colorPool;translatePool;inpaintPool;renderPool;isCancelled=!1;config;constructor(t){this.config=t,this.lock=new Mi(t.deepLearningLockSize),this.progressTracker=new Ei,this.resultCollector=new Ai,this.renderPool=new Vi(this.progressTracker,this.resultCollector),this.inpaintPool=new zi(this.renderPool,this.lock,this.progressTracker),this.translatePool=new Oi(this.inpaintPool,this.progressTracker),this.colorPool=new Ui(this.translatePool,this.lock,this.progressTracker),this.ocrPool=new Fi(this.colorPool,this.lock,this.progressTracker),this.detectionPool=new Li(this.ocrPool,this.lock,this.progressTracker)}updateConfig(t){t.deepLearningLockSize!==void 0&&(this.lock.setSize(t.deepLearningLockSize),this.config.deepLearningLockSize=t.deepLearningLockSize),t.enabled!==void 0&&(this.config.enabled=t.enabled)}async execute(t,s,o=0){this.reset(),this.progressTracker.init(t.length),this.resultCollector.init(t.length),this.setupPoolChain(s,t.length);const a=t.map((c,g)=>({id:`task-${o+g}`,imageIndex:o+g,imageData:c,status:"pending"})),u=this.getEntryPool(s);for(const c of a)u.enqueue(c);const l=await this.resultCollector.waitForAll(t.length);return{success:l.success,failed:l.failed,errors:this.resultCollector.getFailed().map(c=>c.error||"æœªçŸ¥é”™è¯¯")}}setupPoolChain(t,s){let o=[...vn[t]];if(t==="removeText")try{if(Fe().settings.removeTextWithOcr){const d=o.indexOf("detection");d!==-1&&!o.includes("ocr")&&o.splice(d+1,0,"ocr")}}catch{}const a=this.getPoolMap();for(let g=0;g<o.length-1;g++){const d=o[g],C=o[g+1],$=a[d],P=a[C];$&&P&&$.setNextPool(P)}const u=o[o.length-1],l=a[u];l&&l.setNextPool(null);const c=o.indexOf("translate");if(c>=0&&c<o.length-1){const g=o[c+1];this.translatePool.setMode(t,s,a[g]||null)}else c===o.length-1&&this.translatePool.setMode(t,s,null)}getPoolMap(){return{detection:this.detectionPool,ocr:this.ocrPool,color:this.colorPool,translate:this.translatePool,inpaint:this.inpaintPool,render:this.renderPool}}getEntryPool(t){const o=vn[t][0];return this.getPoolMap()[o]||this.detectionPool}cancel(){this.isCancelled=!0,this.detectionPool.cancel(),this.ocrPool.cancel(),this.colorPool.cancel(),this.translatePool.cancel(),this.inpaintPool.cancel(),this.renderPool.cancel(),this.lock.reset()}reset(){this.isCancelled=!1,this.detectionPool.reset(),this.ocrPool.reset(),this.colorPool.reset(),this.translatePool.reset(),this.inpaintPool.reset(),this.renderPool.reset(),this.resultCollector.reset(),this.progressTracker.reset()}get progress(){return this.progressTracker.progress}getProgressTracker(){return this.progressTracker}getLockStatus(){return this.lock.getStatus()}get cancelled(){return this.isCancelled}}function Ki(n){return new Wi(n)}function qi(){const n=Qe(),t=Fe(),s=ct(),o=Di(),a=Ro(),u=G(()=>o.isTranslating.value||n.isBatchTranslationInProgress),l=G(()=>o.progressPercent.value);async function c(C){if(n.images.length===0)return s.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),{success:!1,completed:0,failed:0,errors:["æ²¡æœ‰å›¾ç‰‡"]};const $=t.settings.parallel,P=C.scope==="all"||C.scope==="range";return $?.enabled&&P?(console.log(`ğŸš€ ä½¿ç”¨å¹¶è¡Œç®¡çº¿ï¼Œæ¨¡å¼: ${C.mode}, èŒƒå›´: ${C.scope}`),g(C)):(console.log(`ğŸš€ ä½¿ç”¨é¡ºåºç®¡çº¿ï¼Œæ¨¡å¼: ${C.mode}`),o.execute(C))}async function g(C){let $=n.images,P=0;if(C.scope==="range"&&C.pageRange){P=Math.max(0,C.pageRange.startPage-1);const _=Math.min(n.images.length-1,C.pageRange.endPage-1);if(P<=_&&P<n.images.length)$=n.images.slice(P,_+1),console.log(`ğŸ¯ å¹¶è¡Œç¿»è¯‘èŒƒå›´: ç¬¬ ${C.pageRange.startPage} è‡³ ${C.pageRange.endPage} é¡µï¼Œå…± ${$.length} å¼ ï¼Œèµ·å§‹ç´¢å¼• ${P}`);else return s.error("æ— æ•ˆçš„é¡µé¢èŒƒå›´"),{success:!1,completed:0,failed:0,errors:["æ— æ•ˆçš„é¡µé¢èŒƒå›´"]}}if($.length>1){const{textStyle:_}=t.settings;console.log(`ğŸ“ [å¹¶è¡Œæ¨¡å¼] é¢„åˆ†å‘æ–‡å­—è®¾ç½®åˆ° ${$.length} å¼ å¾…ç¿»è¯‘å›¾ç‰‡...`);for(let D=0;D<$.length;D++){const j=P+D;n.updateImageByIndex(j,{fontSize:_.fontSize,autoFontSize:_.autoFontSize,fontFamily:_.fontFamily,layoutDirection:_.layoutDirection,textColor:_.textColor,fillColor:_.fillColor,strokeEnabled:_.strokeEnabled,strokeColor:_.strokeColor,strokeWidth:_.strokeWidth,inpaintMethod:_.inpaintMethod,useAutoTextColor:_.useAutoTextColor})}}const R=Pt();try{if(a.progress.value.totalPages=$.length,a.progress.value.totalCompleted=0,a.progress.value.totalFailed=0,R&&(console.log("[ParallelPipeline] æ‰§è¡Œé¢„ä¿å­˜..."),s.info("å¼€å§‹é¢„ä¿å­˜åŸå§‹å›¾ç‰‡..."),!await Wn({onStart:z=>{const L=a.progress.value;L.preSave={isRunning:!0,current:0,total:z}},onProgress:(z,L)=>{const b=a.progress.value;b.preSave&&(b.preSave.current=z,b.preSave.total=L)},onComplete:()=>{const z=a.progress.value;z.preSave&&(z.preSave.isRunning=!1),s.success("é¢„ä¿å­˜å®Œæˆï¼Œå¼€å§‹ç¿»è¯‘...")},onError:z=>{const L=a.progress.value;L.preSave=void 0,s.warning(`é¢„ä¿å­˜å¤±è´¥ï¼š${z}ï¼Œç¿»è¯‘å®Œæˆåè¯·æ‰‹åŠ¨ä¿å­˜`)}}))){const z=a.progress.value;z.preSave=void 0}const _=C.mode;if(console.log(`ğŸš€ å¯åŠ¨å¹¶è¡Œç¿»è¯‘æ¨¡å¼: ${_}`),console.log(`   å›¾ç‰‡æ•°é‡: ${$.length}`),console.log(`   èµ·å§‹ç´¢å¼•: ${P}`),console.log(`   è‡ªåŠ¨ä¿å­˜: ${R?"å¯ç”¨":"ç¦ç”¨"}`),R){const j=a.progress.value;j.save={completed:0,total:$.length}}const D=await a.executeParallel(_,$,P);return D.success>0&&D.failed===0?s.success(`å¹¶è¡Œç¿»è¯‘å®Œæˆï¼ŒæˆåŠŸå¤„ç† ${D.success} å¼ å›¾ç‰‡`):D.success>0&&D.failed>0?s.warning(`å¹¶è¡Œç¿»è¯‘å®Œæˆï¼ŒæˆåŠŸ ${D.success} å¼ ï¼Œå¤±è´¥ ${D.failed} å¼ `):s.error("å¹¶è¡Œç¿»è¯‘å¤±è´¥"),{success:D.failed===0,completed:D.success,failed:D.failed,errors:D.errors}}catch(_){const D=_ instanceof Error?_.message:"å¹¶è¡Œç¿»è¯‘å‡ºé”™";return s.error(D),{success:!1,completed:0,failed:$.length,errors:[D]}}finally{const _=a.progress.value;_.preSave=void 0,_.save=void 0,R&&(console.log("[ParallelPipeline] å®Œæˆä¿å­˜..."),await qn())}}function d(){o.cancel(),a.cancel(),Hn()}return{progress:o.progress,isExecuting:o.isExecuting,isTranslating:u,progressPercent:l,execute:c,cancel:d,STEP_CHAIN_CONFIGS:o.STEP_CHAIN_CONFIGS}}function fn(n="current",t){return{mode:"standard",scope:n,pageRange:t?.pageRange}}function Hi(n="all",t){return{mode:"hq",scope:n,pageRange:t?.pageRange,batchOptions:{batchSize:t?.batchSize??3,maxRetries:t?.maxRetries??2,rpmLimit:t?.rpmLimit??10,sessionResetFrequency:t?.sessionResetFrequency??5}}}function ji(n="all",t){return{mode:"proofread",scope:n,pageRange:t?.pageRange,batchOptions:{batchSize:t?.batchSize??3,maxRetries:t?.maxRetries??2,rpmLimit:t?.rpmLimit??10,sessionResetFrequency:t?.sessionResetFrequency??5}}}function Ji(n="current",t){return{mode:"removeText",scope:n,pageRange:t?.pageRange}}function Yi(n){if(n.length===0)return{startPage:1,endPage:0};const t=[...n].sort((a,u)=>a-u),s=t[0],o=t[t.length-1];return{startPage:(s??0)+1,endPage:(o??0)+1}}function ht(n,t){const s=[];for(let o=n;o<t;o++)s.push(o);return s}function Do(){const n=Qe(),t=gt(),s=ct(),o=qi(),a=o.progress,u=o.isExecuting,l=o.isTranslating,c=o.progressPercent,g=G(()=>o.isExecuting.value),d=G(()=>o.isExecuting.value);async function C(O,ee){if(O.length===0)return s.error("æ²¡æœ‰æŒ‡å®šè¦ç¿»è¯‘çš„é¡µé¢"),{success:!1,completed:0,failed:0,errors:["æ²¡æœ‰æŒ‡å®šè¦ç¿»è¯‘çš„é¡µé¢"]};const J=n.images.length;if(J===0)return s.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),{success:!1,completed:0,failed:0,errors:["è¯·å…ˆä¸Šä¼ å›¾ç‰‡"]};for(const F of O)if(F<0||F>=J)return s.error(`æ— æ•ˆçš„é¡µé¢ç´¢å¼•: ${F}`),{success:!1,completed:0,failed:0,errors:[`æ— æ•ˆçš„é¡µé¢ç´¢å¼•: ${F}`]};const ae=O.length===1,U=O.length===J;let Q;if(ae){const F=n.currentImageIndex,h=O[0];h!==void 0&&n.setCurrentImageIndex(h),Q=$(ee,"current");const m=await o.execute(Q);return n.setCurrentImageIndex(F),{success:m.success,completed:m.completed,failed:m.failed,errors:m.errors??[]}}else if(U)Q=$(ee,"all");else{const F=Yi(O);Q=$(ee,"range",F)}const ie=await o.execute(Q);return{success:ie.success,completed:ie.completed,failed:ie.failed,errors:ie.errors??[]}}function $(O,ee,J){switch(O){case"standard":return fn(ee,J?{pageRange:J}:void 0);case"hq":return Hi(ee,J?{pageRange:J}:void 0);case"proofread":return ji(ee,J?{pageRange:J}:void 0);case"removeText":return Ji(ee,J?{pageRange:J}:void 0);default:return fn(ee,J?{pageRange:J}:void 0)}}async function P(){return(await C([n.currentImageIndex],"standard")).success}async function R(O){return(await C([O],"standard")).success}async function _(){return(await C(ht(0,n.images.length),"standard")).success}async function D(O){const ee=ht(O.startPage-1,O.endPage);return(await C(ee,"standard")).success}function j(){o.cancel()}async function z(){return(await C([n.currentImageIndex],"removeText")).success}async function L(){return(await C(ht(0,n.images.length),"removeText")).success}async function b(O){const ee=ht(O.startPage-1,O.endPage);return(await C(ee,"removeText")).success}async function p(){const O=n.getFailedImageIndices();return O.length===0?(s.info("æ²¡æœ‰å¤±è´¥çš„å›¾ç‰‡éœ€è¦é‡æ–°ç¿»è¯‘"),!0):(await C(O,"standard")).success}async function T(O){const ee=O?ht(O.startPage-1,O.endPage):ht(0,n.images.length);return(await C(ee,"hq")).success}async function k(O){const ee=O?ht(O.startPage-1,O.endPage):ht(0,n.images.length);return(await C(ee,"proofread")).success}async function N(){if(!n.currentImage)return s.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;const ee=t.bubbles;return!ee||ee.length===0?(s.error("å½“å‰å›¾ç‰‡æ²¡æœ‰æ°”æ³¡æ¡†ï¼Œè¯·å…ˆæ£€æµ‹æˆ–æ‰‹åŠ¨æ·»åŠ "),!1):(n.setManuallyAnnotated(!0),P())}return{progress:a,isTranslatingSingle:u,isHqTranslating:g,isProofreading:d,isTranslating:l,progressPercent:c,translatePages:C,range:ht,translateCurrentImage:P,translateImageByIndex:R,translateAllImages:_,translateImageRange:D,cancelBatchTranslation:j,removeTextOnly:z,removeAllTexts:L,removeTextRange:b,retryFailedImages:p,executeHqTranslation:T,executeProofreading:k,translateWithCurrentBubbles:N}}function Gi(){const n=gt(),t=Qe(),s=w(!1);function o(){if(!s.value)return;const a=t.currentImage;n.bubbleCount>0?t.updateCurrentBubbleStates([...n.bubbles]):a&&Array.isArray(a.bubbleStates)&&a.bubbleStates.length>0&&(t.updateCurrentBubbleStates([]),console.log("é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼ˆæ— é‡æ¸²æŸ“ï¼‰ï¼Œç”¨æˆ·å·²åˆ é™¤æ‰€æœ‰æ°”æ³¡")),s.value=!1,n.clearSelection(),console.log("å·²é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼ˆæ— é‡æ¸²æŸ“ï¼‰")}return{isActive:s,exitEditModeWithoutRender:o}}function Xi(){const n=_n(),t=Fe(),s=Qe(),o=It(),a=gt(),u=Gi(),l=w(!1),c=w(!1),g=w(null),d=w([]),C=w([]),$=w([]),P=w(null),R=w(null),_=w(null),D=w(null),j=w(!1);async function z(U=!1){if(!U&&(l.value||c.value)){console.log("[TranslateInit] å·²ç»åˆå§‹åŒ–ï¼Œä»…é‡æ–°åŠ è½½ä¸Šä¸‹æ–‡"),await N();return}console.log("[TranslateInit] å¼€å§‹åˆå§‹åŒ–åº”ç”¨..."),l.value=!0,g.value=null;try{await L(),await b(),await p(),await T(),await k(),await N(),console.log("[TranslateInit] åº”ç”¨åˆå§‹åŒ–å®Œæˆ"),c.value=!0}catch(Q){console.error("[TranslateInit] åº”ç”¨åˆå§‹åŒ–å¤±è´¥:",Q),g.value=Q instanceof Error?Q.message:"åˆå§‹åŒ–å¤±è´¥"}finally{l.value=!1}}async function L(){console.log("[TranslateInit] åˆå§‹åŒ–è®¾ç½®..."),t.initSettings();try{const U=await t.loadFromBackend();console.log(U?"[TranslateInit] å·²ä»åç«¯åŠ è½½è®¾ç½®":"[TranslateInit] åç«¯æ— è®¾ç½®ï¼Œä½¿ç”¨ localStorage æ•°æ®")}catch(U){console.warn("[TranslateInit] ä»åç«¯åŠ è½½è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨ localStorage æ•°æ®:",U)}console.log("[TranslateInit] è®¾ç½®åˆå§‹åŒ–å®Œæˆ")}async function b(){console.log("[TranslateInit] åˆå§‹åŒ–å­—ä½“åˆ—è¡¨...");try{const U=await wn();U.fonts&&U.fonts.length>0?(d.value=U.fonts,console.log(`[TranslateInit] å·²åŠ è½½ ${U.fonts.length} ä¸ªå­—ä½“`)):U.error?console.warn("[TranslateInit] è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:",U.error):console.warn("[TranslateInit] å­—ä½“åˆ—è¡¨ä¸ºç©º")}catch(U){console.error("[TranslateInit] è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:",U)}}async function p(){console.log("[TranslateInit] åˆå§‹åŒ–ç¿»è¯‘æç¤ºè¯è®¾ç½®...");try{const U=await Js();U.prompt_names!==void 0?(C.value=U.prompt_names||[],!t.settings.translatePrompt&&U.default_prompt_content&&t.setTranslatePrompt(U.default_prompt_content),console.log(`[TranslateInit] å·²åŠ è½½ ${C.value.length} ä¸ªç¿»è¯‘æç¤ºè¯`)):U.error&&console.warn("[TranslateInit] è·å–ç¿»è¯‘æç¤ºè¯å¤±è´¥:",U.error)}catch(U){console.error("[TranslateInit] è·å–ç¿»è¯‘æç¤ºè¯å¤±è´¥:",U)}}async function T(){console.log("[TranslateInit] åˆå§‹åŒ–æ–‡æœ¬æ¡†æç¤ºè¯è®¾ç½®...");try{const U=await js();U.prompt_names!==void 0?($.value=U.prompt_names||[],!t.settings.textboxPrompt&&U.default_prompt_content&&t.setTextboxPrompt(U.default_prompt_content),console.log(`[TranslateInit] å·²åŠ è½½ ${$.value.length} ä¸ªæ–‡æœ¬æ¡†æç¤ºè¯`)):U.error&&console.warn("[TranslateInit] è·å–æ–‡æœ¬æ¡†æç¤ºè¯å¤±è´¥:",U.error)}catch(U){console.error("[TranslateInit] è·å–æ–‡æœ¬æ¡†æç¤ºè¯å¤±è´¥:",U)}}async function k(){console.log("[TranslateInit] æ¸…ç† GPU èµ„æº...");try{const U=await qs();if(U.success){const Q=U.unloaded_models||[];Q.length>0&&console.log(`[TranslateInit] å·²å¸è½½æ¨¡å‹: ${Q.join(", ")}`),console.log(`[TranslateInit] GPU æ¸…ç†å®Œæˆ - å·²åˆ†é…: ${U.memory_allocated_mb}MB, å·²é¢„ç•™: ${U.memory_reserved_mb}MB`)}else console.warn("[TranslateInit] GPU æ¸…ç†å¤±è´¥:",U.error)}catch(U){console.warn("[TranslateInit] GPU æ¸…ç†å¤±è´¥:",U)}}async function N(){const U=n.query.book,Q=n.query.chapter;if(!U||!Q){console.log("[TranslateInit] æœªæŒ‡å®šä¹¦ç±/ç« èŠ‚å‚æ•°ï¼Œä½¿ç”¨ç‹¬ç«‹æ¨¡å¼"),j.value=!1,P.value=null,R.value=null,_.value=null,D.value=null,o.clearContext();return}console.log(`[TranslateInit] æ£€æµ‹åˆ°ä¹¦ç±/ç« èŠ‚å‚æ•°: book=${U}, chapter=${Q}`),j.value=!0,P.value=U,R.value=Q;try{const ie=await Gs(U);if(!ie.success||!ie.book){console.warn("[TranslateInit] ä¹¦ç±ä¸å­˜åœ¨:",U),_e("ä¹¦ç±ä¸å­˜åœ¨","warning");return}const F=ie.book,h=F.chapters?.find(m=>m.id===Q);if(!h){console.warn("[TranslateInit] ç« èŠ‚ä¸å­˜åœ¨:",Q),_e("ç« èŠ‚ä¸å­˜åœ¨","warning");return}if(_.value=F.title,D.value=h.title,o.setBookChapterContext(U,Q,F.title,h.title),typeof document<"u"&&(document.title=`${h.title} - ${F.title} - Saber-Translator`),h.session_path){console.log(`[TranslateInit] å°è¯•åŠ è½½ç« èŠ‚ä¼šè¯: ${h.session_path}`);try{await o.loadSessionByPath(h.session_path),_e(`å·²åŠ è½½ç« èŠ‚: ${h.title}`,"success")}catch{console.log("[TranslateInit] ç« èŠ‚ä¼šè¯æ•°æ®ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥ï¼Œå°†åˆ›å»ºæ–°ä¼šè¯")}}}catch(ie){console.error("[TranslateInit] åŠ è½½ä¹¦ç±/ç« èŠ‚ä¿¡æ¯å¤±è´¥:",ie),_e("åŠ è½½ä¹¦ç±ä¿¡æ¯å¤±è´¥","error")}}function O(U){if(U<0||U>=s.imageCount){console.warn(`[TranslateInit] æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${U}`);return}window._isChangingFromSwitchImage=!0,u.isActive.value&&u.exitEditModeWithoutRender(),s.currentImage&&a.bubbles.length>0&&s.updateCurrentImageProperty("bubbleStates",a.bubbles),s.setCurrentImageIndex(U);const ie=s.currentImage;if(!ie){console.warn("[TranslateInit] åˆ‡æ¢åˆ°çš„å›¾ç‰‡ä¸å­˜åœ¨"),window._isChangingFromSwitchImage=!1;return}console.log(`[TranslateInit] åˆ‡æ¢åˆ°å›¾ç‰‡: ${U}, ${ie.fileName}`),ie.bubbleStates&&ie.bubbleStates.length>0?a.setBubbles(ie.bubbleStates,!0):a.clearBubblesLocal(),setTimeout(()=>{window._isChangingFromSwitchImage=!1,console.log("[TranslateInit] å·²é‡ç½®åˆ‡æ¢å›¾ç‰‡æ“ä½œæ ‡è®°")},100)}function ee(){s.canGoPrevious&&O(s.currentImageIndex-1)}function J(){s.canGoNext&&O(s.currentImageIndex+1)}function ae(){dt(async()=>{await z()})}return{isInitializing:l,isInitialized:c,initError:g,fontList:d,promptNames:C,textboxPromptNames:$,currentBookId:P,currentChapterId:R,currentBookTitle:_,currentChapterTitle:D,isBookshelfMode:j,initializeApp:z,initializeSettings:L,initializeFontList:b,initializePromptSettings:p,initializeTextboxPromptSettings:T,initializeBookChapterContext:N,switchImage:O,goToPrevious:ee,goToNext:J,editMode:u,setupAutoInit:ae}}const Zi={key:0,id:"translationProgressBar",class:"translation-progress-bar"},Qi={class:"parallel-header"},er={class:"header-title"},tr={key:0,class:"presave-section"},or={class:"presave-label"},nr={class:"presave-progress-bar"},sr={class:"pools-list"},ar={class:"pool-label"},lr={class:"pool-icon"},ir={class:"pool-name"},rr={class:"pool-progress-bar"},ur={class:"pool-stats"},cr={class:"completed-count"},dr={class:"total-count"},gr={key:0,class:"waiting-badge"},pr={key:1,class:"lock-indicator",title:"ç­‰å¾…æ·±åº¦å­¦ä¹ é”"},mr={key:0,class:"pool-row save-row"},vr={class:"pool-progress-bar"},fr={class:"pool-stats"},br={class:"completed-count"},hr={class:"total-count"},xr={class:"overall-section"},yr={class:"overall-label"},_r={key:0,class:"failed-text"},Cr={class:"overall-progress-bar"},Sr={class:"progress-bar-label"},kr={key:0,class:"failed-count"},wr={class:"progress-bar"},$r=Ye({__name:"TranslationProgress",props:{progress:{}},setup(n){const t=n,s=Qe(),o=Fe(),a=Do(),u=Ro(),l=G(()=>{const p=u.progress.value?.preSave?.isRunning;return o.settings.parallel?.enabled&&(u.isRunning.value||p)}),c=G(()=>u.progress.value),g=G(()=>{const p=c.value;return!p||p.totalPages===0?0:Math.round(p.totalCompleted/p.totalPages*100)});function d(p){const T=c.value?.totalPages||0;return T===0?0:Math.round(p.completed/T*100)}function C(){const p=c.value?.totalPages||0;return p===0?0:Math.max(3,Math.round(1/p*100))}function $(){const p=c.value?.preSave;return!p||p.total===0?0:Math.round(p.current/p.total*100)}function P(){const p=c.value?.save;return!p||p.total===0?0:Math.round(p.completed/p.total*100)}const R=G(()=>t.progress||a.progress.value),_=G(()=>R.value.isInProgress||s.isBatchTranslationInProgress||l.value),D=G(()=>R.value.current),j=G(()=>R.value.total),z=G(()=>R.value.failed),L=G(()=>R.value.percentage!==void 0?R.value.percentage:j.value===0?0:Math.round(D.value/j.value*100)),b=G(()=>R.value.label?R.value.label:`ç¿»è¯‘ä¸­ï¼š${D.value} / ${j.value}`);return(p,T)=>_.value?(B(),A("div",Zi,[l.value&&c.value?(B(),A(ze,{key:0},[e("div",Qi,[e("span",er,"ğŸš€ å¹¶è¡Œç¿»è¯‘ä¸­ï¼š"+te(c.value.totalCompleted)+"/"+te(c.value.totalPages),1)]),c.value.preSave?.isRunning?(B(),A("div",tr,[e("div",or," ğŸ“¥ é¢„ä¿å­˜åŸå§‹å›¾ç‰‡ï¼š"+te(c.value.preSave.current)+"/"+te(c.value.preSave.total),1),e("div",nr,[e("div",{class:"presave-progress-fill",style:nt({width:$()+"%"})},null,4)])])):ce("",!0),e("div",sr,[(B(!0),A(ze,null,Ge(c.value.pools,k=>(B(),A("div",{key:k.name,class:De(["pool-row",{"pool-processing":k.processing,"pool-waiting-lock":k.isWaitingLock}])},[e("div",ar,[e("span",lr,te(k.icon),1),e("span",ir,te(k.name),1)]),e("div",rr,[e("div",{class:"progress-completed",style:nt({width:d(k)+"%"})},null,4),k.processing?(B(),A("div",{key:0,class:"progress-processing",style:nt({left:d(k)+"%",width:C()+"%"})},null,4)):ce("",!0)]),e("div",ur,[e("span",cr,te(k.completed),1),e("span",dr,"/ "+te(c.value.totalPages),1),k.waiting>0?(B(),A("span",gr,"+"+te(k.waiting),1)):ce("",!0),k.isWaitingLock?(B(),A("span",pr,"ğŸ”’")):ce("",!0)])],2))),128)),c.value.save?(B(),A("div",mr,[T[0]||(T[0]=e("div",{class:"pool-label"},[e("span",{class:"pool-icon"},"ğŸ’¾"),e("span",{class:"pool-name"},"ä¿å­˜")],-1)),e("div",vr,[e("div",{class:"progress-completed save-progress",style:nt({width:P()+"%"})},null,4)]),e("div",fr,[e("span",br,te(c.value.save.completed),1),e("span",hr,"/ "+te(c.value.save.total),1)])])):ce("",!0)]),T[1]||(T[1]=e("div",{class:"divider"},null,-1)),e("div",xr,[e("div",yr,[pe(" æ€»è¿›åº¦ï¼š"+te(g.value)+"% ",1),c.value.totalFailed>0?(B(),A("span",_r," ï¼ˆ"+te(c.value.totalFailed)+" å¤±è´¥ï¼‰ ",1)):ce("",!0)]),e("div",Cr,[e("div",{class:"overall-progress-fill progress-stripe",style:nt({width:g.value+"%"})},null,4)])])],64)):(B(),A(ze,{key:1},[e("div",Sr,[pe(te(b.value)+" ",1),z.value>0?(B(),A("span",kr,"ï¼ˆ"+te(z.value)+" å¼ å¤±è´¥ï¼‰",1)):ce("",!0)]),e("div",wr,[e("div",{class:"progress progress-stripe",style:nt({width:`${L.value}%`})},null,4)])],64))])):ce("",!0)}}),Tr=Je($r,[["__scopeId","data-v-532ece5f"]]),Ir=Ye({__name:"SponsorModal",emits:["close"],setup(n,{emit:t}){const s=t;return(o,a)=>(B(),ut($n,{title:"æ”¯æŒä½œè€…",onClose:a[1]||(a[1]=u=>s("close"))},{footer:St(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:a[0]||(a[0]=u=>s("close"))},"å…³é—­")]),default:St(()=>[a[2]||(a[2]=e("div",{class:"sponsor-content"},[e("p",{class:"sponsor-message"}," å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯·ä½œè€…å–æ¯å’–å•¡ â˜• "),e("div",{class:"qr-codes"},[e("div",{class:"qr-item"},[e("div",{class:"qr-image"},[e("img",{src:"/pic/wechat_qrcode.png",alt:"å¾®ä¿¡æ”¯ä»˜"})]),e("span",{class:"qr-label"},"å¾®ä¿¡æ”¯ä»˜")]),e("div",{class:"qr-item"},[e("div",{class:"qr-image"},[e("img",{src:"/pic/alipay_qrcode.png",alt:"æ”¯ä»˜å®"})]),e("span",{class:"qr-label"},"æ”¯ä»˜å®")])]),e("p",{class:"sponsor-thanks"},"æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼ğŸ™")],-1))]),_:1}))}}),Pr=Je(Ir,[["__scopeId","data-v-02b6948e"]]);function Rr(n){const t=w(""),s=G(()=>n.value.some(R=>R.folderPath)),o=G(()=>{if(!s.value)return null;const R={name:"æ ¹ç›®å½•",path:"",images:[],subfolders:[]},_=new Map;_.set("",R);for(const D of n.value){const j=D.folderPath||"";if(j&&!_.has(j)){const z=j.split("/");let L="";for(const b of z){const p=L;if(L=L?`${L}/${b}`:b,!_.has(L)){const T={name:b,path:L,images:[],subfolders:[]};_.set(L,T),_.has(p)&&_.get(p).subfolders.push(T)}}}_.has(j)&&_.get(j).images.push(D)}return R}),a=G(()=>{if(!t.value)return[{name:"æ ¹ç›®å½•",path:""}];const R=t.value.split("/"),_=[{name:"æ ¹ç›®å½•",path:""}];let D="";for(const j of R)D=D?`${D}/${j}`:j,_.push({name:j,path:D});return _}),u=G(()=>{if(!o.value)return null;if(!t.value)return o.value;const R=(_,D)=>{if(_.path===D)return _;for(const j of _.subfolders){const z=R(j,D);if(z)return z}return null};return R(o.value,t.value)}),l=G(()=>u.value?.subfolders||[]),c=G(()=>u.value?.images||[]);function g(R){t.value=R}function d(){if(!t.value)return;const R=t.value.lastIndexOf("/");t.value=R>0?t.value.substring(0,R):""}function C(R){t.value=R}function $(R){let _=R.images.length;for(const D of R.subfolders)_+=$(D);return _}function P(){t.value=""}return{currentFolderPath:t,useTreeMode:s,folderTree:o,breadcrumbs:a,currentFolder:u,currentSubfolders:l,currentImages:c,enterFolder:g,goUp:d,navigateTo:C,getFolderImageCount:$,resetToRoot:P}}const Dr={class:"card thumbnail-card"},Mr={class:"breadcrumb-nav"},Br=["onClick"],Er={key:0,class:"breadcrumb-sep"},Ar=["onClick"],Lr={class:"folder-info"},Fr=["title"],Ur={class:"folder-count"},Or=["title","onClick"],zr=["src","alt"],Nr={class:"page-number-indicator"},Vr={key:1,class:"translated-indicator"},Wr={key:2,class:"translation-failed-indicator"},Kr={key:3,class:"labeled-indicator"},qr={key:4,class:"thumbnail-processing-indicator"},Hr={key:0,class:"empty-folder"},jr=["title","data-index","onClick"],Jr=["src","alt"],Yr={class:"page-number-indicator"},Gr={key:1,class:"translated-indicator"},Xr={key:2,class:"translation-failed-indicator"},Zr={key:3,class:"labeled-indicator"},Qr={key:4,class:"thumbnail-processing-indicator"},eu={key:2,class:"empty-state"},tu=Ye({__name:"ThumbnailSidebar",props:{isVisible:{type:Boolean}},emits:["select"],setup(n,{emit:t}){const s=n,o=t,a=Qe(),u=w(null),l=w(null),c=w([]),g=G(()=>a.images),d=G(()=>a.currentImageIndex),C=G(()=>a.hasImages),{useTreeMode:$,breadcrumbs:P,currentSubfolders:R,currentImages:_,currentFolderPath:D,enterFolder:j,goUp:z,navigateTo:L,getFolderImageCount:b,folderTree:p,resetToRoot:T}=Rr(g);Ce(()=>g.value.length,(F,h)=>{(F===0||h===0&&F>0)&&T()});function k(F){return g.value.findIndex(h=>h.id===F.id)}function N(F){return F.translationFailed?"failed":F.isManuallyAnnotated?"labeled":F.translationStatus==="processing"?"processing":null}function O(F){return F.translationStatus==="completed"}function ee(F){o("select",F)}function J(F){j(F.path)}function ae(F){L(F)}function U(){mt(()=>{const F=c.value[d.value],h=$.value&&l.value?l.value:u.value;if(F&&h){const m=F.getBoundingClientRect(),i=h.getBoundingClientRect(),f=m.top+m.height/2,v=i.top+i.height/2,y=f-v;h.scrollTo({top:h.scrollTop+y,behavior:"smooth"})}})}function Q(F,h){c.value[h]=F}function ie(F){return F.translationFailed?"ç¿»è¯‘å¤±è´¥ï¼Œç‚¹å‡»å¯é‡è¯•":F.isManuallyAnnotated?"åŒ…å«æ‰‹åŠ¨æ ‡æ³¨":F.translationStatus==="completed"?"å·²å®Œæˆç¿»è¯‘":F.fileName||""}return Ce(d,()=>{U()}),Ce(()=>s.isVisible,(F,h)=>{F&&!h&&U()}),dt(()=>{C.value&&U()}),(F,h)=>(B(),A("aside",{ref_key:"sidebarRef",ref:u,id:"thumbnail-sidebar",class:"thumbnail-sidebar"},[e("div",Dr,[h[5]||(h[5]=e("h2",null,"å›¾ç‰‡æ¦‚è§ˆ",-1)),C.value&&K($)&&K(p)?(B(),A(ze,{key:0},[e("div",Mr,[(B(!0),A(ze,null,Ge(K(P),(m,i)=>(B(),A(ze,{key:m.path},[e("span",{class:De(["breadcrumb-item",{active:i===K(P).length-1}]),onClick:f=>i<K(P).length-1&&ae(m.path)},te(i===0?"ğŸ“":"")+te(m.name),11,Br),i<K(P).length-1?(B(),A("span",Er,"/")):ce("",!0)],64))),128))]),K(D)?(B(),A("div",{key:0,class:"folder-back-btn",onClick:h[0]||(h[0]=(...m)=>K(z)&&K(z)(...m))},[...h[1]||(h[1]=[e("span",{class:"back-icon"},"â¬…ï¸",-1),e("span",null,"è¿”å›ä¸Šçº§",-1)])])):ce("",!0),e("div",{ref_key:"containerRef",ref:l,class:"folder-content-list"},[(B(!0),A(ze,null,Ge(K(R),m=>(B(),A("div",{key:m.path,class:"folder-item",onClick:i=>J(m)},[h[2]||(h[2]=e("span",{class:"folder-icon"},"ğŸ“",-1)),e("div",Lr,[e("span",{class:"folder-name",title:m.name},te(m.name),9,Fr),e("span",Ur,"("+te(K(b)(m))+")",1)])],8,Ar))),128)),(B(!0),A(ze,null,Ge(K(_),m=>(B(),A("div",{key:m.id,ref_for:!0,ref:i=>Q(i,k(m)),class:De(["thumbnail-item",{active:k(m)===d.value}]),title:ie(m),onClick:i=>ee(k(m))},[m.originalDataURL?(B(),A("img",{key:0,src:m.originalDataURL,alt:m.fileName,class:"thumbnail-image"},null,8,zr)):ce("",!0),e("span",Nr,te(k(m)+1),1),O(m)?(B(),A("span",Vr,"âœ“")):ce("",!0),N(m)==="failed"?(B(),A("span",Wr,"!")):N(m)==="labeled"?(B(),A("span",Kr,"âœï¸")):ce("",!0),N(m)==="processing"?(B(),A("div",qr,"âŸ³")):ce("",!0)],10,Or))),128)),K(R).length===0&&K(_).length===0?(B(),A("div",Hr,[...h[3]||(h[3]=[e("p",null,"æ­¤æ–‡ä»¶å¤¹ä¸ºç©º",-1)])])):ce("",!0)],512)],64)):C.value?(B(),A("ul",{key:1,ref_key:"containerRef",ref:l,id:"thumbnailList",class:"thumbnail-list"},[(B(!0),A(ze,null,Ge(g.value,(m,i)=>(B(),A("li",{key:m.id,ref_for:!0,ref:f=>Q(f,i),class:De(["thumbnail-item",{active:i===d.value}]),title:ie(m),"data-index":i,onClick:f=>ee(i)},[m.originalDataURL?(B(),A("img",{key:0,src:m.originalDataURL,alt:m.fileName,class:"thumbnail-image"},null,8,Jr)):ce("",!0),e("span",Yr,te(i+1),1),O(m)?(B(),A("span",Gr,"âœ“")):ce("",!0),N(m)==="failed"?(B(),A("span",Xr,"!")):N(m)==="labeled"?(B(),A("span",Zr,"âœï¸")):ce("",!0),N(m)==="processing"?(B(),A("div",Qr," âŸ³ ")):ce("",!0)],10,jr))),128))],512)):(B(),A("div",eu,[...h[4]||(h[4]=[e("p",null,"æš‚æ— å›¾ç‰‡",-1)])]))])],512))}}),ou=Je(tu,[["__scopeId","data-v-fe7c0b49"]]),nu={class:"saved-prompts-picker"},su={class:"prompts-chips-container"},au={key:0,class:"empty-hint"},lu={key:1,class:"empty-hint"},iu=["title","onClick"],ru=Ye({__name:"SavedPromptsPicker",props:{promptType:{}},emits:["select"],setup(n,{expose:t,emit:s}){const o=n,a=s,u=w([]),l=w(!1);async function c(){l.value=!0;try{let d;o.promptType==="textbox"?d=await je.getTextboxPrompts():d=await je.getPrompts(o.promptType);const C=d.prompt_names||[];u.value=C.map($=>({name:$}))}catch(d){console.error("åŠ è½½æç¤ºè¯åˆ—è¡¨å¤±è´¥:",d),u.value=[]}finally{l.value=!1}}async function g(d){try{let C;o.promptType==="textbox"?C=await je.getTextboxPromptContent(d):C=await je.getPromptContent(o.promptType,d),C.prompt_content&&a("select",C.prompt_content,d)}catch(C){console.error("åŠ è½½æç¤ºè¯å†…å®¹å¤±è´¥:",C)}}return Ce(()=>o.promptType,()=>{c()}),dt(()=>{c()}),t({refresh:c}),(d,C)=>(B(),A("div",nu,[C[1]||(C[1]=e("span",{class:"picker-label"},"ğŸ“‘ å¿«é€Ÿé€‰æ‹©:",-1)),e("div",su,[l.value?(B(),A("span",au,"åŠ è½½ä¸­...")):u.value.length===0?(B(),A("span",lu,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(B(!0),A(ze,{key:2},Ge(u.value,$=>(B(),A("button",{key:$.name,type:"button",class:"prompt-chip",title:$.name,onClick:P=>g($.name)},[C[0]||(C[0]=e("span",{class:"chip-icon"},"ğŸ“",-1)),pe(" "+te($.name),1)],8,iu))),128))])]))}}),Ot=Je(ru,[["__scopeId","data-v-2ebbb8b3"]]),uu={class:"ocr-settings"},cu={class:"settings-group"},du={class:"settings-item"},gu={class:"settings-item"},pu={class:"input-hint"},mu={class:"settings-group"},vu={class:"settings-item"},fu={class:"settings-group"},bu={class:"settings-row"},hu={class:"settings-item"},xu={class:"password-input-wrapper"},yu=["type"],_u={key:0,class:"eye-icon"},Cu={key:1,class:"eye-off-icon"},Su={class:"settings-item"},ku={class:"password-input-wrapper"},wu=["type"],$u={key:0,class:"eye-icon"},Tu={key:1,class:"eye-off-icon"},Iu={class:"settings-row"},Pu={class:"settings-item"},Ru={class:"settings-item"},Du=["disabled"],Mu={class:"settings-group"},Bu={class:"settings-row"},Eu={class:"settings-item"},Au={class:"settings-item"},Lu={class:"password-input-wrapper"},Fu=["type"],Uu={key:0,class:"eye-icon"},Ou={key:1,class:"eye-off-icon"},zu={class:"settings-item"},Nu={class:"settings-item"},Vu={class:"model-input-with-fetch"},Wu=["disabled"],Ku={class:"fetch-text"},qu={key:0,class:"model-select-container"},Hu={class:"model-count"},ju={class:"settings-item"},Ju={class:"prompt-format-selector"},Yu={class:"settings-item"},Gu={class:"settings-item"},Xu=["disabled"],Zu=Ye({__name:"OcrSettings",setup(n){const t=[{label:"MangaOCR (æ—¥è¯­ä¸“ç”¨)",value:"manga_ocr"},{label:"PaddleOCR (å¤šè¯­è¨€)",value:"paddle_ocr"},{label:"PaddleOCR-VL",value:"paddleocr_vl"},{label:"ç™¾åº¦OCR",value:"baidu_ocr"},{label:"48px OCR",value:"48px_ocr"},{label:"AIè§†è§‰OCR",value:"ai_vision"}],s=[{label:"æ ‡å‡†ç‰ˆ",value:"standard"},{label:"é«˜ç²¾åº¦ç‰ˆ",value:"high_precision"}],o=[{label:"è‡ªåŠ¨æ£€æµ‹",value:"auto_detect"},{label:"ä¸­è‹±æ–‡æ··åˆ",value:"CHN_ENG"},{label:"è‹±æ–‡",value:"ENG"},{label:"æ—¥è¯­",value:"JAP"},{label:"éŸ©è¯­",value:"KOR"},{label:"æ³•è¯­",value:"FRE"},{label:"å¾·è¯­",value:"GER"},{label:"ä¿„è¯­",value:"RUS"}],a=[{label:"SiliconFlow (ç¡…åŸºæµåŠ¨)",value:"siliconflow"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai_vision"}],u=[{label:"ğŸŒ ä¸œäºšè¯­è¨€",options:[{label:"æ—¥è¯­",value:"japanese"},{label:"ç®€ä½“ä¸­æ–‡",value:"chinese"},{label:"ç¹ä½“ä¸­æ–‡",value:"chinese_cht"},{label:"éŸ©è¯­",value:"korean"}]},{label:"ğŸŒ æ‹‰ä¸è¯­ç³»",options:[{label:"è‹±è¯­",value:"english"},{label:"æ³•è¯­",value:"french"},{label:"å¾·è¯­",value:"german"},{label:"è¥¿ç­ç‰™è¯­",value:"spanish"},{label:"æ„å¤§åˆ©è¯­",value:"italian"},{label:"è‘¡è„ç‰™è¯­",value:"portuguese"},{label:"è·å…°è¯­",value:"dutch"},{label:"æ³¢å…°è¯­",value:"polish"}]},{label:"ğŸŒ ä¸œå—äºšè¯­è¨€",options:[{label:"æ³°è¯­",value:"thai"},{label:"è¶Šå—è¯­",value:"vietnamese"},{label:"å°å°¼è¯­",value:"indonesian"},{label:"é©¬æ¥è¯­",value:"malay"}]},{label:"ğŸŒ å…¶ä»–è¯­ç³»",options:[{label:"ä¿„è¯­",value:"russian"},{label:"é˜¿æ‹‰ä¼¯è¯­",value:"arabic"},{label:"å°åœ°è¯­",value:"hindi"},{label:"åœŸè€³å…¶è¯­",value:"turkish"},{label:"å¸Œè…Šè¯­",value:"greek"},{label:"å¸Œä¼¯æ¥è¯­",value:"hebrew"}]}],l=[{label:"æ™®é€šæç¤ºè¯",value:"false"},{label:"JSONæç¤ºè¯",value:"true"}],c=[{label:"ğŸš€ å¸¸ç”¨è¯­è¨€",options:[{label:"æ—¥è¯­",value:"japanese"},{label:"è‹±è¯­",value:"en"},{label:"ç®€ä½“ä¸­æ–‡",value:"chinese"},{label:"ç¹ä½“ä¸­æ–‡",value:"chinese_cht"},{label:"éŸ©è¯­",value:"korean"}]},{label:"ğŸŒ æ‹‰ä¸è¯­ç³»",options:[{label:"æ³•è¯­",value:"french"},{label:"å¾·è¯­",value:"german"},{label:"è¥¿ç­ç‰™è¯­",value:"spanish"},{label:"æ„å¤§åˆ©è¯­",value:"italian"},{label:"è‘¡è„ç‰™è¯­",value:"portuguese"}]},{label:"ğŸŒ å…¶ä»–è¯­ç³»",options:[{label:"ä¿„è¯­",value:"russian"}]}],g=Fe(),d=ct(),C=w({apiKey:g.settings.baiduOcr.apiKey,secretKey:g.settings.baiduOcr.secretKey,version:g.settings.baiduOcr.version,sourceLanguage:g.settings.baiduOcr.sourceLanguage}),$=w({apiKey:g.settings.aiVisionOcr.apiKey,modelName:g.settings.aiVisionOcr.modelName,customBaseUrl:g.settings.aiVisionOcr.customBaseUrl,prompt:g.settings.aiVisionOcr.prompt,rpmLimit:g.settings.aiVisionOcr.rpmLimit,minImageSize:g.settings.aiVisionOcr.minImageSize}),P=G(()=>g.settings);Ce(()=>C.value.apiKey,F=>{g.updateBaiduOcr({apiKey:F})}),Ce(()=>C.value.secretKey,F=>{g.updateBaiduOcr({secretKey:F})}),Ce(()=>C.value.version,F=>{g.updateBaiduOcr({version:F})}),Ce(()=>C.value.sourceLanguage,F=>{g.updateBaiduOcr({sourceLanguage:F})}),Ce(()=>$.value.apiKey,F=>{g.updateAiVisionOcr({apiKey:F})}),Ce(()=>$.value.modelName,F=>{g.updateAiVisionOcr({modelName:F})}),Ce(()=>$.value.customBaseUrl,F=>{g.updateAiVisionOcr({customBaseUrl:F})}),Ce(()=>$.value.prompt,F=>{g.updateAiVisionOcr({prompt:F})}),Ce(()=>$.value.rpmLimit,F=>{g.updateAiVisionOcr({rpmLimit:F})}),Ce(()=>$.value.minImageSize,F=>{g.updateAiVisionOcr({minImageSize:F})});const R=w(!1),_=w(!1),D=w(!1),j=w(!1),z=w(!1),L=w([]),b=G(()=>{const F=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return L.value.forEach(h=>{F.push({label:h,value:h})}),F});function p(){g.saveToStorage()}function T(){g.saveToStorage()}function k(F){g.updatePaddleOcrVl({sourceLanguage:F})}function N(){switch(g.settings.ocrEngine){case"manga_ocr":return"MangaOCR ä¸“ä¸ºæ—¥è¯­æ¼«ç”»ä¼˜åŒ–ï¼Œæºè¯­è¨€è®¾ç½®ä¸å½±å“è¯†åˆ«";case"paddle_ocr":return"PaddleOCR ä¼šæ ¹æ®æºè¯­è¨€åŠ è½½å¯¹åº”çš„è¯†åˆ«æ¨¡å‹";case"paddleocr_vl":return"PaddleOCR-VL åŸºäº VLM å¾®è°ƒï¼Œä¸“ä¸ºæ—¥è¯­æ¼«ç”»ä¼˜åŒ–ï¼Œå‡†ç¡®ç‡é«˜è¾¾ 70%";case"baidu_ocr":return"ç™¾åº¦OCR ä½¿ç”¨ç‹¬ç«‹çš„æºè¯­è¨€è®¾ç½®ï¼ˆè§ä¸‹æ–¹ï¼‰";case"ai_vision":return"AIè§†è§‰OCR é€šè¿‡æç¤ºè¯æŒ‡å®šè¯†åˆ«è¯­è¨€";case"48px_ocr":return"48px OCR æ”¯æŒæ—¥ä¸­è‹±éŸ©ç­‰å¤šè¯­è¨€ï¼Œæºè¯­è¨€è®¾ç½®ä¸å½±å“è¯†åˆ«";default:return"é€‰æ‹©è¦è¯†åˆ«çš„åŸæ–‡è¯­è¨€"}}function O(F){g.setAiVisionOcrProvider(F),L.value=[],ee()}function ee(){$.value.apiKey=g.settings.aiVisionOcr.apiKey,$.value.modelName=g.settings.aiVisionOcr.modelName,$.value.customBaseUrl=g.settings.aiVisionOcr.customBaseUrl,$.value.prompt=g.settings.aiVisionOcr.prompt,$.value.rpmLimit=g.settings.aiVisionOcr.rpmLimit,$.value.minImageSize=g.settings.aiVisionOcr.minImageSize}function J(){const F=g.settings.aiVisionOcr.isJsonMode?Cs:Ss;g.updateAiVisionOcr({prompt:F}),$.value.prompt=F}async function ae(){const F=C.value.apiKey?.trim(),h=C.value.secretKey?.trim();if(!F||!h){d.warning("è¯·å¡«å†™ç™¾åº¦OCRçš„API Keyå’ŒSecret Key");return}j.value=!0,d.info("æ­£åœ¨æµ‹è¯•ç™¾åº¦OCRè¿æ¥...");try{const m=await je.testBaiduOcrConnection(F,h);m.success?d.success(m.message||"ç™¾åº¦OCRè¿æ¥æˆåŠŸ!"):d.error(m.message||m.error||"ç™¾åº¦OCRè¿æ¥å¤±è´¥")}catch(m){const i=m instanceof Error?m.message:"è¿æ¥æµ‹è¯•å¤±è´¥";d.error(i)}finally{j.value=!1}}async function U(){j.value=!0;try{const F=await je.testAiVisionOcrConnection({provider:g.settings.aiVisionOcr.provider,apiKey:$.value.apiKey,modelName:$.value.modelName,customBaseUrl:$.value.customBaseUrl,prompt:$.value.prompt});F.success?d.success("AIè§†è§‰OCRè¿æ¥æˆåŠŸ"):d.error(`AIè§†è§‰OCRè¿æ¥å¤±è´¥: ${F.error||"æœªçŸ¥é”™è¯¯"}`)}catch(F){const h=F instanceof Error?F.message:"è¿æ¥æµ‹è¯•å¤±è´¥";d.error(h)}finally{j.value=!1}}async function Q(){const F=g.settings.aiVisionOcr.provider,h=$.value.apiKey?.trim(),m=$.value.customBaseUrl?.trim();if(!h){d.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","volcano","gemini","custom_openai_vision"].includes(F)){d.warning("å½“å‰æœåŠ¡å•†ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨");return}if(F==="custom_openai_vision"&&!m){d.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}z.value=!0;try{const f=await je.fetchModels(F,h,m);f.success&&f.models&&f.models.length>0?(L.value=f.models.map(v=>v.id),d.success(`è·å–åˆ° ${f.models.length} ä¸ªæ¨¡å‹`)):d.warning(f.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(f){const v=f instanceof Error?f.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";d.error(v)}finally{z.value=!1}}function ie(F,h){g.updateAiVisionOcr({prompt:F}),$.value.prompt=F,d.success(`å·²åº”ç”¨æç¤ºè¯: ${h}`)}return(F,h)=>(B(),A("div",uu,[e("div",cu,[h[21]||(h[21]=e("div",{class:"settings-group-title"},"OCRå¼•æ“é€‰æ‹©",-1)),e("div",du,[h[19]||(h[19]=e("label",{for:"settingsOcrEngine"},"OCRå¼•æ“:",-1)),Se(We,{"model-value":P.value.ocrEngine,options:t,onChange:h[0]||(h[0]=m=>{P.value.ocrEngine=m,p()})},null,8,["model-value"])]),oe(e("div",gu,[h[20]||(h[20]=e("label",{for:"settingsSourceLanguage"},"æºè¯­è¨€:",-1)),Se(We,{"model-value":P.value.sourceLanguage,groups:c,onChange:h[1]||(h[1]=m=>{P.value.sourceLanguage=m,T()})},null,8,["model-value"]),e("div",pu,te(N()),1)],512),[[Oe,P.value.ocrEngine==="paddle_ocr"]])]),oe(e("div",mu,[h[24]||(h[24]=e("div",{class:"settings-group-title"},"PaddleOCR-VL è®¾ç½®",-1)),e("div",vu,[h[22]||(h[22]=e("label",{for:"settingsPaddleOcrVlSourceLanguage"},"æºè¯­è¨€:",-1)),Se(We,{"model-value":P.value.paddleOcrVl.sourceLanguage,groups:u,onChange:h[2]||(h[2]=m=>k(m))},null,8,["model-value"]),h[23]||(h[23]=e("div",{class:"input-hint"}," é€‰æ‹©å›¾åƒä¸­çš„æºè¯­è¨€ï¼Œç”¨äºä¼˜åŒ– OCR è¯†åˆ«æ•ˆæœ ",-1))])],512),[[Oe,P.value.ocrEngine==="paddleocr_vl"]]),oe(e("div",fu,[h[29]||(h[29]=e("div",{class:"settings-group-title"},"ç™¾åº¦OCR è®¾ç½®",-1)),e("div",bu,[e("div",hu,[h[25]||(h[25]=e("label",{for:"settingsBaiduApiKey"},"API Key:",-1)),e("div",xu,[oe(e("input",{type:R.value?"text":"password",id:"settingsBaiduApiKey","onUpdate:modelValue":h[3]||(h[3]=m=>C.value.apiKey=m),class:"secure-input",placeholder:"è¯·è¾“å…¥ç™¾åº¦OCR API Key",autocomplete:"off"},null,8,yu),[[$t,C.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:h[4]||(h[4]=m=>R.value=!R.value)},[R.value?(B(),A("span",Cu,"ğŸ‘â€ğŸ—¨")):(B(),A("span",_u,"ğŸ‘"))])])]),e("div",Su,[h[26]||(h[26]=e("label",{for:"settingsBaiduSecretKey"},"Secret Key:",-1)),e("div",ku,[oe(e("input",{type:_.value?"text":"password",id:"settingsBaiduSecretKey","onUpdate:modelValue":h[5]||(h[5]=m=>C.value.secretKey=m),class:"secure-input",placeholder:"è¯·è¾“å…¥Secret Key",autocomplete:"off"},null,8,wu),[[$t,C.value.secretKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:h[6]||(h[6]=m=>_.value=!_.value)},[_.value?(B(),A("span",Tu,"ğŸ‘â€ğŸ—¨")):(B(),A("span",$u,"ğŸ‘"))])])])]),e("div",Iu,[e("div",Pu,[h[27]||(h[27]=e("label",{for:"settingsBaiduVersion"},"è¯†åˆ«ç‰ˆæœ¬:",-1)),Se(We,{modelValue:C.value.version,"onUpdate:modelValue":h[7]||(h[7]=m=>C.value.version=m),options:s},null,8,["modelValue"])]),e("div",Ru,[h[28]||(h[28]=e("label",{for:"settingsBaiduSourceLanguage"},"æºè¯­è¨€:",-1)),Se(We,{modelValue:C.value.sourceLanguage,"onUpdate:modelValue":h[8]||(h[8]=m=>C.value.sourceLanguage=m),options:o},null,8,["modelValue"])])]),e("button",{class:"settings-test-btn",onClick:ae,disabled:j.value},te(j.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,Du)],512),[[Oe,P.value.ocrEngine==="baidu_ocr"]]),oe(e("div",Mu,[h[41]||(h[41]=e("div",{class:"settings-group-title"},"AIè§†è§‰OCR è®¾ç½®",-1)),e("div",Bu,[e("div",Eu,[h[30]||(h[30]=e("label",{for:"settingsAiVisionProvider"},"æœåŠ¡å•†:",-1)),Se(We,{"model-value":P.value.aiVisionOcr.provider,options:a,onChange:h[9]||(h[9]=m=>O(m))},null,8,["model-value"])]),e("div",Au,[h[31]||(h[31]=e("label",{for:"settingsAiVisionApiKey"},"API Key:",-1)),e("div",Lu,[oe(e("input",{type:D.value?"text":"password",id:"settingsAiVisionApiKey","onUpdate:modelValue":h[10]||(h[10]=m=>$.value.apiKey=m),class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,Fu),[[$t,$.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:h[11]||(h[11]=m=>D.value=!D.value)},[D.value?(B(),A("span",Ou,"ğŸ‘â€ğŸ—¨")):(B(),A("span",Uu,"ğŸ‘"))])])])]),oe(e("div",zu,[h[32]||(h[32]=e("label",{for:"settingsCustomAiVisionBaseUrl"},"Base URL:",-1)),oe(e("input",{type:"text",id:"settingsCustomAiVisionBaseUrl","onUpdate:modelValue":h[12]||(h[12]=m=>$.value.customBaseUrl=m),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[Re,$.value.customBaseUrl]])],512),[[Oe,P.value.aiVisionOcr.provider==="custom_openai_vision"]]),e("div",Nu,[h[34]||(h[34]=e("label",{for:"settingsAiVisionModelName"},"æ¨¡å‹åç§°:",-1)),e("div",Vu,[oe(e("input",{type:"text",id:"settingsAiVisionModelName","onUpdate:modelValue":h[13]||(h[13]=m=>$.value.modelName=m),placeholder:"å¦‚: silicon-llava2-34b"},null,512),[[Re,$.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:Q,disabled:z.value},[h[33]||(h[33]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",Ku,te(z.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,Wu)]),L.value.length>0?(B(),A("div",qu,[Se(We,{modelValue:$.value.modelName,"onUpdate:modelValue":h[14]||(h[14]=m=>$.value.modelName=m),options:b.value},null,8,["modelValue","options"]),e("span",Hu,"å…± "+te(L.value.length)+" ä¸ªæ¨¡å‹",1)])):ce("",!0)]),e("div",ju,[h[36]||(h[36]=e("label",{for:"settingsAiVisionOcrPrompt"},"OCRæç¤ºè¯:",-1)),oe(e("textarea",{id:"settingsAiVisionOcrPrompt","onUpdate:modelValue":h[15]||(h[15]=m=>$.value.prompt=m),rows:"3",placeholder:"AIè§†è§‰OCRæç¤ºè¯"},null,512),[[Re,$.value.prompt]]),Se(Ot,{"prompt-type":"ai_vision_ocr",onSelect:ie}),e("div",Ju,[Se(We,{"model-value":P.value.aiVisionOcr.isJsonMode?"true":"false",options:l,onChange:h[16]||(h[16]=m=>{P.value.aiVisionOcr.isJsonMode=m==="true",J()})},null,8,["model-value"]),h[35]||(h[35]=e("span",{class:"input-hint"},"JSONæ ¼å¼è¾“å‡ºæ›´ç»“æ„åŒ–",-1))])]),e("div",Yu,[h[37]||(h[37]=e("label",{for:"settingsRpmAiVisionOcr"},"RPMé™åˆ¶ (æ¯åˆ†é’Ÿè¯·æ±‚æ•°):",-1)),oe(e("input",{type:"number",id:"settingsRpmAiVisionOcr","onUpdate:modelValue":h[17]||(h[17]=m=>$.value.rpmLimit=m),min:"0",step:"1"},null,512),[[Re,$.value.rpmLimit,void 0,{number:!0}]]),h[38]||(h[38]=e("div",{class:"input-hint"},"0 è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",Gu,[h[39]||(h[39]=e("label",{for:"settingsMinImageSize"},"æœ€å°å›¾ç‰‡å°ºå¯¸ (åƒç´ ):",-1)),oe(e("input",{type:"number",id:"settingsMinImageSize","onUpdate:modelValue":h[18]||(h[18]=m=>$.value.minImageSize=m),min:"0",step:"1"},null,512),[[Re,$.value.minImageSize,void 0,{number:!0}]]),h[40]||(h[40]=e("div",{class:"input-hint"},"VLMæ¨¡å‹é€šå¸¸è¦æ±‚å›¾ç‰‡å°ºå¯¸ â‰¥28pxï¼Œè®¾ä¸º0åˆ™ä¸è‡ªåŠ¨æ”¾å¤§å°å›¾",-1))]),e("button",{class:"settings-test-btn",onClick:U,disabled:j.value},te(j.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,Xu)],512),[[Oe,P.value.ocrEngine==="ai_vision"]])]))}}),Qu=Je(Zu,[["__scopeId","data-v-03445600"]]),ec={class:"translation-settings"},tc={class:"settings-group"},oc={class:"settings-row"},nc={class:"settings-item"},sc={class:"settings-item"},ac={for:"settingsApiKey"},lc={class:"password-input-wrapper"},ic=["type","placeholder"],rc={key:0,class:"eye-icon"},uc={key:1,class:"eye-off-icon"},cc={class:"settings-item"},dc={class:"settings-item"},gc={for:"settingsModelName"},pc={class:"model-input-with-fetch"},mc=["placeholder"],vc=["disabled"],fc={class:"fetch-text"},bc={key:0,class:"model-select-container"},hc={class:"model-count"},xc={class:"settings-item"},yc={class:"model-input-with-fetch"},_c=["placeholder"],Cc=["disabled"],Sc={class:"fetch-text"},kc={key:0,class:"model-select-container"},wc={class:"model-count"},$c={class:"settings-row"},Tc={class:"settings-item"},Ic={class:"settings-item"},Pc={class:"settings-item"},Rc={class:"input-hint translation-mode-hint"},Dc={key:0},Mc={key:1},Bc={key:0,class:"input-hint sakura-suggestion"},Ec={class:"settings-item"},Ac=["disabled"],Lc={class:"settings-item"},Fc=["disabled"],Uc={class:"settings-group"},Oc={class:"settings-item"},zc={class:"prompt-format-selector"},Nc={class:"settings-item"},Vc={class:"checkbox-label"},Wc={class:"settings-item"},Kc=Ye({__name:"TranslationSettings",setup(n){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"å½©äº‘å°è¯‘",value:"caiyun"},{label:"ç™¾åº¦ç¿»è¯‘",value:"baidu_translate"},{label:"æœ‰é“ç¿»è¯‘",value:"youdao_translate"},{label:"Google Gemini",value:"gemini"},{label:"Ollama (æœ¬åœ°)",value:"ollama"},{label:"Sakura (æœ¬åœ°)",value:"sakura"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],s=[{label:"æ™®é€šæç¤ºè¯",value:"normal"},{label:"JSONæç¤ºè¯",value:"json"}],o=[{label:"æ•´é¡µæ‰¹é‡ç¿»è¯‘ (æ¨è)",value:"batch"},{label:"é€æ°”æ³¡ç¿»è¯‘ (é€‚åˆå°æ¨¡å‹)",value:"single"}],a=Fe(),u=ct(),l=a.settings.translation.translationMode||"batch",c=a.settings.translation.isJsonMode||!1,g=()=>{const f=a.settings.translation;return l==="single"?c?f.singleJsonPrompt:f.singleNormalPrompt:c?f.batchJsonPrompt:f.batchNormalPrompt},d=w({modelProvider:a.settings.translation.provider,apiKey:a.settings.translation.apiKey,modelName:a.settings.translation.modelName,customBaseUrl:a.settings.translation.customBaseUrl,rpmTranslation:a.settings.translation.rpmLimit,translationMaxRetries:a.settings.translation.maxRetries,translationMode:l,promptContent:g(),translatePromptMode:c?"json":"normal",enableTextboxPrompt:a.settings.useTextboxPrompt,textboxPromptContent:a.settings.textboxPrompt}),C=w(!1),$=w(!1),P=w(!1),R=w([]),_=w([]),D=G(()=>{const f=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return R.value.forEach(v=>f.push({label:v,value:v})),f}),j=G(()=>{const f=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return _.value.forEach(v=>f.push({label:v,value:v})),f}),z=G(()=>["ollama","sakura"].includes(d.value.modelProvider)),L=G(()=>!["ollama","sakura","caiyun","baidu_translate","youdao_translate"].includes(d.value.modelProvider)),b=G(()=>["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(d.value.modelProvider)),p=G(()=>{switch(d.value.modelProvider){case"baidu_translate":return"App ID";case"youdao_translate":return"App Key";case"caiyun":return"API Token";default:return"API Key"}}),T=G(()=>{switch(d.value.modelProvider){case"baidu_translate":return"è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘App ID";case"youdao_translate":return"è¯·è¾“å…¥æœ‰é“ç¿»è¯‘åº”ç”¨ID";case"caiyun":return"è¯·è¾“å…¥å½©äº‘å°è¯‘Token";default:return"è¯·è¾“å…¥API Key"}}),k=G(()=>{switch(d.value.modelProvider){case"baidu_translate":return"App Key";case"youdao_translate":return"App Secret";case"caiyun":return"æºè¯­è¨€ (å¯é€‰)";default:return"æ¨¡å‹åç§°"}}),N=G(()=>{switch(d.value.modelProvider){case"baidu_translate":return"è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘App Key";case"youdao_translate":return"è¯·è¾“å…¥æœ‰é“ç¿»è¯‘åº”ç”¨å¯†é’¥";case"caiyun":return"å¯é€‰: auto/æ—¥è¯­/è‹±è¯­";default:return"è¯·è¾“å…¥æ¨¡å‹åç§°"}});function O(){const f=d.value.modelProvider;a.setTranslationProvider(f),d.value.apiKey=a.settings.translation.apiKey,d.value.modelName=a.settings.translation.modelName,d.value.customBaseUrl=a.settings.translation.customBaseUrl,d.value.rpmTranslation=a.settings.translation.rpmLimit,d.value.translationMaxRetries=a.settings.translation.maxRetries,d.value.translationMode=a.settings.translation.translationMode||"batch",R.value=[],_.value=[]}function ee(){const f=d.value.translatePromptMode==="json",v=!f,y=d.value.translationMode==="single";y?v?a.updateTranslationService({singleJsonPrompt:d.value.promptContent}):a.updateTranslationService({singleNormalPrompt:d.value.promptContent}):v?a.updateTranslationService({batchJsonPrompt:d.value.promptContent}):a.updateTranslationService({batchNormalPrompt:d.value.promptContent});const I=a.settings.translation;let E;y?E=f?I.singleJsonPrompt:I.singleNormalPrompt:E=f?I.batchJsonPrompt:I.batchNormalPrompt,d.value.promptContent=E,a.updateTranslationService({isJsonMode:f}),a.setTranslatePrompt(E)}function J(f){const v=String(f),y=d.value.translationMode,I=d.value.translatePromptMode==="json";if(v===y)return;y==="batch"?I?a.updateTranslationService({batchJsonPrompt:d.value.promptContent}):a.updateTranslationService({batchNormalPrompt:d.value.promptContent}):I?a.updateTranslationService({singleJsonPrompt:d.value.promptContent}):a.updateTranslationService({singleNormalPrompt:d.value.promptContent}),d.value.translationMode=v,a.updateTranslationService({translationMode:v});const E=a.settings.translation;let H;v==="single"?H=I?E.singleJsonPrompt:E.singleNormalPrompt:H=I?E.batchJsonPrompt:E.batchNormalPrompt,d.value.promptContent=H,a.setTranslatePrompt(H),console.log(`ç¿»è¯‘æ¨¡å¼å·²åˆ‡æ¢ä¸º: ${v==="batch"?"æ•´é¡µæ‰¹é‡ç¿»è¯‘":"é€æ°”æ³¡ç¿»è¯‘"}`)}Ce(()=>d.value.apiKey,f=>{a.updateTranslationService({apiKey:f})}),Ce(()=>d.value.modelName,f=>{a.updateTranslationService({modelName:f})}),Ce(()=>d.value.customBaseUrl,f=>{a.updateTranslationService({customBaseUrl:f})}),Ce(()=>d.value.rpmTranslation,f=>{a.updateTranslationService({rpmLimit:f})}),Ce(()=>d.value.translationMaxRetries,f=>{a.updateTranslationService({maxRetries:f})}),Ce(()=>d.value.promptContent,f=>{a.setTranslatePrompt(f);const v=d.value.translationMode==="batch",y=d.value.translatePromptMode==="json";v?y?a.updateTranslationService({batchJsonPrompt:f}):a.updateTranslationService({batchNormalPrompt:f}):y?a.updateTranslationService({singleJsonPrompt:f}):a.updateTranslationService({singleNormalPrompt:f})}),Ce(()=>d.value.enableTextboxPrompt,f=>{a.setUseTextboxPrompt(f)}),Ce(()=>d.value.textboxPromptContent,f=>{a.setTextboxPrompt(f)});async function ae(){const f=d.value.modelProvider,v=d.value.apiKey?.trim(),y=d.value.customBaseUrl?.trim();if(!v){u.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(f)){u.warning(`${U(f)} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`);return}if(f==="custom_openai"&&!y){u.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}P.value=!0;try{const E=await je.fetchModels(f,v,y);E.success&&E.models&&E.models.length>0?(R.value=E.models.map(H=>H.id),u.success(`è·å–åˆ° ${E.models.length} ä¸ªæ¨¡å‹`)):u.warning(E.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(E){const H=E instanceof Error?E.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";u.error(H)}finally{P.value=!1}}function U(f){return{siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰OpenAI",ollama:"Ollama",sakura:"Sakura",caiyun:"å½©äº‘å°è¯‘",baidu_translate:"ç™¾åº¦ç¿»è¯‘",youdao_translate:"æœ‰é“ç¿»è¯‘"}[f]||f}async function Q(){const f=d.value.modelProvider;P.value=!0;try{let v;if(f==="ollama")v=await je.testOllamaConnection();else if(f==="sakura")v=await je.testSakuraConnection();else{u.error("æœªé€‰æ‹©æœ¬åœ°æœåŠ¡å•†");return}v.success&&v.models?(_.value=v.models,u.success(`è·å–åˆ° ${v.models.length} ä¸ª${f==="ollama"?"Ollama":"Sakura"}æ¨¡å‹`)):u.error(v.error||`${f==="ollama"?"Ollama":"Sakura"}è¿æ¥å¤±è´¥`)}catch(v){const y=v instanceof Error?v.message:"è·å–æœ¬åœ°æ¨¡å‹å¤±è´¥";u.error(y)}finally{P.value=!1}}async function ie(){$.value=!0;try{let f;d.value.modelProvider==="ollama"?f=await je.testOllamaConnection():f=await je.testSakuraConnection(),f.success?u.success(`${d.value.modelProvider==="ollama"?"Ollama":"Sakura"} è¿æ¥æˆåŠŸ`):u.error(f.error||"è¿æ¥å¤±è´¥")}catch(f){const v=f instanceof Error?f.message:"è¿æ¥æµ‹è¯•å¤±è´¥";u.error(v)}finally{$.value=!1}}async function F(){const f=d.value.modelProvider,v=d.value.apiKey?.trim(),y=d.value.modelName?.trim(),I=d.value.customBaseUrl?.trim();if(!v){u.warning("è¯·å…ˆå¡«å†™ API Key");return}if(f!=="caiyun"&&!y){u.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}if(f==="custom_openai"&&!I){u.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å¡«å†™ Base URL");return}$.value=!0,u.info("æ­£åœ¨æµ‹è¯•è¿æ¥...");try{let E;switch(f){case"baidu_translate":E=await je.testBaiduTranslateConnection(v,y);break;case"youdao_translate":E=await je.testYoudaoTranslateConnection(v,y);break;default:E=await je.testAiTranslateConnection({provider:f,apiKey:v,modelName:y,baseUrl:I})}E.success?u.success(E.message||`${U(f)} è¿æ¥æˆåŠŸ!`):u.error(E.message||E.error||"è¿æ¥å¤±è´¥")}catch(E){const H=E instanceof Error?E.message:"è¿æ¥æµ‹è¯•å¤±è´¥";u.error(H)}finally{$.value=!1}}function h(f,v){d.value.promptContent=f,u.success(`å·²åº”ç”¨æç¤ºè¯: ${v}`)}function m(f,v){d.value.textboxPromptContent=f,u.success(`å·²åº”ç”¨æç¤ºè¯: ${v}`)}function i(){const f=d.value.translatePromptMode==="json";d.value.translationMode==="single"?d.value.promptContent=f?ks:ws:d.value.promptContent=f?$s:Ts,u.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}return(f,v)=>(B(),A("div",ec,[e("div",tc,[v[23]||(v[23]=e("div",{class:"settings-group-title"},"ç¿»è¯‘æœåŠ¡é…ç½®",-1)),e("div",oc,[e("div",nc,[v[14]||(v[14]=e("label",{for:"settingsModelProvider"},"ç¿»è¯‘æœåŠ¡å•†:",-1)),Se(We,{"model-value":d.value.modelProvider,options:t,onChange:v[0]||(v[0]=y=>{d.value.modelProvider=y,O()})},null,8,["model-value"])]),oe(e("div",sc,[e("label",ac,te(p.value)+":",1),e("div",lc,[oe(e("input",{type:C.value?"text":"password",id:"settingsApiKey","onUpdate:modelValue":v[1]||(v[1]=y=>d.value.apiKey=y),class:"secure-input",placeholder:T.value,autocomplete:"off"},null,8,ic),[[$t,d.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:v[2]||(v[2]=y=>C.value=!C.value)},[C.value?(B(),A("span",uc,"ğŸ‘â€ğŸ—¨")):(B(),A("span",rc,"ğŸ‘"))])])],512),[[Oe,!z.value]])]),oe(e("div",cc,[v[15]||(v[15]=e("label",{for:"settingsCustomBaseUrl"},"Base URL:",-1)),oe(e("input",{type:"text",id:"settingsCustomBaseUrl","onUpdate:modelValue":v[3]||(v[3]=y=>d.value.customBaseUrl=y),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[Re,d.value.customBaseUrl]])],512),[[Oe,d.value.modelProvider==="custom_openai"]]),oe(e("div",dc,[e("label",gc,te(k.value)+":",1),e("div",pc,[oe(e("input",{type:"text",id:"settingsModelName","onUpdate:modelValue":v[4]||(v[4]=y=>d.value.modelName=y),placeholder:N.value},null,8,mc),[[Re,d.value.modelName]]),oe(e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:ae,disabled:P.value},[v[16]||(v[16]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",fc,te(P.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,vc),[[Oe,b.value]])]),R.value.length>0?(B(),A("div",bc,[Se(We,{"model-value":d.value.modelName,options:D.value,onChange:v[5]||(v[5]=y=>{d.value.modelName=y})},null,8,["model-value","options"]),e("span",hc,"å…± "+te(R.value.length)+" ä¸ªæ¨¡å‹",1)])):ce("",!0)],512),[[Oe,!z.value]]),oe(e("div",xc,[v[18]||(v[18]=e("label",{for:"settingsLocalModelName"},"æ¨¡å‹åç§°:",-1)),e("div",yc,[oe(e("input",{type:"text",id:"settingsLocalModelName","onUpdate:modelValue":v[6]||(v[6]=y=>d.value.modelName=y),placeholder:d.value.modelProvider==="ollama"?"ä¾‹å¦‚: qwen2.5:7b":"ä¾‹å¦‚: sakura-14b-qwen2.5-v1.0"},null,8,_c),[[Re,d.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–æœ¬åœ°å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:Q,disabled:P.value},[v[17]||(v[17]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",Sc,te(P.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,Cc)]),_.value.length>0?(B(),A("div",kc,[Se(We,{"model-value":d.value.modelName,options:j.value,onChange:v[7]||(v[7]=y=>d.value.modelName=y)},null,8,["model-value","options"]),e("span",wc,"å…± "+te(_.value.length)+" ä¸ªæ¨¡å‹",1)])):ce("",!0)],512),[[Oe,z.value]]),oe(e("div",$c,[e("div",Tc,[v[19]||(v[19]=e("label",{for:"settingsRpmTranslation"},"RPMé™åˆ¶:",-1)),oe(e("input",{type:"number",id:"settingsRpmTranslation","onUpdate:modelValue":v[8]||(v[8]=y=>d.value.rpmTranslation=y),min:"0",step:"1"},null,512),[[Re,d.value.rpmTranslation,void 0,{number:!0}]]),v[20]||(v[20]=e("div",{class:"input-hint"},"æ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",Ic,[v[21]||(v[21]=e("label",{for:"settingsTranslationMaxRetries"},"é‡è¯•æ¬¡æ•°:",-1)),oe(e("input",{type:"number",id:"settingsTranslationMaxRetries","onUpdate:modelValue":v[9]||(v[9]=y=>d.value.translationMaxRetries=y),min:"0",max:"10",step:"1"},null,512),[[Re,d.value.translationMaxRetries,void 0,{number:!0}]])])],512),[[Oe,L.value]]),e("div",Pc,[v[22]||(v[22]=e("label",{for:"settingsTranslationMode"},"ç¿»è¯‘æ¨¡å¼:",-1)),Se(We,{"model-value":d.value.translationMode,options:o,onChange:J},null,8,["model-value"]),e("div",Rc,[d.value.translationMode==="batch"?(B(),A("span",Dc," ğŸ’¡ æ•´é¡µæ‰¹é‡ç¿»è¯‘ï¼šä¸€æ¬¡å‘é€å…¨éƒ¨æ°”æ³¡ï¼Œæ•ˆç‡é«˜ï¼Œéœ€è¦æ¨¡å‹æ”¯æŒå¤æ‚æŒ‡ä»¤ ")):(B(),A("span",Mc," ğŸ’¡ é€æ°”æ³¡ç¿»è¯‘ï¼šæ¯ä¸ªæ°”æ³¡å•ç‹¬ç¿»è¯‘ï¼Œæ›´ç¨³å®šï¼Œé€‚åˆå°æ¨¡å‹æˆ–æ ¼å¼æ•æ„Ÿåœºæ™¯ "))]),d.value.modelProvider==="sakura"?(B(),A("div",Bc,' âš ï¸ å»ºè®® Sakura æœåŠ¡ä½¿ç”¨"é€æ°”æ³¡ç¿»è¯‘"æ¨¡å¼ï¼Œå¯è·å¾—æ›´ç¨³å®šçš„ç¿»è¯‘æ•ˆæœ ')):ce("",!0)]),oe(e("div",Ec,[e("button",{class:"settings-test-btn",onClick:ie,disabled:$.value},te($.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,Ac)],512),[[Oe,z.value]]),oe(e("div",Lc,[e("button",{class:"settings-test-btn",onClick:F,disabled:$.value},te($.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,Fc)],512),[[Oe,!z.value]])]),e("div",Uc,[v[28]||(v[28]=e("div",{class:"settings-group-title"},"æç¤ºè¯è®¾ç½®",-1)),e("div",Oc,[v[25]||(v[25]=e("label",{for:"settingsPromptContent"},"ç¿»è¯‘æç¤ºè¯:",-1)),oe(e("textarea",{id:"settingsPromptContent","onUpdate:modelValue":v[10]||(v[10]=y=>d.value.promptContent=y),rows:"4",placeholder:"ç¿»è¯‘æç¤ºè¯"},null,512),[[Re,d.value.promptContent]]),e("div",zc,[Se(We,{"model-value":d.value.translatePromptMode,options:s,onChange:v[11]||(v[11]=y=>{d.value.translatePromptMode=y,ee()})},null,8,["model-value"]),v[24]||(v[24]=e("span",{class:"input-hint"},"JSONæ ¼å¼è¾“å‡ºæ›´ç»“æ„åŒ–",-1))]),Se(Ot,{"prompt-type":"translate",onSelect:h}),e("button",{type:"button",class:"reset-btn",onClick:i}," é‡ç½®ä¸ºé»˜è®¤ ")]),e("div",Nc,[e("label",Vc,[oe(e("input",{type:"checkbox","onUpdate:modelValue":v[12]||(v[12]=y=>d.value.enableTextboxPrompt=y)},null,512),[[Xe,d.value.enableTextboxPrompt]]),v[26]||(v[26]=pe(" å¯ç”¨æ–‡æœ¬æ¡†æç¤ºè¯ ",-1))])]),oe(e("div",Wc,[v[27]||(v[27]=e("label",{for:"settingsTextboxPromptContent"},"æ–‡æœ¬æ¡†æç¤ºè¯:",-1)),oe(e("textarea",{id:"settingsTextboxPromptContent","onUpdate:modelValue":v[13]||(v[13]=y=>d.value.textboxPromptContent=y),rows:"3",placeholder:"æ–‡æœ¬æ¡†æç¤ºè¯"},null,512),[[Re,d.value.textboxPromptContent]]),Se(Ot,{"prompt-type":"textbox",onSelect:m})],512),[[Oe,d.value.enableTextboxPrompt]])])]))}}),qc=Je(Kc,[["__scopeId","data-v-7c76de5c"]]),Hc={class:"detection-settings"},jc={class:"settings-group"},Jc={class:"settings-item"},Yc={class:"settings-group"},Gc={class:"settings-item"},Xc={class:"settings-row"},Zc={class:"settings-item"},Qc={class:"settings-item"},ed={class:"settings-row"},td={class:"settings-item"},od={class:"settings-item"},nd={class:"settings-group"},sd={class:"settings-item"},ad={class:"checkbox-label"},ld={class:"settings-row"},id={class:"settings-item"},rd={class:"settings-item"},ud={class:"settings-group"},cd={class:"settings-item"},dd={class:"checkbox-label"},gd=Ye({__name:"DetectionSettings",setup(n){const t=[{label:"CTD (Comic Text Detector)",value:"ctd"},{label:"YOLO",value:"yolo"},{label:"YOLOv5",value:"yolov5"},{label:"Default (DBNet)",value:"default"}],s=Fe(),o=_o({textDetector:s.settings.textDetector,boxExpandRatio:s.settings.boxExpand.ratio,boxExpandTop:s.settings.boxExpand.top,boxExpandBottom:s.settings.boxExpand.bottom,boxExpandLeft:s.settings.boxExpand.left,boxExpandRight:s.settings.boxExpand.right,usePreciseMask:s.settings.preciseMask.enabled,maskDilateSize:s.settings.preciseMask.dilateSize,maskBoxExpandRatio:s.settings.preciseMask.boxExpandRatio,showDetectionDebug:s.settings.showDetectionDebug}),a=G(()=>["ctd","default"].includes(o.textDetector));Ce(()=>o.textDetector,l=>{s.setTextDetector(l)}),Ce(()=>o.boxExpandRatio,l=>{s.updateBoxExpand({ratio:l})}),Ce(()=>o.boxExpandTop,l=>{s.updateBoxExpand({top:l})}),Ce(()=>o.boxExpandBottom,l=>{s.updateBoxExpand({bottom:l})}),Ce(()=>o.boxExpandLeft,l=>{s.updateBoxExpand({left:l})}),Ce(()=>o.boxExpandRight,l=>{s.updateBoxExpand({right:l})}),Ce(()=>o.usePreciseMask,l=>{s.updatePreciseMask({enabled:l})}),Ce(()=>o.maskDilateSize,l=>{s.updatePreciseMask({dilateSize:l})}),Ce(()=>o.maskBoxExpandRatio,l=>{s.updatePreciseMask({boxExpandRatio:l})}),Ce(()=>o.showDetectionDebug,l=>{s.setShowDetectionDebug(l)});function u(){a.value||(o.usePreciseMask=!1)}return(l,c)=>(B(),A("div",Hc,[e("div",jc,[c[11]||(c[11]=e("div",{class:"settings-group-title"},"æ–‡å­—æ£€æµ‹å™¨",-1)),e("div",Jc,[c[10]||(c[10]=e("label",{for:"settingsTextDetector"},"æ£€æµ‹å™¨ç±»å‹:",-1)),Se(We,{modelValue:o.textDetector,"onUpdate:modelValue":c[0]||(c[0]=g=>o.textDetector=g),options:t,onChange:u},null,8,["modelValue"])])]),e("div",Yc,[c[18]||(c[18]=e("div",{class:"settings-group-title"},"æ–‡æœ¬æ¡†æ‰©å±•å‚æ•°",-1)),e("div",Gc,[c[12]||(c[12]=e("label",{for:"settingsBoxExpandRatio"},"æ•´ä½“æ‰©å±• (%):",-1)),oe(e("input",{type:"number",id:"settingsBoxExpandRatio","onUpdate:modelValue":c[1]||(c[1]=g=>o.boxExpandRatio=g),min:"0",max:"50",step:"1"},null,512),[[Re,o.boxExpandRatio,void 0,{number:!0}]]),c[13]||(c[13]=e("div",{class:"input-hint"},"å‘å››å‘¨å‡åŒ€æ‰©å±•çš„ç™¾åˆ†æ¯” (0-50%)",-1))]),e("div",Xc,[e("div",Zc,[c[14]||(c[14]=e("label",{for:"settingsBoxExpandTop"},"ä¸Šæ–¹æ‰©å±• (%):",-1)),oe(e("input",{type:"number",id:"settingsBoxExpandTop","onUpdate:modelValue":c[2]||(c[2]=g=>o.boxExpandTop=g),min:"0",max:"50",step:"1"},null,512),[[Re,o.boxExpandTop,void 0,{number:!0}]])]),e("div",Qc,[c[15]||(c[15]=e("label",{for:"settingsBoxExpandBottom"},"ä¸‹æ–¹æ‰©å±• (%):",-1)),oe(e("input",{type:"number",id:"settingsBoxExpandBottom","onUpdate:modelValue":c[3]||(c[3]=g=>o.boxExpandBottom=g),min:"0",max:"50",step:"1"},null,512),[[Re,o.boxExpandBottom,void 0,{number:!0}]])])]),e("div",ed,[e("div",td,[c[16]||(c[16]=e("label",{for:"settingsBoxExpandLeft"},"å·¦ä¾§æ‰©å±• (%):",-1)),oe(e("input",{type:"number",id:"settingsBoxExpandLeft","onUpdate:modelValue":c[4]||(c[4]=g=>o.boxExpandLeft=g),min:"0",max:"50",step:"1"},null,512),[[Re,o.boxExpandLeft,void 0,{number:!0}]])]),e("div",od,[c[17]||(c[17]=e("label",{for:"settingsBoxExpandRight"},"å³ä¾§æ‰©å±• (%):",-1)),oe(e("input",{type:"number",id:"settingsBoxExpandRight","onUpdate:modelValue":c[5]||(c[5]=g=>o.boxExpandRight=g),min:"0",max:"50",step:"1"},null,512),[[Re,o.boxExpandRight,void 0,{number:!0}]])])])]),oe(e("div",nd,[c[25]||(c[25]=e("div",{class:"settings-group-title"},"ç²¾ç¡®æ–‡å­—æ©è†œ",-1)),e("div",sd,[e("label",ad,[oe(e("input",{type:"checkbox","onUpdate:modelValue":c[6]||(c[6]=g=>o.usePreciseMask=g)},null,512),[[Xe,o.usePreciseMask]]),c[19]||(c[19]=pe(" å¯ç”¨ç²¾ç¡®æ–‡å­—æ©è†œ ",-1))]),c[20]||(c[20]=e("div",{class:"input-hint"},"ä½¿ç”¨æ›´ç²¾ç¡®çš„æ–‡å­—åŒºåŸŸæ©è†œè¿›è¡Œä¿®å¤",-1))]),oe(e("div",ld,[e("div",id,[c[21]||(c[21]=e("label",{for:"settingsMaskDilateSize"},"è†¨èƒ€å¤§å°:",-1)),oe(e("input",{type:"number",id:"settingsMaskDilateSize","onUpdate:modelValue":c[7]||(c[7]=g=>o.maskDilateSize=g),min:"0",step:"1"},null,512),[[Re,o.maskDilateSize,void 0,{number:!0}]]),c[22]||(c[22]=e("div",{class:"input-hint"},"æ©è†œè†¨èƒ€åƒç´ æ•°",-1))]),e("div",rd,[c[23]||(c[23]=e("label",{for:"settingsMaskBoxExpandRatio"},"æ ‡æ³¨æ¡†æ‰©å¤§æ¯”ä¾‹ (%):",-1)),oe(e("input",{type:"number",id:"settingsMaskBoxExpandRatio","onUpdate:modelValue":c[8]||(c[8]=g=>o.maskBoxExpandRatio=g),min:"0",max:"100",step:"1"},null,512),[[Re,o.maskBoxExpandRatio,void 0,{number:!0}]]),c[24]||(c[24]=e("div",{class:"input-hint"},"æ ‡æ³¨æ¡†åŒºåŸŸæ‰©å¤§ç™¾åˆ†æ¯”",-1))])],512),[[Oe,o.usePreciseMask]])],512),[[Oe,a.value]]),e("div",ud,[c[28]||(c[28]=e("div",{class:"settings-group-title"},"è°ƒè¯•é€‰é¡¹",-1)),e("div",cd,[e("label",dd,[oe(e("input",{type:"checkbox","onUpdate:modelValue":c[9]||(c[9]=g=>o.showDetectionDebug=g)},null,512),[[Xe,o.showDetectionDebug]]),c[26]||(c[26]=pe(" æ˜¾ç¤ºæ£€æµ‹æ¡†è°ƒè¯•ä¿¡æ¯ ",-1))]),c[27]||(c[27]=e("div",{class:"input-hint"},"åœ¨ç¿»è¯‘ç»“æœä¸­æ˜¾ç¤ºæ°”æ³¡æ£€æµ‹æ¡†ï¼Œç”¨äºè°ƒè¯•",-1))])])]))}}),pd=Je(gd,[["__scopeId","data-v-c12c43ee"]]),md={class:"hq-translation-settings"},vd={class:"settings-group"},fd={class:"settings-row"},bd={class:"settings-item"},hd={class:"settings-item"},xd={class:"password-input-wrapper"},yd=["type"],_d={key:0,class:"eye-icon"},Cd={key:1,class:"eye-off-icon"},Sd={class:"settings-item"},kd={class:"settings-item"},wd={class:"model-input-with-fetch"},$d=["disabled"],Td={class:"fetch-text"},Id={key:0,class:"model-select-container"},Pd={class:"model-count"},Rd={class:"settings-item"},Dd=["disabled"],Md={class:"settings-group"},Bd={class:"settings-row"},Ed={class:"settings-item"},Ad={class:"settings-item"},Ld={class:"settings-row"},Fd={class:"settings-item"},Ud={class:"settings-item"},Od={class:"settings-group"},zd={class:"settings-row"},Nd={class:"settings-item"},Vd={class:"checkbox-label"},Wd={class:"settings-item"},Kd={class:"settings-row"},qd={class:"settings-item"},Hd={class:"checkbox-label"},jd={class:"settings-item"},Jd={class:"checkbox-label"},Yd={class:"settings-group"},Gd={class:"settings-item"},Xd=Ye({__name:"HqTranslationSettings",setup(n){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],s=[{label:"Geminié£æ ¼ (reasoning_effort=low)",value:"gemini"},{label:"ç«å±±å¼•æ“é£æ ¼ (thinking=null)",value:"volcano"}],o=Fe(),a=ct(),u=G(()=>o.settings.hqTranslation),l=w({apiKey:o.settings.hqTranslation.apiKey,modelName:o.settings.hqTranslation.modelName,customBaseUrl:o.settings.hqTranslation.customBaseUrl,batchSize:o.settings.hqTranslation.batchSize,sessionReset:o.settings.hqTranslation.sessionReset,rpmLimit:o.settings.hqTranslation.rpmLimit,maxRetries:o.settings.hqTranslation.maxRetries,lowReasoning:o.settings.hqTranslation.lowReasoning,noThinkingMethod:o.settings.hqTranslation.noThinkingMethod,forceJsonOutput:o.settings.hqTranslation.forceJsonOutput,useStream:o.settings.hqTranslation.useStream,prompt:o.settings.hqTranslation.prompt});Ce(()=>l.value.apiKey,b=>{o.updateHqTranslation({apiKey:b})}),Ce(()=>l.value.modelName,b=>{o.updateHqTranslation({modelName:b})}),Ce(()=>l.value.customBaseUrl,b=>{o.updateHqTranslation({customBaseUrl:b})}),Ce(()=>l.value.batchSize,b=>{o.updateHqTranslation({batchSize:b})}),Ce(()=>l.value.sessionReset,b=>{o.updateHqTranslation({sessionReset:b})}),Ce(()=>l.value.rpmLimit,b=>{o.updateHqTranslation({rpmLimit:b})}),Ce(()=>l.value.maxRetries,b=>{o.updateHqTranslation({maxRetries:b})}),Ce(()=>l.value.lowReasoning,b=>{o.updateHqTranslation({lowReasoning:b})}),Ce(()=>l.value.noThinkingMethod,b=>{o.updateHqTranslation({noThinkingMethod:b})}),Ce(()=>l.value.forceJsonOutput,b=>{o.updateHqTranslation({forceJsonOutput:b})}),Ce(()=>l.value.useStream,b=>{o.updateHqTranslation({useStream:b})}),Ce(()=>l.value.prompt,b=>{o.updateHqTranslation({prompt:b})});const c=w(!1),g=w(!1),d=w([]),C=w(!1),$=G(()=>{const b=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return d.value.forEach(p=>b.push({label:p,value:p})),b});function P(b){o.setHqProvider(b),d.value=[],R()}function R(){const b=o.settings.hqTranslation;l.value.apiKey=b.apiKey,l.value.modelName=b.modelName,l.value.customBaseUrl=b.customBaseUrl,l.value.batchSize=b.batchSize,l.value.sessionReset=b.sessionReset,l.value.rpmLimit=b.rpmLimit,l.value.maxRetries=b.maxRetries,l.value.lowReasoning=b.lowReasoning,l.value.noThinkingMethod=b.noThinkingMethod,l.value.forceJsonOutput=b.forceJsonOutput,l.value.useStream=b.useStream,l.value.prompt=b.prompt}function _(b){return{siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰OpenAI"}[b]||b}async function D(){const b=u.value.provider,p=l.value.apiKey?.trim(),T=l.value.customBaseUrl?.trim();if(!p){a.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(b)){a.warning(`${_(b)} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`);return}if(b==="custom_openai"&&!T){a.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}g.value=!0;try{const N=await je.fetchModels(b,p,T);N.success&&N.models&&N.models.length>0?(d.value=N.models.map(O=>O.id),a.success(`è·å–åˆ° ${N.models.length} ä¸ªæ¨¡å‹`)):a.warning(N.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(N){const O=N instanceof Error?N.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";a.error(O)}finally{g.value=!1}}async function j(){const b=u.value.provider,p=l.value.apiKey?.trim(),T=l.value.modelName?.trim(),k=l.value.customBaseUrl?.trim();if(!p){a.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!T){a.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}if(b==="custom_openai"&&!k){a.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å¡«å†™ Base URL");return}C.value=!0,a.info("æ­£åœ¨æµ‹è¯•è¿æ¥...");try{const N=await je.testAiTranslateConnection({provider:b,apiKey:p,modelName:T,baseUrl:k});N.success?a.success(N.message||`${_(b)} è¿æ¥æˆåŠŸ!`):a.error(N.message||N.error||"è¿æ¥å¤±è´¥")}catch(N){const O=N instanceof Error?N.message:"è¿æ¥æµ‹è¯•å¤±è´¥";a.error(O)}finally{C.value=!1}}function z(){o.updateHqTranslation({prompt:Xo}),l.value.prompt=Xo,a.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}function L(b,p){o.updateHqTranslation({prompt:b}),l.value.prompt=b,a.success(`å·²åº”ç”¨æç¤ºè¯: ${p}`)}return(b,p)=>(B(),A("div",md,[e("div",vd,[p[20]||(p[20]=e("div",{class:"settings-group-title"},"é«˜è´¨é‡ç¿»è¯‘æœåŠ¡é…ç½®",-1)),e("div",fd,[e("div",bd,[p[15]||(p[15]=e("label",{for:"settingsHqTranslateProvider"},"æœåŠ¡å•†:",-1)),Se(We,{"model-value":u.value.provider,options:t,onChange:p[0]||(p[0]=T=>P(T))},null,8,["model-value"])]),e("div",hd,[p[16]||(p[16]=e("label",{for:"settingsHqApiKey"},"API Key:",-1)),e("div",xd,[oe(e("input",{type:c.value?"text":"password",id:"settingsHqApiKey","onUpdate:modelValue":p[1]||(p[1]=T=>l.value.apiKey=T),class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,yd),[[$t,l.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:p[2]||(p[2]=T=>c.value=!c.value)},[c.value?(B(),A("span",Cd,"ğŸ‘â€ğŸ—¨")):(B(),A("span",_d,"ğŸ‘"))])])])]),oe(e("div",Sd,[p[17]||(p[17]=e("label",{for:"settingsHqCustomBaseUrl"},"Base URL:",-1)),oe(e("input",{type:"text",id:"settingsHqCustomBaseUrl","onUpdate:modelValue":p[3]||(p[3]=T=>l.value.customBaseUrl=T),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[Re,l.value.customBaseUrl]])],512),[[Oe,u.value.provider==="custom_openai"]]),e("div",kd,[p[19]||(p[19]=e("label",{for:"settingsHqModelName"},"æ¨¡å‹åç§°:",-1)),e("div",wd,[oe(e("input",{type:"text",id:"settingsHqModelName","onUpdate:modelValue":p[4]||(p[4]=T=>l.value.modelName=T),placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},null,512),[[Re,l.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:D,disabled:g.value},[p[18]||(p[18]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",Td,te(g.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,$d)]),d.value.length>0?(B(),A("div",Id,[Se(We,{modelValue:l.value.modelName,"onUpdate:modelValue":p[5]||(p[5]=T=>l.value.modelName=T),options:$.value},null,8,["modelValue","options"]),e("span",Pd,"å…± "+te(d.value.length)+" ä¸ªæ¨¡å‹",1)])):ce("",!0)]),e("div",Rd,[e("button",{class:"settings-test-btn",onClick:j,disabled:C.value},te(C.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,Dd)])]),e("div",Md,[p[28]||(p[28]=e("div",{class:"settings-group-title"},"æ‰¹å¤„ç†è®¾ç½®",-1)),e("div",Bd,[e("div",Ed,[p[21]||(p[21]=e("label",{for:"settingsHqBatchSize"},"æ‰¹æ¬¡å¤§å°:",-1)),oe(e("input",{type:"number",id:"settingsHqBatchSize","onUpdate:modelValue":p[6]||(p[6]=T=>l.value.batchSize=T),min:"1",max:"10",step:"1"},null,512),[[Re,l.value.batchSize,void 0,{number:!0}]]),p[22]||(p[22]=e("div",{class:"input-hint"},"æ¯æ‰¹å¤„ç†çš„å›¾ç‰‡æ•°é‡ (æ¨è3-5å¼ )",-1))]),e("div",Ad,[p[23]||(p[23]=e("label",{for:"settingsHqSessionReset"},"ä¼šè¯é‡ç½®é¢‘ç‡:",-1)),oe(e("input",{type:"number",id:"settingsHqSessionReset","onUpdate:modelValue":p[7]||(p[7]=T=>l.value.sessionReset=T),min:"1",step:"1"},null,512),[[Re,l.value.sessionReset,void 0,{number:!0}]]),p[24]||(p[24]=e("div",{class:"input-hint"},"å¤šå°‘æ‰¹æ¬¡åé‡ç½®ä¸Šä¸‹æ–‡",-1))])]),e("div",Ld,[e("div",Fd,[p[25]||(p[25]=e("label",{for:"settingsHqRpmLimit"},"RPMé™åˆ¶:",-1)),oe(e("input",{type:"number",id:"settingsHqRpmLimit","onUpdate:modelValue":p[8]||(p[8]=T=>l.value.rpmLimit=T),min:"0",step:"1"},null,512),[[Re,l.value.rpmLimit,void 0,{number:!0}]]),p[26]||(p[26]=e("div",{class:"input-hint"},"æ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",Ud,[p[27]||(p[27]=e("label",{for:"settingsHqMaxRetries"},"é‡è¯•æ¬¡æ•°:",-1)),oe(e("input",{type:"number",id:"settingsHqMaxRetries","onUpdate:modelValue":p[9]||(p[9]=T=>l.value.maxRetries=T),min:"0",max:"10",step:"1"},null,512),[[Re,l.value.maxRetries,void 0,{number:!0}]])])])]),e("div",Od,[p[36]||(p[36]=e("div",{class:"settings-group-title"},"é«˜çº§é€‰é¡¹",-1)),e("div",zd,[e("div",Nd,[e("label",Vd,[oe(e("input",{type:"checkbox","onUpdate:modelValue":p[10]||(p[10]=T=>l.value.lowReasoning=T)},null,512),[[Xe,l.value.lowReasoning]]),p[29]||(p[29]=pe(" ä½æ¨ç†æ¨¡å¼ ",-1))]),p[30]||(p[30]=e("div",{class:"input-hint"},"å‡å°‘æ¨¡å‹æ¨ç†æ·±åº¦ï¼Œæé«˜é€Ÿåº¦",-1))]),e("div",Wd,[p[31]||(p[31]=e("label",{for:"settingsHqNoThinkingMethod"},"å–æ¶ˆæ€è€ƒæ–¹æ³•:",-1)),Se(We,{modelValue:l.value.noThinkingMethod,"onUpdate:modelValue":p[11]||(p[11]=T=>l.value.noThinkingMethod=T),options:s},null,8,["modelValue"])])]),e("div",Kd,[e("div",qd,[e("label",Hd,[oe(e("input",{type:"checkbox","onUpdate:modelValue":p[12]||(p[12]=T=>l.value.forceJsonOutput=T)},null,512),[[Xe,l.value.forceJsonOutput]]),p[32]||(p[32]=pe(" å¼ºåˆ¶JSONè¾“å‡º ",-1))]),p[33]||(p[33]=e("div",{class:"input-hint"},"ä½¿ç”¨ response_format: json_object",-1))]),e("div",jd,[e("label",Jd,[oe(e("input",{type:"checkbox","onUpdate:modelValue":p[13]||(p[13]=T=>l.value.useStream=T)},null,512),[[Xe,l.value.useStream]]),p[34]||(p[34]=pe(" æµå¼è°ƒç”¨ ",-1))]),p[35]||(p[35]=e("div",{class:"input-hint"},"ä½¿ç”¨æµå¼APIè°ƒç”¨",-1))])])]),e("div",Yd,[p[37]||(p[37]=e("div",{class:"settings-group-title"},"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯",-1)),e("div",Gd,[oe(e("textarea",{id:"settingsHqPrompt","onUpdate:modelValue":p[14]||(p[14]=T=>l.value.prompt=T),rows:"6",placeholder:"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯"},null,512),[[Re,l.value.prompt]]),Se(Ot,{"prompt-type":"hq_translate",onSelect:L}),e("button",{class:"btn btn-secondary btn-sm",onClick:z},"é‡ç½®ä¸ºé»˜è®¤")])])]))}}),Zd=Je(Xd,[["__scopeId","data-v-23f4a3f7"]]),Qd={class:"proofreading-settings"},eg={class:"settings-group"},tg={class:"settings-item"},og={class:"checkbox-label"},ng={class:"settings-item"},sg={class:"settings-group"},ag={class:"round-header"},lg={class:"round-title"},ig=["onClick","disabled"],rg={class:"round-content"},ug={class:"settings-item"},cg=["onUpdate:modelValue"],dg={class:"settings-row"},gg={class:"settings-item"},pg={class:"settings-item"},mg={class:"password-input-wrapper"},vg=["type","onUpdate:modelValue"],fg=["onClick"],bg={key:0,class:"eye-icon"},hg={key:1,class:"eye-off-icon"},xg={class:"settings-item"},yg=["onUpdate:modelValue"],_g={class:"settings-item"},Cg={class:"model-input-with-fetch"},Sg=["onUpdate:modelValue"],kg=["onClick","disabled"],wg={class:"fetch-text"},$g={key:0,class:"model-select-container"},Tg={class:"model-count"},Ig={class:"settings-item"},Pg=["onClick","disabled"],Rg={class:"settings-row"},Dg={class:"settings-item"},Mg=["onUpdate:modelValue"],Bg={class:"settings-item"},Eg=["onUpdate:modelValue"],Ag={class:"settings-item"},Lg=["onUpdate:modelValue"],Fg={class:"settings-row"},Ug={class:"settings-item"},Og={class:"checkbox-label"},zg=["onUpdate:modelValue"],Ng={class:"settings-item"},Vg={class:"settings-row"},Wg={class:"settings-item"},Kg={class:"checkbox-label"},qg=["onUpdate:modelValue"],Hg={class:"settings-item"},jg={class:"checkbox-label"},Jg=["onUpdate:modelValue"],Yg={class:"settings-item"},Gg=["onUpdate:modelValue"],Xg=["onClick"],Zg=Ye({__name:"ProofreadingSettings",setup(n){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],s=[{label:"Geminié£æ ¼",value:"gemini"},{label:"ç«å±±å¼•æ“é£æ ¼",value:"volcano"}],o=Fe(),a=ct(),u=w({}),l=w({}),c=w({}),g=G(()=>o.settings.proofreading.rounds),d=G({get:()=>o.settings.proofreading.maxRetries,set:L=>o.setProofreadingMaxRetries(L)}),C=G({get:()=>o.settings.proofreading.enabled,set:L=>o.setProofreadingEnabled(L)});Ce(()=>o.settings.proofreading.rounds,()=>{o.saveToStorage()},{deep:!0});function $(L){const b=c.value[L]||[],p=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return b.forEach(T=>p.push({label:T,value:T})),p}async function P(L){const b=g.value[L];if(!b)return;const p=b.provider,T=b.apiKey?.trim(),k=b.customBaseUrl?.trim();if(!T){a.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(p)){a.warning("å½“å‰æœåŠ¡å•†ä¸æ”¯æŒè·å–æ¨¡å‹åˆ—è¡¨");return}u.value[L]=!0;try{const O=await je.fetchModels(p,T,k);O.success&&O.models&&O.models.length>0?(c.value[L]=O.models.map(ee=>ee.id),a.success(`è½®æ¬¡ ${L+1}: è·å–åˆ° ${O.models.length} ä¸ªæ¨¡å‹`)):a.warning(O.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(O){const ee=O instanceof Error?O.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";a.error(ee)}finally{u.value[L]=!1}}async function R(L){const b=g.value[L];if(!b)return;const p=b.provider,T=b.apiKey?.trim(),k=b.modelName?.trim(),N=b.customBaseUrl?.trim();if(!T){a.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!k){a.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}l.value[L]=!0,a.info(`æ­£åœ¨æµ‹è¯•è½®æ¬¡ ${L+1} çš„è¿æ¥...`);try{const O=await je.testAiTranslateConnection({provider:p,apiKey:T,modelName:k,baseUrl:N});O.success?a.success(O.message||"è¿æ¥æˆåŠŸ!"):a.error(O.message||O.error||"è¿æ¥å¤±è´¥")}catch(O){const ee=O instanceof Error?O.message:"è¿æ¥æµ‹è¯•å¤±è´¥";a.error(ee)}finally{l.value[L]=!1}}function _(){const L={name:`ç¬¬${g.value.length+1}è½®æ ¡å¯¹`,provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",batchSize:3,sessionReset:3,rpmLimit:7,lowReasoning:!1,noThinkingMethod:"gemini",forceJsonOutput:!1,useStream:!0,prompt:Zo,showApiKey:!1};o.addProofreadingRound(L),a.success("å·²æ·»åŠ æ–°çš„æ ¡å¯¹è½®æ¬¡")}function D(L){if(g.value.length<=1){a.warning("è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªæ ¡å¯¹è½®æ¬¡");return}o.removeProofreadingRound(L),a.success("å·²åˆ é™¤æ ¡å¯¹è½®æ¬¡")}function j(L){o.updateProofreadingRound(L,{prompt:Zo}),a.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}function z(L,b,p){o.updateProofreadingRound(L,{prompt:b}),a.success(`å·²åº”ç”¨æç¤ºè¯: ${p}`)}return(L,b)=>(B(),A("div",Qd,[e("div",eg,[b[5]||(b[5]=e("div",{class:"settings-group-title"},"AIæ ¡å¯¹è®¾ç½®",-1)),e("div",tg,[e("label",og,[oe(e("input",{type:"checkbox","onUpdate:modelValue":b[0]||(b[0]=p=>C.value=p)},null,512),[[Xe,C.value]]),b[2]||(b[2]=pe(" å¯ç”¨AIæ ¡å¯¹ ",-1))]),b[3]||(b[3]=e("div",{class:"input-hint"},"ç¿»è¯‘å®Œæˆåè‡ªåŠ¨è¿›è¡ŒAIæ ¡å¯¹",-1))]),e("div",ng,[b[4]||(b[4]=e("label",{for:"settingsProofreadingMaxRetries"},"å…¨å±€é‡è¯•æ¬¡æ•°:",-1)),oe(e("input",{type:"number",id:"settingsProofreadingMaxRetries","onUpdate:modelValue":b[1]||(b[1]=p=>d.value=p),min:"0",max:"10",step:"1"},null,512),[[Re,d.value,void 0,{number:!0}]])])]),oe(e("div",sg,[e("div",{class:"settings-group-title"},[b[6]||(b[6]=pe(" æ ¡å¯¹è½®æ¬¡é…ç½® ",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:_},"+ æ·»åŠ è½®æ¬¡")]),(B(!0),A(ze,null,Ge(g.value,(p,T)=>(B(),A("div",{key:T,class:"proofreading-round"},[e("div",ag,[e("span",lg,"è½®æ¬¡ "+te(T+1)+": "+te(p.name||"æœªå‘½å"),1),e("button",{class:"btn btn-danger btn-sm",onClick:k=>D(T),disabled:g.value.length<=1}," åˆ é™¤ ",8,ig)]),e("div",rg,[e("div",ug,[b[7]||(b[7]=e("label",null,"è½®æ¬¡åç§°:",-1)),oe(e("input",{type:"text","onUpdate:modelValue":k=>p.name=k,placeholder:"å¦‚: ç¬¬ä¸€è½®æ ¡å¯¹"},null,8,cg),[[Re,p.name]])]),e("div",dg,[e("div",gg,[b[8]||(b[8]=e("label",null,"æœåŠ¡å•†:",-1)),Se(We,{modelValue:p.provider,"onUpdate:modelValue":k=>p.provider=k,options:t},null,8,["modelValue","onUpdate:modelValue"])]),e("div",pg,[b[9]||(b[9]=e("label",null,"API Key:",-1)),e("div",mg,[oe(e("input",{type:p.showApiKey?"text":"password","onUpdate:modelValue":k=>p.apiKey=k,class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,vg),[[$t,p.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:k=>p.showApiKey=!p.showApiKey},[p.showApiKey?(B(),A("span",hg,"ğŸ‘â€ğŸ—¨")):(B(),A("span",bg,"ğŸ‘"))],8,fg)])])]),oe(e("div",xg,[b[10]||(b[10]=e("label",null,"Base URL:",-1)),oe(e("input",{type:"text","onUpdate:modelValue":k=>p.customBaseUrl=k,placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,8,yg),[[Re,p.customBaseUrl]])],512),[[Oe,p.provider==="custom_openai"]]),e("div",_g,[b[12]||(b[12]=e("label",null,"æ¨¡å‹åç§°:",-1)),e("div",Cg,[oe(e("input",{type:"text","onUpdate:modelValue":k=>p.modelName=k,placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},null,8,Sg),[[Re,p.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:k=>P(T),disabled:u.value[T]},[b[11]||(b[11]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",wg,te(u.value[T]?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,kg)]),c.value[T]&&c.value[T].length>0?(B(),A("div",$g,[Se(We,{modelValue:p.modelName,"onUpdate:modelValue":k=>p.modelName=k,options:$(T)},null,8,["modelValue","onUpdate:modelValue","options"]),e("span",Tg,"å…± "+te(c.value[T].length)+" ä¸ªæ¨¡å‹",1)])):ce("",!0)]),e("div",Ig,[e("button",{class:"settings-test-btn",onClick:k=>R(T),disabled:l.value[T]},te(l.value[T]?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,Pg)]),e("div",Rg,[e("div",Dg,[b[13]||(b[13]=e("label",null,"æ‰¹æ¬¡å¤§å°:",-1)),oe(e("input",{type:"number","onUpdate:modelValue":k=>p.batchSize=k,min:"1",max:"10",step:"1"},null,8,Mg),[[Re,p.batchSize,void 0,{number:!0}]])]),e("div",Bg,[b[14]||(b[14]=e("label",null,"ä¼šè¯é‡ç½®é¢‘ç‡:",-1)),oe(e("input",{type:"number","onUpdate:modelValue":k=>p.sessionReset=k,min:"1",step:"1"},null,8,Eg),[[Re,p.sessionReset,void 0,{number:!0}]])]),e("div",Ag,[b[15]||(b[15]=e("label",null,"RPMé™åˆ¶:",-1)),oe(e("input",{type:"number","onUpdate:modelValue":k=>p.rpmLimit=k,min:"0",step:"1"},null,8,Lg),[[Re,p.rpmLimit,void 0,{number:!0}]])])]),e("div",Fg,[e("div",Ug,[e("label",Og,[oe(e("input",{type:"checkbox","onUpdate:modelValue":k=>p.lowReasoning=k},null,8,zg),[[Xe,p.lowReasoning]]),b[16]||(b[16]=pe(" ä½æ¨ç†æ¨¡å¼ ",-1))]),b[17]||(b[17]=e("div",{class:"input-hint"},"å‡å°‘æ¨¡å‹æ¨ç†æ·±åº¦ï¼Œæé«˜é€Ÿåº¦",-1))]),e("div",Ng,[b[18]||(b[18]=e("label",null,"å–æ¶ˆæ€è€ƒæ–¹æ³•:",-1)),Se(We,{modelValue:p.noThinkingMethod,"onUpdate:modelValue":k=>p.noThinkingMethod=k,options:s},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Vg,[e("div",Wg,[e("label",Kg,[oe(e("input",{type:"checkbox","onUpdate:modelValue":k=>p.forceJsonOutput=k},null,8,qg),[[Xe,p.forceJsonOutput]]),b[19]||(b[19]=pe(" å¼ºåˆ¶JSONè¾“å‡º ",-1))]),b[20]||(b[20]=e("div",{class:"input-hint"},"ä½¿ç”¨ response_format: json_object",-1))]),e("div",Hg,[e("label",jg,[oe(e("input",{type:"checkbox","onUpdate:modelValue":k=>p.useStream=k},null,8,Jg),[[Xe,p.useStream]]),b[21]||(b[21]=pe(" æµå¼è°ƒç”¨ ",-1))]),b[22]||(b[22]=e("div",{class:"input-hint"},"ä½¿ç”¨æµå¼APIè°ƒç”¨ï¼Œé¿å…è¶…æ—¶",-1))])]),e("div",Yg,[b[23]||(b[23]=e("label",null,"æ ¡å¯¹æç¤ºè¯:",-1)),oe(e("textarea",{"onUpdate:modelValue":k=>p.prompt=k,rows:"4",placeholder:"æ ¡å¯¹æç¤ºè¯"},null,8,Gg),[[Re,p.prompt]]),Se(Ot,{"prompt-type":"proofreading",onSelect:(k,N)=>z(T,k,N)},null,8,["onSelect"]),e("button",{class:"btn btn-secondary btn-sm",onClick:k=>j(T)},"é‡ç½®ä¸ºé»˜è®¤",8,Xg)])])]))),128))],512),[[Oe,C.value]])]))}}),Qg=Je(Zg,[["__scopeId","data-v-7e4f95fe"]]),ep={class:"prompt-library"},tp={class:"settings-group"},op={class:"settings-item"},np={key:0,class:"settings-item"},sp={class:"mode-hint"},ap={class:"settings-group"},lp={key:0,class:"loading-hint"},ip={key:1,class:"empty-hint"},rp={key:2,class:"prompt-list"},up=["onClick"],cp={class:"prompt-name"},dp={class:"prompt-actions"},gp=["onClick"],pp=["onClick","disabled"],mp={class:"settings-group"},vp={class:"settings-item"},fp={class:"settings-item"},bp={class:"prompt-editor-actions"},hp=["disabled"],xp=Ye({__name:"PromptLibrary",setup(n){const t=[{label:"ç¿»è¯‘æç¤ºè¯",value:"translate"},{label:"æ–‡æœ¬æ¡†æç¤ºè¯",value:"textbox"},{label:"AIè§†è§‰OCRæç¤ºè¯",value:"ai_vision_ocr"},{label:"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯",value:"hq_translate"},{label:"æ ¡å¯¹æç¤ºè¯",value:"proofreading"}],s=[{label:"æ™®é€šæ¨¡å¼",value:"false"},{label:"JSONæ ¼å¼æ¨¡å¼",value:"true"}],o=ct(),a=Fe(),u=w("translate"),l=w([]),c=w(""),g=w(""),d=w(""),C=w(!1),$=w(!1),P=G(()=>u.value==="translate"||u.value==="ai_vision_ocr"),R=G(()=>$.value?"é€‚ç”¨äºéœ€è¦ç»“æ„åŒ–è¾“å‡ºçš„åœºæ™¯":"é€‚ç”¨äºæ™®é€šç¿»è¯‘åœºæ™¯");async function _(){C.value=!0;try{let T;u.value==="textbox"?T=await je.getTextboxPrompts():T=await je.getPrompts(u.value);const k=T.prompt_names||[];l.value=k.map(N=>({name:N}))}catch(T){const k=T instanceof Error?T.message:"åŠ è½½æç¤ºè¯åˆ—è¡¨å¤±è´¥";o.error(k)}finally{C.value=!1}}async function D(T){c.value=T,g.value=T,await j(T)}async function j(T){try{let k;u.value==="textbox"?k=await je.getTextboxPromptContent(T):k=await je.getPromptContent(u.value,T),g.value=T,d.value=k.prompt_content||"",c.value=T,o.success("å·²åŠ è½½æç¤ºè¯")}catch(k){const N=k instanceof Error?k.message:"åŠ è½½æç¤ºè¯å†…å®¹å¤±è´¥";o.error(N)}}async function z(){if(!g.value||!d.value){o.warning("è¯·è¾“å…¥æç¤ºè¯åç§°å’Œå†…å®¹");return}try{u.value==="textbox"?await je.saveTextboxPrompt(g.value,d.value):await je.savePrompt(u.value,g.value,d.value),o.success("æç¤ºè¯ä¿å­˜æˆåŠŸ"),g.value="",d.value="",await _()}catch(T){const k=T instanceof Error?T.message:"ä¿å­˜æç¤ºè¯å¤±è´¥";o.error(k)}}async function L(T){if(T==="default"){o.warning("é»˜è®¤æç¤ºè¯ä¸èƒ½åˆ é™¤");return}try{u.value==="textbox"?await je.deleteTextboxPrompt(T):await je.deletePrompt(u.value,T),o.success("æç¤ºè¯åˆ é™¤æˆåŠŸ"),c.value===T&&(c.value="",g.value="",d.value=""),await _()}catch(k){const N=k instanceof Error?k.message:"åˆ é™¤æç¤ºè¯å¤±è´¥";o.error(N)}}function b(){c.value="",g.value="",d.value="",u.value==="translate"?$.value=a.settings.translation.isJsonMode:u.value==="ai_vision_ocr"?$.value=a.settings.aiVisionOcr.isJsonMode:$.value=!1,_()}function p(){u.value==="translate"?a.updateTranslationService({isJsonMode:$.value}):u.value==="ai_vision_ocr"&&a.updateAiVisionOcr({isJsonMode:$.value}),o.info(`å·²åˆ‡æ¢åˆ°${$.value?"JSONæ ¼å¼":"æ™®é€š"}æ¨¡å¼`)}return dt(()=>{$.value=a.settings.translation.isJsonMode,_()}),(T,k)=>(B(),A("div",ep,[e("div",tp,[k[6]||(k[6]=e("div",{class:"settings-group-title"},"æç¤ºè¯ç®¡ç†",-1)),e("div",op,[k[4]||(k[4]=e("label",{for:"promptType"},"æç¤ºè¯ç±»å‹:",-1)),Se(We,{modelValue:u.value,"onUpdate:modelValue":k[0]||(k[0]=N=>u.value=N),options:t,onChange:b},null,8,["modelValue"])]),P.value?(B(),A("div",np,[k[5]||(k[5]=e("label",{for:"promptMode"},"æç¤ºè¯æ¨¡å¼:",-1)),Se(We,{"model-value":$.value?"true":"false",options:s,onChange:k[1]||(k[1]=N=>{$.value=N==="true",p()})},null,8,["model-value"]),e("span",sp,te(R.value),1)])):ce("",!0)]),e("div",ap,[k[7]||(k[7]=e("div",{class:"settings-group-title"},"å·²ä¿å­˜çš„æç¤ºè¯",-1)),C.value?(B(),A("div",lp,"åŠ è½½ä¸­...")):l.value.length===0?(B(),A("div",ip,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(B(),A("div",rp,[(B(!0),A(ze,null,Ge(l.value,N=>(B(),A("div",{key:N.name,class:De(["prompt-item",{active:c.value===N.name}]),onClick:O=>D(N.name)},[e("span",cp,te(N.name),1),e("div",dp,[e("button",{class:"btn btn-sm",onClick:st(O=>j(N.name),["stop"]),title:"åŠ è½½åˆ°ç¼–è¾‘å™¨"},"ğŸ“¥",8,gp),e("button",{class:"btn btn-sm btn-danger",onClick:st(O=>L(N.name),["stop"]),title:"åˆ é™¤",disabled:N.name==="default"}," ğŸ—‘ï¸ ",8,pp)])],10,up))),128))]))]),e("div",mp,[k[10]||(k[10]=e("div",{class:"settings-group-title"},"æç¤ºè¯ç¼–è¾‘",-1)),e("div",vp,[k[8]||(k[8]=e("label",{for:"promptName"},"æç¤ºè¯åç§°:",-1)),oe(e("input",{type:"text",id:"promptName","onUpdate:modelValue":k[2]||(k[2]=N=>g.value=N),placeholder:"è¯·è¾“å…¥æç¤ºè¯åç§°"},null,512),[[Re,g.value]])]),e("div",fp,[k[9]||(k[9]=e("label",{for:"promptContent"},"æç¤ºè¯å†…å®¹:",-1)),oe(e("textarea",{id:"promptContent","onUpdate:modelValue":k[3]||(k[3]=N=>d.value=N),rows:"8",placeholder:"è¯·è¾“å…¥æç¤ºè¯å†…å®¹"},null,512),[[Re,d.value]])]),e("div",bp,[e("button",{class:"btn btn-primary",onClick:z,disabled:!g.value||!d.value},"ä¿å­˜æç¤ºè¯",8,hp)])])]))}}),yp=Je(xp,[["__scopeId","data-v-70f0ec19"]]),_p={class:"plugin-manager"},Cp={class:"settings-group"},Sp={key:0,class:"loading-hint"},kp={key:1,class:"empty-hint"},wp={key:2,class:"plugin-list"},$p={class:"plugin-info"},Tp={class:"plugin-header"},Ip={class:"plugin-name"},Pp={class:"plugin-version"},Rp={class:"plugin-description"},Dp={class:"plugin-controls"},Mp={class:"switch"},Bp=["checked","onChange"],Ep=["onClick"],Ap=["onClick"],Lp={class:"settings-group"},Fp={class:"plugin-name"},Up={class:"switch"},Op=["checked","onChange"],zp={class:"plugin-config-content"},Np={class:"plugin-config-header"},Vp={class:"plugin-config-body"},Wp=["for"],Kp=["id","onUpdate:modelValue"],qp=["id","onUpdate:modelValue","min","max"],Hp=["id","onUpdate:modelValue","placeholder"],jp={key:4,class:"field-description"},Jp=Ye({__name:"PluginManager",setup(n){const t=ct(),s=w([]),o=w({}),a=w(!1),u=w(!1),l=w(null),c=w({}),g=w({});async function d(){a.value=!0;try{const z=await ea();s.value=z.plugins||[]}catch(z){const L=z instanceof Error?z.message:"åŠ è½½æ’ä»¶åˆ—è¡¨å¤±è´¥";t.error(L)}finally{a.value=!1}}async function C(){try{const z=await ua();o.value=z.states||{}}catch(z){console.error("åŠ è½½é»˜è®¤çŠ¶æ€å¤±è´¥:",z)}}async function $(z){try{z.enabled?(await oa(z.name),z.enabled=!1,t.success(`å·²ç¦ç”¨ ${z.display_name||z.name}`)):(await ta(z.name),z.enabled=!0,t.success(`å·²å¯ç”¨ ${z.display_name||z.name}`))}catch(L){const b=L instanceof Error?L.message:"æ“ä½œå¤±è´¥";t.error(b)}}async function P(z,L){const b=L.target,p=b.checked;try{await ca(z,p),o.value[z]=p,t.success("é»˜è®¤çŠ¶æ€å·²æ›´æ–°")}catch(T){const k=T instanceof Error?T.message:"è®¾ç½®å¤±è´¥";t.error(k),b.checked=!p}}async function R(z){l.value=z;try{const L=await da(z.name);c.value=L.schema||{};const b=await ga(z.name);g.value=b.config||{},u.value=!0}catch(L){const b=L instanceof Error?L.message:"åŠ è½½é…ç½®å¤±è´¥";t.error(b)}}function _(){u.value=!1,l.value=null,c.value={},g.value={}}async function D(){if(l.value)try{await pa(l.value.name,g.value),t.success("é…ç½®ä¿å­˜æˆåŠŸ"),_()}catch(z){const L=z instanceof Error?z.message:"ä¿å­˜é…ç½®å¤±è´¥";t.error(L)}}async function j(z){if(confirm(`ç¡®å®šè¦åˆ é™¤æ’ä»¶ "${z.display_name||z.name}" å—ï¼Ÿ`))try{await na(z.name),t.success("æ’ä»¶åˆ é™¤æˆåŠŸ"),await d()}catch(L){const b=L instanceof Error?L.message:"åˆ é™¤æ’ä»¶å¤±è´¥";t.error(b)}}return dt(()=>{d(),C()}),(z,L)=>(B(),A("div",_p,[e("div",Cp,[L[1]||(L[1]=e("div",{class:"settings-group-title"},"å·²å®‰è£…æ’ä»¶",-1)),a.value?(B(),A("div",Sp,"åŠ è½½ä¸­...")):s.value.length===0?(B(),A("div",kp,"æš‚æ— å·²å®‰è£…çš„æ’ä»¶")):(B(),A("div",wp,[(B(!0),A(ze,null,Ge(s.value,b=>(B(),A("div",{key:b.name,class:"plugin-item"},[e("div",$p,[e("div",Tp,[e("span",Ip,te(b.display_name||b.name),1),e("span",Pp,"v"+te(b.version||"1.0.0"),1)]),e("p",Rp,te(b.description||"æš‚æ— æè¿°"),1)]),e("div",Dp,[e("label",Mp,[e("input",{type:"checkbox",checked:b.enabled,onChange:p=>$(b)},null,40,Bp),L[0]||(L[0]=e("span",{class:"slider"},null,-1))]),b.has_config?(B(),A("button",{key:0,class:"btn btn-sm",onClick:p=>R(b),title:"é…ç½®"},"âš™ï¸",8,Ep)):ce("",!0),e("button",{class:"btn btn-sm btn-danger",onClick:p=>j(b),title:"åˆ é™¤"},"ğŸ—‘ï¸",8,Ap)])]))),128))]))]),e("div",Lp,[L[3]||(L[3]=e("div",{class:"settings-group-title"},"é»˜è®¤å¯ç”¨çŠ¶æ€",-1)),L[4]||(L[4]=e("p",{class:"settings-hint"},"è®¾ç½®æ’ä»¶åœ¨æ–°ä¼šè¯ä¸­çš„é»˜è®¤å¯ç”¨çŠ¶æ€",-1)),(B(!0),A(ze,null,Ge(s.value,b=>(B(),A("div",{key:"default-"+b.name,class:"default-state-item"},[e("span",Fp,te(b.display_name||b.name),1),e("label",Up,[e("input",{type:"checkbox",checked:o.value[b.name],onChange:p=>P(b.name,p)},null,40,Op),L[2]||(L[2]=e("span",{class:"slider"},null,-1))])]))),128))]),u.value?(B(),A("div",{key:0,class:"plugin-config-modal",onClick:st(_,["self"])},[e("div",zp,[e("div",Np,[e("h4",null,te(l.value?.display_name||l.value?.name)+" é…ç½®",1),e("span",{class:"close-btn",onClick:_},"Ã—")]),e("div",Vp,[(B(!0),A(ze,null,Ge(c.value,(b,p)=>(B(),A("div",{key:p,class:"config-field"},[e("label",{for:"config-"+p},te(b.label||p)+":",9,Wp),b.type==="boolean"?oe((B(),A("input",{key:0,type:"checkbox",id:"config-"+p,"onUpdate:modelValue":T=>g.value[p]=T},null,8,Kp)),[[Xe,g.value[p]]]):b.type==="select"?(B(),ut(We,{key:1,"model-value":String(g.value[p]??""),options:b.options||[],onChange:T=>{g.value[p]=T}},null,8,["model-value","options","onChange"])):b.type==="number"?oe((B(),A("input",{key:2,type:"number",id:"config-"+p,"onUpdate:modelValue":T=>g.value[p]=T,min:b.min,max:b.max},null,8,qp)),[[Re,g.value[p],void 0,{number:!0}]]):oe((B(),A("input",{key:3,type:"text",id:"config-"+p,"onUpdate:modelValue":T=>g.value[p]=T,placeholder:b.placeholder},null,8,Hp)),[[Re,g.value[p]]]),b.description?(B(),A("p",jp,te(b.description),1)):ce("",!0)]))),128))]),e("div",{class:"plugin-config-footer"},[e("button",{class:"btn btn-secondary",onClick:_},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:D},"ä¿å­˜")])])])):ce("",!0)]))}}),Yp=Je(Jp,[["__scopeId","data-v-a62393a7"]]),Gp={class:"parallel-settings"},Xp={class:"settings-group"},Zp={class:"settings-item"},Qp={class:"toggle-switch"},em={class:"number-control"},tm=["disabled"],om=["disabled"],nm=["disabled"],sm={key:0,class:"settings-note"},am=Ye({__name:"ParallelSettings",setup(n){const t=Fe(),s=G({get:()=>t.settings.parallel.enabled,set:a=>{t.updateSettings({parallel:{...t.settings.parallel,enabled:a}})}}),o=G({get:()=>t.settings.parallel.deepLearningLockSize,set:a=>{t.updateSettings({parallel:{...t.settings.parallel,deepLearningLockSize:Math.max(1,Math.min(4,a))}})}});return(a,u)=>(B(),A("div",Gp,[e("div",Xp,[u[10]||(u[10]=e("div",{class:"settings-group-title"},"ğŸš€ å¹¶è¡Œç¿»è¯‘",-1)),e("div",Zp,[u[5]||(u[5]=e("label",null,"å¯ç”¨å¹¶è¡Œæ¨¡å¼:",-1)),e("label",Qp,[oe(e("input",{type:"checkbox","onUpdate:modelValue":u[0]||(u[0]=l=>s.value=l)},null,512),[[Xe,s.value]]),u[4]||(u[4]=e("span",{class:"toggle-slider"},null,-1))]),u[6]||(u[6]=e("div",{class:"input-hint"},"ä½¿ç”¨æµæ°´çº¿å¹¶è¡Œå¤„ç†ï¼Œå¯èƒ½æå‡æ‰¹é‡ç¿»è¯‘é€Ÿåº¦",-1))]),e("div",{class:De(["settings-item",{"item-disabled":!s.value}])},[u[7]||(u[7]=e("label",null,"æ·±åº¦å­¦ä¹ å¹¶å‘æ•°:",-1)),e("div",em,[e("button",{class:"btn btn-sm",onClick:u[1]||(u[1]=l=>o.value=Math.max(1,o.value-1)),disabled:!s.value},"-",8,tm),oe(e("input",{type:"number","onUpdate:modelValue":u[2]||(u[2]=l=>o.value=l),min:"1",max:"4",disabled:!s.value,class:"number-input"},null,8,om),[[Re,o.value,void 0,{number:!0}]]),e("button",{class:"btn btn-sm",onClick:u[3]||(u[3]=l=>o.value=Math.min(4,o.value+1)),disabled:!s.value},"+",8,nm)]),u[8]||(u[8]=e("div",{class:"input-hint"},"æ§åˆ¶æ£€æµ‹/OCR/é¢œè‰²/ä¿®å¤çš„æœ€å¤§å¹¶å‘æ•°ï¼ˆå»ºè®®1-2ï¼‰",-1))],2),s.value?(B(),A("div",sm,[...u[9]||(u[9]=[e("div",{class:"note-title"},"âš ï¸ æ³¨æ„äº‹é¡¹ï¼š",-1),e("ul",null,[e("li",null,"å¹¶å‘æ•°è®¾ä¸º1æ—¶ä¸ºä¸²è¡Œæ‰§è¡Œï¼Œæœ€ç¨³å®š"),e("li",null,"å¢å¤§å¹¶å‘æ•°å¯èƒ½åŠ é€Ÿå¤„ç†ï¼Œä½†ä¼šå ç”¨æ›´å¤šGPU/CPUèµ„æº"),e("li",null,"å¦‚æœé‡åˆ°æ˜¾å­˜ä¸è¶³ï¼Œè¯·å°†å¹¶å‘æ•°è®¾ä¸º1")],-1)])])):ce("",!0)])]))}}),lm=Je(am,[["__scopeId","data-v-4a6e42d5"]]),im={class:"more-settings"},rm={class:"settings-group"},um={class:"settings-item checkbox-item"},cm={class:"checkbox-label"},dm={class:"settings-group"},gm={class:"settings-item checkbox-item"},pm={class:"checkbox-label"},mm={class:"settings-group"},vm={class:"settings-item checkbox-item"},fm={class:"checkbox-label"},bm={class:"settings-group"},hm={class:"settings-item checkbox-item"},xm={class:"checkbox-label"},ym={class:"settings-group"},_m={class:"settings-item"},Cm={class:"settings-group"},Sm={class:"settings-item"},km=["disabled"],wm={key:0,class:"font-count"},$m={class:"settings-item"},Tm={class:"settings-group"},Im={class:"settings-row"},Pm={class:"settings-item"},Rm=["disabled"],Dm={class:"settings-item"},Mm=["disabled"],Bm=Ye({__name:"MoreSettings",setup(n){const t=[{label:"å‰ç«¯ pdf.js (æ¨è)",value:"frontend"},{label:"åç«¯ PyMuPDF",value:"backend"}],s=Fe(),o=ct(),a=w(!1),u=w([]),l=w(!1),c=w(null),g=w({pdfProcessingMethod:s.settings.pdfProcessingMethod||"frontend",autoSaveInBookshelfMode:s.settings.autoSaveInBookshelfMode||!1,removeTextWithOcr:s.settings.removeTextWithOcr||!1,enableVerboseLogs:s.settings.enableVerboseLogs||!1,lamaDisableResize:s.settings.lamaDisableResize||!1});Ce(()=>g.value.pdfProcessingMethod,R=>{s.setPdfProcessingMethod(R)}),Ce(()=>g.value.autoSaveInBookshelfMode,R=>{s.setAutoSaveInBookshelfMode(R)}),Ce(()=>g.value.removeTextWithOcr,R=>{s.setRemoveTextWithOcr(R)}),Ce(()=>g.value.enableVerboseLogs,R=>{s.setEnableVerboseLogs(R)}),Ce(()=>g.value.lamaDisableResize,R=>{s.setLamaDisableResize(R)});async function d(){a.value=!0;try{const R=await je.getFontList();u.value=R.fonts||[],o.success(`è·å–åˆ° ${u.value.length} ä¸ªå­—ä½“`)}catch(R){const _=R instanceof Error?R.message:"è·å–å­—ä½“åˆ—è¡¨å¤±è´¥";o.error(_)}finally{a.value=!1}}async function C(R){const D=R.target.files?.[0];if(!D)return;const j=[".ttf",".ttc",".otf"],z=D.name.toLowerCase().slice(D.name.lastIndexOf("."));if(!j.includes(z)){o.error("ä¸æ”¯æŒçš„å­—ä½“æ ¼å¼ï¼Œè¯·ä¸Šä¼  .ttf, .ttc æˆ– .otf æ–‡ä»¶");return}try{const L=await je.uploadFont(D);L.success?(o.success(`å­—ä½“ "${L.fontPath||D.name}" ä¸Šä¼ æˆåŠŸ`),await d()):o.error(L.error||"å­—ä½“ä¸Šä¼ å¤±è´¥")}catch(L){const b=L instanceof Error?L.message:"å­—ä½“ä¸Šä¼ å¤±è´¥";o.error(b)}finally{c.value&&(c.value.value="")}}async function $(){l.value=!0;try{const R=await kn();R.success?o.success(`å·²æ¸…ç† ${R.deleted_count||0} ä¸ªè°ƒè¯•æ–‡ä»¶`):o.error(R.error||"æ¸…ç†å¤±è´¥")}catch(R){const _=R instanceof Error?R.message:"æ¸…ç†å¤±è´¥";o.error(_)}finally{l.value=!1}}async function P(){l.value=!0;try{const R=await Co();R.success?o.success(`å·²æ¸…ç† ${R.deleted_count||0} ä¸ªä¸´æ—¶æ–‡ä»¶`):o.error(R.error||"æ¸…ç†å¤±è´¥")}catch(R){const _=R instanceof Error?R.message:"æ¸…ç†å¤±è´¥";o.error(_)}finally{l.value=!1}}return(R,_)=>(B(),A("div",im,[Se(lm),e("div",rm,[_[7]||(_[7]=e("div",{class:"settings-group-title"},"è‡ªåŠ¨ä¿å­˜è®¾ç½®",-1)),e("div",um,[e("label",cm,[oe(e("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=D=>g.value.autoSaveInBookshelfMode=D)},null,512),[[Xe,g.value.autoSaveInBookshelfMode]]),_[5]||(_[5]=e("span",{class:"checkbox-text"},"ä¹¦æ¶æ¨¡å¼è‡ªåŠ¨ä¿å­˜",-1))]),_[6]||(_[6]=e("div",{class:"input-hint"},[pe(" å¼€å¯åï¼Œåœ¨ä¹¦æ¶æ¨¡å¼ä¸‹ç¿»è¯‘æ—¶ä¼šè‡ªåŠ¨ä¿å­˜è¿›åº¦ï¼ˆç¿»è¯‘ä¸€å¼ ä¿å­˜ä¸€å¼ ï¼‰ï¼Œé˜²æ­¢æ„å¤–å…³é—­å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ "),e("br"),e("span",{class:"hint-note"},"æ³¨æ„ï¼šæ­¤åŠŸèƒ½ä»…åœ¨ä¹¦æ¶æ¨¡å¼ä¸‹ç”Ÿæ•ˆï¼Œå¿«é€Ÿç¿»è¯‘æ¨¡å¼ä¸æ”¯æŒã€‚")],-1))])]),e("div",dm,[_[10]||(_[10]=e("div",{class:"settings-group-title"},"æ¶ˆé™¤æ–‡å­—æ¨¡å¼",-1)),e("div",gm,[e("label",pm,[oe(e("input",{type:"checkbox","onUpdate:modelValue":_[1]||(_[1]=D=>g.value.removeTextWithOcr=D)},null,512),[[Xe,g.value.removeTextWithOcr]]),_[8]||(_[8]=e("span",{class:"checkbox-text"},"åŒæ—¶æ‰§è¡ŒOCRè¯†åˆ«",-1))]),_[9]||(_[9]=e("div",{class:"input-hint"},[pe(" å¼€å¯åï¼Œæ¶ˆé™¤æ–‡å­—æ¨¡å¼ä¼šåŒæ—¶æ‰§è¡ŒOCRè¯†åˆ«ï¼Œè·å–å¸¦æœ‰åŸæ–‡çš„å¹²å‡€èƒŒæ™¯å›¾ã€‚ "),e("br"),e("span",{class:"hint-note"},"é€‚ç”¨äºéœ€è¦ä¿ç•™åŸæ–‡ä¿¡æ¯ä»¥ä¾¿åç»­ç¿»è¯‘æˆ–å‚è€ƒçš„åœºæ™¯ã€‚")],-1))])]),e("div",mm,[_[13]||(_[13]=e("div",{class:"settings-group-title"},"LAMA ä¿®å¤è®¾ç½®",-1)),e("div",vm,[e("label",fm,[oe(e("input",{type:"checkbox","onUpdate:modelValue":_[2]||(_[2]=D=>g.value.lamaDisableResize=D)},null,512),[[Xe,g.value.lamaDisableResize]]),_[11]||(_[11]=e("span",{class:"checkbox-text"},"ç¦ç”¨è‡ªåŠ¨ç¼©æ”¾",-1))]),_[12]||(_[12]=e("div",{class:"input-hint"},[pe(" å¼€å¯åï¼ŒLAMA ä¿®å¤å°†ä½¿ç”¨åŸå›¾å°ºå¯¸è¿›è¡Œå¤„ç†ï¼ˆä¸ç¼©æ”¾åˆ°1024pxï¼‰ï¼Œå¯è·å¾—æ›´é«˜ç”»è´¨ã€‚ "),e("br"),e("span",{class:"hint-note"},"âš ï¸ éœ€è¦æ›´å¼ºçš„ GPU å’Œæ›´å¤šæ˜¾å­˜ï¼Œå¤„ç†é€Ÿåº¦ä¼šå˜æ…¢ã€‚æ¨è RTX 4060 æˆ–æ›´é«˜é…ç½®ä½¿ç”¨ã€‚"),e("br"),e("span",{class:"hint-note"},"é€‚ç”¨äºä¸¤ç§LAMAä¿®å¤æ–¹æ³•ï¼ˆé€Ÿåº¦ä¼˜åŒ–å’Œé€šç”¨ï¼‰ã€‚")],-1))])]),e("div",bm,[_[16]||(_[16]=e("div",{class:"settings-group-title"},"è°ƒè¯•é€‰é¡¹",-1)),e("div",hm,[e("label",xm,[oe(e("input",{type:"checkbox","onUpdate:modelValue":_[3]||(_[3]=D=>g.value.enableVerboseLogs=D)},null,512),[[Xe,g.value.enableVerboseLogs]]),_[14]||(_[14]=e("span",{class:"checkbox-text"},"è¯¦ç»†æ—¥å¿—",-1))]),_[15]||(_[15]=e("div",{class:"input-hint"},[pe(" å¼€å¯åï¼Œåç«¯ç»ˆç«¯ä¼šæ‰“å°è¯¦ç»†çš„è¯Šæ–­æ—¥å¿—ï¼ˆåŒ…æ‹¬å®Œæ•´çš„æ¶ˆæ¯ç»“æ„ã€æ¨¡å‹å“åº”ç­‰ï¼‰ï¼Œä¾¿äºè°ƒè¯•é—®é¢˜ã€‚ "),e("br"),e("span",{class:"hint-note"},"å½±å“æ‰€æœ‰ç¿»è¯‘æ¨¡å¼ï¼Œé»˜è®¤å…³é—­ä»¥ä¿æŒæ—¥å¿—ç®€æ´ã€‚")],-1))])]),e("div",ym,[_[19]||(_[19]=e("div",{class:"settings-group-title"},"PDFå¤„ç†è®¾ç½®",-1)),e("div",_m,[_[17]||(_[17]=e("label",{for:"settingsPdfProcessingMethod"},"PDFå¤„ç†æ–¹å¼:",-1)),Se(We,{modelValue:g.value.pdfProcessingMethod,"onUpdate:modelValue":_[4]||(_[4]=D=>g.value.pdfProcessingMethod=D),options:t},null,8,["modelValue"]),_[18]||(_[18]=e("div",{class:"input-hint"},"å‰ç«¯å¤„ç†é€Ÿåº¦æ›´å¿«ï¼Œåç«¯å¤„ç†å…¼å®¹æ€§æ›´å¥½",-1))])]),e("div",Cm,[_[23]||(_[23]=e("div",{class:"settings-group-title"},"å­—ä½“è®¾ç½®",-1)),e("div",Sm,[_[20]||(_[20]=e("label",null,"ç³»ç»Ÿå­—ä½“åˆ—è¡¨:",-1)),e("button",{class:"btn btn-secondary",onClick:d,disabled:a.value},te(a.value?"åŠ è½½ä¸­...":"ğŸ”„ åˆ·æ–°å­—ä½“åˆ—è¡¨"),9,km),u.value.length>0?(B(),A("div",wm,"å…± "+te(u.value.length)+" ä¸ªå­—ä½“",1)):ce("",!0)]),e("div",$m,[_[21]||(_[21]=e("label",null,"ä¸Šä¼ è‡ªå®šä¹‰å­—ä½“:",-1)),e("input",{type:"file",accept:".ttf,.ttc,.otf",onChange:C,ref_key:"fontInput",ref:c},null,544),_[22]||(_[22]=e("div",{class:"input-hint"},"æ”¯æŒ .ttf, .ttc, .otf æ ¼å¼",-1))])]),e("div",Tm,[_[26]||(_[26]=e("div",{class:"settings-group-title"},"ç¼“å­˜æ¸…ç†",-1)),e("div",Im,[e("div",Pm,[e("button",{class:"btn btn-secondary",onClick:$,disabled:l.value},te(l.value?"æ¸…ç†ä¸­...":"ğŸ—‘ï¸ æ¸…ç†è°ƒè¯•æ–‡ä»¶"),9,Rm),_[24]||(_[24]=e("div",{class:"input-hint"},"æ¸…ç†è°ƒè¯•è¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶",-1))]),e("div",Dm,[e("button",{class:"btn btn-secondary",onClick:P,disabled:l.value},te(l.value?"æ¸…ç†ä¸­...":"ğŸ—‘ï¸ æ¸…ç†ä¸´æ—¶æ–‡ä»¶"),9,Mm),_[25]||(_[25]=e("div",{class:"input-hint"},"æ¸…ç†ä¸‹è½½å’Œå¤„ç†è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶",-1))])])]),_[27]||(_[27]=fo('<div class="settings-group" data-v-06334835><div class="settings-group-title" data-v-06334835>å…³äº</div><div class="about-info" data-v-06334835><p data-v-06334835><strong data-v-06334835>Saber-Translator</strong></p><p data-v-06334835>AIé©±åŠ¨çš„æ¼«ç”»ç¿»è¯‘å·¥å…·</p><p class="links" data-v-06334835><a href="http://www.mashirosaber.top" target="_blank" data-v-06334835>ğŸ“– ä½¿ç”¨æ•™ç¨‹</a><a href="https://github.com/MashiroSaber/saber-translator" target="_blank" data-v-06334835>ğŸ™ GitHub</a></p><p class="disclaimer" data-v-06334835>æœ¬é¡¹ç›®å®Œå…¨å¼€æºå…è´¹ï¼Œè¯·å‹¿ä¸Šå½“å—éª—</p></div></div>',1))]))}}),Em=Je(Bm,[["__scopeId","data-v-06334835"]]),Am={class:"settings-modal-content"},Lm={class:"settings-tabs"},Fm=["onClick"],Um={class:"settings-tab-content"},Om={class:"settings-tab-pane active"},zm={class:"settings-tab-pane"},Nm={class:"settings-tab-pane"},Vm={class:"settings-tab-pane"},Wm={class:"settings-tab-pane"},Km={class:"settings-tab-pane"},qm={class:"settings-tab-pane"},Hm={class:"settings-tab-pane"},jm=Ye({__name:"SettingsModal",props:{modelValue:{type:Boolean},initialTab:{}},emits:["update:modelValue","save"],setup(n,{emit:t}){const s=n,o=t,a=Fe(),u=w(s.modelValue),l=w("ocr"),c=[{id:"ocr",label:"OCRè¯†åˆ«"},{id:"translate",label:"ç¿»è¯‘æœåŠ¡"},{id:"detection",label:"æ£€æµ‹è®¾ç½®"},{id:"hq",label:"é«˜è´¨é‡ç¿»è¯‘"},{id:"proofreading",label:"AIæ ¡å¯¹"},{id:"prompt-library",label:"æç¤ºè¯ç®¡ç†"},{id:"plugins",label:"æ’ä»¶ç®¡ç†"},{id:"more",label:"æ›´å¤š"}];Ce(()=>s.modelValue,$=>{u.value=$,$?(document.body.style.overflow="hidden",s.initialTab&&c.some(P=>P.id===s.initialTab)&&(l.value=s.initialTab)):(document.body.style.overflow="",l.value="ocr")});function g(){u.value=!1,o("update:modelValue",!1),document.body.style.overflow=""}async function d(){a.saveToStorage();try{await a.saveToBackend(),console.log("[SettingsModal] è®¾ç½®å·²ä¿å­˜åˆ°åç«¯")}catch($){console.warn("[SettingsModal] ä¿å­˜åˆ°åç«¯å¤±è´¥ï¼Œä»…ä¿å­˜åˆ° localStorage:",$)}o("save"),g()}function C($){$.key==="Escape"&&u.value&&g()}return dt(()=>{document.addEventListener("keydown",C)}),zt(()=>{document.removeEventListener("keydown",C),document.body.style.overflow=""}),($,P)=>u.value?(B(),A("div",{key:0,class:"settings-modal",onClick:st(g,["self"])},[e("div",Am,[e("div",{class:"settings-modal-header"},[P[0]||(P[0]=e("h3",null,"âš™ï¸ è®¾ç½®",-1)),e("span",{class:"settings-modal-close",onClick:g},"Ã—")]),e("div",Lm,[(B(),A(ze,null,Ge(c,R=>e("button",{key:R.id,class:De(["settings-tab",{active:l.value===R.id}]),onClick:_=>l.value=R.id},te(R.label),11,Fm)),64))]),e("div",Um,[oe(e("div",Om,[Se(Qu)],512),[[Oe,l.value==="ocr"]]),oe(e("div",zm,[Se(qc)],512),[[Oe,l.value==="translate"]]),oe(e("div",Nm,[Se(pd)],512),[[Oe,l.value==="detection"]]),oe(e("div",Vm,[Se(Zd)],512),[[Oe,l.value==="hq"]]),oe(e("div",Wm,[Se(Qg)],512),[[Oe,l.value==="proofreading"]]),oe(e("div",Km,[Se(yp)],512),[[Oe,l.value==="prompt-library"]]),oe(e("div",qm,[Se(Yp)],512),[[Oe,l.value==="plugins"]]),oe(e("div",Hm,[Se(Em)],512),[[Oe,l.value==="more"]])]),e("div",{class:"settings-modal-footer"},[e("button",{class:"btn btn-secondary",onClick:g},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:d},"ä¿å­˜è®¾ç½®")])])])):ce("",!0)}}),Jm=Je(jm,[["__scopeId","data-v-e1ec20ab"]]),Ym={minScale:.1,maxScale:5,zoomSpeed:.1};function bn(n={}){const t={...Ym,...n},s=w(1),o=w(0),a=w(0),u=w(!1),l=w(0),c=w(0),g=G(()=>({transform:`translate(${o.value}px, ${a.value}px) scale(${s.value})`}));function d(J,ae,U){const Q=Math.min(Math.max(s.value*U,t.minScale),t.maxScale),ie=Q/s.value;o.value=J-(J-o.value)*ie,a.value=ae-(ae-a.value)*ie,s.value=Q,n.onScaleChange?.(s.value),n.onTransformChange?.(k())}function C(J,ae=800,U=600){d(ae/2,U/2,J)}function $(){C(1.2)}function P(){C(.8)}function R(J,ae=800,U=600){const Q=J/s.value;d(ae/2,U/2,Q)}function _(J,ae){u.value=!0,l.value=J,c.value=ae}function D(J,ae){if(!u.value)return;const U=J-l.value,Q=ae-c.value;o.value+=U,a.value+=Q,l.value=J,c.value=ae,n.onTransformChange?.(k())}function j(){u.value=!1}function z(J,ae){o.value+=J,a.value+=ae,n.onTransformChange?.(k())}function L(){s.value=1,o.value=0,a.value=0,n.onScaleChange?.(s.value),n.onTransformChange?.(k())}function b(){L()}function p(){s.value=1,o.value=0,a.value=0}function T(J,ae,U,Q){if(!J||!ae)return;const ie=U/J,F=Q/ae;s.value=Math.min(ie,F)*.95,o.value=(U-J*s.value)/2,a.value=(Q-ae*s.value)/2,n.onScaleChange?.(s.value),n.onTransformChange?.(k())}function k(){return{scale:s.value,translateX:o.value,translateY:a.value}}function N(J){J.scale!==void 0&&(s.value=J.scale),J.translateX!==void 0&&(o.value=J.translateX),J.translateY!==void 0&&(a.value=J.translateY),n.onTransformChange?.(k())}function O(J){s.value=J.scale,o.value=J.translateX,a.value=J.translateY}function ee(J,ae,U){if(!J||J.length<4)return;const[Q,ie,F,h]=J,m=(Q+F)/2,i=(ie+h)/2,f=ae/2,v=U/2;o.value=f-m*s.value,a.value=v-i*s.value,n.onTransformChange?.(k())}return{scale:s,translateX:o,translateY:a,isDragging:u,transformStyle:g,zoomAt:d,zoom:C,zoomIn:$,zoomOut:P,setScale:R,startDrag:_,drag:D,endDrag:j,pan:z,reset:L,resetZoom:b,resetTransform:p,fitToScreen:T,getTransform:k,setTransform:N,syncWith:O,scrollToBubble:ee}}function Gm(n){const t=Qe(),s=Fe(),o=w(null),a=w(Is),u=w(!1),l=w(!1),c=w([]),g=w(0),d=w(0);let C=null,$=null,P=null;const R=G(()=>o.value!==null),_=G(()=>o.value==="repair"?{fill:"rgba(76, 175, 80, 0.4)",border:"#4CAF50"}:o.value==="restore"?{fill:"rgba(33, 150, 243, 0.4)",border:"#2196F3"}:{fill:"transparent",border:"transparent"});function D(i){o.value!==i&&(o.value=i,u.value=!0,c.value=[],console.log(`è¿›å…¥${i==="repair"?"ä¿®å¤":"è¿˜åŸ"}ç¬”åˆ·æ¨¡å¼ï¼Œç¬”åˆ·å¤§å°: ${a.value}px`))}function j(){l.value&&N();const i=o.value!==null;o.value=null,u.value=!1,l.value=!1,c.value=[],ae(),i&&console.log("é€€å‡ºç¬”åˆ·æ¨¡å¼")}function z(i){o.value===i?j():D(i)}function L(i){a.value=Math.max(en,Math.min(Qo,i))}function b(i){L(a.value+i)}function p(i){if(!R.value)return;i.preventDefault(),i.stopPropagation();const f=i.deltaY>0?-5:5;b(f)}function T(i,f){if(!R.value||i.button!==0)return;i.preventDefault(),i.stopPropagation(),l.value=!0,C=f,c.value=[];const v=O(i,f);v&&(c.value.push(v),J(f),U(v)),console.log("å¼€å§‹ç¬”åˆ·æ¶‚æŠ¹")}function k(i){if(g.value=i.clientX,d.value=i.clientY,!l.value||!R.value)return;const f=O(i,C);f&&(c.value.push(f),U(f))}function N(){if(!l.value)return;l.value=!1;const i=t.currentImage;if(!i||c.value.length===0){ae(),c.value=[];return}const f=ee();if(!f){ae(),c.value=[];return}const v=o.value;(async()=>{v==="restore"?await Q(i,f):v==="repair"&&await ie(i,f),n?.onBrushComplete?.()})(),ae(),c.value=[]}function O(i,f){if(!f)return null;const v=f.querySelector(".image-canvas-wrapper"),y=v?.querySelector("img");if(!y||!y.naturalWidth)return null;const I=v.getBoundingClientRect(),E=window.getComputedStyle(v).transform;let H=1;E&&E!=="none"&&(H=new DOMMatrix(E).a);const X=(i.clientX-I.left)/H,r=(i.clientY-I.top)/H,x=y.naturalWidth,ne=y.naturalHeight;return X<0||r<0||X>x||r>ne?null:{x:X,y:r,scale:H}}function ee(){if(c.value.length===0)return null;const f=c.value[0]?.scale||1,v=a.value/2/f;let y=1/0,I=1/0,E=-1/0,H=-1/0;for(const X of c.value)y=Math.min(y,X.x-v),I=Math.min(I,X.y-v),E=Math.max(E,X.x+v),H=Math.max(H,X.y+v);return{x1:Math.max(0,Math.floor(y)),y1:Math.max(0,Math.floor(I)),x2:Math.ceil(E),y2:Math.ceil(H),path:[...c.value],radius:v}}function J(i){ae();const f=i.querySelector(".image-canvas-wrapper"),v=f?.querySelector("img");if(!v)return;const y=document.createElement("canvas");y.id="brushOverlayCanvas",y.width=v.naturalWidth,y.height=v.naturalHeight,y.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100;",f.appendChild(y),$=y,P=y.getContext("2d")}function ae(){$&&$.parentNode&&$.parentNode.removeChild($),$=null,P=null}function U(i){if(!P||!i)return;const f=_.value.fill,v=a.value/2/(i.scale||1);P.beginPath(),P.arc(i.x,i.y,v,0,Math.PI*2),P.fillStyle=f,P.fill()}async function Q(i,f){if(!i.originalDataURL)return;let v;return i.cleanImageData?v="data:image/png;base64,"+i.cleanImageData:v=i.originalDataURL,new Promise(y=>{const I=new Image,E=new Image;let H=0;const X=()=>{if(H++,H<2)return;const r=document.createElement("canvas");r.width=I.naturalWidth,r.height=I.naturalHeight;const x=r.getContext("2d");if(!x){y();return}x.drawImage(I,0,0);const ne=document.createElement("canvas");ne.width=r.width,ne.height=r.height;const M=ne.getContext("2d");if(!M){y();return}M.fillStyle="white";for(const de of f.path)M.beginPath(),M.arc(de.x,de.y,f.radius,0,Math.PI*2),M.fill();x.globalCompositeOperation="destination-out",x.drawImage(ne,0,0),x.globalCompositeOperation="destination-over",x.drawImage(E,0,0),x.globalCompositeOperation="source-over";const Z=r.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:Z}),console.log("è¿˜åŸç¬”åˆ·åŒºåŸŸå®Œæˆ"),y()};I.onload=X,I.onerror=()=>y(),E.onload=X,E.onerror=()=>y(),I.src=v,E.src=i.originalDataURL})}async function ie(i,f){const v=n?.getCurrentRepairSettings?.()||{inpaintMethod:"solid",fillColor:"#FFFFFF"},y=v.inpaintMethod;y==="lama_mpe"||y==="litelama"?await F(i,f,y):await h(i,f,v.fillColor)}async function F(i,f,v="lama_mpe"){let y,I;if(i.cleanImageData)y=i.cleanImageData,I="data:image/png;base64,"+i.cleanImageData;else if(i.originalDataURL)y=i.originalDataURL.split(",")[1],I=i.originalDataURL;else{console.error("æ— æ³•è·å–åŸºç¡€å›¾åƒç”¨äº LAMA ä¿®å¤");return}return new Promise(E=>{const H=new Image;H.onload=async()=>{const X=H.naturalWidth,r=H.naturalHeight,x=document.createElement("canvas");x.width=X,x.height=r;const ne=x.getContext("2d");if(!ne){console.error("æ— æ³•åˆ›å»ºæ©è†œç”»å¸ƒä¸Šä¸‹æ–‡"),E();return}ne.fillStyle="black",ne.fillRect(0,0,X,r),ne.fillStyle="white";for(const ve of f.path)ne.beginPath(),ne.arc(ve.x,ve.y,f.radius,0,Math.PI*2),ne.fill();const Z=x.toDataURL("image/png").split(",")[1],de=[f.x1,f.y1,f.x2,f.y2],me=v==="litelama"?"litelama":"lama_mpe";try{_e("LAMA ä¿®å¤ä¸­...","info");const ve=await ko(y,de,{method:"lama",lamaModel:me,maskData:Z});if(ve.success&&ve.inpainted_image)t.updateCurrentImage({cleanImageData:ve.inpainted_image}),console.log("ä¿®å¤ç¬”åˆ·åŒºåŸŸå®Œæˆï¼ˆLAMA ä¿®å¤ï¼Œç²¾ç¡®æ©è†œï¼‰"),_e("LAMA ä¿®å¤å®Œæˆ","success");else throw new Error(ve.error||"LAMA ä¿®å¤è¿”å›æ— æ•ˆæ•°æ®")}catch(ve){console.error("LAMA ä¿®å¤å¤±è´¥ï¼Œå›é€€åˆ°çº¯è‰²å¡«å……:",ve),_e("LAMA ä¿®å¤å¤±è´¥ï¼Œä½¿ç”¨çº¯è‰²å¡«å……","warning");const $e=n?.getCurrentRepairSettings?.();await h(i,f,$e?.fillColor)}E()},H.onerror=()=>{console.error("åŠ è½½å›¾åƒå¤±è´¥ï¼Œæ— æ³•è¿›è¡Œ LAMA ä¿®å¤"),E()},H.src=I})}async function h(i,f,v){const y=v||s.settings.textStyle.fillColor||"#FFFFFF";let I;if(i.cleanImageData)I="data:image/png;base64,"+i.cleanImageData;else if(i.originalDataURL)I=i.originalDataURL;else return;return new Promise(E=>{const H=new Image;H.onload=()=>{const X=document.createElement("canvas");X.width=H.naturalWidth,X.height=H.naturalHeight;const r=X.getContext("2d");if(!r){E();return}r.drawImage(H,0,0),r.fillStyle=y;for(const ne of f.path)r.beginPath(),r.arc(ne.x,ne.y,f.radius,0,Math.PI*2),r.fill();const x=X.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:x}),console.log("ä¿®å¤ç¬”åˆ·åŒºåŸŸå®Œæˆï¼ˆçº¯è‰²å¡«å……ï¼‰"),E()},H.onerror=()=>E(),H.src=I})}async function m(){const i=t.currentImage;if(!i)return console.warn("ensureCleanBackground: æ²¡æœ‰å½“å‰å›¾ç‰‡"),!1;if(i.cleanImageData)return console.log("ensureCleanBackground: å·²æœ‰å¹²å‡€èƒŒæ™¯"),!0;const f=n?.getCurrentRepairSettings?.();if((f?.inpaintMethod||s.settings.textStyle.inpaintMethod)!=="solid")return console.log("ensureCleanBackground: éçº¯è‰²å¡«å……æ¨¡å¼ï¼Œè·³è¿‡"),!1;if(!i.bubbleStates||i.bubbleStates.length===0)return console.warn("ensureCleanBackground: æ²¡æœ‰æ°”æ³¡æ•°æ®"),!1;if(!i.translatedDataURL&&!i.originalDataURL)return console.warn("ensureCleanBackground: æ²¡æœ‰å›¾ç‰‡æ•°æ®"),!1;console.log("ensureCleanBackground: å°è¯•ä¸ºçº¯è‰²å¡«å……æ¨¡å¼åˆ›å»ºä¸´æ—¶å¹²å‡€èƒŒæ™¯");const y=i.translatedDataURL||i.originalDataURL,I=f?.fillColor||s.settings.textStyle.fillColor||"#FFFFFF";return new Promise(E=>{const H=new Image;H.onload=()=>{try{const X=document.createElement("canvas");X.width=H.naturalWidth,X.height=H.naturalHeight;const r=X.getContext("2d");if(!r){console.error("ensureCleanBackground: æ— æ³•è·å– Canvas ä¸Šä¸‹æ–‡"),E(!1);return}r.drawImage(H,0,0),r.fillStyle=I;for(const ne of i.bubbleStates){const[M,Z,de,me]=ne.coords;r.fillRect(M,Z,de-M+1,me-Z+1)}const x=X.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:x}),console.log("ensureCleanBackground: æˆåŠŸåˆ›å»ºä¸´æ—¶å¹²å‡€èƒŒæ™¯ï¼ˆçº¯è‰²å¡«å……ï¼‰"),E(!0)}catch(X){console.error("ensureCleanBackground: Canvas æ“ä½œå¤±è´¥:",X),E(!1)}},H.onerror=()=>{console.error("ensureCleanBackground: åŠ è½½å›¾åƒå¤±è´¥"),E(!1)},H.src=y})}return zt(()=>{j()}),{brushMode:o,brushSize:a,isBrushKeyDown:u,isBrushPainting:l,mouseX:g,mouseY:d,isActive:R,brushColor:_,BRUSH_MIN_SIZE:en,BRUSH_MAX_SIZE:Qo,enterBrushMode:D,exitBrushMode:j,toggleBrushMode:z,setBrushSize:L,adjustBrushSize:b,handleBrushWheel:p,startBrushPainting:T,continueBrushPainting:k,finishBrushPainting:N,getBrushPositionInImage:O,getBrushPathBounds:ee,ensureCleanBackground:m}}function Xm(n){return[Math.round(n[0]),Math.round(n[1]),Math.round(n[2]),Math.round(n[3])]}function Zm(n){const t=gt(),s=Qe(),o=Fe(),{bubbles:a,selectedIndex:u,hasSelection:l}=kt(t),{currentImage:c}=kt(s),g=w(!1),d=w(!1),C=w(null),$=w(0),P=w(0),R=w(!1);function _(r){t.selectBubble(r)}function D(r){t.toggleMultiSelect(r)}function j(){t.clearMultiSelect()}function z(r,x){console.log(`å¼€å§‹æ‹–åŠ¨æ°”æ³¡ #${r+1}`)}function L(r,x){}function b(r,x){t.updateBubble(r,{coords:x}),console.log(`æ°”æ³¡ #${r+1} æ‹–åŠ¨å®Œæˆ:`,x),v()}function p(r,x,ne){console.log(`å¼€å§‹è°ƒæ•´æ°”æ³¡ #${r+1} å¤§å°ï¼Œæ‰‹æŸ„: ${x}`)}function T(r){}function k(r,x){t.updateBubble(r,{coords:x}),console.log(`æ°”æ³¡ #${r+1} è°ƒæ•´å¤§å°å®Œæˆ:`,x),v()}function N(r,x){console.log(`å¼€å§‹æ—‹è½¬æ°”æ³¡ #${r+1}`)}function O(r){}function ee(r,x){t.updateBubble(r,{rotationAngle:x}),console.log(`æ°”æ³¡ #${r+1} æ—‹è½¬å®Œæˆ: ${x}Â°`),v()}function J(){g.value=!g.value,g.value?console.log("è¿›å…¥ç»˜åˆ¶æ¨¡å¼"):console.log("é€€å‡ºç»˜åˆ¶æ¨¡å¼")}function ae(r){t.addBubble(r),t.selectBubble(t.bubbleCount-1),console.log("å·²æ·»åŠ æ–°æ°”æ³¡:",r),n?.onReRender?.()}function U(r,x){d.value=!0,$.value=r,P.value=x,C.value=[r,x,r,x]}function Q(r,x){d.value&&(C.value=[$.value,P.value,r,x])}function ie(){if(!d.value||!C.value)return d.value=!1,C.value=null,null;const[r,x,ne,M]=C.value,Z=10;if(Math.abs(ne-r)<Z||Math.abs(M-x)<Z)return d.value=!1,C.value=null,null;const de=[Math.min(r,ne),Math.min(x,M),Math.max(r,ne),Math.max(x,M)];return d.value=!1,C.value=null,de}function F(){d.value=!1,C.value=null,g.value=!1}function h(){if(!C.value)return{};const[r,x,ne,M]=C.value;return{position:"absolute",left:`${Math.min(r,ne)}px`,top:`${Math.min(x,M)}px`,width:`${Math.abs(ne-r)}px`,height:`${Math.abs(M-x)}px`,border:"2px dashed #00d4ff",background:"rgba(0, 212, 255, 0.1)",pointerEvents:"none",zIndex:"25",boxSizing:"border-box"}}let m=null,i=!1;const f=150;function v(){m&&clearTimeout(m),m=setTimeout(async()=>{if(i){console.log("è·³è¿‡æ¸²æŸ“ï¼Œä¸Šä¸€æ¬¡æ¸²æŸ“ä»åœ¨è¿›è¡Œä¸­");return}console.log("è§¦å‘å»¶è¿Ÿæ¸²æŸ“é¢„è§ˆ"),i=!0;try{n?.onDelayedPreview?await n.onDelayedPreview():n?.onReRender&&await n.onReRender()}catch(r){console.error("å»¶è¿Ÿæ¸²æŸ“é¢„è§ˆå¤±è´¥:",r)}finally{i=!1}},f)}function y(r){t.updateSelectedBubble(r),v()}function I(){l.value&&(t.deleteSelected(),console.log("å·²åˆ é™¤é€‰ä¸­çš„æ°”æ³¡"),n?.onReRender?.())}async function E(){const r=u.value;if(r<0){console.warn("è¯·å…ˆé€‰ä¸­è¦ä¿®å¤çš„æ°”æ³¡æ¡†");return}const x=a.value[r],ne=c.value;if(!x||!ne?.originalDataURL){console.warn("æ— æ³•ä¿®å¤èƒŒæ™¯ï¼šç¼ºå°‘æ°”æ³¡æˆ–å›¾ç‰‡æ•°æ®");return}const M=x.inpaintMethod||"solid",Z=x.fillColor||"#FFFFFF",de=x.rotationAngle||0;try{console.log(`å¼€å§‹ä¿®å¤æ°”æ³¡ #${r+1} èƒŒæ™¯ï¼Œæ–¹æ³•: ${M}`);let me;if(ne.cleanImageData)me=ne.cleanImageData;else{const $e=ne.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/);if(me=$e&&$e[1]?$e[1]:"",!me){console.error("æ— æ³•è§£æå›¾åƒæ•°æ®");return}}if(M==="lama_mpe"||M==="litelama"){const $e=M==="litelama"?"litelama":"lama_mpe",Pe=Xm(x.coords),le=await ko(me,Pe,{bubbleAngle:de,method:"lama",lamaModel:$e});le.success&&le.inpainted_image?(s.updateCurrentImage({cleanImageData:le.inpainted_image}),console.log(`æ°”æ³¡ #${r+1} LAMAèƒŒæ™¯ä¿®å¤æˆåŠŸ`),v()):(console.error("LAMAä¿®å¤å¤±è´¥:",le.error||"æœªçŸ¥é”™è¯¯"),await H(x.coords,Z,de),v())}else await H(x.coords,Z,de),console.log(`æ°”æ³¡ #${r+1} çº¯è‰²å¡«å……ä¿®å¤æˆåŠŸ`),v()}catch(me){console.error("èƒŒæ™¯ä¿®å¤å‡ºé”™:",me);const ve=me instanceof Error?me.message:"èƒŒæ™¯ä¿®å¤å¤±è´¥";_e(ve,"error")}}async function H(r,x,ne=0){const M=c.value;if(!M)return;const[Z,de,me,ve]=r;let $e;if(M.cleanImageData)$e="data:image/png;base64,"+M.cleanImageData;else if(M.originalDataURL)$e=M.originalDataURL;else{console.error("æ— æ³•æ‰¾åˆ°åŸºç¡€å›¾åƒç”¨äºå¡«å……");return}return new Promise(Pe=>{const le=new Image;le.onload=()=>{const S=document.createElement("canvas");S.width=le.naturalWidth,S.height=le.naturalHeight;const Y=S.getContext("2d");if(!Y){Pe();return}if(Y.drawImage(le,0,0),Y.fillStyle=x,Math.abs(ne)<.1)Y.fillRect(Z,de,me-Z,ve-de);else{const fe=(Z+me)/2,ye=(de+ve)/2,V=(me-Z)/2,se=(ve-de)/2,he=ne*Math.PI/180,xe=Math.cos(he),Me=Math.sin(he),Ne=[[-V,-se],[V,-se],[V,se],[-V,se]].map(([ke,Be])=>[fe+ke*xe-Be*Me,ye+ke*Me+Be*xe]);Y.beginPath();const Ae=Ne[0];if(Ae){Y.moveTo(Ae[0],Ae[1]);for(let ke=1;ke<Ne.length;ke++){const Be=Ne[ke];Be&&Y.lineTo(Be[0],Be[1])}}Y.closePath(),Y.fill()}const be=S.toDataURL("image/png").split(",")[1];s.updateCurrentImage({cleanImageData:be}),console.log("å·²å¯¹æ°”æ³¡åŒºåŸŸè¿›è¡Œçº¯è‰²å¡«å……:",r,x,"è§’åº¦:",ne),Pe()},le.onerror=()=>{console.error("åŠ è½½åŸºç¡€å›¾åƒå¤±è´¥"),Pe()},le.src=$e})}async function X(r){const x=a.value[r],ne=c.value;if(!x||!ne?.originalDataURL){console.warn("æ— æ³•è¿›è¡Œ OCR è¯†åˆ«ï¼šç¼ºå°‘æ°”æ³¡æˆ–å›¾ç‰‡æ•°æ®");return}try{console.log(`å¼€å§‹ OCR è¯†åˆ«æ°”æ³¡ #${r+1}`);const M=ne.originalDataURL.split(",")[1]||"",Z=o.settings,de=Z.ocrEngine==="paddleocr_vl"?Z.paddleOcrVl?.sourceLanguage||"japanese":Z.sourceLanguage,me=await Tn(M,x.coords,Z.ocrEngine||"manga_ocr",{source_language:de,baidu_ocr_api_key:Z.baiduOcr.apiKey,baidu_ocr_secret_key:Z.baiduOcr.secretKey,baidu_version:Z.baiduOcr.version,baidu_source_language:Z.baiduOcr.sourceLanguage,ai_vision_provider:Z.aiVisionOcr.provider,ai_vision_api_key:Z.aiVisionOcr.apiKey,ai_vision_model_name:Z.aiVisionOcr.modelName,ai_vision_ocr_prompt:Z.aiVisionOcr.prompt,custom_ai_vision_base_url:Z.aiVisionOcr.customBaseUrl,ai_vision_min_image_size:Z.aiVisionOcr.minImageSize});if(me.success&&me.text!==void 0)t.updateBubble(r,{originalText:me.text}),console.log(`OCR è¯†åˆ«æˆåŠŸ: "${me.text}"`);else{const ve=me.error||"è¯†åˆ«å¤±è´¥";console.error("OCR è¯†åˆ«å¤±è´¥:",ve),_e(ve,"error")}}catch(M){console.error("OCR è¯†åˆ«å‡ºé”™:",M);const Z=M instanceof Error?M.message:"OCR è¯†åˆ«å‡ºé”™";_e(Z,"error")}}return{isDrawingMode:g,isDrawingBox:d,currentDrawingRect:C,isMiddleButtonDown:R,handleBubbleSelect:_,handleBubbleMultiSelect:D,handleClearMultiSelect:j,handleBubbleDragStart:z,handleBubbleDragging:L,handleBubbleDragEnd:b,handleBubbleResizeStart:p,handleBubbleResizing:T,handleBubbleResizeEnd:k,handleBubbleRotateStart:N,handleBubbleRotating:O,handleBubbleRotateEnd:ee,toggleDrawingMode:J,handleDrawBubble:ae,startDrawingBox:U,updateDrawingBox:Q,finishDrawingBox:ie,cancelDrawing:F,getDrawingRectStyle:h,handleBubbleUpdate:y,deleteSelectedBubbles:I,repairSelectedBubble:E,triggerDelayedPreview:v,handleOcrRecognize:X}}function Qm(n){const t=gt(),s=Qe(),{bubbles:o}=kt(t),{currentImage:a}=kt(s),u=w(!1),l=w("");let c=null;function g(){const $=a.value;if(!$)return null;if($.cleanImageData)return $.cleanImageData;if($.originalDataURL){const P=$.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/);if(P&&P[1])return P[1]}return null}async function d($=!1){if(!a.value)return console.warn("reRenderFullImage: æ²¡æœ‰å½“å‰å›¾ç‰‡"),!1;if(o.value.length===0){console.log("reRenderFullImage: æ²¡æœ‰æ°”æ³¡ï¼Œè·³è¿‡åç«¯æ¸²æŸ“");const D=g();if(D){const j=`data:image/png;base64,${D}`;s.updateCurrentImage({translatedDataURL:j}),$||n?.onRenderSuccess?.(j)}return!0}const R=g();if(!R)return console.error("reRenderFullImage: ç¼ºå°‘å›¾åƒæ•°æ®"),l.value="ç¼ºå°‘å›¾åƒæ•°æ®",$||n?.onRenderError?.("ç¼ºå°‘å›¾åƒæ•°æ®"),!1;const _=Symbol("render");c=_,u.value=!0,l.value="",$||n?.onRenderStart?.();try{console.log("reRenderFullImage: å¼€å§‹é‡æ–°æ¸²æŸ“ï¼Œæ°”æ³¡æ•°é‡:",o.value.length);const D=o.value,j=D.map(p=>p.translatedText||""),z=D.map(p=>p.coords.map(T=>Math.round(T))),L=D.map(p=>({translatedText:p.translatedText||"",coords:p.coords,fontSize:Number(p.fontSize)||24,fontFamily:p.fontFamily||xt,textDirection:Ft(p),textColor:p.textColor||"#231816",rotationAngle:Math.round(Number(p.rotationAngle)||0),position:p.position?{x:Math.round(p.position.x||0),y:Math.round(p.position.y||0)}:{x:0,y:0},strokeEnabled:p.strokeEnabled!==void 0?p.strokeEnabled:!0,strokeColor:p.strokeColor||"#FFFFFF",strokeWidth:Number(p.strokeWidth)||3})),b=await So({clean_image:R,bubble_texts:j,bubble_coords:z,bubble_states:L,fontSize:Number(D[0]?.fontSize)||24,fontFamily:D[0]?.fontFamily||xt,textDirection:D[0]?Ft(D[0]):"vertical",textColor:D[0]?.textColor||"#231816",strokeEnabled:D[0]?.strokeEnabled!==void 0?D[0].strokeEnabled:!0,strokeColor:D[0]?.strokeColor||"#FFFFFF",strokeWidth:Number(D[0]?.strokeWidth)||3,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,is_font_style_change:!0});if(c!==_)return console.log("reRenderFullImage: æ¸²æŸ“ç»“æœå·²è¿‡æœŸï¼Œå¿½ç•¥"),!1;if(b.rendered_image){const p=`data:image/png;base64,${b.rendered_image}`;return s.updateCurrentImage({translatedDataURL:p}),console.log("reRenderFullImage: æ¸²æŸ“æˆåŠŸ"),$||n?.onRenderSuccess?.(p),!0}else{const p=b.error||"æ¸²æŸ“å¤±è´¥";return console.error("reRenderFullImage: æ¸²æŸ“å¤±è´¥ -",p),l.value=p,$||n?.onRenderError?.(p),!1}}catch(D){if(c!==_)return!1;const j=D instanceof Error?D.message:"æ¸²æŸ“è¯·æ±‚å¤±è´¥";return console.error("reRenderFullImage: æ¸²æŸ“å‡ºé”™ -",D),l.value=j,$||n?.onRenderError?.(j),!1}finally{c===_&&(u.value=!1,$||n?.onRenderEnd?.())}}function C(){c=null,u.value=!1}return{isRendering:u,renderError:l,reRenderFullImage:d,cancelRender:C}}const ev=["data-index","data-coords","data-rotation","onClick","onMousedown"],tv={class:"bubble-index"},ov=["data-parent-index","onMousedown"],nv=["data-parent-index","onMousedown"],sv=["data-parent-index","onMousedown"],av=["data-parent-index","onMousedown"],lv=["data-parent-index","onMousedown"],iv=["data-parent-index","onMousedown"],rv=["data-parent-index","onMousedown"],uv=["data-parent-index","onMousedown"],cv=["data-parent-index","onMousedown"],dv=Ye({__name:"BubbleOverlay",props:{bubbles:{},selectedIndex:{},selectedIndices:{},scale:{},isDrawingMode:{type:Boolean},isBrushMode:{type:Boolean},imageWidth:{},imageHeight:{}},emits:["select","multiSelect","dragStart","dragging","dragEnd","resizeStart","resizing","resizeEnd","rotateStart","rotating","rotateEnd","drawBubble"],setup(n,{emit:t}){const s=gt(),{isDragging:o,draggingIndex:a,dragOffsetX:u,dragOffsetY:l,dragInitialX:c,dragInitialY:g,isResizing:d,resizingIndex:C,resizeCurrentCoords:$,isRotating:P,rotatingIndex:R,rotateCurrentAngle:_}=kt(s),D=n,j=t,z=w(null),L=w(0),b=w(0),p=w(""),T=w(0),k=w(0),N=w(null),O=w(0),ee=w(0),J=w(0),ae=w(0),U=w(!1),Q=w(0),ie=w(0),F=w(null),h=w(!1);function m(S,Y){let be,fe,ye,V,se=S.rotationAngle||0;if(o.value&&a.value===Y){const[Ne,Ae,ke,Be]=S.coords;be=c.value+u.value,fe=g.value+l.value,ye=be+(ke-Ne),V=fe+(Be-Ae)}else d.value&&C.value===Y&&$.value?[be,fe,ye,V]=$.value:P.value&&R.value===Y?([be,fe,ye,V]=S.coords,se=_.value):[be,fe,ye,V]=S.coords;const he=ye-be,xe=V-fe,Me={left:`${be}px`,top:`${fe}px`,width:`${he}px`,height:`${xe}px`};return se&&(Me.transformOrigin="center center",Me.transform=`rotate(${se}deg)`),Me}function i(){if(!F.value)return{};const[S,Y,be,fe]=F.value;return{left:`${Math.min(S,be)}px`,top:`${Math.min(Y,fe)}px`,width:`${Math.abs(be-S)}px`,height:`${Math.abs(fe-Y)}px`}}function f(S){if(!z.value)return null;const Y=z.value.getBoundingClientRect(),be=D.scale||1,fe=(S.clientX-Y.left)/be,ye=(S.clientY-Y.top)/be;return{x:fe,y:ye}}function v(S,Y){D.isBrushMode||Y.shiftKey||j("select",S)}function y(S){if(!D.isBrushMode){if(S.button===1){S.preventDefault(),h.value=!0,document.body.classList.add("middle-button-drawing"),me(S);return}S.button===0&&D.isDrawingMode&&me(S)}}function I(S,Y){if(!D.isBrushMode&&Y.button===0){if(Y.preventDefault(),Y.stopPropagation(),Y.shiftKey){j("multiSelect",S);return}if(S!==D.selectedIndex){j("select",S);return}E(S,Y)}}function E(S,Y){document.removeEventListener("mousemove",Pe),document.removeEventListener("mouseup",le),o.value=!0,a.value=S,L.value=Y.clientX,b.value=Y.clientY,u.value=0,l.value=0;const be=D.bubbles[S];be&&(c.value=be.coords[0],g.value=be.coords[1]),j("dragStart",S,Y),document.addEventListener("mousemove",Pe),document.addEventListener("mouseup",le)}function H(S){const Y=D.scale||1,be=(S.clientX-L.value)/Y,fe=(S.clientY-b.value)/Y;u.value=be,l.value=fe}function X(S){const Y=a.value;o.value=!1,a.value=-1,u.value=0,l.value=0;const be=D.scale||1,fe=(S.clientX-L.value)/be,ye=(S.clientY-b.value)/be,V=D.bubbles[Y];if(!V)return;const[se,he,xe,Me]=V.coords,Ne=xe-se,Ae=Me-he;let ke=Math.round(c.value+fe),Be=Math.round(g.value+ye);const Ie=D.imageWidth||2e3,et=D.imageHeight||2e3,qe=Math.min(Ne,Ie),at=Math.min(Ae,et);ke=Math.max(0,Math.min(ke,Ie-qe)),Be=Math.max(0,Math.min(Be,et-at));const Te=[ke,Be,ke+qe,Be+at];j("dragEnd",Y,Te)}function r(S,Y,be){if(D.isBrushMode||be.button!==0)return;be.preventDefault(),be.stopPropagation(),document.removeEventListener("mousemove",Pe),document.removeEventListener("mouseup",le),d.value=!0,C.value=Y,p.value=S,T.value=be.clientX,k.value=be.clientY;const fe=D.bubbles[Y];fe&&(N.value=[...fe.coords],$.value=[...fe.coords]),j("resizeStart",Y,S,be),document.addEventListener("mousemove",Pe),document.addEventListener("mouseup",le)}function x(S){if(!N.value)return;const Y=D.scale||1,be=(S.clientX-T.value)/Y,fe=(S.clientY-k.value)/Y;let[ye,V,se,he]=N.value;const xe=p.value;xe.includes("w")&&(ye+=be),xe.includes("e")&&(se+=be),xe.includes("n")&&(V+=fe),xe.includes("s")&&(he+=fe),ye>se&&([ye,se]=[se,ye]),V>he&&([V,he]=[he,V]);const Me=10;se-ye<Me||he-V<Me||($.value=[ye,V,se,he])}function ne(S){if(!N.value)return;const Y=D.scale||1,be=(S.clientX-T.value)/Y,fe=(S.clientY-k.value)/Y;let[ye,V,se,he]=N.value;const xe=p.value;xe.includes("w")&&(ye+=be),xe.includes("e")&&(se+=be),xe.includes("n")&&(V+=fe),xe.includes("s")&&(he+=fe),ye>se&&([ye,se]=[se,ye]),V>he&&([V,he]=[he,V]);const Me=D.imageWidth||2e3,Ne=D.imageHeight||2e3;ye=Math.max(0,Math.round(ye)),V=Math.max(0,Math.round(V)),se=Math.min(Me,Math.round(se)),he=Math.min(Ne,Math.round(he));const Ae=10;if(se-ye<Ae||he-V<Ae){console.warn("è°ƒæ•´åå°ºå¯¸è¿‡å°ï¼Œå·²æ’¤é”€"),d.value=!1,C.value=-1,N.value=null;return}j("resizeEnd",C.value,[ye,V,se,he]),d.value=!1,C.value=-1,N.value=null,$.value=null}function M(S,Y){if(D.isBrushMode||Y.button!==0)return;Y.preventDefault(),Y.stopPropagation(),document.removeEventListener("mousemove",Pe),document.removeEventListener("mouseup",le),P.value=!0,R.value=S;const be=D.bubbles[S];if(!be||!z.value)return;const[fe,ye,V,se]=be.coords,he=D.scale||1,xe=z.value.getBoundingClientRect();J.value=xe.left+(fe+V)/2*he,ae.value=xe.top+(ye+se)/2*he;const Me=Y.clientX-J.value,Ne=Y.clientY-ae.value;O.value=Math.atan2(Ne,Me)*180/Math.PI,ee.value=be.rotationAngle||0,_.value=be.rotationAngle||0,j("rotateStart",S,Y),document.body.classList.add("rotating-box"),document.addEventListener("mousemove",Pe),document.addEventListener("mouseup",le),console.log(`å¼€å§‹æ—‹è½¬æ°”æ³¡ #${S+1}ï¼Œåˆå§‹è§’åº¦: ${ee.value}Â°`)}function Z(S){const Y=S.clientX-J.value,be=S.clientY-ae.value,ye=Math.atan2(be,Y)*180/Math.PI-O.value;let V=ee.value+ye;for(;V>180;)V-=360;for(;V<-180;)V+=360;S.shiftKey&&(V=Math.round(V/15)*15),_.value=V}function de(S){document.body.classList.remove("rotating-box");const Y=R.value,be=_.value;j("rotateEnd",Y,be),P.value=!1,R.value=-1,console.log(`æ°”æ³¡ #${Y+1} æ—‹è½¬å®Œæˆï¼Œè§’åº¦: ${be}Â°`)}function me(S){const Y=f(S);if(!Y)return;const be=D.imageWidth||2e3,fe=D.imageHeight||2e3;Y.x<0||Y.x>be||Y.y<0||Y.y>fe||(U.value=!0,Q.value=Y.x,ie.value=Y.y,F.value=[Y.x,Y.y,Y.x,Y.y],document.addEventListener("mousemove",Pe),document.addEventListener("mouseup",le),console.log("å¼€å§‹ç»˜åˆ¶æ–°æ¡†:",Y.x.toFixed(1),Y.y.toFixed(1)))}function ve(S){const Y=f(S);!Y||!F.value||(F.value=[Q.value,ie.value,Y.x,Y.y])}function $e(S){const Y=f(S);if(h.value&&(h.value=!1,document.body.classList.remove("middle-button-drawing")),!Y||!F.value){U.value=!1,F.value=null;return}const be=D.imageWidth||2e3,fe=D.imageHeight||2e3,ye=Math.max(0,Math.round(Math.min(Q.value,Y.x))),V=Math.max(0,Math.round(Math.min(ie.value,Y.y))),se=Math.min(be,Math.round(Math.max(Q.value,Y.x))),he=Math.min(fe,Math.round(Math.max(ie.value,Y.y))),xe=10;if(se-ye<xe||he-V<xe){console.log("ç»˜åˆ¶çš„æ¡†å¤ªå°ï¼Œå·²å¿½ç•¥"),U.value=!1,F.value=null;return}console.log("å®Œæˆç»˜åˆ¶æ–°æ¡†:",[ye,V,se,he]),j("drawBubble",[ye,V,se,he]),U.value=!1,F.value=null}function Pe(S){o.value?H(S):d.value?x(S):P.value?Z(S):U.value&&ve(S)}function le(S){document.removeEventListener("mousemove",Pe),document.removeEventListener("mouseup",le),(S.button===1||h.value)&&(h.value=!1,document.body.classList.remove("middle-button-drawing")),o.value?X(S):d.value?ne(S):P.value?de():U.value&&$e(S)}return dt(()=>{}),zt(()=>{document.removeEventListener("mousemove",Pe),document.removeEventListener("mouseup",le),document.body.classList.remove("middle-button-drawing"),document.body.classList.remove("rotating-box")}),(S,Y)=>(B(),A("div",{class:De(["bubble-overlay",{"brush-mode":n.isBrushMode}]),style:nt({"--scale":n.scale||1}),ref_key:"overlayRef",ref:z,onMousedown:y},[(B(!0),A(ze,null,Ge(n.bubbles,(be,fe)=>(B(),A("div",{key:fe,class:De(["bubble-highlight-box",{selected:fe===n.selectedIndex,"multi-selected":n.selectedIndices.length>1&&n.selectedIndices.includes(fe)&&fe!==n.selectedIndex}]),style:nt(m(be,fe)),"data-index":fe,"data-coords":JSON.stringify(be.coords),"data-rotation":be.rotationAngle||0,onClick:st(ye=>v(fe,ye),["stop"]),onMousedown:st(ye=>I(fe,ye),["stop"])},[e("span",tv,te(fe+1),1),fe===n.selectedIndex?(B(),A(ze,{key:0},[e("div",{class:"resize-handle nw","data-handle":"nw","data-parent-index":fe,onMousedown:st(ye=>r("nw",fe,ye),["stop"])},null,40,ov),e("div",{class:"resize-handle n","data-handle":"n","data-parent-index":fe,onMousedown:st(ye=>r("n",fe,ye),["stop"])},null,40,nv),e("div",{class:"resize-handle ne","data-handle":"ne","data-parent-index":fe,onMousedown:st(ye=>r("ne",fe,ye),["stop"])},null,40,sv),e("div",{class:"resize-handle e","data-handle":"e","data-parent-index":fe,onMousedown:st(ye=>r("e",fe,ye),["stop"])},null,40,av),e("div",{class:"resize-handle se","data-handle":"se","data-parent-index":fe,onMousedown:st(ye=>r("se",fe,ye),["stop"])},null,40,lv),e("div",{class:"resize-handle s","data-handle":"s","data-parent-index":fe,onMousedown:st(ye=>r("s",fe,ye),["stop"])},null,40,iv),e("div",{class:"resize-handle sw","data-handle":"sw","data-parent-index":fe,onMousedown:st(ye=>r("sw",fe,ye),["stop"])},null,40,rv),e("div",{class:"resize-handle w","data-handle":"w","data-parent-index":fe,onMousedown:st(ye=>r("w",fe,ye),["stop"])},null,40,uv),Y[0]||(Y[0]=e("div",{class:"rotate-line"},null,-1)),e("div",{class:"rotate-handle",title:"æ‹–æ‹½æ—‹è½¬","data-parent-index":fe,onMousedown:st(ye=>M(fe,ye),["stop"])},null,40,cv)],64)):ce("",!0)],46,ev))),128)),F.value?(B(),A("div",{key:0,class:"drawing-rect",style:nt(i())},null,4)):ce("",!0)],38))}}),hn=Je(dv,[["__scopeId","data-v-8d9cb1b9"]]),gv={key:0,class:"kana-keyboard"},pv={class:"kana-keyboard-header"},mv={class:"kana-keyboard-tabs"},vv=["onClick"],fv={class:"kana-keyboard-options"},bv={class:"kana-mode-select"},hv={class:"kana-target-select"},xv={class:"kana-table"},yv={class:"row-label"},_v=["onClick"],Cv={class:"kana-hiragana"},Sv={class:"kana-katakana"},kv={class:"kana-table"},wv={class:"row-label"},$v=["onClick"],Tv={class:"kana-hiragana"},Iv={class:"kana-katakana"},Pv={class:"kana-table combo-table"},Rv={class:"row-label"},Dv=["onClick"],Mv={class:"kana-hiragana"},Bv={class:"kana-katakana"},Ev={class:"special-chars-grid"},Av=["onClick"],Lv={key:0,class:"char-label"},Fv=Ye({__name:"JapaneseKeyboard",props:{visible:{type:Boolean,default:!1},defaultTarget:{default:"original"}},emits:["close","insert","delete"],setup(n,{emit:t}){const s=n,o=t,a=w("basic"),u=w("hiragana"),l=w(s.defaultTarget),c=w(null),g=[{label:"åŸæ–‡",value:"original"},{label:"è¯‘æ–‡",value:"translated"}],d=[{id:"basic",label:"åŸºæœ¬"},{id:"dakuten",label:"æµŠ/åŠæµŠéŸ³"},{id:"combo",label:"æ‹—éŸ³"},{id:"special",label:"ç‰¹æ®Š"}],C=[{label:"ã‚è¡Œ",chars:[{h:"ã‚",k:"ã‚¢"},{h:"ã„",k:"ã‚¤"},{h:"ã†",k:"ã‚¦"},{h:"ãˆ",k:"ã‚¨"},{h:"ãŠ",k:"ã‚ª"}]},{label:"ã‹è¡Œ",chars:[{h:"ã‹",k:"ã‚«"},{h:"ã",k:"ã‚­"},{h:"ã",k:"ã‚¯"},{h:"ã‘",k:"ã‚±"},{h:"ã“",k:"ã‚³"}]},{label:"ã•è¡Œ",chars:[{h:"ã•",k:"ã‚µ"},{h:"ã—",k:"ã‚·"},{h:"ã™",k:"ã‚¹"},{h:"ã›",k:"ã‚»"},{h:"ã",k:"ã‚½"}]},{label:"ãŸè¡Œ",chars:[{h:"ãŸ",k:"ã‚¿"},{h:"ã¡",k:"ãƒ"},{h:"ã¤",k:"ãƒ„"},{h:"ã¦",k:"ãƒ†"},{h:"ã¨",k:"ãƒˆ"}]},{label:"ãªè¡Œ",chars:[{h:"ãª",k:"ãƒŠ"},{h:"ã«",k:"ãƒ‹"},{h:"ã¬",k:"ãƒŒ"},{h:"ã­",k:"ãƒ"},{h:"ã®",k:"ãƒ"}]},{label:"ã¯è¡Œ",chars:[{h:"ã¯",k:"ãƒ"},{h:"ã²",k:"ãƒ’"},{h:"ãµ",k:"ãƒ•"},{h:"ã¸",k:"ãƒ˜"},{h:"ã»",k:"ãƒ›"}]},{label:"ã¾è¡Œ",chars:[{h:"ã¾",k:"ãƒ"},{h:"ã¿",k:"ãƒŸ"},{h:"ã‚€",k:"ãƒ "},{h:"ã‚",k:"ãƒ¡"},{h:"ã‚‚",k:"ãƒ¢"}]},{label:"ã‚„è¡Œ",chars:[{h:"ã‚„",k:"ãƒ¤"},null,{h:"ã‚†",k:"ãƒ¦"},null,{h:"ã‚ˆ",k:"ãƒ¨"}]},{label:"ã‚‰è¡Œ",chars:[{h:"ã‚‰",k:"ãƒ©"},{h:"ã‚Š",k:"ãƒª"},{h:"ã‚‹",k:"ãƒ«"},{h:"ã‚Œ",k:"ãƒ¬"},{h:"ã‚",k:"ãƒ­"}]},{label:"ã‚è¡Œ",chars:[{h:"ã‚",k:"ãƒ¯"},null,null,null,{h:"ã‚’",k:"ãƒ²"}]},{label:"ã‚“",chars:[{h:"ã‚“",k:"ãƒ³"},null,null,null,null]}],$=[{label:"ãŒè¡Œ",chars:[{h:"ãŒ",k:"ã‚¬"},{h:"ã",k:"ã‚®"},{h:"ã",k:"ã‚°"},{h:"ã’",k:"ã‚²"},{h:"ã”",k:"ã‚´"}]},{label:"ã–è¡Œ",chars:[{h:"ã–",k:"ã‚¶"},{h:"ã˜",k:"ã‚¸"},{h:"ãš",k:"ã‚º"},{h:"ãœ",k:"ã‚¼"},{h:"ã",k:"ã‚¾"}]},{label:"ã è¡Œ",chars:[{h:"ã ",k:"ãƒ€"},{h:"ã¢",k:"ãƒ‚"},{h:"ã¥",k:"ãƒ…"},{h:"ã§",k:"ãƒ‡"},{h:"ã©",k:"ãƒ‰"}]},{label:"ã°è¡Œ",chars:[{h:"ã°",k:"ãƒ"},{h:"ã³",k:"ãƒ“"},{h:"ã¶",k:"ãƒ–"},{h:"ã¹",k:"ãƒ™"},{h:"ã¼",k:"ãƒœ"}]},{label:"ã±è¡Œ",chars:[{h:"ã±",k:"ãƒ‘"},{h:"ã´",k:"ãƒ”"},{h:"ã·",k:"ãƒ—"},{h:"ãº",k:"ãƒš"},{h:"ã½",k:"ãƒ"}]}],P=[{label:"ãã‚ƒè¡Œ",chars:[{h:"ãã‚ƒ",k:"ã‚­ãƒ£"},{h:"ãã‚…",k:"ã‚­ãƒ¥"},{h:"ãã‚‡",k:"ã‚­ãƒ§"}]},{label:"ã—ã‚ƒè¡Œ",chars:[{h:"ã—ã‚ƒ",k:"ã‚·ãƒ£"},{h:"ã—ã‚…",k:"ã‚·ãƒ¥"},{h:"ã—ã‚‡",k:"ã‚·ãƒ§"}]},{label:"ã¡ã‚ƒè¡Œ",chars:[{h:"ã¡ã‚ƒ",k:"ãƒãƒ£"},{h:"ã¡ã‚…",k:"ãƒãƒ¥"},{h:"ã¡ã‚‡",k:"ãƒãƒ§"}]},{label:"ã«ã‚ƒè¡Œ",chars:[{h:"ã«ã‚ƒ",k:"ãƒ‹ãƒ£"},{h:"ã«ã‚…",k:"ãƒ‹ãƒ¥"},{h:"ã«ã‚‡",k:"ãƒ‹ãƒ§"}]},{label:"ã²ã‚ƒè¡Œ",chars:[{h:"ã²ã‚ƒ",k:"ãƒ’ãƒ£"},{h:"ã²ã‚…",k:"ãƒ’ãƒ¥"},{h:"ã²ã‚‡",k:"ãƒ’ãƒ§"}]},{label:"ã¿ã‚ƒè¡Œ",chars:[{h:"ã¿ã‚ƒ",k:"ãƒŸãƒ£"},{h:"ã¿ã‚…",k:"ãƒŸãƒ¥"},{h:"ã¿ã‚‡",k:"ãƒŸãƒ§"}]},{label:"ã‚Šã‚ƒè¡Œ",chars:[{h:"ã‚Šã‚ƒ",k:"ãƒªãƒ£"},{h:"ã‚Šã‚…",k:"ãƒªãƒ¥"},{h:"ã‚Šã‚‡",k:"ãƒªãƒ§"}]},{label:"ãã‚ƒè¡Œ",chars:[{h:"ãã‚ƒ",k:"ã‚®ãƒ£"},{h:"ãã‚…",k:"ã‚®ãƒ¥"},{h:"ãã‚‡",k:"ã‚®ãƒ§"}]},{label:"ã˜ã‚ƒè¡Œ",chars:[{h:"ã˜ã‚ƒ",k:"ã‚¸ãƒ£"},{h:"ã˜ã‚…",k:"ã‚¸ãƒ¥"},{h:"ã˜ã‚‡",k:"ã‚¸ãƒ§"}]},{label:"ã³ã‚ƒè¡Œ",chars:[{h:"ã³ã‚ƒ",k:"ãƒ“ãƒ£"},{h:"ã³ã‚…",k:"ãƒ“ãƒ¥"},{h:"ã³ã‚‡",k:"ãƒ“ãƒ§"}]},{label:"ã´ã‚ƒè¡Œ",chars:[{h:"ã´ã‚ƒ",k:"ãƒ”ãƒ£"},{h:"ã´ã‚…",k:"ãƒ”ãƒ¥"},{h:"ã´ã‚‡",k:"ãƒ”ãƒ§"}]}],R=[{char:"ã£",label:"ä¿ƒéŸ³"},{char:"ãƒƒ",label:"ä¿ƒéŸ³"},{char:"ãƒ¼",label:"é•¿éŸ³"},{char:"ã€œ",label:"æ³¢æµª"},{char:"ã€‚",label:"å¥å·"},{char:"ã€",label:"é¡¿å·"},{char:"ã€Œ",label:"å¼•å·"},{char:"ã€",label:"å¼•å·"},{char:"ã€",label:"åŒå¼•"},{char:"ã€",label:"åŒå¼•"},{char:"â€¦",label:"çœç•¥"},{char:"ãƒ»",label:"ä¸­ç‚¹"},{char:"ï¼",label:"æ„Ÿå¹"},{char:"ï¼Ÿ",label:"é—®å·"},{char:"â™ª",label:"éŸ³ç¬¦"},{char:"â™¡",label:"å¿ƒå½¢"},{char:"â˜…",label:"æ˜Ÿå½¢"},{char:"â˜†",label:"ç©ºæ˜Ÿ"},{char:"ã",label:"å°ã‚"},{char:"ãƒ",label:"å°ã„"},{char:"ã…",label:"å°ã†"},{char:"ã‡",label:"å°ãˆ"},{char:"ã‰",label:"å°ãŠ"},{char:"ã‚¡",label:"å°ã‚¢"},{char:"ã‚£",label:"å°ã‚¤"},{char:"ã‚¥",label:"å°ã‚¦"},{char:"ã‚§",label:"å°ã‚¨"},{char:"ã‚©",label:"å°ã‚ª"},{char:"ã‚ƒ",label:"å°ã‚„"},{char:"ã‚…",label:"å°ã‚†"},{char:"ã‚‡",label:"å°ã‚ˆ"},{char:"ãƒ£",label:"å°ãƒ¤"},{char:"ãƒ¥",label:"å°ãƒ¦"},{char:"ãƒ§",label:"å°ãƒ¨"}];function _(){o("close")}function D(L){const b=u.value==="hiragana"?L.h:L.k;c.value=L.h,setTimeout(()=>{c.value=null},100),o("insert",b,l.value)}function j(L){c.value=L,setTimeout(()=>{c.value=null},100),o("insert",L,l.value)}function z(){o("delete",l.value)}return(L,b)=>n.visible?(B(),A("div",gv,[e("div",pv,[b[3]||(b[3]=e("span",{class:"kana-keyboard-title"},"50éŸ³é”®ç›˜",-1)),e("div",mv,[(B(),A(ze,null,Ge(d,p=>e("button",{key:p.id,class:De(["kana-tab",{active:a.value===p.id}]),onClick:T=>a.value=p.id},te(p.label),11,vv)),64))]),e("button",{class:"kana-keyboard-close",onClick:_},"âœ•")]),e("div",fv,[e("div",bv,[e("label",null,[oe(e("input",{type:"radio",name:"kanaMode",value:"hiragana","onUpdate:modelValue":b[0]||(b[0]=p=>u.value=p)},null,512),[[an,u.value]]),b[4]||(b[4]=pe(" å¹³å‡å ",-1))]),e("label",null,[oe(e("input",{type:"radio",name:"kanaMode",value:"katakana","onUpdate:modelValue":b[1]||(b[1]=p=>u.value=p)},null,512),[[an,u.value]]),b[5]||(b[5]=pe(" ç‰‡å‡å ",-1))])]),e("div",hv,[b[6]||(b[6]=e("label",null,"è¾“å…¥åˆ°ï¼š",-1)),Se(We,{modelValue:l.value,"onUpdate:modelValue":b[2]||(b[2]=p=>l.value=p),options:g},null,8,["modelValue"])])]),e("div",{class:De(["kana-tab-content",{active:a.value==="basic"}])},[e("table",xv,[b[7]||(b[7]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚æ®µ"),e("th",null,"ã„æ®µ"),e("th",null,"ã†æ®µ"),e("th",null,"ãˆæ®µ"),e("th",null,"ãŠæ®µ")])],-1)),e("tbody",null,[(B(),A(ze,null,Ge(C,p=>e("tr",{key:p.label},[e("td",yv,te(p.label),1),(B(!0),A(ze,null,Ge(p.chars,(T,k)=>(B(),A("td",{key:k},[T?(B(),A("button",{key:0,class:De(["kana-key",{pressed:c.value===T.h}]),onClick:N=>D(T)},[e("span",Cv,te(T.h),1),e("span",Sv,te(T.k),1)],10,_v)):ce("",!0)]))),128))])),64))])])],2),e("div",{class:De(["kana-tab-content",{active:a.value==="dakuten"}])},[e("table",kv,[b[8]||(b[8]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚æ®µ"),e("th",null,"ã„æ®µ"),e("th",null,"ã†æ®µ"),e("th",null,"ãˆæ®µ"),e("th",null,"ãŠæ®µ")])],-1)),e("tbody",null,[(B(),A(ze,null,Ge($,p=>e("tr",{key:p.label},[e("td",wv,te(p.label),1),(B(!0),A(ze,null,Ge(p.chars,(T,k)=>(B(),A("td",{key:k},[T?(B(),A("button",{key:0,class:De(["kana-key",{pressed:c.value===T.h}]),onClick:N=>D(T)},[e("span",Tv,te(T.h),1),e("span",Iv,te(T.k),1)],10,$v)):ce("",!0)]))),128))])),64))])])],2),e("div",{class:De(["kana-tab-content",{active:a.value==="combo"}])},[e("table",Pv,[b[9]||(b[9]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚ƒ"),e("th",null,"ã‚…"),e("th",null,"ã‚‡")])],-1)),e("tbody",null,[(B(),A(ze,null,Ge(P,p=>e("tr",{key:p.label},[e("td",Rv,te(p.label),1),(B(!0),A(ze,null,Ge(p.chars,(T,k)=>(B(),A("td",{key:k},[T?(B(),A("button",{key:0,class:De(["kana-key",{pressed:c.value===T.h}]),onClick:N=>D(T)},[e("span",Mv,te(T.h),1),e("span",Bv,te(T.k),1)],10,Dv)):ce("",!0)]))),128))])),64))])])],2),e("div",{class:De(["kana-tab-content",{active:a.value==="special"}])},[e("div",Ev,[(B(),A(ze,null,Ge(R,p=>e("button",{key:p.char,class:De(["kana-key special-key",{pressed:c.value===p.char}]),onClick:T=>j(p.char)},[pe(te(p.char)+" ",1),p.label?(B(),A("span",Lv,te(p.label),1)):ce("",!0)],10,Av)),64))])],2),e("div",{class:"kana-keyboard-footer"},[e("button",{class:"kana-backspace",onClick:z},"âŒ« é€€æ ¼")])])):ce("",!0)}}),Uv=Je(Fv,[["__scopeId","data-v-ebfc2125"]]),Ov={class:"edit-panel-content"},zv={class:"text-column original-text-column text-block"},Nv={class:"text-column-header"},Vv=["disabled"],Wv={class:"text-column translated-text-column text-block"},Kv={class:"text-column-header"},qv=["disabled"],Hv={class:"style-settings-section text-block"},jv={class:"office-toolbar"},Jv={class:"toolbar-row toolbar-row-top"},Yv={class:"combo-control font-control"},Gv={class:"combo-control size-control"},Xv={class:"size-input-wrap"},Zv=["min","max","step"],Qv={class:"toolbar-row toolbar-row-actions"},ef={class:"toolbar-icon-group","aria-label":"æ’ç‰ˆæ–¹å‘"},tf=["data-active"],of=["data-active"],nf={class:"toolbar-color-group"},sf={class:"toolbar-color-picker",title:"æ–‡å­—é¢œè‰²"},af={class:"toolbar-inpaint-group",title:"èƒŒæ™¯ä¿®å¤æ–¹å¼"},lf={class:"toolbar-stroke-cluster"},rf=["data-active"],uf={class:"toolbar-row toolbar-row-bottom"},cf={class:"toolbar-rotation-group",title:"æ—‹è½¬è§’åº¦"},df={class:"toolbar-position-group",title:"ä½ç½®è°ƒæ•´"},gf={class:"toolbar-position-value"},pf={class:"fontsize-presets-panel"},mf={class:"font-size-presets"},vf=["onClick"],qt=2,ff=Ye({__name:"BubbleEditor",props:{bubble:{},bubbleIndex:{},isOcrLoading:{type:Boolean},isTranslateLoading:{type:Boolean}},emits:["update","reRender","ocrRecognize","reTranslate","applyBubble","resetCurrent"],setup(n,{emit:t}){const s=n,o=t,a=gt(),u={originalText:"",translatedText:"",fontSize:24,fontFamily:xt,textDirection:"vertical",textColor:"#231816",fillColor:"#FFFFFF",strokeEnabled:!0,strokeColor:"#FFFFFF",strokeWidth:3,rotationAngle:0,inpaintMethod:"solid",position:{x:0,y:0}},l=w(""),c=w(""),g=w(24),d=w(xt),C=w("vertical"),$=w("#231816"),P=w("#FFFFFF"),R=w(!0),_=w("#FFFFFF"),D=w(3),j=w(0),z=w("solid"),L=w(0),b=w(0),p=w(null),T=w(null),k=w(null),N=w(null),O=w(null),ee=w(!1),J=w("original"),ae=w([{name:"æ€æºé»‘ä½“",path:xt},{name:"åæ–‡æ¥·ä½“",path:"fonts/STKAITI.TTF"},{name:"åæ–‡ç»†é»‘",path:"fonts/STXIHEI.TTF"},{name:"é»‘ä½“",path:"fonts/SIMHEI.TTF"},{name:"å®‹ä½“",path:"fonts/SIMSUN.TTC"}]),U=w([]),Q=G(()=>s.bubble?s.bubble.coords[0]+L.value:0),ie=G(()=>s.bubble?s.bubble.coords[1]+b.value:0),F=G(()=>{const Te=[{label:"ç³»ç»Ÿå­—ä½“",options:ae.value.map(W=>({label:W.name,value:W.path}))}];return U.value.length>0&&Te.push({label:"è‡ªå®šä¹‰å­—ä½“",options:U.value.map(W=>({label:W.name,value:W.path}))}),Te}),h=[{label:"çº¯è‰²å¡«å……",value:"solid"},{label:"LAMAä¿®å¤(æ¼«ç”»)",value:"lama_mpe"},{label:"LAMAä¿®å¤(é€šç”¨)",value:"litelama"}];function m(Te){const W=Te||u;l.value=W.originalText,c.value=W.translatedText,g.value=W.fontSize,d.value=W.fontFamily,C.value=W.textDirection,$.value=W.textColor,P.value=W.fillColor,R.value=W.strokeEnabled,_.value=W.strokeColor,D.value=W.strokeWidth,j.value=W.rotationAngle,z.value=W.inpaintMethod,L.value=W.position?.x||0,b.value=W.position?.y||0}Ce(()=>s.bubble,Te=>{m(Te)},{deep:!0,immediate:!0});function i(){o("update",{originalText:l.value})}function f(){o("update",{translatedText:c.value})}function v(){navigator.clipboard.writeText(l.value)}function y(){navigator.clipboard.writeText(c.value)}function I(){o("update",{fontSize:g.value})}function E(Te){g.value=Te,o("update",{fontSize:Te})}function H(){g.value=Math.min(tn,g.value+po),o("update",{fontSize:g.value})}function X(){g.value=Math.max(on,g.value-po),o("update",{fontSize:g.value})}function r(){o("update",{fontFamily:d.value})}function x(Te){C.value=Te,o("update",{textDirection:Te})}function ne(){k.value?.click()}function M(){o("update",{textColor:$.value})}function Z(){N.value?.click()}function de(){o("update",{fillColor:P.value})}function me(){O.value?.click()}function ve(){o("update",{strokeColor:_.value})}function $e(){R.value=!R.value,o("update",{strokeEnabled:R.value})}function Pe(){o("update",{strokeWidth:D.value})}function le(){o("update",{inpaintMethod:z.value})}function S(){o("update",{rotationAngle:j.value})}function Y(){j.value=Math.max(-180,j.value-5),o("update",{rotationAngle:j.value})}function be(){j.value=Math.min(180,j.value+5),o("update",{rotationAngle:j.value})}function fe(){j.value=0,o("update",{rotationAngle:0})}function ye(){L.value-=qt,o("update",{position:{x:L.value,y:b.value}})}function V(){L.value+=qt,o("update",{position:{x:L.value,y:b.value}})}function se(){b.value-=qt,o("update",{position:{x:L.value,y:b.value}})}function he(){b.value+=qt,o("update",{position:{x:L.value,y:b.value}})}function xe(){L.value=0,b.value=0,o("update",{position:{x:0,y:0}})}function Me(){o("applyBubble",s.bubbleIndex)}function Ne(){a.updateAllBubbles({fontSize:g.value,fontFamily:d.value,textDirection:C.value,textColor:$.value,fillColor:P.value,strokeEnabled:R.value,strokeColor:_.value,strokeWidth:D.value,inpaintMethod:z.value}),console.log("æ ·å¼å·²åº”ç”¨åˆ°æ‰€æœ‰æ°”æ³¡"),o("reRender")}function Ae(){o("resetCurrent",s.bubbleIndex)}function ke(){o("ocrRecognize",s.bubbleIndex)}function Be(){o("reTranslate",s.bubbleIndex)}function Ie(){ee.value=!ee.value}function et(Te,W){if(W==="original"){const re=p.value;if(re){const we=re.selectionStart||l.value.length,Ke=re.selectionEnd||l.value.length,rt=l.value;l.value=rt.slice(0,we)+Te+rt.slice(Ke),mt(()=>{re.selectionStart=re.selectionEnd=we+Te.length,re.focus()}),o("update",{originalText:l.value})}}else{const re=T.value;if(re){const we=re.selectionStart||c.value.length,Ke=re.selectionEnd||c.value.length,rt=c.value;c.value=rt.slice(0,we)+Te+rt.slice(Ke),mt(()=>{re.selectionStart=re.selectionEnd=we+Te.length,re.focus()}),o("update",{translatedText:c.value})}}}function qe(Te){if(Te==="original"){const W=p.value;if(W&&l.value.length>0){const re=W.selectionStart||l.value.length,we=W.selectionEnd||l.value.length,Ke=l.value;re===we&&re>0?(l.value=Ke.slice(0,re-1)+Ke.slice(we),mt(()=>{W.selectionStart=W.selectionEnd=re-1,W.focus()})):re!==we&&(l.value=Ke.slice(0,re)+Ke.slice(we),mt(()=>{W.selectionStart=W.selectionEnd=re,W.focus()})),o("update",{originalText:l.value})}}else{const W=T.value;if(W&&c.value.length>0){const re=W.selectionStart||c.value.length,we=W.selectionEnd||c.value.length,Ke=c.value;re===we&&re>0?(c.value=Ke.slice(0,re-1)+Ke.slice(we),mt(()=>{W.selectionStart=W.selectionEnd=re-1,W.focus()})):re!==we&&(c.value=Ke.slice(0,re)+Ke.slice(we),mt(()=>{W.selectionStart=W.selectionEnd=re,W.focus()})),o("update",{translatedText:c.value})}}}async function at(){try{const Te=await Ys();if(Te.fonts){const W=[],re=[];for(const we of Te.fonts){const Ke={name:typeof we=="string"?we:we.display_name||we.file_name||"",path:typeof we=="string"?we:we.path};Ke.path.startsWith("fonts/")?W.push(Ke):re.push(Ke)}W.length>0&&(ae.value=W),U.value=re}}catch(Te){console.error("åŠ è½½å­—ä½“åˆ—è¡¨å¤±è´¥:",Te)}}return dt(()=>{at()}),(Te,W)=>(B(),A("div",Ov,[e("div",zv,[e("div",Nv,[W[14]||(W[14]=e("span",{class:"column-title"},"ğŸ‡¯ğŸ‡µ æ—¥è¯­åŸæ–‡ (OCRç»“æœ)",-1)),e("button",{class:De(["re-ocr-btn",{"is-loading":n.isOcrLoading}]),disabled:n.isOcrLoading,onClick:ke,title:"é‡æ–°OCRæ­¤æ°”æ³¡"},[...W[13]||(W[13]=[e("span",{class:"btn-icon"},"ğŸ”„",-1)])],10,Vv)]),oe(e("textarea",{ref_key:"originalTextInput",ref:p,"onUpdate:modelValue":W[0]||(W[0]=re=>l.value=re),class:"text-editor original-editor",placeholder:"OCRè¯†åˆ«çš„æ—¥è¯­åŸæ–‡...",spellcheck:"false",onInput:i},null,544),[[Re,l.value]]),e("div",{class:"text-actions"},[e("button",{class:"copy-btn",onClick:v},"ğŸ“‹ å¤åˆ¶"),e("button",{class:"keyboard-toggle-btn",onClick:Ie,title:"æ˜¾ç¤º/éšè—50éŸ³é”®ç›˜"}," âŒ¨ï¸ 50éŸ³ ")]),Se(Uv,{visible:ee.value,"default-target":J.value,onClose:W[1]||(W[1]=re=>ee.value=!1),onInsert:et,onDelete:qe},null,8,["visible","default-target"])]),e("div",Wv,[e("div",Kv,[W[16]||(W[16]=e("span",{class:"column-title"},"ğŸ‡¨ğŸ‡³ ä¸­æ–‡è¯‘æ–‡",-1)),e("button",{class:De(["re-translate-btn",{"is-loading":n.isTranslateLoading}]),disabled:n.isTranslateLoading,onClick:Be,title:"é‡æ–°ç¿»è¯‘æ­¤æ°”æ³¡"},[...W[15]||(W[15]=[e("span",{class:"btn-icon"},"ğŸ”„",-1)])],10,qv)]),oe(e("textarea",{ref_key:"translatedTextInput",ref:T,"onUpdate:modelValue":W[2]||(W[2]=re=>c.value=re),class:"text-editor translated-editor",placeholder:"ç¿»è¯‘åçš„ä¸­æ–‡...",spellcheck:"false",onInput:f},null,544),[[Re,c.value]]),e("div",{class:"text-actions"},[e("button",{class:"copy-btn",onClick:y},"ğŸ“‹ å¤åˆ¶"),e("button",{class:"apply-text-btn",onClick:Me},"âœ“ åº”ç”¨æ–‡æœ¬")])]),e("div",Hv,[e("div",jv,[e("div",Jv,[e("div",Yv,[W[17]||(W[17]=e("label",null,"å­—ä½“",-1)),Se(We,{modelValue:d.value,"onUpdate:modelValue":W[3]||(W[3]=re=>d.value=re),groups:F.value,title:"å­—ä½“",onChange:r},null,8,["modelValue","groups"])]),e("div",Gv,[W[18]||(W[18]=e("label",null,"å­—å·",-1)),e("div",Xv,[oe(e("input",{type:"number","onUpdate:modelValue":W[4]||(W[4]=re=>g.value=re),class:"toolbar-fontsize-input",min:K(on),max:K(tn),step:K(po),title:"å­—å·",onChange:I},null,40,Zv),[[Re,g.value,void 0,{number:!0}]]),e("div",{class:"toolbar-fontsize-btns"},[e("button",{class:"toolbar-fontsize-btn",onClick:H,title:"å¢å¤§å­—å·"}," A+ "),e("button",{class:"toolbar-fontsize-btn",onClick:X,title:"å‡å°å­—å·"}," A- ")])])])]),e("div",Qv,[e("div",ef,[e("button",{class:"toolbar-btn","data-active":C.value==="vertical",onClick:W[5]||(W[5]=re=>x("vertical")),title:"ç«–å‘æ’ç‰ˆ"},[...W[19]||(W[19]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M8 2v12M8 2L5 5M8 2l3 3",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])],8,tf),e("button",{class:"toolbar-btn","data-active":C.value==="horizontal",onClick:W[6]||(W[6]=re=>x("horizontal")),title:"æ¨ªå‘æ’ç‰ˆ"},[...W[20]||(W[20]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M2 8h12M14 8l-3-3M14 8l-3 3",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])],8,of)]),W[26]||(W[26]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",nf,[e("div",sf,[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:ne},[W[21]||(W[21]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("text",{x:"3",y:"11","font-size":"10","font-weight":"bold",fill:"currentColor"},"A")],-1)),e("span",{class:"color-indicator",style:nt({background:$.value})},null,4)]),oe(e("input",{ref_key:"textColorInput",ref:k,type:"color","onUpdate:modelValue":W[7]||(W[7]=re=>$.value=re),class:"hidden-color-input",onInput:M,onChange:M},null,544),[[Re,$.value]])])]),W[27]||(W[27]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",af,[Se(We,{modelValue:z.value,"onUpdate:modelValue":W[8]||(W[8]=re=>z.value=re),options:h,onChange:le},null,8,["modelValue"]),e("div",{class:De(["toolbar-color-picker toolbar-solid-color-options",{hidden:z.value!=="solid"}])},[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:Z},[W[22]||(W[22]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("rect",{x:"2",y:"2",width:"12",height:"12",rx:"2",fill:"none",stroke:"currentColor","stroke-width":"1.2"}),e("rect",{x:"4",y:"4",width:"8",height:"8",rx:"1",fill:"currentColor",opacity:"0.3"})],-1)),e("span",{class:"color-indicator",style:nt({background:P.value})},null,4)]),oe(e("input",{ref_key:"fillColorInput",ref:N,type:"color","onUpdate:modelValue":W[9]||(W[9]=re=>P.value=re),class:"hidden-color-input",onChange:de},null,544),[[Re,P.value]])],2)]),W[28]||(W[28]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",lf,[e("button",{class:"toolbar-btn","data-active":R.value,onClick:$e,title:"æ–‡å­—æè¾¹"},[...W[23]||(W[23]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("text",{x:"3",y:"12","font-size":"11","font-weight":"bold",stroke:"currentColor","stroke-width":"2",fill:"none"}," A "),e("text",{x:"3",y:"12","font-size":"11","font-weight":"bold",fill:"currentColor"},"A")],-1)])],8,rf),e("div",{class:De(["toolbar-color-picker toolbar-stroke-options",{hidden:!R.value}]),title:"æè¾¹é¢œè‰²"},[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:me},[W[24]||(W[24]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"2"})],-1)),e("span",{class:"color-indicator",style:nt({background:_.value})},null,4)]),oe(e("input",{ref_key:"strokeColorInput",ref:O,type:"color","onUpdate:modelValue":W[10]||(W[10]=re=>_.value=re),class:"hidden-color-input",onChange:ve},null,544),[[Re,_.value]])],2),e("div",{class:De(["toolbar-stroke-width toolbar-stroke-options",{hidden:!R.value}]),title:"æè¾¹å®½åº¦"},[oe(e("input",{type:"number","onUpdate:modelValue":W[11]||(W[11]=re=>D.value=re),class:"toolbar-mini-input",min:"0",max:"10",onChange:Pe},null,544),[[Re,D.value,void 0,{number:!0}]]),W[25]||(W[25]=e("span",{class:"toolbar-unit"},"px",-1))],2)])]),e("div",uf,[e("div",cf,[e("button",{class:"toolbar-btn",onClick:Y,title:"é€†æ—¶é’ˆæ—‹è½¬"},[...W[29]||(W[29]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M2 8a6 6 0 1 1 1.5 4",stroke:"currentColor","stroke-width":"1.5",fill:"none"}),e("path",{d:"M2 5v3.5h3.5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),oe(e("input",{type:"number","onUpdate:modelValue":W[12]||(W[12]=re=>j.value=re),class:"toolbar-mini-input toolbar-rotation-input",min:"-180",max:"180",step:"5",onChange:S},null,544),[[Re,j.value,void 0,{number:!0}]]),W[31]||(W[31]=e("span",{class:"toolbar-unit"},"Â°",-1)),e("button",{class:"toolbar-btn",onClick:be,title:"é¡ºæ—¶é’ˆæ—‹è½¬"},[...W[30]||(W[30]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M14 8a6 6 0 1 0-1.5 4",stroke:"currentColor","stroke-width":"1.5",fill:"none"}),e("path",{d:"M14 5v3.5h-3.5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn toolbar-small-btn",onClick:fe,title:"é‡ç½®æ—‹è½¬"}," 0 ")]),W[37]||(W[37]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",df,[e("button",{class:"toolbar-btn",onClick:ye,title:"å·¦ç§»"},[...W[32]||(W[32]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M10 3L5 8l5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:V,title:"å³ç§»"},[...W[33]||(W[33]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M6 3l5 5-5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:se,title:"ä¸Šç§»"},[...W[34]||(W[34]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M3 10l5-5 5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:he,title:"ä¸‹ç§»"},[...W[35]||(W[35]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M3 6l5 5 5-5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("span",gf,[e("span",null,te(Q.value),1),W[36]||(W[36]=pe(",",-1)),e("span",null,te(ie.value),1)]),e("button",{class:"toolbar-btn toolbar-small-btn",onClick:xe,title:"é‡ç½®ä½ç½®"}," âŒ‚ ")])])]),e("details",pf,[W[38]||(W[38]=e("summary",null,"å­—å·é¢„è®¾",-1)),e("div",mf,[(B(!0),A(ze,null,Ge(K(Ps),re=>(B(),A("button",{key:re,class:De(["preset-btn",{active:g.value===re}]),onClick:we=>E(re)},te(re),11,vf))),128))])]),e("div",{class:"edit-action-buttons"},[e("button",{class:"btn-apply",onClick:Me},"åº”ç”¨"),e("button",{class:"btn-apply-all",onClick:Ne},"åº”ç”¨å…¨éƒ¨"),e("button",{class:"btn-reset",onClick:Ae},"é‡ç½®")])])]))}}),bf=Je(ff,[["__scopeId","data-v-9d0b72d7"]]),hf={class:"edit-toolbar-wrapper"},xf={class:"edit-toolbar toolbar-row-1"},yf={class:"image-navigator"},_f=["disabled"],Cf=["disabled"],Sf={class:"bubble-navigator"},kf=["disabled"],wf={class:"bubble-indicator"},$f={id:"currentBubbleNum"},Tf={id:"totalBubbleNum"},If=["disabled"],Pf={class:"view-controls"},Rf={key:0,viewBox:"0 0 20 20",width:"16",height:"16"},Df={key:1,viewBox:"0 0 20 20",width:"16",height:"16"},Mf={id:"zoomLevel"},Bf={class:"edit-toolbar toolbar-row-2"},Ef={class:"annotation-tools"},Af=["disabled"],Lf=["disabled"],Ff={key:0,class:"brush-size-indicator"},Uf={key:1,class:"brush-mode-hint"},Of={class:"edit-progress-info"},zf={class:"edit-progress-text"},Nf={class:"edit-progress-count"},Vf={class:"edit-progress-bar"},Wf={class:"quick-actions"},Kf=Ye({__name:"EditToolbar",props:{currentImageIndex:{},imageCount:{},canGoPrevious:{type:Boolean},canGoNext:{type:Boolean},showThumbnails:{type:Boolean},hasBubbles:{type:Boolean},selectedBubbleIndex:{},bubbleCount:{},layoutMode:{},syncEnabled:{type:Boolean},scale:{},isDrawingMode:{type:Boolean},hasSelection:{type:Boolean},brushMode:{},brushSize:{},mouseX:{},mouseY:{},isProcessing:{type:Boolean},progressText:{},progressCurrent:{},progressTotal:{},isRepairLoading:{type:Boolean}},emits:["go-previous-image","go-next-image","toggle-thumbnails","select-previous-bubble","select-next-bubble","toggle-layout","toggle-view-mode","toggle-sync","fit-to-screen","zoom-in","zoom-out","reset-zoom","exit-edit-mode","auto-detect-bubbles","detect-all-images","translate-with-bubbles","toggle-drawing-mode","delete-selected-bubbles","repair-selected-bubble","activate-repair-brush","activate-restore-brush","apply-and-next"],setup(n){const t=n,s=G(()=>t.progressTotal===0?0:Math.round(t.progressCurrent/t.progressTotal*100)),o=G(()=>t.progressTotal>0&&t.progressCurrent>=t.progressTotal),a=G(()=>{const u=t.brushMode==="repair"?{fill:"rgba(76, 175, 80, 0.4)",border:"#4CAF50"}:{fill:"rgba(33, 150, 243, 0.4)",border:"#2196F3"};return{position:"fixed",left:`${t.mouseX}px`,top:`${t.mouseY}px`,width:`${t.brushSize}px`,height:`${t.brushSize}px`,borderRadius:"50%",border:`2px solid ${u.border}`,backgroundColor:u.fill,pointerEvents:"none",zIndex:99999,transform:"translate(-50%, -50%)",display:t.brushMode?"block":"none"}});return(u,l)=>(B(),A("div",hf,[e("div",xf,[e("div",yf,[e("button",{class:"nav-btn",disabled:!n.canGoPrevious,onClick:l[0]||(l[0]=c=>u.$emit("go-previous-image")),title:"ä¸Šä¸€å¼ å›¾ç‰‡ (PageUp)"}," â—€â—€ ",8,_f),e("span",{class:"image-indicator",onClick:l[1]||(l[1]=c=>u.$emit("toggle-thumbnails")),title:"ç‚¹å‡»å±•å¼€ç¼©ç•¥å›¾"},[l[23]||(l[23]=pe(" å›¾ ",-1)),e("span",null,te(n.currentImageIndex+1),1),l[24]||(l[24]=pe(" / ",-1)),e("span",null,te(n.imageCount),1)]),e("button",{class:"nav-btn",disabled:!n.canGoNext,onClick:l[2]||(l[2]=c=>u.$emit("go-next-image")),title:"ä¸‹ä¸€å¼ å›¾ç‰‡ (PageDown)"}," â–¶â–¶ ",8,Cf),e("button",{class:De(["thumb-toggle-btn",{active:n.showThumbnails}]),onClick:l[3]||(l[3]=c=>u.$emit("toggle-thumbnails")),title:"æ˜¾ç¤º/éšè—ç¼©ç•¥å›¾"}," â˜· ",2)]),l[30]||(l[30]=e("div",{class:"toolbar-divider"},null,-1)),e("div",Sf,[e("button",{id:"prevBubbleBtn",class:"nav-btn",disabled:!n.hasBubbles||n.selectedBubbleIndex<=0,onClick:l[4]||(l[4]=c=>u.$emit("select-previous-bubble")),title:"ä¸Šä¸€ä¸ªæ°”æ³¡ (â†)"}," â—€ ",8,kf),e("span",wf,[l[25]||(l[25]=pe(" æ°”æ³¡ ",-1)),e("span",$f,te(n.selectedBubbleIndex>=0?n.selectedBubbleIndex+1:0),1),l[26]||(l[26]=pe(" / ",-1)),e("span",Tf,te(n.bubbleCount),1)]),e("button",{id:"nextBubbleBtn",class:"nav-btn",disabled:!n.hasBubbles||n.selectedBubbleIndex>=n.bubbleCount-1,onClick:l[5]||(l[5]=c=>u.$emit("select-next-bubble")),title:"ä¸‹ä¸€ä¸ªæ°”æ³¡ (â†’)"}," â–¶ ",8,If)]),l[31]||(l[31]=e("div",{class:"toolbar-divider"},null,-1)),e("div",Pf,[e("button",{class:"layout-toggle-btn",onClick:l[6]||(l[6]=c=>u.$emit("toggle-layout")),title:"åˆ‡æ¢å¸ƒå±€ï¼šå·¦å³/ä¸Šä¸‹"},[n.layoutMode==="horizontal"?(B(),A("svg",Rf,[...l[27]||(l[27]=[e("rect",{x:"1",y:"2",width:"8",height:"16",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1),e("rect",{x:"11",y:"2",width:"8",height:"16",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1)])])):(B(),A("svg",Df,[...l[28]||(l[28]=[e("rect",{x:"2",y:"1",width:"16",height:"8",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1),e("rect",{x:"2",y:"11",width:"16",height:"8",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1)])]))]),e("button",{class:"view-mode-btn",onClick:l[7]||(l[7]=c=>u.$emit("toggle-view-mode")),title:"åˆ‡æ¢è§†å›¾æ¨¡å¼"},[...l[29]||(l[29]=[e("span",{class:"dual-icon"},"â§‰",-1)])]),e("button",{class:De({active:n.syncEnabled}),onClick:l[8]||(l[8]=c=>u.$emit("toggle-sync")),title:"åŒæ­¥ç¼©æ”¾/æ‹–åŠ¨",style:{"font-size":"12px"}}," ğŸ”— ",2),e("button",{onClick:l[9]||(l[9]=c=>u.$emit("fit-to-screen")),title:"é€‚åº”å±å¹• (åŒå‡»)"},"â›¶"),e("button",{onClick:l[10]||(l[10]=c=>u.$emit("zoom-in")),title:"æ”¾å¤§ (+)"},"+"),e("span",Mf,te(Math.round(n.scale*100))+"%",1),e("button",{onClick:l[11]||(l[11]=c=>u.$emit("zoom-out")),title:"ç¼©å° (-)"},"âˆ’"),e("button",{onClick:l[12]||(l[12]=c=>u.$emit("reset-zoom")),title:"åŸå§‹å¤§å°"},"1:1")]),l[32]||(l[32]=e("div",{class:"toolbar-spacer"},null,-1)),e("button",{class:"secondary-btn",onClick:l[13]||(l[13]=c=>u.$emit("exit-edit-mode"))},"é€€å‡ºç¼–è¾‘")]),e("div",Bf,[e("div",Ef,[e("button",{class:"annotation-btn detect-btn",onClick:l[14]||(l[14]=c=>u.$emit("auto-detect-bubbles")),title:"è‡ªåŠ¨æ£€æµ‹å½“å‰å›¾ç‰‡çš„æ–‡æœ¬æ¡†"},[...l[33]||(l[33]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"6",cy:"6",r:"4",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M9 9l4 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1),e("span",null,"æ£€æµ‹",-1)])]),e("button",{class:"annotation-btn detect-btn",onClick:l[15]||(l[15]=c=>u.$emit("detect-all-images")),title:"æ‰¹é‡æ£€æµ‹æ‰€æœ‰å›¾ç‰‡"},[...l[34]||(l[34]=[fo('<svg viewBox="0 0 16 16" width="14" height="14" data-v-d94e5ff3><circle cx="5" cy="5" r="2.5" fill="none" stroke="currentColor" stroke-width="1" data-v-d94e5ff3></circle><path d="M7 7l2 2" stroke="currentColor" stroke-width="1" stroke-linecap="round" data-v-d94e5ff3></path><circle cx="10" cy="10" r="2.5" fill="none" stroke="currentColor" stroke-width="1" data-v-d94e5ff3></circle><path d="M12 12l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-d94e5ff3></path></svg><span data-v-d94e5ff3>æ‰¹é‡æ£€æµ‹</span>',2)])]),e("button",{class:"annotation-btn primary-action-btn",onClick:l[16]||(l[16]=c=>u.$emit("translate-with-bubbles")),title:"ä½¿ç”¨å½“å‰æ–‡æœ¬æ¡†ç¿»è¯‘æ­¤å›¾ç‰‡"},[...l[35]||(l[35]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M2 3h5M4.5 3v7M2 6h5",stroke:"currentColor","stroke-width":"1.2",fill:"none"}),e("path",{d:"M9 13l2-7 2 7M9.5 11h3",stroke:"currentColor","stroke-width":"1.2",fill:"none"})],-1),e("span",null,"ç¿»è¯‘",-1)])]),l[42]||(l[42]=e("div",{class:"toolbar-divider"},null,-1)),e("button",{class:De(["annotation-btn",{active:n.isDrawingMode}]),onClick:l[17]||(l[17]=c=>u.$emit("toggle-drawing-mode")),title:"æ·»åŠ æ°”æ³¡æ¡†ï¼ˆæˆ–ä¸­é”®æ‹–æ‹½ç»˜åˆ¶ï¼‰"},[...l[36]||(l[36]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("rect",{x:"3",y:"3",width:"10",height:"10",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M8 5v6M5 8h6",stroke:"currentColor","stroke-width":"1.5"})],-1),e("span",null,"æ·»åŠ ",-1)])],2),e("button",{class:"annotation-btn",disabled:!n.hasSelection,onClick:l[18]||(l[18]=c=>u.$emit("delete-selected-bubbles")),title:"åˆ é™¤é€‰ä¸­æ°”æ³¡æ¡† (Delete)"},[...l[37]||(l[37]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("rect",{x:"3",y:"3",width:"10",height:"10",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M5 8h6",stroke:"currentColor","stroke-width":"1.5"})],-1),e("span",null,"åˆ é™¤",-1)])],8,Af),e("button",{class:De(["annotation-btn",{"is-loading":n.isRepairLoading}]),disabled:!n.hasSelection||n.isRepairLoading,onClick:l[19]||(l[19]=c=>u.$emit("repair-selected-bubble")),title:"ä¿®å¤é€‰ä¸­æ°”æ³¡èƒŒæ™¯ (R)"},[(B(),A("svg",{viewBox:"0 0 16 16",width:"14",height:"14",class:De({"spin-icon":n.isRepairLoading})},[...l[38]||(l[38]=[e("path",{d:"M2 14l3-3m0 0l6-6 3 3-6 6m-3 0l-1 1 1-1z",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M11 5l-1-1 2-2 2 2-2 2-1-1z",fill:"currentColor"},null,-1)])],2)),l[39]||(l[39]=e("span",null,"ä¿®å¤",-1))],10,Lf),l[43]||(l[43]=e("div",{class:"toolbar-divider"},null,-1)),e("button",{class:De(["annotation-btn brush-btn",{active:n.brushMode==="repair"}]),onClick:l[20]||(l[20]=c=>u.$emit("activate-repair-brush")),title:"ä¿®å¤ç¬”åˆ· (æŒ‰ä½R+å·¦é”®æ‹–æ‹½)"},[...l[40]||(l[40]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("circle",{cx:"8",cy:"8",r:"2",fill:"currentColor"})],-1),e("span",null,"ä¿®å¤ç¬”åˆ·",-1)])],2),e("button",{class:De(["annotation-btn brush-btn",{active:n.brushMode==="restore"}]),onClick:l[21]||(l[21]=c=>u.$emit("activate-restore-brush")),title:"è¿˜åŸç¬”åˆ· (æŒ‰ä½U+å·¦é”®æ‹–æ‹½)"},[...l[41]||(l[41]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M5 8h6M8 5v6",stroke:"currentColor","stroke-width":"1",transform:"rotate(45 8 8)"})],-1),e("span",null,"è¿˜åŸç¬”åˆ·",-1)])],2),n.brushMode?(B(),A("span",Ff," ç¬”åˆ·: "+te(n.brushSize)+"px ",1)):ce("",!0),l[44]||(l[44]=fo('<div class="help-tooltip-container" data-v-d94e5ff3><button class="help-tooltip-btn" title="å¿«æ·é”®æ“ä½œå¸®åŠ©" data-v-d94e5ff3><svg viewBox="0 0 16 16" width="14" height="14" data-v-d94e5ff3><circle cx="8" cy="8" r="6.5" fill="none" stroke="currentColor" stroke-width="1.2" data-v-d94e5ff3></circle><text x="8" y="11" text-anchor="middle" font-size="9" font-weight="bold" fill="currentColor" data-v-d94e5ff3>?</text></svg><span class="help-btn-text" data-v-d94e5ff3>å¿«æ·é”®</span></button><div class="help-tooltip-popup" data-v-d94e5ff3><div class="help-section" data-v-d94e5ff3><div class="help-title" data-v-d94e5ff3>ğŸ–±ï¸ é¼ æ ‡æ“ä½œ</div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>å·¦é”®ç‚¹å‡»æ°”æ³¡</span><span class="help-desc" data-v-d94e5ff3>é€‰æ‹©æ°”æ³¡</span></div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>Shift+å·¦é”®ç‚¹å‡»</span><span class="help-desc" data-v-d94e5ff3>å¤šé€‰æ°”æ³¡</span></div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>å·¦é”®æ‹–æ‹½å››è§’/è¾¹</span><span class="help-desc" data-v-d94e5ff3>è°ƒæ•´å¤§å°</span></div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>å·¦é”®æ‹–æ‹½æ¡†å†…éƒ¨</span><span class="help-desc" data-v-d94e5ff3>ç§»åŠ¨æ°”æ³¡æ¡†</span></div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>ä¸­é”®æ‹–æ‹½</span><span class="help-desc" data-v-d94e5ff3>ç»˜åˆ¶æ–°æ°”æ³¡æ¡†</span></div></div><div class="help-section" data-v-d94e5ff3><div class="help-title" data-v-d94e5ff3>âŒ¨ï¸ å¿«æ·é”®</div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>A / D</span><span class="help-desc" data-v-d94e5ff3>åˆ‡æ¢ä¸Š/ä¸‹ä¸€å¼ å›¾ç‰‡</span></div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>Ctrl+Enter</span><span class="help-desc" data-v-d94e5ff3>åº”ç”¨å¹¶è·³è½¬ä¸‹ä¸€å¼ </span></div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>Delete / Backspace</span><span class="help-desc" data-v-d94e5ff3>åˆ é™¤é€‰ä¸­æ°”æ³¡</span></div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>æŒ‰ä½R+å·¦é”®æ‹–æ‹½</span><span class="help-desc" data-v-d94e5ff3>ä¿®å¤ç¬”åˆ·</span></div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>æŒ‰ä½U+å·¦é”®æ‹–æ‹½</span><span class="help-desc" data-v-d94e5ff3>è¿˜åŸç¬”åˆ·</span></div><div class="help-item" data-v-d94e5ff3><span class="help-key" data-v-d94e5ff3>ç¬”åˆ·æ¨¡å¼ä¸‹æ»šè½®</span><span class="help-desc" data-v-d94e5ff3>è°ƒæ•´ç¬”åˆ·å¤§å°</span></div></div></div></div>',1))]),n.brushMode?(B(),A("div",{key:0,class:"brush-cursor",style:nt(a.value)},null,4)):ce("",!0),n.brushMode?(B(),A("div",Uf,te(n.brushMode==="repair"?"ä¿®å¤ç¬”åˆ· (R)":"è¿˜åŸç¬”åˆ· (U)")+" - æ»šè½®è°ƒæ•´å¤§å° ",1)):ce("",!0),n.isProcessing?(B(),A("div",{key:2,class:De(["edit-progress-container",{completed:o.value}])},[e("div",Of,[e("span",zf,te(n.progressText),1),e("span",Nf,te(n.progressCurrent)+"/"+te(n.progressTotal),1)]),e("div",Vf,[e("div",{class:De(["edit-progress-fill",{animating:!o.value}]),style:nt({width:s.value+"%"})},null,6)])],2)):ce("",!0),l[45]||(l[45]=e("div",{class:"toolbar-spacer"},null,-1)),e("div",Wf,[e("button",{class:"primary-btn",onClick:l[22]||(l[22]=c=>u.$emit("apply-and-next")),title:"åº”ç”¨æ›´æ”¹å¹¶è·³è½¬ä¸‹ä¸€å¼  (Ctrl+Enter)"}," åº”ç”¨å¹¶ä¸‹ä¸€å¼  ")])])]))}}),qf=Je(Kf,[["__scopeId","data-v-d94e5ff3"]]),Hf={key:0,class:"edit-thumbnails-panel"},jf={class:"thumbnails-scroll"},Jf=["onClick"],Yf=["src","alt"],Gf={class:"thumb-index"},Xf=Ye({__name:"EditThumbnailPanel",props:{visible:{type:Boolean},images:{},currentImageIndex:{}},emits:["switch-to-image"],setup(n){return(t,s)=>n.visible?(B(),A("div",Hf,[e("div",jf,[(B(!0),A(ze,null,Ge(n.images,(o,a)=>(B(),A("div",{key:o.id,class:De(["edit-thumbnail-item",{active:a===n.currentImageIndex}]),onClick:u=>t.$emit("switch-to-image",a)},[e("img",{src:o.translatedDataURL||o.originalDataURL,alt:`å›¾ç‰‡ ${a+1}`},null,8,Yf),e("span",Gf,te(a+1),1)],10,Jf))),128))])])):ce("",!0)}}),Zf=Je(Xf,[["__scopeId","data-v-9d2a43d9"]]),Qf=["data-brush-mode"],eb={class:"edit-main-layout"},tb={class:"image-comparison-container"},ob={class:"panel-header"},nb=["src"],sb={class:"panel-header"},ab=["src"],lb=Ye({__name:"EditWorkspace",props:{isEditModeActive:{type:Boolean}},emits:["exit"],setup(n,{emit:t}){const s=n,o=t,a=Qe(),u=gt(),{translateWithCurrentBubbles:l}=Do(),{reRenderFullImage:c}=Qm({onRenderStart:()=>console.log("å¼€å§‹é‡æ–°æ¸²æŸ“..."),onRenderSuccess:q=>console.log("æ¸²æŸ“æˆåŠŸ:",q.substring(0,50)+"..."),onRenderError:q=>console.error("æ¸²æŸ“å¤±è´¥:",q)}),{isDrawingMode:g,isDrawingBox:d,currentDrawingRect:C,isMiddleButtonDown:$,handleBubbleSelect:P,handleBubbleMultiSelect:R,handleClearMultiSelect:_,handleBubbleDragStart:D,handleBubbleDragging:j,handleBubbleDragEnd:z,handleBubbleResizeStart:L,handleBubbleResizing:b,handleBubbleResizeEnd:p,handleBubbleRotateStart:T,handleBubbleRotating:k,handleBubbleRotateEnd:N,toggleDrawingMode:O,handleDrawBubble:ee,getDrawingRectStyle:J,handleBubbleUpdate:ae,deleteSelectedBubbles:U,repairSelectedBubble:Q,handleOcrRecognize:ie}=Zm({onReRender:()=>c(),onDelayedPreview:()=>c()}),F=w(0),h=w(0),{brushMode:m,brushSize:i,mouseX:f,mouseY:v,isBrushKeyDown:y,toggleBrushMode:I,exitBrushMode:E,startBrushPainting:H,continueBrushPainting:X,finishBrushPainting:r,adjustBrushSize:x}=Gm({onBrushComplete:()=>c(),getCurrentRepairSettings:()=>({inpaintMethod:W.value,fillColor:re.value})}),{images:ne,currentImageIndex:M,currentImage:Z,imageCount:de,canGoPrevious:me,canGoNext:ve}=kt(a),{bubbles:$e,selectedIndex:Pe,selectedIndices:le,selectedBubble:S,bubbleCount:Y,hasBubbles:be,hasSelection:fe}=kt(u),ye=G(()=>Z.value?.width||0),V=G(()=>Z.value?.height||0);function se(){const q=Me.value?.querySelector("img");q&&q.naturalWidth>0&&q.naturalHeight>0&&a.updateCurrentImageDimensions(q.naturalWidth,q.naturalHeight)}const he=w(null),xe=w(null),Me=w(null),Ne=w(null),Ae=w(null),ke=w(null),Be=w("dual"),Ie=w("horizontal"),et=w(!1),qe=w(!0),at=w(!1),Te=w(!1),W=w("solid"),re=w("#FFFFFF"),we=w(!1),Ke=w("å¤„ç†ä¸­..."),rt=w(0),yt=w(0),tt=w(!1),Gt=w(!1),Xt=w(!1),lt=bn(),ot=bn(),Zt=G(()=>ot.scale.value),jn=G(()=>ot.translateX.value),Jn=G(()=>ot.translateY.value),Yn=G(()=>lt.scale.value),_t=w(null),Gn=G(()=>({transform:`translate(${lt.translateX.value}px, ${lt.translateY.value}px) scale(${lt.scale.value})`})),Xn=G(()=>({transform:`translate(${ot.translateX.value}px, ${ot.translateY.value}px) scale(${ot.scale.value})`}));function Mo(){ot.zoomIn(),qe.value&&lt.setTransform(ot.getTransform())}function Bo(){ot.zoomOut(),qe.value&&lt.setTransform(ot.getTransform())}function Eo(){ot.resetZoom(),qe.value&&lt.setTransform(ot.getTransform())}const Qt=w(!1),Zn=w(0),eo=w(!1),Mt=w({x:0,y:0,size:0});function to(){m.value&&E(),so()}function oo(){u.bubbles.length>0&&u.selectBubble(0)}function Ao(){me.value&&(to(),a.goToPrevious())}function no(){ve.value&&(to(),a.goToNext())}function Qn(q){q!==M.value&&q>=0&&q<de.value&&(to(),a.setCurrentImageIndex(q))}function so(){if(!Z.value)return;const q=Array.isArray(Z.value.bubbleStates);$e.value.length>0?(a.updateCurrentBubbleStates([...$e.value]),a.setManuallyAnnotated(!0),console.log("å·²ä¿å­˜æ°”æ³¡çŠ¶æ€åˆ°å½“å‰å›¾ç‰‡ï¼Œæ ‡è®°ä¸ºæ‰‹åŠ¨æ ‡æ³¨")):q&&(a.updateCurrentBubbleStates([]),a.setManuallyAnnotated(!0),console.log("å·²ä¿å­˜ç©ºæ°”æ³¡çŠ¶æ€åˆ°å½“å‰å›¾ç‰‡ï¼ˆç”¨æˆ·ä¸»åŠ¨æ¸…ç©ºï¼Œæ ‡è®°ä¸ºæ‰‹åŠ¨æ ‡æ³¨ï¼‰"))}function Bt(){Z.value?.bubbleStates?(u.setBubbles([...Z.value.bubbleStates],!0),console.log(`å·²åŠ è½½ ${Z.value.bubbleStates.length} ä¸ªæ°”æ³¡çŠ¶æ€`)):u.clearBubblesLocal(),oo()}function es(){u.selectPrevious()}function ts(){u.selectNext()}function os(){et.value=!et.value}function ns(){Ie.value=Ie.value==="horizontal"?"vertical":"horizontal";try{localStorage.setItem(nn,Ie.value)}catch(q){console.warn("ä¿å­˜å¸ƒå±€æ¨¡å¼å¤±è´¥:",q)}setTimeout(()=>{Et()},300)}function ss(){const q=["dual","original","translated"],ue=q.indexOf(Be.value),ge=q[(ue+1)%q.length];ge&&(Be.value=ge)}function as(){qe.value=!qe.value,console.log("åŒå›¾åŒæ­¥:",qe.value?"å¼€å¯":"å…³é—­"),qe.value&&lt.setTransform(ot.getTransform())}function Et(){const q=Ne.value||xe.value,ue=Ae.value||Me.value;if(!q||!ue)return;const ge=ue.querySelector("img");if(!ge||!ge.naturalWidth)return;const He=q.getBoundingClientRect(),Ee=He.width/ge.naturalWidth,Le=He.height/ge.naturalHeight,Ve=Math.min(Ee,Le)*.95,Ue=(He.width-ge.naturalWidth*Ve)/2,pt=(He.height-ge.naturalHeight*Ve)/2,Ct={scale:Ve,translateX:Ue,translateY:pt};ot.setTransform(Ct),lt.setTransform(Ct)}function Lo(q,ue){if(m.value){const Ue=q.deltaY>0?-5:5;x(Ue);return}const ge=q.currentTarget.getBoundingClientRect(),He=q.clientX-ge.left,Ee=q.clientY-ge.top,Le=q.deltaY>0?.9:1.1,Ve=ue==="original"?lt:ot;Ve.zoomAt(He,Ee,Le),qe.value&&(ue==="original"?ot:lt).setTransform(Ve.getTransform())}function Fo(q,ue){if(m.value){const ge=ue==="original"?xe.value:Ne.value;ge&&H(q,ge);return}if(q.button===1){$.value=!0,zo(q,ue),q.preventDefault();return}if(g.value&&q.button===0){zo(q,ue),q.preventDefault();return}if(q.button===0){if(q.target.closest(".bubble-highlight-box"))return;q.shiftKey||_(),_t.value=ue,(ue==="original"?lt:ot).startDrag(q.clientX,q.clientY),document.addEventListener("mousemove",Uo),document.addEventListener("mouseup",Oo),q.preventDefault()}}function Uo(q){if(!_t.value)return;const ue=_t.value==="original"?lt:ot;ue.drag(q.clientX,q.clientY),qe.value&&(_t.value==="original"?ot:lt).setTransform(ue.getTransform())}function Oo(){_t.value&&(_t.value==="original"?lt:ot).endDrag(),_t.value=null,document.removeEventListener("mousemove",Uo),document.removeEventListener("mouseup",Oo)}let ao="translated";function zo(q,ue="translated"){ao=ue;const ge=ue==="original"?Me.value:Ae.value,He=ue==="original"?lt:ot;if(!ge)return;const Ee=ge.getBoundingClientRect(),Le=(q.clientX-Ee.left)/He.scale.value,Ve=(q.clientY-Ee.top)/He.scale.value;F.value=Le,h.value=Ve,d.value=!0,C.value=[Le,Ve,Le,Ve],document.addEventListener("mousemove",lo),document.addEventListener("mouseup",io)}function lo(q){if(!d.value)return;const ue=ao==="original"?Me.value:Ae.value,ge=ao==="original"?lt:ot;if(!ue)return;const He=ue.getBoundingClientRect(),Ee=(q.clientX-He.left)/ge.scale.value,Le=(q.clientY-He.top)/ge.scale.value;C.value=[Math.min(F.value,Ee),Math.min(h.value,Le),Math.max(F.value,Ee),Math.max(h.value,Le)]}function io(q){document.removeEventListener("mousemove",lo),document.removeEventListener("mouseup",io);const ue=$.value;if(!d.value||!C.value){d.value=!1,C.value=null,$.value=!1;return}const[ge,He,Ee,Le]=C.value,Ve=Ee-ge,Ue=Le-He;Ve>10&&Ue>10&&(u.addBubble(C.value),u.selectBubble(u.bubbleCount-1),console.log("å·²æ·»åŠ æ–°æ°”æ³¡:",C.value)),d.value=!1,C.value=null,$.value=!1,!ue&&g.value&&(g.value=!1)}function No(q){console.log(`${q} å›¾ç‰‡åŠ è½½å®Œæˆ`),q==="original"&&se(),Zt.value===1&&jn.value===0&&Jn.value===0&&mt(()=>{Et()})}function ls(){c()}function is(q){q.inpaintMethod!==void 0&&(W.value=q.inpaintMethod),q.fillColor!==void 0&&(re.value=q.fillColor),Pe.value>=0&&ae(q)}function rs(q){_e("æ–‡æœ¬å·²åº”ç”¨","success"),c()}function us(q){const ue=u.initialStates[q];if(!ue){console.warn(`æ— æ³•é‡ç½®æ°”æ³¡ #${q+1}ï¼šæ‰¾ä¸åˆ°åˆå§‹çŠ¶æ€`),_e("æ— æ³•é‡ç½®ï¼šæ‰¾ä¸åˆ°åˆå§‹çŠ¶æ€","warning");return}const ge=JSON.parse(JSON.stringify(ue));u.updateBubble(q,ge),console.log(`æ°”æ³¡ #${q+1} å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€`),_e("æ°”æ³¡å·²é‡ç½®","success"),c()}async function cs(q){tt.value=!0;try{await ie(q)}finally{tt.value=!1}}async function ds(){Xt.value=!0;try{await Q()}finally{Xt.value=!1}}async function gs(q){const ue=$e.value[q];if(!ue?.originalText){console.warn("æ— æ³•é‡æ–°ç¿»è¯‘ï¼šç¼ºå°‘æ°”æ³¡æˆ–åŸæ–‡");return}Gt.value=!0;try{console.log(`å¼€å§‹é‡æ–°ç¿»è¯‘æ°”æ³¡ #${q+1}`);const{translateSingleText:ge}=await it(async()=>{const{translateSingleText:Ue}=await Promise.resolve().then(()=>Zs);return{translateSingleText:Ue}},void 0),{useSettingsStore:He}=await it(async()=>{const{useSettingsStore:Ue}=await import("./system.CH8MZBkG.js").then(pt=>pt.s);return{useSettingsStore:Ue}},__vite__mapDeps([0,1,2,3,4,5])),Ee=He().settings,Le=Ee.translation.isJsonMode?Ee.translation.singleJsonPrompt:Ee.translation.singleNormalPrompt,Ve=await ge({original_text:ue.originalText,model_provider:Ee.translation.provider,api_key:Ee.translation.apiKey,model_name:Ee.translation.modelName,custom_base_url:Ee.translation.customBaseUrl,target_language:Ee.targetLanguage,prompt_content:Le,use_json_format:Ee.translation.isJsonMode,rpm_limit_translation:Ee.translation.rpmLimit,max_retries:Ee.translation.maxRetries});Ve.success&&Ve.data?.translated_text?(u.updateBubble(q,{translatedText:Ve.data.translated_text}),console.log(`ç¿»è¯‘æˆåŠŸ: "${Ve.data.translated_text}"`),c()):console.error("ç¿»è¯‘å¤±è´¥:",Ve.error||"æœªçŸ¥é”™è¯¯")}catch(ge){console.error("ç¿»è¯‘å‡ºé”™:",ge)}finally{Gt.value=!1}}function Vo(q,ue){for(q.bubbleTexts||(q.bubbleTexts=[]),q.originalTexts||(q.originalTexts=[]);q.bubbleTexts.length<ue;)q.bubbleTexts.push("");for(;q.originalTexts.length<ue;)q.originalTexts.push("")}function Wo(q,ue,ge){const He=q.auto_directions||[];return q.bubble_coords.map((Ee,Le)=>{const Ve=Ee[0]??0,Ue=Ee[1]??0,pt=Ee[2]??0,Ct=Ee[3]??0;let vt;return He[Le]?vt=He[Le]==="v"?"vertical":"horizontal":vt=Ct-Ue>pt-Ve?"vertical":"horizontal",{coords:Ee,originalText:ue.originalTexts?.[Le]||"",translatedText:ue.bubbleTexts?.[Le]||"",textboxText:"",fontSize:ge.fontSize,fontFamily:ge.fontFamily,textDirection:vt,autoTextDirection:vt,textColor:ge.textColor,fillColor:ge.fillColor,strokeEnabled:ge.strokeEnabled,strokeColor:ge.strokeColor,strokeWidth:ge.strokeWidth,rotationAngle:q.bubble_angles?.[Le]||0,inpaintMethod:ge.inpaintMethod,position:{x:0,y:0},polygon:[]}})}async function ps(){const q=Z.value;if(!q?.originalDataURL){_e("æ²¡æœ‰æœ‰æ•ˆçš„å›¾ç‰‡ç”¨äºæ£€æµ‹","warning");return}try{_e("æ­£åœ¨è‡ªåŠ¨æ£€æµ‹æ–‡æœ¬æ¡†...","info");const ge=q.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/)?.[1]||"";if(!ge){_e("æ— æ³•è§£æå›¾ç‰‡æ•°æ®","error");return}const He=Fe(),{textDetector:Ee,boxExpand:Le,textStyle:Ve}=He.settings,Ue=await bo(ge,Ee,{box_expand_ratio:Le.ratio,box_expand_top:Le.top,box_expand_bottom:Le.bottom,box_expand_left:Le.left,box_expand_right:Le.right});if(Ue.success&&Ue.bubble_coords){a.updateCurrentImage({bubbleCoords:Ue.bubble_coords,bubbleAngles:Ue.bubble_angles||[]}),Vo(q,Ue.bubble_coords.length);const pt={bubble_coords:Ue.bubble_coords.map(vt=>[...vt]),bubble_angles:Ue.bubble_angles,auto_directions:Ue.auto_directions},Ct=Wo(pt,q,Ve);u.setBubbles(Ct),oo(),_e(`è‡ªåŠ¨æ£€æµ‹åˆ° ${Ue.bubble_coords.length} ä¸ªæ–‡æœ¬æ¡†`,"success")}else _e(Ue.error||"æ£€æµ‹å¤±è´¥","error")}catch(ue){console.error("è‡ªåŠ¨æ£€æµ‹å¤±è´¥:",ue),_e("è‡ªåŠ¨æ£€æµ‹å¤±è´¥","error")}}async function ms(){if(ne.value.length<=1){_e("è‡³å°‘éœ€è¦ä¸¤å¼ å›¾ç‰‡æ‰èƒ½æ‰§è¡Œæ‰¹é‡æ£€æµ‹","warning");return}if(!confirm("æ­¤æ“ä½œå°†å¯¹æ‰€æœ‰å›¾ç‰‡è¿›è¡Œæ–‡æœ¬æ¡†æ£€æµ‹ï¼Œå¯èƒ½ä¼šè¦†ç›–å·²æœ‰çš„æ£€æµ‹ç»“æœã€‚ç¡®å®šç»§ç»­å—ï¼Ÿ"))return;const q=Fe(),{textDetector:ue,boxExpand:ge,textStyle:He}=q.settings,Ee=M.value,Le=ne.value.length;we.value=!0,Ke.value="æ‰¹é‡æ£€æµ‹ä¸­",yt.value=Le,rt.value=0;try{let Ve=0;for(let Ue=0;Ue<Le;Ue++){const pt=ne.value[Ue];if(!pt?.originalDataURL)continue;rt.value=Ue+1;const vt=pt.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/)?.[1]||"";if(!vt)continue;const ft=await bo(vt,ue,{box_expand_ratio:ge.ratio,box_expand_top:ge.top,box_expand_bottom:ge.bottom,box_expand_left:ge.left,box_expand_right:ge.right});if(ft.success&&ft.bubble_coords){const wt=ne.value[Ue];if(wt){wt.bubbleCoords=ft.bubble_coords,wt.bubbleAngles=ft.bubble_angles||[],Vo(wt,ft.bubble_coords.length);const ys={bubble_coords:ft.bubble_coords.map(_s=>[..._s]),bubble_angles:ft.bubble_angles,auto_directions:ft.auto_directions};wt.bubbleStates=Wo(ys,wt,He),Ve+=ft.bubble_coords.length,Ue===M.value&&Bt()}}}Ke.value="æ£€æµ‹å®Œæˆ",rt.value=Le,Ee!==M.value&&a.setCurrentImageIndex(Ee),Bt(),_e(`æ‰¹é‡æ£€æµ‹å®Œæˆï¼å…±å¤„ç† ${Le} å¼ å›¾ç‰‡ï¼Œæ£€æµ‹åˆ° ${Ve} ä¸ªæ–‡æœ¬æ¡†`,"success"),setTimeout(()=>{we.value=!1},2e3)}catch(Ve){console.error("æ‰¹é‡æ£€æµ‹å¤±è´¥:",Ve),_e("æ‰¹é‡æ£€æµ‹å¤±è´¥","error"),we.value=!1}}async function vs(){if(!Z.value?.originalDataURL){_e("æ²¡æœ‰æœ‰æ•ˆçš„å›¾ç‰‡ç”¨äºç¿»è¯‘","warning");return}if($e.value.length===0){_e("æ²¡æœ‰æ–‡æœ¬æ¡†å¯ç”¨äºç¿»è¯‘ï¼Œè¯·å…ˆæ£€æµ‹æˆ–æ·»åŠ æ–‡æœ¬æ¡†","warning");return}_e("æ­£åœ¨ä½¿ç”¨å½“å‰æ–‡æœ¬æ¡†ç¿»è¯‘...","info");try{await l()&&(_e("ç¿»è¯‘æˆåŠŸï¼","success"),oo())}catch(ue){console.error("ç¿»è¯‘å¤±è´¥:",ue),_e(`ç¿»è¯‘å¤±è´¥: ${ue instanceof Error?ue.message:"æœªçŸ¥é”™è¯¯"}`,"error")}}function fs(){I("repair")}function bs(){I("restore")}function Ko(q){X(q)}function qo(){r()}function hs(q){Qt.value=!0,Zn.value=Ie.value==="horizontal"?q.clientX:q.clientY,document.body.style.cursor=Ie.value==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",ro),document.addEventListener("mouseup",uo),q.preventDefault()}function ro(q){if(!Qt.value)return;const ue=xe.value?.parentElement?.parentElement;if(!ue)return;const ge=ue.getBoundingClientRect();if(Ie.value==="horizontal"){const He=q.clientX-ge.left,Ee=ge.width,Le=Math.max(20,Math.min(80,He/Ee*100)),Ve=ue.querySelector(".original-panel"),Ue=ue.querySelector(".translated-panel");Ve&&Ue&&(Ve.style.flex=`0 0 ${Le}%`,Ue.style.flex=`0 0 ${100-Le}%`)}else{const He=q.clientY-ge.top,Ee=ge.height,Le=Math.max(20,Math.min(80,He/Ee*100)),Ve=ue.querySelector(".original-panel"),Ue=ue.querySelector(".translated-panel");Ve&&Ue&&(Ve.style.flex=`0 0 ${Le}%`,Ue.style.flex=`0 0 ${100-Le}%`)}}function uo(){Qt.value=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",ro),document.removeEventListener("mouseup",uo)}function xs(q){eo.value=!0;const ue=ke.value;ue&&(Mt.value={x:q.clientX,y:q.clientY,size:Ie.value==="horizontal"?ue.offsetWidth:ue.offsetHeight},document.body.style.cursor=Ie.value==="horizontal"?"ew-resize":"ns-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",co),document.addEventListener("mouseup",go),q.preventDefault())}function co(q){if(!(!eo.value||!ke.value))if(Ie.value==="horizontal"){const ue=Mt.value.x-q.clientX;let ge=Mt.value.size+ue;ge=Math.max(300,Math.min(window.innerWidth*.6,ge)),ke.value.style.flex=`0 0 ${ge}px`,ke.value.style.minWidth=`${ge}px`}else{const ue=Mt.value.y-q.clientY;let ge=Mt.value.size+ue;ge=Math.max(200,Math.min(window.innerHeight*.5,ge)),ke.value.style.flex=`0 0 ${ge}px`,ke.value.style.height=`${ge}px`}}function go(){eo.value=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",co),document.removeEventListener("mouseup",go)}function Ho(q){const ue=q.target,ge=q.key.toLowerCase();if(ge==="r"||ge==="u"||ge==="a"||ge==="d"){if(ue.tagName==="TEXTAREA")return;(ue.tagName==="INPUT"||ue.tagName==="SELECT"||ue.tagName==="BUTTON")&&ue.blur()}else if(ue.tagName==="INPUT"||ue.tagName==="TEXTAREA"||ue.tagName==="SELECT")return;switch(q.key){case"Escape":Yo();break;case"Delete":case"Backspace":!m.value&&fe.value&&(U(),q.preventDefault());break;case"a":case"A":m.value||(Ao(),q.preventDefault());break;case"d":case"D":m.value||(no(),q.preventDefault());break;case"Enter":q.ctrlKey&&!m.value&&(Jo(),q.preventDefault());break;case"r":case"R":y.value||(I("repair"),q.preventDefault());break;case"u":case"U":y.value||(I("restore"),q.preventDefault());break;case"+":case"=":Mo(),q.preventDefault();break;case"-":Bo(),q.preventDefault();break;case"0":Eo(),q.preventDefault();break}}function jo(q){(q.key==="r"||q.key==="R"||q.key==="u"||q.key==="U")&&(E(),q.preventDefault())}async function Jo(){so(),await c(),ve.value?no():_e("å·²æ˜¯æœ€åä¸€å¼ å›¾ç‰‡","info")}function Yo(){so(),o("exit")}return Ms((q,ue,ge)=>{console.error("[EditWorkspace] æ•è·åˆ°é”™è¯¯:",q,ge);const He=q instanceof Error?q.message:"æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•";return _e(He,"error"),!1}),dt(()=>{try{const q=localStorage.getItem(nn);(q==="horizontal"||q==="vertical")&&(Ie.value=q)}catch(q){console.warn("åŠ è½½å¸ƒå±€æ¨¡å¼å¤±è´¥:",q)}document.addEventListener("keydown",Ho),document.addEventListener("keyup",jo),document.addEventListener("mousemove",Ko),document.addEventListener("mouseup",qo),s.isEditModeActive&&(Bt(),mt(()=>{he.value?.focus()}))}),zt(()=>{document.removeEventListener("keydown",Ho),document.removeEventListener("keyup",jo),document.removeEventListener("mousemove",Ko),document.removeEventListener("mouseup",qo),document.removeEventListener("mousemove",lo),document.removeEventListener("mouseup",io),document.removeEventListener("mousemove",ro),document.removeEventListener("mouseup",uo),document.removeEventListener("mousemove",co),document.removeEventListener("mouseup",go)}),Ce(()=>s.isEditModeActive,q=>{q&&(Bt(),mt(()=>{he.value?.focus(),se()}))}),Ce(M,()=>{s.isEditModeActive&&Bt()}),Ce(S,q=>{q&&(W.value=q.inpaintMethod||"solid",re.value=q.fillColor||"#FFFFFF")},{immediate:!0}),(q,ue)=>n.isEditModeActive?(B(),A("div",{key:0,class:De(["edit-workspace",[`layout-${Ie.value}`,{"drawing-mode":K(g)},{"brush-mode-active":!!K(m)}]]),"data-brush-mode":K(m)||void 0,tabindex:"0",ref_key:"workspaceRef",ref:he},[Se(qf,{"current-image-index":K(M),"image-count":K(de),"can-go-previous":K(me),"can-go-next":K(ve),"show-thumbnails":et.value,"has-bubbles":K(be),"selected-bubble-index":K(Pe),"bubble-count":K(Y),"layout-mode":Ie.value,"sync-enabled":qe.value,scale:Zt.value,"is-drawing-mode":K(g),"has-selection":K(fe),"brush-mode":K(m),"brush-size":K(i),"mouse-x":K(f),"mouse-y":K(v),"is-processing":we.value,"progress-text":Ke.value,"progress-current":rt.value,"progress-total":yt.value,"is-repair-loading":Xt.value,onGoPreviousImage:Ao,onGoNextImage:no,onToggleThumbnails:os,onSelectPreviousBubble:es,onSelectNextBubble:ts,onToggleLayout:ns,onToggleViewMode:ss,onToggleSync:as,onFitToScreen:Et,onZoomIn:Mo,onZoomOut:Bo,onResetZoom:Eo,onExitEditMode:Yo,onAutoDetectBubbles:ps,onDetectAllImages:ms,onTranslateWithBubbles:vs,onToggleDrawingMode:K(O),onDeleteSelectedBubbles:K(U),onRepairSelectedBubble:ds,onActivateRepairBrush:fs,onActivateRestoreBrush:bs,onApplyAndNext:Jo},null,8,["current-image-index","image-count","can-go-previous","can-go-next","show-thumbnails","has-bubbles","selected-bubble-index","bubble-count","layout-mode","sync-enabled","scale","is-drawing-mode","has-selection","brush-mode","brush-size","mouse-x","mouse-y","is-processing","progress-text","progress-current","progress-total","is-repair-loading","onToggleDrawingMode","onDeleteSelectedBubbles"]),Se(Zf,{visible:et.value,images:K(ne),"current-image-index":K(M),onSwitchToImage:Qn},null,8,["visible","images","current-image-index"]),e("div",eb,[e("div",tb,[oe(e("div",{class:De(["image-panel original-panel",{collapsed:Be.value==="translated"||at.value}])},[e("div",ob,[ue[8]||(ue[8]=e("span",{class:"panel-title"},"ğŸ“– åŸå›¾ (æ—¥æ–‡)",-1)),e("button",{class:"panel-toggle",onClick:ue[0]||(ue[0]=ge=>at.value=!at.value),title:"æŠ˜å /å±•å¼€"},te(at.value?"+":"âˆ’"),1)]),e("div",{ref_key:"originalViewportRef",ref:xe,class:"image-viewport",onWheel:ue[2]||(ue[2]=st(ge=>Lo(ge,"original"),["prevent"])),onMousedown:ue[3]||(ue[3]=ge=>Fo(ge,"original")),onDblclick:Et},[e("div",{ref_key:"originalWrapperRef",ref:Me,class:"image-canvas-wrapper",style:nt(Gn.value)},[K(Z)?.originalDataURL?(B(),A("img",{key:0,src:K(Z).originalDataURL,alt:"åŸå›¾",onLoad:ue[1]||(ue[1]=ge=>No("original"))},null,40,nb)):ce("",!0),K(Z)?.originalDataURL?(B(),ut(hn,{key:1,bubbles:K($e),"selected-index":K(Pe),"selected-indices":K(le),scale:Yn.value,"is-drawing-mode":K(g),"is-brush-mode":!!K(m),"image-width":ye.value,"image-height":V.value,onSelect:K(P),onMultiSelect:K(R),onDragStart:K(D),onDragging:K(j),onDragEnd:K(z),onResizeStart:K(L),onResizing:K(b),onResizeEnd:K(p),onRotateStart:K(T),onRotating:K(k),onRotateEnd:K(N),onDrawBubble:K(ee)},null,8,["bubbles","selected-index","selected-indices","scale","is-drawing-mode","is-brush-mode","image-width","image-height","onSelect","onMultiSelect","onDragStart","onDragging","onDragEnd","onResizeStart","onResizing","onResizeEnd","onRotateStart","onRotating","onRotateEnd","onDrawBubble"])):ce("",!0),K(C)?(B(),A("div",{key:2,class:"drawing-rect-edit",style:nt(K(J)())},null,4)):ce("",!0)],4)],544)],2),[[Oe,Be.value!=="translated"]]),Be.value==="dual"?(B(),A("div",{key:0,class:De(["panel-divider",{"vertical-divider":Ie.value==="vertical"}]),onMousedown:hs},null,34)):ce("",!0),oe(e("div",{class:De(["image-panel translated-panel",{collapsed:Be.value==="original"||Te.value}])},[e("div",sb,[ue[9]||(ue[9]=e("span",{class:"panel-title"},"ğŸ“ ç¿»è¯‘å›¾ (ä¸­æ–‡)",-1)),e("button",{class:"panel-toggle",onClick:ue[4]||(ue[4]=ge=>Te.value=!Te.value),title:"æŠ˜å /å±•å¼€"},te(Te.value?"+":"âˆ’"),1)]),e("div",{ref_key:"translatedViewportRef",ref:Ne,class:"image-viewport",onWheel:ue[6]||(ue[6]=st(ge=>Lo(ge,"translated"),["prevent"])),onMousedown:ue[7]||(ue[7]=ge=>Fo(ge,"translated")),onDblclick:Et},[e("div",{ref_key:"translatedWrapperRef",ref:Ae,class:"image-canvas-wrapper",style:nt(Xn.value)},[K(Z)?.translatedDataURL||K(Z)?.originalDataURL?(B(),A("img",{key:0,src:K(Z)?.translatedDataURL||K(Z)?.originalDataURL,alt:"ç¿»è¯‘å›¾",onLoad:ue[5]||(ue[5]=ge=>No("translated"))},null,40,ab)):ce("",!0),K(Z)?.translatedDataURL||K(Z)?.originalDataURL?(B(),ut(hn,{key:1,bubbles:K($e),"selected-index":K(Pe),"selected-indices":K(le),scale:Zt.value,"is-drawing-mode":K(g),"is-brush-mode":!!K(m),"image-width":ye.value,"image-height":V.value,onSelect:K(P),onMultiSelect:K(R),onDragStart:K(D),onDragging:K(j),onDragEnd:K(z),onResizeStart:K(L),onResizing:K(b),onResizeEnd:K(p),onRotateStart:K(T),onRotating:K(k),onRotateEnd:K(N),onDrawBubble:K(ee)},null,8,["bubbles","selected-index","selected-indices","scale","is-drawing-mode","is-brush-mode","image-width","image-height","onSelect","onMultiSelect","onDragStart","onDragging","onDragEnd","onResizeStart","onResizing","onResizeEnd","onRotateStart","onRotating","onRotateEnd","onDrawBubble"])):ce("",!0),K(C)?(B(),A("div",{key:2,class:"drawing-rect-edit translated-drawing-rect",style:nt(K(J)())},null,4)):ce("",!0)],4)],544)],2),[[Oe,Be.value!=="original"]])]),e("div",{ref_key:"editPanelRef",ref:ke,class:"edit-panel-container"},[e("div",{class:"panel-resize-handle vertical",onMousedown:xs}," â‹®â‹®â‹® ",32),Se(bf,{bubble:K(S),"bubble-index":K(Pe),"is-ocr-loading":tt.value,"is-translate-loading":Gt.value,onUpdate:is,onReRender:ls,onOcrRecognize:cs,onReTranslate:gs,onApplyBubble:rs,onResetCurrent:us},null,8,["bubble","bubble-index","is-ocr-loading","is-translate-loading"])],512)])],10,Qf)):ce("",!0)}}),ib=Je(lb,[["__scopeId","data-v-b2d871b9"]]),Dt="/api/web-import";async function rb(n){return(await fetch(`${Dt}/check-support?url=${encodeURIComponent(n)}`)).json()}async function ub(){return(await fetch(`${Dt}/gallery-dl-images`)).json()}async function cb(n,t,s,o,a,u="auto",l){const c=await fetch(`${Dt}/extract`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:n,config:t,engine:u})});if(!c.ok){const $=await c.json().catch(()=>({error:"è¯·æ±‚å¤±è´¥"}));a($.error||`HTTP ${c.status}`);return}const g=c.body?.getReader();if(!g){a("æ— æ³•è¯»å–å“åº”æµ");return}const d=new TextDecoder;let C="";try{for(;;){const{done:$,value:P}=await g.read();if($)break;C+=d.decode(P,{stream:!0});const R=C.split(`
`);C=R.pop()||"";let _="",D="";for(const j of R)if(j.startsWith("event:"))_=j.slice(6).trim();else if(j.startsWith("data:"))D=j.slice(5).trim();else if(j===""&&_&&D){try{const z=JSON.parse(D);_==="log"?s(z):_==="page"?l&&l(z):_==="result"?o(z):_==="error"&&a(z.error||"æœªçŸ¥é”™è¯¯")}catch(z){console.error("è§£æ SSE æ•°æ®å¤±è´¥:",z)}_="",D=""}}}finally{g.releaseLock()}}async function db(n,t,s,o="ai-agent"){const a=await fetch(`${Dt}/download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pages:n,sourceUrl:t,config:s,engine:o})});if(!a.ok){const u=await a.json().catch(()=>({error:"è¯·æ±‚å¤±è´¥"}));throw new Error(u.error||`HTTP ${a.status}`)}return a.json()}async function gb(n){return(await fetch(`${Dt}/test-firecrawl`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:n})})).json()}async function pb(n,t,s,o){return(await fetch(`${Dt}/test-agent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:n,apiKey:t,customBaseUrl:s,modelName:o})})).json()}const mb={class:"modal-container"},vb={class:"modal-body"},fb={class:"url-section"},bb=["disabled"],hb=["disabled"],xb=["disabled"],yb={key:0,class:"loading-spinner"},_b={key:1},Cb={key:0,class:"engine-hint"},Sb={key:0,class:"hint-checking"},kb={key:1,class:"hint-supported"},wb={key:2,class:"hint-unsupported"},$b={class:"settings-section"},Tb={class:"settings-toggle"},Ib={key:0,class:"settings-content"},Pb={class:"settings-tabs"},Rb={class:"settings-tab-content"},Db={class:"settings-group"},Mb={class:"form-row"},Bb={class:"input-group"},Eb=["type","value"],Ab=["disabled"],Lb={class:"settings-group"},Fb={class:"form-row"},Ub=["value"],Ob=["value"],zb={class:"form-row"},Nb={class:"input-group"},Vb=["type","value"],Wb={key:0,class:"form-row"},Kb=["value"],qb={class:"form-row"},Hb=["value"],jb={class:"form-row inline"},Jb={class:"checkbox-label"},Yb=["checked"],Gb={class:"checkbox-label"},Xb=["checked"],Zb={class:"form-row"},Qb=["disabled"],eh={class:"settings-group"},th={class:"form-row"},oh=["value"],nh={class:"form-row"},sh=["value"],ah={class:"settings-group"},lh={class:"form-grid"},ih={class:"form-row"},rh=["value"],uh={class:"form-row"},ch=["value"],dh={class:"form-row"},gh=["value"],ph={class:"form-row"},mh=["value"],vh={class:"form-row"},fh={class:"checkbox-label"},bh=["checked"],hh={class:"settings-group"},xh={class:"form-row inline"},yh={class:"checkbox-label"},_h=["checked"],Ch={class:"checkbox-label"},Sh=["checked"],kh={class:"settings-tab-content"},wh={class:"settings-group"},$h={class:"form-row"},Th={class:"checkbox-label"},Ih=["checked"],Ph={class:"form-row"},Rh={class:"checkbox-label"},Dh=["checked"],Mh={class:"form-row"},Bh={class:"checkbox-label"},Eh=["checked"],Ah={key:0,class:"form-grid"},Lh={class:"form-row"},Fh=["value"],Uh={class:"form-row"},Oh=["value"],zh={class:"form-row"},Nh=["value"],Vh={class:"form-row"},Wh={class:"checkbox-label"},Kh=["checked"],qh={key:1,class:"form-row"},Hh=["value"],jh={class:"settings-tab-content"},Jh={class:"settings-group"},Yh={class:"form-row"},Gh=["value"],Xh={class:"form-row"},Zh=["value"],Qh={class:"form-row"},ex={class:"checkbox-label"},tx=["checked"],ox={key:1,class:"logs-section"},nx={class:"logs-toggle"},sx={key:0,class:"extracting-hint"},ax={key:0,class:"logs-content"},lx={class:"log-time"},ix={class:"log-message"},rx={key:2,class:"error-section"},ux={class:"error-message"},cx={key:3,class:"result-section"},dx={class:"result-header"},gx={class:"result-title"},px={class:"result-meta"},mx={class:"result-count"},vx={key:0,class:"result-engine"},fx={class:"select-control"},bx={class:"select-all"},hx=["checked"],xx={class:"selected-count"},yx={class:"image-grid"},_x=["onClick"],Cx={class:"image-checkbox"},Sx=["checked","onChange"],kx={class:"image-preview"},wx=["src","alt"],$x={class:"image-label"},Tx={key:4,class:"progress-section"},Ix={class:"progress-label"},Px={class:"progress-bar"},Rx={class:"modal-footer"},Dx=["disabled"],Mx=["disabled"],Bx={key:0,class:"loading-spinner"},Ex={key:1},Ax=Ye({__name:"WebImportModal",setup(n){const t=wo(),s=Qe(),o=w(""),a=w(!0),u=w("auto"),l=w(!1),c=w(!1),g=w(!1),d=w(!1),C=w("basic"),$=w(!1),P=w(!1),R=w(!1),_=w(!1),D=G(()=>t.modalVisible),j=G(()=>t.status),z=G(()=>t.logs),L=G(()=>t.extractResult),b=G(()=>t.selectedPages),p=G(()=>t.selectedCount),T=G(()=>t.downloadProgress),k=G(()=>t.downloadProgressPercent),N=G(()=>t.error),O=G(()=>t.isProcessing),ee=G(()=>t.settings.ui.showAgentLogs),J=G(()=>L.value?.engine||null),ae=G(()=>{switch(J.value){case"gallery-dl":return"Gallery-DL";case"ai-agent":return"AI Agent";default:return""}}),U=G(()=>L.value?.pages?p.value===L.value.pages.length:!1);function Q(X){return J.value==="gallery-dl",X}let ie=null;async function F(X){if(ie&&clearTimeout(ie),!X.trim()){l.value=!1,c.value=!1;return}ie=setTimeout(async()=>{g.value=!0;try{const r=await rb(X);l.value=r.available,c.value=r.supported}catch{l.value=!1,c.value=!1}finally{g.value=!1}},500)}function h(){O.value&&!confirm("æ­£åœ¨å¤„ç†ä¸­ï¼Œç¡®å®šè¦å…³é—­å—ï¼Ÿ")||(t.closeModal(),t.resetState(),o.value="")}async function m(){const X=o.value.trim();if(!X){alert("è¯·è¾“å…¥ç½‘å€");return}try{new URL(X)}catch{alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€");return}t.resetState(),t.setUrl(X),t.setStatus("extracting");try{await cb(X,t.settings,r=>{t.addLog(r)},r=>{t.setExtractResult(r),r.success?t.setStatus("extracted"):t.setError(r.error||"æå–å¤±è´¥")},r=>{t.setError(r)},u.value,r=>{t.addPageIncremental(r)})}catch(r){t.setError(r instanceof Error?r.message:"æå–å¤±è´¥")}}function i(X){t.togglePageSelection(X)}function f(){t.toggleSelectAll()}async function v(){if(!L.value?.pages||p.value===0){alert("è¯·é€‰æ‹©è¦å¯¼å…¥çš„å›¾ç‰‡");return}const X=L.value.pages.filter(x=>b.value.has(x.pageNumber));t.setStatus("downloading"),t.updateDownloadProgress(0,X.length);const r=J.value||"ai-agent";try{if(r==="gallery-dl"){const ne=await ub();if(ne.success&&ne.images.length>0){let M=0;const Z=Math.min(ne.images.length,X.length);for(let de=0;de<Z;de++){const me=ne.images[de];me&&me.filename&&me.data&&(s.addImage(me.filename,me.data),M++,t.updateDownloadProgress(M,Z))}t.setStatus("completed"),alert(`æˆåŠŸå¯¼å…¥ ${M} å¼ å›¾ç‰‡`),h();return}else throw new Error(ne.error||"è·å–å›¾ç‰‡å¤±è´¥")}const x=await db(X,L.value.sourceUrl,t.settings,r);if(x.success&&x.images.length>0){t.setDownloadedImages(x.images),t.updateDownloadProgress(x.images.length,X.length);for(const M of x.images)s.addImage(M.filename,M.dataUrl);t.setStatus("completed");const ne=x.failedCount>0?`ï¼Œ${x.failedCount} å¼ å¤±è´¥`:"";alert(`æˆåŠŸå¯¼å…¥ ${x.images.length} å¼ å›¾ç‰‡${ne}`),h()}else t.setError(x.error||"ä¸‹è½½å¤±è´¥")}catch(x){t.setError(x instanceof Error?x.message:"ä¸‹è½½å¤±è´¥")}}Ce(D,X=>{X&&setTimeout(()=>{document.querySelector(".url-input")?.focus()},100)}),Ce(o,X=>{F(X)});const y=G(()=>t.settings.agent.provider==="custom_openai");async function I(){if(!t.settings.firecrawl.apiKey){alert("è¯·è¾“å…¥ Firecrawl API Key");return}$.value=!0;try{const X=await gb(t.settings.firecrawl.apiKey);X.success?alert("âœ… Firecrawl è¿æ¥æˆåŠŸ"):alert(`âŒ è¿æ¥å¤±è´¥: ${X.error}`)}catch(X){alert(`âŒ è¿æ¥å¤±è´¥: ${X instanceof Error?X.message:"æœªçŸ¥é”™è¯¯"}`)}finally{$.value=!1}}async function E(){if(!t.settings.agent.apiKey){alert("è¯·è¾“å…¥ AI Agent API Key");return}P.value=!0;try{const X=await pb(t.settings.agent.provider,t.settings.agent.apiKey,t.settings.agent.customBaseUrl,t.settings.agent.modelName);X.success?alert("âœ… AI Agent è¿æ¥æˆåŠŸ"):alert(`âŒ è¿æ¥å¤±è´¥: ${X.error}`)}catch(X){alert(`âŒ è¿æ¥å¤±è´¥: ${X instanceof Error?X.message:"æœªçŸ¥é”™è¯¯"}`)}finally{P.value=!1}}function H(){confirm("ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯å—ï¼Ÿ")&&t.resetExtractionPrompt()}return(X,r)=>(B(),ut(Sn,{to:"body"},[D.value?(B(),A("div",{key:0,class:"modal-overlay",onClick:st(h,["self"])},[e("div",mb,[e("div",{class:"modal-header"},[r[37]||(r[37]=e("h2",{class:"modal-title"},[e("span",{class:"title-icon"},"ğŸŒ"),pe(" ä»ç½‘é¡µå¯¼å…¥æ¼«ç”» ")],-1)),e("button",{class:"close-btn",onClick:h,title:"å…³é—­"},"Ã—")]),e("div",vb,[e("div",fb,[oe(e("input",{"onUpdate:modelValue":r[0]||(r[0]=x=>o.value=x),type:"url",class:"url-input",placeholder:"è¾“å…¥æ¼«ç”»ç½‘é¡µ URLï¼Œå¦‚ https://example.com/chapter-1",disabled:O.value,onKeyup:Cn(m,["enter"])},null,40,bb),[[Re,o.value]]),oe(e("select",{"onUpdate:modelValue":r[1]||(r[1]=x=>u.value=x),class:"engine-select",disabled:O.value},[...r[38]||(r[38]=[e("option",{value:"auto"},"è‡ªåŠ¨é€‰æ‹©",-1),e("option",{value:"gallery-dl"},"Gallery-DL",-1),e("option",{value:"ai-agent"},"AI Agent",-1)])],8,hb),[[Bs,u.value]]),e("button",{class:"extract-btn",disabled:O.value||!o.value.trim(),onClick:m},[j.value==="extracting"?(B(),A("span",yb)):(B(),A("span",_b,"ğŸ”")),pe(" "+te(j.value==="extracting"?"æå–ä¸­...":"å¼€å§‹æå–"),1)],8,xb)]),o.value.trim()&&!O.value?(B(),A("div",Cb,[g.value?(B(),A("span",Sb,"æ£€æŸ¥ä¸­...")):c.value?(B(),A("span",kb,"âœ“ è¯¥ç½‘ç«™æ”¯æŒ Gallery-DL é«˜é€Ÿä¸‹è½½")):l.value?(B(),A("span",wb,"è¯¥ç½‘ç«™å°†ä½¿ç”¨ AI Agent æ¨¡å¼")):ce("",!0)])):ce("",!0),r[80]||(r[80]=e("div",{class:"notice"}," âš ï¸ è¯·ä»…çˆ¬å–æ‚¨æœ‰æƒè®¿é—®çš„å†…å®¹ï¼Œå¹¶éµå®ˆç›®æ ‡ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾ã€‚ ",-1)),e("div",$b,[e("div",{class:"settings-header",onClick:r[2]||(r[2]=x=>d.value=!d.value)},[e("span",Tb,te(d.value?"â–¼":"â–¶"),1),r[39]||(r[39]=e("span",{class:"settings-title"},"âš™ï¸ è®¾ç½®",-1)),r[40]||(r[40]=e("span",{class:"settings-hint"},"ç‚¹å‡»å±•å¼€é…ç½®",-1))]),d.value?(B(),A("div",Ib,[e("div",Pb,[e("button",{class:De(["settings-tab",{active:C.value==="basic"}]),onClick:r[3]||(r[3]=x=>C.value="basic")}," åŸºæœ¬è®¾ç½® ",2),e("button",{class:De(["settings-tab",{active:C.value==="preprocess"}]),onClick:r[4]||(r[4]=x=>C.value="preprocess")}," å›¾ç‰‡é¢„å¤„ç† ",2),e("button",{class:De(["settings-tab",{active:C.value==="advanced"}]),onClick:r[5]||(r[5]=x=>C.value="advanced")}," é«˜çº§è®¾ç½® ",2)]),oe(e("div",Rb,[e("div",Db,[r[42]||(r[42]=e("h4",{class:"group-title"},"Firecrawl é…ç½®",-1)),e("div",Mb,[r[41]||(r[41]=e("label",{class:"form-label"},"API Key",-1)),e("div",Bb,[e("input",{type:R.value?"text":"password",class:"form-input",value:K(t).settings.firecrawl.apiKey,onInput:r[6]||(r[6]=x=>K(t).setFirecrawlApiKey(x.target.value)),placeholder:"fc-xxxxxxxxxxxxxxxx"},null,40,Eb),e("button",{class:"toggle-btn",onClick:r[7]||(r[7]=x=>R.value=!R.value)},te(R.value?"ğŸ‘":"ğŸ‘â€ğŸ—¨"),1),e("button",{class:"test-btn",disabled:$.value||!K(t).settings.firecrawl.apiKey,onClick:I},te($.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,Ab)])])]),e("div",Lb,[r[49]||(r[49]=e("h4",{class:"group-title"},"AI Agent é…ç½®",-1)),e("div",Fb,[r[43]||(r[43]=e("label",{class:"form-label"},"æœåŠ¡å•†",-1)),e("select",{class:"form-select",value:K(t).settings.agent.provider,onChange:r[8]||(r[8]=x=>K(t).setAgentProvider(x.target.value))},[(B(!0),A(ze,null,Ge(K(Rs),x=>(B(),A("option",{key:x.value,value:x.value},te(x.label),9,Ob))),128))],40,Ub)]),e("div",zb,[r[44]||(r[44]=e("label",{class:"form-label"},"API Key",-1)),e("div",Nb,[e("input",{type:_.value?"text":"password",class:"form-input",value:K(t).settings.agent.apiKey,onInput:r[9]||(r[9]=x=>K(t).setAgentApiKey(x.target.value)),placeholder:"sk-xxxxxxxxxxxxxxxx"},null,40,Vb),e("button",{class:"toggle-btn",onClick:r[10]||(r[10]=x=>_.value=!_.value)},te(_.value?"ğŸ‘":"ğŸ‘â€ğŸ—¨"),1)])]),y.value?(B(),A("div",Wb,[r[45]||(r[45]=e("label",{class:"form-label"},"è‡ªå®šä¹‰ API åœ°å€",-1)),e("input",{type:"url",class:"form-input",value:K(t).settings.agent.customBaseUrl,onInput:r[11]||(r[11]=x=>K(t).setAgentBaseUrl(x.target.value)),placeholder:"https://api.example.com/v1"},null,40,Kb)])):ce("",!0),e("div",qb,[r[46]||(r[46]=e("label",{class:"form-label"},"æ¨¡å‹åç§°",-1)),e("input",{type:"text",class:"form-input",value:K(t).settings.agent.modelName,onInput:r[12]||(r[12]=x=>K(t).setAgentModelName(x.target.value)),placeholder:"gpt-4o-mini"},null,40,Hb)]),e("div",jb,[e("label",Jb,[e("input",{type:"checkbox",checked:K(t).settings.agent.forceJsonOutput,onChange:r[13]||(r[13]=x=>K(t).setAgentForceJson(x.target.checked))},null,40,Yb),r[47]||(r[47]=pe(" å¼ºåˆ¶ JSON æ ¼å¼ ",-1))]),e("label",Gb,[e("input",{type:"checkbox",checked:K(t).settings.agent.useStream,onChange:r[14]||(r[14]=x=>K(t).setAgentUseStream(x.target.checked))},null,40,Xb),r[48]||(r[48]=pe(" æµå¼è°ƒç”¨ ",-1))])]),e("div",Zb,[e("button",{class:"test-btn full",disabled:P.value||!K(t).settings.agent.apiKey,onClick:E},te(P.value?"æµ‹è¯•ä¸­...":"æµ‹è¯• Agent è¿æ¥"),9,Qb)])]),e("div",eh,[e("h4",{class:"group-title"},[r[50]||(r[50]=pe(" æå–è®¾ç½® ",-1)),e("button",{class:"reset-btn",onClick:H},"é‡ç½®ä¸ºé»˜è®¤")]),e("div",th,[r[51]||(r[51]=e("label",{class:"form-label"},"æå–æç¤ºè¯",-1)),e("textarea",{class:"form-textarea",value:K(t).settings.extraction.prompt,onInput:r[15]||(r[15]=x=>K(t).setExtractionPrompt(x.target.value)),rows:"6",placeholder:"è¾“å…¥æå–æç¤ºè¯..."},null,40,oh)]),e("div",nh,[r[52]||(r[52]=e("label",{class:"form-label"},"æœ€å¤§è¿­ä»£æ¬¡æ•°",-1)),e("input",{type:"number",class:"form-input small",value:K(t).settings.extraction.maxIterations,onInput:r[16]||(r[16]=x=>K(t).setExtractionMaxIterations(Number(x.target.value))),min:"1",max:"20"},null,40,sh)])]),e("div",ah,[r[58]||(r[58]=e("h4",{class:"group-title"},"ä¸‹è½½è®¾ç½®",-1)),e("div",lh,[e("div",ih,[r[53]||(r[53]=e("label",{class:"form-label"},"å¹¶å‘æ•°",-1)),e("input",{type:"number",class:"form-input small",value:K(t).settings.download.concurrency,onInput:r[17]||(r[17]=x=>K(t).setDownloadConcurrency(Number(x.target.value))),min:"1",max:"10"},null,40,rh)]),e("div",uh,[r[54]||(r[54]=e("label",{class:"form-label"},"è¶…æ—¶ (ç§’)",-1)),e("input",{type:"number",class:"form-input small",value:K(t).settings.download.timeout,onInput:r[18]||(r[18]=x=>K(t).setDownloadTimeout(Number(x.target.value))),min:"5",max:"120"},null,40,ch)]),e("div",dh,[r[55]||(r[55]=e("label",{class:"form-label"},"é‡è¯•æ¬¡æ•°",-1)),e("input",{type:"number",class:"form-input small",value:K(t).settings.download.retries,onInput:r[19]||(r[19]=x=>K(t).setDownloadRetries(Number(x.target.value))),min:"0",max:"5"},null,40,gh)]),e("div",ph,[r[56]||(r[56]=e("label",{class:"form-label"},"ä¸‹è½½é—´éš” (ms)",-1)),e("input",{type:"number",class:"form-input small",value:K(t).settings.download.delay,onInput:r[20]||(r[20]=x=>K(t).setDownloadDelay(Number(x.target.value))),min:"0",max:"2000",step:"100"},null,40,mh)])]),e("div",vh,[e("label",fh,[e("input",{type:"checkbox",checked:K(t).settings.download.useReferer,onChange:r[21]||(r[21]=x=>K(t).setDownloadUseReferer(x.target.checked))},null,40,bh),r[57]||(r[57]=pe(" è‡ªåŠ¨æ·»åŠ  Referer ",-1))])])]),e("div",hh,[r[61]||(r[61]=e("h4",{class:"group-title"},"ç•Œé¢è®¾ç½®",-1)),e("div",xh,[e("label",yh,[e("input",{type:"checkbox",checked:K(t).settings.ui.showAgentLogs,onChange:r[22]||(r[22]=x=>K(t).setShowAgentLogs(x.target.checked))},null,40,_h),r[59]||(r[59]=pe(" æ˜¾ç¤º AI å·¥ä½œæ—¥å¿— ",-1))]),e("label",Ch,[e("input",{type:"checkbox",checked:K(t).settings.ui.autoImport,onChange:r[23]||(r[23]=x=>K(t).setAutoImport(x.target.checked))},null,40,Sh),r[60]||(r[60]=pe(" æå–åè‡ªåŠ¨å¯¼å…¥ ",-1))])])])],512),[[Oe,C.value==="basic"]]),oe(e("div",kh,[e("div",wh,[e("div",$h,[e("label",Th,[e("input",{type:"checkbox",checked:K(t).settings.imagePreprocess.enabled,onChange:r[24]||(r[24]=x=>K(t).setImagePreprocessEnabled(x.target.checked))},null,40,Ih),r[62]||(r[62]=pe(" å¯ç”¨å›¾ç‰‡é¢„å¤„ç† ",-1))])]),K(t).settings.imagePreprocess.enabled?(B(),A(ze,{key:0},[e("div",Ph,[e("label",Rh,[e("input",{type:"checkbox",checked:K(t).settings.imagePreprocess.autoRotate,onChange:r[25]||(r[25]=x=>K(t).setImageAutoRotate(x.target.checked))},null,40,Dh),r[63]||(r[63]=pe(" æ ¹æ® EXIF è‡ªåŠ¨æ—‹è½¬ ",-1))])]),r[71]||(r[71]=e("h5",{class:"subsection-title"},"å‹ç¼©è®¾ç½®",-1)),e("div",Mh,[e("label",Bh,[e("input",{type:"checkbox",checked:K(t).settings.imagePreprocess.compression.enabled,onChange:r[26]||(r[26]=x=>K(t).setImageCompressionEnabled(x.target.checked))},null,40,Eh),r[64]||(r[64]=pe(" å¯ç”¨å‹ç¼© ",-1))])]),K(t).settings.imagePreprocess.compression.enabled?(B(),A("div",Ah,[e("div",Lh,[r[65]||(r[65]=e("label",{class:"form-label"},"è´¨é‡ (0-100)",-1)),e("input",{type:"number",class:"form-input small",value:K(t).settings.imagePreprocess.compression.quality,onInput:r[27]||(r[27]=x=>K(t).setImageCompressionQuality(Number(x.target.value))),min:"1",max:"100"},null,40,Fh)]),e("div",Uh,[r[66]||(r[66]=e("label",{class:"form-label"},"æœ€å¤§å®½åº¦ (0=ä¸é™)",-1)),e("input",{type:"number",class:"form-input small",value:K(t).settings.imagePreprocess.compression.maxWidth,onInput:r[28]||(r[28]=x=>K(t).setImageMaxWidth(Number(x.target.value))),min:"0"},null,40,Oh)]),e("div",zh,[r[67]||(r[67]=e("label",{class:"form-label"},"æœ€å¤§é«˜åº¦ (0=ä¸é™)",-1)),e("input",{type:"number",class:"form-input small",value:K(t).settings.imagePreprocess.compression.maxHeight,onInput:r[29]||(r[29]=x=>K(t).setImageMaxHeight(Number(x.target.value))),min:"0"},null,40,Nh)])])):ce("",!0),r[72]||(r[72]=e("h5",{class:"subsection-title"},"æ ¼å¼è½¬æ¢",-1)),e("div",Vh,[e("label",Wh,[e("input",{type:"checkbox",checked:K(t).settings.imagePreprocess.formatConvert.enabled,onChange:r[30]||(r[30]=x=>K(t).setImageFormatConvertEnabled(x.target.checked))},null,40,Kh),r[68]||(r[68]=pe(" å¯ç”¨æ ¼å¼è½¬æ¢ ",-1))])]),K(t).settings.imagePreprocess.formatConvert.enabled?(B(),A("div",qh,[r[70]||(r[70]=e("label",{class:"form-label"},"ç›®æ ‡æ ¼å¼",-1)),e("select",{class:"form-select",value:K(t).settings.imagePreprocess.formatConvert.targetFormat,onChange:r[31]||(r[31]=x=>K(t).setImageTargetFormat(x.target.value))},[...r[69]||(r[69]=[e("option",{value:"original"},"ä¿æŒåŸæ ¼å¼",-1),e("option",{value:"jpeg"},"JPEG",-1),e("option",{value:"png"},"PNG",-1),e("option",{value:"webp"},"WebP",-1)])],40,Hh)])):ce("",!0)],64)):ce("",!0)])],512),[[Oe,C.value==="preprocess"]]),oe(e("div",jh,[e("div",Jh,[r[76]||(r[76]=e("h4",{class:"group-title"},"è‡ªå®šä¹‰è¯·æ±‚å¤´",-1)),e("div",Yh,[r[73]||(r[73]=e("label",{class:"form-label"},"Cookie",-1)),e("input",{type:"text",class:"form-input",value:K(t).settings.advanced.customCookie,onInput:r[32]||(r[32]=x=>K(t).setCustomCookie(x.target.value)),placeholder:"name=value; name2=value2"},null,40,Gh)]),e("div",Xh,[r[74]||(r[74]=e("label",{class:"form-label"},"Headers (JSON)",-1)),e("textarea",{class:"form-textarea",value:K(t).settings.advanced.customHeaders,onInput:r[33]||(r[33]=x=>K(t).setCustomHeaders(x.target.value)),rows:"3",placeholder:'{"X-Custom-Header": "value"}'},null,40,Zh)]),e("div",Qh,[e("label",ex,[e("input",{type:"checkbox",checked:K(t).settings.advanced.bypassProxy,onChange:r[34]||(r[34]=x=>K(t).setBypassProxy(x.target.checked))},null,40,tx),r[75]||(r[75]=pe(" ç»•è¿‡ç³»ç»Ÿä»£ç† (è¿æ¥æœ¬åœ°æœåŠ¡æ—¶ä½¿ç”¨) ",-1))])])])],512),[[Oe,C.value==="advanced"]])])):ce("",!0)]),ee.value&&z.value.length>0?(B(),A("div",ox,[e("div",{class:"logs-header",onClick:r[35]||(r[35]=x=>a.value=!a.value)},[e("span",nx,te(a.value?"â–¼":"â–¶"),1),r[77]||(r[77]=e("span",null,"AI å·¥ä½œæ—¥å¿—",-1)),j.value==="extracting"?(B(),A("span",sx,"(æå–ä¸­...)")):ce("",!0)]),a.value?(B(),A("div",ax,[(B(!0),A(ze,null,Ge(z.value,(x,ne)=>(B(),A("div",{key:ne,class:De(["log-item",`log-${x.type}`])},[e("span",lx,"["+te(x.timestamp)+"]",1),e("span",ix,te(x.message),1)],2))),128))])):ce("",!0)])):ce("",!0),N.value?(B(),A("div",rx,[r[78]||(r[78]=e("span",{class:"error-icon"},"âŒ",-1)),e("span",ux,te(N.value),1)])):ce("",!0),L.value?.success?(B(),A("div",cx,[e("div",dx,[e("span",gx," ğŸ“– ã€Š"+te(L.value.comicTitle)+"ã€‹- "+te(L.value.chapterTitle),1),e("span",px,[e("span",mx,"å…± "+te(L.value.totalPages)+" å¼ ",1),ae.value?(B(),A("span",vx,"| å¼•æ“: "+te(ae.value),1)):ce("",!0)])]),e("div",fx,[e("label",bx,[e("input",{type:"checkbox",checked:U.value,onChange:f},null,40,hx),r[79]||(r[79]=pe(" å…¨é€‰ ",-1))]),e("span",xx,"å·²é€‰: "+te(p.value)+" å¼ ",1)]),e("div",yx,[(B(!0),A(ze,null,Ge(L.value.pages,x=>(B(),A("div",{key:x.pageNumber,class:De(["image-item",{selected:b.value.has(x.pageNumber)}]),onClick:ne=>i(x.pageNumber)},[e("div",Cx,[e("input",{type:"checkbox",checked:b.value.has(x.pageNumber),onClick:r[36]||(r[36]=st(()=>{},["stop"])),onChange:ne=>i(x.pageNumber)},null,40,Sx)]),e("div",kx,[e("img",{src:Q(x.imageUrl),alt:`ç¬¬${x.pageNumber}é¡µ`,loading:"lazy"},null,8,wx)]),e("div",$x,"ç¬¬ "+te(x.pageNumber)+" é¡µ",1)],10,_x))),128))])])):ce("",!0),j.value==="downloading"?(B(),A("div",Tx,[e("div",Ix," ä¸‹è½½è¿›åº¦: "+te(T.value.current)+"/"+te(T.value.total),1),e("div",Px,[e("div",{class:"progress-fill",style:nt({width:`${k.value}%`})},null,4)])])):ce("",!0)]),e("div",Rx,[e("button",{class:"cancel-btn",onClick:h,disabled:j.value==="downloading"}," å–æ¶ˆ ",8,Dx),e("button",{class:"import-btn",disabled:!L.value?.success||p.value===0||O.value,onClick:v},[j.value==="downloading"?(B(),A("span",Bx)):(B(),A("span",Ex,"ğŸ“¥")),pe(" "+te(j.value==="downloading"?"ä¸‹è½½ä¸­...":"å¯¼å…¥"),1)],8,Mx)])])])):ce("",!0)]))}}),Lx=Je(Ax,[["__scopeId","data-v-78fc5cb0"]]),Fx={class:"disclaimer-container"},Ux={class:"disclaimer-content"},Ox={class:"confirmation-area"},zx=["placeholder"],Nx={key:0,class:"input-error"},Vx={class:"disclaimer-footer"},Wx=["disabled"],Ht="æˆ‘å·²é˜…è¯»å¹¶åŒæ„",Kx=Ye({__name:"WebImportDisclaimer",setup(n){const t=wo(),s=w(""),o=G(()=>t.disclaimerVisible),a=G(()=>s.value.trim()===Ht);function u(){a.value&&(t.acceptDisclaimer(),s.value="")}function l(){t.rejectDisclaimer(),s.value=""}return(c,g)=>(B(),ut(Sn,{to:"body"},[o.value?(B(),A("div",{key:0,class:"disclaimer-overlay",onClick:st(l,["self"])},[e("div",Fx,[g[3]||(g[3]=e("div",{class:"disclaimer-header"},[e("span",{class:"warning-icon"},"âš ï¸"),e("h2",{class:"disclaimer-title"},"é‡è¦å…è´£å£°æ˜")],-1)),e("div",Ux,[g[2]||(g[2]=e("div",{class:"disclaimer-text"},[e("h3",null,"ğŸ“œ ä½¿ç”¨æ¡æ¬¾ä¸æ³•å¾‹å£°æ˜"),e("div",{class:"section"},[e("h4",null,"1. åŠŸèƒ½è¯´æ˜"),e("p",null,[pe(' "ä»ç½‘é¡µå¯¼å…¥"åŠŸèƒ½å…è®¸æ‚¨ä»äº’è”ç½‘ç½‘é¡µä¸­æå–å›¾ç‰‡ã€‚æ­¤åŠŸèƒ½ä»…ä¾›'),e("strong",null,"æŠ€æœ¯ç ”ç©¶ä¸ä¸ªäººå­¦ä¹ "),pe("ä¹‹ç›®çš„æä¾›ã€‚ ")])]),e("div",{class:"section"},[e("h4",null,"2. ç”¨æˆ·è´£ä»»"),e("ul",null,[e("li",null,[pe("æ‚¨åº”å½“ç¡®ä¿æ‹¥æœ‰"),e("strong",null,"åˆæ³•æƒåˆ©"),pe("è®¿é—®å’Œä¸‹è½½ç›®æ ‡å†…å®¹")]),e("li",null,[pe("æ‚¨åº”å½“éµå®ˆç›®æ ‡ç½‘ç«™çš„"),e("strong",null,"æœåŠ¡æ¡æ¬¾"),pe("å’Œ"),e("strong",null,"ä½¿ç”¨åè®®")]),e("li",null,[pe("æ‚¨åº”å½“å°Šé‡å†…å®¹åˆ›ä½œè€…çš„"),e("strong",null,"ç‰ˆæƒ"),pe("å’Œ"),e("strong",null,"çŸ¥è¯†äº§æƒ")]),e("li",null,[pe("æ‚¨"),e("strong",null,"ä¸å¾—"),pe("å°†ä¸‹è½½çš„å†…å®¹ç”¨äºå•†ä¸šç›®çš„æˆ–éæ³•ä¼ æ’­")]),e("li",null,[pe("æ‚¨"),e("strong",null,"ä¸å¾—"),pe("ä½¿ç”¨æœ¬åŠŸèƒ½ç»•è¿‡ä»˜è´¹å†…å®¹çš„è®¿é—®é™åˆ¶")])])]),e("div",{class:"section"},[e("h4",null,"3. ä½¿ç”¨é™åˆ¶"),e("p",null,[pe("æœ¬åŠŸèƒ½"),e("strong",null,"ä¸¥ç¦"),pe("ç”¨äºä»¥ä¸‹ç›®çš„ï¼š")]),e("ul",null,[e("li",null,[pe("ä¸‹è½½ã€å­˜å‚¨æˆ–ä¼ æ’­"),e("strong",null,"ä¾µæƒå†…å®¹")]),e("li",null,[pe("ç»•è¿‡ç½‘ç«™çš„"),e("strong",null,"ä»˜è´¹å¢™"),pe("æˆ–"),e("strong",null,"è®¿é—®æ§åˆ¶")]),e("li",null,[pe("è¿›è¡Œ"),e("strong",null,"å•†ä¸šç”¨é€”"),pe("æˆ–å¤§è§„æ¨¡"),e("strong",null,"æ‰¹é‡çˆ¬å–")]),e("li",null,[pe("ä»»ä½•è¿å"),e("strong",null,"å½“åœ°æ³•å¾‹æ³•è§„"),pe("çš„æ´»åŠ¨")]),e("li",null,[pe("å¯¹ç›®æ ‡ç½‘ç«™é€ æˆ"),e("strong",null,"æœåŠ¡å™¨è´Ÿæ‹…"),pe("æˆ–"),e("strong",null,"æ¶æ„æ”»å‡»")])])]),e("div",{class:"section"},[e("h4",null,"4. å…è´£æ¡æ¬¾"),e("p",null,[pe(" æœ¬è½¯ä»¶ä½œè€…åŠè´¡çŒ®è€…"),e("strong",null,"ä¸å¯¹æ‚¨ä½¿ç”¨æœ¬åŠŸèƒ½æ‰€å¯¼è‡´çš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥åæœæ‰¿æ‹…è´£ä»»"),pe("ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š ")]),e("ul",null,[e("li",null,"å› ä¾µçŠ¯ç‰ˆæƒè€Œäº§ç”Ÿçš„æ³•å¾‹è´£ä»»"),e("li",null,"å› è¿åæœåŠ¡æ¡æ¬¾è€Œå¯¼è‡´çš„è´¦å·å°ç¦"),e("li",null,"å› æ•°æ®ä¸¢å¤±æˆ–æŸåè€Œé€ æˆçš„æŸå¤±"),e("li",null,"ä»»ä½•å…¶ä»–å› ä½¿ç”¨æœ¬åŠŸèƒ½è€Œäº§ç”Ÿçš„ä¸åˆ©åæœ")])]),e("div",{class:"section warning-section"},[e("h4",null,"5. ç¡®è®¤å£°æ˜"),e("p",null,[pe(" ä½¿ç”¨æœ¬åŠŸèƒ½å³è¡¨ç¤ºæ‚¨"),e("strong",null,"å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„"),pe("ä¸Šè¿°æ‰€æœ‰æ¡æ¬¾ï¼Œå¹¶æ‰¿è¯ºï¼š ")]),e("ul",null,[e("li",null,[pe("ä»…å°†æœ¬åŠŸèƒ½ç”¨äº"),e("strong",null,"åˆæ³•ã€åˆè§„"),pe("çš„ç›®çš„")]),e("li",null,[e("strong",null,"è‡ªè¡Œæ‰¿æ‹…"),pe("ä½¿ç”¨æœ¬åŠŸèƒ½æ‰€å¸¦æ¥çš„ä¸€åˆ‡é£é™©å’Œè´£ä»»")]),e("li",null,[pe("å¦‚å› ä½¿ç”¨æœ¬åŠŸèƒ½å¯¼è‡´ä»»ä½•äº‰è®®ï¼Œ"),e("strong",null,"ä¸æœ¬è½¯ä»¶ä½œè€…æ— å…³")])])])],-1)),e("div",Ox,[g[1]||(g[1]=e("p",{class:"confirmation-prompt"}," å¦‚æœæ‚¨å·²å®Œæ•´é˜…è¯»å¹¶åŒæ„ä»¥ä¸Šæ¡æ¬¾ï¼Œè¯·åœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­å‡†ç¡®è¾“å…¥ï¼š ",-1)),e("p",{class:"required-text"},[e("code",null,te(Ht))]),oe(e("input",{"onUpdate:modelValue":g[0]||(g[0]=d=>s.value=d),type:"text",class:"confirmation-input",placeholder:`è¯·è¾“å…¥: ${Ht}`,onKeyup:Cn(u,["enter"])},null,40,zx),[[Re,s.value]]),s.value&&!a.value?(B(),A("p",Nx," è¾“å…¥ä¸æ­£ç¡®ï¼Œè¯·å®Œæ•´è¾“å…¥ã€Œ"+te(Ht)+"ã€ ")):ce("",!0)])]),e("div",Vx,[e("button",{class:"btn-cancel",onClick:l}," æˆ‘ä¸åŒæ„ï¼Œè¿”å› "),e("button",{class:"btn-confirm",disabled:!a.value,onClick:u}," âœ“ ç¡®è®¤å¹¶ç»§ç»­ ",8,Wx)])])])):ce("",!0)]))}}),qx=Je(Kx,[["__scopeId","data-v-3750d090"]]),Hx={class:"app-header"},jx={class:"header-content"},Jx={class:"logo-container"},Yx={class:"header-links"},Gx={class:"container"},Xx={id:"image-display-area"},Zx={id:"upload-section",class:"card upload-card"},Qx={class:"upload-actions"},ey={key:1,class:"bookshelf-mode-hint"},ty=Ye({__name:"TranslateView",setup(n){const t=_n(),s=Qe(),o=Fe(),a=It(),u=gt(),{validateBeforeTranslation:l,initValidation:c}=Mn(),g=Do(),d=Xi(),C=w(!1),$=w(void 0),P=w(!1),R=w(!1),_=G(()=>s.currentImage),D=G(()=>s.hasImages),j=G(()=>s.isBatchTranslationInProgress),z=G(()=>s.failedImageCount>0),L=G(()=>D.value&&!R.value),b=G(()=>!!t.query.book&&!!t.query.chapter),p=G(()=>t.query.book),T=G(()=>t.query.chapter),k=G(()=>d.currentBookTitle.value),N=G(()=>d.currentChapterTitle.value),O=G(()=>b.value&&N.value&&k.value?`${N.value} - ${k.value}`:"Saber-Translator");dt(async()=>{s.clearImages(),u.clearBubbles(),await d.initializeApp(),c(),window.addEventListener("keydown",Y)}),zt(()=>{window.removeEventListener("keydown",Y)}),Ce(()=>[t.query.book,t.query.chapter],async([V,se],[he,xe])=>{V&&se?(s.clearImages(),u.clearBubbles(),await U()):he&&xe&&!V&&!se&&(s.clearImages(),u.clearBubbles(),await d.initializeBookChapterContext(),console.log("[TranslateView] ä»ä¹¦æ¶æ¨¡å¼åˆ‡æ¢åˆ°å¿«é€Ÿç¿»è¯‘æ¨¡å¼ï¼Œå·²æ¸…ç©ºæ•°æ®"))}),Ce(O,V=>{typeof document<"u"&&(document.title=V)},{immediate:!0});const ee=w(!1);function J(V){if(!V)return;const se=o.settings.textStyle;o.updateTextStyle({fontSize:V.fontSize??se.fontSize,autoFontSize:V.autoFontSize??se.autoFontSize,fontFamily:V.fontFamily??se.fontFamily,layoutDirection:V.layoutDirection??se.layoutDirection,textColor:V.textColor??se.textColor,fillColor:V.fillColor??se.fillColor,strokeEnabled:V.strokeEnabled??se.strokeEnabled,strokeColor:V.strokeColor??se.strokeColor,strokeWidth:V.strokeWidth??se.strokeWidth,inpaintMethod:V.inpaintMethod??se.inpaintMethod,useAutoTextColor:V.useAutoTextColor??se.useAutoTextColor})}function ae(V){s.currentImage&&s.updateCurrentImage({fontSize:V.fontSize,autoFontSize:V.autoFontSize,fontFamily:V.fontFamily,layoutDirection:V.layoutDirection,textColor:V.textColor,fillColor:V.fillColor,strokeEnabled:V.strokeEnabled,strokeColor:V.strokeColor,strokeWidth:V.strokeWidth,inpaintMethod:V.inpaintMethod,useAutoTextColor:V.useAutoTextColor})}Ce(()=>s.currentImage,V=>{if(V&&!ee.value){ee.value=!0;try{J(V),console.log(`[TranslateView] å·²åŒæ­¥å›¾ç‰‡ ${s.currentImageIndex} çš„æ–‡å­—è®¾ç½®åˆ°ä¾§è¾¹æ `)}finally{ee.value=!1}}},{immediate:!1}),Ce(()=>o.settings.textStyle,V=>{if(s.currentImage&&!ee.value){ee.value=!0;try{ae(V),console.log(`[TranslateView] å·²å°†ä¾§è¾¹æ è®¾ç½®åŒæ­¥åˆ°å›¾ç‰‡ ${s.currentImageIndex}`)}finally{ee.value=!1}}},{deep:!0});async function U(){if(!(!p.value||!T.value))try{await d.initializeBookChapterContext()}catch(V){console.error("åŠ è½½ç« èŠ‚ä¼šè¯å¤±è´¥:",V),_e("åŠ è½½ç« èŠ‚ä¼šè¯å¤±è´¥","error")}}function Q(V){console.log(`ä¸Šä¼ å®Œæˆï¼Œå…± ${V} å¼ å›¾ç‰‡`),s.hasImages&&(s.sortImagesByFileName(),d.switchImage(0))}async function ie(V){if(!Object.values(V).some(xe=>xe)){_e("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè¦åº”ç”¨çš„è®¾ç½®é¡¹","warning");return}if(s.images.length===0){_e("æ²¡æœ‰å¯åº”ç”¨çš„å›¾ç‰‡","warning");return}if(s.images.length<=1){_e("åªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œæ— éœ€åº”ç”¨åˆ°å…¨éƒ¨","info");return}const he=[];for(let xe=0;xe<s.images.length;xe++){const Me=s.images[xe];Me?.bubbleStates&&Me.bubbleStates.length>0&&he.push(xe)}if(he.length===0){_e("æ²¡æœ‰å·²ç¿»è¯‘çš„å›¾ç‰‡","warning");return}try{const{textStyle:xe}=o.settings,Me=xe.layoutDirection==="auto",Ne=xe.useAutoTextColor===!0,Ae=xe.autoFontSize===!0,ke={fontSize:xe.fontSize,fontFamily:xe.fontFamily,textDirection:Me?"vertical":xe.layoutDirection,textColor:xe.textColor,fillColor:xe.fillColor,strokeEnabled:xe.strokeEnabled,strokeColor:xe.strokeColor,strokeWidth:xe.strokeWidth},Be=Te=>{if(!Te||Te.length!==3)return null;const[W,re,we]=Te;return"#"+[W,re,we].map(Ke=>{const rt=Math.max(0,Math.min(255,Math.round(Ke))).toString(16);return rt.length===1?"0"+rt:rt}).join("")},Ie=Te=>{const W={...Te};if(V.fontSize&&!Ae&&(W.fontSize=ke.fontSize),V.fontFamily&&(W.fontFamily=ke.fontFamily),V.layoutDirection)if(Me){const re=Te.autoTextDirection;W.textDirection=re==="vertical"||re==="horizontal"?re:"vertical"}else W.textDirection=ke.textDirection;return V.textColor&&(Ne&&Te.autoFgColor?W.textColor=Be(Te.autoFgColor)??ke.textColor:W.textColor=ke.textColor),V.fillColor&&(Ne&&Te.autoBgColor?W.fillColor=Be(Te.autoBgColor)??ke.fillColor:W.fillColor=ke.fillColor),V.strokeEnabled&&(W.strokeEnabled=ke.strokeEnabled),V.strokeColor&&(W.strokeColor=ke.strokeColor),V.strokeWidth&&(W.strokeWidth=ke.strokeWidth),W},et=[];for(const Te of he){const W=s.images[Te];if(!W?.bubbleStates)continue;const we={bubbleStates:W.bubbleStates.map(Ie)};V.fontSize&&(we.autoFontSize=Ae,Ae||(we.fontSize=ke.fontSize)),V.fontFamily&&(we.fontFamily=ke.fontFamily),V.layoutDirection&&(we.layoutDirection=xe.layoutDirection),(V.textColor||V.fillColor)&&(we.useAutoTextColor=Ne,Ne||(V.textColor&&(we.textColor=ke.textColor),V.fillColor&&(we.fillColor=ke.fillColor))),V.strokeEnabled&&(we.strokeEnabled=ke.strokeEnabled),V.strokeColor&&(we.strokeColor=ke.strokeColor),V.strokeWidth&&(we.strokeWidth=ke.strokeWidth),s.updateImageByIndex(Te,we),W.translatedDataURL&&et.push(Te)}u.bubbles.length>0&&u.setBubbles(u.bubbles.map(Ie));const qe=[];if(V.fontSize&&qe.push(Ae?"è‡ªåŠ¨å­—å·":"å­—å·"),V.fontFamily&&qe.push("å­—ä½“"),V.layoutDirection&&qe.push(Me?"è‡ªåŠ¨æ’ç‰ˆæ–¹å‘":"æ’ç‰ˆæ–¹å‘"),V.textColor&&qe.push(Ne?"è‡ªåŠ¨æ–‡å­—é¢œè‰²":"æ–‡å­—é¢œè‰²"),V.fillColor&&qe.push(Ne?"è‡ªåŠ¨å¡«å……é¢œè‰²":"å¡«å……é¢œè‰²"),V.strokeEnabled&&qe.push("æè¾¹å¼€å…³"),V.strokeColor&&qe.push("æè¾¹é¢œè‰²"),V.strokeWidth&&qe.push("æè¾¹å®½åº¦"),et.length>0){g.progress.value={isInProgress:!0,current:0,total:et.length,completed:0,failed:0,label:`åº”ç”¨è®¾ç½®ä¸­ï¼š0 / ${et.length}`,percentage:0};const{parallelRender:Te}=await it(async()=>{const{parallelRender:re}=await Promise.resolve().then(()=>$i);return{parallelRender:re}},void 0);let W=0;for(const re of et){const we=s.images[re];if(we?.bubbleStates)try{let Ke="";if(we.cleanImageData?Ke=we.cleanImageData.includes("base64,")?we.cleanImageData.split("base64,")[1]||"":we.cleanImageData:we.originalDataURL&&(Ke=we.originalDataURL.includes("base64,")?we.originalDataURL.split("base64,")[1]||"":we.originalDataURL,console.log(`handleApplyToAll: å›¾ç‰‡ ${re} ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰`)),!Ke){console.log(`handleApplyToAll: å›¾ç‰‡ ${re} æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡`),g.progress.value.failed++;continue}const rt=we.bubbleStates.map(tt=>({originalText:tt.originalText||"",translatedText:tt.translatedText||"",textboxText:tt.textboxText||"",coords:tt.coords,polygon:tt.polygon,fontSize:tt.fontSize,fontFamily:tt.fontFamily,textDirection:tt.textDirection,autoTextDirection:tt.autoTextDirection,textColor:tt.textColor,fillColor:tt.fillColor,rotationAngle:tt.rotationAngle||0,position:tt.position||{x:0,y:0},strokeEnabled:tt.strokeEnabled,strokeColor:tt.strokeColor,strokeWidth:tt.strokeWidth,inpaintMethod:tt.inpaintMethod,autoFgColor:tt.autoFgColor,autoBgColor:tt.autoBgColor})),yt=await Te({clean_image:Ke,bubble_states:rt,autoFontSize:V.fontSize&&Ae,use_individual_styles:!0});yt.success&&yt.final_image?(s.updateImageByIndex(re,{translatedDataURL:`data:image/png;base64,${yt.final_image}`,bubbleStates:yt.bubble_states||we.bubbleStates,hasUnsavedChanges:!0}),W++,g.progress.value.current=W,g.progress.value.label=`åº”ç”¨è®¾ç½®ä¸­ï¼š${W} / ${et.length}`,g.progress.value.percentage=Math.round(W/et.length*100)):g.progress.value.failed++}catch(Ke){console.error(`é‡æ¸²æŸ“å›¾ç‰‡ ${re} å¤±è´¥:`,Ke),g.progress.value.failed++}}g.progress.value.isInProgress=!1}const at=s.currentImage;if(at){ee.value=!0;try{J(at),console.log("[TranslateView] åº”ç”¨åˆ°å…¨éƒ¨å®Œæˆï¼Œå·²åŒæ­¥å½“å‰å›¾ç‰‡è®¾ç½®åˆ°ä¾§è¾¹æ ")}finally{ee.value=!1}}_e(`å·²å°† ${qe.join("ã€")} åº”ç”¨åˆ° ${he.length} å¼ å›¾ç‰‡`,"success"),console.log(`[TranslateView] åº”ç”¨è®¾ç½®åˆ°å…¨éƒ¨å®Œæˆï¼Œæ›´æ–°äº† ${he.length} å¼ å›¾ç‰‡ï¼Œé‡æ¸²æŸ“äº† ${et.length} å¼ `)}catch(xe){console.error("åº”ç”¨è®¾ç½®åˆ°å…¨éƒ¨å¤±è´¥:",xe),_e("åº”ç”¨è®¾ç½®å¤±è´¥","error")}}async function F(){_.value&&l("normal")&&await g.translateCurrentImage()}async function h(){D.value&&l("normal")&&await g.translateAllImages()}async function m(){D.value&&l("hq")&&await g.executeHqTranslation()}async function i(){D.value&&l("proofread")&&await g.executeProofreading()}async function f(){_.value&&await g.removeTextOnly()}async function v(){D.value&&await g.removeAllTexts()}async function y(V,se){D.value&&l("normal")&&await g.translateImageRange({startPage:V,endPage:se})}async function I(V,se){D.value&&l("hq")&&await g.executeHqTranslation({startPage:V,endPage:se})}async function E(V,se){D.value&&l("proofread")&&await g.executeProofreading({startPage:V,endPage:se})}async function H(V,se){D.value&&await g.removeTextRange({startPage:V,endPage:se})}function X(){if(!_.value)return;const V=_.value.fileName||`å›¾ç‰‡ ${s.currentImageIndex+1}`;confirm(`ç¡®å®šè¦åˆ é™¤å½“å‰å›¾ç‰‡ (${V}) å—ï¼Ÿ`)&&(s.deleteCurrentImage(),_e("å›¾ç‰‡å·²åˆ é™¤","success"))}function r(){D.value&&confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å›¾ç‰‡å—ï¼Ÿè¿™å°†ä¸¢å¤±æ‰€æœ‰æœªä¿å­˜çš„è¿›åº¦ã€‚")&&(s.clearImages(),_e("æ‰€æœ‰å›¾ç‰‡å·²æ¸…é™¤","success"))}async function x(){try{const V=await kn(),se=await Co();if(V.success&&se.success)_e("ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ","success");else{const he=[];V.success||he.push("è°ƒè¯•æ–‡ä»¶æ¸…ç†å¤±è´¥"),se.success||he.push("ä¸´æ—¶æ–‡ä»¶æ¸…ç†å¤±è´¥"),_e(he.join("ï¼Œ"),"warning")}}catch{_e("æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥","error")}}function ne(){d.goToPrevious()}function M(){d.goToNext()}function Z(){R.value=!R.value}async function de(){if(!z.value){_e("æ²¡æœ‰å¤±è´¥çš„å›¾ç‰‡éœ€è¦é‡æ–°ç¿»è¯‘","info");return}l("normal")&&await g.retryFailedImages()}async function me(){if(!D.value){_e("æ²¡æœ‰å¯ä¿å­˜çš„å†…å®¹","warning");return}if(!(!p.value||!T.value))try{await a.saveChapterSession(p.value,T.value)?_e("ç« èŠ‚è¿›åº¦å·²ä¿å­˜","success"):_e("ä¿å­˜å¤±è´¥","error")}catch(V){console.error("ä¿å­˜ä¼šè¯å¤±è´¥:",V),_e("ä¿å­˜å¤±è´¥: "+(V instanceof Error?V.message:"æœªçŸ¥é”™è¯¯"),"error")}}function ve(V){$.value=V,C.value=!0}function $e(){ve("plugins")}function Pe(){_e("è®¾ç½®å·²ä¿å­˜","success")}function le(){P.value=!0}function S(){_e("ğŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}function Y(V){const se=V.target;if(!(se instanceof HTMLInputElement||se instanceof HTMLTextAreaElement||se.getAttribute("contenteditable")==="true"||se.id==="bubbleTextEditor")&&!R.value&&V.altKey)switch(V.key){case"ArrowLeft":V.preventDefault(),ne();break;case"ArrowRight":V.preventDefault(),M();break;case"ArrowUp":if(V.preventDefault(),!o.settings.textStyle.autoFontSize){const xe=o.settings.textStyle.fontSize;o.updateTextStyle({fontSize:xe+1})}break;case"ArrowDown":if(V.preventDefault(),!o.settings.textStyle.autoFontSize){const xe=o.settings.textStyle.fontSize;o.updateTextStyle({fontSize:Math.max(10,xe-1)})}break}}async function be(V){const se=_.value;if(!se||!se.translatedDataURL){console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${V} (ä»…å½±å“ä¸‹æ¬¡ç¿»è¯‘)`);return}const he=se.bubbleStates;if(!he||!Array.isArray(he)||he.length===0){console.log("å½“å‰å›¾ç‰‡æ²¡æœ‰ bubbleStatesï¼Œè·³è¿‡é‡æ¸²æŸ“");return}if(console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${V}ï¼Œå°†é‡æ–°æ¸²æŸ“...`),V){console.log("è‡ªåŠ¨å­—å·å·²å¼€å¯ï¼Œé‡æ–°è®¡ç®—å­—å·å¹¶æ¸²æŸ“...");try{const{apiClient:xe}=await it(async()=>{const{apiClient:Ie}=await import("./client.Bht704G-.js");return{apiClient:Ie}},__vite__mapDeps([4,5]));let Me="";if(se.cleanImageData){const Ie=se.cleanImageData;Me=Ie.includes("base64,")?Ie.split("base64,")[1]||"":Ie}else se.originalDataURL&&(Me=se.originalDataURL.includes("base64,")?se.originalDataURL.split("base64,")[1]||"":se.originalDataURL);if(!Me){console.log("æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const Ne=he.map(Ie=>({translatedText:Ie.translatedText||"",coords:Ie.coords,fontSize:Ie.fontSize||o.settings.textStyle.fontSize,fontFamily:Ie.fontFamily||o.settings.textStyle.fontFamily,textDirection:Ft(Ie),textColor:Ie.textColor||o.settings.textStyle.textColor,rotationAngle:Ie.rotationAngle||0,position:Ie.position||{x:0,y:0},strokeEnabled:Ie.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:Ie.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:Ie.strokeWidth??o.settings.textStyle.strokeWidth})),Ae=Ne.map(Ie=>Ie.translatedText),ke=Ne.map(Ie=>Ie.coords),Be=await xe.post("/api/re_render_image",{clean_image:Me,bubble_texts:Ae,bubble_coords:ke,fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:o.settings.textStyle.layoutDirection==="auto"?"vertical":o.settings.textStyle.layoutDirection,textColor:o.settings.textStyle.textColor,bubble_states:Ne,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,autoFontSize:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});if(Be.rendered_image){if(Be.bubble_states&&Array.isArray(Be.bubble_states)){const Ie=he.map((et,qe)=>({...et,fontSize:Be.bubble_states[qe]?.fontSize??et.fontSize}));s.updateCurrentImage({translatedDataURL:`data:image/png;base64,${Be.rendered_image}`,bubbleStates:Ie,hasUnsavedChanges:!0}),u.setBubbles(Ie)}else s.updateCurrentImage({translatedDataURL:`data:image/png;base64,${Be.rendered_image}`,hasUnsavedChanges:!0});console.log("è‡ªåŠ¨å­—å·æ¸²æŸ“æˆåŠŸ")}else Be.error&&(console.error("è‡ªåŠ¨å­—å·æ¸²æŸ“å¤±è´¥:",Be.error),_e("é‡æ–°æ¸²æŸ“å¤±è´¥: "+Be.error,"error"))}catch(xe){console.error("è‡ªåŠ¨å­—å·æ¸²æŸ“å‡ºé”™:",xe)}}else{const xe=o.settings.textStyle.fontSize;console.log(`è‡ªåŠ¨å­—å·å·²å…³é—­ï¼Œä½¿ç”¨å›ºå®šå­—å· ${xe} æ¸²æŸ“...`);const Me=he.map(Ne=>({...Ne,fontSize:xe}));s.updateCurrentImage({bubbleStates:Me}),u.setBubbles(Me),await fe("fontSize",xe)}}async function fe(V,se){const he=_.value;if(!he||!he.translatedDataURL||!he.bubbleStates||he.bubbleStates.length===0||!["fontSize","fontFamily","layoutDirection","textColor","strokeEnabled","strokeColor","strokeWidth","fillColor"].includes(V))return;console.log(`å…¨å±€è®¾ç½®å˜æ›´ (${V}=${se})ï¼Œå‡†å¤‡é‡æ¸²æŸ“...`);const Ne={fontSize:"fontSize",fontFamily:"fontFamily",layoutDirection:"textDirection",textColor:"textColor",strokeEnabled:"strokeEnabled",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fillColor:"fillColor"}[V];if(Ne&&he.bubbleStates)if(V==="layoutDirection")if(se==="auto"){console.log("æ’ç‰ˆæ–¹å‘è®¾ç½®ä¸º 'auto'ï¼Œä» autoTextDirection æ¢å¤æ¯ä¸ªæ°”æ³¡çš„æ’ç‰ˆæ–¹å‘");const Ae=he.bubbleStates.map(ke=>({...ke,textDirection:ke.autoTextDirection==="vertical"||ke.autoTextDirection==="horizontal"?ke.autoTextDirection:"vertical"}));s.updateCurrentImage({bubbleStates:Ae}),u.setBubbles(Ae)}else{console.log(`æ’ç‰ˆæ–¹å‘è®¾ç½®ä¸º '${se}'ï¼Œåº”ç”¨åˆ°æ‰€æœ‰æ°”æ³¡`);const Ae=he.bubbleStates.map(ke=>({...ke,textDirection:se}));s.updateCurrentImage({bubbleStates:Ae}),u.setBubbles(Ae)}else{const Ae=he.bubbleStates.map(ke=>({...ke,[Ne]:se}));s.updateCurrentImage({bubbleStates:Ae}),u.setBubbles(Ae)}try{const ke=s.currentImage?.bubbleStates||he.bubbleStates||[];if(ke.length===0||!ke[0]?.coords){console.log("æ²¡æœ‰æœ‰æ•ˆçš„æ°”æ³¡åæ ‡ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const Be=o.settings.textStyle.layoutDirection,Ie=ke.map(re=>({translatedText:re.translatedText||"",coords:re.coords,fontSize:re.fontSize||o.settings.textStyle.fontSize,fontFamily:re.fontFamily||o.settings.textStyle.fontFamily,textDirection:Ft(re),textColor:re.textColor||o.settings.textStyle.textColor,rotationAngle:re.rotationAngle||0,position:re.position||{x:0,y:0},strokeEnabled:re.strokeEnabled??o.settings.textStyle.strokeEnabled,strokeColor:re.strokeColor||o.settings.textStyle.strokeColor,strokeWidth:re.strokeWidth??o.settings.textStyle.strokeWidth})),et=Ie.map(re=>re.translatedText),qe=Ie.map(re=>re.coords);let at="";if(he.cleanImageData){const re=he.cleanImageData;at=re.includes("base64,")?re.split("base64,")[1]||"":re}else he.originalDataURL&&(at=he.originalDataURL.includes("base64,")?he.originalDataURL.split("base64,")[1]||"":he.originalDataURL,console.log("handleTextStyleChanged: ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰"));if(!at){console.log("æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const{apiClient:Te}=await it(async()=>{const{apiClient:re}=await import("./client.Bht704G-.js");return{apiClient:re}},__vite__mapDeps([4,5])),W=await Te.post("/api/re_render_image",{clean_image:at,bubble_texts:et,bubble_coords:qe,fontSize:o.settings.textStyle.fontSize,fontFamily:o.settings.textStyle.fontFamily,textDirection:Be==="auto"?"vertical":Be,textColor:o.settings.textStyle.textColor,bubble_states:Ie,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,strokeEnabled:o.settings.textStyle.strokeEnabled,strokeColor:o.settings.textStyle.strokeColor,strokeWidth:o.settings.textStyle.strokeWidth});W.rendered_image?(s.updateCurrentImage({translatedDataURL:`data:image/png;base64,${W.rendered_image}`,hasUnsavedChanges:!0}),console.log("è®¾ç½®å˜æ›´åé‡æ–°æ¸²æŸ“æˆåŠŸ")):W.error&&console.error("é‡æ–°æ¸²æŸ“å¤±è´¥:",W.error)}catch(Ae){console.error("è®¾ç½®å˜æ›´åé‡æ–°æ¸²æŸ“å¤±è´¥:",Ae)}}function ye(V){d.switchImage(V)}return(V,se)=>{const he=Es("router-link");return B(),A("div",{class:De(["translate-page",{"edit-mode-active":R.value}])},[e("header",Hx,[e("div",jx,[e("div",Jx,[Se(he,{to:"/",title:"è¿”å›ä¹¦æ¶"},{default:St(()=>[...se[3]||(se[3]=[e("img",{src:"/pic/logo.png",alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",Yx,[Se(he,{to:"/",class:"back-to-shelf",title:"è¿”å›ä¹¦æ¶"},{default:St(()=>[...se[4]||(se[4]=[pe("ğŸ“š",-1)])]),_:1}),b.value?(B(),A("button",{key:0,class:"save-header-btn",title:"ä¿å­˜è¿›åº¦",onClick:me}," ğŸ’¾ ")):ce("",!0),e("button",{id:"openSettingsBtn",class:"settings-header-btn",title:"æ‰“å¼€è®¾ç½®",onClick:se[0]||(se[0]=xe=>ve())},[...se[5]||(se[5]=[e("span",{class:"icon"},"âš™ï¸",-1),e("span",null,"è®¾ç½®",-1)])]),se[8]||(se[8]=e("a",{href:"http://www.mashirosaber.top",target:"_blank",class:"tutorial-link"},"ä½¿ç”¨æ•™ç¨‹",-1)),e("a",{href:"javascript:void(0)",class:"donate-link",onClick:le},[...se[6]||(se[6]=[e("span",null,"â¤ï¸ è¯·ä½œè€…å–å¥¶èŒ¶",-1)])]),se[9]||(se[9]=e("a",{href:"https://github.com/MashiroSaber03",target:"_blank",class:"github-link"},[e("img",{src:"/pic/github.jpg",alt:"GitHub",class:"github-icon"})],-1)),e("button",{class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:S},[...se[7]||(se[7]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("div",Gx,[Se(Wl,{onTranslateCurrent:F,onTranslateAll:h,onTranslateRange:y,onHqTranslate:m,onHqTranslateRange:I,onProofread:i,onProofreadRange:E,onRemoveText:f,onRemoveAllText:v,onRemoveTextRange:H,onRetryFailed:de,onDeleteCurrent:X,onClearAll:r,onCleanTemp:x,onOpenPlugins:$e,onOpenSettings:ve,onPrevious:ne,onNext:M,onApplyToAll:ie,onTextStyleChanged:fe,onAutoFontSizeChanged:be}),e("main",Xx,[e("section",Zx,[e("div",Qx,[Se(Pa,{ref:"imageUploadRef",onUploadComplete:Q},null,512)]),K(a).loadingProgress.total>0?(B(),ut($o,{key:0,visible:!0,percentage:K(a).loadingProgress.current/K(a).loadingProgress.total*100,label:K(a).loadingProgress.message},null,8,["percentage","label"])):ce("",!0),Se(Tr,{progress:K(g).progress.value},null,8,["progress"]),j.value&&b.value?(B(),A("div",ey,[...se[10]||(se[10]=[e("span",{style:{color:"#888","font-size":"0.85em"}}," ï¼ˆä¹¦æ¶æ¨¡å¼ä¸‹é€€å‡ºå‰è¯·ç‚¹å‡»é¡¶éƒ¨ä¿å­˜æŒ‰é’®ï¼‰ ",-1)])])):ce("",!0)]),Se(gi,{ref:"imageResultRef","is-edit-mode":R.value,onToggleEditMode:Z,onRetryFailed:de},null,8,["is-edit-mode"])]),oe(Se(ou,{"is-visible":L.value,onSelect:ye},null,8,["is-visible"]),[[Oe,L.value]])]),_.value&&R.value?(B(),ut(ib,{key:0,"is-edit-mode-active":R.value,onExit:Z},null,8,["is-edit-mode-active"])):ce("",!0),Se(bi,{onOpenSettings:ve}),Se(Jm,{modelValue:C.value,"onUpdate:modelValue":se[1]||(se[1]=xe=>C.value=xe),"initial-tab":$.value,onSave:Pe},null,8,["modelValue","initial-tab"]),P.value?(B(),ut(Pr,{key:1,onClose:se[2]||(se[2]=xe=>P.value=!1)})):ce("",!0),Se(qx),Se(Lx)],2)}}}),dy=Je(ty,[["__scopeId","data-v-6b3f6b36"]]);export{dy as default};
