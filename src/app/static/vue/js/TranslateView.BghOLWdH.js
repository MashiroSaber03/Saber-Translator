const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/system.C6TM7-kx.js","js/index.Dy7VSLNn.js","js/vue-vendor.nHHJLq3r.js","assets/index.BYanE9pL.css","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js","js/session.Kpy-QhBa.js"])))=>i.map(i=>d[i]);
import{D as Go,b as ao,c as lo,d as io,e as Xo,a as st,S as Eo,_ as qe,f as Je,s as me,u as rt,g as Ln,h as Un,i as On,j as zn,k as Ao,l as Fo,B as Lo,m as Uo,n as Nn,F as Xt,o as Oo,p as zo,q as Vn,L as No,W as Wn}from"./index.Dy7VSLNn.js";import{d as At,r as S,c as ee,a as He,e as q,h as de,f as e,t as le,i as at,k as N,g as lt,n as Ie,u as Se,o as ut,v as ae,x as Ue,l as be,s as Vo,m as ht,K as Qe,D as Q,F as Ke,j as je,L as Zo,w as he,B as ct,M as kt,z as Ce,N as Kn,p as Ze,O as eo,b as Tt,P as yt,Q as Wo,A as qn,S as Hn,T as Jn,C as jn}from"./vue-vendor.nHHJLq3r.js";import{p as Yn,a as Gn,b as Xn,c as Zn,d as Qn,e as es,f as ts,h as os,i as ns,j as ss,k as ro,l as Qo}from"./system.C6TM7-kx.js";import{getFontList as en,uploadFont as as,getTextboxPrompts as ls,getPrompts as is,configApi as Ne,getFontListApi as rs}from"./config.CwRcCkM9.js";import{_ as ze}from"./CustomSelect.vue_vue_type_style_index_0_lang.DGaYiHlK.js";import{apiClient as nt}from"./client.Bht704G-.js";import{B as tn}from"./BaseModal.DP3XMM-1.js";import{getBookDetail as us}from"./bookshelf.B4ums9uK.js";import"./utils-vendor.B9ygI19o.js";function Ko(){return{firecrawl:{apiKey:""},agent:{provider:"openai",apiKey:"",customBaseUrl:"",modelName:"gpt-4o-mini",useStream:!1,forceJsonOutput:!0,maxRetries:3,timeout:120},extraction:{prompt:Go,maxIterations:10},download:{concurrency:3,timeout:30,retries:3,delay:100,useReferer:!0},imagePreprocess:{enabled:!1,autoRotate:!0,compression:{enabled:!1,quality:85,maxWidth:0,maxHeight:0},formatConvert:{enabled:!1,targetFormat:"original"}},advanced:{customCookie:"",customHeaders:"",bypassProxy:!1},ui:{showAgentLogs:!0,autoImport:!1}}}function cs(o,t){function d(v){o.value.firecrawl.apiKey=v,t()}function n(v){o.value.agent.provider=v,t()}function l(v){o.value.agent.apiKey=v,t()}function a(v){o.value.agent.customBaseUrl=v,t()}function s(v){o.value.agent.modelName=v,t()}function r(v){o.value.agent.useStream=v,t()}function x(v){o.value.agent.forceJsonOutput=v,t()}function A(v){o.value.agent.timeout=v,t()}function w(v){o.value.extraction.prompt=v,t()}function W(v){o.value.extraction.maxIterations=v,t()}function G(){o.value.extraction.prompt=Go,t()}function j(v){o.value.download.concurrency=v,t()}function P(v){o.value.download.timeout=v,t()}function h(v){o.value.download.retries=v,t()}function I(v){o.value.download.delay=v,t()}function D(v){o.value.download.useReferer=v,t()}function E(v){o.value.imagePreprocess.enabled=v,t()}function c(v){o.value.imagePreprocess.autoRotate=v,t()}function u(v){o.value.imagePreprocess.compression.enabled=v,t()}function y(v){o.value.imagePreprocess.compression.quality=v,t()}function b(v){o.value.imagePreprocess.compression.maxWidth=v,t()}function R(v){o.value.imagePreprocess.compression.maxHeight=v,t()}function M(v){o.value.imagePreprocess.formatConvert.enabled=v,t()}function J(v){o.value.imagePreprocess.formatConvert.targetFormat=v,t()}function V(v){o.value.advanced.customCookie=v,t()}function U(v){o.value.advanced.customHeaders=v,t()}function O(v){o.value.advanced.bypassProxy=v,t()}function f(v){o.value.ui.showAgentLogs=v,t()}function m(v){o.value.ui.autoImport=v,t()}function $(v){o.value={...o.value,...v},t()}return{setFirecrawlApiKey:d,setAgentProvider:n,setAgentApiKey:l,setAgentBaseUrl:a,setAgentModelName:s,setAgentUseStream:r,setAgentForceJson:x,setAgentTimeout:A,setExtractionPrompt:w,setExtractionMaxIterations:W,resetExtractionPrompt:G,setDownloadConcurrency:j,setDownloadTimeout:P,setDownloadRetries:h,setDownloadDelay:I,setDownloadUseReferer:D,setImagePreprocessEnabled:E,setImageAutoRotate:c,setImageCompressionEnabled:u,setImageCompressionQuality:y,setImageMaxWidth:b,setImageMaxHeight:R,setImageFormatConvertEnabled:M,setImageTargetFormat:J,setCustomCookie:V,setCustomHeaders:U,setBypassProxy:O,setShowAgentLogs:f,setAutoImport:m,updateWebImportSettings:$}}async function Pt(o){return nt.post("/api/translate_image",o)}async function uo(o){return nt.post("/api/re_render_image",o)}async function ds(o){try{return{success:!0,data:await nt.post("/api/translate_single_text",o)}}catch(t){return{success:!1,error:t instanceof Error?t.message:"ç¿»è¯‘å¤±è´¥"}}}async function co(o){return nt.post("/api/hq_translate_batch",o)}async function to(o,t,d){return nt.post("/api/detect_boxes",{image:o,detector_type:t,...d})}async function on(o,t,d,n){return nt.post("/api/ocr_single_bubble",{image_data:o,bubble_coords:t,ocr_engine:d,...n})}async function go(o,t,d){return nt.post("/api/inpaint_single_bubble",{image_data:o,bubble_coords:t,bubble_angle:d?.bubbleAngle??0,method:d?.method??"lama",lama_model:d?.lamaModel??"lama_mpe",...d?.maskData&&{mask_data:d.maskData}})}const gs=Object.freeze(Object.defineProperty({__proto__:null,detectBoxes:to,hqTranslateBatch:co,inpaintSingleBubble:go,ocrSingleBubble:on,reRenderImage:uo,translateImage:Pt,translateSingleText:ds},Symbol.toStringTag,{value:"Module"}));async function ps(){return nt.get("/api/plugins")}async function vs(o){const t=encodeURIComponent(o);return nt.post(`/api/plugins/${t}/enable`)}async function ms(o){const t=encodeURIComponent(o);return nt.post(`/api/plugins/${t}/disable`)}async function bs(o){const t=encodeURIComponent(o);return nt.delete(`/api/plugins/${t}`)}async function fs(o){const t=encodeURIComponent(o);return nt.get(`/api/plugins/${t}/config_schema`)}async function hs(o){const t=encodeURIComponent(o);return nt.get(`/api/plugins/${t}/config`)}async function ys(o,t){const d=encodeURIComponent(o);return nt.post(`/api/plugins/${d}/config`,t)}async function xs(){return nt.get("/api/plugins/default_states")}async function ks(o,t){const d=encodeURIComponent(o);return nt.post(`/api/plugins/${d}/set_default_state`,{enabled:t})}async function _s(){return{states:(await xs()).default_states}}const Ss=ks,Cs=fs,ws=hs,$s=ys;function Is(){return`img_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function qo(o,t,d){return{id:Is(),fileName:o,originalDataURL:t,translatedDataURL:null,cleanImageData:null,bubbleStates:null,translationStatus:"pending",translationFailed:!1,fontSize:25,autoFontSize:!0,fontFamily:"fonts/STSONG.TTF",layoutDirection:"vertical",textColor:"#000000",fillColor:Xo,inpaintMethod:"solid",strokeEnabled:io,strokeColor:lo,strokeWidth:ao,hasUnsavedChanges:!1,...d}}const et=At("image",()=>{const o=S([]),t=S(-1),d=S(!1),n=S(!1),l=S(null),a=ee(()=>t.value>=0&&t.value<o.value.length?o.value[t.value]??null:null),s=ee(()=>o.value.length),r=ee(()=>o.value.length>0),x=ee(()=>t.value>0),A=ee(()=>t.value<o.value.length-1),w=ee(()=>o.value.filter(_=>_.translationFailed).length),W=ee(()=>o.value.filter(_=>_.translationStatus==="completed").length),G=ee(()=>o.value.filter(_=>_.translationStatus==="pending").length);function j(_,z,T){const p=qo(_,z,T);return o.value.push(p),o.value.length===1&&(t.value=0),console.log(`å›¾ç‰‡å·²æ·»åŠ : ${_}ï¼Œå½“å‰å…± ${o.value.length} å¼ å›¾ç‰‡`),p}function P(_){const z=_.map(({fileName:p,originalDataURL:K,overrides:i})=>qo(p,K,i)),T=o.value.length===0;return o.value.push(...z),T&&o.value.length>0&&(t.value=0),console.log(`æ‰¹é‡æ·»åŠ äº† ${z.length} å¼ å›¾ç‰‡ï¼Œå½“å‰å…± ${o.value.length} å¼ `),z}function h(_){o.value=_.map(z=>({...z,strokeEnabled:z.strokeEnabled??io,strokeColor:z.strokeColor||lo,strokeWidth:z.strokeWidth??ao,hasUnsavedChanges:z.hasUnsavedChanges||!1})),o.value.length>0?t.value=Math.min(Math.max(0,t.value),o.value.length-1):t.value=-1,console.log(`å›¾ç‰‡æ•°ç»„å·²è®¾ç½®ï¼Œå…± ${o.value.length} å¼ å›¾ç‰‡`)}function I(_){return _<0||_>=o.value.length?(console.warn(`åˆ é™¤å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${_}`),!1):(o.value.splice(_,1),t.value===_?(t.value=Math.min(_,o.value.length-1),o.value.length===0&&(t.value=-1)):t.value>_&&t.value--,console.log(`å›¾ç‰‡å·²åˆ é™¤ï¼Œå½“å‰å…± ${o.value.length} å¼ å›¾ç‰‡`),!0)}function D(){return I(t.value)}function E(){o.value=[],t.value=-1,d.value=!1,n.value=!1,l.value=null,console.log("æ‰€æœ‰å›¾ç‰‡å·²æ¸…é™¤")}function c(){const _=a.value?.id||null;if(o.value.sort((z,T)=>z.fileName.localeCompare(T.fileName,void 0,{numeric:!0,sensitivity:"base"})),_){const z=o.value.findIndex(T=>T.id===_);z>=0&&z!==t.value&&(console.log(`å›¾ç‰‡æ’åº: currentImageIndex ä» ${t.value} æ›´æ–°ä¸º ${z}`),t.value=z)}console.log("å›¾ç‰‡å·²æŒ‰æ–‡ä»¶åæ’åº")}function u(_){_>=-1&&_<o.value.length?(t.value=_,console.log(`å½“å‰å›¾ç‰‡ç´¢å¼•å·²è®¾ç½®ä¸º ${_}`)):console.warn(`è®¾ç½®ç´¢å¼•å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${_}`)}function y(){return x.value?(t.value--,!0):!1}function b(){return A.value?(t.value++,!0):!1}function R(_){a.value?(Object.assign(a.value,_),console.log("å½“å‰å›¾ç‰‡å±æ€§å·²æ›´æ–°:",Object.keys(_))):console.warn("æ›´æ–°å¤±è´¥: å½“å‰æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡")}function M(_,z){if(_>=0&&_<o.value.length){const T=o.value[_];T&&(Object.assign(T,z),console.log(`å›¾ç‰‡ ${_} å±æ€§å·²æ›´æ–°:`,Object.keys(z)))}else console.warn(`æ›´æ–°å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${_}`)}function J(_){a.value&&(a.value.bubbleStates=_,a.value.hasUnsavedChanges=!0,console.log(`å½“å‰å›¾ç‰‡æ°”æ³¡çŠ¶æ€å·²æ›´æ–°ï¼Œå…± ${_?.length??0} ä¸ªæ°”æ³¡`))}function V(_){a.value&&(a.value.isManuallyAnnotated=_,a.value.hasUnsavedChanges=!0,console.log(`æ‰‹åŠ¨æ ‡æ³¨æ ‡è®°å·²è®¾ç½®ä¸º: ${_}`))}function U(_,z){a.value?(a.value[_]=z,a.value.hasUnsavedChanges=!0,console.log(`å½“å‰å›¾ç‰‡å±æ€§ ${String(_)} å·²æ›´æ–°`)):console.warn("æ›´æ–°å¤±è´¥: å½“å‰æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡")}function O(_,z){a.value&&(a.value.translatedDataURL=_,z&&(a.value.cleanImageData=z),a.value.translationStatus="completed",a.value.translationFailed=!1,a.value.hasUnsavedChanges=!0,console.log("å½“å‰å›¾ç‰‡ç¿»è¯‘ç»“æœå·²æ›´æ–°"))}function f(_,z,T){if(_>=0&&_<o.value.length){const p=o.value[_];p&&(p.translationStatus=z,p.translationFailed=z==="failed",T&&(p.errorMessage=T),console.log(`å›¾ç‰‡ ${_} ç¿»è¯‘çŠ¶æ€: ${z}`))}}function m(_){a.value&&(a.value.translationStatus="failed",a.value.translationFailed=!0,a.value.errorMessage=_,console.log(`å½“å‰å›¾ç‰‡ç¿»è¯‘å¤±è´¥: ${_}`))}function $(){o.value.forEach(_=>{_.translationStatus="pending",_.translationFailed=!1,_.errorMessage=void 0}),console.log("æ‰€æœ‰å›¾ç‰‡ç¿»è¯‘çŠ¶æ€å·²é‡ç½®")}function v(_){d.value=_,_||(n.value=!1,l.value=null),console.log(`æ‰¹é‡ç¿»è¯‘çŠ¶æ€: ${_?"è¿›è¡Œä¸­":"å·²å®Œæˆ"}`)}function g(_){n.value=_,console.log(`æ‰¹é‡ç¿»è¯‘æš‚åœçŠ¶æ€: ${_?"å·²æš‚åœ":"ç»§ç»­ä¸­"}`)}function k(_){l.value=_}function Y(){if(n.value&&l.value){n.value=!1;const _=l.value;l.value=null,_(),console.log("æ‰¹é‡ç¿»è¯‘å·²ç»§ç»­")}}function F(){return o.value.map((_,z)=>_.translationFailed?z:-1).filter(_=>_!==-1)}return{images:o,currentImageIndex:t,isBatchTranslationInProgress:d,isBatchTranslationPaused:n,batchTranslationResumeCallback:l,currentImage:a,imageCount:s,hasImages:r,canGoPrevious:x,canGoNext:A,failedImageCount:w,completedImageCount:W,pendingImageCount:G,addImage:j,addImages:P,setImages:h,deleteImage:I,deleteCurrentImage:D,clearImages:E,sortImagesByFileName:c,setCurrentImageIndex:u,goToPrevious:y,goToNext:b,updateCurrentImage:R,updateImageByIndex:M,updateCurrentBubbleStates:J,setManuallyAnnotated:V,updateCurrentImageProperty:U,updateCurrentTranslationResult:O,setTranslationStatus:f,markCurrentAsFailed:m,resetAllTranslationStatus:$,setBatchTranslationInProgress:v,setBatchTranslationPaused:g,setBatchTranslationResumeCallback:k,resumeBatchTranslation:Y,getFailedImageIndices:F}}),Ho=Object.freeze(Object.defineProperty({__proto__:null,useImageStore:et},Symbol.toStringTag,{value:"Module"})),nn=At("session",()=>{const o=S(null),t=S({bookId:null,chapterId:null,bookTitle:null,chapterTitle:null}),d=S([]),n=S(!1),l=S({current:0,total:0,message:""}),a=S(null),s=S(!1),r=ee(()=>t.value.bookId!==null&&t.value.chapterId!==null),x=ee(()=>t.value.bookId),A=ee(()=>t.value.chapterId);function w(f,m,$=null,v=null){t.value={bookId:f,chapterId:m,bookTitle:$,chapterTitle:v},console.log(`ä¼šè¯ä¸Šä¸‹æ–‡å·²è®¾ç½®: ä¹¦ç±=${f}, ç« èŠ‚=${m}`)}function W(f,m,$,v){w(f,m,$,v)}function G(){t.value={bookId:null,chapterId:null,bookTitle:null,chapterTitle:null},console.log("ä¼šè¯ä¸Šä¸‹æ–‡å·²æ¸…é™¤")}function j(f){const m=f.get("book"),$=f.get("chapter");m&&$&&w(m,$)}function P(f){o.value=f,console.log(`å½“å‰ä¼šè¯åç§°: ${f}`)}function h(){o.value=null}function I(f){d.value=f,console.log(`ä¼šè¯åˆ—è¡¨å·²æ›´æ–°ï¼Œå…± ${f.length} ä¸ªä¼šè¯`)}function D(f){const m=d.value.findIndex($=>$.name===f.name);m>=0?d.value[m]=f:d.value.unshift(f)}function E(f){const m=d.value.findIndex($=>$.name===f);m>=0&&d.value.splice(m,1)}function c(f,m){const $=d.value.find(v=>v.name===f);$&&($.name=m)}function u(f){n.value=f}function y(f){s.value=f}function b(f){a.value=f}function R(f,m,$,v){return{name:f,version:"2.0",savedAt:new Date().toISOString(),imageCount:m.length,ui_settings:v,images:m.map(g=>({originalDataURL:g.originalDataURL,translatedDataURL:g.translatedDataURL||void 0,cleanImageData:g.cleanImageData||void 0,bubbleStates:g.bubbleStates||void 0,isManuallyAnnotated:g.isManuallyAnnotated||void 0,fileName:g.fileName,fontSize:g.fontSize,autoFontSize:g.autoFontSize,fontFamily:g.fontFamily,layoutDirection:g.layoutDirection,textColor:g.textColor,fillColor:g.fillColor,inpaintMethod:g.inpaintMethod,strokeEnabled:g.strokeEnabled,strokeColor:g.strokeColor,strokeWidth:g.strokeWidth,translationStatus:g.translationStatus,translationFailed:g.translationFailed})),currentImageIndex:$}}function M(){o.value=null,t.value={bookId:null,chapterId:null,bookTitle:null,chapterTitle:null},d.value=[],n.value=!1,s.value=!1,a.value=null,console.log("ä¼šè¯çŠ¶æ€å·²é‡ç½®")}async function J(f){if(!f||typeof f!="string")return null;if(f.startsWith("data:"))return f;if(!f.startsWith("/api/"))return null;try{const m=await fetch(f);if(!m.ok)return null;const $=await m.blob();return new Promise(v=>{const g=new FileReader;g.onloadend=()=>v(g.result),g.onerror=()=>v(null),g.readAsDataURL($)})}catch(m){return console.error(`è½¬æ¢å›¾ç‰‡ URL å¤±è´¥: ${f}`,m),null}}async function V(f,m){const $=f.length;for(let v=0;v<$;v++){const g=f[v];if(g){if(m&&m(v+1,$),g.originalDataURL&&g.originalDataURL.startsWith("/api/")){const k=await J(g.originalDataURL);k&&(g.originalDataURL=k)}if(g.translatedDataURL&&g.translatedDataURL.startsWith("/api/")){const k=await J(g.translatedDataURL);k&&(g.translatedDataURL=k)}if(g.cleanImageData&&g.cleanImageData.startsWith("/api/")){const k=await J(g.cleanImageData);k&&(g.cleanImageData=k.replace(/^data:image\/\w+;base64,/,""))}}}}async function U(f){u(!0),b(null),l.value={current:0,total:0,message:"æ­£åœ¨åŠ è½½..."};try{const{useImageStore:m}=await st(async()=>{const{useImageStore:p}=await Promise.resolve().then(()=>Ho);return{useImageStore:p}},void 0),{useSettingsStore:$}=await st(async()=>{const{useSettingsStore:p}=await import("./system.C6TM7-kx.js").then(K=>K.s);return{useSettingsStore:p}},__vite__mapDeps([0,1,2,3,4,5])),{useBubbleStore:v}=await st(async()=>{const{useBubbleStore:p}=await Promise.resolve().then(()=>xl);return{useBubbleStore:p}},void 0),g=m(),k=$(),Y=v(),{loadSessionByPathApi:F}=await st(async()=>{const{loadSessionByPathApi:p}=await import("./session.Kpy-QhBa.js");return{loadSessionByPathApi:p}},__vite__mapDeps([6,4,5])),_=await F(f);if(!_.success||!_.session)throw new Error(_.error||"åŠ è½½ä¼šè¯å¤±è´¥");const z=_.session;if(z.images&&z.images.length>0){const p=z.images.map((C,ie)=>({id:`session-${ie}-${Date.now()}`,originalDataURL:C.originalDataURL,translatedDataURL:C.translatedDataURL||null,cleanImageData:C.cleanImageData||null,bubbleStates:C.bubbleStates!==void 0&&C.bubbleStates!==null?C.bubbleStates:null,isManuallyAnnotated:!!C.isManuallyAnnotated,fileName:C.fileName||`image-${ie+1}.png`,translationStatus:C.translationStatus||"pending",translationFailed:!!C.translationFailed,hasUnsavedChanges:!1,fontSize:C.fontSize||24,autoFontSize:C.autoFontSize??!0,fontFamily:C.fontFamily||"Microsoft YaHei",layoutDirection:C.layoutDirection||"vertical",textColor:C.textColor||"#000000",fillColor:C.fillColor||"#FFFFFF",inpaintMethod:C.inpaintMethod||"litelama",strokeEnabled:C.strokeEnabled??!1,strokeColor:C.strokeColor||"#FFFFFF",strokeWidth:C.strokeWidth||2}));p.length>0&&(console.log("æ­£åœ¨åŠ è½½å›¾ç‰‡..."),l.value={current:0,total:p.length,message:"æ­£åœ¨åŠ è½½å›¾ç‰‡..."},await V(p,(C,ie)=>{const L=C/ie*100;l.value={current:C,total:ie,message:`åŠ è½½å›¾ç‰‡ ${C}/${ie}...`},console.log(`åŠ è½½å›¾ç‰‡ ${C}/${ie}... (${L.toFixed(0)}%)`)}),l.value={current:p.length,total:p.length,message:"åŠ è½½å®Œæˆ"},console.log("å›¾ç‰‡åŠ è½½å®Œæˆï¼Œå·²è½¬æ¢ä¸º Base64"),setTimeout(()=>{l.value={current:0,total:0,message:""}},500)),g.setImages(p);let K=0;typeof z.currentImageIndex=="number"&&(K=z.currentImageIndex,(K>=p.length||K<0)&&(K=p.length>0?0:-1)),g.setCurrentImageIndex(K);const i=p[K];i&&i.bubbleStates&&i.bubbleStates.length>0?Y.setBubbles(i.bubbleStates,!0):Y.clearBubblesLocal(),console.log(`æŒ‰è·¯å¾„åŠ è½½ä¼šè¯æˆåŠŸ: ${f}, å…± ${p.length} å¼ å›¾ç‰‡`)}const T=z.ui_settings;if(T){(T.targetLanguage||T.sourceLanguage)&&k.updateSettings({targetLanguage:T.targetLanguage||void 0,sourceLanguage:T.sourceLanguage||void 0});const p=T.useInpaintingMethod,i=["solid","lama_mpe","litelama"].includes(p)?p:k.settings.textStyle.inpaintMethod;k.updateTextStyle({fontSize:T.fontSize||k.settings.textStyle.fontSize,autoFontSize:T.autoFontSize??k.settings.textStyle.autoFontSize,fontFamily:T.fontFamily||k.settings.textStyle.fontFamily,layoutDirection:T.layoutDirection||k.settings.textStyle.layoutDirection,textColor:T.textColor||k.settings.textStyle.textColor,fillColor:T.fillColor||k.settings.textStyle.fillColor,inpaintMethod:i,strokeEnabled:T.strokeEnabled??k.settings.textStyle.strokeEnabled,strokeColor:T.strokeColor||k.settings.textStyle.strokeColor,strokeWidth:T.strokeWidth||k.settings.textStyle.strokeWidth}),console.log("UI è®¾ç½®å·²æ¢å¤")}return P(f),!0}catch(m){const $=m instanceof Error?m.message:"åŠ è½½ä¼šè¯å¤±è´¥";throw b($),console.error(`æŒ‰è·¯å¾„åŠ è½½ä¼šè¯å¤±è´¥: ${f}`,m),m}finally{u(!1)}}async function O(f,m){if(!f||!m)return console.log("æœªåœ¨ä¹¦ç±/ç« èŠ‚æ¨¡å¼ï¼Œä¸æ”¯æŒä¿å­˜"),!1;console.log(`ä¿å­˜ç« èŠ‚ä¼šè¯ï¼ˆåˆ†æ‰¹ï¼‰: book=${f}, chapter=${m}`);const{useImageStore:$}=await st(async()=>{const{useImageStore:_}=await Promise.resolve().then(()=>Ho);return{useImageStore:_}},void 0),{useSettingsStore:v}=await st(async()=>{const{useSettingsStore:_}=await import("./system.C6TM7-kx.js").then(z=>z.s);return{useSettingsStore:_}},__vite__mapDeps([0,1,2,3,4,5])),g=$(),k=v(),Y=Array.isArray(g.images)?g.images:[];if(!Y||Y.length===0)return console.log("æ²¡æœ‰å›¾ç‰‡æ•°æ®å¯ä¿å­˜"),!1;const F=`bookshelf/${f}/${m}`;y(!0),b(null),l.value={current:0,total:100,message:"å‡†å¤‡ä¿å­˜..."};try{const{batchSaveStartApi:_,batchSaveImageApi:z,batchSaveCompleteApi:T}=await st(async()=>{const{batchSaveStartApi:B,batchSaveImageApi:ne,batchSaveCompleteApi:oe}=await import("./session.Kpy-QhBa.js");return{batchSaveStartApi:B,batchSaveImageApi:ne,batchSaveCompleteApi:oe}},__vite__mapDeps([6,4,5])),p=Y.length;Y.some(B=>B.originalDataURL&&B.originalDataURL.startsWith("/api/")||B.translatedDataURL&&B.translatedDataURL.startsWith("/api/")||B.cleanImageData&&B.cleanImageData.startsWith("/api/"))&&(console.log("[saveChapterSession] æ£€æµ‹åˆ° /api/ URL æ ¼å¼å›¾ç‰‡ï¼Œå¼€å§‹è½¬æ¢ä¸º Base64..."),l.value={current:2,total:100,message:"è½¬æ¢å›¾ç‰‡æ ¼å¼..."},await V(Y,(B,ne)=>{const oe=2+B/ne*3;l.value={current:Math.round(oe),total:100,message:`è½¬æ¢å›¾ç‰‡ ${B}/${ne}...`}}),console.log("[saveChapterSession] å›¾ç‰‡æ ¼å¼è½¬æ¢å®Œæˆ")),l.value={current:5,total:100,message:"æ”¶é›†å…ƒæ•°æ®..."};const{textStyle:i,targetLanguage:C,sourceLanguage:ie}=k.settings,L={targetLanguage:C,sourceLanguage:ie,fontSize:i.fontSize,autoFontSize:i.autoFontSize,fontFamily:i.fontFamily,layoutDirection:i.layoutDirection,textColor:i.textColor,useInpaintingMethod:i.inpaintMethod,fillColor:i.fillColor,strokeEnabled:i.strokeEnabled,strokeColor:i.strokeColor,strokeWidth:i.strokeWidth},te=Y.map(B=>{const ne={};for(const oe of Object.keys(B))oe!=="originalDataURL"&&oe!=="translatedDataURL"&&oe!=="cleanImageData"&&(ne[oe]=B[oe]);return ne.hasOriginalData=!!B.originalDataURL,ne.hasTranslatedData=!!B.translatedDataURL,ne.hasCleanData=!!B.cleanImageData,ne}),ce={ui_settings:L,images_meta:te,currentImageIndex:g.currentImageIndex};l.value={current:10,total:100,message:"åˆå§‹åŒ–ä¿å­˜..."};const we=await _(F,ce);if(!we.success)throw new Error(we.error||"åˆå§‹åŒ–ä¿å­˜å¤±è´¥");const $e=we.session_folder;if(!$e)throw new Error("æœªè·å–åˆ°ä¼šè¯æ–‡ä»¶å¤¹è·¯å¾„");console.log(`ä¼šè¯æ–‡ä»¶å¤¹: ${$e}`);let Fe=0,Me=0;const Be=B=>!!B&&typeof B=="string"&&B.startsWith("data:");for(let B=0;B<p;B++){const ne=Y[B];if(!ne)continue;const oe=10+B/p*80;if(l.value={current:Math.round(oe),total:100,message:`ä¿å­˜å›¾ç‰‡ ${B+1}/${p}...`},Be(ne.originalDataURL))try{const se=await z($e,B,"original",ne.originalDataURL);se.success||(console.error(`ä¿å­˜å›¾ç‰‡ ${B} original å¤±è´¥:`,se.error),Me++)}catch(se){console.error(`ä¿å­˜å›¾ç‰‡ ${B} original å‡ºé”™:`,se),Me++}if(Be(ne.translatedDataURL))try{const se=await z($e,B,"translated",ne.translatedDataURL);se.success||(console.error(`ä¿å­˜å›¾ç‰‡ ${B} translated å¤±è´¥:`,se.error),Me++)}catch(se){console.error(`ä¿å­˜å›¾ç‰‡ ${B} translated å‡ºé”™:`,se),Me++}if(ne.cleanImageData&&typeof ne.cleanImageData=="string"&&!ne.cleanImageData.startsWith("/api/"))try{const se=await z($e,B,"clean",ne.cleanImageData);se.success||(console.error(`ä¿å­˜å›¾ç‰‡ ${B} clean å¤±è´¥:`,se.error),Me++)}catch(se){console.error(`ä¿å­˜å›¾ç‰‡ ${B} clean å‡ºé”™:`,se),Me++}Fe++}l.value={current:95,total:100,message:"å®Œæˆä¿å­˜..."};const H=await T($e,te);if(!H.success)throw new Error(H.error||"å®Œæˆä¿å­˜å¤±è´¥");return l.value={current:100,total:100,message:"ä¿å­˜å®Œæˆ"},console.log(`åˆ†æ‰¹ä¿å­˜å®Œæˆ: ${Fe} å¼ å›¾ç‰‡, ${Me} ä¸ªå¤±è´¥`),setTimeout(()=>{l.value={current:0,total:0,message:""}},1e3),!0}catch(_){const z=_ instanceof Error?_.message:"ä¿å­˜ç« èŠ‚ä¼šè¯å¤±è´¥";return b(z),console.error("åˆ†æ‰¹ä¿å­˜å¤±è´¥:",_),l.value={current:0,total:0,message:""},!1}finally{y(!1)}}return{currentSessionName:o,context:t,sessionList:d,isLoading:n,isSaving:s,error:a,loadingProgress:l,isBookshelfMode:r,currentBookId:x,currentChapterId:A,setContext:w,clearContext:G,parseContextFromUrl:j,setSessionName:P,clearSessionName:h,setSessionList:I,addToSessionList:D,removeFromSessionList:E,renameInSessionList:c,setLoading:u,setSaving:y,setError:b,createSessionData:R,imageUrlToBase64:J,saveChapterSession:O,loadSessionByPath:U,setBookChapterContext:W,reset:M}}),sn=At("webImport",()=>{const o=S(Ko()),t=S("idle"),d=S(""),n=S([]),l=S(null),a=S(new Set),s=S({current:0,total:0}),r=S([]),x=S(null),A=S(!1),w=ee(()=>t.value==="extracting"),W=ee(()=>t.value==="downloading"),G=ee(()=>w.value||W.value),j=ee(()=>a.value.size),P=ee(()=>s.value.total===0?0:Math.round(s.value.current/s.value.total*100));function h(){try{localStorage.setItem(Eo,JSON.stringify(o.value))}catch(g){console.error("ä¿å­˜ç½‘é¡µå¯¼å…¥è®¾ç½®å¤±è´¥:",g)}}function I(){try{const g=localStorage.getItem(Eo);if(g){const k=JSON.parse(g);o.value=D(Ko(),k)}}catch(g){console.error("åŠ è½½ç½‘é¡µå¯¼å…¥è®¾ç½®å¤±è´¥:",g)}}function D(g,k){const Y={...g};for(const F in k)if(Object.prototype.hasOwnProperty.call(k,F)){const _=k[F],z=g[F];_!==null&&typeof _=="object"&&!Array.isArray(_)&&z!==null&&typeof z=="object"&&!Array.isArray(z)?Y[F]=D(z,_):_!==void 0&&(Y[F]=_)}return Y}function E(){A.value=!0}function c(){A.value=!1}function u(){t.value="idle",d.value="",n.value=[],l.value=null,a.value=new Set,s.value={current:0,total:0},r.value=[],x.value=null}function y(g){d.value=g}function b(g){n.value.push(g)}function R(){n.value=[]}function M(g){l.value&&l.value.pages.length>0?(l.value.comicTitle=g.comicTitle,l.value.chapterTitle=g.chapterTitle,l.value.totalPages=g.totalPages,l.value.sourceUrl=g.sourceUrl,l.value.referer=g.referer,l.value.engine=g.engine,l.value.success=g.success,l.value.error=g.error):(l.value=g,g.success&&g.pages&&(a.value=new Set(g.pages.map(k=>k.pageNumber))))}function J(g){a.value.has(g)?a.value.delete(g):a.value.add(g),a.value=new Set(a.value)}function V(){l.value?.pages&&(a.value.size===l.value.pages.length?a.value=new Set:a.value=new Set(l.value.pages.map(g=>g.pageNumber)))}function U(g){t.value=g}function O(g){x.value=g,g&&(t.value="error")}function f(g,k){s.value={current:g,total:k}}function m(g){r.value=g}function $(g){l.value||(l.value={success:!0,comicTitle:"",chapterTitle:"",pages:[],totalPages:0,sourceUrl:d.value,referer:"",engine:"gallery-dl"}),l.value.pages.push(g),l.value.totalPages=l.value.pages.length,a.value.add(g.pageNumber),a.value=new Set(a.value)}const v=cs(o,h);return I(),{settings:o,status:t,url:d,logs:n,extractResult:l,selectedPages:a,downloadProgress:s,downloadedImages:r,error:x,modalVisible:A,isExtracting:w,isDownloading:W,isProcessing:G,selectedCount:j,downloadProgressPercent:P,saveToStorage:h,loadFromStorage:I,openModal:E,closeModal:c,resetState:u,setUrl:y,addLog:b,clearLogs:R,setExtractResult:M,togglePageSelection:J,toggleSelectAll:V,setStatus:U,setError:O,updateDownloadProgress:f,setDownloadedImages:m,addPageIncremental:$,...v}}),Ts={key:0,class:"translation-progress-bar"},Ds={class:"progress-bar-label"},Rs={class:"progress-bar"},Ms=He({__name:"ProgressBar",props:{visible:{type:Boolean,default:!0},percentage:{},label:{default:"è¿›åº¦"}},setup(o){return(t,d)=>o.visible?(N(),q("div",Ts,[e("div",Ds,le(o.label),1),e("div",Rs,[e("div",{class:"progress",style:at({width:`${o.percentage}%`})},null,4)])])):de("",!0)}}),po=qe(Ms,[["__scopeId","data-v-f915cadf"]]),Bs={class:"image-upload"},Ps={class:"error-text"},Es={key:2,class:"loading-overlay"},As=He({__name:"ImageUpload",emits:["uploadComplete"],setup(o,{expose:t,emit:d}){const n=d,l=et(),a=Je(),s=sn(),r=S(null),x=S(!1),A=S(!1),w=S(""),W=S(0),G=S(""),j=S(!1),P=ee(()=>a.settings.pdfProcessingMethod);function h(){r.value?.click()}function I(){s.openModal()}async function D(f){const m=f.target;!m.files||m.files.length===0||(await y(Array.from(m.files)),m.value="")}async function E(f){f.preventDefault(),A.value=!1,!(!f.dataTransfer?.files||f.dataTransfer.files.length===0)&&await y(Array.from(f.dataTransfer.files))}function c(f){f.preventDefault(),A.value=!0}function u(f){const m=f.currentTarget.getBoundingClientRect(),$=f.clientX,v=f.clientY;($<m.left||$>m.right||v<m.top||v>m.bottom)&&(A.value=!1)}async function y(f){if(f.length!==0){x.value=!0,w.value="",j.value=!0,W.value=0;try{let m=0;const $=f.length;for(let v=0;v<f.length;v++){const g=f[v];if(!g)continue;G.value=g.name;const k=g.type,Y=g.name.toLowerCase();if(k.startsWith("image/"))await b(g),m++;else if(k==="application/pdf"||Y.endsWith(".pdf")){const F=await R(g);m+=F}else if(Y.endsWith(".mobi")||Y.endsWith(".azw")||Y.endsWith(".azw3")){const F=await U(g);m+=F}else console.warn(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${g.name}`),me(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${g.name}`,"warning");W.value=Math.round((v+1)/$*100)}m>0&&(me(`å·²æ·»åŠ  ${m} å¼ å›¾ç‰‡`,"success"),n("uploadComplete",m))}catch(m){console.error("å¤„ç†æ–‡ä»¶å¤±è´¥:",m);const $=m instanceof Error?m.message:"å¤„ç†æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•";w.value=$,me($,"error")}finally{x.value=!1,j.value=!1,G.value=""}}}async function b(f){return new Promise((m,$)=>{const v=new FileReader;v.onload=g=>{const k=g.target?.result;l.addImage(f.name,k),m()},v.onerror=()=>$(new Error(`è¯»å–å›¾ç‰‡æ–‡ä»¶å¤±è´¥: ${f.name}`)),v.readAsDataURL(f)})}async function R(f){return P.value==="frontend"?await J(f):await V(f)}function M(f){return new Promise((m,$)=>{const v=new FileReader;v.onload=()=>m(v.result),v.onerror=$,v.readAsDataURL(f)})}async function J(f){try{const m=await st(()=>import("./pdf.U7tdldy2.js").then(F=>F.p),[]);m.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${m.version}/pdf.worker.min.js`;const $=await f.arrayBuffer(),v=await m.getDocument({data:$}).promise,g=v.numPages;console.log(`PDF ${f.name} å…± ${g} é¡µï¼Œå¼€å§‹æœ¬åœ°æ¸²æŸ“...`),me(`æ­£åœ¨è§£æ PDFï¼Œå…± ${g} é¡µ...`,"info");const k=typeof OffscreenCanvas<"u";k&&console.log("ä½¿ç”¨ OffscreenCanvas åå°æ¸²æŸ“æ¨¡å¼");let Y=0;for(let F=1;F<=g;F++){G.value=`${f.name} - ç¬¬ ${F}/${g} é¡µ`,W.value=Math.round(F/g*100);try{const _=await v.getPage(F),T=_.getViewport({scale:2});let p;if(k){const i=new OffscreenCanvas(T.width,T.height),C=i.getContext("2d");await _.render({canvasContext:C,viewport:T}).promise;const ie=await i.convertToBlob({type:"image/jpeg",quality:1});p=await M(ie)}else{const i=document.createElement("canvas"),C=i.getContext("2d");i.width=T.width,i.height=T.height,await _.render({canvasContext:C,viewport:T}).promise,p=i.toDataURL("image/jpeg",1)}const K=`${f.name}_é¡µé¢${F}`;l.addImage(K,p),Y++,console.log(`  é¡µé¢ ${F}/${g} å¤„ç†å®Œæˆ`)}catch(_){console.warn(`PDF ${f.name} ç¬¬ ${F} é¡µæ¸²æŸ“å¤±è´¥:`,_)}}return console.log(`PDF ${f.name} å…¨éƒ¨ ${g} é¡µå¤„ç†å®Œæˆ`),Y}catch(m){return console.error("å‰ç«¯ PDF è§£æå¤±è´¥:",m),me("å‰ç«¯ PDF è§£æå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨åç«¯è§£æ...","warning"),await V(f)}}async function V(f){let $=null;try{me("æ­£åœ¨ä¸Šä¼  PDF æ–‡ä»¶...","info");const v=await Yn(f,5);if(!v.success||!v.session_id)throw new Error(v.error||"PDF è§£æå¯åŠ¨å¤±è´¥");$=v.session_id;const g=v.total_pages||0;console.log(`PDF ${f.name} å…± ${g} é¡µï¼Œå¼€å§‹åç«¯åˆ†æ‰¹è§£æ...`),me(`æ­£åœ¨è§£æ PDFï¼Œå…± ${g} é¡µ...`,"info");let k=0;for(let Y=0;Y<g;Y+=5){G.value=`${f.name} - å¤„ç†ä¸­ ${Math.min(Y+5,g)}/${g} é¡µ`,W.value=g>0?Math.round(Y/g*100):0;const F=await Gn($,Y,5);if(!F.success){console.warn(`æ‰¹æ¬¡ ${Y} è·å–å¤±è´¥:`,F.error);continue}if(F.images&&F.images.length>0)for(const _ of F.images){if(!_||!_.data_url)continue;const z=`${f.name}_é¡µé¢${String(_.page_index+1).padStart(4,"0")}`;l.addImage(z,_.data_url),k++}console.log(`  å·²åŠ è½½ ${k}/${g} é¡µ`)}return console.log(`PDF ${f.name} å…¨éƒ¨ ${k} é¡µå¤„ç†å®Œæˆ`),k}catch(v){throw console.error("åç«¯ PDF è§£æå¤±è´¥:",v),v}finally{if($)try{await Xn($)}catch(v){console.warn("PDF ä¼šè¯æ¸…ç†å¤±è´¥:",v)}}}async function U(f){let m=null;try{me("æ­£åœ¨ä¸Šä¼ ç”µå­ä¹¦æ–‡ä»¶...","info");const $=await Zn(f,5);if(!$.success||!$.session_id)throw new Error($.error||"MOBI/AZW è§£æå¯åŠ¨å¤±è´¥");m=$.session_id;const v=$.total_images||0;me(`æ­£åœ¨è§£æç”µå­ä¹¦ï¼Œå…± ${v} å¼ å›¾ç‰‡...`,"info");let g=0,k=!0;for(;k;){G.value=`${f.name} - å·²å¤„ç† ${g}/${v} å¼ `,W.value=v>0?Math.round(g/v*100):0;const Y=await Qn(m);if(!Y.success)throw new Error(Y.error||"MOBI/AZW æ‰¹æ¬¡è§£æå¤±è´¥");if(Y.images&&Y.images.length>0){for(let F=0;F<Y.images.length;F++){const _=Y.images[F];if(!_)continue;const z=g+F+1,T=`${f.name.replace(/\.(mobi|azw|azw3)$/i,"")}_image_${String(z).padStart(3,"0")}.png`,p=_.startsWith("data:")?_:`data:image/png;base64,${_}`;l.addImage(T,p)}g+=Y.images.length}k=Y.has_more??!1}return g}catch($){throw console.error("MOBI/AZW è§£æå¤±è´¥:",$),$}finally{if(m)try{await es(m)}catch($){console.warn("MOBI/AZW ä¼šè¯æ¸…ç†å¤±è´¥:",$)}}}function O(){w.value=""}return t({triggerFileSelect:h,processFiles:y,clearError:O}),(f,m)=>(N(),q("div",Bs,[e("div",{id:"drop-area",class:Ie(["drop-area",{"drag-over":A.value,loading:x.value}]),onDragover:c,onDragleave:u,onDrop:E},[e("div",{class:"drop-content"},[e("p",{class:"drop-text"},[m[0]||(m[0]=Se(" æ‹–æ‹½å›¾ç‰‡ã€PDFæˆ–MOBIæ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ– ",-1)),e("span",{class:"select-link",onClick:h}," ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ "),m[1]||(m[1]=e("span",{class:"separator"}," | ",-1)),e("span",{class:"select-link web-import-link",onClick:I}," ğŸŒ ä»ç½‘é¡µå¯¼å…¥ ")])]),e("input",{ref_key:"fileInputRef",ref:r,type:"file",id:"imageUpload",accept:"image/*,application/pdf,.mobi,.azw,.azw3",multiple:"",class:"file-input",onChange:D},null,544)],34),j.value?(N(),lt(po,{key:0,visible:!0,percentage:W.value,label:G.value||"å¤„ç†ä¸­..."},null,8,["percentage","label"])):de("",!0),w.value?(N(),q("div",{key:1,class:"error-message",onClick:O},[m[2]||(m[2]=e("span",{class:"error-icon"},"âš ï¸",-1)),e("span",Ps,le(w.value),1),m[3]||(m[3]=e("span",{class:"error-close"},"Ã—",-1))])):de("",!0),x.value&&!j.value?(N(),q("div",Es,[...m[4]||(m[4]=[e("div",{class:"spinner"},null,-1),e("span",{class:"loading-text"},"å¤„ç†ä¸­...",-1)])])):de("",!0)]))}}),Fs=qe(As,[["__scopeId","data-v-ffdddfae"]]),Ls={id:"settings-sidebar",class:"settings-sidebar"},Us={class:"card settings-card"},Os={id:"font-settings",class:"settings-card collapsible-panel"},zs={class:"toggle-icon"},Ns={class:"collapsible-content"},Vs={class:"settings-form"},Ws={class:"form-group"},Ks=["value","disabled","title"],qs={class:"auto-fontSize-option",title:"å‹¾é€‰åï¼Œé¦–æ¬¡ç¿»è¯‘æ—¶è‡ªåŠ¨ä¸ºæ¯ä¸ªæ°”æ³¡è®¡ç®—åˆé€‚çš„å­—å·"},Hs=["checked"],Js={class:"form-group"},js={class:"form-group"},Ys={class:"form-group"},Gs={class:"color-with-auto"},Xs={class:"auto-color-toggle",title:"ç¿»è¯‘æ—¶è‡ªåŠ¨ä½¿ç”¨è¯†åˆ«åˆ°çš„æ–‡å­—é¢œè‰²"},Zs=["checked"],Qs=["value","disabled"],ea={key:0,class:"auto-color-hint"},ta={class:"form-group"},oa={class:"checkbox-label"},na=["checked"],sa={key:0,id:"strokeOptions",class:"stroke-options"},aa={class:"form-group"},la=["value"],ia={class:"form-group"},ra=["value"],ua={class:"form-group"},ca={key:0,id:"solidColorOptions",class:"form-group"},da=["value"],ga={class:"apply-settings-group"},pa=["disabled"],va={key:0,class:"apply-options-dropdown"},ma={class:"apply-option"},ba=["checked"],fa={class:"apply-option"},ha={class:"apply-option"},ya={class:"apply-option"},xa={class:"apply-option"},ka={class:"apply-option"},_a={class:"apply-option"},Sa={class:"apply-option"},Ca={class:"apply-option"},wa={class:"action-buttons"},$a=["disabled"],Ia=["disabled"],Ta=["disabled"],Da=["disabled"],Ra=["disabled"],Ma=["disabled"],Ba=["disabled"],Pa=["disabled"],Ea={class:"navigation-buttons"},Aa=["disabled"],Fa=["disabled"],La=He({__name:"SettingsSidebar",emits:["translateCurrent","translateAll","hqTranslate","proofread","removeText","removeAllText","deleteCurrent","clearAll","cleanTemp","openPlugins","openSettings","previous","next","applyToAll","textStyleChanged","autoFontSizeChanged"],setup(o,{emit:t}){const d=t,n=et(),l=Je(),a=S(!0),s=S(!1),r=S({fontSize:!0,fontFamily:!0,layoutDirection:!0,textColor:!0,fillColor:!0,strokeEnabled:!0,strokeColor:!0,strokeWidth:!0}),x=[{label:"è‡ªåŠ¨ (æ ¹æ®æ£€æµ‹)",value:"auto"},{label:"ç«–å‘æ’ç‰ˆ",value:"vertical"},{label:"æ¨ªå‘æ’ç‰ˆ",value:"horizontal"}],A=[{label:"çº¯è‰²å¡«å……",value:"solid"},{label:"LAMAä¿®å¤ (é€Ÿåº¦ä¼˜åŒ–)",value:"lama_mpe"},{label:"LAMAä¿®å¤ (é€šç”¨)",value:"litelama"}],w=ee(()=>n.currentImage),W=ee(()=>n.hasImages),G=ee(()=>W.value&&!n.isBatchTranslationInProgress),j=ee(()=>n.canGoPrevious),P=ee(()=>n.canGoNext),h=ee(()=>l.textStyle),I=S([]),D=["fonts/STSONG.TTF","fonts/msyh.ttc","fonts/simhei.ttf","fonts/simsun.ttc"],E=S(null),c=ee(()=>{const T=I.value.map(p=>({label:J(p),value:p}));return T.push({label:"è‡ªå®šä¹‰å­—ä½“...",value:"custom-font"}),T});ut(async()=>{await u();const T=h.value.fontFamily;T&&!I.value.includes(T)&&(I.value=[T,...I.value])});async function u(){try{const T=await en();if(T.fonts&&Array.isArray(T.fonts)&&T.fonts.length>0){const p=T.fonts[0];if(typeof p=="object"&&"path"in p){const K=T.fonts.map(i=>typeof i=="object"?i.path:i);I.value=K}else I.value=T.fonts}else I.value=[...D]}catch(T){console.error("åŠ è½½å­—ä½“åˆ—è¡¨å¤±è´¥:",T),I.value=[...D]}}function y(){a.value=!a.value}function b(T){const p=parseInt(T.target.value);isNaN(p)||(l.updateTextStyle({fontSize:p}),d("textStyleChanged","fontSize",p))}function R(T){const p=T.target.checked;l.updateTextStyle({autoFontSize:p}),console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${p}`),d("autoFontSizeChanged",p)}async function M(T){const p=T.target,K=p.files?.[0];if(!K)return;const i=[".ttf",".ttc",".otf"],C=K.name.toLowerCase();if(!i.some(L=>C.endsWith(L))){me("è¯·é€‰æ‹© .ttfã€.ttc æˆ– .otf æ ¼å¼çš„å­—ä½“æ–‡ä»¶","error"),p.value="";return}try{const L=await as(K);L.success&&L.fontPath?(await u(),l.updateTextStyle({fontFamily:L.fontPath}),me("å­—ä½“ä¸Šä¼ æˆåŠŸ","success")):me(L.error||"å­—ä½“ä¸Šä¼ å¤±è´¥","error")}catch(L){console.error("å­—ä½“ä¸Šä¼ å¤±è´¥:",L),me("å­—ä½“ä¸Šä¼ å¤±è´¥","error")}finally{p.value=""}}function J(T){const p={"fonts/STXINGKA.TTF":"åæ–‡è¡Œæ¥·","fonts/STXINWEI.TTF":"åæ–‡æ–°é­","fonts/STZHONGS.TTF":"åæ–‡ä¸­å®‹","fonts/STKAITI.TTF":"æ¥·ä½“","fonts/STLITI.TTF":"éš¶ä¹¦","fonts/STSONG.TTF":"åæ–‡å®‹ä½“","fonts/msyh.ttc":"å¾®è½¯é›…é»‘","fonts/msyhbd.ttc":"å¾®è½¯é›…é»‘ç²—ä½“","fonts/SIMYOU.TTF":"å¹¼åœ†","fonts/STFANGSO.TTF":"ä»¿å®‹","fonts/STHUPO.TTF":"åæ–‡ç¥ç€","fonts/STXIHEI.TTF":"åæ–‡ç»†é»‘","fonts/simkai.ttf":"ä¸­æ˜“æ¥·ä½“","fonts/simfang.ttf":"ä¸­æ˜“ä»¿å®‹","fonts/simhei.ttf":"ä¸­æ˜“é»‘ä½“","fonts/SIMLI.TTF":"ä¸­æ˜“éš¶ä¹¦","fonts/simsun.ttc":"å®‹ä½“"};if(p[T])return p[T];const K=T.split("/").pop()||T;for(const[i,C]of Object.entries(p))if((i.split("/").pop()||"").toLowerCase()===K.toLowerCase())return C;return K.replace(/\.(ttf|ttc|otf)$/i,"")}function V(T){const p=String(T);if(p==="custom-font"){E.value?.click();return}l.updateTextStyle({fontFamily:p}),d("textStyleChanged","fontFamily",p)}function U(T){const p=String(T);l.updateTextStyle({layoutDirection:p}),d("textStyleChanged","layoutDirection",p)}function O(T){const p=String(T);l.updateTextStyle({inpaintMethod:p})}function f(T){const p=T.target.value;l.updateTextStyle({textColor:p}),d("textStyleChanged","textColor",p)}function m(T){const p=T.target.checked;l.updateTextStyle({useAutoTextColor:p})}function $(T){const p=T.target.checked;l.updateTextStyle({strokeEnabled:p}),d("textStyleChanged","strokeEnabled",p)}function v(T){const p=T.target.value;l.updateTextStyle({strokeColor:p}),d("textStyleChanged","strokeColor",p)}function g(T){const p=parseInt(T.target.value);isNaN(p)||(l.updateTextStyle({strokeWidth:p}),d("textStyleChanged","strokeWidth",p))}function k(T){const p=T.target.value;l.updateTextStyle({fillColor:p}),d("textStyleChanged","fillColor",p)}function Y(){s.value=!s.value}function F(){const p=!Object.values(r.value).every(K=>K);r.value={fontSize:p,fontFamily:p,layoutDirection:p,textColor:p,fillColor:p,strokeEnabled:p,strokeColor:p,strokeWidth:p}}function _(){d("applyToAll",{...r.value}),s.value=!1}function z(T){T.target.closest(".apply-settings-group")||(s.value=!1)}return typeof window<"u"&&window.addEventListener("click",z),(T,p)=>(N(),q("aside",Ls,[e("div",Us,[p[43]||(p[43]=e("h2",null,"ç¿»è¯‘è®¾ç½®",-1)),e("div",Os,[e("h3",{class:"collapsible-header",onClick:y},[p[20]||(p[20]=Se(" æ–‡å­—è®¾ç½® ",-1)),e("span",zs,le(a.value?"â–¼":"â–¶"),1)]),ae(e("div",Ns,[e("div",Vs,[e("div",Ws,[p[22]||(p[22]=e("label",{for:"fontSize"},"å­—å·å¤§å°:",-1)),e("input",{type:"number",id:"fontSize",value:h.value.fontSize,min:"10",max:"100",disabled:h.value.autoFontSize,class:Ie({"disabled-input":h.value.autoFontSize}),title:h.value.autoFontSize?"å·²å¯ç”¨è‡ªåŠ¨å­—å·ï¼Œé¦–æ¬¡ç¿»è¯‘æ—¶å°†è‡ªåŠ¨è®¡ç®—":"",onInput:b},null,42,Ks),e("span",qs,[e("input",{type:"checkbox",id:"autoFontSize",checked:h.value.autoFontSize,onChange:R},null,40,Hs),p[21]||(p[21]=e("label",{for:"autoFontSize"},"è‡ªåŠ¨è®¡ç®—åˆå§‹å­—å·",-1))])]),e("div",Js,[p[23]||(p[23]=e("label",{for:"fontFamily"},"æ–‡æœ¬å­—ä½“:",-1)),be(ze,{"model-value":h.value.fontFamily,options:c.value,onChange:V},null,8,["model-value","options"]),e("input",{ref_key:"fontUploadInput",ref:E,type:"file",id:"fontUpload",accept:".ttf,.ttc,.otf",style:{display:"none"},onChange:M},null,544)]),e("div",js,[p[24]||(p[24]=e("label",{for:"layoutDirection"},"æ’ç‰ˆè®¾ç½®:",-1)),be(ze,{"model-value":h.value.layoutDirection,options:x,onChange:U},null,8,["model-value"])]),e("div",Ys,[p[26]||(p[26]=e("label",{for:"textColor"},"æ–‡å­—é¢œè‰²:",-1)),e("div",Gs,[e("label",Xs,[e("input",{type:"checkbox",checked:h.value.useAutoTextColor,onChange:m},null,40,Zs),p[25]||(p[25]=e("span",null,"è‡ªåŠ¨",-1))]),e("input",{type:"color",id:"textColor",value:h.value.textColor,disabled:h.value.useAutoTextColor,onInput:f},null,40,Qs)]),h.value.useAutoTextColor?(N(),q("div",ea," ğŸ’¡ ç¿»è¯‘æ—¶å°†è‡ªåŠ¨ä½¿ç”¨è¯†åˆ«åˆ°çš„æ–‡å­—é¢œè‰² ")):de("",!0)]),e("div",ta,[e("span",oa,[e("input",{type:"checkbox",id:"strokeEnabled",checked:h.value.strokeEnabled,onChange:$},null,40,na),p[27]||(p[27]=e("label",{for:"strokeEnabled"},"å¯ç”¨æ–‡æœ¬æè¾¹:",-1))])]),be(Vo,{name:"stroke-slide"},{default:ht(()=>[h.value.strokeEnabled?(N(),q("div",sa,[e("div",aa,[p[28]||(p[28]=e("label",{for:"strokeColor"},"æè¾¹é¢œè‰²:",-1)),e("input",{type:"color",id:"strokeColor",value:h.value.strokeColor,onInput:v},null,40,la)]),e("div",ia,[p[29]||(p[29]=e("label",{for:"strokeWidth"},"æè¾¹å®½åº¦ (px):",-1)),e("input",{type:"number",id:"strokeWidth",value:h.value.strokeWidth,min:"0",max:"10",style:{width:"60px",padding:"5px"},onInput:g},null,40,ra),p[30]||(p[30]=e("div",{class:"input-hint"},"0 è¡¨ç¤ºæ— æè¾¹ã€‚",-1))])])):de("",!0)]),_:1}),e("div",ua,[p[31]||(p[31]=e("label",{for:"useInpainting"},"æ°”æ³¡å¡«å……æ–¹å¼:",-1)),be(ze,{"model-value":h.value.inpaintMethod,options:A,onChange:O},null,8,["model-value"])]),be(Vo,{name:"slide-fade"},{default:ht(()=>[h.value.inpaintMethod==="solid"?(N(),q("div",ca,[p[32]||(p[32]=e("label",{for:"fillColor"},"å¡«å……é¢œè‰²:",-1)),e("input",{type:"color",id:"fillColor",value:h.value.fillColor,onInput:k},null,40,da)])):de("",!0)]),_:1})]),e("div",ga,[e("button",{type:"button",class:"settings-button",disabled:!W.value,onClick:_}," åº”ç”¨åˆ°å…¨éƒ¨ ",8,pa),e("button",{type:"button",class:"settings-gear-btn",title:"é€‰æ‹©è¦åº”ç”¨çš„å‚æ•°",onClick:Y}," âš™ï¸ "),s.value?(N(),q("div",va,[e("div",ma,[e("input",{type:"checkbox",id:"apply_selectAll",checked:Object.values(r.value).every(K=>K),onChange:F},null,40,ba),p[33]||(p[33]=e("label",{for:"apply_selectAll"},"å…¨é€‰",-1))]),p[42]||(p[42]=e("hr",null,null,-1)),e("div",fa,[ae(e("input",{type:"checkbox",id:"apply_fontSize","onUpdate:modelValue":p[0]||(p[0]=K=>r.value.fontSize=K)},null,512),[[Qe,r.value.fontSize]]),p[34]||(p[34]=e("label",{for:"apply_fontSize"},"å­—å·",-1))]),e("div",ha,[ae(e("input",{type:"checkbox",id:"apply_fontFamily","onUpdate:modelValue":p[1]||(p[1]=K=>r.value.fontFamily=K)},null,512),[[Qe,r.value.fontFamily]]),p[35]||(p[35]=e("label",{for:"apply_fontFamily"},"å­—ä½“",-1))]),e("div",ya,[ae(e("input",{type:"checkbox",id:"apply_layoutDirection","onUpdate:modelValue":p[2]||(p[2]=K=>r.value.layoutDirection=K)},null,512),[[Qe,r.value.layoutDirection]]),p[36]||(p[36]=e("label",{for:"apply_layoutDirection"},"æ’ç‰ˆæ–¹å‘",-1))]),e("div",xa,[ae(e("input",{type:"checkbox",id:"apply_textColor","onUpdate:modelValue":p[3]||(p[3]=K=>r.value.textColor=K)},null,512),[[Qe,r.value.textColor]]),p[37]||(p[37]=e("label",{for:"apply_textColor"},"æ–‡å­—é¢œè‰²",-1))]),e("div",ka,[ae(e("input",{type:"checkbox",id:"apply_fillColor","onUpdate:modelValue":p[4]||(p[4]=K=>r.value.fillColor=K)},null,512),[[Qe,r.value.fillColor]]),p[38]||(p[38]=e("label",{for:"apply_fillColor"},"å¡«å……é¢œè‰²",-1))]),e("div",_a,[ae(e("input",{type:"checkbox",id:"apply_strokeEnabled","onUpdate:modelValue":p[5]||(p[5]=K=>r.value.strokeEnabled=K)},null,512),[[Qe,r.value.strokeEnabled]]),p[39]||(p[39]=e("label",{for:"apply_strokeEnabled"},"æè¾¹å¼€å…³",-1))]),e("div",Sa,[ae(e("input",{type:"checkbox",id:"apply_strokeColor","onUpdate:modelValue":p[6]||(p[6]=K=>r.value.strokeColor=K)},null,512),[[Qe,r.value.strokeColor]]),p[40]||(p[40]=e("label",{for:"apply_strokeColor"},"æè¾¹é¢œè‰²",-1))]),e("div",Ca,[ae(e("input",{type:"checkbox",id:"apply_strokeWidth","onUpdate:modelValue":p[7]||(p[7]=K=>r.value.strokeWidth=K)},null,512),[[Qe,r.value.strokeWidth]]),p[41]||(p[41]=e("label",{for:"apply_strokeWidth"},"æè¾¹å®½åº¦",-1))])])):de("",!0)])],512),[[Ue,a.value]])]),e("div",wa,[e("button",{id:"translateButton",disabled:!G.value,onClick:p[8]||(p[8]=K=>d("translateCurrent"))}," ç¿»è¯‘å½“å‰å›¾ç‰‡ ",8,$a),e("button",{id:"translateAllButton",disabled:!G.value,onClick:p[9]||(p[9]=K=>d("translateAll"))}," ç¿»è¯‘æ‰€æœ‰å›¾ç‰‡ ",8,Ia),e("button",{id:"startHqTranslationBtn",class:"settings-button purple-button",disabled:!G.value,title:"ä½¿ç”¨é«˜è´¨é‡ç¿»è¯‘æ¨¡å¼ï¼ˆéœ€åœ¨è®¾ç½®ä¸­é…ç½®ï¼‰",onClick:p[10]||(p[10]=K=>d("hqTranslate"))}," é«˜è´¨é‡ç¿»è¯‘ ",8,Ta),e("button",{id:"proofreadButton",disabled:!G.value,onClick:p[11]||(p[11]=K=>d("proofread"))}," AIæ ¡å¯¹ ",8,Da),e("button",{id:"removeTextOnlyButton",disabled:!w.value,title:"æ¶ˆé™¤å›¾ç‰‡ä¸­çš„æ°”æ³¡æ–‡å­—ï¼Œæ— éœ€å¡«å†™ç¿»è¯‘æœåŠ¡å•†å’ŒAPI Key",onClick:p[12]||(p[12]=K=>d("removeText"))}," ä»…æ¶ˆé™¤æ–‡å­— ",8,Ra),e("button",{id:"removeAllTextButton",disabled:!W.value,title:"æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡ä¸­çš„æ°”æ³¡æ–‡å­—ï¼Œæ— éœ€å¡«å†™ç¿»è¯‘æœåŠ¡å•†å’ŒAPI Key",onClick:p[13]||(p[13]=K=>d("removeAllText"))}," æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡æ–‡å­— ",8,Ma),e("button",{id:"deleteCurrentImageButton",class:"settings-button red-button",disabled:!w.value,onClick:p[14]||(p[14]=K=>d("deleteCurrent"))}," åˆ é™¤å½“å‰å›¾ç‰‡ ",8,Ba),e("button",{id:"clearAllImagesButton",class:"settings-button red-button",disabled:!W.value,onClick:p[15]||(p[15]=K=>d("clearAll"))}," æ¸…é™¤æ‰€æœ‰å›¾ç‰‡ ",8,Pa),e("button",{id:"cleanDebugFilesButton",class:"settings-button orange-button",onClick:p[16]||(p[16]=K=>d("cleanTemp"))}," æ¸…ç†ä¸´æ—¶æ–‡ä»¶ "),e("button",{id:"managePluginsButton",class:"settings-button blue-button",onClick:p[17]||(p[17]=K=>d("openPlugins"))}," æ’ä»¶ç®¡ç† ")]),e("div",Ea,[e("button",{id:"prevImageButton",disabled:!j.value,onClick:p[18]||(p[18]=K=>d("previous"))}," ä¸Šä¸€å¼  ",8,Aa),e("button",{id:"nextImageButton",disabled:!P.value,onClick:p[19]||(p[19]=K=>d("next"))}," ä¸‹ä¸€å¼  ",8,Fa)])])]))}}),Ua=qe(La,[["__scopeId","data-v-df51db99"]]);function _t(o){if(o.textDirection&&o.textDirection!=="auto")return o.textDirection;if(o.autoTextDirection&&o.autoTextDirection!=="auto")return o.autoTextDirection;if(o.coords){const[t,d,n,l]=o.coords;return l-d>n-t?"vertical":"horizontal"}return"vertical"}function Oa(){const o=et(),t=Je(),d=rt(),n=S(!1),l=S(0),a=S(""),s=S(!1),r=S(0),x=S(""),A=ee(()=>o.hasImages),w=ee(()=>o.hasImages),W=ee(()=>o.hasImages);function G(){const c=o.images;if(c.length===0){d.warning("æ²¡æœ‰å¯å¯¼å‡ºçš„å›¾ç‰‡æ–‡æœ¬");return}const u=[];for(let U=0;U<c.length;U++){const O=c[U];if(!O)continue;const f=O.bubbleStates||[],m={imageIndex:U,bubbles:[]};for(let $=0;$<f.length;$++){const v=f[$];if(!v)continue;const g=v.originalText||"",k=v.translatedText||v.textboxText||"";let Y="vertical";v.textDirection&&v.textDirection!=="auto"?Y=v.textDirection:v.autoTextDirection&&(Y=v.autoTextDirection),m.bubbles.push({bubbleIndex:$,original:g,translated:k,textDirection:Y})}u.push(m)}const y=JSON.stringify(u,null,2),b=new Blob([y],{type:"application/json"}),R=URL.createObjectURL(b),M=document.createElement("a");M.href=R;const V=new Date().toISOString().replace(/[-:T]/g,"").slice(0,15);M.download=`translations_${V}.json`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(R),d.success("æ–‡æœ¬å¯¼å‡ºæˆåŠŸï¼")}function j(){const c=o.images;if(c.length===0)return null;const u=[];for(let y=0;y<c.length;y++){const b=c[y];if(!b)continue;const R=b.bubbleStates||[],M={imageIndex:y,bubbles:[]};for(let J=0;J<R.length;J++){const V=R[J];if(!V)continue;const U=V.originalText||"",O=V.translatedText||V.textboxText||"";let f="vertical";V.textDirection&&V.textDirection!=="auto"?f=V.textDirection:V.autoTextDirection&&(f=V.autoTextDirection),M.bubbles.push({bubbleIndex:J,original:U,translated:O,textDirection:f})}u.push(M)}return u}async function P(c){if(!c){d.warning("æœªé€‰æ‹©æ–‡ä»¶");return}s.value=!0,r.value=0,x.value="å‡†å¤‡å¯¼å…¥æ–‡æœ¬...",d.info("æ­£åœ¨å¯¼å…¥æ–‡æœ¬...",0);try{const u=await h(c);r.value=10,x.value="è§£æ JSON æ•°æ®...";const y=JSON.parse(u);if(!Array.isArray(y))throw new Error("å¯¼å…¥çš„ JSON æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸ºæ•°ç»„");let b=0,R=0;const M=t.settings.textStyle,J=M.autoFontSize?"auto":M.fontSize,V=M.fontFamily,U=M.textColor,O=M.fillColor;r.value=20,x.value="å¼€å§‹æ›´æ–°å›¾ç‰‡...";const f=y.length;let m=0;const $=[];for(const k of y){m++;const Y=20+m/f*60;r.value=Y,x.value=`å¤„ç†å›¾ç‰‡ ${m}/${f}`;const F=k.imageIndex;if(F<0||F>=o.images.length){console.warn(`è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${F}`);continue}const _=o.images[F];if(!_)continue;let z=!1;_.bubbleStates||(_.bubbleStates=[]),_.bubbleTexts||(_.bubbleTexts=[]),_.originalTexts||(_.originalTexts=[]);for(const T of k.bubbles){const p=T.bubbleIndex,K=T.original,i=T.translated,C=T.textDirection,ie=C==="vertical"||C==="horizontal"?C:"vertical";for(;_.bubbleTexts.length<=p;)_.bubbleTexts.push("");for(;_.originalTexts.length<=p;)_.originalTexts.push("");for(K&&(_.originalTexts[p]=K),i&&(_.bubbleTexts[p]=i);_.bubbleStates.length<=p;)_.bubbleStates.push(I(J,V,U,O));const L=_.bubbleStates[p];L&&(K&&(L.originalText=K),i&&(L.translatedText=i,L.textboxText=i),L.textDirection=ie,z=!0,R++)}z&&_.bubbleStates&&(_.bubbleTexts=_.bubbleStates.map(T=>T.translatedText||"")),z&&(b++,_.hasUnsavedChanges=!0,_.translatedDataURL&&_.bubbleStates&&_.bubbleStates.length>0&&$.push(F))}if($.length>0){r.value=80,x.value="å¼€å§‹æ¸²æŸ“å›¾ç‰‡...",d.info("æ­£åœ¨æ¸²æŸ“å›¾ç‰‡ï¼Œè¯·ç¨å€™...",0);const k=t.settings.textStyle,Y=k.layoutDirection,F=Y==="auto";for(let _=0;_<$.length;_++){const z=$[_];if(z===void 0)continue;const T=o.images[z];if(!(!T||!T.bubbleStates)){r.value=80+_/$.length*20,x.value=`æ¸²æŸ“å›¾ç‰‡ ${_+1}/${$.length}`;try{let p="";if(T.cleanImageData?p=T.cleanImageData.includes("base64,")?T.cleanImageData.split("base64,")[1]||"":T.cleanImageData:T.originalDataURL&&(p=T.originalDataURL.includes("base64,")?T.originalDataURL.split("base64,")[1]||"":T.originalDataURL,console.log(`importText: å›¾ç‰‡ ${z} ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰`)),!p){console.log(`importText: å›¾ç‰‡ ${z} æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡`);continue}const K=T.bubbleStates.map(C=>({translatedText:C.translatedText||"",coords:C.coords,fontSize:C.fontSize||k.fontSize,fontFamily:C.fontFamily||k.fontFamily,textDirection:_t(C),textColor:C.textColor||k.textColor,rotationAngle:C.rotationAngle||0,position:C.position||{x:0,y:0},strokeEnabled:C.strokeEnabled??k.strokeEnabled,strokeColor:C.strokeColor||k.strokeColor,strokeWidth:C.strokeWidth??k.strokeWidth})),i=await uo({clean_image:p,bubble_texts:K.map(C=>C.translatedText),bubble_coords:K.map(C=>C.coords),fontSize:k.fontSize,fontFamily:k.fontFamily,textDirection:F?"vertical":Y,textColor:k.textColor,bubble_states:K,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,is_font_style_change:!0,strokeEnabled:k.strokeEnabled,strokeColor:k.strokeColor,strokeWidth:k.strokeWidth});i.rendered_image&&(o.updateImageByIndex(z,{translatedDataURL:`data:image/png;base64,${i.rendered_image}`,hasUnsavedChanges:!0}),console.log(`importText: å›¾ç‰‡ ${z} æ¸²æŸ“æˆåŠŸ`))}catch(p){console.error(`importText: é‡æ¸²æŸ“å›¾ç‰‡ ${z} å¤±è´¥:`,p)}}}}r.value=100,x.value="å¯¼å…¥å®Œæˆ";const v=$.length,g=v>0?`å¯¼å…¥æˆåŠŸï¼æ›´æ–°äº† ${b} å¼ å›¾ç‰‡ä¸­çš„ ${R} ä¸ªæ°”æ³¡æ–‡æœ¬ï¼Œé‡æ¸²æŸ“äº† ${v} å¼ å›¾ç‰‡`:`å¯¼å…¥æˆåŠŸï¼æ›´æ–°äº† ${b} å¼ å›¾ç‰‡ä¸­çš„ ${R} ä¸ªæ°”æ³¡æ–‡æœ¬`;d.success(g)}catch(u){console.error("å¯¼å…¥æ–‡æœ¬å‡ºé”™:",u),d.error(`å¯¼å…¥å¤±è´¥: ${u instanceof Error?u.message:String(u)}`)}finally{s.value=!1,setTimeout(()=>{r.value=0,x.value=""},2e3)}}function h(c){return new Promise((u,y)=>{const b=new FileReader;b.onload=R=>{R.target?.result?u(R.target.result):y(new Error("è¯»å–æ–‡ä»¶å¤±è´¥"))},b.onerror=()=>y(new Error("è¯»å–æ–‡ä»¶æ—¶å‡ºé”™")),b.readAsText(c)})}function I(c,u,y,b){const R=t.settings.textStyle;return{coords:[0,0,100,100],polygon:[],originalText:"",translatedText:"",textboxText:"",fontSize:typeof c=="number"?c:25,fontFamily:u,textDirection:"vertical",autoTextDirection:"vertical",textColor:y,fillColor:b,rotationAngle:0,position:{x:0,y:0},strokeEnabled:R.strokeEnabled,strokeColor:R.strokeColor,strokeWidth:R.strokeWidth,inpaintMethod:R.inpaintMethod}}function D(){const c=o.currentImage;if(!c){d.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}const u=c.translatedDataURL||c.originalDataURL;if(!u){d.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}n.value=!0;try{const y=u.split(",")[1];if(!y)throw new Error("æ— æ•ˆçš„å›¾ç‰‡æ•°æ®");const b=atob(y),R=[];for(let f=0;f<b.length;f+=512){const m=b.slice(f,f+512),$=new Array(m.length);for(let g=0;g<m.length;g++)$[g]=m.charCodeAt(g);const v=new Uint8Array($);R.push(v.buffer)}const M=new Blob(R,{type:"image/png"}),J=URL.createObjectURL(M),V=document.createElement("a");V.href=J;let U=c.fileName||`image_${o.currentImageIndex}.png`;U=`${c.translatedDataURL?"translated":"original"}_${U.replace(/\.[^/.]+$/,"")}.png`,V.download=U,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(J),d.success(`ä¸‹è½½æˆåŠŸ: ${U}`)}catch(y){console.error("ä¸‹è½½å›¾ç‰‡æ—¶å‡ºé”™:",y),d.error("ä¸‹è½½å¤±è´¥")}finally{n.value=!1}}async function E(c="zip"){const u=o.images;if(u.length===0){d.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}n.value=!0,l.value=0,a.value="å‡†å¤‡ä¸‹è½½...",d.info("ä¸‹è½½ä¸­...å¤„ç†å¯èƒ½éœ€è¦ä¸€å®šæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…...",0);try{const y=[];let b=0,R=0;l.value=5,a.value="æ£€æŸ¥å›¾ç‰‡æ•°æ®...";for(let g=0;g<u.length;g++){const k=u[g];k&&(k.translatedDataURL?(y.push({index:g,type:"translated"}),b++):k.originalDataURL&&(y.push({index:g,type:"original"}),R++))}if(y.length===0){d.warning("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}l.value=10,a.value="åˆ›å»ºä¸‹è½½ä¼šè¯...";const M=await ts(y.length);if(!M.success||!M.session_id)throw new Error(M.error||"åˆ›å»ºä¼šè¯å¤±è´¥");const J=M.session_id,V=y.length;let U=0,O=0;for(let g=0;g<y.length;g++){const k=y[g];if(!k)continue;const Y=u[k.index];if(!Y)continue;const F=k.type==="translated"?Y.translatedDataURL:Y.originalDataURL;if(!F)continue;const _=10+g/V*70;l.value=_,a.value=`ä¸Šä¼ å›¾ç‰‡ ${g+1}/${V}...`;try{const z=await os(J,F,g);z.success?U++:(console.error(`ä¸Šä¼ å›¾ç‰‡ ${g} å¤±è´¥:`,z.error),O++)}catch(z){console.error(`ä¸Šä¼ å›¾ç‰‡ ${g} å‡ºé”™:`,z),O++}}if(U===0)throw new Error("æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ å¤±è´¥");l.value=85,a.value="æ‰“åŒ…æ–‡ä»¶...";const f=await ns(J,c);if(!f.success||!f.file_id)throw new Error(f.error||"æ‰“åŒ…å¤±è´¥");l.value=95,a.value="å‡†å¤‡ä¸‹è½½...";const m=ss(f.file_id,c),$=document.createElement("a");$.href=m,document.body.appendChild($),$.click(),document.body.removeChild($),l.value=100,a.value="ä¸‹è½½å·²å¼€å§‹";let v=`å·²æˆåŠŸå¤„ç† ${U} å¼ å›¾ç‰‡`;O>0&&(v+=`ï¼ˆ${O} å¼ å¤±è´¥ï¼‰`),b>0&&R>0?v+=`ï¼ˆ${b} å¼ ç¿»è¯‘å›¾ç‰‡å’Œ ${R} å¼ åŸå§‹å›¾ç‰‡ï¼‰`:b>0?v+="ï¼ˆå…¨éƒ¨ä¸ºç¿»è¯‘åå›¾ç‰‡ï¼‰":R>0&&(v+="ï¼ˆå…¨éƒ¨ä¸ºåŸå§‹å›¾ç‰‡ï¼‰"),v+="ï¼Œä¸‹è½½å³å°†å¼€å§‹",d.success(v),setTimeout(async()=>{try{const g=await ro();console.log("ä¸´æ—¶æ–‡ä»¶æ¸…ç†ç»“æœ:",g)}catch(g){console.error("æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥:",g)}},6e4)}catch(y){console.error("ä¸‹è½½æ‰€æœ‰å›¾ç‰‡æ—¶å‡ºé”™:",y),d.error(`ä¸‹è½½å¤±è´¥: ${y instanceof Error?y.message:String(y)}`)}finally{n.value=!1,setTimeout(()=>{l.value=0,a.value=""},2e3)}}return{isDownloading:n,downloadProgress:l,downloadProgressText:a,isImporting:s,importProgress:r,importProgressText:x,canExportText:A,canImportText:w,canDownload:W,exportText:G,exportTextToJson:j,importText:P,downloadCurrentImage:D,downloadAllImages:E}}const za={key:0,class:"result-section card result-card"},Na={class:"image-controls"},Va={class:"image-size-control"},Wa=["value"],Ka={id:"imageSizeValue"},qa={class:"content-container"},Ha={class:"image-container"},Ja=["src"],ja={id:"detectedTextInfo",class:"text-info"},Ya={id:"detectedTextList"},Ga={class:"original-text"},Xa={class:"download-section"},Za={class:"download-buttons"},Qa=["disabled"],el={class:"download-all-container"},tl=["disabled"],ol={class:"download-format-selector"},nl=["disabled"],sl=["disabled"],al={key:1,class:"empty-state-section"},Zt=60,ll=He({__name:"ImageResultDisplay",props:{isEditMode:{type:Boolean,default:!1}},emits:["toggle-edit-mode","retry-failed"],setup(o,{emit:t}){const d=[{label:"ZIPå‹ç¼©åŒ…",value:"zip"},{label:"PDFæ–‡æ¡£",value:"pdf"},{label:"CBZæ¼«ç”»",value:"cbz"}],n=t,l=et(),a=Je(),s=Oa(),r=S(100),x=ee({get:()=>h.value?.showOriginal??!1,set:_=>{h.value&&l.updateCurrentImage({showOriginal:_})}}),A=S("zip"),w=S(null),W=ee(()=>s.isDownloading.value),G=ee(()=>s.downloadProgressText.value),j=ee(()=>s.downloadProgress.value),P=ee(()=>l.hasImages),h=ee(()=>l.currentImage),I=ee(()=>!!h.value?.translatedDataURL),D=ee(()=>!!(h.value?.translatedDataURL||h.value?.originalDataURL)),E=ee(()=>h.value?x.value||!h.value.translatedDataURL?h.value.originalDataURL:h.value.translatedDataURL:""),c=ee(()=>l.failedImageCount>0),u=ee(()=>({width:`${r.value}%`})),y=ee(()=>a.settings.useTextboxPrompt),b=ee(()=>{if(!h.value)return[];if(h.value.bubbleStates&&h.value.bubbleStates.length>0)return h.value.bubbleStates.map(T=>({original:T.originalText||"",translated:y.value?T.textboxText||T.translatedText||"":T.translatedText||""}));const _=h.value.originalTexts||[],z=y.value?h.value.textboxTexts||h.value.bubbleTexts||[]:h.value.bubbleTexts||[];return _.length===0?[]:_.map((T,p)=>({original:T||"",translated:z[p]||""}))}),R=ee(()=>b.value.length>0);function M(_){if(!_||_.length<=Zt)return _;let z="",T="";for(let p=0;p<_.length;p++)if(T+=_[p],T.length>=Zt){let K=-1;for(let i=T.length-1;i>=0;i--){const C=T[i];if(C&&["ã€‚","ï¼","ï¼Ÿ",".","!","?","ï¼›",";","ï¼Œ",","].includes(C)){K=i+1;break}}K>Zt*.6?(z+=T.substring(0,K)+`
`,T=T.substring(K)):(z+=T+`
`,T="")}return T&&(z+=T),z}function J(_){return M((_||"").trim())}function V(_){const z=(_||"").trim();return M(z)}function U(_){return(_||"").includes("ç¿»è¯‘å¤±è´¥")}function O(){x.value=!x.value}function f(){n("toggle-edit-mode")}function m(_){const z=_.target;r.value=parseInt(z.value,10)}function $(){n("retry-failed")}function v(){s.downloadCurrentImage()}function g(){s.downloadAllImages(A.value)}function k(){s.exportText()}function Y(){w.value?.click()}async function F(_){const z=_.target,T=z.files?.[0];T&&(await s.importText(T),z.value="")}return(_,z)=>h.value?(N(),q("section",za,[e("div",Na,[I.value?(N(),q("button",{key:0,id:"toggleImageButton",class:"control-btn",onClick:O},le(x.value?"æŸ¥çœ‹ç¿»è¯‘å›¾":"æŸ¥çœ‹åŸå›¾"),1)):de("",!0),e("button",{id:"toggleEditModeButton",class:Ie(["control-btn",{active:o.isEditMode}]),onClick:f},le(o.isEditMode?"é€€å‡ºç¼–è¾‘":"åˆ‡æ¢ç¼–è¾‘æ¨¡å¼"),3),e("div",Va,[z[1]||(z[1]=e("label",{for:"imageSize"},"å›¾ç‰‡å¤§å°:",-1)),e("input",{type:"range",id:"imageSize",min:"50",max:"200",value:r.value,class:"slider range-slider",onInput:m},null,40,Wa),e("span",Ka,le(r.value)+"%",1)]),c.value?(N(),q("button",{key:1,id:"retranslateFailedButton",class:"retry-failed-btn",onClick:$,title:"é‡æ–°ç¿»è¯‘æ‰€æœ‰å¤±è´¥çš„å›¾ç‰‡"}," é‡æ–°ç¿»è¯‘å¤±è´¥å›¾ç‰‡ ("+le(Q(l).failedImageCount)+") ",1)):de("",!0)]),e("div",qa,[e("div",Ha,[e("img",{id:"translatedImageDisplay",src:E.value,alt:"ç¿»è¯‘åå›¾ç‰‡",style:at(u.value)},null,12,Ja)])]),e("div",ja,[z[6]||(z[6]=e("h3",null,"æ£€æµ‹åˆ°çš„æ–‡æœ¬ï¼ˆåŸæ–‡ â†’ è¯‘æ–‡ï¼‰",-1)),e("pre",Ya,[R.value?(N(!0),q(Ke,{key:0},je(b.value,(T,p)=>(N(),q("span",{key:p,class:"text-item"},[e("span",Ga,le(J(T.original)),1),z[2]||(z[2]=Se(`
`,-1)),e("span",{class:Ie(["translated-text",{"translation-error":U(T.translated)}])},le(V(T.translated)),3),z[3]||(z[3]=Se(`
`,-1)),z[4]||(z[4]=e("span",{class:"separator"},"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",-1)),z[5]||(z[5]=Se(`

`,-1))]))),128)):(N(),q(Ke,{key:1},[Se("æœªæ£€æµ‹åˆ°æ–‡æœ¬æˆ–å°šæœªç¿»è¯‘")],64))])]),e("div",Xa,[W.value?(N(),lt(po,{key:0,visible:!0,percentage:j.value,label:G.value||"ä¸‹è½½ä¸­ï¼Œè¯·ç¨å€™..."},null,8,["percentage","label"])):de("",!0),e("div",Za,[e("button",{id:"downloadButton",class:"download-btn primary",disabled:!D.value,onClick:v}," ä¸‹è½½å½“å‰å›¾ç‰‡ ",8,Qa),e("div",el,[e("button",{id:"downloadAllImagesButton",class:"download-btn primary",disabled:!P.value,onClick:g}," ä¸‹è½½æ‰€æœ‰å›¾ç‰‡ ",8,tl),e("div",ol,[be(ze,{modelValue:A.value,"onUpdate:modelValue":z[0]||(z[0]=T=>A.value=T),options:d},null,8,["modelValue"])])]),e("button",{id:"exportTextButton",class:"download-btn success",disabled:!P.value,onClick:k}," å¯¼å‡ºæ–‡æœ¬ ",8,nl),e("button",{id:"importTextButton",class:"download-btn success",disabled:!P.value,onClick:Y}," å¯¼å…¥æ–‡æœ¬ ",8,sl),e("input",{type:"file",ref_key:"importFileInput",ref:w,id:"importTextFileInput",style:{display:"none"},accept:".json",onChange:F},null,544)])])])):(N(),q("section",al))}}),il=qe(ll,[["__scopeId","data-v-a26b9c58"]]),rl={class:"guide-content"},ul={class:"guide-footer"},cl={class:"dont-show-option"},Dt="saber_translator_dismiss_setup_reminder",dl=He({__name:"FirstTimeGuide",emits:["openSettings"],setup(o,{expose:t,emit:d}){const n=d,l=S(!1),a=S(!1);ut(()=>{localStorage.getItem(Dt)!=="true"&&(l.value=!0)});function s(){a.value&&localStorage.setItem(Dt,"true"),l.value=!1}function r(){localStorage.setItem(Dt,"true"),l.value=!1,n("openSettings")}function x(){localStorage.removeItem(Dt)}return t({resetGuideState:x,showGuide:l}),(A,w)=>(N(),lt(tn,{"model-value":l.value,title:"æ¬¢è¿ä½¿ç”¨ Saber-Translator",onClose:s},{default:ht(()=>[e("div",rl,[w[3]||(w[3]=e("div",{class:"guide-icon"},"ğŸ‰",-1)),w[4]||(w[4]=e("div",{class:"guide-message"},[e("p",{class:"guide-title"},"é¦–æ¬¡ä½¿ç”¨æé†’"),e("p",{class:"guide-text"}," åœ¨å¼€å§‹ç¿»è¯‘ä¹‹å‰ï¼Œè¯·å…ˆé…ç½®ç¿»è¯‘æœåŠ¡ã€‚ "),e("p",{class:"guide-text"},[Se(" ç‚¹å‡»å³ä¸Šè§’çš„ "),e("span",{class:"highlight"},"âš™ï¸ è®¾ç½®"),Se(" æŒ‰é’®ï¼Œé…ç½®ä»¥ä¸‹å†…å®¹ï¼š ")]),e("ul",{class:"guide-list"},[e("li",null,"é€‰æ‹© OCR å¼•æ“ï¼ˆæ–‡å­—è¯†åˆ«ï¼‰"),e("li",null,"é…ç½®ç¿»è¯‘æœåŠ¡å•†å’Œ API Key"),e("li",null,"ï¼ˆå¯é€‰ï¼‰é…ç½®é«˜è´¨é‡ç¿»è¯‘å’Œ AI æ ¡å¯¹")])],-1)),e("div",{class:"guide-actions"},[e("button",{class:"guide-btn primary",onClick:r},[...w[1]||(w[1]=[e("span",{class:"btn-icon"},"âš™ï¸",-1),Se(" ç«‹å³é…ç½® ",-1)])]),e("button",{class:"guide-btn secondary",onClick:s}," ç¨åé…ç½® ")]),e("div",ul,[e("label",cl,[ae(e("input",{type:"checkbox","onUpdate:modelValue":w[0]||(w[0]=W=>a.value=W)},null,512),[[Qe,a.value]]),w[2]||(w[2]=e("span",null,"ä¸å†æ˜¾ç¤ºæ­¤æé†’",-1))])])])]),_:1},8,["model-value"]))}}),gl=qe(dl,[["__scopeId","data-v-eda18e4a"]]),Qt="saber_translator_dismiss_setup_reminder",pl=["siliconflow","deepseek","volcano","caiyun","baidu_translate","youdao_translate","gemini","custom_openai"],vl={manga_ocr:"MangaOCR",paddle_ocr:"PaddleOCR",baidu_ocr:"ç™¾åº¦OCR",ai_vision:"AIè§†è§‰OCR"},ml=["ollama","sakura"],bl=["custom_openai"],fl=["custom_openai"],hl={siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",caiyun:"å½©äº‘å°è¯‘",baidu_translate:"ç™¾åº¦ç¿»è¯‘",youdao_translate:"æœ‰é“ç¿»è¯‘",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰ OpenAI",ollama:"Ollama",sakura:"Sakura"};function Ft(){const o=Je(),t=rt(),d=S(!1),n=S(!1),l=ee(()=>{try{return localStorage.getItem(Qt)==="true"}catch{return!1}});function a(b){return hl[b]||b}function s(b){return pl.includes(b)}function r(b){return ml.includes(b)}function x(b){return bl.includes(b)}function A(b){return fl.includes(b)}function w(b){return vl[b]||b}function W(){const b=o.settings,R=b.ocrEngine,M=b.baiduOcr,J=b.aiVisionOcr,V=[];return R?(R==="baidu_ocr"&&((!M?.apiKey||M.apiKey.trim()==="")&&V.push("ç™¾åº¦OCR çš„ API Key"),(!M?.secretKey||M.secretKey.trim()==="")&&V.push("ç™¾åº¦OCR çš„ Secret Key")),R==="ai_vision"&&(J?.provider||V.push("AIè§†è§‰OCR çš„æœåŠ¡å•†"),(!J?.apiKey||J.apiKey.trim()==="")&&V.push("AIè§†è§‰OCR çš„ API Key"),(!J?.modelName||J.modelName.trim()==="")&&V.push("AIè§†è§‰OCR çš„æ¨¡å‹åç§°"),J?.provider==="custom"&&(!J?.customBaseUrl||J.customBaseUrl.trim()==="")&&V.push("AIè§†è§‰OCR çš„è‡ªå®šä¹‰ Base URL")),V.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${V[0]}`,missingItems:V}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹© OCR å¼•æ“",missingItems:["OCR å¼•æ“"]}}function G(){const{translation:b}=o.settings,{provider:R,apiKey:M,modelName:J,customBaseUrl:V}=b,U=[];return R?(s(R)&&(!M||M.trim()==="")&&U.push(`${a(R)} çš„ API Key`),(!J||J.trim()==="")&&(r(R)||s(R))&&U.push(`${a(R)} çš„æ¨¡å‹åç§°`),x(R)&&(!V||V.trim()==="")&&U.push("è‡ªå®šä¹‰ OpenAI æœåŠ¡çš„ Base URL"),U.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${U[0]}`,missingItems:U}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹©ç¿»è¯‘æœåŠ¡å•†",missingItems:["ç¿»è¯‘æœåŠ¡å•†"]}}function j(){const{hqTranslation:b}=o.settings,{provider:R,apiKey:M,modelName:J,customBaseUrl:V}=b,U=[];return R?((!M||M.trim()==="")&&U.push("é«˜è´¨é‡ç¿»è¯‘çš„ API Key"),(!J||J.trim()==="")&&U.push("é«˜è´¨é‡ç¿»è¯‘çš„æ¨¡å‹åç§°"),A(R)&&(!V||V.trim()==="")&&U.push("é«˜è´¨é‡ç¿»è¯‘çš„ Base URL"),U.length>0?{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­å¡«å†™ ${U[0]}`,missingItems:U}:{valid:!0,message:""}):{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­é€‰æ‹©é«˜è´¨é‡ç¿»è¯‘çš„æœåŠ¡å•†",missingItems:["é«˜è´¨é‡ç¿»è¯‘æœåŠ¡å•†"]}}function P(b){const R=b||o.settings.proofreading.rounds,M=[];if(!R||R.length===0)return{valid:!1,message:"è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­æ·»åŠ è‡³å°‘ä¸€ä¸ªæ ¡å¯¹è½®æ¬¡",missingItems:["æ ¡å¯¹è½®æ¬¡"]};for(let J=0;J<R.length;J++){const V=R[J];if(!V)continue;const U=V.name||`è½®æ¬¡${J+1}`;if(V.provider||M.push(`æ ¡å¯¹ ${U} çš„æœåŠ¡å•†`),(!V.apiKey||V.apiKey.trim()==="")&&M.push(`æ ¡å¯¹ ${U} çš„ API Key`),(!V.modelName||V.modelName.trim()==="")&&M.push(`æ ¡å¯¹ ${U} çš„æ¨¡å‹åç§°`),M.length>0)return{valid:!1,message:`è¯·å…ˆåœ¨é¡¶éƒ¨ âš™ï¸ è®¾ç½®èœå•ä¸­ä¸º ${M[0]}`,missingItems:M}}return{valid:!0,message:""}}function h(b="normal",R={}){let M;switch(b){case"normal":M=G();break;case"hq":M=j();break;case"proofread":M=P(R.proofreadingRounds);break;case"ocr":M=W();break;default:M=G()}return M.valid?!0:(t.error(M.message),D(),!1)}function I(){const b=W();if(!b.valid)return t.error(b.message),D(),!1;const R=G();return R.valid?!0:(t.error(R.message),D(),!1)}function D(){const b=document.getElementById("openSettingsBtn");b&&(n.value=!0,b.style.animation="settingsBtnPulse 0.5s ease-in-out 3",b.style.boxShadow="0 0 10px var(--primary-color, #4a90d9)",setTimeout(()=>{b.style.animation="",b.style.boxShadow="",n.value=!1},3e3))}function E(){if(l.value){console.log("ç”¨æˆ·å·²é€‰æ‹©ä¸å†æ˜¾ç¤ºè®¾ç½®æé†’");return}d.value=!0}function c(b=!1){if(b)try{localStorage.setItem(Qt,"true"),console.log("ç”¨æˆ·é€‰æ‹©æ°¸ä¹…å…³é—­è®¾ç½®æé†’")}catch(R){console.error("ä¿å­˜è®¾ç½®æé†’çŠ¶æ€å¤±è´¥:",R)}d.value=!1}function u(){try{localStorage.removeItem(Qt),console.log("è®¾ç½®æé†’çŠ¶æ€å·²é‡ç½®")}catch(b){console.error("é‡ç½®è®¾ç½®æé†’çŠ¶æ€å¤±è´¥:",b)}}function y(){setTimeout(()=>{E()},500)}return{showSetupReminder:d,isSettingsButtonHighlighted:n,isSetupReminderDismissed:l,validateOcrConfig:W,validateTranslationConfig:G,validateHqTranslationConfig:j,validateProofreadingConfig:P,validateBeforeTranslation:h,validateFullTranslationConfig:I,highlightSettingsButton:D,checkAndShowSetupReminder:E,closeSetupReminder:c,resetSetupReminderDismiss:u,initValidation:y,getProviderDisplayName:a,getOcrEngineDisplayName:w,requiresApiKey:s,isLocalProvider:r,requiresBaseUrl:x}}const Rt={originalText:"",translatedText:"",textboxText:"",coords:[0,0,100,100],polygon:[],fontSize:25,fontFamily:"fonts/STSONG.TTF",textDirection:"auto",autoTextDirection:"vertical",textColor:"#000000",fillColor:Xo,rotationAngle:0,position:{x:0,y:0},strokeEnabled:io,strokeColor:lo,strokeWidth:ao,inpaintMethod:"solid",autoFgColor:null,autoBgColor:null,colorConfidence:0};function oo(o){return{...{...Rt,...o},coords:o?.coords?[...o.coords]:[...Rt.coords],polygon:o?.polygon?o.polygon.map(d=>[...d]):[],position:o?.position?{...Rt.position,...o.position}:{...Rt.position}}}function an(o){const[t,d,n,l]=o,a=Math.abs(n-t);return Math.abs(l-d)>a?"vertical":"horizontal"}function ln(o,t){const{bubble_coords:d=[],bubble_states:n=[],original_texts:l=[],bubble_texts:a=[],textbox_texts:s=[],bubble_angles:r=[],auto_directions:x=[]}=o;return n.length>0?n.map((A,w)=>({...oo(t),...A,coords:A.coords||d[w]||[0,0,100,100]})):d.map((A,w)=>{let W;return x[w]?W=x[w]==="v"?"vertical":"horizontal":W=an(A),oo({coords:A,originalText:l[w]||"",translatedText:a[w]||"",textboxText:s[w]||"",rotationAngle:r[w]||0,autoTextDirection:W,...t})})}function Mt(o){return o.map(t=>({...t,coords:[...t.coords],polygon:t.polygon?t.polygon.map(d=>[...d]):[],position:{...t.position},autoFgColor:t.autoFgColor?[...t.autoFgColor]:null,autoBgColor:t.autoBgColor?[...t.autoBgColor]:null}))}function yl(o){if(!o||typeof o!="object")return!1;const t=o;if(!Array.isArray(t.coords)||t.coords.length!==4||!t.coords.every(l=>typeof l=="number"&&!isNaN(l))||typeof t.fontSize!="number"||t.fontSize<=0)return!1;const d=["vertical","horizontal","auto"];if(typeof t.textDirection!="string"||!d.includes(t.textDirection))return!1;const n=["solid","lama_mpe","litelama"];return!(typeof t.inpaintMethod!="string"||!n.includes(t.inpaintMethod))}const dt=At("bubble",()=>{const o=S([]),t=S(-1),d=S([]),n=S([]),l=S(!1),a=S(-1),s=S(0),r=S(0),x=S(0),A=S(0),w=S(!1),W=S(-1),G=S(null),j=S(!1),P=S(-1),h=S(0),I=ee(()=>t.value>=0&&t.value<o.value.length?o.value[t.value]??null:null),D=ee(()=>o.value.length),E=ee(()=>o.value.length>0),c=ee(()=>t.value>=0),u=ee(()=>d.value.length>1),y=ee(()=>d.value.filter(L=>L>=0&&L<o.value.length).map(L=>o.value[L]).filter(L=>L!==void 0));function b(){const te=et().currentImage;te&&(te.bubbleStates=Mt(o.value),te.hasUnsavedChanges=!0,console.log("æ°”æ³¡çŠ¶æ€å·²åŒæ­¥åˆ°å½“å‰å›¾ç‰‡"))}function R(L,te=!1){o.value=L,n.value=Mt(L),$(),console.log(`æ°”æ³¡æ•°ç»„å·²è®¾ç½®ï¼Œå…± ${L.length} ä¸ªæ°”æ³¡`),te||b()}function M(L,te){const ce=an(L),$e=Je().settings.textStyle,Fe=$e.layoutDirection,Me=Fe==="auto"?"vertical":Fe||"vertical",Be=oo({coords:L,translatedText:"",autoTextDirection:ce,fontSize:$e.fontSize,fontFamily:$e.fontFamily,textDirection:Me,textColor:$e.textColor,fillColor:$e.fillColor,inpaintMethod:$e.inpaintMethod,strokeEnabled:$e.strokeEnabled,strokeColor:$e.strokeColor,strokeWidth:$e.strokeWidth,rotationAngle:0,position:{x:0,y:0},...te});return o.value.push(Be),console.log(`å·²æ·»åŠ æ°”æ³¡ï¼Œå½“å‰å…± ${o.value.length} ä¸ª`),b(),Be}function J(L){return L<0||L>=o.value.length?(console.warn(`åˆ é™¤å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${L}`),!1):(o.value.splice(L,1),t.value===L?t.value=-1:t.value>L&&t.value--,d.value=d.value.filter(te=>te!==L).map(te=>te>L?te-1:te),console.log(`å·²åˆ é™¤æ°”æ³¡ï¼Œå½“å‰å…± ${o.value.length} ä¸ª`),b(),!0)}function V(){if(d.value.length===0&&t.value<0)return;const L=[...new Set([...d.value,t.value])].filter(te=>te>=0).sort((te,ce)=>ce-te);for(const te of L)o.value.splice(te,1);$(),console.log(`å·²åˆ é™¤ ${L.length} ä¸ªæ°”æ³¡`),b()}function U(){o.value=[],n.value=[],$(),console.log("æ‰€æœ‰æ°”æ³¡å·²æ¸…é™¤"),b()}function O(){o.value=[],n.value=[],$(),console.log("æœ¬åœ°æ°”æ³¡çŠ¶æ€å·²æ¸…é™¤ï¼ˆä¸åŒæ­¥åˆ°imageStoreï¼‰")}function f(L){L>=-1&&L<o.value.length&&(t.value=L,d.value=L>=0?[L]:[],console.log(`å·²é€‰ä¸­æ°”æ³¡ ${L}`))}function m(L){if(L<0||L>=o.value.length)return;const te=d.value.indexOf(L);te>=0?(d.value.splice(te,1),t.value===L&&(t.value=d.value[0]??-1)):(d.value.push(L),t.value=L),console.log(`å¤šé€‰çŠ¶æ€: ${d.value.join(", ")}`)}function $(){t.value=-1,d.value=[]}function v(){t.value>=0?d.value=[t.value]:d.value=[]}function g(){if(o.value.length===0)return!1;const L=t.value<o.value.length-1?t.value+1:0;return f(L),!0}function k(){if(o.value.length===0)return!1;const L=t.value>0?t.value-1:o.value.length-1;return f(L),!0}function Y(L,te){if(L<0||L>=o.value.length)return console.warn(`æ›´æ–°å¤±è´¥: æ— æ•ˆçš„ç´¢å¼• ${L}`),!1;const ce=o.value[L];return ce?(Object.assign(ce,te),console.log(`å·²æ›´æ–°æ°”æ³¡ ${L}`),b(),!0):!1}function F(L){return t.value<0?(console.warn("æ›´æ–°å¤±è´¥: æ²¡æœ‰é€‰ä¸­çš„æ°”æ³¡"),!1):Y(t.value,L)}function _(L){const te=d.value.length>0?d.value:t.value>=0?[t.value]:[];for(const ce of te){const we=o.value[ce];we&&Object.assign(we,L)}b(),console.log(`å·²æ‰¹é‡æ›´æ–° ${te.length} ä¸ªæ°”æ³¡`)}function z(L){for(let te=0;te<o.value.length;te++){const ce=o.value[te];ce&&Object.assign(ce,L)}b(),console.log(`å·²æ›´æ–°æ‰€æœ‰ ${o.value.length} ä¸ªæ°”æ³¡`)}function T(){if(o.value.length!==n.value.length)return!0;for(let L=0;L<o.value.length;L++){const te=o.value[L],ce=n.value[L];if(!(!te||!ce)&&(te.translatedText!==ce.translatedText||te.textboxText!==ce.textboxText||te.fontSize!==ce.fontSize||te.fontFamily!==ce.fontFamily||te.textDirection!==ce.textDirection||te.textColor!==ce.textColor||te.fillColor!==ce.fillColor||te.rotationAngle!==ce.rotationAngle||te.strokeEnabled!==ce.strokeEnabled||te.strokeColor!==ce.strokeColor||te.strokeWidth!==ce.strokeWidth||te.inpaintMethod!==ce.inpaintMethod||JSON.stringify(te.coords)!==JSON.stringify(ce.coords)))return!0}return!1}function p(){o.value=Mt(n.value),$(),console.log("æ°”æ³¡çŠ¶æ€å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€")}function K(){n.value=Mt(o.value),console.log("å½“å‰çŠ¶æ€å·²ä¿å­˜ä¸ºåˆå§‹çŠ¶æ€")}function i(){return{bubble_coords:o.value.map(L=>L.coords),bubble_texts:o.value.map(L=>L.translatedText),textbox_texts:o.value.map(L=>L.textboxText),font_sizes:o.value.map(L=>L.fontSize),font_families:o.value.map(L=>L.fontFamily),text_directions:o.value.map(L=>L.textDirection==="auto"?L.autoTextDirection==="vertical"?"v":"h":L.textDirection==="vertical"?"v":"h"),text_colors:o.value.map(L=>L.textColor),fill_colors:o.value.map(L=>L.fillColor),rotation_angles:o.value.map(L=>L.rotationAngle),stroke_enabled:o.value.map(L=>L.strokeEnabled),stroke_colors:o.value.map(L=>L.strokeColor),stroke_widths:o.value.map(L=>L.strokeWidth),inpaint_methods:o.value.map(L=>L.inpaintMethod)}}function C(){return JSON.stringify(o.value)}function ie(L){try{const te=JSON.parse(L);if(!Array.isArray(te))return console.error("ååºåˆ—åŒ–å¤±è´¥: æ•°æ®ä¸æ˜¯æ•°ç»„"),!1;const ce=[];for(const we of te)yl(we)?ce.push(we):console.warn("è·³è¿‡æ— æ•ˆçš„æ°”æ³¡çŠ¶æ€:",we);return R(ce),!0}catch(te){return console.error("ååºåˆ—åŒ–å¤±è´¥:",te),!1}}return{bubbles:o,selectedIndex:t,selectedIndices:d,initialStates:n,isDragging:l,draggingIndex:a,dragOffsetX:s,dragOffsetY:r,dragInitialX:x,dragInitialY:A,isResizing:w,resizingIndex:W,resizeCurrentCoords:G,isRotating:j,rotatingIndex:P,rotateCurrentAngle:h,selectedBubble:I,bubbleCount:D,hasBubbles:E,hasSelection:c,isMultiSelect:u,selectedBubbles:y,setBubbles:R,addBubble:M,deleteBubble:J,deleteSelected:V,clearBubbles:U,clearBubblesLocal:O,selectBubble:f,toggleMultiSelect:m,clearSelection:$,clearMultiSelect:v,selectNext:g,selectPrevious:k,updateBubble:Y,updateSelectedBubble:F,updateAllSelected:_,updateAllBubbles:z,hasChanges:T,resetToInitial:p,saveAsInitial:K,toApiRequest:i,serialize:C,deserialize:ie}}),xl=Object.freeze(Object.defineProperty({__proto__:null,useBubbleStore:dt},Symbol.toStringTag,{value:"Module"}));function vo(o){let t=o,d=0,n=0,l=Date.now();const a=()=>t<=0?0:Math.ceil(6e4/t);return{async acquire(){if(t<=0)return;const s=Date.now(),r=a();if(s-l>=6e4&&(l=s,n=0),n>=t){const A=6e4-(s-l);A>0&&await Jo(A),l=Date.now(),n=0}const x=s-d;x<r&&await Jo(r-x),d=Date.now(),n++},reset(){d=0,n=0,l=Date.now()},getRpm(){return t},setRpm(s){t=s,this.reset()}}}function Jo(o){return new Promise(t=>setTimeout(t,o))}function kl(o){return o.includes(",")&&o.split(",")[1]||o}function no(o){if(o.isManuallyAnnotated){const t=o.bubbleStates||[];return{coords:t.map(d=>d.coords),angles:t.map(d=>d.rotationAngle||0),isEmpty:t.length===0,isManual:!0}}return Array.isArray(o.bubbleStates)&&o.bubbleStates.length>0?{coords:o.bubbleStates.map(t=>t.coords),angles:o.bubbleStates.map(t=>t.rotationAngle||0),isEmpty:!1,isManual:!1}:Array.isArray(o.bubbleCoords)&&o.bubbleCoords.length>0?{coords:o.bubbleCoords,angles:o.bubbleAngles,isEmpty:!1,isManual:!1}:null}function so(o,t={}){const d=Je(),{settings:n}=d,{textStyle:l,translation:a,baiduOcr:s,aiVisionOcr:r,boxExpand:x,preciseMask:A}=n,w={image:kl(o),ocr_engine:n.ocrEngine,source_language:n.sourceLanguage,model_provider:a.provider,api_key:a.apiKey,model_name:a.modelName,custom_base_url:a.customBaseUrl,target_language:n.targetLanguage,prompt_content:n.translatePrompt,textbox_prompt_content:n.textboxPrompt,use_textbox_prompt:n.useTextboxPrompt,rpm_limit_translation:a.rpmLimit,max_retries:a.maxRetries,use_json_format_translation:a.isJsonMode,detector_type:n.textDetector,box_expand_ratio:x.ratio,box_expand_top:x.top,box_expand_bottom:x.bottom,box_expand_left:x.left,box_expand_right:x.right,usePreciseMask:A.enabled,maskDilateSize:A.dilateSize,maskBoxExpandRatio:A.boxExpandRatio,fontSize:l.fontSize,autoFontSize:l.autoFontSize,fontFamily:l.fontFamily,textDirection:l.layoutDirection==="auto"?"vertical":l.layoutDirection,autoTextDirection:l.layoutDirection==="auto",textColor:l.textColor,fillColor:l.fillColor,strokeEnabled:l.strokeEnabled,strokeColor:l.strokeColor,strokeWidth:l.strokeWidth,useAutoTextColor:l.useAutoTextColor??!0,use_inpainting:!1,use_lama:l.inpaintMethod==="lama_mpe"||l.inpaintMethod==="litelama",lamaModel:l.inpaintMethod==="litelama"?"litelama":"lama_mpe",showDetectionDebug:n.showDetectionDebug,remove_only:t.removeTextOnly,skip_translation:t.removeTextOnly},W=G=>G.map(j=>[Math.round(j[0]),Math.round(j[1]),Math.round(j[2]),Math.round(j[3])]);return t.existingBubbleStates&&t.existingBubbleStates.length>0?(w.bubble_coords=W(t.existingBubbleStates.map(G=>G.coords)),w.bubble_angles=t.existingBubbleStates.map(G=>G.rotationAngle||0)):t.existingBubbleCoords&&(w.bubble_coords=W(t.existingBubbleCoords),w.bubble_angles=t.existingBubbleAngles),n.ocrEngine==="baidu_ocr"&&(w.baidu_api_key=s.apiKey,w.baidu_secret_key=s.secretKey,w.baidu_version=s.version,w.baidu_ocr_language=s.sourceLanguage),n.ocrEngine==="ai_vision"&&(w.ai_vision_provider=r.provider,w.ai_vision_api_key=r.apiKey,w.ai_vision_model_name=r.modelName,w.ai_vision_ocr_prompt=r.prompt,w.rpm_limit_ai_vision_ocr=r.rpmLimit,w.custom_ai_vision_base_url=r.customBaseUrl,w.use_json_format_ai_vision_ocr=r.isJsonMode),w}function _l(o){const t=Je(),{textStyle:d}=t.settings;if(!o.bubble_coords||o.bubble_coords.length===0)return null;const n={bubble_coords:o.bubble_coords,bubble_states:o.bubble_states,original_texts:o.original_texts,bubble_texts:o.bubble_texts,textbox_texts:o.textbox_texts,bubble_angles:o.bubble_angles,auto_directions:o.auto_directions},l={fontSize:d.fontSize,fontFamily:d.fontFamily,textDirection:d.layoutDirection==="auto"?"vertical":d.layoutDirection,textColor:d.textColor,fillColor:d.fillColor,strokeEnabled:d.strokeEnabled,strokeColor:d.strokeColor,strokeWidth:d.strokeWidth,inpaintMethod:d.inpaintMethod};return ln(n,l)}function Et(){return"session_"+Date.now()+"_"+Math.random().toString(36).substring(2,9)}function rn(o,t,d){return o.filter(n=>n.imageIndex>=t&&n.imageIndex<d)}function un(o){if(!o||o.length===0)return[];const t=[];for(const d of o){if(!d){console.warn("mergeJsonResults: è·³è¿‡ç©ºçš„æ‰¹æ¬¡ç»“æœ");continue}const n=Array.isArray(d)?d:[d];for(const l of n)l&&typeof l=="object"&&"imageIndex"in l?t.push(l):console.warn("mergeJsonResults: è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡æ•°æ®",l)}return t.sort((d,n)=>d.imageIndex-n.imageIndex),t}function Sl(){const o=et(),t=Je(),d=Ft(),n=rt(),l=S(!1),a=S({current:0,total:0,completed:0,failed:0,isInProgress:!1,isPaused:!1});let s=[],r=null;function x(){const P=o.images;if(P.length===0)return null;const h=[];for(let I=0;I<P.length;I++){const D=P[I];if(!D)continue;const E=D.originalTexts||[],c={imageIndex:I,bubbles:[]};for(let u=0;u<E.length;u++){const y=E[u]||"";let b="vertical";const R=D.bubbleStates?.[u];if(R&&R.textDirection){const M=R.textDirection;b=M==="auto"?"vertical":M}else D.userLayoutDirection&&D.userLayoutDirection!=="auto"&&(b=D.userLayoutDirection);c.bubbles.push({bubbleIndex:u,original:y,translated:"",textDirection:b})}h.push(c)}return h}function A(){return o.images.map(P=>{const h=P.originalDataURL;return h.includes(",")?h.split(",")[1]||"":h})}async function w(P,h,I){const{hqTranslation:D}=t.settings,E=JSON.stringify(h,null,2),c=[{type:"text",text:D.prompt+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®:
\`\`\`json
`+E+"\n```"}];for(const b of P)c.push({type:"image_url",image_url:{url:`data:image/png;base64,${b}`}});const u=[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹å’Œä¸Šä¸‹æ–‡æä¾›é«˜è´¨é‡çš„ç¿»è¯‘ã€‚"},{role:"user",content:c}],y={provider:D.provider,api_key:D.apiKey,model_name:D.modelName,custom_base_url:D.customBaseUrl,messages:u,low_reasoning:D.lowReasoning,force_json_output:D.forceJsonOutput,no_thinking_method:D.noThinkingMethod,use_stream:D.useStream};try{console.log(`é«˜è´¨é‡ç¿»è¯‘: é€šè¿‡åç«¯ä»£ç†è°ƒç”¨ ${D.provider} API...`);const b=await co(y);if(!b.success)throw new Error(b.error||"API è°ƒç”¨å¤±è´¥");if(b.results&&b.results.length>0){const M=b.results[0];if(M&&"imageIndex"in M&&"bubbles"in M)return b.results}const R=b.content;if(R)if(D.forceJsonOutput)try{return JSON.parse(R)}catch(M){throw console.error("è§£æAIå¼ºåˆ¶JSONè¿”å›çš„å†…å®¹å¤±è´¥:",M),new Error("è§£æAIè¿”å›çš„JSONç»“æœå¤±è´¥")}else{const M=R.match(/```json\s*([\s\S]*?)\s*```/);if(M&&M[1])try{return JSON.parse(M[1])}catch(J){throw console.error("è§£æAIè¿”å›çš„JSONå¤±è´¥:",J),new Error("è§£æAIè¿”å›çš„ç¿»è¯‘ç»“æœå¤±è´¥")}}return null}catch(b){throw console.error("è°ƒç”¨AIç¿»è¯‘APIå¤±è´¥:",b),b}}async function W(){const P=o.images.length;let h=0;a.value.label=`æ¶ˆé™¤æ–‡å­—: 0/${P}`,a.value.percentage=0;for(let I=0;I<P;I++){const D=Math.floor(I/P*25);a.value.label=`æ¶ˆé™¤æ–‡å­—: ${I+1}/${P}`,a.value.percentage=D,o.setTranslationStatus(I,"processing");const E=o.images[I];if(!E||!E.originalDataURL){o.setTranslationStatus(I,"pending");continue}const c=no(E);if(c?.isEmpty){console.log(`é«˜è´¨é‡ç¿»è¯‘[${I}]: æ–‡æœ¬æ¡†å·²è¢«ç”¨æˆ·æ¸…ç©ºï¼Œè·³è¿‡æ­¤å›¾ç‰‡`),o.setTranslationStatus(I,"pending");continue}if(c){const u=c.isManual?"æ‰‹åŠ¨æ ‡æ³¨æ¡†":"å·²æœ‰æ–‡æœ¬æ¡†";console.log(`é«˜è´¨é‡ç¿»è¯‘[${I}]: ä½¿ç”¨${u} ${c.coords.length} ä¸ª`)}try{const u=so(E.originalDataURL,{removeTextOnly:!0,existingBubbleCoords:c?.coords,existingBubbleAngles:c?.angles,useExistingBubbles:!!c}),y=await Pt(u);if(y.translated_image){const b=r?.textDirection,R=b==="vertical"||b==="horizontal"||b==="auto"?b:"vertical",M=y.bubble_coords?ln(y,{fontSize:r?.fontSize||t.settings.textStyle.fontSize,fontFamily:r?.fontFamily||t.settings.textStyle.fontFamily,textDirection:R,textColor:r?.textColor||t.settings.textStyle.textColor,fillColor:r?.fillColor||t.settings.textStyle.fillColor,strokeEnabled:r?.strokeEnabled??t.settings.textStyle.strokeEnabled,strokeColor:r?.strokeColor||t.settings.textStyle.strokeColor,strokeWidth:r?.strokeWidth??t.settings.textStyle.strokeWidth,inpaintMethod:t.settings.textStyle.inpaintMethod}):[];o.updateImageByIndex(I,{translatedDataURL:`data:image/png;base64,${y.translated_image}`,cleanImageData:y.clean_image||null,bubbleCoords:y.bubble_coords||[],bubbleAngles:y.bubble_angles||[],originalTexts:y.original_texts||[],textboxTexts:y.textbox_texts||[],bubbleStates:M,bubbleTexts:M.map(J=>J.translatedText||""),translationFailed:!1,translationStatus:"completed",showOriginal:!1,hasUnsavedChanges:!0}),console.log(`é«˜è´¨é‡ç¿»è¯‘-æ¶ˆé™¤æ–‡å­—[${I+1}/${P}]: å¤„ç†å®Œæˆ`)}else h++,o.updateImageByIndex(I,{translationFailed:!0,translationStatus:"failed"})}catch(u){console.error(`å›¾ç‰‡ ${I} æ¶ˆé™¤æ–‡å­—å¤±è´¥:`,u),h++,o.updateImageByIndex(I,{translationFailed:!0,translationStatus:"failed"})}}if(a.value.label="æ¶ˆé™¤æ–‡å­—å®Œæˆ",a.value.percentage=25,h>0)throw new Error(`æ¶ˆé™¤æ–‡å­—å®Œæˆï¼Œä½†æœ‰ ${h} å¼ å›¾ç‰‡å¤±è´¥`)}async function G(P){if(!P||P.length===0)throw new Error("æ²¡æœ‰æœ‰æ•ˆçš„ç¿»è¯‘æ•°æ®å¯å¯¼å…¥");const h=o.images,I=o.currentImageIndex,D=r?.fontSize||t.settings.textStyle.fontSize,E=r?.autoFontSize??t.settings.textStyle.autoFontSize,c=r?.fontFamily||t.settings.textStyle.fontFamily,u=r?.textDirection||t.settings.textStyle.layoutDirection,y=u==="auto"?"vertical":u,b=r?.textColor||t.settings.textStyle.textColor,R=r?.fillColor||t.settings.textStyle.fillColor,M=r?.strokeEnabled??t.settings.textStyle.strokeEnabled,J=r?.strokeColor||t.settings.textStyle.strokeColor,V=r?.strokeWidth??t.settings.textStyle.strokeWidth;a.value.label="æ›´æ–°å›¾ç‰‡æ•°æ®...",a.value.percentage=90;const U=P.length;let O=0;for(const f of P){O++,a.value.label=`å¤„ç†å›¾ç‰‡ ${O}/${U}`,a.value.percentage=90+O/U*5;const m=f.imageIndex;if(m<0||m>=h.length){console.warn(`è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${m}`);continue}const $=h[m];if(!$)continue;let v=!1;const g=$.bubbleTexts||[],k=$.bubbleCoords||[];for(const Y of f.bubbles||[]){const F=Y.bubbleIndex;if(F<0||F>=k.length){console.warn(`å›¾ç‰‡ ${m}: è·³è¿‡æ— æ•ˆçš„æ°”æ³¡ç´¢å¼• ${F}`);continue}const _=Y.translated;let z=Y.textDirection;z==="auto"&&(z=y),g[F]=_;const T=z==="vertical"||z==="horizontal"?z:y;if(!$.bubbleStates||!Array.isArray($.bubbleStates)||$.bubbleStates.length!==k.length){const p=$.bubbleAngles||[],K=[];for(let i=0;i<k.length;i++){const C=i===F?T:y,ie=k[i];let L=C;const te=$.bubbleStates?.[i];if(te?.autoTextDirection&&te.autoTextDirection!=="auto")L=te.autoTextDirection;else if(ie&&ie.length>=4){const[ce,we,$e,Fe]=ie;L=Fe-we>$e-ce?"vertical":"horizontal"}K.push({translatedText:g[i]||"",originalText:$.originalTexts?.[i]||"",textboxText:"",coords:ie,polygon:[],fontSize:D,fontFamily:c,textDirection:C,autoTextDirection:L,position:{x:0,y:0},textColor:b,rotationAngle:p[i]||0,fillColor:R,strokeEnabled:M,strokeColor:J,strokeWidth:V,inpaintMethod:t.settings.textStyle.inpaintMethod})}$.bubbleStates=K}else if($.bubbleStates[F])$.bubbleStates[F].translatedText=_,z&&z!=="auto"&&($.bubbleStates[F].textDirection=T);else{const K=($.bubbleAngles||[])[F]||0,i=k[F];let C=T;if(i&&i.length>=4){const[ie,L,te,ce]=i;C=ce-L>te-ie?"vertical":"horizontal"}$.bubbleStates[F]={translatedText:_,originalText:$.originalTexts?.[F]||"",textboxText:"",coords:i,polygon:[],fontSize:D,fontFamily:c,textDirection:T,autoTextDirection:C,position:{x:0,y:0},textColor:b,rotationAngle:K,fillColor:R,strokeEnabled:M,strokeColor:J,strokeWidth:V,inpaintMethod:t.settings.textStyle.inpaintMethod}}v=!0}if(v&&$.bubbleStates){const Y=$.bubbleStates.map(F=>F.translatedText||"");if($.cleanImageData)try{const{apiClient:F}=await st(async()=>{const{apiClient:p}=await import("./client.Bht704G-.js");return{apiClient:p}},__vite__mapDeps([4,5])),_=$.bubbleStates.map(p=>({translatedText:p.translatedText||"",coords:p.coords,fontSize:p.fontSize||D,fontFamily:p.fontFamily||c,textDirection:p.textDirection||y,textColor:p.textColor||b,rotationAngle:p.rotationAngle||0,position:p.position||{x:0,y:0},strokeEnabled:p.strokeEnabled??M,strokeColor:p.strokeColor||J,strokeWidth:p.strokeWidth??V}));let z=$.cleanImageData;z.includes("base64,")&&(z=z.split("base64,")[1]||"");const T=await F.post("/api/re_render_image",{clean_image:z,bubble_texts:Y,bubble_coords:k,fontSize:E?"auto":D,autoFontSize:E,fontFamily:c,textDirection:y,textColor:b,bubble_states:_,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!1,strokeEnabled:M,strokeColor:J,strokeWidth:V});T.rendered_image&&(o.updateImageByIndex(m,{translatedDataURL:`data:image/png;base64,${T.rendered_image}`,bubbleStates:$.bubbleStates,bubbleTexts:Y,hasUnsavedChanges:!0}),console.log(`å·²å®Œæˆå›¾ç‰‡ ${m} çš„æ¸²æŸ“`))}catch(F){console.error(`é‡æ–°æ¸²æŸ“å›¾ç‰‡ ${m} å¤±è´¥:`,F)}else o.updateImageByIndex(m,{bubbleStates:$.bubbleStates,bubbleTexts:Y,hasUnsavedChanges:!0})}}I>=0&&I<h.length&&o.setCurrentImageIndex(I)}async function j(){if(o.images.length===0)return n.warning("è¯·å…ˆæ·»åŠ å›¾ç‰‡"),!1;if(o.isBatchTranslationInProgress)return n.warning("è¯·ç­‰å¾…å½“å‰æ‰¹é‡æ“ä½œå®Œæˆ"),!1;if(!d.validateBeforeTranslation("hq"))return!1;const{hqTranslation:P,textStyle:h}=t.settings,I=h.layoutDirection;r={fontFamily:h.fontFamily,fontSize:h.fontSize,autoFontSize:h.autoFontSize,autoTextDirection:I==="auto",textDirection:I==="auto"?"vertical":I,fillColor:h.fillColor,textColor:h.textColor,rotationAngle:0,strokeEnabled:h.strokeEnabled,strokeColor:h.strokeColor,strokeWidth:h.strokeWidth},console.log("é«˜è´¨é‡ç¿»è¯‘å‰ä¿å­˜çš„æ–‡æœ¬æ ·å¼è®¾ç½®:",r),a.value={current:0,total:o.images.length,completed:0,failed:0,isInProgress:!0,isPaused:!1,label:"å‡†å¤‡ç¿»è¯‘...",percentage:0},n.info("æ­¥éª¤1/4: æ¶ˆé™¤æ‰€æœ‰å›¾ç‰‡æ–‡å­—..."),l.value=!0,o.setBatchTranslationInProgress(!0);try{await W(),n.info("æ­¥éª¤2/4: å¯¼å‡ºæ–‡æœ¬æ•°æ®..."),a.value.label="å¯¼å‡ºæ–‡æœ¬æ•°æ®...",a.value.percentage=25;const D=x();if(!D)throw new Error("å¯¼å‡ºæ–‡æœ¬å¤±è´¥");n.info("æ­¥éª¤3/4: å‡†å¤‡å›¾ç‰‡æ•°æ®..."),a.value.label="å‡†å¤‡å›¾ç‰‡æ•°æ®...",a.value.percentage=40;const E=A();n.info("æ­¥éª¤4/4: å‘é€åˆ°AIè¿›è¡Œç¿»è¯‘..."),a.value.label="å¼€å§‹å‘é€åˆ°AI...",a.value.percentage=50;const c=P.batchSize||3,u=P.sessionReset||5,y=P.maxRetries??2;s=[];const b=E.length,R=Math.ceil(b/c),M=P.rpmLimit||0,J=M>0?vo(M):null;let V=0,U=Et();for(let O=0;O<R;O++){a.value.label=`${O+1}/${R}`,a.value.percentage=Math.round(50+O/R*40),V>=u&&(console.log("é‡ç½®ä¼šè¯ä¸Šä¸‹æ–‡"),U=Et(),V=0);const f=O*c,m=Math.min(f+c,b),$=E.slice(f,m),v=rn(D,f,m);let g=0,k=!1;for(;g<=y&&!k;)try{J&&await J.acquire();const Y=await w($,v,U);if(Y)s.push(Y),k=!0;else{if(g++,g>y)break;await new Promise(F=>setTimeout(F,1e3));continue}V++}catch(Y){g++,g<=y?(console.log(`æ‰¹æ¬¡ ${O+1} ç¿»è¯‘å¤±è´¥ï¼Œç¬¬ ${g}/${y} æ¬¡é‡è¯•...`),n.warning(`æ‰¹æ¬¡ ${O+1} å¤±è´¥ï¼Œæ­£åœ¨é‡è¯• (${g}/${y})...`),await new Promise(F=>setTimeout(F,1e3))):(console.error(`æ‰¹æ¬¡ ${O+1} ç¿»è¯‘æœ€ç»ˆå¤±è´¥:`,Y),n.error(`æ‰¹æ¬¡ ${O+1} ç¿»è¯‘å¤±è´¥: ${Y instanceof Error?Y.message:"æœªçŸ¥é”™è¯¯"}`))}}return n.info("ç¿»è¯‘å®Œæˆï¼Œæ­£åœ¨å¯¼å…¥ç¿»è¯‘ç»“æœ..."),a.value.label="å¯¼å…¥ç¿»è¯‘ç»“æœ...",a.value.percentage=90,await G(un(s)),a.value.label="ç¿»è¯‘å®Œæˆï¼",a.value.percentage=100,n.success("é«˜è´¨é‡ç¿»è¯‘å®Œæˆï¼"),!0}catch(D){return console.error("é«˜è´¨é‡ç¿»è¯‘è¿‡ç¨‹å‡ºé”™:",D),n.error(`ç¿»è¯‘å¤±è´¥: ${D instanceof Error?D.message:"æœªçŸ¥é”™è¯¯"}`),!1}finally{l.value=!1,o.setBatchTranslationInProgress(!1),setTimeout(()=>{a.value.isInProgress=!1},1e3)}}return{isHqTranslating:l,progress:a,executeHqTranslation:j}}function Cl(){const o=et(),t=Je(),d=Ft(),n=rt(),l=S(!1),a=S({current:0,total:0,completed:0,failed:0,isInProgress:!1,isPaused:!1});let s=[];function r(){const G=o.images;if(G.length===0)return null;const j=[];for(let P=0;P<G.length;P++){const h=G[P];if(!h)continue;const I=h.originalTexts||[],D=h.bubbleTexts||[],E={imageIndex:P,bubbles:[]};for(let c=0;c<I.length;c++){const u=I[c]||"",y=(c<D.length?D[c]:"")||"";let b="vertical";const R=h.bubbleStates?.[c];if(R&&R.textDirection){const M=R.textDirection;b=M==="auto"?"vertical":M}else h.userLayoutDirection&&h.userLayoutDirection!=="auto"&&(b=h.userLayoutDirection);E.bubbles.push({bubbleIndex:c,original:u,translated:y,textDirection:b})}j.push(E)}return j}function x(){return o.images.map(G=>{const j=G.originalDataURL;return j.includes(",")?j.split(",")[1]||"":j})}async function A(G,j,P,h){const I=JSON.stringify(j,null,2),D=[{type:"text",text:P.prompt+`

ä»¥ä¸‹æ˜¯JSONæ•°æ®ï¼ŒåŒ…å«åŸæ–‡å’Œå·²æœ‰è¯‘æ–‡:
\`\`\`json
`+I+"\n```\nè¯·åœ¨ä¿æŒJSONæ ¼å¼çš„æƒ…å†µä¸‹ï¼Œæ ¡å¯¹æ¯ä¸ªbubbleçš„translatedå­—æ®µï¼Œä½¿ç¿»è¯‘æ›´åŠ å‡†ç¡®ã€è‡ªç„¶ã€ç¬¦åˆè¯­å¢ƒã€‚"}];for(const c of G)D.push({type:"image_url",image_url:{url:`data:image/png;base64,${c}`}});const E={provider:P.provider,api_key:P.apiKey,model_name:P.modelName,custom_base_url:P.customBaseUrl,messages:[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»ç¿»è¯‘æ ¡å¯¹åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæ ¹æ®æ¼«ç”»å›¾åƒå†…å®¹å’Œä¸Šä¸‹æ–‡å¯¹å·²æœ‰ç¿»è¯‘è¿›è¡Œæ ¡å¯¹å’Œæ¶¦è‰²ã€‚"},{role:"user",content:D}],low_reasoning:P.lowReasoning,no_thinking_method:P.noThinkingMethod,force_json_output:P.forceJsonOutput};try{console.log(`AIæ ¡å¯¹: é€šè¿‡åç«¯ä»£ç†è°ƒç”¨ ${P.provider} API...`);const c=await co(E);if(!c.success)throw new Error(c.error||"API è°ƒç”¨å¤±è´¥");if(c.results&&c.results.length>0){const y=c.results[0];if(y&&"imageIndex"in y&&"bubbles"in y)return c.results}const u=c.content;if(u)if(P.forceJsonOutput)try{return JSON.parse(u)}catch(y){throw console.error("è§£æAIå¼ºåˆ¶JSONè¿”å›çš„å†…å®¹å¤±è´¥:",y),new Error("è§£æAIè¿”å›çš„JSONç»“æœå¤±è´¥")}else{const y=u.match(/```json\s*([\s\S]*?)\s*```/);if(y&&y[1])try{return JSON.parse(y[1])}catch(b){throw console.error("è§£æAIè¿”å›çš„JSONå¤±è´¥:",b),new Error("è§£æAIè¿”å›çš„æ ¡å¯¹ç»“æœå¤±è´¥")}try{return JSON.parse(u)}catch(b){throw console.error("ç›´æ¥è§£æAIè¿”å›å†…å®¹å¤±è´¥:",b),new Error("æ— æ³•è§£æAIè¿”å›çš„æ ¡å¯¹ç»“æœ")}}return null}catch(c){throw console.error("è°ƒç”¨AIæ ¡å¯¹APIå¤±è´¥:",c),c}}async function w(G){if(!G||G.length===0){console.warn("æ²¡æœ‰æœ‰æ•ˆçš„æ ¡å¯¹æ•°æ®å¯å¯¼å…¥"),n.warning("æ²¡æœ‰æœ‰æ•ˆçš„æ ¡å¯¹ç»“æœå¯å¯¼å…¥");return}const j=o.images,P=o.currentImageIndex,{textStyle:h}=t.settings,I=h.fontSize,D=h.fontFamily,E=h.layoutDirection,c=E==="auto"?"vertical":E,u=h.textColor,y=h.fillColor,b=h.strokeEnabled,R=h.strokeColor,M=h.strokeWidth;for(const J of G){const V=J.imageIndex;if(V<0||V>=j.length){console.warn(`è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${V}`);continue}const U=j[V];if(!U)continue;if(!J.bubbles||!Array.isArray(J.bubbles)||J.bubbles.length===0){console.warn(`å›¾ç‰‡ ${V}: æ²¡æœ‰æœ‰æ•ˆçš„æ°”æ³¡æ•°æ®`);continue}let O=!1;const f=U.bubbleTexts||[],m=U.bubbleCoords||[];for(const $ of J.bubbles){const v=$.bubbleIndex,g=$.translated||"";let k=$.textDirection;if((!k||k==="auto")&&(k=c),v<0||v>=m.length){console.warn(`å›¾ç‰‡ ${V}: è·³è¿‡æ— æ•ˆçš„æ°”æ³¡ç´¢å¼• ${v}`);continue}for(;f.length<=v;)f.push("");if(f[v]=g,k&&k!=="auto"){const Y=k==="vertical"||k==="horizontal"?k:c;if(!U.bubbleStates||!Array.isArray(U.bubbleStates)||U.bubbleStates.length!==m.length){const F=U.bubbleAngles||[],_=[];for(let z=0;z<m.length;z++){const T=z===v?Y:c,p=m[z];let K=T;const i=U.bubbleStates?.[z];if(i?.autoTextDirection&&i.autoTextDirection!=="auto")K=i.autoTextDirection;else if(p&&p.length>=4){const[C,ie,L,te]=p;K=te-ie>L-C?"vertical":"horizontal"}_.push({translatedText:f[z]||"",originalText:U.originalTexts?.[z]||"",coords:p,fontSize:I,fontFamily:D,textDirection:T,autoTextDirection:K,position:{x:0,y:0},textColor:u,rotationAngle:F[z]||0,fillColor:y,strokeEnabled:b,strokeColor:R,strokeWidth:M})}U.bubbleStates=_}else U.bubbleStates[v]&&(U.bubbleStates[v].translatedText=g,U.bubbleStates[v].textDirection=Y)}O=!0}if(O&&U.bubbleStates){const $=U.bubbleStates.map(v=>v.translatedText||"");if(U.cleanImageData)try{const{apiClient:v}=await st(async()=>{const{apiClient:F}=await import("./client.Bht704G-.js");return{apiClient:F}},__vite__mapDeps([4,5])),g=U.bubbleStates.map(F=>({translatedText:F.translatedText||"",coords:F.coords,fontSize:F.fontSize||I,fontFamily:F.fontFamily||D,textDirection:F.textDirection||c,textColor:F.textColor||u,rotationAngle:F.rotationAngle||0,position:F.position||{x:0,y:0},strokeEnabled:F.strokeEnabled??b,strokeColor:F.strokeColor||R,strokeWidth:F.strokeWidth??M}));let k=U.cleanImageData;k.includes("base64,")&&(k=k.split("base64,")[1]||"");const Y=await v.post("/api/re_render_image",{clean_image:k,bubble_texts:$,bubble_coords:m,fontSize:I,fontFamily:D,textDirection:c,textColor:u,bubble_states:g,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!1,strokeEnabled:b,strokeColor:R,strokeWidth:M});Y.rendered_image&&(o.updateImageByIndex(V,{translatedDataURL:`data:image/png;base64,${Y.rendered_image}`,bubbleStates:U.bubbleStates,bubbleTexts:$,hasUnsavedChanges:!0}),console.log(`å·²å®Œæˆå›¾ç‰‡ ${V} çš„æ ¡å¯¹æ¸²æŸ“`))}catch(v){console.error(`é‡æ–°æ¸²æŸ“å›¾ç‰‡ ${V} å¤±è´¥:`,v)}else o.updateImageByIndex(V,{bubbleStates:U.bubbleStates,bubbleTexts:$,hasUnsavedChanges:!0})}}P>=0&&P<j.length&&o.setCurrentImageIndex(P)}async function W(){if(!d.validateBeforeTranslation("proofread"))return!1;const{proofreading:G}=t.settings;if(!G.enabled||G.rounds.length===0)return n.error("è¯·å…ˆå¯ç”¨ AI æ ¡å¯¹å¹¶æ·»åŠ æ ¡å¯¹è½®æ¬¡"),!1;const j=o.images;if(j.length===0)return n.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;if(!j.some(I=>I.bubbleTexts&&I.bubbleTexts.length>0))return n.error("è¯·å…ˆè¿›è¡Œç¿»è¯‘ä»¥è·å–è¯‘æ–‡"),!1;l.value=!0,o.setBatchTranslationInProgress(!0);const h=G.rounds.length;a.value={current:0,total:h,completed:0,failed:0,isInProgress:!0,isPaused:!1,label:"å‡†å¤‡æ ¡å¯¹...",percentage:0},n.info(`å¼€å§‹æ ¡å¯¹ï¼Œå…± ${h} è½®`);try{for(let I=0;I<h;I++){const D=G.rounds[I];if(!D)continue;const E=D.name||`è½®æ¬¡${I+1}`,c=I/h*100,u=1/h*100;n.info(`æ ¡å¯¹ç¬¬ ${I+1}/${h} è½®: ${E}`),a.value.label=`è½®æ¬¡ ${I+1}/${h}`,a.value.percentage=Math.round(c),n.info(`è½®æ¬¡ ${I+1}/${h}: å¯¼å‡ºæ–‡æœ¬æ•°æ®...`),a.value.label="å¯¼å‡ºæ–‡æœ¬...",a.value.percentage=Math.round(c+u*.2);const y=r();if(!y)throw new Error("å¯¼å‡ºæ–‡æœ¬å¤±è´¥");n.info(`è½®æ¬¡ ${I+1}/${h}: å‡†å¤‡å›¾ç‰‡æ•°æ®...`),a.value.label="å‡†å¤‡å›¾ç‰‡æ•°æ®...",a.value.percentage=Math.round(c+u*.4);const b=x();n.info(`è½®æ¬¡ ${I+1}/${h}: å‘é€åˆ°AIè¿›è¡Œæ ¡å¯¹...`),a.value.label="å¼€å§‹å‘é€åˆ°AI...",a.value.percentage=Math.round(c+u*.5);const R=D.batchSize||3,M=D.sessionReset||20,J=G.maxRetries??2;s=[];const V=b.length,U=Math.ceil(V/R),O=D.rpmLimit||7,f=O>0?vo(O):null;let m=0,$=Et(),v=0;for(let g=0;g<U;g++){const k=c+u*.5+u*.4*(g/U);a.value.label=`è½®æ¬¡ ${I+1}/${h}: ${g+1}/${U}`,a.value.percentage=Math.round(k),m>=M&&(console.log("é‡ç½®ä¼šè¯ä¸Šä¸‹æ–‡"),$=Et(),m=0);const Y=g*R,F=Math.min(Y+R,V),_=b.slice(Y,F),z=rn(y,Y,F);let T=0,p=!1;for(;T<=J&&!p;)try{f&&await f.acquire();const K=await A(_,z,D,$);K&&(s.push(K),v++,p=!0),m++}catch(K){T++,T<=J?(console.log(`è½®æ¬¡ ${I+1}, æ‰¹æ¬¡ ${g+1} æ ¡å¯¹å¤±è´¥ï¼Œç¬¬ ${T}/${J} æ¬¡é‡è¯•...`),n.warning(`è½®æ¬¡ ${I+1}, æ‰¹æ¬¡ ${g+1} å¤±è´¥ï¼Œæ­£åœ¨é‡è¯• (${T}/${J})...`),await new Promise(i=>setTimeout(i,1e3))):(console.error(`è½®æ¬¡ ${I+1}, æ‰¹æ¬¡ ${g+1} æ ¡å¯¹æœ€ç»ˆå¤±è´¥:`,K),n.error(`è½®æ¬¡ ${I+1}, æ‰¹æ¬¡ ${g+1} æ ¡å¯¹å¤±è´¥: ${K instanceof Error?K.message:"æœªçŸ¥é”™è¯¯"}`))}}if(v===0)throw new Error(`è½®æ¬¡ ${I+1} æ ¡å¯¹å®Œå…¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIè®¾ç½®æˆ–æ ¡å¯¹æç¤ºè¯`);n.info(`è½®æ¬¡ ${I+1}/${h}: å¯¼å…¥æ ¡å¯¹ç»“æœ...`),a.value.label="å¯¼å…¥æ ¡å¯¹ç»“æœ...",a.value.percentage=Math.round(c+u*.9),await w(un(s)),a.value.completed++}return a.value.label="æ ¡å¯¹å®Œæˆï¼",a.value.percentage=100,n.success(`AIæ ¡å¯¹å®Œæˆï¼Œå…± ${h} è½®`),!0}catch(I){const D=I instanceof Error?I.message:"AI æ ¡å¯¹å¤±è´¥";return n.error(`æ ¡å¯¹å¤±è´¥: ${D}`),a.value.label="æ ¡å¯¹å·²å–æ¶ˆ",a.value.percentage=0,!1}finally{l.value=!1,o.setBatchTranslationInProgress(!1),setTimeout(()=>{a.value.isInProgress=!1},1e3)}}return{isProofreading:l,progress:a,executeProofreading:W}}function mo(){const o=et(),t=Je(),d=dt(),n=Ft(),l=rt(),a=Sl(),s=Cl(),r=S(null),x=S({current:0,total:0,completed:0,failed:0,isInProgress:!1,isPaused:!1}),A=S(!1),w=ee(()=>A.value||o.isBatchTranslationInProgress||a.isHqTranslating.value||s.isProofreading.value),W=ee(()=>x.value.total===0?0:Math.round(x.value.completed/x.value.total*100));function G(){const M=t.settings.translation.rpmLimit;r.value?r.value.setRpm(M):r.value=vo(M)}function j(M,J,V={}){if(J.error||!J.translated_image){o.setTranslationStatus(M,"failed",J.error||"ç¿»è¯‘å¤±è´¥");return}const U=_l(J),O=J.translated_image?`data:image/png;base64,${J.translated_image}`:null,f=t.settings.textStyle.layoutDirection;o.updateImageByIndex(M,{translatedDataURL:O,cleanImageData:J.clean_image||null,bubbleStates:U,bubbleCoords:J.bubble_coords,bubbleAngles:J.bubble_angles||[],originalTexts:J.original_texts,textboxTexts:J.textbox_texts||[],bubbleTexts:U?.map(m=>m.translatedText||"")||[],userLayoutDirection:f,translationStatus:"completed",translationFailed:!1,hasUnsavedChanges:!0}),M===o.currentImageIndex&&U&&d.setBubbles(U)}async function P(M={}){if(M.removeTextOnly){if(!n.validateBeforeTranslation("ocr"))return!1}else if(!n.validateBeforeTranslation("normal"))return!1;const J=o.currentImage;if(!J)return l.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;A.value=!0,o.setTranslationStatus(o.currentImageIndex,"processing");const V=l.showGeneralMessage("ç¿»è¯‘ä¸­...","info",!1,0);try{G(),r.value&&await r.value.acquire();const U={...M};if(!U.existingBubbleCoords&&!U.existingBubbleStates){const m=no(J);if(m)if(m.isEmpty)console.log("ç¿»è¯‘å½“å‰å›¾ç‰‡: æ–‡æœ¬æ¡†å·²è¢«ç”¨æˆ·æ¸…ç©ºï¼Œå°†è·³è¿‡ç¿»è¯‘"),l.info("è¯¥å›¾ç‰‡æ— æ–‡æœ¬æ¡†ï¼Œè·³è¿‡ç¿»è¯‘",3e3),U.existingBubbleCoords=[],U.existingBubbleAngles=[],U.useExistingBubbles=!0;else{U.existingBubbleCoords=m.coords,U.existingBubbleAngles=m.angles,U.useExistingBubbles=!0;const $=m.isManual?"æ‰‹åŠ¨æ ‡æ³¨æ¡†":"å·²æœ‰çš„æ–‡æœ¬æ¡†";console.log(`ç¿»è¯‘å½“å‰å›¾ç‰‡: ä½¿ç”¨ ${m.coords.length} ä¸ª${$}`),l.info(m.isManual?"æ£€æµ‹åˆ°æ‰‹åŠ¨æ ‡æ³¨æ¡†ï¼Œå°†ä¼˜å…ˆä½¿ç”¨...":"ä½¿ç”¨å·²æœ‰çš„æ–‡æœ¬æ¡†è¿›è¡Œç¿»è¯‘...",3e3)}}const O=so(J.originalDataURL,U),f=await Pt(O);return l.clearGeneralMessageById(V),j(o.currentImageIndex,f,M),f.translated_image&&!f.error?(l.success("ç¿»è¯‘æˆåŠŸï¼"),!0):(l.error(f.error||"ç¿»è¯‘å¤±è´¥"),!1)}catch(U){l.clearGeneralMessageById(V);const O=U instanceof Error?U.message:"ç¿»è¯‘è¯·æ±‚å¤±è´¥";return o.markCurrentAsFailed(O),l.error(O),!1}finally{A.value=!1}}async function h(M,J={}){const V=o.images[M];if(!V)return console.error(`å›¾ç‰‡ç´¢å¼• ${M} ä¸å­˜åœ¨`),!1;o.setTranslationStatus(M,"processing");try{r.value&&await r.value.acquire();const U={...J};if(!U.existingBubbleCoords&&!U.existingBubbleStates){const m=no(V);if(m)if(m.isEmpty)console.log(`æ‰¹é‡ç¿»è¯‘å›¾ç‰‡ ${M}: æ–‡æœ¬æ¡†å·²è¢«ç”¨æˆ·æ¸…ç©ºï¼Œè·³è¿‡æ­¤å›¾ç‰‡çš„ç¿»è¯‘`),U.existingBubbleCoords=[],U.existingBubbleAngles=[],U.useExistingBubbles=!0;else{U.existingBubbleCoords=m.coords,U.existingBubbleAngles=m.angles,U.useExistingBubbles=!0;const $=m.isManual?"æ‰‹åŠ¨æ ‡æ³¨æ¡†":"å·²æœ‰çš„æ–‡æœ¬æ¡†";console.log(`æ‰¹é‡ç¿»è¯‘å›¾ç‰‡ ${M}: ä½¿ç”¨ ${m.coords.length} ä¸ª${$}`)}}const O=so(V.originalDataURL,U),f=await Pt(O);return j(M,f,J),!!f.translated_image&&!f.error}catch(U){const O=U instanceof Error?U.message:"ç¿»è¯‘è¯·æ±‚å¤±è´¥";return o.setTranslationStatus(M,"failed",O),!1}}async function I(M={}){if(M.removeTextOnly){if(!n.validateBeforeTranslation("ocr"))return!1}else if(!n.validateBeforeTranslation("normal"))return!1;const J=o.images;if(J.length===0)return l.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;const V=M.removeTextOnly===!0;x.value={current:0,total:J.length,completed:0,failed:0,isInProgress:!0,isPaused:!1,label:V?`æ¶ˆé™¤æ–‡å­—: 0/${J.length}`:`0/${J.length}`,percentage:0},o.setBatchTranslationInProgress(!0),G(),l.info(V?`å¼€å§‹æ¶ˆé™¤ ${J.length} å¼ å›¾ç‰‡æ–‡å­—...`:`å¼€å§‹æ‰¹é‡ç¿»è¯‘ ${J.length} å¼ å›¾ç‰‡...`);let U=!0;try{for(let O=0;O<J.length;O++){if(o.isBatchTranslationPaused&&await new Promise(m=>{o.setBatchTranslationResumeCallback(m)}),!o.isBatchTranslationInProgress){console.log("æ‰¹é‡ç¿»è¯‘å·²å–æ¶ˆ");break}x.value.current=O+1,x.value.label=V?`æ¶ˆé™¤æ–‡å­—: ${O+1}/${J.length}`:`${O+1}/${J.length}`,x.value.percentage=Math.round((O+1)/J.length*100),await h(O,M)?x.value.completed++:(x.value.failed++,U=!1)}return x.value.failed>0?l.warning(V?`æ¶ˆé™¤æ–‡å­—å®Œæˆï¼Œ${x.value.failed} å¼ å›¾ç‰‡å¤±è´¥`:`ç¿»è¯‘å®Œæˆï¼Œ${x.value.failed} å¼ å›¾ç‰‡å¤±è´¥`):l.success(V?"æ‰€æœ‰å›¾ç‰‡æ–‡å­—æ¶ˆé™¤å®Œæˆ":"æ‰€æœ‰å›¾ç‰‡ç¿»è¯‘å®Œæˆ"),U}catch(O){const f=O instanceof Error?O.message:"æ‰¹é‡ç¿»è¯‘å¤±è´¥";return l.error(f),!1}finally{o.setBatchTranslationInProgress(!1);const O=o.currentImageIndex;if(O>=0&&O<o.images.length){const f=o.images[O];f&&(f.bubbleStates&&f.bubbleStates.length>0&&d.setBubbles(f.bubbleStates),o.setCurrentImageIndex(O))}setTimeout(()=>{x.value.isInProgress=!1},1e3)}}function D(){o.isBatchTranslationInProgress&&!o.isBatchTranslationPaused&&(o.setBatchTranslationPaused(!0),x.value.isPaused=!0,l.info("æ‰¹é‡ç¿»è¯‘å·²æš‚åœ"))}function E(){o.isBatchTranslationInProgress&&o.isBatchTranslationPaused&&(o.resumeBatchTranslation(),x.value.isPaused=!1,l.info("æ‰¹é‡ç¿»è¯‘ç»§ç»­ä¸­"))}function c(){o.isBatchTranslationInProgress&&(o.isBatchTranslationPaused&&o.resumeBatchTranslation(),o.setBatchTranslationInProgress(!1),x.value.isInProgress=!1,l.info("æ‰¹é‡ç¿»è¯‘å·²å–æ¶ˆ"))}async function u(){return P({removeTextOnly:!0})}async function y(){return I({removeTextOnly:!0})}async function b(M={}){if(!n.validateBeforeTranslation("normal"))return!1;const J=o.getFailedImageIndices();if(J.length===0)return l.info("æ²¡æœ‰å¤±è´¥çš„å›¾ç‰‡éœ€è¦é‡æ–°ç¿»è¯‘"),!0;x.value={current:0,total:J.length,completed:0,failed:0,isInProgress:!0,isPaused:!1},o.setBatchTranslationInProgress(!0),G();let V=!0;try{for(let U=0;U<J.length&&(o.isBatchTranslationPaused&&await new Promise(m=>{o.setBatchTranslationResumeCallback(m)}),!!o.isBatchTranslationInProgress);U++){x.value.current=U+1;const O=J[U];if(O===void 0)continue;await h(O,M)?x.value.completed++:(x.value.failed++,V=!1)}return x.value.failed>0?l.warning(`é‡è¯•å®Œæˆï¼Œä»æœ‰ ${x.value.failed} å¼ å›¾ç‰‡å¤±è´¥`):l.success("æ‰€æœ‰å¤±è´¥å›¾ç‰‡é‡æ–°ç¿»è¯‘å®Œæˆ"),V}catch(U){const O=U instanceof Error?U.message:"é‡è¯•ç¿»è¯‘å¤±è´¥";return l.error(O),!1}finally{o.setBatchTranslationInProgress(!1),setTimeout(()=>{x.value.isInProgress=!1},1e3)}}async function R(){if(!o.currentImage)return l.error("è¯·å…ˆä¸Šä¼ å›¾ç‰‡"),!1;const J=d.bubbles;return!J||J.length===0?(l.error("å½“å‰å›¾ç‰‡æ²¡æœ‰æ°”æ³¡æ¡†ï¼Œè¯·å…ˆæ£€æµ‹æˆ–æ‰‹åŠ¨æ·»åŠ "),!1):P({useExistingBubbles:!0,existingBubbleStates:J})}return{progress:x,isTranslatingSingle:A,isHqTranslating:a.isHqTranslating,isProofreading:s.isProofreading,isTranslating:w,progressPercent:W,translateCurrentImage:P,translateImageByIndex:h,translateAllImages:I,pauseBatchTranslation:D,resumeBatchTranslation:E,cancelBatchTranslation:c,removeTextOnly:u,removeAllTexts:y,retryFailedImages:b,executeHqTranslation:a.executeHqTranslation,executeProofreading:s.executeProofreading,translateWithCurrentBubbles:R}}function wl(){const o=dt(),t=et(),d=S(!1);function n(){if(!d.value)return;const l=t.currentImage;o.bubbleCount>0?t.updateCurrentBubbleStates([...o.bubbles]):l&&Array.isArray(l.bubbleStates)&&l.bubbleStates.length>0&&(t.updateCurrentBubbleStates([]),console.log("é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼ˆæ— é‡æ¸²æŸ“ï¼‰ï¼Œç”¨æˆ·å·²åˆ é™¤æ‰€æœ‰æ°”æ³¡")),d.value=!1,o.clearSelection(),console.log("å·²é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼ˆæ— é‡æ¸²æŸ“ï¼‰")}return{isActive:d,exitEditModeWithoutRender:n}}function $l(){const o=Zo(),t=Je(),d=et(),n=nn(),l=dt(),a=wl(),s=S(!1),r=S(!1),x=S(null),A=S([]),w=S([]),W=S([]),G=S(null),j=S(null),P=S(null),h=S(null),I=S(!1);async function D(O=!1){if(!O&&(s.value||r.value)){console.log("[TranslateInit] å·²ç»åˆå§‹åŒ–ï¼Œä»…é‡æ–°åŠ è½½ä¸Šä¸‹æ–‡"),await b();return}console.log("[TranslateInit] å¼€å§‹åˆå§‹åŒ–åº”ç”¨..."),s.value=!0,x.value=null;try{await E(),await c(),await u(),await y(),await b(),console.log("[TranslateInit] åº”ç”¨åˆå§‹åŒ–å®Œæˆ"),r.value=!0}catch(f){console.error("[TranslateInit] åº”ç”¨åˆå§‹åŒ–å¤±è´¥:",f),x.value=f instanceof Error?f.message:"åˆå§‹åŒ–å¤±è´¥"}finally{s.value=!1}}async function E(){console.log("[TranslateInit] åˆå§‹åŒ–è®¾ç½®..."),t.initSettings();try{const O=await t.loadFromBackend();console.log(O?"[TranslateInit] å·²ä»åç«¯åŠ è½½è®¾ç½®":"[TranslateInit] åç«¯æ— è®¾ç½®ï¼Œä½¿ç”¨ localStorage æ•°æ®")}catch(O){console.warn("[TranslateInit] ä»åç«¯åŠ è½½è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨ localStorage æ•°æ®:",O)}console.log("[TranslateInit] è®¾ç½®åˆå§‹åŒ–å®Œæˆ")}async function c(){console.log("[TranslateInit] åˆå§‹åŒ–å­—ä½“åˆ—è¡¨...");try{const O=await en();O.fonts&&O.fonts.length>0?(A.value=O.fonts,console.log(`[TranslateInit] å·²åŠ è½½ ${O.fonts.length} ä¸ªå­—ä½“`)):O.error?console.warn("[TranslateInit] è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:",O.error):console.warn("[TranslateInit] å­—ä½“åˆ—è¡¨ä¸ºç©º")}catch(O){console.error("[TranslateInit] è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:",O)}}async function u(){console.log("[TranslateInit] åˆå§‹åŒ–ç¿»è¯‘æç¤ºè¯è®¾ç½®...");try{const O=await is();O.prompt_names!==void 0?(w.value=O.prompt_names||[],!t.settings.translatePrompt&&O.default_prompt_content&&t.setTranslatePrompt(O.default_prompt_content),console.log(`[TranslateInit] å·²åŠ è½½ ${w.value.length} ä¸ªç¿»è¯‘æç¤ºè¯`)):O.error&&console.warn("[TranslateInit] è·å–ç¿»è¯‘æç¤ºè¯å¤±è´¥:",O.error)}catch(O){console.error("[TranslateInit] è·å–ç¿»è¯‘æç¤ºè¯å¤±è´¥:",O)}}async function y(){console.log("[TranslateInit] åˆå§‹åŒ–æ–‡æœ¬æ¡†æç¤ºè¯è®¾ç½®...");try{const O=await ls();O.prompt_names!==void 0?(W.value=O.prompt_names||[],!t.settings.textboxPrompt&&O.default_prompt_content&&t.setTextboxPrompt(O.default_prompt_content),console.log(`[TranslateInit] å·²åŠ è½½ ${W.value.length} ä¸ªæ–‡æœ¬æ¡†æç¤ºè¯`)):O.error&&console.warn("[TranslateInit] è·å–æ–‡æœ¬æ¡†æç¤ºè¯å¤±è´¥:",O.error)}catch(O){console.error("[TranslateInit] è·å–æ–‡æœ¬æ¡†æç¤ºè¯å¤±è´¥:",O)}}async function b(){const O=o.query.book,f=o.query.chapter;if(!O||!f){console.log("[TranslateInit] æœªæŒ‡å®šä¹¦ç±/ç« èŠ‚å‚æ•°ï¼Œä½¿ç”¨ç‹¬ç«‹æ¨¡å¼"),I.value=!1,G.value=null,j.value=null,P.value=null,h.value=null,n.clearContext();return}console.log(`[TranslateInit] æ£€æµ‹åˆ°ä¹¦ç±/ç« èŠ‚å‚æ•°: book=${O}, chapter=${f}`),I.value=!0,G.value=O,j.value=f;try{const m=await us(O);if(!m.success||!m.book){console.warn("[TranslateInit] ä¹¦ç±ä¸å­˜åœ¨:",O),me("ä¹¦ç±ä¸å­˜åœ¨","warning");return}const $=m.book,v=$.chapters?.find(g=>g.id===f);if(!v){console.warn("[TranslateInit] ç« èŠ‚ä¸å­˜åœ¨:",f),me("ç« èŠ‚ä¸å­˜åœ¨","warning");return}if(P.value=$.title,h.value=v.title,n.setBookChapterContext(O,f,$.title,v.title),typeof document<"u"&&(document.title=`${v.title} - ${$.title} - Saber-Translator`),v.session_path){console.log(`[TranslateInit] å°è¯•åŠ è½½ç« èŠ‚ä¼šè¯: ${v.session_path}`);try{await n.loadSessionByPath(v.session_path),me(`å·²åŠ è½½ç« èŠ‚: ${v.title}`,"success")}catch{console.log("[TranslateInit] ç« èŠ‚ä¼šè¯æ•°æ®ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥ï¼Œå°†åˆ›å»ºæ–°ä¼šè¯")}}}catch(m){console.error("[TranslateInit] åŠ è½½ä¹¦ç±/ç« èŠ‚ä¿¡æ¯å¤±è´¥:",m),me("åŠ è½½ä¹¦ç±ä¿¡æ¯å¤±è´¥","error")}}function R(O){if(O<0||O>=d.imageCount){console.warn(`[TranslateInit] æ— æ•ˆçš„å›¾ç‰‡ç´¢å¼•: ${O}`);return}window._isChangingFromSwitchImage=!0,a.isActive.value&&a.exitEditModeWithoutRender(),d.currentImage&&l.bubbles.length>0&&d.updateCurrentImageProperty("bubbleStates",l.bubbles),d.setCurrentImageIndex(O);const m=d.currentImage;if(!m){console.warn("[TranslateInit] åˆ‡æ¢åˆ°çš„å›¾ç‰‡ä¸å­˜åœ¨"),window._isChangingFromSwitchImage=!1;return}console.log(`[TranslateInit] åˆ‡æ¢åˆ°å›¾ç‰‡: ${O}, ${m.fileName}`),m.bubbleStates&&m.bubbleStates.length>0?l.setBubbles(m.bubbleStates,!0):l.clearBubblesLocal(),M(m),setTimeout(()=>{window._isChangingFromSwitchImage=!1,console.log("[TranslateInit] å·²é‡ç½®åˆ‡æ¢å›¾ç‰‡æ“ä½œæ ‡è®°")},100)}function M(O){if(!O)return;const f=O.bubbleStates?.[0];f&&t.updateTextStyle({fontSize:f.fontSize||t.settings.textStyle.fontSize,fontFamily:f.fontFamily||t.settings.textStyle.fontFamily,layoutDirection:O.userLayoutDirection||f.textDirection||t.settings.textStyle.layoutDirection,textColor:f.textColor||t.settings.textStyle.textColor,fillColor:f.fillColor||t.settings.textStyle.fillColor,strokeEnabled:f.strokeEnabled??t.settings.textStyle.strokeEnabled,strokeColor:f.strokeColor||t.settings.textStyle.strokeColor,strokeWidth:f.strokeWidth||t.settings.textStyle.strokeWidth,inpaintMethod:f.inpaintMethod||t.settings.textStyle.inpaintMethod,autoFontSize:O.autoFontSize??t.settings.textStyle.autoFontSize})}function J(){d.canGoPrevious&&R(d.currentImageIndex-1)}function V(){d.canGoNext&&R(d.currentImageIndex+1)}function U(){ut(async()=>{await D()})}return{isInitializing:s,isInitialized:r,initError:x,fontList:A,promptNames:w,textboxPromptNames:W,currentBookId:G,currentChapterId:j,currentBookTitle:P,currentChapterTitle:h,isBookshelfMode:I,initializeApp:D,initializeSettings:E,initializeFontList:c,initializePromptSettings:u,initializeTextboxPromptSettings:y,initializeBookChapterContext:b,switchImage:R,goToPrevious:J,goToNext:V,loadImageSettingsToStore:M,editMode:a,setupAutoInit:U}}const Il={key:0,id:"translationProgressBar",class:"translation-progress-bar"},Tl={class:"progress-bar-label"},Dl={key:0,class:"failed-count"},Rl={key:0,class:"progress-controls"},Ml=["title"],Bl={class:"pause-icon"},Pl=He({__name:"TranslationProgress",props:{progress:{},showControls:{type:Boolean,default:!0}},emits:["pause","resume"],setup(o,{emit:t}){const d=o,n=t,l=et(),a=mo(),s=ee(()=>d.progress||a.progress.value),r=ee(()=>s.value.isInProgress||l.isBatchTranslationInProgress),x=ee(()=>s.value.current),A=ee(()=>s.value.total),w=ee(()=>s.value.failed),W=ee(()=>s.value.percentage!==void 0?s.value.percentage:A.value===0?0:Math.round(x.value/A.value*100)),G=ee(()=>s.value.isPaused||l.isBatchTranslationPaused),j=ee(()=>s.value.label?s.value.label:`${G.value?"å·²æš‚åœ":"ç¿»è¯‘ä¸­"}ï¼š${x.value} / ${A.value}`);function P(){G.value?(a.resumeBatchTranslation(),n("resume")):(a.pauseBatchTranslation(),n("pause"))}return(h,I)=>r.value?(N(),q("div",Il,[e("div",Tl,[Se(le(j.value)+" ",1),w.value>0?(N(),q("span",Dl,"ï¼ˆ"+le(w.value)+" å¼ å¤±è´¥ï¼‰",1)):de("",!0)]),e("div",{class:Ie(["progress-bar",{paused:G.value}])},[e("div",{class:"progress",style:at({width:`${W.value}%`})},null,4)],2),d.showControls?(N(),q("div",Rl,[e("button",{class:Ie(["pause-btn",{paused:G.value}]),onClick:P,title:G.value?"ç»§ç»­ç¿»è¯‘":"æš‚åœç¿»è¯‘"},[e("span",Bl,le(G.value?"â–¶":"â¸"),1),Se(" "+le(G.value?"ç»§ç»­":"æš‚åœ"),1)],10,Ml)])):de("",!0)])):de("",!0)}}),El=qe(Pl,[["__scopeId","data-v-d438b9d6"]]),Al=He({__name:"SponsorModal",emits:["close"],setup(o,{emit:t}){const d=t;return(n,l)=>(N(),lt(tn,{title:"æ”¯æŒä½œè€…",onClose:l[1]||(l[1]=a=>d("close"))},{footer:ht(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:l[0]||(l[0]=a=>d("close"))},"å…³é—­")]),default:ht(()=>[l[2]||(l[2]=e("div",{class:"sponsor-content"},[e("p",{class:"sponsor-message"}," å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯·ä½œè€…å–æ¯å’–å•¡ â˜• "),e("div",{class:"qr-codes"},[e("div",{class:"qr-item"},[e("div",{class:"qr-image"},[e("img",{src:"/pic/wechat_qrcode.png",alt:"å¾®ä¿¡æ”¯ä»˜"})]),e("span",{class:"qr-label"},"å¾®ä¿¡æ”¯ä»˜")]),e("div",{class:"qr-item"},[e("div",{class:"qr-image"},[e("img",{src:"/pic/alipay_qrcode.png",alt:"æ”¯ä»˜å®"})]),e("span",{class:"qr-label"},"æ”¯ä»˜å®")])]),e("p",{class:"sponsor-thanks"},"æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼ğŸ™")],-1))]),_:1}))}}),Fl=qe(Al,[["__scopeId","data-v-02b6948e"]]),Ll={id:"thumbnail-sidebar",class:"thumbnail-sidebar"},Ul={class:"card thumbnail-card"},Ol=["title","data-index","onClick"],zl=["src","alt"],Nl={key:1,class:"translation-failed-indicator"},Vl={key:2,class:"labeled-indicator"},Wl={key:3,class:"thumbnail-processing-indicator"},Kl={key:1,class:"empty-state"},ql=He({__name:"ThumbnailSidebar",emits:["select"],setup(o,{emit:t}){const d=t,n=et(),l=S(null),a=S([]),s=ee(()=>n.images),r=ee(()=>n.currentImageIndex),x=ee(()=>n.hasImages);function A(h){d("select",h)}function w(){ct(()=>{const h=a.value[r.value];if(h&&l.value){const I=l.value,D=h.offsetTop-I.clientHeight/2+h.clientHeight/2;I.scrollTo({top:Math.max(0,D),behavior:"smooth"})}})}function W(h,I){a.value[I]=h}function G(h){return h.translationFailed?"failed":h.isManuallyAnnotated?"labeled":h.translationStatus==="processing"?"processing":null}function j(h){const I=[];return h.translationFailed&&I.push("translation-failed"),h.isManuallyAnnotated&&I.push("has-manual-labels"),I}function P(h){return h.translationFailed?"ç¿»è¯‘å¤±è´¥ï¼Œç‚¹å‡»å¯é‡è¯•":h.isManuallyAnnotated?"åŒ…å«æ‰‹åŠ¨æ ‡æ³¨":h.fileName||""}return he(r,()=>{w()}),ut(()=>{x.value&&w()}),(h,I)=>(N(),q("aside",Ll,[e("div",Ul,[I[1]||(I[1]=e("h2",null,"å›¾ç‰‡æ¦‚è§ˆ",-1)),x.value?(N(),q("ul",{key:0,ref_key:"containerRef",ref:l,id:"thumbnailList",class:"thumbnail-list"},[(N(!0),q(Ke,null,je(s.value,(D,E)=>(N(),q("li",{key:D.id,ref_for:!0,ref:c=>W(c,E),class:Ie(["thumbnail-item",[{active:E===r.value},...j(D)]]),title:P(D),"data-index":E,onClick:c=>A(E)},[D.originalDataURL?(N(),q("img",{key:0,src:D.originalDataURL,alt:D.fileName,class:"thumbnail-image"},null,8,zl)):de("",!0),G(D)==="failed"?(N(),q("span",Nl,"!")):G(D)==="labeled"?(N(),q("span",Vl,"âœï¸")):de("",!0),G(D)==="processing"?(N(),q("div",Wl,"âŸ³")):de("",!0)],10,Ol))),128))],512)):(N(),q("div",Kl,[...I[0]||(I[0]=[e("p",null,"æš‚æ— å›¾ç‰‡",-1)])]))])]))}}),Hl=qe(ql,[["__scopeId","data-v-899e5674"]]),Jl={class:"saved-prompts-picker"},jl={class:"prompts-chips-container"},Yl={key:0,class:"empty-hint"},Gl={key:1,class:"empty-hint"},Xl=["title","onClick"],Zl=He({__name:"SavedPromptsPicker",props:{promptType:{}},emits:["select"],setup(o,{expose:t,emit:d}){const n=o,l=d,a=S([]),s=S(!1);async function r(){s.value=!0;try{let A;n.promptType==="textbox"?A=await Ne.getTextboxPrompts():A=await Ne.getPrompts(n.promptType);const w=A.prompt_names||[];a.value=w.map(W=>({name:W}))}catch(A){console.error("åŠ è½½æç¤ºè¯åˆ—è¡¨å¤±è´¥:",A),a.value=[]}finally{s.value=!1}}async function x(A){try{let w;n.promptType==="textbox"?w=await Ne.getTextboxPromptContent(A):w=await Ne.getPromptContent(n.promptType,A),w.prompt_content&&l("select",w.prompt_content,A)}catch(w){console.error("åŠ è½½æç¤ºè¯å†…å®¹å¤±è´¥:",w)}}return he(()=>n.promptType,()=>{r()}),ut(()=>{r()}),t({refresh:r}),(A,w)=>(N(),q("div",Jl,[w[1]||(w[1]=e("span",{class:"picker-label"},"ğŸ“‘ å¿«é€Ÿé€‰æ‹©:",-1)),e("div",jl,[s.value?(N(),q("span",Yl,"åŠ è½½ä¸­...")):a.value.length===0?(N(),q("span",Gl,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(N(!0),q(Ke,{key:2},je(a.value,W=>(N(),q("button",{key:W.name,type:"button",class:"prompt-chip",title:W.name,onClick:G=>x(W.name)},[w[0]||(w[0]=e("span",{class:"chip-icon"},"ğŸ“",-1)),Se(" "+le(W.name),1)],8,Xl))),128))])]))}}),It=qe(Zl,[["__scopeId","data-v-2ebbb8b3"]]),Ql={class:"ocr-settings"},ei={class:"settings-group"},ti={class:"settings-item"},oi={class:"settings-item"},ni={class:"input-hint"},si={class:"settings-group"},ai={class:"settings-row"},li={class:"settings-item"},ii={class:"password-input-wrapper"},ri=["type"],ui={key:0,class:"eye-icon"},ci={key:1,class:"eye-off-icon"},di={class:"settings-item"},gi={class:"password-input-wrapper"},pi=["type"],vi={key:0,class:"eye-icon"},mi={key:1,class:"eye-off-icon"},bi={class:"settings-row"},fi={class:"settings-item"},hi={class:"settings-item"},yi=["disabled"],xi={class:"settings-group"},ki={class:"settings-row"},_i={class:"settings-item"},Si={class:"settings-item"},Ci={class:"password-input-wrapper"},wi=["type"],$i={key:0,class:"eye-icon"},Ii={key:1,class:"eye-off-icon"},Ti={class:"settings-item"},Di={class:"settings-item"},Ri={class:"model-input-with-fetch"},Mi=["disabled"],Bi={class:"fetch-text"},Pi={key:0,class:"model-select-container"},Ei={class:"model-count"},Ai={class:"settings-item"},Fi={class:"prompt-format-selector"},Li={class:"settings-item"},Ui=["disabled"],Oi=He({__name:"OcrSettings",setup(o){const t=[{label:"MangaOCR (æ—¥è¯­ä¸“ç”¨)",value:"manga_ocr"},{label:"PaddleOCR (å¤šè¯­è¨€)",value:"paddle_ocr"},{label:"ç™¾åº¦OCR",value:"baidu_ocr"},{label:"48px OCR",value:"48px_ocr"},{label:"AIè§†è§‰OCR",value:"ai_vision"}],d=[{label:"æ ‡å‡†ç‰ˆ",value:"standard"},{label:"é«˜ç²¾åº¦ç‰ˆ",value:"high_precision"}],n=[{label:"è‡ªåŠ¨æ£€æµ‹",value:"auto_detect"},{label:"ä¸­è‹±æ–‡æ··åˆ",value:"CHN_ENG"},{label:"è‹±æ–‡",value:"ENG"},{label:"æ—¥è¯­",value:"JAP"},{label:"éŸ©è¯­",value:"KOR"},{label:"æ³•è¯­",value:"FRE"},{label:"å¾·è¯­",value:"GER"},{label:"ä¿„è¯­",value:"RUS"}],l=[{label:"SiliconFlow (ç¡…åŸºæµåŠ¨)",value:"siliconflow"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai_vision"}],a=[{label:"æ™®é€šæç¤ºè¯",value:"false"},{label:"JSONæç¤ºè¯",value:"true"}],s=[{label:"ğŸš€ å¸¸ç”¨è¯­è¨€",options:[{label:"æ—¥è¯­",value:"japanese"},{label:"è‹±è¯­",value:"en"},{label:"ç®€ä½“ä¸­æ–‡",value:"chinese"},{label:"ç¹ä½“ä¸­æ–‡",value:"chinese_cht"},{label:"éŸ©è¯­",value:"korean"}]},{label:"ğŸŒ æ‹‰ä¸è¯­ç³»",options:[{label:"æ³•è¯­",value:"french"},{label:"å¾·è¯­",value:"german"},{label:"è¥¿ç­ç‰™è¯­",value:"spanish"},{label:"æ„å¤§åˆ©è¯­",value:"italian"},{label:"è‘¡è„ç‰™è¯­",value:"portuguese"}]},{label:"ğŸŒ å…¶ä»–è¯­ç³»",options:[{label:"ä¿„è¯­",value:"russian"}]}],r=Je(),x=rt(),A=S({apiKey:r.settings.baiduOcr.apiKey,secretKey:r.settings.baiduOcr.secretKey,version:r.settings.baiduOcr.version,sourceLanguage:r.settings.baiduOcr.sourceLanguage}),w=S({apiKey:r.settings.aiVisionOcr.apiKey,modelName:r.settings.aiVisionOcr.modelName,customBaseUrl:r.settings.aiVisionOcr.customBaseUrl,prompt:r.settings.aiVisionOcr.prompt,rpmLimit:r.settings.aiVisionOcr.rpmLimit}),W=ee(()=>r.settings);he(()=>A.value.apiKey,f=>{r.updateBaiduOcr({apiKey:f})}),he(()=>A.value.secretKey,f=>{r.updateBaiduOcr({secretKey:f})}),he(()=>A.value.version,f=>{r.updateBaiduOcr({version:f})}),he(()=>A.value.sourceLanguage,f=>{r.updateBaiduOcr({sourceLanguage:f})}),he(()=>w.value.apiKey,f=>{r.updateAiVisionOcr({apiKey:f})}),he(()=>w.value.modelName,f=>{r.updateAiVisionOcr({modelName:f})}),he(()=>w.value.customBaseUrl,f=>{r.updateAiVisionOcr({customBaseUrl:f})}),he(()=>w.value.prompt,f=>{r.updateAiVisionOcr({prompt:f})}),he(()=>w.value.rpmLimit,f=>{r.updateAiVisionOcr({rpmLimit:f})});const G=S(!1),j=S(!1),P=S(!1),h=S(!1),I=S(!1),D=S([]),E=ee(()=>{const f=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return D.value.forEach(m=>{f.push({label:m,value:m})}),f});function c(){r.saveToStorage()}function u(){r.saveToStorage()}function y(){switch(r.settings.ocrEngine){case"manga_ocr":return"MangaOCR ä¸“ä¸ºæ—¥è¯­æ¼«ç”»ä¼˜åŒ–ï¼Œæºè¯­è¨€è®¾ç½®ä¸å½±å“è¯†åˆ«";case"paddle_ocr":return"PaddleOCR ä¼šæ ¹æ®æºè¯­è¨€åŠ è½½å¯¹åº”çš„è¯†åˆ«æ¨¡å‹";case"baidu_ocr":return"ç™¾åº¦OCR ä½¿ç”¨ç‹¬ç«‹çš„æºè¯­è¨€è®¾ç½®ï¼ˆè§ä¸‹æ–¹ï¼‰";case"ai_vision":return"AIè§†è§‰OCR é€šè¿‡æç¤ºè¯æŒ‡å®šè¯†åˆ«è¯­è¨€";case"48px_ocr":return"48px OCR æ”¯æŒæ—¥ä¸­è‹±éŸ©ç­‰å¤šè¯­è¨€ï¼Œæºè¯­è¨€è®¾ç½®ä¸å½±å“è¯†åˆ«";default:return"é€‰æ‹©è¦è¯†åˆ«çš„åŸæ–‡è¯­è¨€"}}function b(f){r.setAiVisionOcrProvider(f),D.value=[],R()}function R(){w.value.apiKey=r.settings.aiVisionOcr.apiKey,w.value.modelName=r.settings.aiVisionOcr.modelName,w.value.customBaseUrl=r.settings.aiVisionOcr.customBaseUrl,w.value.prompt=r.settings.aiVisionOcr.prompt,w.value.rpmLimit=r.settings.aiVisionOcr.rpmLimit}function M(){const f=r.settings.aiVisionOcr.isJsonMode?Ln:Un;r.updateAiVisionOcr({prompt:f}),w.value.prompt=f}async function J(){const f=A.value.apiKey?.trim(),m=A.value.secretKey?.trim();if(!f||!m){x.warning("è¯·å¡«å†™ç™¾åº¦OCRçš„API Keyå’ŒSecret Key");return}h.value=!0,x.info("æ­£åœ¨æµ‹è¯•ç™¾åº¦OCRè¿æ¥...");try{const $=await Ne.testBaiduOcrConnection(f,m);$.success?x.success($.message||"ç™¾åº¦OCRè¿æ¥æˆåŠŸ!"):x.error($.message||$.error||"ç™¾åº¦OCRè¿æ¥å¤±è´¥")}catch($){const v=$ instanceof Error?$.message:"è¿æ¥æµ‹è¯•å¤±è´¥";x.error(v)}finally{h.value=!1}}async function V(){h.value=!0;try{const f=await Ne.testAiVisionOcrConnection({provider:r.settings.aiVisionOcr.provider,apiKey:w.value.apiKey,modelName:w.value.modelName,customBaseUrl:w.value.customBaseUrl,prompt:w.value.prompt});f.success?x.success("AIè§†è§‰OCRè¿æ¥æˆåŠŸ"):x.error(`AIè§†è§‰OCRè¿æ¥å¤±è´¥: ${f.error||"æœªçŸ¥é”™è¯¯"}`)}catch(f){const m=f instanceof Error?f.message:"è¿æ¥æµ‹è¯•å¤±è´¥";x.error(m)}finally{h.value=!1}}async function U(){const f=r.settings.aiVisionOcr.provider,m=w.value.apiKey?.trim(),$=w.value.customBaseUrl?.trim();if(!m){x.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","volcano","gemini","custom_openai_vision"].includes(f)){x.warning("å½“å‰æœåŠ¡å•†ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨");return}if(f==="custom_openai_vision"&&!$){x.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}I.value=!0;try{const g=await Ne.fetchModels(f,m,$);g.success&&g.models&&g.models.length>0?(D.value=g.models.map(k=>k.id),x.success(`è·å–åˆ° ${g.models.length} ä¸ªæ¨¡å‹`)):x.warning(g.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(g){const k=g instanceof Error?g.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";x.error(k)}finally{I.value=!1}}function O(f,m){r.updateAiVisionOcr({prompt:f}),w.value.prompt=f,x.success(`å·²åº”ç”¨æç¤ºè¯: ${m}`)}return(f,m)=>(N(),q("div",Ql,[e("div",ei,[m[19]||(m[19]=e("div",{class:"settings-group-title"},"OCRå¼•æ“é€‰æ‹©",-1)),e("div",ti,[m[17]||(m[17]=e("label",{for:"settingsOcrEngine"},"OCRå¼•æ“:",-1)),be(ze,{"model-value":W.value.ocrEngine,options:t,onChange:m[0]||(m[0]=$=>{W.value.ocrEngine=$,c()})},null,8,["model-value"])]),ae(e("div",oi,[m[18]||(m[18]=e("label",{for:"settingsSourceLanguage"},"æºè¯­è¨€:",-1)),be(ze,{"model-value":W.value.sourceLanguage,groups:s,onChange:m[1]||(m[1]=$=>{W.value.sourceLanguage=$,u()})},null,8,["model-value"]),e("div",ni,le(y()),1)],512),[[Ue,W.value.ocrEngine==="paddle_ocr"]])]),ae(e("div",si,[m[24]||(m[24]=e("div",{class:"settings-group-title"},"ç™¾åº¦OCR è®¾ç½®",-1)),e("div",ai,[e("div",li,[m[20]||(m[20]=e("label",{for:"settingsBaiduApiKey"},"API Key:",-1)),e("div",ii,[ae(e("input",{type:G.value?"text":"password",id:"settingsBaiduApiKey","onUpdate:modelValue":m[2]||(m[2]=$=>A.value.apiKey=$),class:"secure-input",placeholder:"è¯·è¾“å…¥ç™¾åº¦OCR API Key",autocomplete:"off"},null,8,ri),[[kt,A.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:m[3]||(m[3]=$=>G.value=!G.value)},[G.value?(N(),q("span",ci,"ğŸ‘â€ğŸ—¨")):(N(),q("span",ui,"ğŸ‘"))])])]),e("div",di,[m[21]||(m[21]=e("label",{for:"settingsBaiduSecretKey"},"Secret Key:",-1)),e("div",gi,[ae(e("input",{type:j.value?"text":"password",id:"settingsBaiduSecretKey","onUpdate:modelValue":m[4]||(m[4]=$=>A.value.secretKey=$),class:"secure-input",placeholder:"è¯·è¾“å…¥Secret Key",autocomplete:"off"},null,8,pi),[[kt,A.value.secretKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:m[5]||(m[5]=$=>j.value=!j.value)},[j.value?(N(),q("span",mi,"ğŸ‘â€ğŸ—¨")):(N(),q("span",vi,"ğŸ‘"))])])])]),e("div",bi,[e("div",fi,[m[22]||(m[22]=e("label",{for:"settingsBaiduVersion"},"è¯†åˆ«ç‰ˆæœ¬:",-1)),be(ze,{modelValue:A.value.version,"onUpdate:modelValue":m[6]||(m[6]=$=>A.value.version=$),options:d},null,8,["modelValue"])]),e("div",hi,[m[23]||(m[23]=e("label",{for:"settingsBaiduSourceLanguage"},"æºè¯­è¨€:",-1)),be(ze,{modelValue:A.value.sourceLanguage,"onUpdate:modelValue":m[7]||(m[7]=$=>A.value.sourceLanguage=$),options:n},null,8,["modelValue"])])]),e("button",{class:"settings-test-btn",onClick:J,disabled:h.value},le(h.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,yi)],512),[[Ue,W.value.ocrEngine==="baidu_ocr"]]),ae(e("div",xi,[m[34]||(m[34]=e("div",{class:"settings-group-title"},"AIè§†è§‰OCR è®¾ç½®",-1)),e("div",ki,[e("div",_i,[m[25]||(m[25]=e("label",{for:"settingsAiVisionProvider"},"æœåŠ¡å•†:",-1)),be(ze,{"model-value":W.value.aiVisionOcr.provider,options:l,onChange:m[8]||(m[8]=$=>b($))},null,8,["model-value"])]),e("div",Si,[m[26]||(m[26]=e("label",{for:"settingsAiVisionApiKey"},"API Key:",-1)),e("div",Ci,[ae(e("input",{type:P.value?"text":"password",id:"settingsAiVisionApiKey","onUpdate:modelValue":m[9]||(m[9]=$=>w.value.apiKey=$),class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,wi),[[kt,w.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:m[10]||(m[10]=$=>P.value=!P.value)},[P.value?(N(),q("span",Ii,"ğŸ‘â€ğŸ—¨")):(N(),q("span",$i,"ğŸ‘"))])])])]),ae(e("div",Ti,[m[27]||(m[27]=e("label",{for:"settingsCustomAiVisionBaseUrl"},"Base URL:",-1)),ae(e("input",{type:"text",id:"settingsCustomAiVisionBaseUrl","onUpdate:modelValue":m[11]||(m[11]=$=>w.value.customBaseUrl=$),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[Ce,w.value.customBaseUrl]])],512),[[Ue,W.value.aiVisionOcr.provider==="custom_openai_vision"]]),e("div",Di,[m[29]||(m[29]=e("label",{for:"settingsAiVisionModelName"},"æ¨¡å‹åç§°:",-1)),e("div",Ri,[ae(e("input",{type:"text",id:"settingsAiVisionModelName","onUpdate:modelValue":m[12]||(m[12]=$=>w.value.modelName=$),placeholder:"å¦‚: silicon-llava2-34b"},null,512),[[Ce,w.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:U,disabled:I.value},[m[28]||(m[28]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",Bi,le(I.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,Mi)]),D.value.length>0?(N(),q("div",Pi,[be(ze,{modelValue:w.value.modelName,"onUpdate:modelValue":m[13]||(m[13]=$=>w.value.modelName=$),options:E.value},null,8,["modelValue","options"]),e("span",Ei,"å…± "+le(D.value.length)+" ä¸ªæ¨¡å‹",1)])):de("",!0)]),e("div",Ai,[m[31]||(m[31]=e("label",{for:"settingsAiVisionOcrPrompt"},"OCRæç¤ºè¯:",-1)),ae(e("textarea",{id:"settingsAiVisionOcrPrompt","onUpdate:modelValue":m[14]||(m[14]=$=>w.value.prompt=$),rows:"3",placeholder:"AIè§†è§‰OCRæç¤ºè¯"},null,512),[[Ce,w.value.prompt]]),be(It,{"prompt-type":"ai_vision_ocr",onSelect:O}),e("div",Fi,[be(ze,{"model-value":W.value.aiVisionOcr.isJsonMode?"true":"false",options:a,onChange:m[15]||(m[15]=$=>{W.value.aiVisionOcr.isJsonMode=$==="true",M()})},null,8,["model-value"]),m[30]||(m[30]=e("span",{class:"input-hint"},"JSONæ ¼å¼è¾“å‡ºæ›´ç»“æ„åŒ–",-1))])]),e("div",Li,[m[32]||(m[32]=e("label",{for:"settingsRpmAiVisionOcr"},"RPMé™åˆ¶ (æ¯åˆ†é’Ÿè¯·æ±‚æ•°):",-1)),ae(e("input",{type:"number",id:"settingsRpmAiVisionOcr","onUpdate:modelValue":m[16]||(m[16]=$=>w.value.rpmLimit=$),min:"0",step:"1"},null,512),[[Ce,w.value.rpmLimit,void 0,{number:!0}]]),m[33]||(m[33]=e("div",{class:"input-hint"},"0 è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("button",{class:"settings-test-btn",onClick:V,disabled:h.value},le(h.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,Ui)],512),[[Ue,W.value.ocrEngine==="ai_vision"]])]))}}),zi=qe(Oi,[["__scopeId","data-v-38c660c4"]]),Ni={class:"translation-settings"},Vi={class:"settings-group"},Wi={class:"settings-row"},Ki={class:"settings-item"},qi={class:"settings-item"},Hi={for:"settingsApiKey"},Ji={class:"password-input-wrapper"},ji=["type","placeholder"],Yi={key:0,class:"eye-icon"},Gi={key:1,class:"eye-off-icon"},Xi={class:"settings-item"},Zi={class:"settings-item"},Qi={for:"settingsModelName"},er={class:"model-input-with-fetch"},tr=["placeholder"],or=["disabled"],nr={class:"fetch-text"},sr={key:0,class:"model-select-container"},ar={class:"model-count"},lr={class:"settings-item"},ir={class:"local-model-list"},rr={key:0,class:"model-list-container"},ur=["disabled"],cr={key:1,class:"model-hint"},dr={key:1,class:"model-list-container"},gr=["disabled"],pr={key:1,class:"model-hint"},vr={class:"settings-row"},mr={class:"settings-item"},br={class:"settings-item"},fr={class:"settings-item"},hr=["disabled"],yr={class:"settings-item"},xr=["disabled"],kr={class:"settings-group"},_r={class:"settings-item"},Sr={class:"prompt-format-selector"},Cr={class:"settings-item"},wr={class:"checkbox-label"},$r={class:"settings-item"},Ir=He({__name:"TranslationSettings",setup(o){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"å½©äº‘å°è¯‘",value:"caiyun"},{label:"ç™¾åº¦ç¿»è¯‘",value:"baidu_translate"},{label:"æœ‰é“ç¿»è¯‘",value:"youdao_translate"},{label:"Google Gemini",value:"gemini"},{label:"Ollama (æœ¬åœ°)",value:"ollama"},{label:"Sakura (æœ¬åœ°)",value:"sakura"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],d=[{label:"æ™®é€šæç¤ºè¯",value:"normal"},{label:"JSONæç¤ºè¯",value:"json"}],n=Je(),l=rt(),a=S({modelProvider:n.settings.translation.provider,apiKey:n.settings.translation.apiKey,modelName:n.settings.translation.modelName,customBaseUrl:n.settings.translation.customBaseUrl,rpmTranslation:n.settings.translation.rpmLimit,translationMaxRetries:n.settings.translation.maxRetries,promptContent:n.settings.translatePrompt,translatePromptMode:n.settings.translation.isJsonMode?"json":"normal",enableTextboxPrompt:n.settings.useTextboxPrompt,textboxPromptContent:n.settings.textboxPrompt}),s=S(!1),r=S(!1),x=S(!1),A=S([]),w=S([]),W=S([]),G=ee(()=>{const v=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return A.value.forEach(g=>v.push({label:g,value:g})),v}),j=ee(()=>{const v=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return w.value.forEach(g=>v.push({label:g,value:g})),v}),P=ee(()=>{const v=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return W.value.forEach(g=>v.push({label:g,value:g})),v}),h=ee(()=>["ollama","sakura"].includes(a.value.modelProvider)),I=ee(()=>!["ollama","sakura","caiyun","baidu_translate","youdao_translate"].includes(a.value.modelProvider)),D=ee(()=>["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(a.value.modelProvider)),E=ee(()=>{switch(a.value.modelProvider){case"baidu_translate":return"App ID";case"youdao_translate":return"App Key";case"caiyun":return"API Token";default:return"API Key"}}),c=ee(()=>{switch(a.value.modelProvider){case"baidu_translate":return"è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘App ID";case"youdao_translate":return"è¯·è¾“å…¥æœ‰é“ç¿»è¯‘åº”ç”¨ID";case"caiyun":return"è¯·è¾“å…¥å½©äº‘å°è¯‘Token";default:return"è¯·è¾“å…¥API Key"}}),u=ee(()=>{switch(a.value.modelProvider){case"baidu_translate":return"App Key";case"youdao_translate":return"App Secret";case"caiyun":return"æºè¯­è¨€ (å¯é€‰)";default:return"æ¨¡å‹åç§°"}}),y=ee(()=>{switch(a.value.modelProvider){case"baidu_translate":return"è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘App Key";case"youdao_translate":return"è¯·è¾“å…¥æœ‰é“ç¿»è¯‘åº”ç”¨å¯†é’¥";case"caiyun":return"å¯é€‰: auto/æ—¥è¯­/è‹±è¯­";default:return"è¯·è¾“å…¥æ¨¡å‹åç§°"}});function b(){const v=a.value.modelProvider;n.setTranslationProvider(v),a.value.apiKey=n.settings.translation.apiKey,a.value.modelName=n.settings.translation.modelName,a.value.customBaseUrl=n.settings.translation.customBaseUrl,a.value.rpmTranslation=n.settings.translation.rpmLimit,a.value.translationMaxRetries=n.settings.translation.maxRetries,A.value=[]}function R(){const v=a.value.translatePromptMode==="json";v?a.value.promptContent=On:a.value.promptContent=zn,n.updateTranslationService({isJsonMode:v}),n.setTranslatePrompt(a.value.promptContent)}he(()=>a.value.apiKey,v=>{n.updateTranslationService({apiKey:v})}),he(()=>a.value.modelName,v=>{n.updateTranslationService({modelName:v})}),he(()=>a.value.customBaseUrl,v=>{n.updateTranslationService({customBaseUrl:v})}),he(()=>a.value.rpmTranslation,v=>{n.updateTranslationService({rpmLimit:v})}),he(()=>a.value.translationMaxRetries,v=>{n.updateTranslationService({maxRetries:v})}),he(()=>a.value.promptContent,v=>{n.setTranslatePrompt(v)}),he(()=>a.value.enableTextboxPrompt,v=>{n.setUseTextboxPrompt(v)}),he(()=>a.value.textboxPromptContent,v=>{n.setTextboxPrompt(v)});async function M(){const v=a.value.modelProvider,g=a.value.apiKey?.trim(),k=a.value.customBaseUrl?.trim();if(!g){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(v)){l.warning(`${J(v)} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`);return}if(v==="custom_openai"&&!k){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}x.value=!0;try{const F=await Ne.fetchModels(v,g,k);F.success&&F.models&&F.models.length>0?(A.value=F.models.map(_=>_.id),l.success(`è·å–åˆ° ${F.models.length} ä¸ªæ¨¡å‹`)):l.warning(F.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(F){const _=F instanceof Error?F.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";l.error(_)}finally{x.value=!1}}function J(v){return{siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰OpenAI",ollama:"Ollama",sakura:"Sakura",caiyun:"å½©äº‘å°è¯‘",baidu_translate:"ç™¾åº¦ç¿»è¯‘",youdao_translate:"æœ‰é“ç¿»è¯‘"}[v]||v}async function V(){x.value=!0;try{const v=await Ne.testOllamaConnection();v.success&&v.models?(w.value=v.models,l.success(`è·å–åˆ° ${v.models.length} ä¸ªOllamaæ¨¡å‹`)):l.error(v.error||"Ollamaè¿æ¥å¤±è´¥")}catch(v){const g=v instanceof Error?v.message:"è·å–Ollamaæ¨¡å‹å¤±è´¥";l.error(g)}finally{x.value=!1}}async function U(){x.value=!0;try{const v=await Ne.testSakuraConnection();v.success&&v.models?(W.value=v.models,l.success(`è·å–åˆ° ${v.models.length} ä¸ªSakuraæ¨¡å‹`)):l.error(v.error||"Sakuraè¿æ¥å¤±è´¥")}catch(v){const g=v instanceof Error?v.message:"è·å–Sakuraæ¨¡å‹å¤±è´¥";l.error(g)}finally{x.value=!1}}async function O(){r.value=!0;try{let v;a.value.modelProvider==="ollama"?v=await Ne.testOllamaConnection():v=await Ne.testSakuraConnection(),v.success?l.success(`${a.value.modelProvider==="ollama"?"Ollama":"Sakura"} è¿æ¥æˆåŠŸ`):l.error(v.error||"è¿æ¥å¤±è´¥")}catch(v){const g=v instanceof Error?v.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(g)}finally{r.value=!1}}async function f(){const v=a.value.modelProvider,g=a.value.apiKey?.trim(),k=a.value.modelName?.trim(),Y=a.value.customBaseUrl?.trim();if(!g){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(v!=="caiyun"&&!k){l.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}if(v==="custom_openai"&&!Y){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å¡«å†™ Base URL");return}r.value=!0,l.info("æ­£åœ¨æµ‹è¯•è¿æ¥...");try{let F;switch(v){case"baidu_translate":F=await Ne.testBaiduTranslateConnection(g,k);break;case"youdao_translate":F=await Ne.testYoudaoTranslateConnection(g,k);break;default:F=await Ne.testAiTranslateConnection({provider:v,apiKey:g,modelName:k,baseUrl:Y})}F.success?l.success(F.message||`${J(v)} è¿æ¥æˆåŠŸ!`):l.error(F.message||F.error||"è¿æ¥å¤±è´¥")}catch(F){const _=F instanceof Error?F.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(_)}finally{r.value=!1}}function m(v,g){a.value.promptContent=v,l.success(`å·²åº”ç”¨æç¤ºè¯: ${g}`)}function $(v,g){a.value.textboxPromptContent=v,l.success(`å·²åº”ç”¨æç¤ºè¯: ${g}`)}return(v,g)=>(N(),q("div",Ni,[e("div",Vi,[g[21]||(g[21]=e("div",{class:"settings-group-title"},"ç¿»è¯‘æœåŠ¡é…ç½®",-1)),e("div",Wi,[e("div",Ki,[g[14]||(g[14]=e("label",{for:"settingsModelProvider"},"ç¿»è¯‘æœåŠ¡å•†:",-1)),be(ze,{"model-value":a.value.modelProvider,options:t,onChange:g[0]||(g[0]=k=>{a.value.modelProvider=k,b()})},null,8,["model-value"])]),ae(e("div",qi,[e("label",Hi,le(E.value)+":",1),e("div",Ji,[ae(e("input",{type:s.value?"text":"password",id:"settingsApiKey","onUpdate:modelValue":g[1]||(g[1]=k=>a.value.apiKey=k),class:"secure-input",placeholder:c.value,autocomplete:"off"},null,8,ji),[[kt,a.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:g[2]||(g[2]=k=>s.value=!s.value)},[s.value?(N(),q("span",Gi,"ğŸ‘â€ğŸ—¨")):(N(),q("span",Yi,"ğŸ‘"))])])],512),[[Ue,!h.value]])]),ae(e("div",Xi,[g[15]||(g[15]=e("label",{for:"settingsCustomBaseUrl"},"Base URL:",-1)),ae(e("input",{type:"text",id:"settingsCustomBaseUrl","onUpdate:modelValue":g[3]||(g[3]=k=>a.value.customBaseUrl=k),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[Ce,a.value.customBaseUrl]])],512),[[Ue,a.value.modelProvider==="custom_openai"]]),ae(e("div",Zi,[e("label",Qi,le(u.value)+":",1),e("div",er,[ae(e("input",{type:"text",id:"settingsModelName","onUpdate:modelValue":g[4]||(g[4]=k=>a.value.modelName=k),placeholder:y.value},null,8,tr),[[Ce,a.value.modelName]]),ae(e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:M,disabled:x.value},[g[16]||(g[16]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",nr,le(x.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,or),[[Ue,D.value]])]),A.value.length>0?(N(),q("div",sr,[be(ze,{"model-value":a.value.modelName,options:G.value,onChange:g[5]||(g[5]=k=>{a.value.modelName=k})},null,8,["model-value","options"]),e("span",ar,"å…± "+le(A.value.length)+" ä¸ªæ¨¡å‹",1)])):de("",!0)],512),[[Ue,!h.value]]),ae(e("div",lr,[g[17]||(g[17]=e("label",null,"æœ¬åœ°æ¨¡å‹:",-1)),e("div",ir,[a.value.modelProvider==="ollama"?(N(),q("div",rr,[e("button",{class:"settings-test-btn",onClick:V,disabled:x.value},le(x.value?"è·å–ä¸­...":"ğŸ”„ åˆ·æ–°æ¨¡å‹åˆ—è¡¨"),9,ur),w.value.length>0?(N(),lt(ze,{key:0,"model-value":a.value.modelName,options:j.value,onChange:g[6]||(g[6]=k=>a.value.modelName=k)},null,8,["model-value","options"])):(N(),q("p",cr,"ç‚¹å‡»åˆ·æ–°è·å–å¯ç”¨æ¨¡å‹"))])):a.value.modelProvider==="sakura"?(N(),q("div",dr,[e("button",{class:"settings-test-btn",onClick:U,disabled:x.value},le(x.value?"è·å–ä¸­...":"ğŸ”„ åˆ·æ–°æ¨¡å‹åˆ—è¡¨"),9,gr),W.value.length>0?(N(),lt(ze,{key:0,"model-value":a.value.modelName,options:P.value,onChange:g[7]||(g[7]=k=>a.value.modelName=k)},null,8,["model-value","options"])):(N(),q("p",pr,"ç‚¹å‡»åˆ·æ–°è·å–å¯ç”¨æ¨¡å‹"))])):de("",!0)])],512),[[Ue,h.value]]),ae(e("div",vr,[e("div",mr,[g[18]||(g[18]=e("label",{for:"settingsRpmTranslation"},"RPMé™åˆ¶:",-1)),ae(e("input",{type:"number",id:"settingsRpmTranslation","onUpdate:modelValue":g[8]||(g[8]=k=>a.value.rpmTranslation=k),min:"0",step:"1"},null,512),[[Ce,a.value.rpmTranslation,void 0,{number:!0}]]),g[19]||(g[19]=e("div",{class:"input-hint"},"æ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",br,[g[20]||(g[20]=e("label",{for:"settingsTranslationMaxRetries"},"é‡è¯•æ¬¡æ•°:",-1)),ae(e("input",{type:"number",id:"settingsTranslationMaxRetries","onUpdate:modelValue":g[9]||(g[9]=k=>a.value.translationMaxRetries=k),min:"0",max:"10",step:"1"},null,512),[[Ce,a.value.translationMaxRetries,void 0,{number:!0}]])])],512),[[Ue,I.value]]),ae(e("div",fr,[e("button",{class:"settings-test-btn",onClick:O,disabled:r.value},le(r.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,hr)],512),[[Ue,h.value]]),ae(e("div",yr,[e("button",{class:"settings-test-btn",onClick:f,disabled:r.value},le(r.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,xr)],512),[[Ue,!h.value]])]),e("div",kr,[g[26]||(g[26]=e("div",{class:"settings-group-title"},"æç¤ºè¯è®¾ç½®",-1)),e("div",_r,[g[23]||(g[23]=e("label",{for:"settingsPromptContent"},"ç¿»è¯‘æç¤ºè¯:",-1)),ae(e("textarea",{id:"settingsPromptContent","onUpdate:modelValue":g[10]||(g[10]=k=>a.value.promptContent=k),rows:"4",placeholder:"ç¿»è¯‘æç¤ºè¯"},null,512),[[Ce,a.value.promptContent]]),e("div",Sr,[be(ze,{"model-value":a.value.translatePromptMode,options:d,onChange:g[11]||(g[11]=k=>{a.value.translatePromptMode=k,R()})},null,8,["model-value"]),g[22]||(g[22]=e("span",{class:"input-hint"},"JSONæ ¼å¼è¾“å‡ºæ›´ç»“æ„åŒ–",-1))]),be(It,{"prompt-type":"translate",onSelect:m})]),e("div",Cr,[e("label",wr,[ae(e("input",{type:"checkbox","onUpdate:modelValue":g[12]||(g[12]=k=>a.value.enableTextboxPrompt=k)},null,512),[[Qe,a.value.enableTextboxPrompt]]),g[24]||(g[24]=Se(" å¯ç”¨æ–‡æœ¬æ¡†æç¤ºè¯ ",-1))])]),ae(e("div",$r,[g[25]||(g[25]=e("label",{for:"settingsTextboxPromptContent"},"æ–‡æœ¬æ¡†æç¤ºè¯:",-1)),ae(e("textarea",{id:"settingsTextboxPromptContent","onUpdate:modelValue":g[13]||(g[13]=k=>a.value.textboxPromptContent=k),rows:"3",placeholder:"æ–‡æœ¬æ¡†æç¤ºè¯"},null,512),[[Ce,a.value.textboxPromptContent]]),be(It,{"prompt-type":"textbox",onSelect:$})],512),[[Ue,a.value.enableTextboxPrompt]])])]))}}),Tr=qe(Ir,[["__scopeId","data-v-165d523b"]]),Dr={class:"detection-settings"},Rr={class:"settings-group"},Mr={class:"settings-item"},Br={class:"settings-group"},Pr={class:"settings-item"},Er={class:"settings-row"},Ar={class:"settings-item"},Fr={class:"settings-item"},Lr={class:"settings-row"},Ur={class:"settings-item"},Or={class:"settings-item"},zr={class:"settings-group"},Nr={class:"settings-item"},Vr={class:"checkbox-label"},Wr={class:"settings-row"},Kr={class:"settings-item"},qr={class:"settings-item"},Hr={class:"settings-group"},Jr={class:"settings-item"},jr={class:"checkbox-label"},Yr=He({__name:"DetectionSettings",setup(o){const t=[{label:"CTD (Comic Text Detector)",value:"ctd"},{label:"YOLO",value:"yolo"},{label:"YOLOv5",value:"yolov5"},{label:"Default (DBNet)",value:"default"}],d=Je(),n=Kn({textDetector:d.settings.textDetector,boxExpandRatio:d.settings.boxExpand.ratio,boxExpandTop:d.settings.boxExpand.top,boxExpandBottom:d.settings.boxExpand.bottom,boxExpandLeft:d.settings.boxExpand.left,boxExpandRight:d.settings.boxExpand.right,usePreciseMask:d.settings.preciseMask.enabled,maskDilateSize:d.settings.preciseMask.dilateSize,maskBoxExpandRatio:d.settings.preciseMask.boxExpandRatio,showDetectionDebug:d.settings.showDetectionDebug}),l=ee(()=>["ctd","default"].includes(n.textDetector));he(()=>n.textDetector,s=>{d.setTextDetector(s)}),he(()=>n.boxExpandRatio,s=>{d.updateBoxExpand({ratio:s})}),he(()=>n.boxExpandTop,s=>{d.updateBoxExpand({top:s})}),he(()=>n.boxExpandBottom,s=>{d.updateBoxExpand({bottom:s})}),he(()=>n.boxExpandLeft,s=>{d.updateBoxExpand({left:s})}),he(()=>n.boxExpandRight,s=>{d.updateBoxExpand({right:s})}),he(()=>n.usePreciseMask,s=>{d.updatePreciseMask({enabled:s})}),he(()=>n.maskDilateSize,s=>{d.updatePreciseMask({dilateSize:s})}),he(()=>n.maskBoxExpandRatio,s=>{d.updatePreciseMask({boxExpandRatio:s})}),he(()=>n.showDetectionDebug,s=>{d.setShowDetectionDebug(s)});function a(){l.value||(n.usePreciseMask=!1)}return(s,r)=>(N(),q("div",Dr,[e("div",Rr,[r[11]||(r[11]=e("div",{class:"settings-group-title"},"æ–‡å­—æ£€æµ‹å™¨",-1)),e("div",Mr,[r[10]||(r[10]=e("label",{for:"settingsTextDetector"},"æ£€æµ‹å™¨ç±»å‹:",-1)),be(ze,{modelValue:n.textDetector,"onUpdate:modelValue":r[0]||(r[0]=x=>n.textDetector=x),options:t,onChange:a},null,8,["modelValue"])])]),e("div",Br,[r[18]||(r[18]=e("div",{class:"settings-group-title"},"æ–‡æœ¬æ¡†æ‰©å±•å‚æ•°",-1)),e("div",Pr,[r[12]||(r[12]=e("label",{for:"settingsBoxExpandRatio"},"æ•´ä½“æ‰©å±• (%):",-1)),ae(e("input",{type:"number",id:"settingsBoxExpandRatio","onUpdate:modelValue":r[1]||(r[1]=x=>n.boxExpandRatio=x),min:"0",max:"50",step:"1"},null,512),[[Ce,n.boxExpandRatio,void 0,{number:!0}]]),r[13]||(r[13]=e("div",{class:"input-hint"},"å‘å››å‘¨å‡åŒ€æ‰©å±•çš„ç™¾åˆ†æ¯” (0-50%)",-1))]),e("div",Er,[e("div",Ar,[r[14]||(r[14]=e("label",{for:"settingsBoxExpandTop"},"ä¸Šæ–¹æ‰©å±• (%):",-1)),ae(e("input",{type:"number",id:"settingsBoxExpandTop","onUpdate:modelValue":r[2]||(r[2]=x=>n.boxExpandTop=x),min:"0",max:"50",step:"1"},null,512),[[Ce,n.boxExpandTop,void 0,{number:!0}]])]),e("div",Fr,[r[15]||(r[15]=e("label",{for:"settingsBoxExpandBottom"},"ä¸‹æ–¹æ‰©å±• (%):",-1)),ae(e("input",{type:"number",id:"settingsBoxExpandBottom","onUpdate:modelValue":r[3]||(r[3]=x=>n.boxExpandBottom=x),min:"0",max:"50",step:"1"},null,512),[[Ce,n.boxExpandBottom,void 0,{number:!0}]])])]),e("div",Lr,[e("div",Ur,[r[16]||(r[16]=e("label",{for:"settingsBoxExpandLeft"},"å·¦ä¾§æ‰©å±• (%):",-1)),ae(e("input",{type:"number",id:"settingsBoxExpandLeft","onUpdate:modelValue":r[4]||(r[4]=x=>n.boxExpandLeft=x),min:"0",max:"50",step:"1"},null,512),[[Ce,n.boxExpandLeft,void 0,{number:!0}]])]),e("div",Or,[r[17]||(r[17]=e("label",{for:"settingsBoxExpandRight"},"å³ä¾§æ‰©å±• (%):",-1)),ae(e("input",{type:"number",id:"settingsBoxExpandRight","onUpdate:modelValue":r[5]||(r[5]=x=>n.boxExpandRight=x),min:"0",max:"50",step:"1"},null,512),[[Ce,n.boxExpandRight,void 0,{number:!0}]])])])]),ae(e("div",zr,[r[25]||(r[25]=e("div",{class:"settings-group-title"},"ç²¾ç¡®æ–‡å­—æ©è†œ",-1)),e("div",Nr,[e("label",Vr,[ae(e("input",{type:"checkbox","onUpdate:modelValue":r[6]||(r[6]=x=>n.usePreciseMask=x)},null,512),[[Qe,n.usePreciseMask]]),r[19]||(r[19]=Se(" å¯ç”¨ç²¾ç¡®æ–‡å­—æ©è†œ ",-1))]),r[20]||(r[20]=e("div",{class:"input-hint"},"ä½¿ç”¨æ›´ç²¾ç¡®çš„æ–‡å­—åŒºåŸŸæ©è†œè¿›è¡Œä¿®å¤",-1))]),ae(e("div",Wr,[e("div",Kr,[r[21]||(r[21]=e("label",{for:"settingsMaskDilateSize"},"è†¨èƒ€å¤§å°:",-1)),ae(e("input",{type:"number",id:"settingsMaskDilateSize","onUpdate:modelValue":r[7]||(r[7]=x=>n.maskDilateSize=x),min:"0",step:"1"},null,512),[[Ce,n.maskDilateSize,void 0,{number:!0}]]),r[22]||(r[22]=e("div",{class:"input-hint"},"æ©è†œè†¨èƒ€åƒç´ æ•°",-1))]),e("div",qr,[r[23]||(r[23]=e("label",{for:"settingsMaskBoxExpandRatio"},"æ ‡æ³¨æ¡†æ‰©å¤§æ¯”ä¾‹ (%):",-1)),ae(e("input",{type:"number",id:"settingsMaskBoxExpandRatio","onUpdate:modelValue":r[8]||(r[8]=x=>n.maskBoxExpandRatio=x),min:"0",max:"100",step:"1"},null,512),[[Ce,n.maskBoxExpandRatio,void 0,{number:!0}]]),r[24]||(r[24]=e("div",{class:"input-hint"},"æ ‡æ³¨æ¡†åŒºåŸŸæ‰©å¤§ç™¾åˆ†æ¯”",-1))])],512),[[Ue,n.usePreciseMask]])],512),[[Ue,l.value]]),e("div",Hr,[r[28]||(r[28]=e("div",{class:"settings-group-title"},"è°ƒè¯•é€‰é¡¹",-1)),e("div",Jr,[e("label",jr,[ae(e("input",{type:"checkbox","onUpdate:modelValue":r[9]||(r[9]=x=>n.showDetectionDebug=x)},null,512),[[Qe,n.showDetectionDebug]]),r[26]||(r[26]=Se(" æ˜¾ç¤ºæ£€æµ‹æ¡†è°ƒè¯•ä¿¡æ¯ ",-1))]),r[27]||(r[27]=e("div",{class:"input-hint"},"åœ¨ç¿»è¯‘ç»“æœä¸­æ˜¾ç¤ºæ°”æ³¡æ£€æµ‹æ¡†ï¼Œç”¨äºè°ƒè¯•",-1))])])]))}}),Gr=qe(Yr,[["__scopeId","data-v-c12c43ee"]]),Xr={class:"hq-translation-settings"},Zr={class:"settings-group"},Qr={class:"settings-row"},eu={class:"settings-item"},tu={class:"settings-item"},ou={class:"password-input-wrapper"},nu=["type"],su={key:0,class:"eye-icon"},au={key:1,class:"eye-off-icon"},lu={class:"settings-item"},iu={class:"settings-item"},ru={class:"model-input-with-fetch"},uu=["disabled"],cu={class:"fetch-text"},du={key:0,class:"model-select-container"},gu={class:"model-count"},pu={class:"settings-item"},vu=["disabled"],mu={class:"settings-group"},bu={class:"settings-row"},fu={class:"settings-item"},hu={class:"settings-item"},yu={class:"settings-row"},xu={class:"settings-item"},ku={class:"settings-item"},_u={class:"settings-group"},Su={class:"settings-row"},Cu={class:"settings-item"},wu={class:"checkbox-label"},$u={class:"settings-item"},Iu={class:"settings-row"},Tu={class:"settings-item"},Du={class:"checkbox-label"},Ru={class:"settings-item"},Mu={class:"checkbox-label"},Bu={class:"settings-group"},Pu={class:"settings-item"},Eu=He({__name:"HqTranslationSettings",setup(o){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],d=[{label:"Geminié£æ ¼ (reasoning_effort=low)",value:"gemini"},{label:"ç«å±±å¼•æ“é£æ ¼ (thinking=null)",value:"volcano"}],n=Je(),l=rt(),a=ee(()=>n.settings.hqTranslation),s=S({apiKey:n.settings.hqTranslation.apiKey,modelName:n.settings.hqTranslation.modelName,customBaseUrl:n.settings.hqTranslation.customBaseUrl,batchSize:n.settings.hqTranslation.batchSize,sessionReset:n.settings.hqTranslation.sessionReset,rpmLimit:n.settings.hqTranslation.rpmLimit,maxRetries:n.settings.hqTranslation.maxRetries,lowReasoning:n.settings.hqTranslation.lowReasoning,noThinkingMethod:n.settings.hqTranslation.noThinkingMethod,forceJsonOutput:n.settings.hqTranslation.forceJsonOutput,useStream:n.settings.hqTranslation.useStream,prompt:n.settings.hqTranslation.prompt});he(()=>s.value.apiKey,c=>{n.updateHqTranslation({apiKey:c})}),he(()=>s.value.modelName,c=>{n.updateHqTranslation({modelName:c})}),he(()=>s.value.customBaseUrl,c=>{n.updateHqTranslation({customBaseUrl:c})}),he(()=>s.value.batchSize,c=>{n.updateHqTranslation({batchSize:c})}),he(()=>s.value.sessionReset,c=>{n.updateHqTranslation({sessionReset:c})}),he(()=>s.value.rpmLimit,c=>{n.updateHqTranslation({rpmLimit:c})}),he(()=>s.value.maxRetries,c=>{n.updateHqTranslation({maxRetries:c})}),he(()=>s.value.lowReasoning,c=>{n.updateHqTranslation({lowReasoning:c})}),he(()=>s.value.noThinkingMethod,c=>{n.updateHqTranslation({noThinkingMethod:c})}),he(()=>s.value.forceJsonOutput,c=>{n.updateHqTranslation({forceJsonOutput:c})}),he(()=>s.value.useStream,c=>{n.updateHqTranslation({useStream:c})}),he(()=>s.value.prompt,c=>{n.updateHqTranslation({prompt:c})});const r=S(!1),x=S(!1),A=S([]),w=S(!1),W=ee(()=>{const c=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return A.value.forEach(u=>c.push({label:u,value:u})),c});function G(c){n.setHqProvider(c),A.value=[],j()}function j(){const c=n.settings.hqTranslation;s.value.apiKey=c.apiKey,s.value.modelName=c.modelName,s.value.customBaseUrl=c.customBaseUrl,s.value.batchSize=c.batchSize,s.value.sessionReset=c.sessionReset,s.value.rpmLimit=c.rpmLimit,s.value.maxRetries=c.maxRetries,s.value.lowReasoning=c.lowReasoning,s.value.noThinkingMethod=c.noThinkingMethod,s.value.forceJsonOutput=c.forceJsonOutput,s.value.useStream=c.useStream,s.value.prompt=c.prompt}function P(c){return{siliconflow:"SiliconFlow",deepseek:"DeepSeek",volcano:"ç«å±±å¼•æ“",gemini:"Google Gemini",custom_openai:"è‡ªå®šä¹‰OpenAI"}[c]||c}async function h(){const c=a.value.provider,u=s.value.apiKey?.trim(),y=s.value.customBaseUrl?.trim();if(!u){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(c)){l.warning(`${P(c)} ä¸æ”¯æŒè‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨`);return}if(c==="custom_openai"&&!y){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL");return}x.value=!0;try{const R=await Ne.fetchModels(c,u,y);R.success&&R.models&&R.models.length>0?(A.value=R.models.map(M=>M.id),l.success(`è·å–åˆ° ${R.models.length} ä¸ªæ¨¡å‹`)):l.warning(R.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(R){const M=R instanceof Error?R.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";l.error(M)}finally{x.value=!1}}async function I(){const c=a.value.provider,u=s.value.apiKey?.trim(),y=s.value.modelName?.trim(),b=s.value.customBaseUrl?.trim();if(!u){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!y){l.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}if(c==="custom_openai"&&!b){l.warning("è‡ªå®šä¹‰æœåŠ¡éœ€è¦å¡«å†™ Base URL");return}w.value=!0,l.info("æ­£åœ¨æµ‹è¯•è¿æ¥...");try{const R=await Ne.testAiTranslateConnection({provider:c,apiKey:u,modelName:y,baseUrl:b});R.success?l.success(R.message||`${P(c)} è¿æ¥æˆåŠŸ!`):l.error(R.message||R.error||"è¿æ¥å¤±è´¥")}catch(R){const M=R instanceof Error?R.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(M)}finally{w.value=!1}}function D(){n.updateHqTranslation({prompt:Ao}),s.value.prompt=Ao,l.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}function E(c,u){n.updateHqTranslation({prompt:c}),s.value.prompt=c,l.success(`å·²åº”ç”¨æç¤ºè¯: ${u}`)}return(c,u)=>(N(),q("div",Xr,[e("div",Zr,[u[20]||(u[20]=e("div",{class:"settings-group-title"},"é«˜è´¨é‡ç¿»è¯‘æœåŠ¡é…ç½®",-1)),e("div",Qr,[e("div",eu,[u[15]||(u[15]=e("label",{for:"settingsHqTranslateProvider"},"æœåŠ¡å•†:",-1)),be(ze,{"model-value":a.value.provider,options:t,onChange:u[0]||(u[0]=y=>G(y))},null,8,["model-value"])]),e("div",tu,[u[16]||(u[16]=e("label",{for:"settingsHqApiKey"},"API Key:",-1)),e("div",ou,[ae(e("input",{type:r.value?"text":"password",id:"settingsHqApiKey","onUpdate:modelValue":u[1]||(u[1]=y=>s.value.apiKey=y),class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,nu),[[kt,s.value.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:u[2]||(u[2]=y=>r.value=!r.value)},[r.value?(N(),q("span",au,"ğŸ‘â€ğŸ—¨")):(N(),q("span",su,"ğŸ‘"))])])])]),ae(e("div",lu,[u[17]||(u[17]=e("label",{for:"settingsHqCustomBaseUrl"},"Base URL:",-1)),ae(e("input",{type:"text",id:"settingsHqCustomBaseUrl","onUpdate:modelValue":u[3]||(u[3]=y=>s.value.customBaseUrl=y),placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,512),[[Ce,s.value.customBaseUrl]])],512),[[Ue,a.value.provider==="custom_openai"]]),e("div",iu,[u[19]||(u[19]=e("label",{for:"settingsHqModelName"},"æ¨¡å‹åç§°:",-1)),e("div",ru,[ae(e("input",{type:"text",id:"settingsHqModelName","onUpdate:modelValue":u[4]||(u[4]=y=>s.value.modelName=y),placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},null,512),[[Ce,s.value.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:h,disabled:x.value},[u[18]||(u[18]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",cu,le(x.value?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,uu)]),A.value.length>0?(N(),q("div",du,[be(ze,{modelValue:s.value.modelName,"onUpdate:modelValue":u[5]||(u[5]=y=>s.value.modelName=y),options:W.value},null,8,["modelValue","options"]),e("span",gu,"å…± "+le(A.value.length)+" ä¸ªæ¨¡å‹",1)])):de("",!0)]),e("div",pu,[e("button",{class:"settings-test-btn",onClick:I,disabled:w.value},le(w.value?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,vu)])]),e("div",mu,[u[28]||(u[28]=e("div",{class:"settings-group-title"},"æ‰¹å¤„ç†è®¾ç½®",-1)),e("div",bu,[e("div",fu,[u[21]||(u[21]=e("label",{for:"settingsHqBatchSize"},"æ‰¹æ¬¡å¤§å°:",-1)),ae(e("input",{type:"number",id:"settingsHqBatchSize","onUpdate:modelValue":u[6]||(u[6]=y=>s.value.batchSize=y),min:"1",max:"10",step:"1"},null,512),[[Ce,s.value.batchSize,void 0,{number:!0}]]),u[22]||(u[22]=e("div",{class:"input-hint"},"æ¯æ‰¹å¤„ç†çš„å›¾ç‰‡æ•°é‡ (æ¨è3-5å¼ )",-1))]),e("div",hu,[u[23]||(u[23]=e("label",{for:"settingsHqSessionReset"},"ä¼šè¯é‡ç½®é¢‘ç‡:",-1)),ae(e("input",{type:"number",id:"settingsHqSessionReset","onUpdate:modelValue":u[7]||(u[7]=y=>s.value.sessionReset=y),min:"1",step:"1"},null,512),[[Ce,s.value.sessionReset,void 0,{number:!0}]]),u[24]||(u[24]=e("div",{class:"input-hint"},"å¤šå°‘æ‰¹æ¬¡åé‡ç½®ä¸Šä¸‹æ–‡",-1))])]),e("div",yu,[e("div",xu,[u[25]||(u[25]=e("label",{for:"settingsHqRpmLimit"},"RPMé™åˆ¶:",-1)),ae(e("input",{type:"number",id:"settingsHqRpmLimit","onUpdate:modelValue":u[8]||(u[8]=y=>s.value.rpmLimit=y),min:"0",step:"1"},null,512),[[Ce,s.value.rpmLimit,void 0,{number:!0}]]),u[26]||(u[26]=e("div",{class:"input-hint"},"æ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶",-1))]),e("div",ku,[u[27]||(u[27]=e("label",{for:"settingsHqMaxRetries"},"é‡è¯•æ¬¡æ•°:",-1)),ae(e("input",{type:"number",id:"settingsHqMaxRetries","onUpdate:modelValue":u[9]||(u[9]=y=>s.value.maxRetries=y),min:"0",max:"10",step:"1"},null,512),[[Ce,s.value.maxRetries,void 0,{number:!0}]])])])]),e("div",_u,[u[36]||(u[36]=e("div",{class:"settings-group-title"},"é«˜çº§é€‰é¡¹",-1)),e("div",Su,[e("div",Cu,[e("label",wu,[ae(e("input",{type:"checkbox","onUpdate:modelValue":u[10]||(u[10]=y=>s.value.lowReasoning=y)},null,512),[[Qe,s.value.lowReasoning]]),u[29]||(u[29]=Se(" ä½æ¨ç†æ¨¡å¼ ",-1))]),u[30]||(u[30]=e("div",{class:"input-hint"},"å‡å°‘æ¨¡å‹æ¨ç†æ·±åº¦ï¼Œæé«˜é€Ÿåº¦",-1))]),e("div",$u,[u[31]||(u[31]=e("label",{for:"settingsHqNoThinkingMethod"},"å–æ¶ˆæ€è€ƒæ–¹æ³•:",-1)),be(ze,{modelValue:s.value.noThinkingMethod,"onUpdate:modelValue":u[11]||(u[11]=y=>s.value.noThinkingMethod=y),options:d},null,8,["modelValue"])])]),e("div",Iu,[e("div",Tu,[e("label",Du,[ae(e("input",{type:"checkbox","onUpdate:modelValue":u[12]||(u[12]=y=>s.value.forceJsonOutput=y)},null,512),[[Qe,s.value.forceJsonOutput]]),u[32]||(u[32]=Se(" å¼ºåˆ¶JSONè¾“å‡º ",-1))]),u[33]||(u[33]=e("div",{class:"input-hint"},"ä½¿ç”¨ response_format: json_object",-1))]),e("div",Ru,[e("label",Mu,[ae(e("input",{type:"checkbox","onUpdate:modelValue":u[13]||(u[13]=y=>s.value.useStream=y)},null,512),[[Qe,s.value.useStream]]),u[34]||(u[34]=Se(" æµå¼è°ƒç”¨ ",-1))]),u[35]||(u[35]=e("div",{class:"input-hint"},"ä½¿ç”¨æµå¼APIè°ƒç”¨",-1))])])]),e("div",Bu,[u[37]||(u[37]=e("div",{class:"settings-group-title"},"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯",-1)),e("div",Pu,[ae(e("textarea",{id:"settingsHqPrompt","onUpdate:modelValue":u[14]||(u[14]=y=>s.value.prompt=y),rows:"6",placeholder:"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯"},null,512),[[Ce,s.value.prompt]]),be(It,{"prompt-type":"hq_translate",onSelect:E}),e("button",{class:"btn btn-secondary btn-sm",onClick:D},"é‡ç½®ä¸ºé»˜è®¤")])])]))}}),Au=qe(Eu,[["__scopeId","data-v-23f4a3f7"]]),Fu={class:"proofreading-settings"},Lu={class:"settings-group"},Uu={class:"settings-item"},Ou={class:"checkbox-label"},zu={class:"settings-item"},Nu={class:"settings-group"},Vu={class:"round-header"},Wu={class:"round-title"},Ku=["onClick","disabled"],qu={class:"round-content"},Hu={class:"settings-item"},Ju=["onUpdate:modelValue"],ju={class:"settings-row"},Yu={class:"settings-item"},Gu={class:"settings-item"},Xu={class:"password-input-wrapper"},Zu=["type","onUpdate:modelValue"],Qu=["onClick"],ec={key:0,class:"eye-icon"},tc={key:1,class:"eye-off-icon"},oc={class:"settings-item"},nc=["onUpdate:modelValue"],sc={class:"settings-item"},ac={class:"model-input-with-fetch"},lc=["onUpdate:modelValue"],ic=["onClick","disabled"],rc={class:"fetch-text"},uc={key:0,class:"model-select-container"},cc={class:"model-count"},dc={class:"settings-item"},gc=["onClick","disabled"],pc={class:"settings-row"},vc={class:"settings-item"},mc=["onUpdate:modelValue"],bc={class:"settings-item"},fc=["onUpdate:modelValue"],hc={class:"settings-item"},yc=["onUpdate:modelValue"],xc={class:"settings-row"},kc={class:"settings-item"},_c={class:"checkbox-label"},Sc=["onUpdate:modelValue"],Cc={class:"settings-item"},wc={class:"settings-item"},$c={class:"checkbox-label"},Ic=["onUpdate:modelValue"],Tc={class:"settings-item"},Dc=["onUpdate:modelValue"],Rc=["onClick"],Mc=He({__name:"ProofreadingSettings",setup(o){const t=[{label:"SiliconFlow",value:"siliconflow"},{label:"DeepSeek",value:"deepseek"},{label:"ç«å±±å¼•æ“",value:"volcano"},{label:"Google Gemini",value:"gemini"},{label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡",value:"custom_openai"}],d=[{label:"Geminié£æ ¼",value:"gemini"},{label:"ç«å±±å¼•æ“é£æ ¼",value:"volcano"}],n=Je(),l=rt(),a=S({}),s=S({}),r=S({}),x=ee(()=>n.settings.proofreading.rounds),A=ee({get:()=>n.settings.proofreading.maxRetries,set:E=>n.setProofreadingMaxRetries(E)}),w=ee({get:()=>n.settings.proofreading.enabled,set:E=>n.setProofreadingEnabled(E)});he(()=>n.settings.proofreading.rounds,()=>{n.saveToStorage()},{deep:!0});function W(E){const c=r.value[E]||[],u=[{label:"-- é€‰æ‹©æ¨¡å‹ --",value:""}];return c.forEach(y=>u.push({label:y,value:y})),u}async function G(E){const c=x.value[E];if(!c)return;const u=c.provider,y=c.apiKey?.trim(),b=c.customBaseUrl?.trim();if(!y){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!["siliconflow","deepseek","volcano","gemini","custom_openai"].includes(u)){l.warning("å½“å‰æœåŠ¡å•†ä¸æ”¯æŒè·å–æ¨¡å‹åˆ—è¡¨");return}a.value[E]=!0;try{const M=await Ne.fetchModels(u,y,b);M.success&&M.models&&M.models.length>0?(r.value[E]=M.models.map(J=>J.id),l.success(`è½®æ¬¡ ${E+1}: è·å–åˆ° ${M.models.length} ä¸ªæ¨¡å‹`)):l.warning(M.message||"æœªè·å–åˆ°å¯ç”¨æ¨¡å‹")}catch(M){const J=M instanceof Error?M.message:"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥";l.error(J)}finally{a.value[E]=!1}}async function j(E){const c=x.value[E];if(!c)return;const u=c.provider,y=c.apiKey?.trim(),b=c.modelName?.trim(),R=c.customBaseUrl?.trim();if(!y){l.warning("è¯·å…ˆå¡«å†™ API Key");return}if(!b){l.warning("è¯·å¡«å†™æ¨¡å‹åç§°");return}s.value[E]=!0,l.info(`æ­£åœ¨æµ‹è¯•è½®æ¬¡ ${E+1} çš„è¿æ¥...`);try{const M=await Ne.testAiTranslateConnection({provider:u,apiKey:y,modelName:b,baseUrl:R});M.success?l.success(M.message||"è¿æ¥æˆåŠŸ!"):l.error(M.message||M.error||"è¿æ¥å¤±è´¥")}catch(M){const J=M instanceof Error?M.message:"è¿æ¥æµ‹è¯•å¤±è´¥";l.error(J)}finally{s.value[E]=!1}}function P(){const E={name:`ç¬¬${x.value.length+1}è½®æ ¡å¯¹`,provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",batchSize:3,sessionReset:20,rpmLimit:7,lowReasoning:!1,noThinkingMethod:"gemini",forceJsonOutput:!0,prompt:Fo,showApiKey:!1};n.addProofreadingRound(E),l.success("å·²æ·»åŠ æ–°çš„æ ¡å¯¹è½®æ¬¡")}function h(E){if(x.value.length<=1){l.warning("è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªæ ¡å¯¹è½®æ¬¡");return}n.removeProofreadingRound(E),l.success("å·²åˆ é™¤æ ¡å¯¹è½®æ¬¡")}function I(E){n.updateProofreadingRound(E,{prompt:Fo}),l.success("å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯")}function D(E,c,u){n.updateProofreadingRound(E,{prompt:c}),l.success(`å·²åº”ç”¨æç¤ºè¯: ${u}`)}return(E,c)=>(N(),q("div",Fu,[e("div",Lu,[c[5]||(c[5]=e("div",{class:"settings-group-title"},"AIæ ¡å¯¹è®¾ç½®",-1)),e("div",Uu,[e("label",Ou,[ae(e("input",{type:"checkbox","onUpdate:modelValue":c[0]||(c[0]=u=>w.value=u)},null,512),[[Qe,w.value]]),c[2]||(c[2]=Se(" å¯ç”¨AIæ ¡å¯¹ ",-1))]),c[3]||(c[3]=e("div",{class:"input-hint"},"ç¿»è¯‘å®Œæˆåè‡ªåŠ¨è¿›è¡ŒAIæ ¡å¯¹",-1))]),e("div",zu,[c[4]||(c[4]=e("label",{for:"settingsProofreadingMaxRetries"},"å…¨å±€é‡è¯•æ¬¡æ•°:",-1)),ae(e("input",{type:"number",id:"settingsProofreadingMaxRetries","onUpdate:modelValue":c[1]||(c[1]=u=>A.value=u),min:"0",max:"10",step:"1"},null,512),[[Ce,A.value,void 0,{number:!0}]])])]),ae(e("div",Nu,[e("div",{class:"settings-group-title"},[c[6]||(c[6]=Se(" æ ¡å¯¹è½®æ¬¡é…ç½® ",-1)),e("button",{class:"btn btn-secondary btn-sm",onClick:P},"+ æ·»åŠ è½®æ¬¡")]),(N(!0),q(Ke,null,je(x.value,(u,y)=>(N(),q("div",{key:y,class:"proofreading-round"},[e("div",Vu,[e("span",Wu,"è½®æ¬¡ "+le(y+1)+": "+le(u.name||"æœªå‘½å"),1),e("button",{class:"btn btn-danger btn-sm",onClick:b=>h(y),disabled:x.value.length<=1}," åˆ é™¤ ",8,Ku)]),e("div",qu,[e("div",Hu,[c[7]||(c[7]=e("label",null,"è½®æ¬¡åç§°:",-1)),ae(e("input",{type:"text","onUpdate:modelValue":b=>u.name=b,placeholder:"å¦‚: ç¬¬ä¸€è½®æ ¡å¯¹"},null,8,Ju),[[Ce,u.name]])]),e("div",ju,[e("div",Yu,[c[8]||(c[8]=e("label",null,"æœåŠ¡å•†:",-1)),be(ze,{modelValue:u.provider,"onUpdate:modelValue":b=>u.provider=b,options:t},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Gu,[c[9]||(c[9]=e("label",null,"API Key:",-1)),e("div",Xu,[ae(e("input",{type:u.showApiKey?"text":"password","onUpdate:modelValue":b=>u.apiKey=b,class:"secure-input",placeholder:"è¯·è¾“å…¥API Key",autocomplete:"off"},null,8,Zu),[[kt,u.apiKey]]),e("button",{type:"button",class:"password-toggle-btn",tabindex:"-1",onClick:b=>u.showApiKey=!u.showApiKey},[u.showApiKey?(N(),q("span",tc,"ğŸ‘â€ğŸ—¨")):(N(),q("span",ec,"ğŸ‘"))],8,Qu)])])]),ae(e("div",oc,[c[10]||(c[10]=e("label",null,"Base URL:",-1)),ae(e("input",{type:"text","onUpdate:modelValue":b=>u.customBaseUrl=b,placeholder:"ä¾‹å¦‚: https://api.example.com/v1"},null,8,nc),[[Ce,u.customBaseUrl]])],512),[[Ue,u.provider==="custom_openai"]]),e("div",sc,[c[12]||(c[12]=e("label",null,"æ¨¡å‹åç§°:",-1)),e("div",ac,[ae(e("input",{type:"text","onUpdate:modelValue":b=>u.modelName=b,placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},null,8,lc),[[Ce,u.modelName]]),e("button",{type:"button",class:"fetch-models-btn",title:"è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨",onClick:b=>G(y),disabled:a.value[y]},[c[11]||(c[11]=e("span",{class:"fetch-icon"},"ğŸ”",-1)),e("span",rc,le(a.value[y]?"è·å–ä¸­...":"è·å–æ¨¡å‹"),1)],8,ic)]),r.value[y]&&r.value[y].length>0?(N(),q("div",uc,[be(ze,{modelValue:u.modelName,"onUpdate:modelValue":b=>u.modelName=b,options:W(y)},null,8,["modelValue","onUpdate:modelValue","options"]),e("span",cc,"å…± "+le(r.value[y].length)+" ä¸ªæ¨¡å‹",1)])):de("",!0)]),e("div",dc,[e("button",{class:"settings-test-btn",onClick:b=>j(y),disabled:s.value[y]},le(s.value[y]?"æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),9,gc)]),e("div",pc,[e("div",vc,[c[13]||(c[13]=e("label",null,"æ‰¹æ¬¡å¤§å°:",-1)),ae(e("input",{type:"number","onUpdate:modelValue":b=>u.batchSize=b,min:"1",max:"10",step:"1"},null,8,mc),[[Ce,u.batchSize,void 0,{number:!0}]])]),e("div",bc,[c[14]||(c[14]=e("label",null,"ä¼šè¯é‡ç½®é¢‘ç‡:",-1)),ae(e("input",{type:"number","onUpdate:modelValue":b=>u.sessionReset=b,min:"1",step:"1"},null,8,fc),[[Ce,u.sessionReset,void 0,{number:!0}]])]),e("div",hc,[c[15]||(c[15]=e("label",null,"RPMé™åˆ¶:",-1)),ae(e("input",{type:"number","onUpdate:modelValue":b=>u.rpmLimit=b,min:"0",step:"1"},null,8,yc),[[Ce,u.rpmLimit,void 0,{number:!0}]])])]),e("div",xc,[e("div",kc,[e("label",_c,[ae(e("input",{type:"checkbox","onUpdate:modelValue":b=>u.lowReasoning=b},null,8,Sc),[[Qe,u.lowReasoning]]),c[16]||(c[16]=Se(" ä½æ¨ç†æ¨¡å¼ ",-1))])]),e("div",Cc,[c[17]||(c[17]=e("label",null,"å–æ¶ˆæ€è€ƒæ–¹æ³•:",-1)),be(ze,{modelValue:u.noThinkingMethod,"onUpdate:modelValue":b=>u.noThinkingMethod=b,options:d},null,8,["modelValue","onUpdate:modelValue"])]),e("div",wc,[e("label",$c,[ae(e("input",{type:"checkbox","onUpdate:modelValue":b=>u.forceJsonOutput=b},null,8,Ic),[[Qe,u.forceJsonOutput]]),c[18]||(c[18]=Se(" å¼ºåˆ¶JSONè¾“å‡º ",-1))])])]),e("div",Tc,[c[19]||(c[19]=e("label",null,"æ ¡å¯¹æç¤ºè¯:",-1)),ae(e("textarea",{"onUpdate:modelValue":b=>u.prompt=b,rows:"4",placeholder:"æ ¡å¯¹æç¤ºè¯"},null,8,Dc),[[Ce,u.prompt]]),be(It,{"prompt-type":"proofreading",onSelect:(b,R)=>D(y,b,R)},null,8,["onSelect"]),e("button",{class:"btn btn-secondary btn-sm",onClick:b=>I(y)},"é‡ç½®ä¸ºé»˜è®¤",8,Rc)])])]))),128))],512),[[Ue,w.value]])]))}}),Bc=qe(Mc,[["__scopeId","data-v-663a7972"]]),Pc={class:"prompt-library"},Ec={class:"settings-group"},Ac={class:"settings-item"},Fc={key:0,class:"settings-item"},Lc={class:"mode-hint"},Uc={class:"settings-group"},Oc={key:0,class:"loading-hint"},zc={key:1,class:"empty-hint"},Nc={key:2,class:"prompt-list"},Vc=["onClick"],Wc={class:"prompt-name"},Kc={class:"prompt-actions"},qc=["onClick"],Hc=["onClick","disabled"],Jc={class:"settings-group"},jc={class:"settings-item"},Yc={class:"settings-item"},Gc={class:"prompt-editor-actions"},Xc=["disabled"],Zc=He({__name:"PromptLibrary",setup(o){const t=[{label:"ç¿»è¯‘æç¤ºè¯",value:"translate"},{label:"æ–‡æœ¬æ¡†æç¤ºè¯",value:"textbox"},{label:"AIè§†è§‰OCRæç¤ºè¯",value:"ai_vision_ocr"},{label:"é«˜è´¨é‡ç¿»è¯‘æç¤ºè¯",value:"hq_translate"},{label:"æ ¡å¯¹æç¤ºè¯",value:"proofreading"}],d=[{label:"æ™®é€šæ¨¡å¼",value:"false"},{label:"JSONæ ¼å¼æ¨¡å¼",value:"true"}],n=rt(),l=Je(),a=S("translate"),s=S([]),r=S(""),x=S(""),A=S(""),w=S(!1),W=S(!1),G=ee(()=>a.value==="translate"||a.value==="ai_vision_ocr"),j=ee(()=>W.value?"é€‚ç”¨äºéœ€è¦ç»“æ„åŒ–è¾“å‡ºçš„åœºæ™¯":"é€‚ç”¨äºæ™®é€šç¿»è¯‘åœºæ™¯");async function P(){w.value=!0;try{let y;a.value==="textbox"?y=await Ne.getTextboxPrompts():y=await Ne.getPrompts(a.value);const b=y.prompt_names||[];s.value=b.map(R=>({name:R}))}catch(y){const b=y instanceof Error?y.message:"åŠ è½½æç¤ºè¯åˆ—è¡¨å¤±è´¥";n.error(b)}finally{w.value=!1}}async function h(y){r.value=y,x.value=y,await I(y)}async function I(y){try{let b;a.value==="textbox"?b=await Ne.getTextboxPromptContent(y):b=await Ne.getPromptContent(a.value,y),x.value=y,A.value=b.prompt_content||"",r.value=y,n.success("å·²åŠ è½½æç¤ºè¯")}catch(b){const R=b instanceof Error?b.message:"åŠ è½½æç¤ºè¯å†…å®¹å¤±è´¥";n.error(R)}}async function D(){if(!x.value||!A.value){n.warning("è¯·è¾“å…¥æç¤ºè¯åç§°å’Œå†…å®¹");return}try{a.value==="textbox"?await Ne.saveTextboxPrompt(x.value,A.value):await Ne.savePrompt(a.value,x.value,A.value),n.success("æç¤ºè¯ä¿å­˜æˆåŠŸ"),x.value="",A.value="",await P()}catch(y){const b=y instanceof Error?y.message:"ä¿å­˜æç¤ºè¯å¤±è´¥";n.error(b)}}async function E(y){if(y==="default"){n.warning("é»˜è®¤æç¤ºè¯ä¸èƒ½åˆ é™¤");return}try{a.value==="textbox"?await Ne.deleteTextboxPrompt(y):await Ne.deletePrompt(a.value,y),n.success("æç¤ºè¯åˆ é™¤æˆåŠŸ"),r.value===y&&(r.value="",x.value="",A.value=""),await P()}catch(b){const R=b instanceof Error?b.message:"åˆ é™¤æç¤ºè¯å¤±è´¥";n.error(R)}}function c(){r.value="",x.value="",A.value="",a.value==="translate"?W.value=l.settings.translation.isJsonMode:a.value==="ai_vision_ocr"?W.value=l.settings.aiVisionOcr.isJsonMode:W.value=!1,P()}function u(){a.value==="translate"?l.updateTranslationService({isJsonMode:W.value}):a.value==="ai_vision_ocr"&&l.updateAiVisionOcr({isJsonMode:W.value}),n.info(`å·²åˆ‡æ¢åˆ°${W.value?"JSONæ ¼å¼":"æ™®é€š"}æ¨¡å¼`)}return ut(()=>{W.value=l.settings.translation.isJsonMode,P()}),(y,b)=>(N(),q("div",Pc,[e("div",Ec,[b[6]||(b[6]=e("div",{class:"settings-group-title"},"æç¤ºè¯ç®¡ç†",-1)),e("div",Ac,[b[4]||(b[4]=e("label",{for:"promptType"},"æç¤ºè¯ç±»å‹:",-1)),be(ze,{modelValue:a.value,"onUpdate:modelValue":b[0]||(b[0]=R=>a.value=R),options:t,onChange:c},null,8,["modelValue"])]),G.value?(N(),q("div",Fc,[b[5]||(b[5]=e("label",{for:"promptMode"},"æç¤ºè¯æ¨¡å¼:",-1)),be(ze,{"model-value":W.value?"true":"false",options:d,onChange:b[1]||(b[1]=R=>{W.value=R==="true",u()})},null,8,["model-value"]),e("span",Lc,le(j.value),1)])):de("",!0)]),e("div",Uc,[b[7]||(b[7]=e("div",{class:"settings-group-title"},"å·²ä¿å­˜çš„æç¤ºè¯",-1)),w.value?(N(),q("div",Oc,"åŠ è½½ä¸­...")):s.value.length===0?(N(),q("div",zc,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(N(),q("div",Nc,[(N(!0),q(Ke,null,je(s.value,R=>(N(),q("div",{key:R.name,class:Ie(["prompt-item",{active:r.value===R.name}]),onClick:M=>h(R.name)},[e("span",Wc,le(R.name),1),e("div",Kc,[e("button",{class:"btn btn-sm",onClick:Ze(M=>I(R.name),["stop"]),title:"åŠ è½½åˆ°ç¼–è¾‘å™¨"},"ğŸ“¥",8,qc),e("button",{class:"btn btn-sm btn-danger",onClick:Ze(M=>E(R.name),["stop"]),title:"åˆ é™¤",disabled:R.name==="default"}," ğŸ—‘ï¸ ",8,Hc)])],10,Vc))),128))]))]),e("div",Jc,[b[10]||(b[10]=e("div",{class:"settings-group-title"},"æç¤ºè¯ç¼–è¾‘",-1)),e("div",jc,[b[8]||(b[8]=e("label",{for:"promptName"},"æç¤ºè¯åç§°:",-1)),ae(e("input",{type:"text",id:"promptName","onUpdate:modelValue":b[2]||(b[2]=R=>x.value=R),placeholder:"è¯·è¾“å…¥æç¤ºè¯åç§°"},null,512),[[Ce,x.value]])]),e("div",Yc,[b[9]||(b[9]=e("label",{for:"promptContent"},"æç¤ºè¯å†…å®¹:",-1)),ae(e("textarea",{id:"promptContent","onUpdate:modelValue":b[3]||(b[3]=R=>A.value=R),rows:"8",placeholder:"è¯·è¾“å…¥æç¤ºè¯å†…å®¹"},null,512),[[Ce,A.value]])]),e("div",Gc,[e("button",{class:"btn btn-primary",onClick:D,disabled:!x.value||!A.value},"ä¿å­˜æç¤ºè¯",8,Xc)])])]))}}),Qc=qe(Zc,[["__scopeId","data-v-70f0ec19"]]),ed={class:"plugin-manager"},td={class:"settings-group"},od={key:0,class:"loading-hint"},nd={key:1,class:"empty-hint"},sd={key:2,class:"plugin-list"},ad={class:"plugin-info"},ld={class:"plugin-header"},id={class:"plugin-name"},rd={class:"plugin-version"},ud={class:"plugin-description"},cd={class:"plugin-controls"},dd={class:"switch"},gd=["checked","onChange"],pd=["onClick"],vd=["onClick"],md={class:"settings-group"},bd={class:"plugin-name"},fd={class:"switch"},hd=["checked","onChange"],yd={class:"plugin-config-content"},xd={class:"plugin-config-header"},kd={class:"plugin-config-body"},_d=["for"],Sd=["id","onUpdate:modelValue"],Cd=["id","onUpdate:modelValue","min","max"],wd=["id","onUpdate:modelValue","placeholder"],$d={key:4,class:"field-description"},Id=He({__name:"PluginManager",setup(o){const t=rt(),d=S([]),n=S({}),l=S(!1),a=S(!1),s=S(null),r=S({}),x=S({});async function A(){l.value=!0;try{const D=await ps();d.value=D.plugins||[]}catch(D){const E=D instanceof Error?D.message:"åŠ è½½æ’ä»¶åˆ—è¡¨å¤±è´¥";t.error(E)}finally{l.value=!1}}async function w(){try{const D=await _s();n.value=D.states||{}}catch(D){console.error("åŠ è½½é»˜è®¤çŠ¶æ€å¤±è´¥:",D)}}async function W(D){try{D.enabled?(await ms(D.name),D.enabled=!1,t.success(`å·²ç¦ç”¨ ${D.display_name||D.name}`)):(await vs(D.name),D.enabled=!0,t.success(`å·²å¯ç”¨ ${D.display_name||D.name}`))}catch(E){const c=E instanceof Error?E.message:"æ“ä½œå¤±è´¥";t.error(c)}}async function G(D,E){const c=E.target,u=c.checked;try{await Ss(D,u),n.value[D]=u,t.success("é»˜è®¤çŠ¶æ€å·²æ›´æ–°")}catch(y){const b=y instanceof Error?y.message:"è®¾ç½®å¤±è´¥";t.error(b),c.checked=!u}}async function j(D){s.value=D;try{const E=await Cs(D.name);r.value=E.schema||{};const c=await ws(D.name);x.value=c.config||{},a.value=!0}catch(E){const c=E instanceof Error?E.message:"åŠ è½½é…ç½®å¤±è´¥";t.error(c)}}function P(){a.value=!1,s.value=null,r.value={},x.value={}}async function h(){if(s.value)try{await $s(s.value.name,x.value),t.success("é…ç½®ä¿å­˜æˆåŠŸ"),P()}catch(D){const E=D instanceof Error?D.message:"ä¿å­˜é…ç½®å¤±è´¥";t.error(E)}}async function I(D){if(confirm(`ç¡®å®šè¦åˆ é™¤æ’ä»¶ "${D.display_name||D.name}" å—ï¼Ÿ`))try{await bs(D.name),t.success("æ’ä»¶åˆ é™¤æˆåŠŸ"),await A()}catch(E){const c=E instanceof Error?E.message:"åˆ é™¤æ’ä»¶å¤±è´¥";t.error(c)}}return ut(()=>{A(),w()}),(D,E)=>(N(),q("div",ed,[e("div",td,[E[1]||(E[1]=e("div",{class:"settings-group-title"},"å·²å®‰è£…æ’ä»¶",-1)),l.value?(N(),q("div",od,"åŠ è½½ä¸­...")):d.value.length===0?(N(),q("div",nd,"æš‚æ— å·²å®‰è£…çš„æ’ä»¶")):(N(),q("div",sd,[(N(!0),q(Ke,null,je(d.value,c=>(N(),q("div",{key:c.name,class:"plugin-item"},[e("div",ad,[e("div",ld,[e("span",id,le(c.display_name||c.name),1),e("span",rd,"v"+le(c.version||"1.0.0"),1)]),e("p",ud,le(c.description||"æš‚æ— æè¿°"),1)]),e("div",cd,[e("label",dd,[e("input",{type:"checkbox",checked:c.enabled,onChange:u=>W(c)},null,40,gd),E[0]||(E[0]=e("span",{class:"slider"},null,-1))]),c.has_config?(N(),q("button",{key:0,class:"btn btn-sm",onClick:u=>j(c),title:"é…ç½®"},"âš™ï¸",8,pd)):de("",!0),e("button",{class:"btn btn-sm btn-danger",onClick:u=>I(c),title:"åˆ é™¤"},"ğŸ—‘ï¸",8,vd)])]))),128))]))]),e("div",md,[E[3]||(E[3]=e("div",{class:"settings-group-title"},"é»˜è®¤å¯ç”¨çŠ¶æ€",-1)),E[4]||(E[4]=e("p",{class:"settings-hint"},"è®¾ç½®æ’ä»¶åœ¨æ–°ä¼šè¯ä¸­çš„é»˜è®¤å¯ç”¨çŠ¶æ€",-1)),(N(!0),q(Ke,null,je(d.value,c=>(N(),q("div",{key:"default-"+c.name,class:"default-state-item"},[e("span",bd,le(c.display_name||c.name),1),e("label",fd,[e("input",{type:"checkbox",checked:n.value[c.name],onChange:u=>G(c.name,u)},null,40,hd),E[2]||(E[2]=e("span",{class:"slider"},null,-1))])]))),128))]),a.value?(N(),q("div",{key:0,class:"plugin-config-modal",onClick:Ze(P,["self"])},[e("div",yd,[e("div",xd,[e("h4",null,le(s.value?.display_name||s.value?.name)+" é…ç½®",1),e("span",{class:"close-btn",onClick:P},"Ã—")]),e("div",kd,[(N(!0),q(Ke,null,je(r.value,(c,u)=>(N(),q("div",{key:u,class:"config-field"},[e("label",{for:"config-"+u},le(c.label||u)+":",9,_d),c.type==="boolean"?ae((N(),q("input",{key:0,type:"checkbox",id:"config-"+u,"onUpdate:modelValue":y=>x.value[u]=y},null,8,Sd)),[[Qe,x.value[u]]]):c.type==="select"?(N(),lt(ze,{key:1,"model-value":String(x.value[u]??""),options:c.options||[],onChange:y=>{x.value[u]=y}},null,8,["model-value","options","onChange"])):c.type==="number"?ae((N(),q("input",{key:2,type:"number",id:"config-"+u,"onUpdate:modelValue":y=>x.value[u]=y,min:c.min,max:c.max},null,8,Cd)),[[Ce,x.value[u],void 0,{number:!0}]]):ae((N(),q("input",{key:3,type:"text",id:"config-"+u,"onUpdate:modelValue":y=>x.value[u]=y,placeholder:c.placeholder},null,8,wd)),[[Ce,x.value[u]]]),c.description?(N(),q("p",$d,le(c.description),1)):de("",!0)]))),128))]),e("div",{class:"plugin-config-footer"},[e("button",{class:"btn btn-secondary",onClick:P},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:h},"ä¿å­˜")])])])):de("",!0)]))}}),Td=qe(Id,[["__scopeId","data-v-a62393a7"]]),Dd={class:"more-settings"},Rd={class:"settings-group"},Md={class:"settings-item"},Bd={class:"settings-group"},Pd={class:"settings-item"},Ed=["disabled"],Ad={key:0,class:"font-count"},Fd={class:"settings-item"},Ld={class:"settings-group"},Ud={class:"settings-row"},Od={class:"settings-item"},zd=["disabled"],Nd={class:"settings-item"},Vd=["disabled"],Wd=He({__name:"MoreSettings",setup(o){const t=[{label:"å‰ç«¯ pdf.js (æ¨è)",value:"frontend"},{label:"åç«¯ PyMuPDF",value:"backend"}],d=Je(),n=rt(),l=S(!1),a=S([]),s=S(!1),r=S(null),x=S({pdfProcessingMethod:d.settings.pdfProcessingMethod||"frontend"});he(()=>x.value.pdfProcessingMethod,j=>{d.setPdfProcessingMethod(j)});async function A(){l.value=!0;try{const j=await Ne.getFontList();a.value=j.fonts||[],n.success(`è·å–åˆ° ${a.value.length} ä¸ªå­—ä½“`)}catch(j){const P=j instanceof Error?j.message:"è·å–å­—ä½“åˆ—è¡¨å¤±è´¥";n.error(P)}finally{l.value=!1}}async function w(j){const h=j.target.files?.[0];if(!h)return;const I=[".ttf",".ttc",".otf"],D=h.name.toLowerCase().slice(h.name.lastIndexOf("."));if(!I.includes(D)){n.error("ä¸æ”¯æŒçš„å­—ä½“æ ¼å¼ï¼Œè¯·ä¸Šä¼  .ttf, .ttc æˆ– .otf æ–‡ä»¶");return}try{const E=await Ne.uploadFont(h);E.success?(n.success(`å­—ä½“ "${E.fontPath||h.name}" ä¸Šä¼ æˆåŠŸ`),await A()):n.error(E.error||"å­—ä½“ä¸Šä¼ å¤±è´¥")}catch(E){const c=E instanceof Error?E.message:"å­—ä½“ä¸Šä¼ å¤±è´¥";n.error(c)}finally{r.value&&(r.value.value="")}}async function W(){s.value=!0;try{const j=await Qo();j.success?n.success(`å·²æ¸…ç† ${j.deleted_count||0} ä¸ªè°ƒè¯•æ–‡ä»¶`):n.error(j.error||"æ¸…ç†å¤±è´¥")}catch(j){const P=j instanceof Error?j.message:"æ¸…ç†å¤±è´¥";n.error(P)}finally{s.value=!1}}async function G(){s.value=!0;try{const j=await ro();j.success?n.success(`å·²æ¸…ç† ${j.deleted_count||0} ä¸ªä¸´æ—¶æ–‡ä»¶`):n.error(j.error||"æ¸…ç†å¤±è´¥")}catch(j){const P=j instanceof Error?j.message:"æ¸…ç†å¤±è´¥";n.error(P)}finally{s.value=!1}}return(j,P)=>(N(),q("div",Dd,[e("div",Rd,[P[3]||(P[3]=e("div",{class:"settings-group-title"},"PDFå¤„ç†è®¾ç½®",-1)),e("div",Md,[P[1]||(P[1]=e("label",{for:"settingsPdfProcessingMethod"},"PDFå¤„ç†æ–¹å¼:",-1)),be(ze,{modelValue:x.value.pdfProcessingMethod,"onUpdate:modelValue":P[0]||(P[0]=h=>x.value.pdfProcessingMethod=h),options:t},null,8,["modelValue"]),P[2]||(P[2]=e("div",{class:"input-hint"},"å‰ç«¯å¤„ç†é€Ÿåº¦æ›´å¿«ï¼Œåç«¯å¤„ç†å…¼å®¹æ€§æ›´å¥½",-1))])]),e("div",Bd,[P[7]||(P[7]=e("div",{class:"settings-group-title"},"å­—ä½“è®¾ç½®",-1)),e("div",Pd,[P[4]||(P[4]=e("label",null,"ç³»ç»Ÿå­—ä½“åˆ—è¡¨:",-1)),e("button",{class:"btn btn-secondary",onClick:A,disabled:l.value},le(l.value?"åŠ è½½ä¸­...":"ğŸ”„ åˆ·æ–°å­—ä½“åˆ—è¡¨"),9,Ed),a.value.length>0?(N(),q("div",Ad,"å…± "+le(a.value.length)+" ä¸ªå­—ä½“",1)):de("",!0)]),e("div",Fd,[P[5]||(P[5]=e("label",null,"ä¸Šä¼ è‡ªå®šä¹‰å­—ä½“:",-1)),e("input",{type:"file",accept:".ttf,.ttc,.otf",onChange:w,ref_key:"fontInput",ref:r},null,544),P[6]||(P[6]=e("div",{class:"input-hint"},"æ”¯æŒ .ttf, .ttc, .otf æ ¼å¼",-1))])]),e("div",Ld,[P[10]||(P[10]=e("div",{class:"settings-group-title"},"ç¼“å­˜æ¸…ç†",-1)),e("div",Ud,[e("div",Od,[e("button",{class:"btn btn-secondary",onClick:W,disabled:s.value},le(s.value?"æ¸…ç†ä¸­...":"ğŸ—‘ï¸ æ¸…ç†è°ƒè¯•æ–‡ä»¶"),9,zd),P[8]||(P[8]=e("div",{class:"input-hint"},"æ¸…ç†è°ƒè¯•è¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶",-1))]),e("div",Nd,[e("button",{class:"btn btn-secondary",onClick:G,disabled:s.value},le(s.value?"æ¸…ç†ä¸­...":"ğŸ—‘ï¸ æ¸…ç†ä¸´æ—¶æ–‡ä»¶"),9,Vd),P[9]||(P[9]=e("div",{class:"input-hint"},"æ¸…ç†ä¸‹è½½å’Œå¤„ç†è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶",-1))])])]),P[11]||(P[11]=eo('<div class="settings-group" data-v-136fb3b8><div class="settings-group-title" data-v-136fb3b8>å…³äº</div><div class="about-info" data-v-136fb3b8><p data-v-136fb3b8><strong data-v-136fb3b8>Saber-Translator</strong></p><p data-v-136fb3b8>AIé©±åŠ¨çš„æ¼«ç”»ç¿»è¯‘å·¥å…·</p><p class="links" data-v-136fb3b8><a href="http://www.mashirosaber.top" target="_blank" data-v-136fb3b8>ğŸ“– ä½¿ç”¨æ•™ç¨‹</a><a href="https://github.com/MashiroSaber/saber-translator" target="_blank" data-v-136fb3b8>ğŸ™ GitHub</a></p><p class="disclaimer" data-v-136fb3b8>æœ¬é¡¹ç›®å®Œå…¨å¼€æºå…è´¹ï¼Œè¯·å‹¿ä¸Šå½“å—éª—</p></div></div>',1))]))}}),Kd=qe(Wd,[["__scopeId","data-v-136fb3b8"]]),qd={class:"settings-modal-content"},Hd={class:"settings-tabs"},Jd=["onClick"],jd={class:"settings-tab-content"},Yd={class:"settings-tab-pane active"},Gd={class:"settings-tab-pane"},Xd={class:"settings-tab-pane"},Zd={class:"settings-tab-pane"},Qd={class:"settings-tab-pane"},eg={class:"settings-tab-pane"},tg={class:"settings-tab-pane"},og={class:"settings-tab-pane"},ng=He({__name:"SettingsModal",props:{modelValue:{type:Boolean},initialTab:{}},emits:["update:modelValue","save"],setup(o,{emit:t}){const d=o,n=t,l=Je(),a=S(d.modelValue),s=S("ocr"),r=[{id:"ocr",label:"OCRè¯†åˆ«"},{id:"translate",label:"ç¿»è¯‘æœåŠ¡"},{id:"detection",label:"æ£€æµ‹è®¾ç½®"},{id:"hq",label:"é«˜è´¨é‡ç¿»è¯‘"},{id:"proofreading",label:"AIæ ¡å¯¹"},{id:"prompt-library",label:"æç¤ºè¯ç®¡ç†"},{id:"plugins",label:"æ’ä»¶ç®¡ç†"},{id:"more",label:"æ›´å¤š"}];he(()=>d.modelValue,W=>{a.value=W,W?(document.body.style.overflow="hidden",d.initialTab&&r.some(G=>G.id===d.initialTab)&&(s.value=d.initialTab)):(document.body.style.overflow="",s.value="ocr")});function x(){a.value=!1,n("update:modelValue",!1),document.body.style.overflow=""}async function A(){l.saveToStorage();try{await l.saveToBackend(),console.log("[SettingsModal] è®¾ç½®å·²ä¿å­˜åˆ°åç«¯")}catch(W){console.warn("[SettingsModal] ä¿å­˜åˆ°åç«¯å¤±è´¥ï¼Œä»…ä¿å­˜åˆ° localStorage:",W)}n("save"),x()}function w(W){W.key==="Escape"&&a.value&&x()}return ut(()=>{document.addEventListener("keydown",w)}),Tt(()=>{document.removeEventListener("keydown",w),document.body.style.overflow=""}),(W,G)=>a.value?(N(),q("div",{key:0,class:"settings-modal",onClick:Ze(x,["self"])},[e("div",qd,[e("div",{class:"settings-modal-header"},[G[0]||(G[0]=e("h3",null,"âš™ï¸ è®¾ç½®",-1)),e("span",{class:"settings-modal-close",onClick:x},"Ã—")]),e("div",Hd,[(N(),q(Ke,null,je(r,j=>e("button",{key:j.id,class:Ie(["settings-tab",{active:s.value===j.id}]),onClick:P=>s.value=j.id},le(j.label),11,Jd)),64))]),e("div",jd,[ae(e("div",Yd,[be(zi)],512),[[Ue,s.value==="ocr"]]),ae(e("div",Gd,[be(Tr)],512),[[Ue,s.value==="translate"]]),ae(e("div",Xd,[be(Gr)],512),[[Ue,s.value==="detection"]]),ae(e("div",Zd,[be(Au)],512),[[Ue,s.value==="hq"]]),ae(e("div",Qd,[be(Bc)],512),[[Ue,s.value==="proofreading"]]),ae(e("div",eg,[be(Qc)],512),[[Ue,s.value==="prompt-library"]]),ae(e("div",tg,[be(Td)],512),[[Ue,s.value==="plugins"]]),ae(e("div",og,[be(Kd)],512),[[Ue,s.value==="more"]])]),e("div",{class:"settings-modal-footer"},[e("button",{class:"btn btn-secondary",onClick:x},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:A},"ä¿å­˜è®¾ç½®")])])])):de("",!0)}}),sg=qe(ng,[["__scopeId","data-v-e1ec20ab"]]),ag={minScale:.1,maxScale:5,zoomSpeed:.1};function jo(o={}){const t={...ag,...o},d=S(1),n=S(0),l=S(0),a=S(!1),s=S(0),r=S(0),x=ee(()=>({transform:`translate(${n.value}px, ${l.value}px) scale(${d.value})`}));function A(V,U,O){const f=Math.min(Math.max(d.value*O,t.minScale),t.maxScale),m=f/d.value;n.value=V-(V-n.value)*m,l.value=U-(U-l.value)*m,d.value=f,o.onScaleChange?.(d.value),o.onTransformChange?.(b())}function w(V,U=800,O=600){A(U/2,O/2,V)}function W(){w(1.2)}function G(){w(.8)}function j(V,U=800,O=600){const f=V/d.value;A(U/2,O/2,f)}function P(V,U){a.value=!0,s.value=V,r.value=U}function h(V,U){if(!a.value)return;const O=V-s.value,f=U-r.value;n.value+=O,l.value+=f,s.value=V,r.value=U,o.onTransformChange?.(b())}function I(){a.value=!1}function D(V,U){n.value+=V,l.value+=U,o.onTransformChange?.(b())}function E(){d.value=1,n.value=0,l.value=0,o.onScaleChange?.(d.value),o.onTransformChange?.(b())}function c(){E()}function u(){d.value=1,n.value=0,l.value=0}function y(V,U,O,f){if(!V||!U)return;const m=O/V,$=f/U;d.value=Math.min(m,$)*.95,n.value=(O-V*d.value)/2,l.value=(f-U*d.value)/2,o.onScaleChange?.(d.value),o.onTransformChange?.(b())}function b(){return{scale:d.value,translateX:n.value,translateY:l.value}}function R(V){V.scale!==void 0&&(d.value=V.scale),V.translateX!==void 0&&(n.value=V.translateX),V.translateY!==void 0&&(l.value=V.translateY),o.onTransformChange?.(b())}function M(V){d.value=V.scale,n.value=V.translateX,l.value=V.translateY}function J(V,U,O){if(!V||V.length<4)return;const[f,m,$,v]=V,g=(f+$)/2,k=(m+v)/2,Y=U/2,F=O/2;n.value=Y-g*d.value,l.value=F-k*d.value,o.onTransformChange?.(b())}return{scale:d,translateX:n,translateY:l,isDragging:a,transformStyle:x,zoomAt:A,zoom:w,zoomIn:W,zoomOut:G,setScale:j,startDrag:P,drag:h,endDrag:I,pan:D,reset:E,resetZoom:c,resetTransform:u,fitToScreen:y,getTransform:b,setTransform:R,syncWith:M,scrollToBubble:J}}function lg(o){const t=et(),d=Je(),n=S(null),l=S(Nn),a=S(!1),s=S(!1),r=S([]),x=S(0),A=S(0);let w=null,W=null,G=null;const j=ee(()=>n.value!==null),P=ee(()=>n.value==="repair"?{fill:"rgba(76, 175, 80, 0.4)",border:"#4CAF50"}:n.value==="restore"?{fill:"rgba(33, 150, 243, 0.4)",border:"#2196F3"}:{fill:"transparent",border:"transparent"});function h(k){n.value!==k&&(n.value=k,a.value=!0,r.value=[],console.log(`è¿›å…¥${k==="repair"?"ä¿®å¤":"è¿˜åŸ"}ç¬”åˆ·æ¨¡å¼ï¼Œç¬”åˆ·å¤§å°: ${l.value}px`))}function I(){s.value&&R();const k=n.value!==null;n.value=null,a.value=!1,s.value=!1,r.value=[],U(),k&&console.log("é€€å‡ºç¬”åˆ·æ¨¡å¼")}function D(k){n.value===k?I():h(k)}function E(k){l.value=Math.max(Uo,Math.min(Lo,k))}function c(k){E(l.value+k)}function u(k){if(!j.value)return;k.preventDefault(),k.stopPropagation();const Y=k.deltaY>0?-5:5;c(Y)}function y(k,Y){if(!j.value||k.button!==0)return;k.preventDefault(),k.stopPropagation(),s.value=!0,w=Y,r.value=[];const F=M(k,Y);F&&(r.value.push(F),V(Y),O(F)),console.log("å¼€å§‹ç¬”åˆ·æ¶‚æŠ¹")}function b(k){if(x.value=k.clientX,A.value=k.clientY,!s.value||!j.value)return;const Y=M(k,w);Y&&(r.value.push(Y),O(Y))}function R(){if(!s.value)return;s.value=!1;const k=t.currentImage;if(!k||r.value.length===0){U(),r.value=[];return}const Y=J();if(!Y){U(),r.value=[];return}const F=n.value;(async()=>{F==="restore"?await f(k,Y):F==="repair"&&await m(k,Y),o?.onBrushComplete?.()})(),U(),r.value=[]}function M(k,Y){if(!Y)return null;const F=Y.querySelector(".image-canvas-wrapper"),_=F?.querySelector("img");if(!_||!_.naturalWidth)return null;const z=F.getBoundingClientRect(),T=window.getComputedStyle(F).transform;let p=1;T&&T!=="none"&&(p=new DOMMatrix(T).a);const K=(k.clientX-z.left)/p,i=(k.clientY-z.top)/p,C=_.naturalWidth,ie=_.naturalHeight;return K<0||i<0||K>C||i>ie?null:{x:K,y:i,scale:p}}function J(){if(r.value.length===0)return null;const Y=r.value[0]?.scale||1,F=l.value/2/Y;let _=1/0,z=1/0,T=-1/0,p=-1/0;for(const K of r.value)_=Math.min(_,K.x-F),z=Math.min(z,K.y-F),T=Math.max(T,K.x+F),p=Math.max(p,K.y+F);return{x1:Math.max(0,Math.floor(_)),y1:Math.max(0,Math.floor(z)),x2:Math.ceil(T),y2:Math.ceil(p),path:[...r.value],radius:F}}function V(k){U();const Y=k.querySelector(".image-canvas-wrapper"),F=Y?.querySelector("img");if(!F)return;const _=document.createElement("canvas");_.id="brushOverlayCanvas",_.width=F.naturalWidth,_.height=F.naturalHeight,_.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100;",Y.appendChild(_),W=_,G=_.getContext("2d")}function U(){W&&W.parentNode&&W.parentNode.removeChild(W),W=null,G=null}function O(k){if(!G||!k)return;const Y=P.value.fill,F=l.value/2/(k.scale||1);G.beginPath(),G.arc(k.x,k.y,F,0,Math.PI*2),G.fillStyle=Y,G.fill()}async function f(k,Y){if(!k.originalDataURL)return;let F;return k.cleanImageData?F="data:image/png;base64,"+k.cleanImageData:F=k.originalDataURL,new Promise(_=>{const z=new Image,T=new Image;let p=0;const K=()=>{if(p++,p<2)return;const i=document.createElement("canvas");i.width=z.naturalWidth,i.height=z.naturalHeight;const C=i.getContext("2d");if(!C){_();return}C.drawImage(z,0,0);const ie=document.createElement("canvas");ie.width=i.width,ie.height=i.height;const L=ie.getContext("2d");if(!L){_();return}L.fillStyle="white";for(const ce of Y.path)L.beginPath(),L.arc(ce.x,ce.y,Y.radius,0,Math.PI*2),L.fill();C.globalCompositeOperation="destination-out",C.drawImage(ie,0,0),C.globalCompositeOperation="destination-over",C.drawImage(T,0,0),C.globalCompositeOperation="source-over";const te=i.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:te}),console.log("è¿˜åŸç¬”åˆ·åŒºåŸŸå®Œæˆ"),_()};z.onload=K,z.onerror=()=>_(),T.onload=K,T.onerror=()=>_(),z.src=F,T.src=k.originalDataURL})}async function m(k,Y){const F=o?.getCurrentRepairSettings?.()||{inpaintMethod:"solid",fillColor:"#FFFFFF"},_=F.inpaintMethod;_==="lama_mpe"||_==="litelama"?await $(k,Y,_):await v(k,Y,F.fillColor)}async function $(k,Y,F="lama_mpe"){let _,z;if(k.cleanImageData)_=k.cleanImageData,z="data:image/png;base64,"+k.cleanImageData;else if(k.originalDataURL)_=k.originalDataURL.split(",")[1],z=k.originalDataURL;else{console.error("æ— æ³•è·å–åŸºç¡€å›¾åƒç”¨äº LAMA ä¿®å¤");return}return new Promise(T=>{const p=new Image;p.onload=async()=>{const K=p.naturalWidth,i=p.naturalHeight,C=document.createElement("canvas");C.width=K,C.height=i;const ie=C.getContext("2d");if(!ie){console.error("æ— æ³•åˆ›å»ºæ©è†œç”»å¸ƒä¸Šä¸‹æ–‡"),T();return}ie.fillStyle="black",ie.fillRect(0,0,K,i),ie.fillStyle="white";for(const $e of Y.path)ie.beginPath(),ie.arc($e.x,$e.y,Y.radius,0,Math.PI*2),ie.fill();const te=C.toDataURL("image/png").split(",")[1],ce=[Y.x1,Y.y1,Y.x2,Y.y2],we=F==="litelama"?"litelama":"lama_mpe";try{me("LAMA ä¿®å¤ä¸­...","info");const $e=await go(_,ce,{method:"lama",lamaModel:we,maskData:te});if($e.success&&$e.inpainted_image)t.updateCurrentImage({cleanImageData:$e.inpainted_image}),console.log("ä¿®å¤ç¬”åˆ·åŒºåŸŸå®Œæˆï¼ˆLAMA ä¿®å¤ï¼Œç²¾ç¡®æ©è†œï¼‰"),me("LAMA ä¿®å¤å®Œæˆ","success");else throw new Error($e.error||"LAMA ä¿®å¤è¿”å›æ— æ•ˆæ•°æ®")}catch($e){console.error("LAMA ä¿®å¤å¤±è´¥ï¼Œå›é€€åˆ°çº¯è‰²å¡«å……:",$e),me("LAMA ä¿®å¤å¤±è´¥ï¼Œä½¿ç”¨çº¯è‰²å¡«å……","warning");const Fe=o?.getCurrentRepairSettings?.();await v(k,Y,Fe?.fillColor)}T()},p.onerror=()=>{console.error("åŠ è½½å›¾åƒå¤±è´¥ï¼Œæ— æ³•è¿›è¡Œ LAMA ä¿®å¤"),T()},p.src=z})}async function v(k,Y,F){const _=F||d.settings.textStyle.fillColor||"#FFFFFF";let z;if(k.cleanImageData)z="data:image/png;base64,"+k.cleanImageData;else if(k.originalDataURL)z=k.originalDataURL;else return;return new Promise(T=>{const p=new Image;p.onload=()=>{const K=document.createElement("canvas");K.width=p.naturalWidth,K.height=p.naturalHeight;const i=K.getContext("2d");if(!i){T();return}i.drawImage(p,0,0),i.fillStyle=_;for(const ie of Y.path)i.beginPath(),i.arc(ie.x,ie.y,Y.radius,0,Math.PI*2),i.fill();const C=K.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:C}),console.log("ä¿®å¤ç¬”åˆ·åŒºåŸŸå®Œæˆï¼ˆçº¯è‰²å¡«å……ï¼‰"),T()},p.onerror=()=>T(),p.src=z})}async function g(){const k=t.currentImage;if(!k)return console.warn("ensureCleanBackground: æ²¡æœ‰å½“å‰å›¾ç‰‡"),!1;if(k.cleanImageData)return console.log("ensureCleanBackground: å·²æœ‰å¹²å‡€èƒŒæ™¯"),!0;const Y=o?.getCurrentRepairSettings?.();if((Y?.inpaintMethod||d.settings.textStyle.inpaintMethod)!=="solid")return console.log("ensureCleanBackground: éçº¯è‰²å¡«å……æ¨¡å¼ï¼Œè·³è¿‡"),!1;if(!k.bubbleStates||k.bubbleStates.length===0)return console.warn("ensureCleanBackground: æ²¡æœ‰æ°”æ³¡æ•°æ®"),!1;if(!k.translatedDataURL&&!k.originalDataURL)return console.warn("ensureCleanBackground: æ²¡æœ‰å›¾ç‰‡æ•°æ®"),!1;console.log("ensureCleanBackground: å°è¯•ä¸ºçº¯è‰²å¡«å……æ¨¡å¼åˆ›å»ºä¸´æ—¶å¹²å‡€èƒŒæ™¯");const _=k.translatedDataURL||k.originalDataURL,z=Y?.fillColor||d.settings.textStyle.fillColor||"#FFFFFF";return new Promise(T=>{const p=new Image;p.onload=()=>{try{const K=document.createElement("canvas");K.width=p.naturalWidth,K.height=p.naturalHeight;const i=K.getContext("2d");if(!i){console.error("ensureCleanBackground: æ— æ³•è·å– Canvas ä¸Šä¸‹æ–‡"),T(!1);return}i.drawImage(p,0,0),i.fillStyle=z;for(const ie of k.bubbleStates){const[L,te,ce,we]=ie.coords;i.fillRect(L,te,ce-L+1,we-te+1)}const C=K.toDataURL("image/png").split(",")[1];t.updateCurrentImage({cleanImageData:C}),console.log("ensureCleanBackground: æˆåŠŸåˆ›å»ºä¸´æ—¶å¹²å‡€èƒŒæ™¯ï¼ˆçº¯è‰²å¡«å……ï¼‰"),T(!0)}catch(K){console.error("ensureCleanBackground: Canvas æ“ä½œå¤±è´¥:",K),T(!1)}},p.onerror=()=>{console.error("ensureCleanBackground: åŠ è½½å›¾åƒå¤±è´¥"),T(!1)},p.src=_})}return Tt(()=>{I()}),{brushMode:n,brushSize:l,isBrushKeyDown:a,isBrushPainting:s,mouseX:x,mouseY:A,isActive:j,brushColor:P,BRUSH_MIN_SIZE:Uo,BRUSH_MAX_SIZE:Lo,enterBrushMode:h,exitBrushMode:I,toggleBrushMode:D,setBrushSize:E,adjustBrushSize:c,handleBrushWheel:u,startBrushPainting:y,continueBrushPainting:b,finishBrushPainting:R,getBrushPositionInImage:M,getBrushPathBounds:J,ensureCleanBackground:g}}function ig(o){return[Math.round(o[0]),Math.round(o[1]),Math.round(o[2]),Math.round(o[3])]}function rg(o){const t=dt(),d=et(),n=Je(),{bubbles:l,selectedIndex:a,hasSelection:s}=yt(t),{currentImage:r}=yt(d),x=S(!1),A=S(!1),w=S(null),W=S(0),G=S(0),j=S(!1);function P(i){t.selectBubble(i)}function h(i){t.toggleMultiSelect(i)}function I(){t.clearMultiSelect()}function D(i,C){console.log(`å¼€å§‹æ‹–åŠ¨æ°”æ³¡ #${i+1}`)}function E(i,C){}function c(i,C){t.updateBubble(i,{coords:C}),console.log(`æ°”æ³¡ #${i+1} æ‹–åŠ¨å®Œæˆ:`,C),F()}function u(i,C,ie){console.log(`å¼€å§‹è°ƒæ•´æ°”æ³¡ #${i+1} å¤§å°ï¼Œæ‰‹æŸ„: ${C}`)}function y(i){}function b(i,C){t.updateBubble(i,{coords:C}),console.log(`æ°”æ³¡ #${i+1} è°ƒæ•´å¤§å°å®Œæˆ:`,C),F()}function R(i,C){console.log(`å¼€å§‹æ—‹è½¬æ°”æ³¡ #${i+1}`)}function M(i){}function J(i,C){t.updateBubble(i,{rotationAngle:C}),console.log(`æ°”æ³¡ #${i+1} æ—‹è½¬å®Œæˆ: ${C}Â°`),F()}function V(){x.value=!x.value,x.value?console.log("è¿›å…¥ç»˜åˆ¶æ¨¡å¼"):console.log("é€€å‡ºç»˜åˆ¶æ¨¡å¼")}function U(i){t.addBubble(i),t.selectBubble(t.bubbleCount-1),console.log("å·²æ·»åŠ æ–°æ°”æ³¡:",i),o?.onReRender?.()}function O(i,C){A.value=!0,W.value=i,G.value=C,w.value=[i,C,i,C]}function f(i,C){A.value&&(w.value=[W.value,G.value,i,C])}function m(){if(!A.value||!w.value)return A.value=!1,w.value=null,null;const[i,C,ie,L]=w.value,te=10;if(Math.abs(ie-i)<te||Math.abs(L-C)<te)return A.value=!1,w.value=null,null;const ce=[Math.min(i,ie),Math.min(C,L),Math.max(i,ie),Math.max(C,L)];return A.value=!1,w.value=null,ce}function $(){A.value=!1,w.value=null,x.value=!1}function v(){if(!w.value)return{};const[i,C,ie,L]=w.value;return{position:"absolute",left:`${Math.min(i,ie)}px`,top:`${Math.min(C,L)}px`,width:`${Math.abs(ie-i)}px`,height:`${Math.abs(L-C)}px`,border:"2px dashed #00d4ff",background:"rgba(0, 212, 255, 0.1)",pointerEvents:"none",zIndex:"25",boxSizing:"border-box"}}let g=null,k=!1;const Y=150;function F(){g&&clearTimeout(g),g=setTimeout(async()=>{if(k){console.log("è·³è¿‡æ¸²æŸ“ï¼Œä¸Šä¸€æ¬¡æ¸²æŸ“ä»åœ¨è¿›è¡Œä¸­");return}console.log("è§¦å‘å»¶è¿Ÿæ¸²æŸ“é¢„è§ˆ"),k=!0;try{o?.onDelayedPreview?await o.onDelayedPreview():o?.onReRender&&await o.onReRender()}catch(i){console.error("å»¶è¿Ÿæ¸²æŸ“é¢„è§ˆå¤±è´¥:",i)}finally{k=!1}},Y)}function _(i){t.updateSelectedBubble(i),F()}function z(){s.value&&(t.deleteSelected(),console.log("å·²åˆ é™¤é€‰ä¸­çš„æ°”æ³¡"),o?.onReRender?.())}async function T(){const i=a.value;if(i<0){console.warn("è¯·å…ˆé€‰ä¸­è¦ä¿®å¤çš„æ°”æ³¡æ¡†");return}const C=l.value[i],ie=r.value;if(!C||!ie?.originalDataURL){console.warn("æ— æ³•ä¿®å¤èƒŒæ™¯ï¼šç¼ºå°‘æ°”æ³¡æˆ–å›¾ç‰‡æ•°æ®");return}const L=C.inpaintMethod||"solid",te=C.fillColor||"#FFFFFF",ce=C.rotationAngle||0;try{console.log(`å¼€å§‹ä¿®å¤æ°”æ³¡ #${i+1} èƒŒæ™¯ï¼Œæ–¹æ³•: ${L}`);let we;if(ie.cleanImageData)we=ie.cleanImageData;else{const Fe=ie.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/);if(we=Fe&&Fe[1]?Fe[1]:"",!we){console.error("æ— æ³•è§£æå›¾åƒæ•°æ®");return}}if(L==="lama_mpe"||L==="litelama"){const Fe=L==="litelama"?"litelama":"lama_mpe",Me=ig(C.coords),Be=await go(we,Me,{bubbleAngle:ce,method:"lama",lamaModel:Fe});Be.success&&Be.inpainted_image?(d.updateCurrentImage({cleanImageData:Be.inpainted_image}),console.log(`æ°”æ³¡ #${i+1} LAMAèƒŒæ™¯ä¿®å¤æˆåŠŸ`),F()):(console.error("LAMAä¿®å¤å¤±è´¥:",Be.error||"æœªçŸ¥é”™è¯¯"),await p(C.coords,te,ce),F())}else await p(C.coords,te,ce),console.log(`æ°”æ³¡ #${i+1} çº¯è‰²å¡«å……ä¿®å¤æˆåŠŸ`),F()}catch(we){console.error("èƒŒæ™¯ä¿®å¤å‡ºé”™:",we)}}async function p(i,C,ie=0){const L=r.value;if(!L)return;const[te,ce,we,$e]=i;let Fe;if(L.cleanImageData)Fe="data:image/png;base64,"+L.cleanImageData;else if(L.originalDataURL)Fe=L.originalDataURL;else{console.error("æ— æ³•æ‰¾åˆ°åŸºç¡€å›¾åƒç”¨äºå¡«å……");return}return new Promise(Me=>{const Be=new Image;Be.onload=()=>{const H=document.createElement("canvas");H.width=Be.naturalWidth,H.height=Be.naturalHeight;const B=H.getContext("2d");if(!B){Me();return}if(B.drawImage(Be,0,0),B.fillStyle=C,Math.abs(ie)<.1)B.fillRect(te,ce,we-te,$e-ce);else{const oe=(te+we)/2,se=(ce+$e)/2,pe=(we-te)/2,ye=($e-ce)/2,xe=ie*Math.PI/180,fe=Math.cos(xe),ve=Math.sin(xe),De=[[-pe,-ye],[pe,-ye],[pe,ye],[-pe,ye]].map(([Le,Re])=>[oe+Le*fe-Re*ve,se+Le*ve+Re*fe]);B.beginPath();const _e=De[0];if(_e){B.moveTo(_e[0],_e[1]);for(let Le=1;Le<De.length;Le++){const Re=De[Le];Re&&B.lineTo(Re[0],Re[1])}}B.closePath(),B.fill()}const ne=H.toDataURL("image/png").split(",")[1];d.updateCurrentImage({cleanImageData:ne}),console.log("å·²å¯¹æ°”æ³¡åŒºåŸŸè¿›è¡Œçº¯è‰²å¡«å……:",i,C,"è§’åº¦:",ie),Me()},Be.onerror=()=>{console.error("åŠ è½½åŸºç¡€å›¾åƒå¤±è´¥"),Me()},Be.src=Fe})}async function K(i){const C=l.value[i],ie=r.value;if(!C||!ie?.originalDataURL){console.warn("æ— æ³•è¿›è¡Œ OCR è¯†åˆ«ï¼šç¼ºå°‘æ°”æ³¡æˆ–å›¾ç‰‡æ•°æ®");return}try{console.log(`å¼€å§‹ OCR è¯†åˆ«æ°”æ³¡ #${i+1}`);const L=ie.originalDataURL.split(",")[1]||"",te=n.settings,ce=await on(L,C.coords,te.ocrEngine||"manga_ocr",{source_language:te.sourceLanguage,baidu_ocr_api_key:te.baiduOcr.apiKey,baidu_ocr_secret_key:te.baiduOcr.secretKey,baidu_version:te.baiduOcr.version,baidu_source_language:te.baiduOcr.sourceLanguage,ai_vision_provider:te.aiVisionOcr.provider,ai_vision_api_key:te.aiVisionOcr.apiKey,ai_vision_model_name:te.aiVisionOcr.modelName,ai_vision_ocr_prompt:te.aiVisionOcr.prompt,custom_ai_vision_base_url:te.aiVisionOcr.customBaseUrl});ce.success&&ce.text!==void 0?(t.updateBubble(i,{originalText:ce.text}),console.log(`OCR è¯†åˆ«æˆåŠŸ: "${ce.text}"`)):console.error("OCR è¯†åˆ«å¤±è´¥:",ce.error||"æœªçŸ¥é”™è¯¯")}catch(L){console.error("OCR è¯†åˆ«å‡ºé”™:",L)}}return{isDrawingMode:x,isDrawingBox:A,currentDrawingRect:w,isMiddleButtonDown:j,handleBubbleSelect:P,handleBubbleMultiSelect:h,handleClearMultiSelect:I,handleBubbleDragStart:D,handleBubbleDragging:E,handleBubbleDragEnd:c,handleBubbleResizeStart:u,handleBubbleResizing:y,handleBubbleResizeEnd:b,handleBubbleRotateStart:R,handleBubbleRotating:M,handleBubbleRotateEnd:J,toggleDrawingMode:V,handleDrawBubble:U,startDrawingBox:O,updateDrawingBox:f,finishDrawingBox:m,cancelDrawing:$,getDrawingRectStyle:v,handleBubbleUpdate:_,deleteSelectedBubbles:z,repairSelectedBubble:T,triggerDelayedPreview:F,handleOcrRecognize:K}}function ug(o){const t=dt(),d=et(),{bubbles:n}=yt(t),{currentImage:l}=yt(d),a=S(!1),s=S("");let r=null;function x(){const W=l.value;if(!W)return null;if(W.cleanImageData)return W.cleanImageData;if(W.originalDataURL){const G=W.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/);if(G&&G[1])return G[1]}return null}async function A(W=!1){if(!l.value)return console.warn("reRenderFullImage: æ²¡æœ‰å½“å‰å›¾ç‰‡"),!1;if(n.value.length===0){console.log("reRenderFullImage: æ²¡æœ‰æ°”æ³¡ï¼Œè·³è¿‡åç«¯æ¸²æŸ“");const h=x();if(h){const I=`data:image/png;base64,${h}`;d.updateCurrentImage({translatedDataURL:I}),W||o?.onRenderSuccess?.(I)}return!0}const j=x();if(!j)return console.error("reRenderFullImage: ç¼ºå°‘å›¾åƒæ•°æ®"),s.value="ç¼ºå°‘å›¾åƒæ•°æ®",W||o?.onRenderError?.("ç¼ºå°‘å›¾åƒæ•°æ®"),!1;const P=Symbol("render");r=P,a.value=!0,s.value="",W||o?.onRenderStart?.();try{console.log("reRenderFullImage: å¼€å§‹é‡æ–°æ¸²æŸ“ï¼Œæ°”æ³¡æ•°é‡:",n.value.length);const h=n.value,I=h.map(u=>u.translatedText||""),D=h.map(u=>u.coords.map(y=>Math.round(y))),E=h.map(u=>({translatedText:u.translatedText||"",coords:u.coords,fontSize:Number(u.fontSize)||24,fontFamily:u.fontFamily||"fonts/STSONG.TTF",textDirection:_t(u),textColor:u.textColor||"#231816",rotationAngle:Math.round(Number(u.rotationAngle)||0),position:u.position?{x:Math.round(u.position.x||0),y:Math.round(u.position.y||0)}:{x:0,y:0},strokeEnabled:u.strokeEnabled!==void 0?u.strokeEnabled:!0,strokeColor:u.strokeColor||"#FFFFFF",strokeWidth:Number(u.strokeWidth)||3})),c=await uo({clean_image:j,bubble_texts:I,bubble_coords:D,bubble_states:E,fontSize:Number(h[0]?.fontSize)||24,fontFamily:h[0]?.fontFamily||"fonts/STSONG.TTF",textDirection:h[0]?_t(h[0]):"vertical",textColor:h[0]?.textColor||"#231816",strokeEnabled:h[0]?.strokeEnabled!==void 0?h[0].strokeEnabled:!0,strokeColor:h[0]?.strokeColor||"#FFFFFF",strokeWidth:Number(h[0]?.strokeWidth)||3,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,is_font_style_change:!0});if(r!==P)return console.log("reRenderFullImage: æ¸²æŸ“ç»“æœå·²è¿‡æœŸï¼Œå¿½ç•¥"),!1;if(c.rendered_image){const u=`data:image/png;base64,${c.rendered_image}`;return d.updateCurrentImage({translatedDataURL:u}),console.log("reRenderFullImage: æ¸²æŸ“æˆåŠŸ"),W||o?.onRenderSuccess?.(u),!0}else{const u=c.error||"æ¸²æŸ“å¤±è´¥";return console.error("reRenderFullImage: æ¸²æŸ“å¤±è´¥ -",u),s.value=u,W||o?.onRenderError?.(u),!1}}catch(h){if(r!==P)return!1;const I=h instanceof Error?h.message:"æ¸²æŸ“è¯·æ±‚å¤±è´¥";return console.error("reRenderFullImage: æ¸²æŸ“å‡ºé”™ -",h),s.value=I,W||o?.onRenderError?.(I),!1}finally{r===P&&(a.value=!1,W||o?.onRenderEnd?.())}}function w(){r=null,a.value=!1}return{isRendering:a,renderError:s,reRenderFullImage:A,cancelRender:w}}const cg=["data-index","data-coords","data-rotation","onClick","onMousedown"],dg={class:"bubble-index"},gg=["data-parent-index","onMousedown"],pg=["data-parent-index","onMousedown"],vg=["data-parent-index","onMousedown"],mg=["data-parent-index","onMousedown"],bg=["data-parent-index","onMousedown"],fg=["data-parent-index","onMousedown"],hg=["data-parent-index","onMousedown"],yg=["data-parent-index","onMousedown"],xg=["data-parent-index","onMousedown"],kg=He({__name:"BubbleOverlay",props:{bubbles:{},selectedIndex:{},selectedIndices:{},scale:{},isDrawingMode:{type:Boolean},isBrushMode:{type:Boolean},imageWidth:{},imageHeight:{}},emits:["select","multiSelect","dragStart","dragging","dragEnd","resizeStart","resizing","resizeEnd","rotateStart","rotating","rotateEnd","drawBubble"],setup(o,{emit:t}){const d=dt(),{isDragging:n,draggingIndex:l,dragOffsetX:a,dragOffsetY:s,dragInitialX:r,dragInitialY:x,isResizing:A,resizingIndex:w,resizeCurrentCoords:W,isRotating:G,rotatingIndex:j,rotateCurrentAngle:P}=yt(d),h=o,I=t,D=S(null),E=S(0),c=S(0),u=S(""),y=S(0),b=S(0),R=S(null),M=S(0),J=S(0),V=S(0),U=S(0),O=S(!1),f=S(0),m=S(0),$=S(null),v=S(!1);function g(H,B){let ne,oe,se,pe,ye=H.rotationAngle||0;if(n.value&&l.value===B){const[De,_e,Le,Re]=H.coords;ne=r.value+a.value,oe=x.value+s.value,se=ne+(Le-De),pe=oe+(Re-_e)}else A.value&&w.value===B&&W.value?[ne,oe,se,pe]=W.value:G.value&&j.value===B?([ne,oe,se,pe]=H.coords,ye=P.value):[ne,oe,se,pe]=H.coords;const xe=se-ne,fe=pe-oe,ve={left:`${ne}px`,top:`${oe}px`,width:`${xe}px`,height:`${fe}px`};return ye&&(ve.transformOrigin="center center",ve.transform=`rotate(${ye}deg)`),ve}function k(){if(!$.value)return{};const[H,B,ne,oe]=$.value;return{left:`${Math.min(H,ne)}px`,top:`${Math.min(B,oe)}px`,width:`${Math.abs(ne-H)}px`,height:`${Math.abs(oe-B)}px`}}function Y(H){if(!D.value)return null;const B=D.value.getBoundingClientRect(),ne=h.scale||1,oe=(H.clientX-B.left)/ne,se=(H.clientY-B.top)/ne;return{x:oe,y:se}}function F(H,B){h.isBrushMode||B.shiftKey||I("select",H)}function _(H){if(!h.isBrushMode){if(H.button===1){H.preventDefault(),v.value=!0,document.body.classList.add("middle-button-drawing"),we(H);return}H.button===0&&h.isDrawingMode&&we(H)}}function z(H,B){if(!h.isBrushMode&&B.button===0){if(B.preventDefault(),B.stopPropagation(),B.shiftKey){I("multiSelect",H);return}if(H!==h.selectedIndex){I("select",H);return}T(H,B)}}function T(H,B){document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",Be),n.value=!0,l.value=H,E.value=B.clientX,c.value=B.clientY,a.value=0,s.value=0;const ne=h.bubbles[H];ne&&(r.value=ne.coords[0],x.value=ne.coords[1]),I("dragStart",H,B),document.addEventListener("mousemove",Me),document.addEventListener("mouseup",Be)}function p(H){const B=h.scale||1,ne=(H.clientX-E.value)/B,oe=(H.clientY-c.value)/B;a.value=ne,s.value=oe}function K(H){const B=l.value;n.value=!1,l.value=-1,a.value=0,s.value=0;const ne=h.scale||1,oe=(H.clientX-E.value)/ne,se=(H.clientY-c.value)/ne,pe=h.bubbles[B];if(!pe)return;const[ye,xe,fe,ve]=pe.coords,De=fe-ye,_e=ve-xe;let Le=Math.round(r.value+oe),Re=Math.round(x.value+se);const Xe=h.imageWidth||2e3,ke=h.imageHeight||2e3,ot=Math.min(De,Xe),it=Math.min(_e,ke);Le=Math.max(0,Math.min(Le,Xe-ot)),Re=Math.max(0,Math.min(Re,ke-it));const Pe=[Le,Re,Le+ot,Re+it];I("dragEnd",B,Pe)}function i(H,B,ne){if(h.isBrushMode||ne.button!==0)return;ne.preventDefault(),ne.stopPropagation(),document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",Be),A.value=!0,w.value=B,u.value=H,y.value=ne.clientX,b.value=ne.clientY;const oe=h.bubbles[B];oe&&(R.value=[...oe.coords],W.value=[...oe.coords]),I("resizeStart",B,H,ne),document.addEventListener("mousemove",Me),document.addEventListener("mouseup",Be)}function C(H){if(!R.value)return;const B=h.scale||1,ne=(H.clientX-y.value)/B,oe=(H.clientY-b.value)/B;let[se,pe,ye,xe]=R.value;const fe=u.value;fe.includes("w")&&(se+=ne),fe.includes("e")&&(ye+=ne),fe.includes("n")&&(pe+=oe),fe.includes("s")&&(xe+=oe),se>ye&&([se,ye]=[ye,se]),pe>xe&&([pe,xe]=[xe,pe]);const ve=10;ye-se<ve||xe-pe<ve||(W.value=[se,pe,ye,xe])}function ie(H){if(!R.value)return;const B=h.scale||1,ne=(H.clientX-y.value)/B,oe=(H.clientY-b.value)/B;let[se,pe,ye,xe]=R.value;const fe=u.value;fe.includes("w")&&(se+=ne),fe.includes("e")&&(ye+=ne),fe.includes("n")&&(pe+=oe),fe.includes("s")&&(xe+=oe),se>ye&&([se,ye]=[ye,se]),pe>xe&&([pe,xe]=[xe,pe]);const ve=h.imageWidth||2e3,De=h.imageHeight||2e3;se=Math.max(0,Math.round(se)),pe=Math.max(0,Math.round(pe)),ye=Math.min(ve,Math.round(ye)),xe=Math.min(De,Math.round(xe));const _e=10;if(ye-se<_e||xe-pe<_e){console.warn("è°ƒæ•´åå°ºå¯¸è¿‡å°ï¼Œå·²æ’¤é”€"),A.value=!1,w.value=-1,R.value=null;return}I("resizeEnd",w.value,[se,pe,ye,xe]),A.value=!1,w.value=-1,R.value=null,W.value=null}function L(H,B){if(h.isBrushMode||B.button!==0)return;B.preventDefault(),B.stopPropagation(),document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",Be),G.value=!0,j.value=H;const ne=h.bubbles[H];if(!ne||!D.value)return;const[oe,se,pe,ye]=ne.coords,xe=h.scale||1,fe=D.value.getBoundingClientRect();V.value=fe.left+(oe+pe)/2*xe,U.value=fe.top+(se+ye)/2*xe;const ve=B.clientX-V.value,De=B.clientY-U.value;M.value=Math.atan2(De,ve)*180/Math.PI,J.value=ne.rotationAngle||0,P.value=ne.rotationAngle||0,I("rotateStart",H,B),document.body.classList.add("rotating-box"),document.addEventListener("mousemove",Me),document.addEventListener("mouseup",Be),console.log(`å¼€å§‹æ—‹è½¬æ°”æ³¡ #${H+1}ï¼Œåˆå§‹è§’åº¦: ${J.value}Â°`)}function te(H){const B=H.clientX-V.value,ne=H.clientY-U.value,se=Math.atan2(ne,B)*180/Math.PI-M.value;let pe=J.value+se;for(;pe>180;)pe-=360;for(;pe<-180;)pe+=360;H.shiftKey&&(pe=Math.round(pe/15)*15),P.value=pe}function ce(H){document.body.classList.remove("rotating-box");const B=j.value,ne=P.value;I("rotateEnd",B,ne),G.value=!1,j.value=-1,console.log(`æ°”æ³¡ #${B+1} æ—‹è½¬å®Œæˆï¼Œè§’åº¦: ${ne}Â°`)}function we(H){const B=Y(H);if(!B)return;const ne=h.imageWidth||2e3,oe=h.imageHeight||2e3;B.x<0||B.x>ne||B.y<0||B.y>oe||(O.value=!0,f.value=B.x,m.value=B.y,$.value=[B.x,B.y,B.x,B.y],document.addEventListener("mousemove",Me),document.addEventListener("mouseup",Be),console.log("å¼€å§‹ç»˜åˆ¶æ–°æ¡†:",B.x.toFixed(1),B.y.toFixed(1)))}function $e(H){const B=Y(H);!B||!$.value||($.value=[f.value,m.value,B.x,B.y])}function Fe(H){const B=Y(H);if(v.value&&(v.value=!1,document.body.classList.remove("middle-button-drawing")),!B||!$.value){O.value=!1,$.value=null;return}const ne=h.imageWidth||2e3,oe=h.imageHeight||2e3,se=Math.max(0,Math.round(Math.min(f.value,B.x))),pe=Math.max(0,Math.round(Math.min(m.value,B.y))),ye=Math.min(ne,Math.round(Math.max(f.value,B.x))),xe=Math.min(oe,Math.round(Math.max(m.value,B.y))),fe=10;if(ye-se<fe||xe-pe<fe){console.log("ç»˜åˆ¶çš„æ¡†å¤ªå°ï¼Œå·²å¿½ç•¥"),O.value=!1,$.value=null;return}console.log("å®Œæˆç»˜åˆ¶æ–°æ¡†:",[se,pe,ye,xe]),I("drawBubble",[se,pe,ye,xe]),O.value=!1,$.value=null}function Me(H){n.value?p(H):A.value?C(H):G.value?te(H):O.value&&$e(H)}function Be(H){document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",Be),(H.button===1||v.value)&&(v.value=!1,document.body.classList.remove("middle-button-drawing")),n.value?K(H):A.value?ie(H):G.value?ce():O.value&&Fe(H)}return ut(()=>{}),Tt(()=>{document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",Be),document.body.classList.remove("middle-button-drawing"),document.body.classList.remove("rotating-box")}),(H,B)=>(N(),q("div",{class:Ie(["bubble-overlay",{"brush-mode":o.isBrushMode}]),ref_key:"overlayRef",ref:D,onMousedown:_},[(N(!0),q(Ke,null,je(o.bubbles,(ne,oe)=>(N(),q("div",{key:oe,class:Ie(["bubble-highlight-box",{selected:oe===o.selectedIndex,"multi-selected":o.selectedIndices.length>1&&o.selectedIndices.includes(oe)&&oe!==o.selectedIndex}]),style:at(g(ne,oe)),"data-index":oe,"data-coords":JSON.stringify(ne.coords),"data-rotation":ne.rotationAngle||0,onClick:Ze(se=>F(oe,se),["stop"]),onMousedown:Ze(se=>z(oe,se),["stop"])},[e("span",dg,le(oe+1),1),oe===o.selectedIndex?(N(),q(Ke,{key:0},[e("div",{class:"resize-handle nw","data-handle":"nw","data-parent-index":oe,onMousedown:Ze(se=>i("nw",oe,se),["stop"])},null,40,gg),e("div",{class:"resize-handle n","data-handle":"n","data-parent-index":oe,onMousedown:Ze(se=>i("n",oe,se),["stop"])},null,40,pg),e("div",{class:"resize-handle ne","data-handle":"ne","data-parent-index":oe,onMousedown:Ze(se=>i("ne",oe,se),["stop"])},null,40,vg),e("div",{class:"resize-handle e","data-handle":"e","data-parent-index":oe,onMousedown:Ze(se=>i("e",oe,se),["stop"])},null,40,mg),e("div",{class:"resize-handle se","data-handle":"se","data-parent-index":oe,onMousedown:Ze(se=>i("se",oe,se),["stop"])},null,40,bg),e("div",{class:"resize-handle s","data-handle":"s","data-parent-index":oe,onMousedown:Ze(se=>i("s",oe,se),["stop"])},null,40,fg),e("div",{class:"resize-handle sw","data-handle":"sw","data-parent-index":oe,onMousedown:Ze(se=>i("sw",oe,se),["stop"])},null,40,hg),e("div",{class:"resize-handle w","data-handle":"w","data-parent-index":oe,onMousedown:Ze(se=>i("w",oe,se),["stop"])},null,40,yg),B[0]||(B[0]=e("div",{class:"rotate-line"},null,-1)),e("div",{class:"rotate-handle",title:"æ‹–æ‹½æ—‹è½¬","data-parent-index":oe,onMousedown:Ze(se=>L(oe,se),["stop"])},null,40,xg)],64)):de("",!0)],46,cg))),128)),$.value?(N(),q("div",{key:0,class:"drawing-rect",style:at(k())},null,4)):de("",!0)],34))}}),Yo=qe(kg,[["__scopeId","data-v-a3e510ac"]]),_g={key:0,class:"kana-keyboard"},Sg={class:"kana-keyboard-header"},Cg={class:"kana-keyboard-tabs"},wg=["onClick"],$g={class:"kana-keyboard-options"},Ig={class:"kana-mode-select"},Tg={class:"kana-target-select"},Dg={class:"kana-table"},Rg={class:"row-label"},Mg=["onClick"],Bg={class:"kana-hiragana"},Pg={class:"kana-katakana"},Eg={class:"kana-table"},Ag={class:"row-label"},Fg=["onClick"],Lg={class:"kana-hiragana"},Ug={class:"kana-katakana"},Og={class:"kana-table combo-table"},zg={class:"row-label"},Ng=["onClick"],Vg={class:"kana-hiragana"},Wg={class:"kana-katakana"},Kg={class:"special-chars-grid"},qg=["onClick"],Hg={key:0,class:"char-label"},Jg=He({__name:"JapaneseKeyboard",props:{visible:{type:Boolean,default:!1},defaultTarget:{default:"original"}},emits:["close","insert","delete"],setup(o,{emit:t}){const d=o,n=t,l=S("basic"),a=S("hiragana"),s=S(d.defaultTarget),r=S(null),x=[{label:"åŸæ–‡",value:"original"},{label:"è¯‘æ–‡",value:"translated"}],A=[{id:"basic",label:"åŸºæœ¬"},{id:"dakuten",label:"æµŠ/åŠæµŠéŸ³"},{id:"combo",label:"æ‹—éŸ³"},{id:"special",label:"ç‰¹æ®Š"}],w=[{label:"ã‚è¡Œ",chars:[{h:"ã‚",k:"ã‚¢"},{h:"ã„",k:"ã‚¤"},{h:"ã†",k:"ã‚¦"},{h:"ãˆ",k:"ã‚¨"},{h:"ãŠ",k:"ã‚ª"}]},{label:"ã‹è¡Œ",chars:[{h:"ã‹",k:"ã‚«"},{h:"ã",k:"ã‚­"},{h:"ã",k:"ã‚¯"},{h:"ã‘",k:"ã‚±"},{h:"ã“",k:"ã‚³"}]},{label:"ã•è¡Œ",chars:[{h:"ã•",k:"ã‚µ"},{h:"ã—",k:"ã‚·"},{h:"ã™",k:"ã‚¹"},{h:"ã›",k:"ã‚»"},{h:"ã",k:"ã‚½"}]},{label:"ãŸè¡Œ",chars:[{h:"ãŸ",k:"ã‚¿"},{h:"ã¡",k:"ãƒ"},{h:"ã¤",k:"ãƒ„"},{h:"ã¦",k:"ãƒ†"},{h:"ã¨",k:"ãƒˆ"}]},{label:"ãªè¡Œ",chars:[{h:"ãª",k:"ãƒŠ"},{h:"ã«",k:"ãƒ‹"},{h:"ã¬",k:"ãƒŒ"},{h:"ã­",k:"ãƒ"},{h:"ã®",k:"ãƒ"}]},{label:"ã¯è¡Œ",chars:[{h:"ã¯",k:"ãƒ"},{h:"ã²",k:"ãƒ’"},{h:"ãµ",k:"ãƒ•"},{h:"ã¸",k:"ãƒ˜"},{h:"ã»",k:"ãƒ›"}]},{label:"ã¾è¡Œ",chars:[{h:"ã¾",k:"ãƒ"},{h:"ã¿",k:"ãƒŸ"},{h:"ã‚€",k:"ãƒ "},{h:"ã‚",k:"ãƒ¡"},{h:"ã‚‚",k:"ãƒ¢"}]},{label:"ã‚„è¡Œ",chars:[{h:"ã‚„",k:"ãƒ¤"},null,{h:"ã‚†",k:"ãƒ¦"},null,{h:"ã‚ˆ",k:"ãƒ¨"}]},{label:"ã‚‰è¡Œ",chars:[{h:"ã‚‰",k:"ãƒ©"},{h:"ã‚Š",k:"ãƒª"},{h:"ã‚‹",k:"ãƒ«"},{h:"ã‚Œ",k:"ãƒ¬"},{h:"ã‚",k:"ãƒ­"}]},{label:"ã‚è¡Œ",chars:[{h:"ã‚",k:"ãƒ¯"},null,null,null,{h:"ã‚’",k:"ãƒ²"}]},{label:"ã‚“",chars:[{h:"ã‚“",k:"ãƒ³"},null,null,null,null]}],W=[{label:"ãŒè¡Œ",chars:[{h:"ãŒ",k:"ã‚¬"},{h:"ã",k:"ã‚®"},{h:"ã",k:"ã‚°"},{h:"ã’",k:"ã‚²"},{h:"ã”",k:"ã‚´"}]},{label:"ã–è¡Œ",chars:[{h:"ã–",k:"ã‚¶"},{h:"ã˜",k:"ã‚¸"},{h:"ãš",k:"ã‚º"},{h:"ãœ",k:"ã‚¼"},{h:"ã",k:"ã‚¾"}]},{label:"ã è¡Œ",chars:[{h:"ã ",k:"ãƒ€"},{h:"ã¢",k:"ãƒ‚"},{h:"ã¥",k:"ãƒ…"},{h:"ã§",k:"ãƒ‡"},{h:"ã©",k:"ãƒ‰"}]},{label:"ã°è¡Œ",chars:[{h:"ã°",k:"ãƒ"},{h:"ã³",k:"ãƒ“"},{h:"ã¶",k:"ãƒ–"},{h:"ã¹",k:"ãƒ™"},{h:"ã¼",k:"ãƒœ"}]},{label:"ã±è¡Œ",chars:[{h:"ã±",k:"ãƒ‘"},{h:"ã´",k:"ãƒ”"},{h:"ã·",k:"ãƒ—"},{h:"ãº",k:"ãƒš"},{h:"ã½",k:"ãƒ"}]}],G=[{label:"ãã‚ƒè¡Œ",chars:[{h:"ãã‚ƒ",k:"ã‚­ãƒ£"},{h:"ãã‚…",k:"ã‚­ãƒ¥"},{h:"ãã‚‡",k:"ã‚­ãƒ§"}]},{label:"ã—ã‚ƒè¡Œ",chars:[{h:"ã—ã‚ƒ",k:"ã‚·ãƒ£"},{h:"ã—ã‚…",k:"ã‚·ãƒ¥"},{h:"ã—ã‚‡",k:"ã‚·ãƒ§"}]},{label:"ã¡ã‚ƒè¡Œ",chars:[{h:"ã¡ã‚ƒ",k:"ãƒãƒ£"},{h:"ã¡ã‚…",k:"ãƒãƒ¥"},{h:"ã¡ã‚‡",k:"ãƒãƒ§"}]},{label:"ã«ã‚ƒè¡Œ",chars:[{h:"ã«ã‚ƒ",k:"ãƒ‹ãƒ£"},{h:"ã«ã‚…",k:"ãƒ‹ãƒ¥"},{h:"ã«ã‚‡",k:"ãƒ‹ãƒ§"}]},{label:"ã²ã‚ƒè¡Œ",chars:[{h:"ã²ã‚ƒ",k:"ãƒ’ãƒ£"},{h:"ã²ã‚…",k:"ãƒ’ãƒ¥"},{h:"ã²ã‚‡",k:"ãƒ’ãƒ§"}]},{label:"ã¿ã‚ƒè¡Œ",chars:[{h:"ã¿ã‚ƒ",k:"ãƒŸãƒ£"},{h:"ã¿ã‚…",k:"ãƒŸãƒ¥"},{h:"ã¿ã‚‡",k:"ãƒŸãƒ§"}]},{label:"ã‚Šã‚ƒè¡Œ",chars:[{h:"ã‚Šã‚ƒ",k:"ãƒªãƒ£"},{h:"ã‚Šã‚…",k:"ãƒªãƒ¥"},{h:"ã‚Šã‚‡",k:"ãƒªãƒ§"}]},{label:"ãã‚ƒè¡Œ",chars:[{h:"ãã‚ƒ",k:"ã‚®ãƒ£"},{h:"ãã‚…",k:"ã‚®ãƒ¥"},{h:"ãã‚‡",k:"ã‚®ãƒ§"}]},{label:"ã˜ã‚ƒè¡Œ",chars:[{h:"ã˜ã‚ƒ",k:"ã‚¸ãƒ£"},{h:"ã˜ã‚…",k:"ã‚¸ãƒ¥"},{h:"ã˜ã‚‡",k:"ã‚¸ãƒ§"}]},{label:"ã³ã‚ƒè¡Œ",chars:[{h:"ã³ã‚ƒ",k:"ãƒ“ãƒ£"},{h:"ã³ã‚…",k:"ãƒ“ãƒ¥"},{h:"ã³ã‚‡",k:"ãƒ“ãƒ§"}]},{label:"ã´ã‚ƒè¡Œ",chars:[{h:"ã´ã‚ƒ",k:"ãƒ”ãƒ£"},{h:"ã´ã‚…",k:"ãƒ”ãƒ¥"},{h:"ã´ã‚‡",k:"ãƒ”ãƒ§"}]}],j=[{char:"ã£",label:"ä¿ƒéŸ³"},{char:"ãƒƒ",label:"ä¿ƒéŸ³"},{char:"ãƒ¼",label:"é•¿éŸ³"},{char:"ã€œ",label:"æ³¢æµª"},{char:"ã€‚",label:"å¥å·"},{char:"ã€",label:"é¡¿å·"},{char:"ã€Œ",label:"å¼•å·"},{char:"ã€",label:"å¼•å·"},{char:"ã€",label:"åŒå¼•"},{char:"ã€",label:"åŒå¼•"},{char:"â€¦",label:"çœç•¥"},{char:"ãƒ»",label:"ä¸­ç‚¹"},{char:"ï¼",label:"æ„Ÿå¹"},{char:"ï¼Ÿ",label:"é—®å·"},{char:"â™ª",label:"éŸ³ç¬¦"},{char:"â™¡",label:"å¿ƒå½¢"},{char:"â˜…",label:"æ˜Ÿå½¢"},{char:"â˜†",label:"ç©ºæ˜Ÿ"},{char:"ã",label:"å°ã‚"},{char:"ãƒ",label:"å°ã„"},{char:"ã…",label:"å°ã†"},{char:"ã‡",label:"å°ãˆ"},{char:"ã‰",label:"å°ãŠ"},{char:"ã‚¡",label:"å°ã‚¢"},{char:"ã‚£",label:"å°ã‚¤"},{char:"ã‚¥",label:"å°ã‚¦"},{char:"ã‚§",label:"å°ã‚¨"},{char:"ã‚©",label:"å°ã‚ª"},{char:"ã‚ƒ",label:"å°ã‚„"},{char:"ã‚…",label:"å°ã‚†"},{char:"ã‚‡",label:"å°ã‚ˆ"},{char:"ãƒ£",label:"å°ãƒ¤"},{char:"ãƒ¥",label:"å°ãƒ¦"},{char:"ãƒ§",label:"å°ãƒ¨"}];function P(){n("close")}function h(E){const c=a.value==="hiragana"?E.h:E.k;r.value=E.h,setTimeout(()=>{r.value=null},100),n("insert",c,s.value)}function I(E){r.value=E,setTimeout(()=>{r.value=null},100),n("insert",E,s.value)}function D(){n("delete",s.value)}return(E,c)=>o.visible?(N(),q("div",_g,[e("div",Sg,[c[3]||(c[3]=e("span",{class:"kana-keyboard-title"},"50éŸ³é”®ç›˜",-1)),e("div",Cg,[(N(),q(Ke,null,je(A,u=>e("button",{key:u.id,class:Ie(["kana-tab",{active:l.value===u.id}]),onClick:y=>l.value=u.id},le(u.label),11,wg)),64))]),e("button",{class:"kana-keyboard-close",onClick:P},"âœ•")]),e("div",$g,[e("div",Ig,[e("label",null,[ae(e("input",{type:"radio",name:"kanaMode",value:"hiragana","onUpdate:modelValue":c[0]||(c[0]=u=>a.value=u)},null,512),[[Wo,a.value]]),c[4]||(c[4]=Se(" å¹³å‡å ",-1))]),e("label",null,[ae(e("input",{type:"radio",name:"kanaMode",value:"katakana","onUpdate:modelValue":c[1]||(c[1]=u=>a.value=u)},null,512),[[Wo,a.value]]),c[5]||(c[5]=Se(" ç‰‡å‡å ",-1))])]),e("div",Tg,[c[6]||(c[6]=e("label",null,"è¾“å…¥åˆ°ï¼š",-1)),be(ze,{modelValue:s.value,"onUpdate:modelValue":c[2]||(c[2]=u=>s.value=u),options:x},null,8,["modelValue"])])]),e("div",{class:Ie(["kana-tab-content",{active:l.value==="basic"}])},[e("table",Dg,[c[7]||(c[7]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚æ®µ"),e("th",null,"ã„æ®µ"),e("th",null,"ã†æ®µ"),e("th",null,"ãˆæ®µ"),e("th",null,"ãŠæ®µ")])],-1)),e("tbody",null,[(N(),q(Ke,null,je(w,u=>e("tr",{key:u.label},[e("td",Rg,le(u.label),1),(N(!0),q(Ke,null,je(u.chars,(y,b)=>(N(),q("td",{key:b},[y?(N(),q("button",{key:0,class:Ie(["kana-key",{pressed:r.value===y.h}]),onClick:R=>h(y)},[e("span",Bg,le(y.h),1),e("span",Pg,le(y.k),1)],10,Mg)):de("",!0)]))),128))])),64))])])],2),e("div",{class:Ie(["kana-tab-content",{active:l.value==="dakuten"}])},[e("table",Eg,[c[8]||(c[8]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚æ®µ"),e("th",null,"ã„æ®µ"),e("th",null,"ã†æ®µ"),e("th",null,"ãˆæ®µ"),e("th",null,"ãŠæ®µ")])],-1)),e("tbody",null,[(N(),q(Ke,null,je(W,u=>e("tr",{key:u.label},[e("td",Ag,le(u.label),1),(N(!0),q(Ke,null,je(u.chars,(y,b)=>(N(),q("td",{key:b},[y?(N(),q("button",{key:0,class:Ie(["kana-key",{pressed:r.value===y.h}]),onClick:R=>h(y)},[e("span",Lg,le(y.h),1),e("span",Ug,le(y.k),1)],10,Fg)):de("",!0)]))),128))])),64))])])],2),e("div",{class:Ie(["kana-tab-content",{active:l.value==="combo"}])},[e("table",Og,[c[9]||(c[9]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ã‚ƒ"),e("th",null,"ã‚…"),e("th",null,"ã‚‡")])],-1)),e("tbody",null,[(N(),q(Ke,null,je(G,u=>e("tr",{key:u.label},[e("td",zg,le(u.label),1),(N(!0),q(Ke,null,je(u.chars,(y,b)=>(N(),q("td",{key:b},[y?(N(),q("button",{key:0,class:Ie(["kana-key",{pressed:r.value===y.h}]),onClick:R=>h(y)},[e("span",Vg,le(y.h),1),e("span",Wg,le(y.k),1)],10,Ng)):de("",!0)]))),128))])),64))])])],2),e("div",{class:Ie(["kana-tab-content",{active:l.value==="special"}])},[e("div",Kg,[(N(),q(Ke,null,je(j,u=>e("button",{key:u.char,class:Ie(["kana-key special-key",{pressed:r.value===u.char}]),onClick:y=>I(u.char)},[Se(le(u.char)+" ",1),u.label?(N(),q("span",Hg,le(u.label),1)):de("",!0)],10,qg)),64))])],2),e("div",{class:"kana-keyboard-footer"},[e("button",{class:"kana-backspace",onClick:D},"âŒ« é€€æ ¼")])])):de("",!0)}}),jg=qe(Jg,[["__scopeId","data-v-ebfc2125"]]),Yg={class:"edit-panel-content"},Gg={class:"text-column original-text-column text-block"},Xg={class:"text-column translated-text-column text-block"},Zg={class:"style-settings-section text-block"},Qg={class:"office-toolbar"},ep={class:"toolbar-row toolbar-row-top"},tp={class:"combo-control font-control"},op={class:"combo-control size-control"},np={class:"size-input-wrap"},sp=["min","max","step"],ap={class:"toolbar-row toolbar-row-actions"},lp={class:"toolbar-icon-group","aria-label":"æ’ç‰ˆæ–¹å‘"},ip=["data-active"],rp=["data-active"],up={class:"toolbar-color-group"},cp={class:"toolbar-color-picker",title:"æ–‡å­—é¢œè‰²"},dp={class:"toolbar-inpaint-group",title:"èƒŒæ™¯ä¿®å¤æ–¹å¼"},gp={class:"toolbar-stroke-cluster"},pp=["data-active"],vp={class:"toolbar-row toolbar-row-bottom"},mp={class:"toolbar-rotation-group",title:"æ—‹è½¬è§’åº¦"},bp={class:"toolbar-position-group",title:"ä½ç½®è°ƒæ•´"},fp={class:"toolbar-position-value"},hp={class:"fontsize-presets-panel"},yp={class:"font-size-presets"},xp=["onClick"],Bt=2,kp=He({__name:"BubbleEditor",props:{bubble:{},bubbleIndex:{}},emits:["update","reRender","ocrRecognize","reTranslate","applyBubble","resetCurrent"],setup(o,{emit:t}){const d=o,n=t,l=dt(),a={originalText:"",translatedText:"",fontSize:24,fontFamily:"fonts/STSONG.TTF",textDirection:"auto",textColor:"#231816",fillColor:"#FFFFFF",strokeEnabled:!0,strokeColor:"#FFFFFF",strokeWidth:3,rotationAngle:0,inpaintMethod:"solid",position:{x:0,y:0}},s=S(""),r=S(""),x=S(24),A=S("fonts/STSONG.TTF"),w=S("auto"),W=S("#231816"),G=S("#FFFFFF"),j=S(!0),P=S("#FFFFFF"),h=S(3),I=S(0),D=S("solid"),E=S(0),c=S(0),u=S(null),y=S(null),b=S(null),R=S(null),M=S(null),J=S(!1),V=S("original"),U=S([{name:"åæ–‡å®‹ä½“",path:"fonts/STSONG.TTF"},{name:"åæ–‡æ¥·ä½“",path:"fonts/STKAITI.TTF"},{name:"åæ–‡ç»†é»‘",path:"fonts/STXIHEI.TTF"},{name:"é»‘ä½“",path:"fonts/SIMHEI.TTF"},{name:"å®‹ä½“",path:"fonts/SIMSUN.TTC"}]),O=S([]),f=ee(()=>d.bubble?d.bubble.coords[0]+E.value:0),m=ee(()=>d.bubble?d.bubble.coords[1]+c.value:0),$=ee(()=>{const Pe=[{label:"ç³»ç»Ÿå­—ä½“",options:U.value.map(X=>({label:X.name,value:X.path}))}];return O.value.length>0&&Pe.push({label:"è‡ªå®šä¹‰å­—ä½“",options:O.value.map(X=>({label:X.name,value:X.path}))}),Pe}),v=[{label:"çº¯è‰²å¡«å……",value:"solid"},{label:"LAMAä¿®å¤(æ¼«ç”»)",value:"lama_mpe"},{label:"LAMAä¿®å¤(é€šç”¨)",value:"litelama"}];function g(Pe){const X=Pe||a;s.value=X.originalText,r.value=X.translatedText,x.value=X.fontSize,A.value=X.fontFamily,w.value=X.textDirection,W.value=X.textColor,G.value=X.fillColor,j.value=X.strokeEnabled,P.value=X.strokeColor,h.value=X.strokeWidth,I.value=X.rotationAngle,D.value=X.inpaintMethod,E.value=X.position?.x||0,c.value=X.position?.y||0}he(()=>d.bubble,Pe=>{g(Pe)},{deep:!0,immediate:!0});function k(){n("update",{originalText:s.value})}function Y(){n("update",{translatedText:r.value})}function F(){navigator.clipboard.writeText(s.value)}function _(){navigator.clipboard.writeText(r.value)}function z(){n("update",{fontSize:x.value})}function T(Pe){x.value=Pe,n("update",{fontSize:Pe})}function p(){x.value=Math.min(Oo,x.value+Xt),n("update",{fontSize:x.value})}function K(){x.value=Math.max(zo,x.value-Xt),n("update",{fontSize:x.value})}function i(){n("update",{fontFamily:A.value})}function C(Pe){w.value=Pe,n("update",{textDirection:Pe})}function ie(){b.value?.click()}function L(){n("update",{textColor:W.value})}function te(){R.value?.click()}function ce(){n("update",{fillColor:G.value})}function we(){M.value?.click()}function $e(){n("update",{strokeColor:P.value})}function Fe(){j.value=!j.value,n("update",{strokeEnabled:j.value})}function Me(){n("update",{strokeWidth:h.value})}function Be(){n("update",{inpaintMethod:D.value})}function H(){n("update",{rotationAngle:I.value})}function B(){I.value=Math.max(-180,I.value-5),n("update",{rotationAngle:I.value})}function ne(){I.value=Math.min(180,I.value+5),n("update",{rotationAngle:I.value})}function oe(){I.value=0,n("update",{rotationAngle:0})}function se(){E.value-=Bt,n("update",{position:{x:E.value,y:c.value}})}function pe(){E.value+=Bt,n("update",{position:{x:E.value,y:c.value}})}function ye(){c.value-=Bt,n("update",{position:{x:E.value,y:c.value}})}function xe(){c.value+=Bt,n("update",{position:{x:E.value,y:c.value}})}function fe(){E.value=0,c.value=0,n("update",{position:{x:0,y:0}})}function ve(){n("applyBubble",d.bubbleIndex)}function De(){l.updateAllBubbles({fontSize:x.value,fontFamily:A.value,textDirection:w.value,textColor:W.value,fillColor:G.value,strokeEnabled:j.value,strokeColor:P.value,strokeWidth:h.value,inpaintMethod:D.value}),console.log("æ ·å¼å·²åº”ç”¨åˆ°æ‰€æœ‰æ°”æ³¡"),n("reRender")}function _e(){n("resetCurrent",d.bubbleIndex)}function Le(){n("ocrRecognize",d.bubbleIndex)}function Re(){n("reTranslate",d.bubbleIndex)}function Xe(){J.value=!J.value}function ke(Pe,X){if(X==="original"){const ge=u.value;if(ge){const Ve=ge.selectionStart||s.value.length,Ye=ge.selectionEnd||s.value.length,vt=s.value;s.value=vt.slice(0,Ve)+Pe+vt.slice(Ye),ct(()=>{ge.selectionStart=ge.selectionEnd=Ve+Pe.length,ge.focus()}),n("update",{originalText:s.value})}}else{const ge=y.value;if(ge){const Ve=ge.selectionStart||r.value.length,Ye=ge.selectionEnd||r.value.length,vt=r.value;r.value=vt.slice(0,Ve)+Pe+vt.slice(Ye),ct(()=>{ge.selectionStart=ge.selectionEnd=Ve+Pe.length,ge.focus()}),n("update",{translatedText:r.value})}}}function ot(Pe){if(Pe==="original"){const X=u.value;if(X&&s.value.length>0){const ge=X.selectionStart||s.value.length,Ve=X.selectionEnd||s.value.length,Ye=s.value;ge===Ve&&ge>0?(s.value=Ye.slice(0,ge-1)+Ye.slice(Ve),ct(()=>{X.selectionStart=X.selectionEnd=ge-1,X.focus()})):ge!==Ve&&(s.value=Ye.slice(0,ge)+Ye.slice(Ve),ct(()=>{X.selectionStart=X.selectionEnd=ge,X.focus()})),n("update",{originalText:s.value})}}else{const X=y.value;if(X&&r.value.length>0){const ge=X.selectionStart||r.value.length,Ve=X.selectionEnd||r.value.length,Ye=r.value;ge===Ve&&ge>0?(r.value=Ye.slice(0,ge-1)+Ye.slice(Ve),ct(()=>{X.selectionStart=X.selectionEnd=ge-1,X.focus()})):ge!==Ve&&(r.value=Ye.slice(0,ge)+Ye.slice(Ve),ct(()=>{X.selectionStart=X.selectionEnd=ge,X.focus()})),n("update",{translatedText:r.value})}}}async function it(){try{const Pe=await rs();if(Pe.fonts){const X=[],ge=[];for(const Ve of Pe.fonts){const Ye={name:typeof Ve=="string"?Ve:Ve.display_name||Ve.file_name||"",path:typeof Ve=="string"?Ve:Ve.path};Ye.path.startsWith("fonts/")?X.push(Ye):ge.push(Ye)}X.length>0&&(U.value=X),O.value=ge}}catch(Pe){console.error("åŠ è½½å­—ä½“åˆ—è¡¨å¤±è´¥:",Pe)}}return ut(()=>{it()}),(Pe,X)=>(N(),q("div",Yg,[e("div",Gg,[e("div",{class:"text-column-header"},[X[13]||(X[13]=e("span",{class:"column-title"},"ğŸ‡¯ğŸ‡µ æ—¥è¯­åŸæ–‡ (OCRç»“æœ)",-1)),e("button",{class:"re-ocr-btn",onClick:Le,title:"é‡æ–°OCRæ­¤æ°”æ³¡"},"ğŸ”„")]),ae(e("textarea",{ref_key:"originalTextInput",ref:u,"onUpdate:modelValue":X[0]||(X[0]=ge=>s.value=ge),class:"text-editor original-editor",placeholder:"OCRè¯†åˆ«çš„æ—¥è¯­åŸæ–‡...",spellcheck:"false",onInput:k},null,544),[[Ce,s.value]]),e("div",{class:"text-actions"},[e("button",{class:"copy-btn",onClick:F},"ğŸ“‹ å¤åˆ¶"),e("button",{class:"keyboard-toggle-btn",onClick:Xe,title:"æ˜¾ç¤º/éšè—50éŸ³é”®ç›˜"}," âŒ¨ï¸ 50éŸ³ ")]),be(jg,{visible:J.value,"default-target":V.value,onClose:X[1]||(X[1]=ge=>J.value=!1),onInsert:ke,onDelete:ot},null,8,["visible","default-target"])]),e("div",Xg,[e("div",{class:"text-column-header"},[X[14]||(X[14]=e("span",{class:"column-title"},"ğŸ‡¨ğŸ‡³ ä¸­æ–‡è¯‘æ–‡",-1)),e("button",{class:"re-translate-btn",onClick:Re,title:"é‡æ–°ç¿»è¯‘æ­¤æ°”æ³¡"}," ğŸ”„ ")]),ae(e("textarea",{ref_key:"translatedTextInput",ref:y,"onUpdate:modelValue":X[2]||(X[2]=ge=>r.value=ge),class:"text-editor translated-editor",placeholder:"ç¿»è¯‘åçš„ä¸­æ–‡...",spellcheck:"false",onInput:Y},null,544),[[Ce,r.value]]),e("div",{class:"text-actions"},[e("button",{class:"copy-btn",onClick:_},"ğŸ“‹ å¤åˆ¶"),e("button",{class:"apply-text-btn",onClick:ve},"âœ“ åº”ç”¨æ–‡æœ¬")])]),e("div",Zg,[e("div",Qg,[e("div",ep,[e("div",tp,[X[15]||(X[15]=e("label",null,"å­—ä½“",-1)),be(ze,{modelValue:A.value,"onUpdate:modelValue":X[3]||(X[3]=ge=>A.value=ge),groups:$.value,title:"å­—ä½“",onChange:i},null,8,["modelValue","groups"])]),e("div",op,[X[16]||(X[16]=e("label",null,"å­—å·",-1)),e("div",np,[ae(e("input",{type:"number","onUpdate:modelValue":X[4]||(X[4]=ge=>x.value=ge),class:"toolbar-fontsize-input",min:Q(zo),max:Q(Oo),step:Q(Xt),title:"å­—å·",onChange:z},null,40,sp),[[Ce,x.value,void 0,{number:!0}]]),e("div",{class:"toolbar-fontsize-btns"},[e("button",{class:"toolbar-fontsize-btn",onClick:p,title:"å¢å¤§å­—å·"}," A+ "),e("button",{class:"toolbar-fontsize-btn",onClick:K,title:"å‡å°å­—å·"}," A- ")])])])]),e("div",ap,[e("div",lp,[e("button",{class:"toolbar-btn","data-active":w.value==="vertical",onClick:X[5]||(X[5]=ge=>C("vertical")),title:"ç«–å‘æ’ç‰ˆ"},[...X[17]||(X[17]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M8 2v12M8 2L5 5M8 2l3 3",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])],8,ip),e("button",{class:"toolbar-btn","data-active":w.value==="horizontal",onClick:X[6]||(X[6]=ge=>C("horizontal")),title:"æ¨ªå‘æ’ç‰ˆ"},[...X[18]||(X[18]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M2 8h12M14 8l-3-3M14 8l-3 3",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])],8,rp)]),X[24]||(X[24]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",up,[e("div",cp,[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:ie},[X[19]||(X[19]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("text",{x:"3",y:"11","font-size":"10","font-weight":"bold",fill:"currentColor"},"A")],-1)),e("span",{class:"color-indicator",style:at({background:W.value})},null,4)]),ae(e("input",{ref_key:"textColorInput",ref:b,type:"color","onUpdate:modelValue":X[7]||(X[7]=ge=>W.value=ge),class:"hidden-color-input",onInput:L,onChange:L},null,544),[[Ce,W.value]])])]),X[25]||(X[25]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",dp,[be(ze,{modelValue:D.value,"onUpdate:modelValue":X[8]||(X[8]=ge=>D.value=ge),options:v,onChange:Be},null,8,["modelValue"]),e("div",{class:Ie(["toolbar-color-picker toolbar-solid-color-options",{hidden:D.value!=="solid"}])},[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:te},[X[20]||(X[20]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("rect",{x:"2",y:"2",width:"12",height:"12",rx:"2",fill:"none",stroke:"currentColor","stroke-width":"1.2"}),e("rect",{x:"4",y:"4",width:"8",height:"8",rx:"1",fill:"currentColor",opacity:"0.3"})],-1)),e("span",{class:"color-indicator",style:at({background:G.value})},null,4)]),ae(e("input",{ref_key:"fillColorInput",ref:R,type:"color","onUpdate:modelValue":X[9]||(X[9]=ge=>G.value=ge),class:"hidden-color-input",onChange:ce},null,544),[[Ce,G.value]])],2)]),X[26]||(X[26]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",gp,[e("button",{class:"toolbar-btn","data-active":j.value,onClick:Fe,title:"æ–‡å­—æè¾¹"},[...X[21]||(X[21]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("text",{x:"3",y:"12","font-size":"11","font-weight":"bold",stroke:"currentColor","stroke-width":"2",fill:"none"}," A "),e("text",{x:"3",y:"12","font-size":"11","font-weight":"bold",fill:"currentColor"},"A")],-1)])],8,pp),e("div",{class:Ie(["toolbar-color-picker toolbar-stroke-options",{hidden:!j.value}]),title:"æè¾¹é¢œè‰²"},[e("button",{class:"toolbar-btn toolbar-color-btn",onClick:we},[X[22]||(X[22]=e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"2"})],-1)),e("span",{class:"color-indicator",style:at({background:P.value})},null,4)]),ae(e("input",{ref_key:"strokeColorInput",ref:M,type:"color","onUpdate:modelValue":X[10]||(X[10]=ge=>P.value=ge),class:"hidden-color-input",onChange:$e},null,544),[[Ce,P.value]])],2),e("div",{class:Ie(["toolbar-stroke-width toolbar-stroke-options",{hidden:!j.value}]),title:"æè¾¹å®½åº¦"},[ae(e("input",{type:"number","onUpdate:modelValue":X[11]||(X[11]=ge=>h.value=ge),class:"toolbar-mini-input",min:"0",max:"10",onChange:Me},null,544),[[Ce,h.value,void 0,{number:!0}]]),X[23]||(X[23]=e("span",{class:"toolbar-unit"},"px",-1))],2)])]),e("div",vp,[e("div",mp,[e("button",{class:"toolbar-btn",onClick:B,title:"é€†æ—¶é’ˆæ—‹è½¬"},[...X[27]||(X[27]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M2 8a6 6 0 1 1 1.5 4",stroke:"currentColor","stroke-width":"1.5",fill:"none"}),e("path",{d:"M2 5v3.5h3.5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),ae(e("input",{type:"number","onUpdate:modelValue":X[12]||(X[12]=ge=>I.value=ge),class:"toolbar-mini-input toolbar-rotation-input",min:"-180",max:"180",step:"5",onChange:H},null,544),[[Ce,I.value,void 0,{number:!0}]]),X[29]||(X[29]=e("span",{class:"toolbar-unit"},"Â°",-1)),e("button",{class:"toolbar-btn",onClick:ne,title:"é¡ºæ—¶é’ˆæ—‹è½¬"},[...X[28]||(X[28]=[e("svg",{viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{d:"M14 8a6 6 0 1 0-1.5 4",stroke:"currentColor","stroke-width":"1.5",fill:"none"}),e("path",{d:"M14 5v3.5h-3.5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn toolbar-small-btn",onClick:oe,title:"é‡ç½®æ—‹è½¬"}," 0 ")]),X[35]||(X[35]=e("div",{class:"toolbar-divider vertical"},null,-1)),e("div",bp,[e("button",{class:"toolbar-btn",onClick:se,title:"å·¦ç§»"},[...X[30]||(X[30]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M10 3L5 8l5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:pe,title:"å³ç§»"},[...X[31]||(X[31]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M6 3l5 5-5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:ye,title:"ä¸Šç§»"},[...X[32]||(X[32]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M3 10l5-5 5 5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("button",{class:"toolbar-btn",onClick:xe,title:"ä¸‹ç§»"},[...X[33]||(X[33]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M3 6l5 5 5-5",stroke:"currentColor","stroke-width":"1.5",fill:"none"})],-1)])]),e("span",fp,[e("span",null,le(f.value),1),X[34]||(X[34]=Se(",",-1)),e("span",null,le(m.value),1)]),e("button",{class:"toolbar-btn toolbar-small-btn",onClick:fe,title:"é‡ç½®ä½ç½®"}," âŒ‚ ")])])]),e("details",hp,[X[36]||(X[36]=e("summary",null,"å­—å·é¢„è®¾",-1)),e("div",yp,[(N(!0),q(Ke,null,je(Q(Vn),ge=>(N(),q("button",{key:ge,class:Ie(["preset-btn",{active:x.value===ge}]),onClick:Ve=>T(ge)},le(ge),11,xp))),128))])]),e("div",{class:"edit-action-buttons"},[e("button",{class:"btn-apply",onClick:ve},"åº”ç”¨"),e("button",{class:"btn-apply-all",onClick:De},"åº”ç”¨å…¨éƒ¨"),e("button",{class:"btn-reset",onClick:_e},"é‡ç½®")])])]))}}),_p=qe(kp,[["__scopeId","data-v-ea49fb5e"]]),Sp={class:"edit-toolbar-wrapper"},Cp={class:"edit-toolbar toolbar-row-1"},wp={class:"image-navigator"},$p=["disabled"],Ip=["disabled"],Tp={class:"bubble-navigator"},Dp=["disabled"],Rp={class:"bubble-indicator"},Mp={id:"currentBubbleNum"},Bp={id:"totalBubbleNum"},Pp=["disabled"],Ep={class:"view-controls"},Ap={key:0,viewBox:"0 0 20 20",width:"16",height:"16"},Fp={key:1,viewBox:"0 0 20 20",width:"16",height:"16"},Lp={id:"zoomLevel"},Up={class:"edit-toolbar toolbar-row-2"},Op={class:"annotation-tools"},zp=["disabled"],Np=["disabled"],Vp={key:0,class:"brush-size-indicator"},Wp={key:1,class:"brush-mode-hint"},Kp={class:"edit-progress-info"},qp={class:"edit-progress-text"},Hp={class:"edit-progress-count"},Jp={class:"edit-progress-bar"},jp={class:"quick-actions"},Yp=He({__name:"EditToolbar",props:{currentImageIndex:{},imageCount:{},canGoPrevious:{type:Boolean},canGoNext:{type:Boolean},showThumbnails:{type:Boolean},hasBubbles:{type:Boolean},selectedBubbleIndex:{},bubbleCount:{},layoutMode:{},syncEnabled:{type:Boolean},scale:{},isDrawingMode:{type:Boolean},hasSelection:{type:Boolean},brushMode:{},brushSize:{},mouseX:{},mouseY:{},isProcessing:{type:Boolean},progressText:{},progressCurrent:{},progressTotal:{}},emits:["go-previous-image","go-next-image","toggle-thumbnails","select-previous-bubble","select-next-bubble","toggle-layout","toggle-view-mode","toggle-sync","fit-to-screen","zoom-in","zoom-out","reset-zoom","exit-edit-mode","auto-detect-bubbles","detect-all-images","translate-with-bubbles","toggle-drawing-mode","delete-selected-bubbles","repair-selected-bubble","activate-repair-brush","activate-restore-brush","apply-and-next"],setup(o){const t=o,d=ee(()=>t.progressTotal===0?0:Math.round(t.progressCurrent/t.progressTotal*100)),n=ee(()=>t.progressTotal>0&&t.progressCurrent>=t.progressTotal),l=ee(()=>{const a=t.brushMode==="repair"?{fill:"rgba(76, 175, 80, 0.4)",border:"#4CAF50"}:{fill:"rgba(33, 150, 243, 0.4)",border:"#2196F3"};return{position:"fixed",left:`${t.mouseX}px`,top:`${t.mouseY}px`,width:`${t.brushSize}px`,height:`${t.brushSize}px`,borderRadius:"50%",border:`2px solid ${a.border}`,backgroundColor:a.fill,pointerEvents:"none",zIndex:99999,transform:"translate(-50%, -50%)",display:t.brushMode?"block":"none"}});return(a,s)=>(N(),q("div",Sp,[e("div",Cp,[e("div",wp,[e("button",{class:"nav-btn",disabled:!o.canGoPrevious,onClick:s[0]||(s[0]=r=>a.$emit("go-previous-image")),title:"ä¸Šä¸€å¼ å›¾ç‰‡ (PageUp)"}," â—€â—€ ",8,$p),e("span",{class:"image-indicator",onClick:s[1]||(s[1]=r=>a.$emit("toggle-thumbnails")),title:"ç‚¹å‡»å±•å¼€ç¼©ç•¥å›¾"},[s[23]||(s[23]=Se(" å›¾ ",-1)),e("span",null,le(o.currentImageIndex+1),1),s[24]||(s[24]=Se(" / ",-1)),e("span",null,le(o.imageCount),1)]),e("button",{class:"nav-btn",disabled:!o.canGoNext,onClick:s[2]||(s[2]=r=>a.$emit("go-next-image")),title:"ä¸‹ä¸€å¼ å›¾ç‰‡ (PageDown)"}," â–¶â–¶ ",8,Ip),e("button",{class:Ie(["thumb-toggle-btn",{active:o.showThumbnails}]),onClick:s[3]||(s[3]=r=>a.$emit("toggle-thumbnails")),title:"æ˜¾ç¤º/éšè—ç¼©ç•¥å›¾"}," â˜· ",2)]),s[30]||(s[30]=e("div",{class:"toolbar-divider"},null,-1)),e("div",Tp,[e("button",{id:"prevBubbleBtn",class:"nav-btn",disabled:!o.hasBubbles||o.selectedBubbleIndex<=0,onClick:s[4]||(s[4]=r=>a.$emit("select-previous-bubble")),title:"ä¸Šä¸€ä¸ªæ°”æ³¡ (â†)"}," â—€ ",8,Dp),e("span",Rp,[s[25]||(s[25]=Se(" æ°”æ³¡ ",-1)),e("span",Mp,le(o.selectedBubbleIndex>=0?o.selectedBubbleIndex+1:0),1),s[26]||(s[26]=Se(" / ",-1)),e("span",Bp,le(o.bubbleCount),1)]),e("button",{id:"nextBubbleBtn",class:"nav-btn",disabled:!o.hasBubbles||o.selectedBubbleIndex>=o.bubbleCount-1,onClick:s[5]||(s[5]=r=>a.$emit("select-next-bubble")),title:"ä¸‹ä¸€ä¸ªæ°”æ³¡ (â†’)"}," â–¶ ",8,Pp)]),s[31]||(s[31]=e("div",{class:"toolbar-divider"},null,-1)),e("div",Ep,[e("button",{class:"layout-toggle-btn",onClick:s[6]||(s[6]=r=>a.$emit("toggle-layout")),title:"åˆ‡æ¢å¸ƒå±€ï¼šå·¦å³/ä¸Šä¸‹"},[o.layoutMode==="horizontal"?(N(),q("svg",Ap,[...s[27]||(s[27]=[e("rect",{x:"1",y:"2",width:"8",height:"16",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1),e("rect",{x:"11",y:"2",width:"8",height:"16",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1)])])):(N(),q("svg",Fp,[...s[28]||(s[28]=[e("rect",{x:"2",y:"1",width:"16",height:"8",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1),e("rect",{x:"2",y:"11",width:"16",height:"8",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"},null,-1)])]))]),e("button",{class:"view-mode-btn",onClick:s[7]||(s[7]=r=>a.$emit("toggle-view-mode")),title:"åˆ‡æ¢è§†å›¾æ¨¡å¼"},[...s[29]||(s[29]=[e("span",{class:"dual-icon"},"â§‰",-1)])]),e("button",{class:Ie({active:o.syncEnabled}),onClick:s[8]||(s[8]=r=>a.$emit("toggle-sync")),title:"åŒæ­¥ç¼©æ”¾/æ‹–åŠ¨",style:{"font-size":"12px"}}," ğŸ”— ",2),e("button",{onClick:s[9]||(s[9]=r=>a.$emit("fit-to-screen")),title:"é€‚åº”å±å¹• (åŒå‡»)"},"â›¶"),e("button",{onClick:s[10]||(s[10]=r=>a.$emit("zoom-in")),title:"æ”¾å¤§ (+)"},"+"),e("span",Lp,le(Math.round(o.scale*100))+"%",1),e("button",{onClick:s[11]||(s[11]=r=>a.$emit("zoom-out")),title:"ç¼©å° (-)"},"âˆ’"),e("button",{onClick:s[12]||(s[12]=r=>a.$emit("reset-zoom")),title:"åŸå§‹å¤§å°"},"1:1")]),s[32]||(s[32]=e("div",{class:"toolbar-spacer"},null,-1)),e("button",{class:"secondary-btn",onClick:s[13]||(s[13]=r=>a.$emit("exit-edit-mode"))},"é€€å‡ºç¼–è¾‘")]),e("div",Up,[e("div",Op,[e("button",{class:"annotation-btn detect-btn",onClick:s[14]||(s[14]=r=>a.$emit("auto-detect-bubbles")),title:"è‡ªåŠ¨æ£€æµ‹å½“å‰å›¾ç‰‡çš„æ–‡æœ¬æ¡†"},[...s[33]||(s[33]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"6",cy:"6",r:"4",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M9 9l4 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1),e("span",null,"æ£€æµ‹",-1)])]),e("button",{class:"annotation-btn detect-btn",onClick:s[15]||(s[15]=r=>a.$emit("detect-all-images")),title:"æ‰¹é‡æ£€æµ‹æ‰€æœ‰å›¾ç‰‡"},[...s[34]||(s[34]=[eo('<svg viewBox="0 0 16 16" width="14" height="14" data-v-b7164359><circle cx="5" cy="5" r="2.5" fill="none" stroke="currentColor" stroke-width="1" data-v-b7164359></circle><path d="M7 7l2 2" stroke="currentColor" stroke-width="1" stroke-linecap="round" data-v-b7164359></path><circle cx="10" cy="10" r="2.5" fill="none" stroke="currentColor" stroke-width="1" data-v-b7164359></circle><path d="M12 12l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-b7164359></path></svg><span data-v-b7164359>æ‰¹é‡æ£€æµ‹</span>',2)])]),e("button",{class:"annotation-btn primary-action-btn",onClick:s[16]||(s[16]=r=>a.$emit("translate-with-bubbles")),title:"ä½¿ç”¨å½“å‰æ–‡æœ¬æ¡†ç¿»è¯‘æ­¤å›¾ç‰‡"},[...s[35]||(s[35]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M2 3h5M4.5 3v7M2 6h5",stroke:"currentColor","stroke-width":"1.2",fill:"none"}),e("path",{d:"M9 13l2-7 2 7M9.5 11h3",stroke:"currentColor","stroke-width":"1.2",fill:"none"})],-1),e("span",null,"ç¿»è¯‘",-1)])]),s[41]||(s[41]=e("div",{class:"toolbar-divider"},null,-1)),e("button",{class:Ie(["annotation-btn",{active:o.isDrawingMode}]),onClick:s[17]||(s[17]=r=>a.$emit("toggle-drawing-mode")),title:"æ·»åŠ æ°”æ³¡æ¡†ï¼ˆæˆ–ä¸­é”®æ‹–æ‹½ç»˜åˆ¶ï¼‰"},[...s[36]||(s[36]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("rect",{x:"3",y:"3",width:"10",height:"10",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M8 5v6M5 8h6",stroke:"currentColor","stroke-width":"1.5"})],-1),e("span",null,"æ·»åŠ ",-1)])],2),e("button",{class:"annotation-btn",disabled:!o.hasSelection,onClick:s[18]||(s[18]=r=>a.$emit("delete-selected-bubbles")),title:"åˆ é™¤é€‰ä¸­æ°”æ³¡æ¡† (Delete)"},[...s[37]||(s[37]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("rect",{x:"3",y:"3",width:"10",height:"10",rx:"1",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M5 8h6",stroke:"currentColor","stroke-width":"1.5"})],-1),e("span",null,"åˆ é™¤",-1)])],8,zp),e("button",{class:"annotation-btn",disabled:!o.hasSelection,onClick:s[19]||(s[19]=r=>a.$emit("repair-selected-bubble")),title:"ä¿®å¤é€‰ä¸­æ°”æ³¡èƒŒæ™¯ (R)"},[...s[38]||(s[38]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("path",{d:"M2 14l3-3m0 0l6-6 3 3-6 6m-3 0l-1 1 1-1z",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M11 5l-1-1 2-2 2 2-2 2-1-1z",fill:"currentColor"})],-1),e("span",null,"ä¿®å¤",-1)])],8,Np),s[42]||(s[42]=e("div",{class:"toolbar-divider"},null,-1)),e("button",{class:Ie(["annotation-btn brush-btn",{active:o.brushMode==="repair"}]),onClick:s[20]||(s[20]=r=>a.$emit("activate-repair-brush")),title:"ä¿®å¤ç¬”åˆ· (æŒ‰ä½R+å·¦é”®æ‹–æ‹½)"},[...s[39]||(s[39]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("circle",{cx:"8",cy:"8",r:"2",fill:"currentColor"})],-1),e("span",null,"ä¿®å¤ç¬”åˆ·",-1)])],2),e("button",{class:Ie(["annotation-btn brush-btn",{active:o.brushMode==="restore"}]),onClick:s[21]||(s[21]=r=>a.$emit("activate-restore-brush")),title:"è¿˜åŸç¬”åˆ· (æŒ‰ä½U+å·¦é”®æ‹–æ‹½)"},[...s[40]||(s[40]=[e("svg",{viewBox:"0 0 16 16",width:"14",height:"14"},[e("circle",{cx:"8",cy:"8",r:"5",fill:"none",stroke:"currentColor","stroke-width":"1.5"}),e("path",{d:"M5 8h6M8 5v6",stroke:"currentColor","stroke-width":"1",transform:"rotate(45 8 8)"})],-1),e("span",null,"è¿˜åŸç¬”åˆ·",-1)])],2),o.brushMode?(N(),q("span",Vp," ç¬”åˆ·: "+le(o.brushSize)+"px ",1)):de("",!0),s[43]||(s[43]=eo('<div class="help-tooltip-container" data-v-b7164359><button class="help-tooltip-btn" title="å¿«æ·é”®æ“ä½œå¸®åŠ©" data-v-b7164359><svg viewBox="0 0 16 16" width="14" height="14" data-v-b7164359><circle cx="8" cy="8" r="6.5" fill="none" stroke="currentColor" stroke-width="1.2" data-v-b7164359></circle><text x="8" y="11" text-anchor="middle" font-size="9" font-weight="bold" fill="currentColor" data-v-b7164359>?</text></svg><span class="help-btn-text" data-v-b7164359>å¿«æ·é”®</span></button><div class="help-tooltip-popup" data-v-b7164359><div class="help-section" data-v-b7164359><div class="help-title" data-v-b7164359>ğŸ–±ï¸ é¼ æ ‡æ“ä½œ</div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®ç‚¹å‡»æ°”æ³¡</span><span class="help-desc" data-v-b7164359>é€‰æ‹©æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Shift+å·¦é”®ç‚¹å‡»</span><span class="help-desc" data-v-b7164359>å¤šé€‰æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®æ‹–æ‹½å››è§’/è¾¹</span><span class="help-desc" data-v-b7164359>è°ƒæ•´å¤§å°</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>å·¦é”®æ‹–æ‹½æ¡†å†…éƒ¨</span><span class="help-desc" data-v-b7164359>ç§»åŠ¨æ°”æ³¡æ¡†</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>ä¸­é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>ç»˜åˆ¶æ–°æ°”æ³¡æ¡†</span></div></div><div class="help-section" data-v-b7164359><div class="help-title" data-v-b7164359>âŒ¨ï¸ å¿«æ·é”®</div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>A / D</span><span class="help-desc" data-v-b7164359>åˆ‡æ¢ä¸Š/ä¸‹ä¸€å¼ å›¾ç‰‡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Ctrl+Enter</span><span class="help-desc" data-v-b7164359>åº”ç”¨å¹¶è·³è½¬ä¸‹ä¸€å¼ </span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>Delete / Backspace</span><span class="help-desc" data-v-b7164359>åˆ é™¤é€‰ä¸­æ°”æ³¡</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>æŒ‰ä½R+å·¦é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>ä¿®å¤ç¬”åˆ·</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>æŒ‰ä½U+å·¦é”®æ‹–æ‹½</span><span class="help-desc" data-v-b7164359>è¿˜åŸç¬”åˆ·</span></div><div class="help-item" data-v-b7164359><span class="help-key" data-v-b7164359>ç¬”åˆ·æ¨¡å¼ä¸‹æ»šè½®</span><span class="help-desc" data-v-b7164359>è°ƒæ•´ç¬”åˆ·å¤§å°</span></div></div></div></div>',1))]),o.brushMode?(N(),q("div",{key:0,class:"brush-cursor",style:at(l.value)},null,4)):de("",!0),o.brushMode?(N(),q("div",Wp,le(o.brushMode==="repair"?"ä¿®å¤ç¬”åˆ· (R)":"è¿˜åŸç¬”åˆ· (U)")+" - æ»šè½®è°ƒæ•´å¤§å° ",1)):de("",!0),o.isProcessing?(N(),q("div",{key:2,class:Ie(["edit-progress-container",{completed:n.value}])},[e("div",Kp,[e("span",qp,le(o.progressText),1),e("span",Hp,le(o.progressCurrent)+"/"+le(o.progressTotal),1)]),e("div",Jp,[e("div",{class:Ie(["edit-progress-fill",{animating:!n.value}]),style:at({width:d.value+"%"})},null,6)])],2)):de("",!0),s[44]||(s[44]=e("div",{class:"toolbar-spacer"},null,-1)),e("div",jp,[e("button",{class:"primary-btn",onClick:s[22]||(s[22]=r=>a.$emit("apply-and-next")),title:"åº”ç”¨æ›´æ”¹å¹¶è·³è½¬ä¸‹ä¸€å¼  (Ctrl+Enter)"}," åº”ç”¨å¹¶ä¸‹ä¸€å¼  ")])])]))}}),Gp=qe(Yp,[["__scopeId","data-v-b7164359"]]),Xp={key:0,class:"edit-thumbnails-panel"},Zp={class:"thumbnails-scroll"},Qp=["onClick"],ev=["src","alt"],tv={class:"thumb-index"},ov=He({__name:"EditThumbnailPanel",props:{visible:{type:Boolean},images:{},currentImageIndex:{}},emits:["switch-to-image"],setup(o){return(t,d)=>o.visible?(N(),q("div",Xp,[e("div",Zp,[(N(!0),q(Ke,null,je(o.images,(n,l)=>(N(),q("div",{key:n.id,class:Ie(["edit-thumbnail-item",{active:l===o.currentImageIndex}]),onClick:a=>t.$emit("switch-to-image",l)},[e("img",{src:n.translatedDataURL||n.originalDataURL,alt:`å›¾ç‰‡ ${l+1}`},null,8,ev),e("span",tv,le(l+1),1)],10,Qp))),128))])])):de("",!0)}}),nv=qe(ov,[["__scopeId","data-v-9d2a43d9"]]),sv={class:"edit-main-layout"},av={class:"image-comparison-container"},lv={class:"panel-header"},iv=["src"],rv={class:"panel-header"},uv=["src"],cv=He({__name:"EditWorkspace",props:{isEditModeActive:{type:Boolean}},emits:["exit"],setup(o,{emit:t}){const d=o,n=t,l=et(),a=dt(),{translateWithCurrentBubbles:s}=mo(),{reRenderFullImage:r}=ug({onRenderStart:()=>console.log("å¼€å§‹é‡æ–°æ¸²æŸ“..."),onRenderSuccess:Z=>console.log("æ¸²æŸ“æˆåŠŸ:",Z.substring(0,50)+"..."),onRenderError:Z=>console.error("æ¸²æŸ“å¤±è´¥:",Z)}),{isDrawingMode:x,isDrawingBox:A,currentDrawingRect:w,isMiddleButtonDown:W,handleBubbleSelect:G,handleBubbleMultiSelect:j,handleClearMultiSelect:P,handleBubbleDragStart:h,handleBubbleDragging:I,handleBubbleDragEnd:D,handleBubbleResizeStart:E,handleBubbleResizing:c,handleBubbleResizeEnd:u,handleBubbleRotateStart:y,handleBubbleRotating:b,handleBubbleRotateEnd:R,toggleDrawingMode:M,handleDrawBubble:J,getDrawingRectStyle:V,handleBubbleUpdate:U,deleteSelectedBubbles:O,repairSelectedBubble:f,handleOcrRecognize:m}=rg({onReRender:()=>r(),onDelayedPreview:()=>r()}),$=S(0),v=S(0),{brushMode:g,brushSize:k,mouseX:Y,mouseY:F,isBrushKeyDown:_,toggleBrushMode:z,exitBrushMode:T,startBrushPainting:p,continueBrushPainting:K,finishBrushPainting:i,adjustBrushSize:C}=lg({onBrushComplete:()=>r(),getCurrentRepairSettings:()=>({inpaintMethod:Pe.value,fillColor:X.value})}),{images:ie,currentImageIndex:L,currentImage:te,imageCount:ce,canGoPrevious:we,canGoNext:$e}=yt(l),{bubbles:Fe,selectedIndex:Me,selectedIndices:Be,selectedBubble:H,bubbleCount:B,hasBubbles:ne,hasSelection:oe}=yt(a),se=ee(()=>fe.value?.querySelector("img")?.naturalWidth||2e3),pe=ee(()=>fe.value?.querySelector("img")?.naturalHeight||2e3),ye=S(null),xe=S(null),fe=S(null),ve=S(null),De=S(null),_e=S(null),Le=S("dual"),Re=S("horizontal"),Xe=S(!1),ke=S(!0),ot=S(!1),it=S(!1),Pe=S("solid"),X=S("#FFFFFF"),ge=S(!1),Ve=S("å¤„ç†ä¸­..."),Ye=S(0),vt=S(0),tt=jo(),Ge=jo(),Lt=ee(()=>Ge.scale.value),cn=ee(()=>Ge.translateX.value),dn=ee(()=>Ge.translateY.value),gn=ee(()=>tt.scale.value),bt=S(null),pn=ee(()=>({transform:`translate(${tt.translateX.value}px, ${tt.translateY.value}px) scale(${tt.scale.value})`})),vn=ee(()=>({transform:`translate(${Ge.translateX.value}px, ${Ge.translateY.value}px) scale(${Ge.scale.value})`}));function bo(){Ge.zoomIn(),ke.value&&tt.setTransform(Ge.getTransform())}function fo(){Ge.zoomOut(),ke.value&&tt.setTransform(Ge.getTransform())}function ho(){Ge.resetZoom(),ke.value&&tt.setTransform(Ge.getTransform())}const Ut=S(!1),mn=S(0),Ot=S(!1),Ct=S({x:0,y:0,size:0});function zt(){g.value&&T(),Wt()}function Nt(){a.bubbles.length>0&&a.selectBubble(0)}function yo(){we.value&&(zt(),l.goToPrevious())}function Vt(){$e.value&&(zt(),l.goToNext())}function bn(Z){Z!==L.value&&Z>=0&&Z<ce.value&&(zt(),l.setCurrentImageIndex(Z))}function Wt(){if(!te.value)return;const Z=Array.isArray(te.value.bubbleStates);Fe.value.length>0?(l.updateCurrentBubbleStates([...Fe.value]),l.setManuallyAnnotated(!0),console.log("å·²ä¿å­˜æ°”æ³¡çŠ¶æ€åˆ°å½“å‰å›¾ç‰‡ï¼Œæ ‡è®°ä¸ºæ‰‹åŠ¨æ ‡æ³¨")):Z&&(l.updateCurrentBubbleStates([]),l.setManuallyAnnotated(!0),console.log("å·²ä¿å­˜ç©ºæ°”æ³¡çŠ¶æ€åˆ°å½“å‰å›¾ç‰‡ï¼ˆç”¨æˆ·ä¸»åŠ¨æ¸…ç©ºï¼Œæ ‡è®°ä¸ºæ‰‹åŠ¨æ ‡æ³¨ï¼‰"))}function wt(){te.value?.bubbleStates?(a.setBubbles([...te.value.bubbleStates],!0),console.log(`å·²åŠ è½½ ${te.value.bubbleStates.length} ä¸ªæ°”æ³¡çŠ¶æ€`)):a.clearBubblesLocal(),Nt()}function fn(){a.selectPrevious()}function hn(){a.selectNext()}function yn(){Xe.value=!Xe.value}function xn(){Re.value=Re.value==="horizontal"?"vertical":"horizontal";try{localStorage.setItem(No,Re.value)}catch(Z){console.warn("ä¿å­˜å¸ƒå±€æ¨¡å¼å¤±è´¥:",Z)}setTimeout(()=>{$t()},300)}function kn(){const Z=["dual","original","translated"],re=Z.indexOf(Le.value),ue=Z[(re+1)%Z.length];ue&&(Le.value=ue)}function _n(){ke.value=!ke.value,console.log("åŒå›¾åŒæ­¥:",ke.value?"å¼€å¯":"å…³é—­"),ke.value&&tt.setTransform(Ge.getTransform())}function $t(){const Z=ve.value||xe.value,re=De.value||fe.value;if(!Z||!re)return;const ue=re.querySelector("img");if(!ue||!ue.naturalWidth)return;const We=Z.getBoundingClientRect(),Ae=We.width/ue.naturalWidth,Te=We.height/ue.naturalHeight,Oe=Math.min(Ae,Te)*.95,Ee=(We.width-ue.naturalWidth*Oe)/2,mt=(We.height-ue.naturalHeight*Oe)/2,ft={scale:Oe,translateX:Ee,translateY:mt};Ge.setTransform(ft),tt.setTransform(ft)}function xo(Z,re){if(g.value){const Ee=Z.deltaY>0?-5:5;C(Ee);return}const ue=Z.currentTarget.getBoundingClientRect(),We=Z.clientX-ue.left,Ae=Z.clientY-ue.top,Te=Z.deltaY>0?.9:1.1,Oe=re==="original"?tt:Ge;Oe.zoomAt(We,Ae,Te),ke.value&&(re==="original"?Ge:tt).setTransform(Oe.getTransform())}function ko(Z,re){if(g.value){const ue=re==="original"?xe.value:ve.value;ue&&p(Z,ue);return}if(Z.button===1){W.value=!0,Co(Z,re),Z.preventDefault();return}if(x.value&&Z.button===0){Co(Z,re),Z.preventDefault();return}if(Z.button===0){if(Z.target.closest(".bubble-highlight-box"))return;Z.shiftKey||P(),bt.value=re,(re==="original"?tt:Ge).startDrag(Z.clientX,Z.clientY),document.addEventListener("mousemove",_o),document.addEventListener("mouseup",So),Z.preventDefault()}}function _o(Z){if(!bt.value)return;const re=bt.value==="original"?tt:Ge;re.drag(Z.clientX,Z.clientY),ke.value&&(bt.value==="original"?Ge:tt).setTransform(re.getTransform())}function So(){bt.value&&(bt.value==="original"?tt:Ge).endDrag(),bt.value=null,document.removeEventListener("mousemove",_o),document.removeEventListener("mouseup",So)}let Kt="translated";function Co(Z,re="translated"){Kt=re;const ue=re==="original"?fe.value:De.value,We=re==="original"?tt:Ge;if(!ue)return;const Ae=ue.getBoundingClientRect(),Te=(Z.clientX-Ae.left)/We.scale.value,Oe=(Z.clientY-Ae.top)/We.scale.value;$.value=Te,v.value=Oe,A.value=!0,w.value=[Te,Oe,Te,Oe],document.addEventListener("mousemove",qt),document.addEventListener("mouseup",Ht)}function qt(Z){if(!A.value)return;const re=Kt==="original"?fe.value:De.value,ue=Kt==="original"?tt:Ge;if(!re)return;const We=re.getBoundingClientRect(),Ae=(Z.clientX-We.left)/ue.scale.value,Te=(Z.clientY-We.top)/ue.scale.value;w.value=[Math.min($.value,Ae),Math.min(v.value,Te),Math.max($.value,Ae),Math.max(v.value,Te)]}function Ht(Z){document.removeEventListener("mousemove",qt),document.removeEventListener("mouseup",Ht);const re=W.value;if(!A.value||!w.value){A.value=!1,w.value=null,W.value=!1;return}const[ue,We,Ae,Te]=w.value,Oe=Ae-ue,Ee=Te-We;Oe>10&&Ee>10&&(a.addBubble(w.value),a.selectBubble(a.bubbleCount-1),console.log("å·²æ·»åŠ æ–°æ°”æ³¡:",w.value)),A.value=!1,w.value=null,W.value=!1,!re&&x.value&&(x.value=!1)}function wo(Z){console.log(`${Z} å›¾ç‰‡åŠ è½½å®Œæˆ`),Lt.value===1&&cn.value===0&&dn.value===0&&ct(()=>{$t()})}function Sn(){r()}function Cn(Z){Z.inpaintMethod!==void 0&&(Pe.value=Z.inpaintMethod),Z.fillColor!==void 0&&(X.value=Z.fillColor),Me.value>=0&&U(Z)}function wn(Z){me("æ–‡æœ¬å·²åº”ç”¨","success"),r()}function $n(Z){const re=a.initialStates[Z];if(!re){console.warn(`æ— æ³•é‡ç½®æ°”æ³¡ #${Z+1}ï¼šæ‰¾ä¸åˆ°åˆå§‹çŠ¶æ€`),me("æ— æ³•é‡ç½®ï¼šæ‰¾ä¸åˆ°åˆå§‹çŠ¶æ€","warning");return}const ue=JSON.parse(JSON.stringify(re));a.updateBubble(Z,ue),console.log(`æ°”æ³¡ #${Z+1} å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€`),me("æ°”æ³¡å·²é‡ç½®","success"),r()}async function In(Z){const re=Fe.value[Z];if(!re?.originalText){console.warn("æ— æ³•é‡æ–°ç¿»è¯‘ï¼šç¼ºå°‘æ°”æ³¡æˆ–åŸæ–‡");return}try{console.log(`å¼€å§‹é‡æ–°ç¿»è¯‘æ°”æ³¡ #${Z+1}`);const{translateSingleText:ue}=await st(async()=>{const{translateSingleText:Oe}=await Promise.resolve().then(()=>gs);return{translateSingleText:Oe}},void 0),{useSettingsStore:We}=await st(async()=>{const{useSettingsStore:Oe}=await import("./system.C6TM7-kx.js").then(Ee=>Ee.s);return{useSettingsStore:Oe}},__vite__mapDeps([0,1,2,3,4,5])),Ae=We().settings,Te=await ue({original_text:re.originalText,model_provider:Ae.translation.provider,api_key:Ae.translation.apiKey,model_name:Ae.translation.modelName,custom_base_url:Ae.translation.customBaseUrl,target_language:Ae.targetLanguage,prompt_content:Ae.translatePrompt});Te.success&&Te.data?.translated_text?(a.updateBubble(Z,{translatedText:Te.data.translated_text}),console.log(`ç¿»è¯‘æˆåŠŸ: "${Te.data.translated_text}"`),r()):console.error("ç¿»è¯‘å¤±è´¥:",Te.error||"æœªçŸ¥é”™è¯¯")}catch(ue){console.error("ç¿»è¯‘å‡ºé”™:",ue)}}function $o(Z,re){for(Z.bubbleTexts||(Z.bubbleTexts=[]),Z.originalTexts||(Z.originalTexts=[]);Z.bubbleTexts.length<re;)Z.bubbleTexts.push("");for(;Z.originalTexts.length<re;)Z.originalTexts.push("")}function Io(Z,re,ue){const We=Z.auto_directions||[];return Z.bubble_coords.map((Ae,Te)=>{const Oe=Ae[0]??0,Ee=Ae[1]??0,mt=Ae[2]??0,ft=Ae[3]??0;let gt;return We[Te]?gt=We[Te]==="v"?"vertical":"horizontal":gt=ft-Ee>mt-Oe?"vertical":"horizontal",{coords:Ae,originalText:re.originalTexts?.[Te]||"",translatedText:re.bubbleTexts?.[Te]||"",textboxText:"",fontSize:ue.fontSize,fontFamily:ue.fontFamily,textDirection:gt,autoTextDirection:gt,textColor:ue.textColor,fillColor:ue.fillColor,strokeEnabled:ue.strokeEnabled,strokeColor:ue.strokeColor,strokeWidth:ue.strokeWidth,rotationAngle:Z.bubble_angles?.[Te]||0,inpaintMethod:ue.inpaintMethod,position:{x:0,y:0},polygon:[]}})}async function Tn(){const Z=te.value;if(!Z?.originalDataURL){me("æ²¡æœ‰æœ‰æ•ˆçš„å›¾ç‰‡ç”¨äºæ£€æµ‹","warning");return}try{me("æ­£åœ¨è‡ªåŠ¨æ£€æµ‹æ–‡æœ¬æ¡†...","info");const ue=Z.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/)?.[1]||"";if(!ue){me("æ— æ³•è§£æå›¾ç‰‡æ•°æ®","error");return}const We=Je(),{textDetector:Ae,boxExpand:Te,textStyle:Oe}=We.settings,Ee=await to(ue,Ae,{box_expand_ratio:Te.ratio,box_expand_top:Te.top,box_expand_bottom:Te.bottom,box_expand_left:Te.left,box_expand_right:Te.right});if(Ee.success&&Ee.bubble_coords){l.updateCurrentImage({bubbleCoords:Ee.bubble_coords,bubbleAngles:Ee.bubble_angles||[]}),$o(Z,Ee.bubble_coords.length);const mt={bubble_coords:Ee.bubble_coords.map(gt=>[...gt]),bubble_angles:Ee.bubble_angles,auto_directions:Ee.auto_directions},ft=Io(mt,Z,Oe);a.setBubbles(ft),Nt(),me(`è‡ªåŠ¨æ£€æµ‹åˆ° ${Ee.bubble_coords.length} ä¸ªæ–‡æœ¬æ¡†`,"success")}else me(Ee.error||"æ£€æµ‹å¤±è´¥","error")}catch(re){console.error("è‡ªåŠ¨æ£€æµ‹å¤±è´¥:",re),me("è‡ªåŠ¨æ£€æµ‹å¤±è´¥","error")}}async function Dn(){if(ie.value.length<=1){me("è‡³å°‘éœ€è¦ä¸¤å¼ å›¾ç‰‡æ‰èƒ½æ‰§è¡Œæ‰¹é‡æ£€æµ‹","warning");return}if(!confirm("æ­¤æ“ä½œå°†å¯¹æ‰€æœ‰å›¾ç‰‡è¿›è¡Œæ–‡æœ¬æ¡†æ£€æµ‹ï¼Œå¯èƒ½ä¼šè¦†ç›–å·²æœ‰çš„æ£€æµ‹ç»“æœã€‚ç¡®å®šç»§ç»­å—ï¼Ÿ"))return;const Z=Je(),{textDetector:re,boxExpand:ue,textStyle:We}=Z.settings,Ae=L.value,Te=ie.value.length;ge.value=!0,Ve.value="æ‰¹é‡æ£€æµ‹ä¸­",vt.value=Te,Ye.value=0;try{let Oe=0;for(let Ee=0;Ee<Te;Ee++){const mt=ie.value[Ee];if(!mt?.originalDataURL)continue;Ye.value=Ee+1;const gt=mt.originalDataURL.match(/^data:image\/[^;]+;base64,(.+)$/)?.[1]||"";if(!gt)continue;const pt=await to(gt,re,{box_expand_ratio:ue.ratio,box_expand_top:ue.top,box_expand_bottom:ue.bottom,box_expand_left:ue.left,box_expand_right:ue.right});if(pt.success&&pt.bubble_coords){const xt=ie.value[Ee];if(xt){xt.bubbleCoords=pt.bubble_coords,xt.bubbleAngles=pt.bubble_angles||[],$o(xt,pt.bubble_coords.length);const An={bubble_coords:pt.bubble_coords.map(Fn=>[...Fn]),bubble_angles:pt.bubble_angles,auto_directions:pt.auto_directions};xt.bubbleStates=Io(An,xt,We),Oe+=pt.bubble_coords.length,Ee===L.value&&wt()}}}Ve.value="æ£€æµ‹å®Œæˆ",Ye.value=Te,Ae!==L.value&&l.setCurrentImageIndex(Ae),wt(),me(`æ‰¹é‡æ£€æµ‹å®Œæˆï¼å…±å¤„ç† ${Te} å¼ å›¾ç‰‡ï¼Œæ£€æµ‹åˆ° ${Oe} ä¸ªæ–‡æœ¬æ¡†`,"success"),setTimeout(()=>{ge.value=!1},2e3)}catch(Oe){console.error("æ‰¹é‡æ£€æµ‹å¤±è´¥:",Oe),me("æ‰¹é‡æ£€æµ‹å¤±è´¥","error"),ge.value=!1}}async function Rn(){if(!te.value?.originalDataURL){me("æ²¡æœ‰æœ‰æ•ˆçš„å›¾ç‰‡ç”¨äºç¿»è¯‘","warning");return}if(Fe.value.length===0){me("æ²¡æœ‰æ–‡æœ¬æ¡†å¯ç”¨äºç¿»è¯‘ï¼Œè¯·å…ˆæ£€æµ‹æˆ–æ·»åŠ æ–‡æœ¬æ¡†","warning");return}me("æ­£åœ¨ä½¿ç”¨å½“å‰æ–‡æœ¬æ¡†ç¿»è¯‘...","info");try{await s()&&(me("ç¿»è¯‘æˆåŠŸï¼","success"),Nt())}catch(re){console.error("ç¿»è¯‘å¤±è´¥:",re),me(`ç¿»è¯‘å¤±è´¥: ${re instanceof Error?re.message:"æœªçŸ¥é”™è¯¯"}`,"error")}}function Mn(){z("repair")}function Bn(){z("restore")}function To(Z){K(Z)}function Do(){i()}function Pn(Z){Ut.value=!0,mn.value=Re.value==="horizontal"?Z.clientX:Z.clientY,document.body.style.cursor=Re.value==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",Jt),document.addEventListener("mouseup",jt),Z.preventDefault()}function Jt(Z){if(!Ut.value)return;const re=xe.value?.parentElement?.parentElement;if(!re)return;const ue=re.getBoundingClientRect();if(Re.value==="horizontal"){const We=Z.clientX-ue.left,Ae=ue.width,Te=Math.max(20,Math.min(80,We/Ae*100)),Oe=re.querySelector(".original-panel"),Ee=re.querySelector(".translated-panel");Oe&&Ee&&(Oe.style.flex=`0 0 ${Te}%`,Ee.style.flex=`0 0 ${100-Te}%`)}else{const We=Z.clientY-ue.top,Ae=ue.height,Te=Math.max(20,Math.min(80,We/Ae*100)),Oe=re.querySelector(".original-panel"),Ee=re.querySelector(".translated-panel");Oe&&Ee&&(Oe.style.flex=`0 0 ${Te}%`,Ee.style.flex=`0 0 ${100-Te}%`)}}function jt(){Ut.value=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",Jt),document.removeEventListener("mouseup",jt)}function En(Z){Ot.value=!0;const re=_e.value;re&&(Ct.value={x:Z.clientX,y:Z.clientY,size:Re.value==="horizontal"?re.offsetWidth:re.offsetHeight},document.body.style.cursor=Re.value==="horizontal"?"ew-resize":"ns-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",Yt),document.addEventListener("mouseup",Gt),Z.preventDefault())}function Yt(Z){if(!(!Ot.value||!_e.value))if(Re.value==="horizontal"){const re=Ct.value.x-Z.clientX;let ue=Ct.value.size+re;ue=Math.max(300,Math.min(window.innerWidth*.6,ue)),_e.value.style.flex=`0 0 ${ue}px`,_e.value.style.minWidth=`${ue}px`}else{const re=Ct.value.y-Z.clientY;let ue=Ct.value.size+re;ue=Math.max(200,Math.min(window.innerHeight*.5,ue)),_e.value.style.flex=`0 0 ${ue}px`,_e.value.style.height=`${ue}px`}}function Gt(){Ot.value=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",Yt),document.removeEventListener("mouseup",Gt)}function Ro(Z){const re=Z.target,ue=Z.key.toLowerCase();if(ue==="r"||ue==="u"||ue==="a"||ue==="d"){if(re.tagName==="TEXTAREA")return;(re.tagName==="INPUT"||re.tagName==="SELECT"||re.tagName==="BUTTON")&&re.blur()}else if(re.tagName==="INPUT"||re.tagName==="TEXTAREA"||re.tagName==="SELECT")return;switch(Z.key){case"Escape":Po();break;case"Delete":case"Backspace":!g.value&&oe.value&&(O(),Z.preventDefault());break;case"a":case"A":g.value||(yo(),Z.preventDefault());break;case"d":case"D":g.value||(Vt(),Z.preventDefault());break;case"Enter":Z.ctrlKey&&!g.value&&(Bo(),Z.preventDefault());break;case"r":case"R":_.value||(z("repair"),Z.preventDefault());break;case"u":case"U":_.value||(z("restore"),Z.preventDefault());break;case"+":case"=":bo(),Z.preventDefault();break;case"-":fo(),Z.preventDefault();break;case"0":ho(),Z.preventDefault();break}}function Mo(Z){(Z.key==="r"||Z.key==="R"||Z.key==="u"||Z.key==="U")&&(T(),Z.preventDefault())}async function Bo(){Wt(),await r(),$e.value?Vt():me("å·²æ˜¯æœ€åä¸€å¼ å›¾ç‰‡","info")}function Po(){Wt(),n("exit")}return ut(()=>{try{const Z=localStorage.getItem(No);(Z==="horizontal"||Z==="vertical")&&(Re.value=Z)}catch(Z){console.warn("åŠ è½½å¸ƒå±€æ¨¡å¼å¤±è´¥:",Z)}document.addEventListener("keydown",Ro),document.addEventListener("keyup",Mo),document.addEventListener("mousemove",To),document.addEventListener("mouseup",Do),d.isEditModeActive&&(wt(),ct(()=>{ye.value?.focus()}))}),Tt(()=>{document.removeEventListener("keydown",Ro),document.removeEventListener("keyup",Mo),document.removeEventListener("mousemove",To),document.removeEventListener("mouseup",Do),document.removeEventListener("mousemove",qt),document.removeEventListener("mouseup",Ht),document.removeEventListener("mousemove",Jt),document.removeEventListener("mouseup",jt),document.removeEventListener("mousemove",Yt),document.removeEventListener("mouseup",Gt)}),he(()=>d.isEditModeActive,Z=>{Z&&(wt(),ct(()=>{ye.value?.focus()}))}),he(L,()=>{d.isEditModeActive&&wt()}),he(H,Z=>{Z&&(Pe.value=Z.inpaintMethod||"solid",X.value=Z.fillColor||"#FFFFFF")},{immediate:!0}),(Z,re)=>o.isEditModeActive?(N(),q("div",{key:0,class:Ie(["edit-workspace",[`layout-${Re.value}`,{"drawing-mode":Q(x)}]]),tabindex:"0",ref_key:"workspaceRef",ref:ye},[be(Gp,{"current-image-index":Q(L),"image-count":Q(ce),"can-go-previous":Q(we),"can-go-next":Q($e),"show-thumbnails":Xe.value,"has-bubbles":Q(ne),"selected-bubble-index":Q(Me),"bubble-count":Q(B),"layout-mode":Re.value,"sync-enabled":ke.value,scale:Lt.value,"is-drawing-mode":Q(x),"has-selection":Q(oe),"brush-mode":Q(g),"brush-size":Q(k),"mouse-x":Q(Y),"mouse-y":Q(F),"is-processing":ge.value,"progress-text":Ve.value,"progress-current":Ye.value,"progress-total":vt.value,onGoPreviousImage:yo,onGoNextImage:Vt,onToggleThumbnails:yn,onSelectPreviousBubble:fn,onSelectNextBubble:hn,onToggleLayout:xn,onToggleViewMode:kn,onToggleSync:_n,onFitToScreen:$t,onZoomIn:bo,onZoomOut:fo,onResetZoom:ho,onExitEditMode:Po,onAutoDetectBubbles:Tn,onDetectAllImages:Dn,onTranslateWithBubbles:Rn,onToggleDrawingMode:Q(M),onDeleteSelectedBubbles:Q(O),onRepairSelectedBubble:Q(f),onActivateRepairBrush:Mn,onActivateRestoreBrush:Bn,onApplyAndNext:Bo},null,8,["current-image-index","image-count","can-go-previous","can-go-next","show-thumbnails","has-bubbles","selected-bubble-index","bubble-count","layout-mode","sync-enabled","scale","is-drawing-mode","has-selection","brush-mode","brush-size","mouse-x","mouse-y","is-processing","progress-text","progress-current","progress-total","onToggleDrawingMode","onDeleteSelectedBubbles","onRepairSelectedBubble"]),be(nv,{visible:Xe.value,images:Q(ie),"current-image-index":Q(L),onSwitchToImage:bn},null,8,["visible","images","current-image-index"]),e("div",sv,[e("div",av,[ae(e("div",{class:Ie(["image-panel original-panel",{collapsed:Le.value==="translated"||ot.value}])},[e("div",lv,[re[8]||(re[8]=e("span",{class:"panel-title"},"ğŸ“– åŸå›¾ (æ—¥æ–‡)",-1)),e("button",{class:"panel-toggle",onClick:re[0]||(re[0]=ue=>ot.value=!ot.value),title:"æŠ˜å /å±•å¼€"},le(ot.value?"+":"âˆ’"),1)]),e("div",{ref_key:"originalViewportRef",ref:xe,class:"image-viewport",onWheel:re[2]||(re[2]=Ze(ue=>xo(ue,"original"),["prevent"])),onMousedown:re[3]||(re[3]=ue=>ko(ue,"original")),onDblclick:$t},[e("div",{ref_key:"originalWrapperRef",ref:fe,class:"image-canvas-wrapper",style:at(pn.value)},[Q(te)?.originalDataURL?(N(),q("img",{key:0,src:Q(te).originalDataURL,alt:"åŸå›¾",onLoad:re[1]||(re[1]=ue=>wo("original"))},null,40,iv)):de("",!0),Q(te)?.originalDataURL?(N(),lt(Yo,{key:1,bubbles:Q(Fe),"selected-index":Q(Me),"selected-indices":Q(Be),scale:gn.value,"is-drawing-mode":Q(x),"is-brush-mode":!!Q(g),"image-width":se.value,"image-height":pe.value,onSelect:Q(G),onMultiSelect:Q(j),onDragStart:Q(h),onDragging:Q(I),onDragEnd:Q(D),onResizeStart:Q(E),onResizing:Q(c),onResizeEnd:Q(u),onRotateStart:Q(y),onRotating:Q(b),onRotateEnd:Q(R),onDrawBubble:Q(J)},null,8,["bubbles","selected-index","selected-indices","scale","is-drawing-mode","is-brush-mode","image-width","image-height","onSelect","onMultiSelect","onDragStart","onDragging","onDragEnd","onResizeStart","onResizing","onResizeEnd","onRotateStart","onRotating","onRotateEnd","onDrawBubble"])):de("",!0),Q(w)?(N(),q("div",{key:2,class:"drawing-rect-edit",style:at(Q(V)())},null,4)):de("",!0)],4)],544)],2),[[Ue,Le.value!=="translated"]]),Le.value==="dual"?(N(),q("div",{key:0,class:Ie(["panel-divider",{"vertical-divider":Re.value==="vertical"}]),onMousedown:Pn},null,34)):de("",!0),ae(e("div",{class:Ie(["image-panel translated-panel",{collapsed:Le.value==="original"||it.value}])},[e("div",rv,[re[9]||(re[9]=e("span",{class:"panel-title"},"ğŸ“ ç¿»è¯‘å›¾ (ä¸­æ–‡)",-1)),e("button",{class:"panel-toggle",onClick:re[4]||(re[4]=ue=>it.value=!it.value),title:"æŠ˜å /å±•å¼€"},le(it.value?"+":"âˆ’"),1)]),e("div",{ref_key:"translatedViewportRef",ref:ve,class:"image-viewport",onWheel:re[6]||(re[6]=Ze(ue=>xo(ue,"translated"),["prevent"])),onMousedown:re[7]||(re[7]=ue=>ko(ue,"translated")),onDblclick:$t},[e("div",{ref_key:"translatedWrapperRef",ref:De,class:"image-canvas-wrapper",style:at(vn.value)},[Q(te)?.translatedDataURL||Q(te)?.originalDataURL?(N(),q("img",{key:0,src:Q(te)?.translatedDataURL||Q(te)?.originalDataURL,alt:"ç¿»è¯‘å›¾",onLoad:re[5]||(re[5]=ue=>wo("translated"))},null,40,uv)):de("",!0),Q(te)?.translatedDataURL||Q(te)?.originalDataURL?(N(),lt(Yo,{key:1,bubbles:Q(Fe),"selected-index":Q(Me),"selected-indices":Q(Be),scale:Lt.value,"is-drawing-mode":Q(x),"is-brush-mode":!!Q(g),"image-width":se.value,"image-height":pe.value,onSelect:Q(G),onMultiSelect:Q(j),onDragStart:Q(h),onDragging:Q(I),onDragEnd:Q(D),onResizeStart:Q(E),onResizing:Q(c),onResizeEnd:Q(u),onRotateStart:Q(y),onRotating:Q(b),onRotateEnd:Q(R),onDrawBubble:Q(J)},null,8,["bubbles","selected-index","selected-indices","scale","is-drawing-mode","is-brush-mode","image-width","image-height","onSelect","onMultiSelect","onDragStart","onDragging","onDragEnd","onResizeStart","onResizing","onResizeEnd","onRotateStart","onRotating","onRotateEnd","onDrawBubble"])):de("",!0),Q(w)?(N(),q("div",{key:2,class:"drawing-rect-edit translated-drawing-rect",style:at(Q(V)())},null,4)):de("",!0)],4)],544)],2),[[Ue,Le.value!=="original"]])]),e("div",{ref_key:"editPanelRef",ref:_e,class:"edit-panel-container"},[e("div",{class:"panel-resize-handle vertical",onMousedown:En}," â‹®â‹®â‹® ",32),be(_p,{bubble:Q(H),"bubble-index":Q(Me),onUpdate:Cn,onReRender:Sn,onOcrRecognize:Q(m),onReTranslate:In,onApplyBubble:wn,onResetCurrent:$n},null,8,["bubble","bubble-index","onOcrRecognize"])],512)])],2)):de("",!0)}}),dv=qe(cv,[["__scopeId","data-v-0916fb0e"]]),St="/api/web-import";async function gv(o){return(await fetch(`${St}/check-support?url=${encodeURIComponent(o)}`)).json()}async function pv(){return(await fetch(`${St}/gallery-dl-images`)).json()}async function vv(o,t,d,n,l,a="auto",s){const r=await fetch(`${St}/extract`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:o,config:t,engine:a})});if(!r.ok){const W=await r.json().catch(()=>({error:"è¯·æ±‚å¤±è´¥"}));l(W.error||`HTTP ${r.status}`);return}const x=r.body?.getReader();if(!x){l("æ— æ³•è¯»å–å“åº”æµ");return}const A=new TextDecoder;let w="";try{for(;;){const{done:W,value:G}=await x.read();if(W)break;w+=A.decode(G,{stream:!0});const j=w.split(`
`);w=j.pop()||"";let P="",h="";for(const I of j)if(I.startsWith("event:"))P=I.slice(6).trim();else if(I.startsWith("data:"))h=I.slice(5).trim();else if(I===""&&P&&h){try{const D=JSON.parse(h);P==="log"?d(D):P==="page"?s&&s(D):P==="result"?n(D):P==="error"&&l(D.error||"æœªçŸ¥é”™è¯¯")}catch(D){console.error("è§£æ SSE æ•°æ®å¤±è´¥:",D)}P="",h=""}}}finally{x.releaseLock()}}async function mv(o,t,d,n="ai-agent"){const l=await fetch(`${St}/download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pages:o,sourceUrl:t,config:d,engine:n})});if(!l.ok){const a=await l.json().catch(()=>({error:"è¯·æ±‚å¤±è´¥"}));throw new Error(a.error||`HTTP ${l.status}`)}return l.json()}async function bv(o){return(await fetch(`${St}/test-firecrawl`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:o})})).json()}async function fv(o,t,d,n){return(await fetch(`${St}/test-agent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:o,apiKey:t,customBaseUrl:d,modelName:n})})).json()}const hv={class:"modal-container"},yv={class:"modal-body"},xv={class:"url-section"},kv=["disabled"],_v=["disabled"],Sv=["disabled"],Cv={key:0,class:"loading-spinner"},wv={key:1},$v={key:0,class:"engine-hint"},Iv={key:0,class:"hint-checking"},Tv={key:1,class:"hint-supported"},Dv={key:2,class:"hint-unsupported"},Rv={class:"settings-section"},Mv={class:"settings-toggle"},Bv={key:0,class:"settings-content"},Pv={class:"settings-tabs"},Ev={class:"settings-tab-content"},Av={class:"settings-group"},Fv={class:"form-row"},Lv={class:"input-group"},Uv=["type","value"],Ov=["disabled"],zv={class:"settings-group"},Nv={class:"form-row"},Vv=["value"],Wv=["value"],Kv={class:"form-row"},qv={class:"input-group"},Hv=["type","value"],Jv={key:0,class:"form-row"},jv=["value"],Yv={class:"form-row"},Gv=["value"],Xv={class:"form-row inline"},Zv={class:"checkbox-label"},Qv=["checked"],em={class:"checkbox-label"},tm=["checked"],om={class:"form-row"},nm=["disabled"],sm={class:"settings-group"},am={class:"form-row"},lm=["value"],im={class:"form-row"},rm=["value"],um={class:"settings-group"},cm={class:"form-grid"},dm={class:"form-row"},gm=["value"],pm={class:"form-row"},vm=["value"],mm={class:"form-row"},bm=["value"],fm={class:"form-row"},hm=["value"],ym={class:"form-row"},xm={class:"checkbox-label"},km=["checked"],_m={class:"settings-group"},Sm={class:"form-row inline"},Cm={class:"checkbox-label"},wm=["checked"],$m={class:"checkbox-label"},Im=["checked"],Tm={class:"settings-tab-content"},Dm={class:"settings-group"},Rm={class:"form-row"},Mm={class:"checkbox-label"},Bm=["checked"],Pm={class:"form-row"},Em={class:"checkbox-label"},Am=["checked"],Fm={class:"form-row"},Lm={class:"checkbox-label"},Um=["checked"],Om={key:0,class:"form-grid"},zm={class:"form-row"},Nm=["value"],Vm={class:"form-row"},Wm=["value"],Km={class:"form-row"},qm=["value"],Hm={class:"form-row"},Jm={class:"checkbox-label"},jm=["checked"],Ym={key:1,class:"form-row"},Gm=["value"],Xm={class:"settings-tab-content"},Zm={class:"settings-group"},Qm={class:"form-row"},eb=["value"],tb={class:"form-row"},ob=["value"],nb={class:"form-row"},sb={class:"checkbox-label"},ab=["checked"],lb={key:1,class:"logs-section"},ib={class:"logs-toggle"},rb={key:0,class:"extracting-hint"},ub={key:0,class:"logs-content"},cb={class:"log-time"},db={class:"log-message"},gb={key:2,class:"error-section"},pb={class:"error-message"},vb={key:3,class:"result-section"},mb={class:"result-header"},bb={class:"result-title"},fb={class:"result-meta"},hb={class:"result-count"},yb={key:0,class:"result-engine"},xb={class:"select-control"},kb={class:"select-all"},_b=["checked"],Sb={class:"selected-count"},Cb={class:"image-grid"},wb=["onClick"],$b={class:"image-checkbox"},Ib=["checked","onChange"],Tb={class:"image-preview"},Db=["src","alt"],Rb={class:"image-label"},Mb={key:4,class:"progress-section"},Bb={class:"progress-label"},Pb={class:"progress-bar"},Eb={class:"modal-footer"},Ab=["disabled"],Fb=["disabled"],Lb={key:0,class:"loading-spinner"},Ub={key:1},Ob=He({__name:"WebImportModal",setup(o){const t=sn(),d=et(),n=S(""),l=S(!0),a=S("auto"),s=S(!1),r=S(!1),x=S(!1),A=S(!1),w=S("basic"),W=S(!1),G=S(!1),j=S(!1),P=S(!1),h=ee(()=>t.modalVisible),I=ee(()=>t.status),D=ee(()=>t.logs),E=ee(()=>t.extractResult),c=ee(()=>t.selectedPages),u=ee(()=>t.selectedCount),y=ee(()=>t.downloadProgress),b=ee(()=>t.downloadProgressPercent),R=ee(()=>t.error),M=ee(()=>t.isProcessing),J=ee(()=>t.settings.ui.showAgentLogs),V=ee(()=>E.value?.engine||null),U=ee(()=>{switch(V.value){case"gallery-dl":return"Gallery-DL";case"ai-agent":return"AI Agent";default:return""}}),O=ee(()=>E.value?.pages?u.value===E.value.pages.length:!1);function f(K){return V.value==="gallery-dl",K}let m=null;async function $(K){if(m&&clearTimeout(m),!K.trim()){s.value=!1,r.value=!1;return}m=setTimeout(async()=>{x.value=!0;try{const i=await gv(K);s.value=i.available,r.value=i.supported}catch{s.value=!1,r.value=!1}finally{x.value=!1}},500)}function v(){M.value&&!confirm("æ­£åœ¨å¤„ç†ä¸­ï¼Œç¡®å®šè¦å…³é—­å—ï¼Ÿ")||(t.closeModal(),t.resetState(),n.value="")}async function g(){const K=n.value.trim();if(!K){alert("è¯·è¾“å…¥ç½‘å€");return}try{new URL(K)}catch{alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€");return}t.resetState(),t.setUrl(K),t.setStatus("extracting");try{await vv(K,t.settings,i=>{t.addLog(i)},i=>{t.setExtractResult(i),i.success?t.setStatus("extracted"):t.setError(i.error||"æå–å¤±è´¥")},i=>{t.setError(i)},a.value,i=>{t.addPageIncremental(i)})}catch(i){t.setError(i instanceof Error?i.message:"æå–å¤±è´¥")}}function k(K){t.togglePageSelection(K)}function Y(){t.toggleSelectAll()}async function F(){if(!E.value?.pages||u.value===0){alert("è¯·é€‰æ‹©è¦å¯¼å…¥çš„å›¾ç‰‡");return}const K=E.value.pages.filter(C=>c.value.has(C.pageNumber));t.setStatus("downloading"),t.updateDownloadProgress(0,K.length);const i=V.value||"ai-agent";try{if(i==="gallery-dl"){const ie=await pv();if(ie.success&&ie.images.length>0){let L=0;const te=Math.min(ie.images.length,K.length);for(let ce=0;ce<te;ce++){const we=ie.images[ce];we&&we.filename&&we.data&&(d.addImage(we.filename,we.data),L++,t.updateDownloadProgress(L,te))}t.setStatus("completed"),alert(`æˆåŠŸå¯¼å…¥ ${L} å¼ å›¾ç‰‡`),v();return}else throw new Error(ie.error||"è·å–å›¾ç‰‡å¤±è´¥")}const C=await mv(K,E.value.sourceUrl,t.settings,i);if(C.success&&C.images.length>0){t.setDownloadedImages(C.images),t.updateDownloadProgress(C.images.length,K.length);for(const L of C.images)d.addImage(L.filename,L.dataUrl);t.setStatus("completed");const ie=C.failedCount>0?`ï¼Œ${C.failedCount} å¼ å¤±è´¥`:"";alert(`æˆåŠŸå¯¼å…¥ ${C.images.length} å¼ å›¾ç‰‡${ie}`),v()}else t.setError(C.error||"ä¸‹è½½å¤±è´¥")}catch(C){t.setError(C instanceof Error?C.message:"ä¸‹è½½å¤±è´¥")}}he(h,K=>{K&&setTimeout(()=>{document.querySelector(".url-input")?.focus()},100)}),he(n,K=>{$(K)});const _=ee(()=>t.settings.agent.provider==="custom_openai");async function z(){if(!t.settings.firecrawl.apiKey){alert("è¯·è¾“å…¥ Firecrawl API Key");return}W.value=!0;try{const K=await bv(t.settings.firecrawl.apiKey);K.success?alert("âœ… Firecrawl è¿æ¥æˆåŠŸ"):alert(`âŒ è¿æ¥å¤±è´¥: ${K.error}`)}catch(K){alert(`âŒ è¿æ¥å¤±è´¥: ${K instanceof Error?K.message:"æœªçŸ¥é”™è¯¯"}`)}finally{W.value=!1}}async function T(){if(!t.settings.agent.apiKey){alert("è¯·è¾“å…¥ AI Agent API Key");return}G.value=!0;try{const K=await fv(t.settings.agent.provider,t.settings.agent.apiKey,t.settings.agent.customBaseUrl,t.settings.agent.modelName);K.success?alert("âœ… AI Agent è¿æ¥æˆåŠŸ"):alert(`âŒ è¿æ¥å¤±è´¥: ${K.error}`)}catch(K){alert(`âŒ è¿æ¥å¤±è´¥: ${K instanceof Error?K.message:"æœªçŸ¥é”™è¯¯"}`)}finally{G.value=!1}}function p(){confirm("ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯å—ï¼Ÿ")&&t.resetExtractionPrompt()}return(K,i)=>(N(),lt(Jn,{to:"body"},[h.value?(N(),q("div",{key:0,class:"modal-overlay",onClick:Ze(v,["self"])},[e("div",hv,[e("div",{class:"modal-header"},[i[37]||(i[37]=e("h2",{class:"modal-title"},[e("span",{class:"title-icon"},"ğŸŒ"),Se(" ä»ç½‘é¡µå¯¼å…¥æ¼«ç”» ")],-1)),e("button",{class:"close-btn",onClick:v,title:"å…³é—­"},"Ã—")]),e("div",yv,[e("div",xv,[ae(e("input",{"onUpdate:modelValue":i[0]||(i[0]=C=>n.value=C),type:"url",class:"url-input",placeholder:"è¾“å…¥æ¼«ç”»ç½‘é¡µ URLï¼Œå¦‚ https://example.com/chapter-1",disabled:M.value,onKeyup:qn(g,["enter"])},null,40,kv),[[Ce,n.value]]),ae(e("select",{"onUpdate:modelValue":i[1]||(i[1]=C=>a.value=C),class:"engine-select",disabled:M.value},[...i[38]||(i[38]=[e("option",{value:"auto"},"è‡ªåŠ¨é€‰æ‹©",-1),e("option",{value:"gallery-dl"},"Gallery-DL",-1),e("option",{value:"ai-agent"},"AI Agent",-1)])],8,_v),[[Hn,a.value]]),e("button",{class:"extract-btn",disabled:M.value||!n.value.trim(),onClick:g},[I.value==="extracting"?(N(),q("span",Cv)):(N(),q("span",wv,"ğŸ”")),Se(" "+le(I.value==="extracting"?"æå–ä¸­...":"å¼€å§‹æå–"),1)],8,Sv)]),n.value.trim()&&!M.value?(N(),q("div",$v,[x.value?(N(),q("span",Iv,"æ£€æŸ¥ä¸­...")):r.value?(N(),q("span",Tv,"âœ“ è¯¥ç½‘ç«™æ”¯æŒ Gallery-DL é«˜é€Ÿä¸‹è½½")):s.value?(N(),q("span",Dv,"è¯¥ç½‘ç«™å°†ä½¿ç”¨ AI Agent æ¨¡å¼")):de("",!0)])):de("",!0),i[80]||(i[80]=e("div",{class:"notice"}," âš ï¸ è¯·ä»…çˆ¬å–æ‚¨æœ‰æƒè®¿é—®çš„å†…å®¹ï¼Œå¹¶éµå®ˆç›®æ ‡ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾ã€‚ ",-1)),e("div",Rv,[e("div",{class:"settings-header",onClick:i[2]||(i[2]=C=>A.value=!A.value)},[e("span",Mv,le(A.value?"â–¼":"â–¶"),1),i[39]||(i[39]=e("span",{class:"settings-title"},"âš™ï¸ è®¾ç½®",-1)),i[40]||(i[40]=e("span",{class:"settings-hint"},"ç‚¹å‡»å±•å¼€é…ç½®",-1))]),A.value?(N(),q("div",Bv,[e("div",Pv,[e("button",{class:Ie(["settings-tab",{active:w.value==="basic"}]),onClick:i[3]||(i[3]=C=>w.value="basic")}," åŸºæœ¬è®¾ç½® ",2),e("button",{class:Ie(["settings-tab",{active:w.value==="preprocess"}]),onClick:i[4]||(i[4]=C=>w.value="preprocess")}," å›¾ç‰‡é¢„å¤„ç† ",2),e("button",{class:Ie(["settings-tab",{active:w.value==="advanced"}]),onClick:i[5]||(i[5]=C=>w.value="advanced")}," é«˜çº§è®¾ç½® ",2)]),ae(e("div",Ev,[e("div",Av,[i[42]||(i[42]=e("h4",{class:"group-title"},"Firecrawl é…ç½®",-1)),e("div",Fv,[i[41]||(i[41]=e("label",{class:"form-label"},"API Key",-1)),e("div",Lv,[e("input",{type:j.value?"text":"password",class:"form-input",value:Q(t).settings.firecrawl.apiKey,onInput:i[6]||(i[6]=C=>Q(t).setFirecrawlApiKey(C.target.value)),placeholder:"fc-xxxxxxxxxxxxxxxx"},null,40,Uv),e("button",{class:"toggle-btn",onClick:i[7]||(i[7]=C=>j.value=!j.value)},le(j.value?"ğŸ‘":"ğŸ‘â€ğŸ—¨"),1),e("button",{class:"test-btn",disabled:W.value||!Q(t).settings.firecrawl.apiKey,onClick:z},le(W.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),9,Ov)])])]),e("div",zv,[i[49]||(i[49]=e("h4",{class:"group-title"},"AI Agent é…ç½®",-1)),e("div",Nv,[i[43]||(i[43]=e("label",{class:"form-label"},"æœåŠ¡å•†",-1)),e("select",{class:"form-select",value:Q(t).settings.agent.provider,onChange:i[8]||(i[8]=C=>Q(t).setAgentProvider(C.target.value))},[(N(!0),q(Ke,null,je(Q(Wn),C=>(N(),q("option",{key:C.value,value:C.value},le(C.label),9,Wv))),128))],40,Vv)]),e("div",Kv,[i[44]||(i[44]=e("label",{class:"form-label"},"API Key",-1)),e("div",qv,[e("input",{type:P.value?"text":"password",class:"form-input",value:Q(t).settings.agent.apiKey,onInput:i[9]||(i[9]=C=>Q(t).setAgentApiKey(C.target.value)),placeholder:"sk-xxxxxxxxxxxxxxxx"},null,40,Hv),e("button",{class:"toggle-btn",onClick:i[10]||(i[10]=C=>P.value=!P.value)},le(P.value?"ğŸ‘":"ğŸ‘â€ğŸ—¨"),1)])]),_.value?(N(),q("div",Jv,[i[45]||(i[45]=e("label",{class:"form-label"},"è‡ªå®šä¹‰ API åœ°å€",-1)),e("input",{type:"url",class:"form-input",value:Q(t).settings.agent.customBaseUrl,onInput:i[11]||(i[11]=C=>Q(t).setAgentBaseUrl(C.target.value)),placeholder:"https://api.example.com/v1"},null,40,jv)])):de("",!0),e("div",Yv,[i[46]||(i[46]=e("label",{class:"form-label"},"æ¨¡å‹åç§°",-1)),e("input",{type:"text",class:"form-input",value:Q(t).settings.agent.modelName,onInput:i[12]||(i[12]=C=>Q(t).setAgentModelName(C.target.value)),placeholder:"gpt-4o-mini"},null,40,Gv)]),e("div",Xv,[e("label",Zv,[e("input",{type:"checkbox",checked:Q(t).settings.agent.forceJsonOutput,onChange:i[13]||(i[13]=C=>Q(t).setAgentForceJson(C.target.checked))},null,40,Qv),i[47]||(i[47]=Se(" å¼ºåˆ¶ JSON æ ¼å¼ ",-1))]),e("label",em,[e("input",{type:"checkbox",checked:Q(t).settings.agent.useStream,onChange:i[14]||(i[14]=C=>Q(t).setAgentUseStream(C.target.checked))},null,40,tm),i[48]||(i[48]=Se(" æµå¼è°ƒç”¨ ",-1))])]),e("div",om,[e("button",{class:"test-btn full",disabled:G.value||!Q(t).settings.agent.apiKey,onClick:T},le(G.value?"æµ‹è¯•ä¸­...":"æµ‹è¯• Agent è¿æ¥"),9,nm)])]),e("div",sm,[e("h4",{class:"group-title"},[i[50]||(i[50]=Se(" æå–è®¾ç½® ",-1)),e("button",{class:"reset-btn",onClick:p},"é‡ç½®ä¸ºé»˜è®¤")]),e("div",am,[i[51]||(i[51]=e("label",{class:"form-label"},"æå–æç¤ºè¯",-1)),e("textarea",{class:"form-textarea",value:Q(t).settings.extraction.prompt,onInput:i[15]||(i[15]=C=>Q(t).setExtractionPrompt(C.target.value)),rows:"6",placeholder:"è¾“å…¥æå–æç¤ºè¯..."},null,40,lm)]),e("div",im,[i[52]||(i[52]=e("label",{class:"form-label"},"æœ€å¤§è¿­ä»£æ¬¡æ•°",-1)),e("input",{type:"number",class:"form-input small",value:Q(t).settings.extraction.maxIterations,onInput:i[16]||(i[16]=C=>Q(t).setExtractionMaxIterations(Number(C.target.value))),min:"1",max:"20"},null,40,rm)])]),e("div",um,[i[58]||(i[58]=e("h4",{class:"group-title"},"ä¸‹è½½è®¾ç½®",-1)),e("div",cm,[e("div",dm,[i[53]||(i[53]=e("label",{class:"form-label"},"å¹¶å‘æ•°",-1)),e("input",{type:"number",class:"form-input small",value:Q(t).settings.download.concurrency,onInput:i[17]||(i[17]=C=>Q(t).setDownloadConcurrency(Number(C.target.value))),min:"1",max:"10"},null,40,gm)]),e("div",pm,[i[54]||(i[54]=e("label",{class:"form-label"},"è¶…æ—¶ (ç§’)",-1)),e("input",{type:"number",class:"form-input small",value:Q(t).settings.download.timeout,onInput:i[18]||(i[18]=C=>Q(t).setDownloadTimeout(Number(C.target.value))),min:"5",max:"120"},null,40,vm)]),e("div",mm,[i[55]||(i[55]=e("label",{class:"form-label"},"é‡è¯•æ¬¡æ•°",-1)),e("input",{type:"number",class:"form-input small",value:Q(t).settings.download.retries,onInput:i[19]||(i[19]=C=>Q(t).setDownloadRetries(Number(C.target.value))),min:"0",max:"5"},null,40,bm)]),e("div",fm,[i[56]||(i[56]=e("label",{class:"form-label"},"ä¸‹è½½é—´éš” (ms)",-1)),e("input",{type:"number",class:"form-input small",value:Q(t).settings.download.delay,onInput:i[20]||(i[20]=C=>Q(t).setDownloadDelay(Number(C.target.value))),min:"0",max:"2000",step:"100"},null,40,hm)])]),e("div",ym,[e("label",xm,[e("input",{type:"checkbox",checked:Q(t).settings.download.useReferer,onChange:i[21]||(i[21]=C=>Q(t).setDownloadUseReferer(C.target.checked))},null,40,km),i[57]||(i[57]=Se(" è‡ªåŠ¨æ·»åŠ  Referer ",-1))])])]),e("div",_m,[i[61]||(i[61]=e("h4",{class:"group-title"},"ç•Œé¢è®¾ç½®",-1)),e("div",Sm,[e("label",Cm,[e("input",{type:"checkbox",checked:Q(t).settings.ui.showAgentLogs,onChange:i[22]||(i[22]=C=>Q(t).setShowAgentLogs(C.target.checked))},null,40,wm),i[59]||(i[59]=Se(" æ˜¾ç¤º AI å·¥ä½œæ—¥å¿— ",-1))]),e("label",$m,[e("input",{type:"checkbox",checked:Q(t).settings.ui.autoImport,onChange:i[23]||(i[23]=C=>Q(t).setAutoImport(C.target.checked))},null,40,Im),i[60]||(i[60]=Se(" æå–åè‡ªåŠ¨å¯¼å…¥ ",-1))])])])],512),[[Ue,w.value==="basic"]]),ae(e("div",Tm,[e("div",Dm,[e("div",Rm,[e("label",Mm,[e("input",{type:"checkbox",checked:Q(t).settings.imagePreprocess.enabled,onChange:i[24]||(i[24]=C=>Q(t).setImagePreprocessEnabled(C.target.checked))},null,40,Bm),i[62]||(i[62]=Se(" å¯ç”¨å›¾ç‰‡é¢„å¤„ç† ",-1))])]),Q(t).settings.imagePreprocess.enabled?(N(),q(Ke,{key:0},[e("div",Pm,[e("label",Em,[e("input",{type:"checkbox",checked:Q(t).settings.imagePreprocess.autoRotate,onChange:i[25]||(i[25]=C=>Q(t).setImageAutoRotate(C.target.checked))},null,40,Am),i[63]||(i[63]=Se(" æ ¹æ® EXIF è‡ªåŠ¨æ—‹è½¬ ",-1))])]),i[71]||(i[71]=e("h5",{class:"subsection-title"},"å‹ç¼©è®¾ç½®",-1)),e("div",Fm,[e("label",Lm,[e("input",{type:"checkbox",checked:Q(t).settings.imagePreprocess.compression.enabled,onChange:i[26]||(i[26]=C=>Q(t).setImageCompressionEnabled(C.target.checked))},null,40,Um),i[64]||(i[64]=Se(" å¯ç”¨å‹ç¼© ",-1))])]),Q(t).settings.imagePreprocess.compression.enabled?(N(),q("div",Om,[e("div",zm,[i[65]||(i[65]=e("label",{class:"form-label"},"è´¨é‡ (0-100)",-1)),e("input",{type:"number",class:"form-input small",value:Q(t).settings.imagePreprocess.compression.quality,onInput:i[27]||(i[27]=C=>Q(t).setImageCompressionQuality(Number(C.target.value))),min:"1",max:"100"},null,40,Nm)]),e("div",Vm,[i[66]||(i[66]=e("label",{class:"form-label"},"æœ€å¤§å®½åº¦ (0=ä¸é™)",-1)),e("input",{type:"number",class:"form-input small",value:Q(t).settings.imagePreprocess.compression.maxWidth,onInput:i[28]||(i[28]=C=>Q(t).setImageMaxWidth(Number(C.target.value))),min:"0"},null,40,Wm)]),e("div",Km,[i[67]||(i[67]=e("label",{class:"form-label"},"æœ€å¤§é«˜åº¦ (0=ä¸é™)",-1)),e("input",{type:"number",class:"form-input small",value:Q(t).settings.imagePreprocess.compression.maxHeight,onInput:i[29]||(i[29]=C=>Q(t).setImageMaxHeight(Number(C.target.value))),min:"0"},null,40,qm)])])):de("",!0),i[72]||(i[72]=e("h5",{class:"subsection-title"},"æ ¼å¼è½¬æ¢",-1)),e("div",Hm,[e("label",Jm,[e("input",{type:"checkbox",checked:Q(t).settings.imagePreprocess.formatConvert.enabled,onChange:i[30]||(i[30]=C=>Q(t).setImageFormatConvertEnabled(C.target.checked))},null,40,jm),i[68]||(i[68]=Se(" å¯ç”¨æ ¼å¼è½¬æ¢ ",-1))])]),Q(t).settings.imagePreprocess.formatConvert.enabled?(N(),q("div",Ym,[i[70]||(i[70]=e("label",{class:"form-label"},"ç›®æ ‡æ ¼å¼",-1)),e("select",{class:"form-select",value:Q(t).settings.imagePreprocess.formatConvert.targetFormat,onChange:i[31]||(i[31]=C=>Q(t).setImageTargetFormat(C.target.value))},[...i[69]||(i[69]=[e("option",{value:"original"},"ä¿æŒåŸæ ¼å¼",-1),e("option",{value:"jpeg"},"JPEG",-1),e("option",{value:"png"},"PNG",-1),e("option",{value:"webp"},"WebP",-1)])],40,Gm)])):de("",!0)],64)):de("",!0)])],512),[[Ue,w.value==="preprocess"]]),ae(e("div",Xm,[e("div",Zm,[i[76]||(i[76]=e("h4",{class:"group-title"},"è‡ªå®šä¹‰è¯·æ±‚å¤´",-1)),e("div",Qm,[i[73]||(i[73]=e("label",{class:"form-label"},"Cookie",-1)),e("input",{type:"text",class:"form-input",value:Q(t).settings.advanced.customCookie,onInput:i[32]||(i[32]=C=>Q(t).setCustomCookie(C.target.value)),placeholder:"name=value; name2=value2"},null,40,eb)]),e("div",tb,[i[74]||(i[74]=e("label",{class:"form-label"},"Headers (JSON)",-1)),e("textarea",{class:"form-textarea",value:Q(t).settings.advanced.customHeaders,onInput:i[33]||(i[33]=C=>Q(t).setCustomHeaders(C.target.value)),rows:"3",placeholder:'{"X-Custom-Header": "value"}'},null,40,ob)]),e("div",nb,[e("label",sb,[e("input",{type:"checkbox",checked:Q(t).settings.advanced.bypassProxy,onChange:i[34]||(i[34]=C=>Q(t).setBypassProxy(C.target.checked))},null,40,ab),i[75]||(i[75]=Se(" ç»•è¿‡ç³»ç»Ÿä»£ç† (è¿æ¥æœ¬åœ°æœåŠ¡æ—¶ä½¿ç”¨) ",-1))])])])],512),[[Ue,w.value==="advanced"]])])):de("",!0)]),J.value&&D.value.length>0?(N(),q("div",lb,[e("div",{class:"logs-header",onClick:i[35]||(i[35]=C=>l.value=!l.value)},[e("span",ib,le(l.value?"â–¼":"â–¶"),1),i[77]||(i[77]=e("span",null,"AI å·¥ä½œæ—¥å¿—",-1)),I.value==="extracting"?(N(),q("span",rb,"(æå–ä¸­...)")):de("",!0)]),l.value?(N(),q("div",ub,[(N(!0),q(Ke,null,je(D.value,(C,ie)=>(N(),q("div",{key:ie,class:Ie(["log-item",`log-${C.type}`])},[e("span",cb,"["+le(C.timestamp)+"]",1),e("span",db,le(C.message),1)],2))),128))])):de("",!0)])):de("",!0),R.value?(N(),q("div",gb,[i[78]||(i[78]=e("span",{class:"error-icon"},"âŒ",-1)),e("span",pb,le(R.value),1)])):de("",!0),E.value?.success?(N(),q("div",vb,[e("div",mb,[e("span",bb," ğŸ“– ã€Š"+le(E.value.comicTitle)+"ã€‹- "+le(E.value.chapterTitle),1),e("span",fb,[e("span",hb,"å…± "+le(E.value.totalPages)+" å¼ ",1),U.value?(N(),q("span",yb,"| å¼•æ“: "+le(U.value),1)):de("",!0)])]),e("div",xb,[e("label",kb,[e("input",{type:"checkbox",checked:O.value,onChange:Y},null,40,_b),i[79]||(i[79]=Se(" å…¨é€‰ ",-1))]),e("span",Sb,"å·²é€‰: "+le(u.value)+" å¼ ",1)]),e("div",Cb,[(N(!0),q(Ke,null,je(E.value.pages,C=>(N(),q("div",{key:C.pageNumber,class:Ie(["image-item",{selected:c.value.has(C.pageNumber)}]),onClick:ie=>k(C.pageNumber)},[e("div",$b,[e("input",{type:"checkbox",checked:c.value.has(C.pageNumber),onClick:i[36]||(i[36]=Ze(()=>{},["stop"])),onChange:ie=>k(C.pageNumber)},null,40,Ib)]),e("div",Tb,[e("img",{src:f(C.imageUrl),alt:`ç¬¬${C.pageNumber}é¡µ`,loading:"lazy"},null,8,Db)]),e("div",Rb,"ç¬¬ "+le(C.pageNumber)+" é¡µ",1)],10,wb))),128))])])):de("",!0),I.value==="downloading"?(N(),q("div",Mb,[e("div",Bb," ä¸‹è½½è¿›åº¦: "+le(y.value.current)+"/"+le(y.value.total),1),e("div",Pb,[e("div",{class:"progress-fill",style:at({width:`${b.value}%`})},null,4)])])):de("",!0)]),e("div",Eb,[e("button",{class:"cancel-btn",onClick:v,disabled:I.value==="downloading"}," å–æ¶ˆ ",8,Ab),e("button",{class:"import-btn",disabled:!E.value?.success||u.value===0||M.value,onClick:F},[I.value==="downloading"?(N(),q("span",Lb)):(N(),q("span",Ub,"ğŸ“¥")),Se(" "+le(I.value==="downloading"?"ä¸‹è½½ä¸­...":"å¯¼å…¥"),1)],8,Fb)])])])):de("",!0)]))}}),zb=qe(Ob,[["__scopeId","data-v-78fc5cb0"]]),Nb={class:"app-header"},Vb={class:"header-content"},Wb={class:"logo-container"},Kb={class:"header-links"},qb={class:"container"},Hb={id:"image-display-area"},Jb={id:"upload-section",class:"card upload-card"},jb={class:"upload-actions"},Yb={key:1,class:"bookshelf-mode-hint"},Gb=He({__name:"TranslateView",setup(o){const t=Zo(),d=et(),n=Je(),l=nn(),a=dt(),{validateBeforeTranslation:s,initValidation:r}=Ft(),x=mo(),A=$l(),w=S(!1),W=S(void 0),G=S(!1),j=S(!1),P=S(null),h=S(null),I=ee(()=>d.currentImage),D=ee(()=>d.hasImages);ee(()=>d.imageCount),ee(()=>d.currentImageIndex+1),ee(()=>D.value&&!d.isBatchTranslationInProgress),ee(()=>d.canGoPrevious),ee(()=>d.canGoNext);const E=ee(()=>d.isBatchTranslationInProgress);ee(()=>d.isBatchTranslationPaused);const c=ee(()=>E.value&&!x.isHqTranslating.value&&!x.isProofreading.value);ee(()=>{if(!E.value)return 0;const H=d.completedImageCount,B=d.imageCount;return B>0?Math.round(H/B*100):0}),ee(()=>`${d.completedImageCount}/${d.imageCount}`);const u=ee(()=>d.failedImageCount>0),y=ee(()=>!!t.query.book&&!!t.query.chapter),b=ee(()=>t.query.book),R=ee(()=>t.query.chapter),M=ee(()=>A.currentBookTitle.value),J=ee(()=>A.currentChapterTitle.value),V=ee(()=>y.value&&J.value&&M.value?`${J.value} - ${M.value}`:"Saber-Translator");ut(async()=>{d.clearImages(),a.clearBubbles(),await A.initializeApp(),r(),window.addEventListener("keydown",$e)}),Tt(()=>{window.removeEventListener("keydown",$e)}),he(()=>[t.query.book,t.query.chapter],async([H,B],[ne,oe])=>{H&&B?(d.clearImages(),a.clearBubbles(),await U()):ne&&oe&&!H&&!B&&(d.clearImages(),a.clearBubbles(),await A.initializeBookChapterContext(),console.log("[TranslateView] ä»ä¹¦æ¶æ¨¡å¼åˆ‡æ¢åˆ°å¿«é€Ÿç¿»è¯‘æ¨¡å¼ï¼Œå·²æ¸…ç©ºæ•°æ®"))}),he(V,H=>{typeof document<"u"&&(document.title=H)},{immediate:!0});async function U(){if(!(!b.value||!R.value))try{await A.initializeBookChapterContext()}catch(H){console.error("åŠ è½½ç« èŠ‚ä¼šè¯å¤±è´¥:",H),me("åŠ è½½ç« èŠ‚ä¼šè¯å¤±è´¥","error")}}function O(H){console.log(`ä¸Šä¼ å®Œæˆï¼Œå…± ${H} å¼ å›¾ç‰‡`),d.hasImages&&(d.sortImagesByFileName(),A.switchImage(0))}async function f(H){const B=I.value;if(!B||!B.bubbleStates||B.bubbleStates.length===0){me("è¯·å…ˆé€‰æ‹©ä¸€å¼ å·²ç¿»è¯‘çš„å›¾ç‰‡","warning");return}if(d.images.length<=1){me("åªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œæ— éœ€åº”ç”¨åˆ°å…¨éƒ¨","info");return}if(!Object.values(H).some(oe=>oe)){me("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè¦åº”ç”¨çš„è®¾ç½®é¡¹","warning");return}try{const oe=B.bubbleStates[0],se={};H.fontSize&&(se.fontSize=oe.fontSize),H.fontFamily&&(se.fontFamily=oe.fontFamily),H.layoutDirection&&(se.textDirection=oe.textDirection==="auto"?"vertical":oe.textDirection),H.textColor&&(se.textColor=oe.textColor),H.fillColor&&(se.fillColor=oe.fillColor),H.strokeEnabled&&(se.strokeEnabled=oe.strokeEnabled),H.strokeColor&&(se.strokeColor=oe.strokeColor),H.strokeWidth&&(se.strokeWidth=oe.strokeWidth);const pe=De=>{const _e={...De};return H.fontSize&&se.fontSize!==void 0&&(_e.fontSize=se.fontSize),H.fontFamily&&se.fontFamily!==void 0&&(_e.fontFamily=se.fontFamily),H.layoutDirection&&se.textDirection!==void 0&&(_e.textDirection=se.textDirection),H.textColor&&se.textColor!==void 0&&(_e.textColor=se.textColor),H.fillColor&&se.fillColor!==void 0&&(_e.fillColor=se.fillColor),H.strokeEnabled&&se.strokeEnabled!==void 0&&(_e.strokeEnabled=se.strokeEnabled),H.strokeColor&&se.strokeColor!==void 0&&(_e.strokeColor=se.strokeColor),H.strokeWidth&&se.strokeWidth!==void 0&&(_e.strokeWidth=se.strokeWidth),_e};let ye=0;const xe=d.images;for(let De=0;De<xe.length;De++){const _e=xe[De];if(_e&&_e.bubbleStates&&_e.bubbleStates.length>0){const Le=_e.bubbleStates.map(pe);d.updateImageByIndex(De,{bubbleStates:Le}),ye++}}if(a.bubbles.length>0){const De=a.bubbles.map(pe);a.setBubbles(De)}const fe=[];H.fontSize&&fe.push("å­—å·"),H.fontFamily&&fe.push("å­—ä½“"),H.layoutDirection&&fe.push("æ’ç‰ˆæ–¹å‘"),H.textColor&&fe.push("æ–‡å­—é¢œè‰²"),H.fillColor&&fe.push("å¡«å……é¢œè‰²"),H.strokeEnabled&&fe.push("æè¾¹å¼€å…³"),H.strokeColor&&fe.push("æè¾¹é¢œè‰²"),H.strokeWidth&&fe.push("æè¾¹å®½åº¦");const ve=[];for(let De=0;De<xe.length;De++){const _e=xe[De];_e&&_e.translatedDataURL&&_e.bubbleStates&&_e.bubbleStates.length>0&&ve.push(De)}if(ve.length>0){const{apiClient:De}=await st(async()=>{const{apiClient:Re}=await import("./client.Bht704G-.js");return{apiClient:Re}},__vite__mapDeps([4,5])),_e=n.settings.textStyle.layoutDirection,Le=_e==="auto";for(let Re=0;Re<ve.length;Re++){const Xe=ve[Re];if(Xe===void 0)continue;const ke=d.images[Xe];if(!(!ke||!ke.bubbleStates))try{let ot="";if(ke.cleanImageData?ot=ke.cleanImageData.includes("base64,")?ke.cleanImageData.split("base64,")[1]||"":ke.cleanImageData:ke.originalDataURL&&(ot=ke.originalDataURL.includes("base64,")?ke.originalDataURL.split("base64,")[1]||"":ke.originalDataURL,console.log(`handleApplyToAll: å›¾ç‰‡ ${Xe} ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰`)),!ot){console.log(`handleApplyToAll: å›¾ç‰‡ ${Xe} æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡`);continue}const it=ke.bubbleStates.map(X=>({translatedText:X.translatedText||"",coords:X.coords,fontSize:X.fontSize||n.settings.textStyle.fontSize,fontFamily:X.fontFamily||n.settings.textStyle.fontFamily,textDirection:_t(X),textColor:X.textColor||n.settings.textStyle.textColor,rotationAngle:X.rotationAngle||0,position:X.position||{x:0,y:0},strokeEnabled:X.strokeEnabled??n.settings.textStyle.strokeEnabled,strokeColor:X.strokeColor||n.settings.textStyle.strokeColor,strokeWidth:X.strokeWidth??n.settings.textStyle.strokeWidth})),Pe=await De.post("/api/re_render_image",{clean_image:ot,bubble_texts:it.map(X=>X.translatedText),bubble_coords:it.map(X=>X.coords),fontSize:n.settings.textStyle.fontSize,fontFamily:n.settings.textStyle.fontFamily,textDirection:Le?"vertical":_e,textColor:n.settings.textStyle.textColor,bubble_states:it,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,strokeEnabled:n.settings.textStyle.strokeEnabled,strokeColor:n.settings.textStyle.strokeColor,strokeWidth:n.settings.textStyle.strokeWidth});Pe.rendered_image&&d.updateImageByIndex(Xe,{translatedDataURL:`data:image/png;base64,${Pe.rendered_image}`,hasUnsavedChanges:!0})}catch(ot){console.error(`é‡æ¸²æŸ“å›¾ç‰‡ ${Xe} å¤±è´¥:`,ot)}}}me(`å·²å°† ${fe.join("ã€")} åº”ç”¨åˆ° ${ye} å¼ å›¾ç‰‡`,"success"),console.log(`[TranslateView] åº”ç”¨è®¾ç½®åˆ°å…¨éƒ¨å®Œæˆï¼Œæ›´æ–°äº† ${ye} å¼ å›¾ç‰‡ï¼Œé‡æ¸²æŸ“äº† ${ve.length} å¼ `)}catch(oe){console.error("åº”ç”¨è®¾ç½®åˆ°å…¨éƒ¨å¤±è´¥:",oe),me("åº”ç”¨è®¾ç½®å¤±è´¥","error")}}async function m(){I.value&&s("normal")&&await x.translateCurrentImage()}async function $(){D.value&&s("normal")&&await x.translateAllImages()}async function v(){D.value&&s("hq")&&await x.executeHqTranslation()}async function g(){D.value&&s("proofread")&&await x.executeProofreading()}async function k(){I.value&&await x.removeTextOnly()}async function Y(){D.value&&await x.removeAllTexts()}function F(){if(!I.value)return;const H=I.value.fileName||`å›¾ç‰‡ ${d.currentImageIndex+1}`;confirm(`ç¡®å®šè¦åˆ é™¤å½“å‰å›¾ç‰‡ (${H}) å—ï¼Ÿ`)&&(d.deleteCurrentImage(),me("å›¾ç‰‡å·²åˆ é™¤","success"))}function _(){D.value&&confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å›¾ç‰‡å—ï¼Ÿè¿™å°†ä¸¢å¤±æ‰€æœ‰æœªä¿å­˜çš„è¿›åº¦ã€‚")&&(d.clearImages(),me("æ‰€æœ‰å›¾ç‰‡å·²æ¸…é™¤","success"))}async function z(){try{const H=await Qo(),B=await ro();if(H.success&&B.success)me("ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ","success");else{const ne=[];H.success||ne.push("è°ƒè¯•æ–‡ä»¶æ¸…ç†å¤±è´¥"),B.success||ne.push("ä¸´æ—¶æ–‡ä»¶æ¸…ç†å¤±è´¥"),me(ne.join("ï¼Œ"),"warning")}}catch{me("æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥","error")}}function T(){A.goToPrevious()}function p(){A.goToNext()}function K(){j.value=!j.value}async function i(){if(!u.value){me("æ²¡æœ‰å¤±è´¥çš„å›¾ç‰‡éœ€è¦é‡æ–°ç¿»è¯‘","info");return}s("normal")&&await x.retryFailedImages()}async function C(){if(!D.value){me("æ²¡æœ‰å¯ä¿å­˜çš„å†…å®¹","warning");return}if(!(!b.value||!R.value))try{await l.saveChapterSession(b.value,R.value)?me("ç« èŠ‚è¿›åº¦å·²ä¿å­˜","success"):me("ä¿å­˜å¤±è´¥","error")}catch(H){console.error("ä¿å­˜ä¼šè¯å¤±è´¥:",H),me("ä¿å­˜å¤±è´¥: "+(H instanceof Error?H.message:"æœªçŸ¥é”™è¯¯"),"error")}}function ie(H){W.value=H,w.value=!0}function L(){ie("plugins")}function te(){me("è®¾ç½®å·²ä¿å­˜","success")}function ce(){G.value=!0}function we(){me("ğŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}function $e(H){const B=H.target;if(!(B instanceof HTMLInputElement||B instanceof HTMLTextAreaElement||B.getAttribute("contenteditable")==="true"||B.id==="bubbleTextEditor")&&!j.value&&H.altKey)switch(H.key){case"ArrowLeft":H.preventDefault(),T();break;case"ArrowRight":H.preventDefault(),p();break;case"ArrowUp":if(H.preventDefault(),!n.settings.textStyle.autoFontSize){const oe=n.settings.textStyle.fontSize;n.updateTextStyle({fontSize:oe+1})}break;case"ArrowDown":if(H.preventDefault(),!n.settings.textStyle.autoFontSize){const oe=n.settings.textStyle.fontSize;n.updateTextStyle({fontSize:Math.max(10,oe-1)})}break}}async function Fe(H){const B=I.value;if(!B||!B.translatedDataURL){console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${H} (ä»…å½±å“ä¸‹æ¬¡ç¿»è¯‘)`);return}const ne=B.bubbleStates;if(!ne||!Array.isArray(ne)||ne.length===0){console.log("å½“å‰å›¾ç‰‡æ²¡æœ‰ bubbleStatesï¼Œè·³è¿‡é‡æ¸²æŸ“");return}if(console.log(`è‡ªåŠ¨å­—å·è®¾ç½®å˜æ›´: ${H}ï¼Œå°†é‡æ–°æ¸²æŸ“...`),H){console.log("è‡ªåŠ¨å­—å·å·²å¼€å¯ï¼Œé‡æ–°è®¡ç®—å­—å·å¹¶æ¸²æŸ“...");try{const{apiClient:oe}=await st(async()=>{const{apiClient:ve}=await import("./client.Bht704G-.js");return{apiClient:ve}},__vite__mapDeps([4,5]));let se="";if(B.cleanImageData){const ve=B.cleanImageData;se=ve.includes("base64,")?ve.split("base64,")[1]||"":ve}else B.originalDataURL&&(se=B.originalDataURL.includes("base64,")?B.originalDataURL.split("base64,")[1]||"":B.originalDataURL);if(!se){console.log("æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const pe=ne.map(ve=>({translatedText:ve.translatedText||"",coords:ve.coords,fontSize:ve.fontSize||n.settings.textStyle.fontSize,fontFamily:ve.fontFamily||n.settings.textStyle.fontFamily,textDirection:_t(ve),textColor:ve.textColor||n.settings.textStyle.textColor,rotationAngle:ve.rotationAngle||0,position:ve.position||{x:0,y:0},strokeEnabled:ve.strokeEnabled??n.settings.textStyle.strokeEnabled,strokeColor:ve.strokeColor||n.settings.textStyle.strokeColor,strokeWidth:ve.strokeWidth??n.settings.textStyle.strokeWidth})),ye=pe.map(ve=>ve.translatedText),xe=pe.map(ve=>ve.coords),fe=await oe.post("/api/re_render_image",{clean_image:se,bubble_texts:ye,bubble_coords:xe,fontSize:n.settings.textStyle.fontSize,fontFamily:n.settings.textStyle.fontFamily,textDirection:n.settings.textStyle.layoutDirection==="auto"?"vertical":n.settings.textStyle.layoutDirection,textColor:n.settings.textStyle.textColor,bubble_states:pe,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,autoFontSize:!0,strokeEnabled:n.settings.textStyle.strokeEnabled,strokeColor:n.settings.textStyle.strokeColor,strokeWidth:n.settings.textStyle.strokeWidth});if(fe.rendered_image){if(fe.bubble_states&&Array.isArray(fe.bubble_states)){const ve=ne.map((De,_e)=>({...De,fontSize:fe.bubble_states[_e]?.fontSize??De.fontSize}));d.updateCurrentImage({translatedDataURL:`data:image/png;base64,${fe.rendered_image}`,bubbleStates:ve,hasUnsavedChanges:!0}),a.setBubbles(ve)}else d.updateCurrentImage({translatedDataURL:`data:image/png;base64,${fe.rendered_image}`,hasUnsavedChanges:!0});console.log("è‡ªåŠ¨å­—å·æ¸²æŸ“æˆåŠŸ")}else fe.error&&(console.error("è‡ªåŠ¨å­—å·æ¸²æŸ“å¤±è´¥:",fe.error),me("é‡æ–°æ¸²æŸ“å¤±è´¥: "+fe.error,"error"))}catch(oe){console.error("è‡ªåŠ¨å­—å·æ¸²æŸ“å‡ºé”™:",oe)}}else{const oe=n.settings.textStyle.fontSize;console.log(`è‡ªåŠ¨å­—å·å·²å…³é—­ï¼Œä½¿ç”¨å›ºå®šå­—å· ${oe} æ¸²æŸ“...`);const se=ne.map(pe=>({...pe,fontSize:oe}));d.updateCurrentImage({bubbleStates:se}),a.setBubbles(se),await Me("fontSize",oe)}}async function Me(H,B){const ne=I.value;if(!ne||!ne.translatedDataURL||!ne.bubbleStates||ne.bubbleStates.length===0||!["fontSize","fontFamily","layoutDirection","textColor","strokeEnabled","strokeColor","strokeWidth","fillColor"].includes(H))return;console.log(`å…¨å±€è®¾ç½®å˜æ›´ (${H}=${B})ï¼Œå‡†å¤‡é‡æ¸²æŸ“...`);const pe={fontSize:"fontSize",fontFamily:"fontFamily",layoutDirection:"textDirection",textColor:"textColor",strokeEnabled:"strokeEnabled",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fillColor:"fillColor"}[H];if(pe&&ne.bubbleStates)if(H==="layoutDirection"&&B==="auto")console.log("æ’ç‰ˆæ–¹å‘è®¾ç½®ä¸º 'auto'ï¼Œä¸ä¿®æ”¹æ°”æ³¡çš„ textDirectionï¼Œä½¿ç”¨ autoTextDirection æ¸²æŸ“");else{const ye=ne.bubbleStates.map(xe=>({...xe,[pe]:B}));d.updateCurrentImage({bubbleStates:ye}),a.setBubbles(ye)}try{const xe=d.currentImage?.bubbleStates||ne.bubbleStates||[];if(xe.length===0||!xe[0]?.coords){console.log("æ²¡æœ‰æœ‰æ•ˆçš„æ°”æ³¡åæ ‡ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const fe=n.settings.textStyle.layoutDirection,ve=xe.map(ke=>({translatedText:ke.translatedText||"",coords:ke.coords,fontSize:ke.fontSize||n.settings.textStyle.fontSize,fontFamily:ke.fontFamily||n.settings.textStyle.fontFamily,textDirection:_t(ke),textColor:ke.textColor||n.settings.textStyle.textColor,rotationAngle:ke.rotationAngle||0,position:ke.position||{x:0,y:0},strokeEnabled:ke.strokeEnabled??n.settings.textStyle.strokeEnabled,strokeColor:ke.strokeColor||n.settings.textStyle.strokeColor,strokeWidth:ke.strokeWidth??n.settings.textStyle.strokeWidth})),De=ve.map(ke=>ke.translatedText),_e=ve.map(ke=>ke.coords);let Le="";if(ne.cleanImageData){const ke=ne.cleanImageData;Le=ke.includes("base64,")?ke.split("base64,")[1]||"":ke}else ne.originalDataURL&&(Le=ne.originalDataURL.includes("base64,")?ne.originalDataURL.split("base64,")[1]||"":ne.originalDataURL,console.log("handleTextStyleChanged: ä½¿ç”¨åŸå›¾ä½œä¸ºèƒŒæ™¯ï¼ˆå…œåº•ï¼‰"));if(!Le){console.log("æ²¡æœ‰å¯ç”¨çš„èƒŒæ™¯å›¾ï¼Œè·³è¿‡é‡æ¸²æŸ“");return}const{apiClient:Re}=await st(async()=>{const{apiClient:ke}=await import("./client.Bht704G-.js");return{apiClient:ke}},__vite__mapDeps([4,5])),Xe=await Re.post("/api/re_render_image",{clean_image:Le,bubble_texts:De,bubble_coords:_e,fontSize:n.settings.textStyle.fontSize,fontFamily:n.settings.textStyle.fontFamily,textDirection:fe==="auto"?"vertical":fe,textColor:n.settings.textStyle.textColor,bubble_states:ve,use_individual_styles:!0,use_inpainting:!1,use_lama:!1,fillColor:null,is_font_style_change:!0,strokeEnabled:n.settings.textStyle.strokeEnabled,strokeColor:n.settings.textStyle.strokeColor,strokeWidth:n.settings.textStyle.strokeWidth});Xe.rendered_image?(d.updateCurrentImage({translatedDataURL:`data:image/png;base64,${Xe.rendered_image}`,hasUnsavedChanges:!0}),console.log("è®¾ç½®å˜æ›´åé‡æ–°æ¸²æŸ“æˆåŠŸ")):Xe.error&&console.error("é‡æ–°æ¸²æŸ“å¤±è´¥:",Xe.error)}catch(ye){console.error("è®¾ç½®å˜æ›´åé‡æ–°æ¸²æŸ“å¤±è´¥:",ye)}}function Be(H){A.switchImage(H)}return(H,B)=>{const ne=jn("router-link");return N(),q("div",{class:Ie(["translate-page",{"edit-mode-active":j.value}])},[e("header",Nb,[e("div",Vb,[e("div",Wb,[be(ne,{to:"/",title:"è¿”å›ä¹¦æ¶"},{default:ht(()=>[...B[3]||(B[3]=[e("img",{src:"/pic/logo.png",alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",Kb,[be(ne,{to:"/",class:"back-to-shelf",title:"è¿”å›ä¹¦æ¶"},{default:ht(()=>[...B[4]||(B[4]=[Se("ğŸ“š",-1)])]),_:1}),y.value?(N(),q("button",{key:0,class:"save-header-btn",title:"ä¿å­˜è¿›åº¦",onClick:C}," ğŸ’¾ ")):de("",!0),e("button",{id:"openSettingsBtn",class:"settings-header-btn",title:"æ‰“å¼€è®¾ç½®",onClick:B[0]||(B[0]=oe=>ie())},[...B[5]||(B[5]=[e("span",{class:"icon"},"âš™ï¸",-1),e("span",null,"è®¾ç½®",-1)])]),B[8]||(B[8]=e("a",{href:"http://www.mashirosaber.top",target:"_blank",class:"tutorial-link"},"ä½¿ç”¨æ•™ç¨‹",-1)),e("a",{href:"javascript:void(0)",class:"donate-link",onClick:ce},[...B[6]||(B[6]=[e("span",null,"â¤ï¸ è¯·ä½œè€…å–å¥¶èŒ¶",-1)])]),B[9]||(B[9]=e("a",{href:"https://github.com/MashiroSaber03",target:"_blank",class:"github-link"},[e("img",{src:"/pic/github.jpg",alt:"GitHub",class:"github-icon"})],-1)),e("button",{class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:we},[...B[7]||(B[7]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("div",qb,[be(Ua,{onTranslateCurrent:m,onTranslateAll:$,onHqTranslate:v,onProofread:g,onRemoveText:k,onRemoveAllText:Y,onRetryFailed:i,onDeleteCurrent:F,onClearAll:_,onCleanTemp:z,onOpenPlugins:L,onOpenSettings:ie,onPrevious:T,onNext:p,onApplyToAll:f,onTextStyleChanged:Me,onAutoFontSizeChanged:Fe}),e("main",Hb,[e("section",Jb,[e("div",jb,[be(Fs,{ref_key:"imageUploadRef",ref:P,onUploadComplete:O},null,512)]),Q(l).loadingProgress.total>0?(N(),lt(po,{key:0,visible:!0,percentage:Q(l).loadingProgress.current/Q(l).loadingProgress.total*100,label:Q(l).loadingProgress.message},null,8,["percentage","label"])):de("",!0),be(El,{progress:Q(x).progress.value,"show-controls":c.value},null,8,["progress","show-controls"]),E.value&&y.value?(N(),q("div",Yb,[...B[10]||(B[10]=[e("span",{style:{color:"#888","font-size":"0.85em"}}," ï¼ˆä¹¦æ¶æ¨¡å¼ä¸‹é€€å‡ºå‰è¯·ç‚¹å‡»é¡¶éƒ¨ä¿å­˜æŒ‰é’®ï¼‰ ",-1)])])):de("",!0)]),be(il,{ref_key:"imageResultRef",ref:h,"is-edit-mode":j.value,onToggleEditMode:K,onRetryFailed:i},null,8,["is-edit-mode"])]),D.value&&!j.value?(N(),lt(Hl,{key:0,onSelect:Be})):de("",!0)]),I.value&&j.value?(N(),lt(dv,{key:0,"is-edit-mode-active":j.value,onExit:K},null,8,["is-edit-mode-active"])):de("",!0),be(gl,{onOpenSettings:ie}),be(sg,{modelValue:w.value,"onUpdate:modelValue":B[1]||(B[1]=oe=>w.value=oe),"initial-tab":W.value,onSave:te},null,8,["modelValue","initial-tab"]),G.value?(N(),lt(Fl,{key:1,onClose:B[2]||(B[2]=oe=>G.value=!1)})):de("",!0),be(zb)],2)}}}),lf=qe(Gb,[["__scopeId","data-v-0fdfe9d9"]]);export{lf as default};
