import{d as Me,r as c,c as d}from"./vue-vendor.DDJbHApa.js";import{getBooks as Oe,getTags as Ee,createBook as Ke,updateBook as Le,deleteBook as j,createTag as _e,deleteTag as Qe,createChapter as be,updateChapter as je,deleteChapter as ze,reorderChapters as Re,addTagsToBook as qe,removeTagsFromBook as Ge}from"./bookshelf.Do7F4bT8.js";const Ne="/static/vue/pic/logo.png",Pe=Me("bookshelf",()=>{const s=c([]),v=c([]),i=c(""),l=c([]),g=c("updatedAt"),h=c("desc"),B=c(!1),a=c(new Set),u=c(null),k=c(null),m=c(!1),w=c(null),p=d(()=>{let e=[...s.value];if(i.value.trim()){const t=i.value.toLowerCase().trim();e=e.filter(o=>{const n=o.title.toLowerCase().includes(t),r=o.description?.toLowerCase().includes(t)||!1;return n||r})}return l.value.length>0&&(e=e.filter(t=>!t.tags||t.tags.length===0?!1:l.value.every(o=>t.tags?.includes(o)))),e.sort((t,o)=>{let n=0;switch(g.value){case"title":n=t.title.localeCompare(o.title);break;case"createdAt":n=new Date(t.createdAt).getTime()-new Date(o.createdAt).getTime();break;case"updatedAt":n=new Date(t.updatedAt).getTime()-new Date(o.updatedAt).getTime();break}return h.value==="asc"?n:-n}),e}),z=d(()=>s.value.length),R=d(()=>p.value.length),q=d(()=>a.value.size),x=d(()=>p.value.length===0?!1:p.value.every(e=>a.value.has(e.id))),G=d(()=>u.value&&s.value.find(e=>e.id===u.value)||null),H=d(()=>k.value&&s.value.find(e=>e.id===k.value)||null),J=d(()=>a.value),N=d(()=>i.value);function S(e){s.value=e,console.log(`书籍列表已设置，共 ${e.length} 本书`)}function F(e){s.value.unshift(e),console.log(`已添加书籍: ${e.title}`)}function D(e,t){const o=s.value.findIndex(n=>n.id===e);if(o>=0){const n=s.value[o];n&&(s.value[o]={...n,...t},console.log(`已更新书籍: ${e}`))}}function y(e){const t=s.value.findIndex(o=>o.id===e);t>=0&&(s.value.splice(t,1),a.value.delete(e),u.value===e&&(u.value=null),console.log(`已删除书籍: ${e}`))}function P(e){for(const t of e)y(t);console.log(`已批量删除 ${e.length} 本书`)}function U(e){return s.value.find(t=>t.id===e)||null}function M(e,t){const o=s.value.find(n=>n.id===e);o&&(o.chapters||(o.chapters=[]),o.chapters.push(t),console.log(`已添加章节到书籍 ${e}: ${t.title}`))}function O(e,t,o){const n=s.value.find(r=>r.id===e);if(n&&n.chapters){const r=n.chapters.find(f=>f.id===t);r&&(Object.assign(r,o),console.log(`已更新章节: ${t}`))}}function E(e,t){const o=s.value.find(n=>n.id===e);if(o&&o.chapters){const n=o.chapters.findIndex(r=>r.id===t);n>=0&&(o.chapters.splice(n,1),console.log(`已删除章节: ${t}`))}}function K(e,t){const o=s.value.find(n=>n.id===e);if(o&&o.chapters){const n=[];for(let r=0;r<t.length;r++){const f=o.chapters.find(De=>De.id===t[r]);f&&(f.order=r,n.push(f))}o.chapters=n,console.log(`已重新排序章节: ${e}`)}}function L(e){v.value=e,console.log(`标签列表已设置，共 ${e.length} 个标签`)}function _(e){v.value.push(e),console.log(`已添加标签: ${e.name}`)}function Q(e){const t=v.value.findIndex(o=>o.id===e);if(t>=0){v.value.splice(t,1);const o=l.value.indexOf(e);o>=0&&l.value.splice(o,1),console.log(`已删除标签: ${e}`)}}function $(e,t){const o=s.value.find(n=>n.id===e);o&&(o.tags||(o.tags=[]),o.tags.includes(t)||(o.tags.push(t),console.log(`已为书籍 ${e} 添加标签 ${t}`)))}function C(e,t){const o=s.value.find(n=>n.id===e);if(o&&o.tags){const n=o.tags.indexOf(t);n>=0&&(o.tags.splice(n,1),console.log(`已从书籍 ${e} 移除标签 ${t}`))}}function V(e,t){for(const o of e)for(const n of t)$(o,n);console.log(`已批量添加标签到 ${e.length} 本书`)}function W(e,t){for(const o of e)for(const n of t)C(o,n);console.log(`已批量从 ${e.length} 本书移除标签`)}function X(e){i.value=e}function Y(){i.value=""}function Z(e){const t=l.value.indexOf(e);t>=0?l.value.splice(t,1):l.value.push(e)}function I(e){l.value=e}function ee(){l.value=[]}function te(e,t="desc"){g.value=e,h.value=t}function oe(){B.value=!0,a.value.clear(),console.log("已进入批量操作模式")}function ne(){B.value=!1,a.value.clear(),console.log("已退出批量操作模式")}function re(e){a.value.has(e)?a.value.delete(e):a.value.add(e)}function se(){if(x.value)a.value.clear();else for(const e of p.value)a.value.add(e.id)}function ae(){return Array.from(a.value)}function le(e){u.value=e}function ce(){u.value=null}function ue(e){u.value===e?u.value=null:u.value=e}function A(e){m.value=e}function T(e){w.value=e}function ie(e){k.value=e}function fe(e){a.value.add(e)}function de(e){a.value.delete(e)}function ve(){a.value.clear()}function pe(e){i.value=e}async function b(){A(!0),T(null);try{const e={};i.value.trim()&&(e.search=i.value.trim()),l.value.length>0&&(e.tags=l.value);const t=await Oe(e);t.success&&t.books?S(t.books):T(t.error||"加载书籍失败")}catch(e){T(e instanceof Error?e.message:"加载书籍失败"),console.error("加载书籍失败:",e)}finally{A(!1)}}async function ge(){try{const e=await Ee();e.success&&e.tags&&L(e.tags)}catch(e){console.error("加载标签失败:",e)}}async function he(e,t,o,n){try{const r=await Ke(e,t,o,n);return r.success&&r.book?(F(r.book),r.book):null}catch(r){return console.error("创建书籍失败:",r),null}}async function Be(e,t){try{const o=await Le(e,t);return o.success&&o.book?(D(e,o.book),!0):!1}catch(o){return console.error("更新书籍失败:",o),!1}}async function ke(e){try{return(await j(e)).success?(y(e),!0):!1}catch(t){return console.error("删除书籍失败:",t),!1}}async function ye(e){try{for(const t of e)await j(t),y(t);return!0}catch(t){return console.error("批量删除书籍失败:",t),!1}}async function Te(e,t){try{const o=await _e(e,t);return o.success&&o.tag?(_(o.tag),o.tag):null}catch(o){return console.error("创建标签失败:",o),null}}async function me(e){try{return(await Qe(e)).success?(Q(e),!0):!1}catch(t){return console.error("删除标签失败:",t),!1}}async function we(e,t){try{const o=await be(e,t);return o.success&&o.chapter?(M(e,o.chapter),o.chapter):null}catch(o){return console.error("创建章节失败:",o),null}}async function $e(e,t,o){try{return(await je(e,t,o)).success?(O(e,t,{title:o}),!0):!1}catch(n){return console.error("更新章节失败:",n),!1}}async function Ce(e,t){try{return(await ze(e,t)).success?(E(e,t),!0):!1}catch(o){return console.error("删除章节失败:",o),!1}}async function Ae(e,t){try{return(await Re(e,t)).success?(K(e,t),!0):!1}catch(o){return console.error("重新排序章节失败:",o),!1}}async function xe(e,t){try{if((await qe(e,t)).success){for(const n of t){const r=v.value.find(f=>f.id===n);r&&$(e,r.name)}return!0}return!1}catch(o){return console.error("添加标签失败:",o),!1}}async function Se(e,t){try{if((await Ge(e,t)).success){for(const n of t){const r=v.value.find(f=>f.id===n);r&&C(e,r.name)}return!0}return!1}catch(o){return console.error("移除标签失败:",o),!1}}function Fe(){s.value=[],v.value=[],i.value="",l.value=[],g.value="updatedAt",h.value="desc",B.value=!1,a.value.clear(),u.value=null,m.value=!1,w.value=null,console.log("书架状态已重置")}return{books:s,tags:v,searchKeyword:i,selectedTagIds:l,sortBy:g,sortOrder:h,batchMode:B,selectedBookIds:a,expandedBookId:u,currentBookId:k,isLoading:m,error:w,filteredBooks:p,bookCount:z,filteredBookCount:R,selectedBookCount:q,isAllSelected:x,expandedBook:G,currentBook:H,selectedBooks:J,searchQuery:N,setBooks:S,addBook:F,updateBook:D,deleteBook:y,deleteBooks:P,getBookById:U,addChapter:M,updateChapter:O,deleteChapter:E,reorderChapters:K,setTags:L,addTag:_,deleteTag:Q,addTagToBook:$,removeTagFromBook:C,batchAddTags:V,batchRemoveTags:W,setSearchKeyword:X,clearSearchKeyword:Y,setSearchQuery:pe,toggleTagFilter:Z,setTagFilter:I,clearTagFilter:ee,setSort:te,enterBatchMode:oe,exitBatchMode:ne,toggleBookSelection:re,toggleSelectAll:se,getSelectedBookIds:ae,selectBook:fe,deselectBook:de,clearSelection:ve,expandBook:le,collapseBook:ce,toggleBookExpand:ue,setCurrentBook:ie,setLoading:A,setError:T,loadBooks:b,fetchBooks:b,loadTags:ge,createBook:he,updateBookApi:Be,deleteBookApi:ke,batchDeleteBooks:ye,createTag:Te,deleteTagApi:me,createChapterApi:we,updateChapterApi:$e,deleteChapterApi:Ce,reorderChaptersApi:Ae,addTagsToBookApi:xe,removeTagsFromBookApi:Se,reset:Fe}});export{Ne as _,Pe as u};
