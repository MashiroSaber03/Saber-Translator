import{a as G,c as k,l as V,o as O,I as z,i as f,v as H,e,F as L,j as F,h as C,t as $,r as b,y as J,E as K,n as P,x as Y,f as M,C as j}from"./vue-vendor.BToK7iAN.js";import{getBookDetail as q,getChapterImages as U}from"./bookshelf.C_zUWUVG.js";import{_ as W,u as Q,e as X}from"./index.D0MSxQDE.js";import"./client.Bht704G-.js";import"./utils-vendor.B9ygI19o.js";const Z={class:"reader-main"},ee={key:0,id:"loadingState",class:"loading-state"},te={key:1,id:"emptyState",class:"empty-state"},ae={key:2,id:"imagesContainer",class:"images-container"},ne=["src","alt"],oe={class:"image-index"},se=G({__name:"ReaderCanvas",props:{images:{},viewMode:{},isLoading:{type:Boolean}},emits:["pageChange","goTranslate"],setup(p,{emit:r}){const c=p,v=r,w=k(()=>!c.isLoading&&c.images.length===0),o=k(()=>!c.isLoading&&c.images.length>0);function g(i){return c.viewMode==="translated"&&i.translated||i.original}function y(){const i=document.querySelectorAll(".reader-image-wrapper"),l=window.innerHeight/2;let u=1;i.forEach((m,T)=>{const S=m.getBoundingClientRect();S.top<l&&S.bottom>0&&(u=T+1)}),v("pageChange",u)}function h(){y()}function _(){v("goTranslate")}return V(()=>{window.addEventListener("scroll",h)}),O(()=>{window.removeEventListener("scroll",h)}),z(()=>c.images,()=>{setTimeout(y,100)},{deep:!0}),(i,l)=>(C(),f("main",Z,[p.isLoading?(C(),f("div",ee,[...l[0]||(l[0]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"æ­£åœ¨åŠ è½½...",-1)])])):w.value?(C(),f("div",te,[l[1]||(l[1]=e("div",{class:"empty-icon"},"ğŸ“–",-1)),l[2]||(l[2]=e("h2",null,"æš‚æ— å›¾ç‰‡",-1)),l[3]||(l[3]=e("p",null,"è¯¥ç« èŠ‚è¿˜æ²¡æœ‰å›¾ç‰‡ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹ç¿»è¯‘",-1)),e("button",{id:"goTranslateBtn",class:"btn btn-primary",onClick:_}," è¿›å…¥ç¿»è¯‘ ")])):o.value?(C(),f("div",ae,[(C(!0),f(L,null,F(p.images,(u,m)=>(C(),f("div",{key:m,class:"reader-image-wrapper"},[e("img",{class:"reader-image",src:g(u),alt:`ç¬¬ ${m+1} é¡µ`,loading:"lazy"},null,8,ne),e("div",oe,$(m+1)+" / "+$(p.images.length),1)]))),128))])):H("",!0)]))}}),ie=W(se,[["__scopeId","data-v-8201cb7c"]]),le={key:0,id:"chapterNav",class:"chapter-nav"},re=["disabled"],de=["disabled"],ce={class:"settings-content"},ue={class:"settings-body"},ge={class:"setting-item"},pe={class:"setting-control"},ve=["value"],he={id:"imageWidthValue"},me={class:"setting-item"},be={class:"setting-control"},fe=["value"],Ce={id:"imageGapValue"},we={class:"setting-item"},ke={class:"setting-control bg-options"},ye=["data-bg","title","onClick"],A="readerSettings",_e=G({__name:"ReaderControls",props:{currentPage:{},totalPages:{},hasPrevChapter:{type:Boolean},hasNextChapter:{type:Boolean},showChapterNav:{type:Boolean}},emits:["navigateChapter","settingsChange"],setup(p,{expose:r,emit:c}){const v=p,w=c,o=b({imageWidth:100,imageGap:8,bgColor:"#1a1a2e"}),g=b(!1),y=b(!1),h=[{color:"#1a1a2e",name:"æ·±è“"},{color:"#ffffff",name:"ç™½è‰²"},{color:"#f5f5dc",name:"ç±³è‰²"},{color:"#2d2d2d",name:"æ·±ç°"}];k(()=>v.totalPages===0?"- / -":`${v.currentPage} / ${v.totalPages}`);function _(){g.value=!0}function i(){g.value=!1}function l(){window.scrollTo({top:0,behavior:"smooth"})}function u(){const s=window.scrollY;y.value=s>500}function m(s){switch(s.key){case"Escape":i();break;case"ArrowLeft":v.hasPrevChapter&&w("navigateChapter","prev");break;case"ArrowRight":v.hasNextChapter&&w("navigateChapter","next");break;case"Home":window.scrollTo({top:0,behavior:"smooth"});break;case"End":window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"});break}}function T(){const s=localStorage.getItem(A);if(s)try{const t=JSON.parse(s);o.value={...o.value,...t}}catch(t){console.error("åŠ è½½é˜…è¯»è®¾ç½®å¤±è´¥:",t)}I()}function S(){localStorage.setItem(A,JSON.stringify(o.value))}function I(){document.body.style.background=o.value.bgColor,document.documentElement.style.setProperty("--reader-image-width",`${o.value.imageWidth}%`),document.documentElement.style.setProperty("--reader-gap",`${o.value.imageGap}px`),w("settingsChange",o.value)}function x(s){o.value.imageWidth=s,I(),S()}function B(s){o.value.imageGap=s,I(),S()}function N(s){o.value.bgColor=s,I(),S()}function E(s){w("navigateChapter",s)}return V(()=>{T(),window.addEventListener("scroll",u),document.addEventListener("keydown",m)}),O(()=>{window.removeEventListener("scroll",u),document.removeEventListener("keydown",m)}),r({openSettings:_,closeSettings:i,settings:o}),(s,t)=>(C(),f(L,null,[p.showChapterNav?(C(),f("nav",le,[e("button",{id:"prevChapterBtn",class:"nav-btn",disabled:!p.hasPrevChapter,onClick:t[0]||(t[0]=d=>E("prev"))},[...t[4]||(t[4]=[e("span",{class:"nav-icon"},"â—€",-1),e("span",{class:"nav-text"},"ä¸Šä¸€ç« ",-1)])],8,re),e("button",{id:"nextChapterBtn",class:"nav-btn",disabled:!p.hasNextChapter,onClick:t[1]||(t[1]=d=>E("next"))},[...t[5]||(t[5]=[e("span",{class:"nav-text"},"ä¸‹ä¸€ç« ",-1),e("span",{class:"nav-icon"},"â–¶",-1)])],8,de)])):H("",!0),J(e("button",{id:"scrollTopBtn",class:"scroll-top-btn",title:"å›åˆ°é¡¶éƒ¨",onClick:l},[...t[6]||(t[6]=[e("span",null,"â†‘",-1)])],512),[[K,y.value]]),e("div",{id:"settingsPanel",class:P(["settings-panel",{active:g.value}])},[e("div",{class:"settings-overlay",onClick:i}),e("div",ce,[e("div",{class:"settings-header"},[t[7]||(t[7]=e("h3",null,"é˜…è¯»è®¾ç½®",-1)),e("button",{class:"close-btn",onClick:i},"Ã—")]),e("div",ue,[e("div",ge,[t[8]||(t[8]=e("label",null,"å›¾ç‰‡å®½åº¦",-1)),e("div",pe,[e("input",{type:"range",id:"imageWidthSlider",min:"50",max:"100",value:o.value.imageWidth,onInput:t[2]||(t[2]=d=>x(Number(d.target.value)))},null,40,ve),e("span",he,$(o.value.imageWidth)+"%",1)])]),e("div",me,[t[9]||(t[9]=e("label",null,"å›¾ç‰‡é—´è·",-1)),e("div",be,[e("input",{type:"range",id:"imageGapSlider",min:"0",max:"50",value:o.value.imageGap,onInput:t[3]||(t[3]=d=>B(Number(d.target.value)))},null,40,fe),e("span",Ce,$(o.value.imageGap)+"px",1)])]),e("div",we,[t[10]||(t[10]=e("label",null,"èƒŒæ™¯é¢œè‰²",-1)),e("div",ke,[(C(),f(L,null,F(h,d=>e("button",{key:d.color,class:P(["bg-option",{active:o.value.bgColor===d.color}]),"data-bg":d.color,style:Y({background:d.color}),title:d.name,onClick:D=>N(d.color)},null,14,ye)),64))])])])])],2)],64))}}),Se=W(_e,[["__scopeId","data-v-b8fd32df"]]),$e={class:"reader-page"},Ie={class:"reader-header"},Te={class:"header-left"},xe={class:"book-info"},Be={id:"bookTitle",class:"book-title"},Ee={id:"chapterTitle",class:"chapter-title"},Pe={class:"header-center"},Ne={id:"pageInfo",class:"page-info"},Re={class:"header-right"},Le={class:"view-mode-toggle"},Ge=G({__name:"ReaderView",props:{bookId:{},chapterId:{}},setup(p){const r=p,c=j(),v=X(),w=b(null),o=b(null),g=b([]),y=k(()=>g.value.find(a=>a.id===r.chapterId)),h=b([]),_=b(!0),i=b("translated"),l=b(1),u=k(()=>g.value.findIndex(a=>a.id===r.chapterId)),m=k(()=>u.value>0),T=k(()=>u.value>=0&&u.value<g.value.length-1),S=k(()=>{const a=y.value?.title||"é˜…è¯»",n=o.value?.title||"Saber-Translator";return`${a} - ${n}`}),I=k(()=>!_.value&&h.value.length>0);async function x(){_.value=!0;try{const[a,n]=await Promise.all([q(r.bookId),U(r.bookId,r.chapterId)]);if(a.success&&a.book)o.value=a.book,g.value=a.book.chapters||[];else throw new Error(a.error||"è·å–ä¹¦ç±ä¿¡æ¯å¤±è´¥");if(n.success&&n.images)h.value=n.images;else throw new Error(n.error||"è·å–ç« èŠ‚å›¾ç‰‡å¤±è´¥");document.title=S.value}catch(a){console.error("åŠ è½½æ•°æ®å¤±è´¥:",a),v.error("åŠ è½½å¤±è´¥: "+(a instanceof Error?a.message:"æœªçŸ¥é”™è¯¯")),setTimeout(()=>c.push("/"),2e3)}finally{_.value=!1}}function B(a){i.value=a}function N(a){const n=a==="prev"?u.value-1:u.value+1;if(n>=0&&n<g.value.length){const R=g.value[n];c.push(`/reader?book=${r.bookId}&chapter=${R.id}`)}}function E(){c.push("/")}function s(){c.push(`/translate?book=${r.bookId}&chapter=${r.chapterId}`)}function t(){w.value?.openSettings()}function d(a){l.value=a}function D(a){}return V(()=>{x(),Q().applyTheme()}),z(()=>[r.bookId,r.chapterId],()=>{x(),window.scrollTo({top:0})}),(a,n)=>(C(),f("div",$e,[e("header",Ie,[e("div",Te,[e("button",{id:"backBtn",class:"header-btn",title:"è¿”å›ä¹¦æ¶",onClick:E},[...n[2]||(n[2]=[e("span",{class:"btn-icon"},"â†",-1),e("span",{class:"btn-text"},"è¿”å›",-1)])]),e("div",xe,[e("span",Be,$(o.value?.title||"åŠ è½½ä¸­..."),1),n[3]||(n[3]=e("span",{class:"separator"},"Â·",-1)),e("span",Ee,$(y.value?.title||"-"),1)])]),e("div",Pe,[e("span",Ne,$(l.value)+" / "+$(h.value.length||"-"),1)]),e("div",Re,[e("div",Le,[e("button",{id:"viewOriginalBtn",class:P(["mode-btn",{active:i.value==="original"}]),"data-mode":"original",title:"æŸ¥çœ‹åŸå›¾",onClick:n[0]||(n[0]=R=>B("original"))}," åŸå›¾ ",2),e("button",{id:"viewTranslatedBtn",class:P(["mode-btn",{active:i.value==="translated"}]),"data-mode":"translated",title:"æŸ¥çœ‹ç¿»è¯‘",onClick:n[1]||(n[1]=R=>B("translated"))}," ç¿»è¯‘ ",2)]),e("button",{id:"settingsBtn",class:"header-btn",title:"é˜…è¯»è®¾ç½®",onClick:t},[...n[4]||(n[4]=[e("span",{class:"btn-icon"},"âš™ï¸",-1)])]),e("button",{id:"translateBtn",class:"header-btn primary",title:"è¿›å…¥ç¿»è¯‘é¡µé¢",onClick:s},[...n[5]||(n[5]=[e("span",{class:"btn-icon"},"âœï¸",-1),e("span",{class:"btn-text"},"ç¿»è¯‘",-1)])])])]),M(ie,{images:h.value,"view-mode":i.value,"is-loading":_.value,onPageChange:d,onGoTranslate:s},null,8,["images","view-mode","is-loading"]),M(Se,{ref_key:"readerControlsRef",ref:w,"current-page":l.value,"total-pages":h.value.length,"has-prev-chapter":m.value,"has-next-chapter":T.value,"show-chapter-nav":I.value,onNavigateChapter:N,onSettingsChange:D},null,8,["current-page","total-pages","has-prev-chapter","has-next-chapter","show-chapter-nav"])]))}}),Oe=W(Ge,[["__scopeId","data-v-49863224"]]);export{Oe as default};
