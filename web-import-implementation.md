# ğŸŒ ç½‘é¡µæ¼«ç”»å¯¼å…¥åŠŸèƒ½ - å®Œæ•´å®ç°æ–¹æ¡ˆ

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

### 1.1 æ ¸å¿ƒåŠŸèƒ½

ç”¨æˆ·è¾“å…¥æ¼«ç”»ç½‘é¡µ URL â†’ AI Agent è‡ªåŠ¨æå–æ¼«ç”»å›¾ç‰‡ â†’ ä¸‹è½½å¹¶å¯¼å…¥åˆ°ç¿»è¯‘å™¨

### 1.2 åŠŸèƒ½ç‰¹ç‚¹

- **AI é©±åŠ¨**ï¼šä½¿ç”¨ LLM + Firecrawl MCP å®ç°æ™ºèƒ½æå–ï¼Œæ— éœ€ç»´æŠ¤é€‰æ‹©å™¨è§„åˆ™
- **è‡ªä¸»å†³ç­–**ï¼šAI Agent è‡ªè¡Œå†³å®šè°ƒç”¨å·¥å…·çš„æ—¶æœºã€å‚æ•°å’Œæ¬¡æ•°ï¼ˆå¦‚æ»šåŠ¨é¡µé¢ï¼‰
- **é€šç”¨æ€§å¼º**ï¼šç†è®ºä¸Šæ”¯æŒä»»æ„æ¼«ç”»ç½‘ç«™
- **å¯é…ç½®**ï¼šæ”¯æŒå›¾ç‰‡é¢„å¤„ç†ã€å…¨å±€ Cookie/Header ç­‰é«˜çº§åŠŸèƒ½

---

## äºŒã€æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ç”¨æˆ·æ“ä½œ                                        â”‚
â”‚   ç‚¹å‡» [ğŸŒ ä»ç½‘é¡µå¯¼å…¥] â†’ è¾“å…¥ URL â†’ ç‚¹å‡» [å¼€å§‹æå–]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Vue å‰ç«¯                                             â”‚
â”‚   WebImportModal.vue  â†’  POST /api/web-import/extract                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Flask åç«¯ API                                       â”‚
â”‚   web_import_api.py  â†’  è°ƒç”¨ MangaScraperAgent                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AI Agent å¾ªç¯                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  1. LLM æ€è€ƒï¼šéœ€è¦è°ƒç”¨ä»€ä¹ˆå·¥å…·ï¼Ÿ                                      â”‚   â”‚
â”‚   â”‚  2. è°ƒç”¨ Firecrawl MCP å·¥å…· (scrape/crawl/extract)                   â”‚   â”‚
â”‚   â”‚  3. åˆ†æè¿”å›ç»“æœï¼Œå†³å®šæ˜¯å¦ç»§ç»­è°ƒç”¨                                    â”‚   â”‚
â”‚   â”‚  4. å¾ªç¯ç›´åˆ°ä»»åŠ¡å®Œæˆ                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  è¿”å›ç»“æ„åŒ–ç»“æœï¼š                                                     â”‚   â”‚
â”‚   â”‚  {                                                                   â”‚   â”‚
â”‚   â”‚    "comic_title": "æ¼«ç”»åç§°",                                         â”‚   â”‚
â”‚   â”‚    "chapter_title": "ç¬¬Xè¯",                                          â”‚   â”‚
â”‚   â”‚    "pages": [{"page_number": 1, "image_url": "..."}]                 â”‚   â”‚
â”‚   â”‚  }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å›¾ç‰‡ä¸‹è½½ & é¢„å¤„ç†                                    â”‚
â”‚   ImageDownloader  â†’  ä¸‹è½½å›¾ç‰‡ â†’ é¢„å¤„ç† â†’ è½¬ Base64                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å¯¼å…¥åˆ°ç¿»è¯‘å™¨                                         â”‚
â”‚   imageStore.addImage()  â†’  ç”¨æˆ·å¼€å§‹ç¿»è¯‘                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€ç±»å‹å®šä¹‰

### 3.1 è®¾ç½®ç±»å‹ (`types/settings.ts`)

```typescript
/** ç¿»è¯‘æœåŠ¡å•†ç±»å‹ */
export type TranslationProvider = 
  | 'openai'
  | 'siliconflow' 
  | 'deepseek' 
  | 'volcano' 
  | 'gemini' 
  | 'custom_openai'

/** å›¾ç‰‡é¢„å¤„ç†è®¾ç½® */
export interface ImagePreprocessSettings {
  enabled: boolean
  autoRotate: boolean                 // æ ¹æ® EXIF è‡ªåŠ¨æ—‹è½¬ (å¯é åŠŸèƒ½)
  compression: {
    enabled: boolean
    quality: number                   // 0-100
    maxWidth: number                  // 0 = ä¸é™åˆ¶
    maxHeight: number                 // 0 = ä¸é™åˆ¶
  }
  formatConvert: {
    enabled: boolean
    targetFormat: 'jpeg' | 'png' | 'webp' | 'original'
  }
}

/** ç½‘é¡µå¯¼å…¥å®Œæ•´è®¾ç½® */
export interface WebImportSettings {
  /** Firecrawl é…ç½® */
  firecrawl: {
    apiKey: string
  }
  
  /** AI Agent é…ç½® (ç‹¬ç«‹é…ç½®ï¼Œä¸å¤ç”¨ç¿»è¯‘æœåŠ¡) */
  agent: {
    provider: TranslationProvider
    apiKey: string
    customBaseUrl: string
    modelName: string
    useStream: boolean                // æµå¼è°ƒç”¨
    forceJsonOutput: boolean          // å¼ºåˆ¶ JSON è¾“å‡º
    maxRetries: number
    timeout: number                   // ç§’
  }
  
  /** æå–è®¾ç½® */
  extraction: {
    prompt: string                    // æå–æç¤ºè¯
    maxIterations: number             // Agent æœ€å¤§è¿­ä»£æ¬¡æ•°
  }
  
  /** ä¸‹è½½è®¾ç½® */
  download: {
    concurrency: number               // å¹¶å‘ä¸‹è½½æ•°
    timeout: number                   // å•å¼ è¶…æ—¶ (ç§’)
    retries: number                   // å¤±è´¥é‡è¯•æ¬¡æ•°
    delay: number                     // ä¸‹è½½é—´éš” (ms)
    useReferer: boolean               // è‡ªåŠ¨æ·»åŠ  Referer
  }
  
  /** å›¾ç‰‡é¢„å¤„ç† */
  imagePreprocess: ImagePreprocessSettings
  
  /** é«˜çº§è®¾ç½® */
  advanced: {
    customCookie: string              // å…¨å±€è‡ªå®šä¹‰ Cookie
    customHeaders: string             // å…¨å±€è‡ªå®šä¹‰è¯·æ±‚å¤´ (JSON)
    bypassProxy: boolean              // ç»•è¿‡ç³»ç»Ÿä»£ç†
  }
  
  /** ç•Œé¢è®¾ç½® */
  ui: {
    showAgentLogs: boolean            // æ˜¾ç¤º AI å·¥ä½œæ—¥å¿—
    autoImport: boolean               // æå–åè‡ªåŠ¨å¯¼å…¥
  }
}
```

### 3.2 API å“åº”ç±»å‹

```typescript
/** æå–ç»“æœ */
export interface ExtractResult {
  success: boolean
  comicTitle: string
  chapterTitle: string
  pages: Array<{
    pageNumber: number
    imageUrl: string
  }>
  totalPages: number
  sourceUrl: string
}

/** ä¸‹è½½ç»“æœ */
export interface DownloadResult {
  success: boolean
  images: Array<{
    index: number
    filename: string
    dataUrl: string        // base64
    size: number           // bytes
  }>
  failedCount: number
}

/** Agent æ—¥å¿— */
export interface AgentLog {
  timestamp: string
  type: 'info' | 'tool_call' | 'tool_result' | 'thinking' | 'error'
  message: string
}
```

---

## å››ã€åç«¯æ¨¡å—è®¾è®¡

### 4.1 ç›®å½•ç»“æ„

```
src/core/web_import/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ agent.py              # AI Agent æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ firecrawl_tools.py    # Firecrawl å·¥å…·å®šä¹‰
â”œâ”€â”€ image_downloader.py   # å›¾ç‰‡ä¸‹è½½å™¨
â”œâ”€â”€ image_processor.py    # å›¾ç‰‡é¢„å¤„ç†å™¨
â””â”€â”€ prompts.py            # æç¤ºè¯æ¨¡æ¿

src/app/api/
â””â”€â”€ web_import_api.py     # Flask API è·¯ç”±
```

### 4.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### agent.py - AI Agent

```python
class MangaScraperAgent:
    """AI é©±åŠ¨çš„æ¼«ç”»å›¾ç‰‡æå– Agent"""
    
    def __init__(self, config: WebImportSettings):
        self.config = config
        self.llm_client = self._init_llm_client()
        self.tools = self._load_firecrawl_tools()
        # ä¸å†éœ€è¦æ³¨å…¥é¢„è®¾ headersï¼Œç›´æ¥ä½¿ç”¨ config.advanced.customHeaders
    
    async def extract(self, url: str, on_log: Callable) -> ExtractResult:
        """
        æ‰§è¡Œæå–ä»»åŠ¡
        
        Args:
            url: æ¼«ç”»ç½‘é¡µ URL
            on_log: æ—¥å¿—å›è°ƒå‡½æ•° (ç”¨äºæµå¼è¿”å›æ—¥å¿—)
        
        Returns:
            ExtractResult: æå–ç»“æœ
        """
        # ç¡®ä¿æç¤ºè¯ä¸­åŒ…å« JSON è¾“å‡ºè¦æ±‚
        system_prompt = self.config.extraction.prompt + "\n\nIMPORTANT: You must response with valid JSON format only."
        messages = [
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": f"è¯·æå–è¿™ä¸ªURLçš„æ¼«ç”»å›¾ç‰‡: {url}"}
        ]
        
        for iteration in range(self.config.extraction.maxIterations):
            # 1. è°ƒç”¨ LLM
            response = await self._call_llm(messages)
            
            # 2. å¦‚æœæœ‰å·¥å…·è°ƒç”¨ï¼Œæ‰§è¡Œå·¥å…·
            if response.tool_calls:
                for tool_call in response.tool_calls:
                    on_log(AgentLog(type='tool_call', message=f"è°ƒç”¨ {tool_call.name}"))
                    result = await self._execute_tool(tool_call)
                    on_log(AgentLog(type='tool_result', message=f"è¿”å› {len(str(result))} å­—ç¬¦"))
                    messages.append(tool_result_message)
            else:
                # 3. æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œè§£ææœ€ç»ˆç»“æœ
                return self._parse_result(response.content)
        
        raise MaxIterationsExceeded()
```

---

## äº”ã€å‰ç«¯ç»„ä»¶ & æ ·å¼è®¾è®¡

### 5.1 ç›®å½•ç»“æ„

```
vue-frontend/src/components/
â”œâ”€â”€ settings/
â”‚   â””â”€â”€ WebImportSettings.vue       # è®¾ç½®é¡µé¢ç»„ä»¶
â”‚
â””â”€â”€ translate/
    â”œâ”€â”€ WebImportButton.vue         # å…¥å£æŒ‰é’®
    â”œâ”€â”€ WebImportModal.vue          # å¯¼å…¥æ¨¡æ€æ¡†
    â””â”€â”€ WebImportImageGrid.vue      # å›¾ç‰‡é¢„è§ˆç½‘æ ¼
```

### 5.2 å‰ç«¯ç•Œé¢è®¾è®¡å›¾

#### å…¥å£æŒ‰é’® (WebImportButton.vue)

```
[ğŸ“‚ æ‰“å¼€å›¾ç‰‡]  [ğŸŒ ä»ç½‘é¡µå¯¼å…¥]
```

#### å¯¼å…¥æ¨¡æ€æ¡† (WebImportModal.vue)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ ä»ç½‘é¡µå¯¼å…¥æ¼«ç”»                                   [Ã—] å…³é—­ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç½‘å€: [ https://www.xxxx.com/chapter-1    ] [ ğŸ” å¼€å§‹æå– ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â–¼] AI å·¥ä½œæ—¥å¿— (æå–ä¸­...)                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [10:00:01] æ­£åœ¨åˆ†æç½‘é¡µç»“æ„...                           â”‚ â”‚
â”‚ â”‚ [10:00:03] è°ƒç”¨ firecrawl_scrape...                      â”‚ â”‚
â”‚ â”‚ [10:00:05] å‘ç° 20 å¼ å›¾ç‰‡ï¼Œæ­£åœ¨è¿‡æ»¤...                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“– æå–ç»“æœ: ã€Šæ¼«ç”»åã€‹- ç¬¬1è¯ - å…± 20 å¼                    â”‚
â”‚                                                             â”‚
â”‚ [ âˆš å…¨é€‰ ]  å·²é€‰: 20 å¼                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                    â”‚
â”‚ â”‚  â˜‘  â”‚ â”‚  â˜‘  â”‚ â”‚  â˜‘  â”‚ â”‚  â˜‘  â”‚ â”‚  â˜‘  â”‚                    â”‚
â”‚ â”‚ å›¾1 â”‚ â”‚ å›¾2 â”‚ â”‚ å›¾3 â”‚ â”‚ å›¾4 â”‚ â”‚ å›¾5 â”‚ ...                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸‹è½½è¿›åº¦: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%] 16/20                          â”‚
â”‚                                                             â”‚
â”‚                                     [ å–æ¶ˆ ] [ ğŸ“¥ å¯¼å…¥ ]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è®¾ç½®ç•Œé¢ (WebImportSettings.vue)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [åŸºæœ¬è®¾ç½®]  [å›¾ç‰‡é¢„å¤„ç†]  [é«˜çº§è®¾ç½®]                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Firecrawl API Key: [ fc-xxxxxxxxx ] ğŸ‘  [æµ‹è¯•è¿æ¥]          â”‚
â”‚                                                             â”‚
â”‚ AI Agent é…ç½®:                                              â”‚
â”‚ æœåŠ¡å•†: [ OpenAI â–¼ ]                                        â”‚
â”‚ API Key: [ sk-xxxxxxxxx ] ğŸ‘                                â”‚
â”‚ æ¨¡å‹: [ gpt-4o-mini ] [è·å–æ¨¡å‹]                            â”‚
â”‚ [â˜‘ å¼ºåˆ¶JSONæ ¼å¼]  [â˜‘ æµå¼è°ƒç”¨]                              â”‚
â”‚ [æµ‹è¯•è¿æ¥]                                                  â”‚
â”‚                                                             â”‚
â”‚ æå–æç¤ºè¯:                                                 â”‚
â”‚ [................................]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 æ ·å¼æ–¹æ¡ˆ

å¤ç”¨é¡¹ç›®çš„ `global.css` å˜é‡ï¼š
- èƒŒæ™¯è‰²: `var(--bg-primary)`, `var(--bg-secondary)`
- è¾¹æ¡†: `var(--border-color)`
- æŒ‰é’®: `var(--btn-primary-bg)`, `var(--btn-secondary-bg)`
- æ–‡æœ¬: `var(--text-primary)`, `var(--text-secondary)`

---

## å…­ã€é»˜è®¤æç¤ºè¯

```typescript
// constants/index.ts

export const DEFAULT_EXTRACTION_PROMPT = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¼«ç”»æ•°æ®æå–åŠ©æ‰‹ã€‚è¯·é’ˆå¯¹å½“å‰ç½‘é¡µæ‰§è¡Œä»¥ä¸‹æå–ä»»åŠ¡:

## 1. äº¤äº’è¡Œä¸º
- è¯·æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºï¼Œç¼“æ…¢å‘ä¸‹æ»šåŠ¨é¡µé¢è‡³åº•éƒ¨ï¼Œä»¥è§¦å‘æ‰€æœ‰é‡‡ç”¨"æ‡’åŠ è½½"æŠ€æœ¯çš„æ¼«ç”»å›¾ç‰‡ã€‚
- åœ¨æ»šåŠ¨è¿‡ç¨‹ä¸­ï¼Œè¯·ç¡®ä¿ç­‰å¾…å›¾ç‰‡åŠ è½½å®Œæˆï¼Œè¯†åˆ«å¹¶æå–çœŸå®çš„æ¼«ç”»å†…å®¹å›¾ç‰‡ã€‚

## 2. æå–é€»è¾‘
- **å›¾ç‰‡è¿‡æ»¤**: å¿½ç•¥æ‰€æœ‰åŠ è½½å ä½å›¾ï¼ˆå¦‚ loading.gifã€spacer.gifï¼‰ã€å¹¿å‘Šå›¾æˆ–å›¾æ ‡ï¼Œä»…æå–å±äºæ¼«ç”»æ­£æ–‡çš„å›¾ç‰‡ã€‚
- **å±æ€§è¯†åˆ«**: ä¼˜å…ˆæå– \`data-src\`ã€\`data-original\`ã€\`original\` æˆ– \`file\` ç­‰åŒ…å«çœŸå®é«˜æ¸…åŸå›¾åœ°å€çš„å±æ€§ã€‚å¦‚æœè¿™äº›å±æ€§ä¸å­˜åœ¨ï¼Œå†æå– \`src\` å±æ€§ã€‚
- **å…ƒæ•°æ®**: æå–æ¼«ç”»çš„åç§°ï¼ˆcomic_titleï¼‰å’Œå½“å‰ç« èŠ‚çš„åç§°ï¼ˆchapter_titleï¼‰ã€‚

## 3. æ•°æ®ç»“æ„
- å¿…é¡»æŒ‰å›¾ç‰‡åœ¨é¡µé¢ä¸­æ˜¾ç¤ºçš„å…ˆåé¡ºåºæå–ï¼Œå¹¶ä¸ºæ¯å¼ å›¾ç‰‡åˆ†é…ä¸€ä¸ªä» 1 å¼€å§‹çš„ \`page_number\`ï¼ˆé¡µç åºå·ï¼‰ã€‚
- æœ€ç»ˆç»“æœä»¥ JSON æ ¼å¼è¾“å‡ºï¼ŒåŒ…å«æ¼«ç”»åç§°ã€ç« èŠ‚åä»¥åŠåŒ…å«åºå·å’Œå›¾ç‰‡é“¾æ¥çš„åˆ—è¡¨ã€‚

## 4. è¾“å‡ºæ ¼å¼ (Valid JSON Only)
ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼è¾“å‡ºï¼Œä¸è¦åŒ…å« Markdown ä»£ç å—æ ‡è®°ï¼ˆå¦‚ \`\`\`jsonï¼‰ï¼š

{
  "comic_title": "æ¼«ç”»åç§°",
  "chapter_title": "ç¬¬Xè¯ ç« èŠ‚æ ‡é¢˜",
  "pages": [
    {"page_number": 1, "image_url": "https://..."},
    {"page_number": 2, "image_url": "https://..."}
  ],
  "total_pages": 1
}
`
```

---

## ä¸ƒã€å®ç°æ­¥éª¤

### Phase 1: åŸºç¡€æ¶æ„ (Day 1-2)

1. **ç±»å‹å®šä¹‰**
   - [ ] æ›´æ–° `types/settings.ts` æ·»åŠ  WebImportSettings
   - [ ] åˆ›å»º `types/webImport.ts` æ·»åŠ  API å“åº”ç±»å‹

2. **Store æ›´æ–°**
   - [ ] æ›´æ–° `settingsStore.ts` æ·»åŠ  webImport é…ç½®
   - [ ] æ·»åŠ é»˜è®¤å€¼å’ŒæŒä¹…åŒ–é€»è¾‘

### Phase 2: åç«¯æ ¸å¿ƒ (Day 3-5)

3. **åˆ›å»º web_import æ¨¡å—**
   - [ ] `src/core/web_import/agent.py` - AI Agent é€»è¾‘å®ç°
   - [ ] `src/core/web_import/firecrawl_tools.py` - Firecrawl å·¥å…·å®šä¹‰ (Function Calling Schema)
   - [ ] `src/core/web_import/image_downloader.py` - å›¾ç‰‡ä¸‹è½½å™¨ (Async/Concurrent)
   - [ ] `src/core/web_import/image_processor.py` - å›¾ç‰‡é¢„å¤„ç† (PIL)

4. **API å¼€å‘**
   - [ ] å®ç° POST `/api/web-import/extract` (SSE Streaming)
   - [ ] å®ç° POST `/api/web-import/download`

### Phase 3: å‰ç«¯å¼€å‘ (Day 6-8)

5. **è®¾ç½®ç»„ä»¶**
   - [ ] `WebImportSettings.vue`
   - [ ] é›†æˆåˆ° `SettingsModal.vue`

6. **åŠŸèƒ½ç»„ä»¶**
   - [ ] `WebImportModal.vue` (æ ¸å¿ƒåŠŸèƒ½ç•Œé¢)
   - [ ] `WebImportButton.vue` (å…¥å£)

### Phase 4: è°ƒè¯•ä¸ä¼˜åŒ– (Day 9-10)

7. **æµ‹è¯•**
   - [ ] é’ˆå¯¹ç›®æ ‡ç½‘ç«™æµ‹è¯•æå–æ•ˆæœ
   - [ ] è°ƒæ•´é»˜è®¤æç¤ºè¯

---

## å…«ã€ä¾èµ–å®‰è£…

### å·²æœ‰ä¾èµ–
é¡¹ç›®å·²åŒ…å«ä»¥ä¸‹åŸºç¡€ä¾èµ–ï¼ˆæ— éœ€é‡å¤å®‰è£…ï¼‰ï¼š
- `httpx` (åœ¨ `manga_insight` æ¨¡å—ä¸­ä½¿ç”¨)
- `pillow` (åŸºç¡€å›¾åƒå¤„ç†)
- `openai` (AI å®¢æˆ·ç«¯)

### æ–°å¢ä¾èµ–
éœ€è¦å®‰è£… `mcp` åŒ…ä»¥æ”¯æŒ Firecrawl MCP åè®®ï¼š

```bash
pip install mcp
```

*(æ³¨ï¼šå¦‚æœä¸éœ€è¦æ ‡å‡† MCP åè®®æ”¯æŒï¼Œä¹Ÿå¯ä¸å®‰è£…ï¼Œä½¿ç”¨ requests ç›´è¿ Firecrawl API)*

---

## ä¹ã€æ³¨æ„äº‹é¡¹

### 9.1 å®‰å…¨æé†’

åœ¨ UI ä¸­æ˜¾ç¤ºæç¤ºï¼š
> âš ï¸ **ä½¿ç”¨é¡»çŸ¥**ï¼šè¯·ä»…çˆ¬å–æ‚¨æœ‰æƒè®¿é—®çš„å†…å®¹ï¼Œå¹¶éµå®ˆç›®æ ‡ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾ã€‚

### 9.2 JSON è¾“å‡ºç¨³å®šæ€§
AI æœ‰æ—¶ä¼šè¾“å‡º Markdown ä»£ç å—ã€‚åœ¨ `_parse_result` ä¸­åº”å¢åŠ é€»è¾‘ï¼Œè‡ªåŠ¨å»é™¤ ` ```json ` å’Œ ` ``` ` æ ‡è®°ï¼Œç¡®ä¿ `json.loads` èƒ½æ­£ç¡®è§£æã€‚

### 9.3 ä»£ç†é—®é¢˜
è‹¥æœ¬åœ°é€šè¿‡ä»£ç†è®¿é—®å¤–ç½‘ï¼Œè¯·ç¡®ä¿ `httpx` å®¢æˆ·ç«¯æ­£ç¡®é…ç½®äº†ä»£ç†ï¼Œæˆ–è€…åœ¨é«˜çº§è®¾ç½®ä¸­æä¾›"ç»•è¿‡ç³»ç»Ÿä»£ç†"çš„é€‰é¡¹ï¼ˆé’ˆå¯¹è¿æ¥æœ¬åœ° LLM æœåŠ¡ï¼‰ã€‚
